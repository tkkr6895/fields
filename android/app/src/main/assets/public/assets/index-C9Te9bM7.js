(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))c(_);new MutationObserver(_=>{for(const b of _)if(b.type==="childList")for(const x of b.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&c(x)}).observe(document,{childList:!0,subtree:!0});function o(_){const b={};return _.integrity&&(b.integrity=_.integrity),_.referrerPolicy&&(b.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?b.credentials="include":_.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function c(_){if(_.ep)return;_.ep=!0;const b=o(_);fetch(_.href,b)}})();var Nf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gp(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Dx={exports:{}},yp={},zx={exports:{}},Rr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bd=Symbol.for("react.element"),tS=Symbol.for("react.portal"),rS=Symbol.for("react.fragment"),nS=Symbol.for("react.strict_mode"),iS=Symbol.for("react.profiler"),aS=Symbol.for("react.provider"),sS=Symbol.for("react.context"),oS=Symbol.for("react.forward_ref"),lS=Symbol.for("react.suspense"),uS=Symbol.for("react.memo"),cS=Symbol.for("react.lazy"),Yv=Symbol.iterator;function hS(n){return n===null||typeof n!="object"?null:(n=Yv&&n[Yv]||n["@@iterator"],typeof n=="function"?n:null)}var Lx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Rx=Object.assign,Ox={};function Kc(n,r,o){this.props=n,this.context=r,this.refs=Ox,this.updater=o||Lx}Kc.prototype.isReactComponent={};Kc.prototype.setState=function(n,r){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,r,"setState")};Kc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Fx(){}Fx.prototype=Kc.prototype;function dy(n,r,o){this.props=n,this.context=r,this.refs=Ox,this.updater=o||Lx}var fy=dy.prototype=new Fx;fy.constructor=dy;Rx(fy,Kc.prototype);fy.isPureReactComponent=!0;var Jv=Array.isArray,Bx=Object.prototype.hasOwnProperty,py={current:null},Nx={key:!0,ref:!0,__self:!0,__source:!0};function jx(n,r,o){var c,_={},b=null,x=null;if(r!=null)for(c in r.ref!==void 0&&(x=r.ref),r.key!==void 0&&(b=""+r.key),r)Bx.call(r,c)&&!Nx.hasOwnProperty(c)&&(_[c]=r[c]);var h=arguments.length-2;if(h===1)_.children=o;else if(1<h){for(var j=Array(h),q=0;q<h;q++)j[q]=arguments[q+2];_.children=j}if(n&&n.defaultProps)for(c in h=n.defaultProps,h)_[c]===void 0&&(_[c]=h[c]);return{$$typeof:bd,type:n,key:b,ref:x,props:_,_owner:py.current}}function dS(n,r){return{$$typeof:bd,type:n.type,key:r,ref:n.ref,props:n.props,_owner:n._owner}}function my(n){return typeof n=="object"&&n!==null&&n.$$typeof===bd}function fS(n){var r={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(o){return r[o]})}var Qv=/\/+/g;function Rm(n,r){return typeof n=="object"&&n!==null&&n.key!=null?fS(""+n.key):r.toString(36)}function Tf(n,r,o,c,_){var b=typeof n;(b==="undefined"||b==="boolean")&&(n=null);var x=!1;if(n===null)x=!0;else switch(b){case"string":case"number":x=!0;break;case"object":switch(n.$$typeof){case bd:case tS:x=!0}}if(x)return x=n,_=_(x),n=c===""?"."+Rm(x,0):c,Jv(_)?(o="",n!=null&&(o=n.replace(Qv,"$&/")+"/"),Tf(_,r,o,"",function(q){return q})):_!=null&&(my(_)&&(_=dS(_,o+(!_.key||x&&x.key===_.key?"":(""+_.key).replace(Qv,"$&/")+"/")+n)),r.push(_)),1;if(x=0,c=c===""?".":c+":",Jv(n))for(var h=0;h<n.length;h++){b=n[h];var j=c+Rm(b,h);x+=Tf(b,r,o,j,_)}else if(j=hS(n),typeof j=="function")for(n=j.call(n),h=0;!(b=n.next()).done;)b=b.value,j=c+Rm(b,h++),x+=Tf(b,r,o,j,_);else if(b==="object")throw r=String(n),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return x}function nf(n,r,o){if(n==null)return n;var c=[],_=0;return Tf(n,c,"","",function(b){return r.call(o,b,_++)}),c}function pS(n){if(n._status===-1){var r=n._result;r=r(),r.then(function(o){(n._status===0||n._status===-1)&&(n._status=1,n._result=o)},function(o){(n._status===0||n._status===-1)&&(n._status=2,n._result=o)}),n._status===-1&&(n._status=0,n._result=r)}if(n._status===1)return n._result.default;throw n._result}var la={current:null},If={transition:null},mS={ReactCurrentDispatcher:la,ReactCurrentBatchConfig:If,ReactCurrentOwner:py};function Ux(){throw Error("act(...) is not supported in production builds of React.")}Rr.Children={map:nf,forEach:function(n,r,o){nf(n,function(){r.apply(this,arguments)},o)},count:function(n){var r=0;return nf(n,function(){r++}),r},toArray:function(n){return nf(n,function(r){return r})||[]},only:function(n){if(!my(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Rr.Component=Kc;Rr.Fragment=rS;Rr.Profiler=iS;Rr.PureComponent=dy;Rr.StrictMode=nS;Rr.Suspense=lS;Rr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mS;Rr.act=Ux;Rr.cloneElement=function(n,r,o){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var c=Rx({},n.props),_=n.key,b=n.ref,x=n._owner;if(r!=null){if(r.ref!==void 0&&(b=r.ref,x=py.current),r.key!==void 0&&(_=""+r.key),n.type&&n.type.defaultProps)var h=n.type.defaultProps;for(j in r)Bx.call(r,j)&&!Nx.hasOwnProperty(j)&&(c[j]=r[j]===void 0&&h!==void 0?h[j]:r[j])}var j=arguments.length-2;if(j===1)c.children=o;else if(1<j){h=Array(j);for(var q=0;q<j;q++)h[q]=arguments[q+2];c.children=h}return{$$typeof:bd,type:n.type,key:_,ref:b,props:c,_owner:x}};Rr.createContext=function(n){return n={$$typeof:sS,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:aS,_context:n},n.Consumer=n};Rr.createElement=jx;Rr.createFactory=function(n){var r=jx.bind(null,n);return r.type=n,r};Rr.createRef=function(){return{current:null}};Rr.forwardRef=function(n){return{$$typeof:oS,render:n}};Rr.isValidElement=my;Rr.lazy=function(n){return{$$typeof:cS,_payload:{_status:-1,_result:n},_init:pS}};Rr.memo=function(n,r){return{$$typeof:uS,type:n,compare:r===void 0?null:r}};Rr.startTransition=function(n){var r=If.transition;If.transition={};try{n()}finally{If.transition=r}};Rr.unstable_act=Ux;Rr.useCallback=function(n,r){return la.current.useCallback(n,r)};Rr.useContext=function(n){return la.current.useContext(n)};Rr.useDebugValue=function(){};Rr.useDeferredValue=function(n){return la.current.useDeferredValue(n)};Rr.useEffect=function(n,r){return la.current.useEffect(n,r)};Rr.useId=function(){return la.current.useId()};Rr.useImperativeHandle=function(n,r,o){return la.current.useImperativeHandle(n,r,o)};Rr.useInsertionEffect=function(n,r){return la.current.useInsertionEffect(n,r)};Rr.useLayoutEffect=function(n,r){return la.current.useLayoutEffect(n,r)};Rr.useMemo=function(n,r){return la.current.useMemo(n,r)};Rr.useReducer=function(n,r,o){return la.current.useReducer(n,r,o)};Rr.useRef=function(n){return la.current.useRef(n)};Rr.useState=function(n){return la.current.useState(n)};Rr.useSyncExternalStore=function(n,r,o){return la.current.useSyncExternalStore(n,r,o)};Rr.useTransition=function(){return la.current.useTransition()};Rr.version="18.3.1";zx.exports=Rr;var Kt=zx.exports;const yc=gp(Kt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gS=Kt,yS=Symbol.for("react.element"),_S=Symbol.for("react.fragment"),vS=Object.prototype.hasOwnProperty,xS=gS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wS={key:!0,ref:!0,__self:!0,__source:!0};function Vx(n,r,o){var c,_={},b=null,x=null;o!==void 0&&(b=""+o),r.key!==void 0&&(b=""+r.key),r.ref!==void 0&&(x=r.ref);for(c in r)vS.call(r,c)&&!wS.hasOwnProperty(c)&&(_[c]=r[c]);if(n&&n.defaultProps)for(c in r=n.defaultProps,r)_[c]===void 0&&(_[c]=r[c]);return{$$typeof:yS,type:n,key:b,ref:x,props:_,_owner:xS.current}}yp.Fragment=_S;yp.jsx=Vx;yp.jsxs=Vx;Dx.exports=yp;var Ue=Dx.exports,fg={},$x={exports:{}},Za={},qx={exports:{}},Kx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function r(Ke,We){var gt=Ke.length;Ke.push(We);e:for(;0<gt;){var yt=gt-1>>>1,Rt=Ke[yt];if(0<_(Rt,We))Ke[yt]=We,Ke[gt]=Rt,gt=yt;else break e}}function o(Ke){return Ke.length===0?null:Ke[0]}function c(Ke){if(Ke.length===0)return null;var We=Ke[0],gt=Ke.pop();if(gt!==We){Ke[0]=gt;e:for(var yt=0,Rt=Ke.length,It=Rt>>>1;yt<It;){var Sr=2*(yt+1)-1,wr=Ke[Sr],kr=Sr+1,zr=Ke[kr];if(0>_(wr,gt))kr<Rt&&0>_(zr,wr)?(Ke[yt]=zr,Ke[kr]=gt,yt=kr):(Ke[yt]=wr,Ke[Sr]=gt,yt=Sr);else if(kr<Rt&&0>_(zr,gt))Ke[yt]=zr,Ke[kr]=gt,yt=kr;else break e}}return We}function _(Ke,We){var gt=Ke.sortIndex-We.sortIndex;return gt!==0?gt:Ke.id-We.id}if(typeof performance=="object"&&typeof performance.now=="function"){var b=performance;n.unstable_now=function(){return b.now()}}else{var x=Date,h=x.now();n.unstable_now=function(){return x.now()-h}}var j=[],q=[],le=1,Y=null,W=3,$e=!1,He=!1,Je=!1,Qt=typeof setTimeout=="function"?setTimeout:null,be=typeof clearTimeout=="function"?clearTimeout:null,pe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ke(Ke){for(var We=o(q);We!==null;){if(We.callback===null)c(q);else if(We.startTime<=Ke)c(q),We.sortIndex=We.expirationTime,r(j,We);else break;We=o(q)}}function Ve(Ke){if(Je=!1,ke(Ke),!He)if(o(j)!==null)He=!0,Hr(et);else{var We=o(q);We!==null&&nr(Ve,We.startTime-Ke)}}function et(Ke,We){He=!1,Je&&(Je=!1,be(ce),ce=-1),$e=!0;var gt=W;try{for(ke(We),Y=o(j);Y!==null&&(!(Y.expirationTime>We)||Ke&&!Ye());){var yt=Y.callback;if(typeof yt=="function"){Y.callback=null,W=Y.priorityLevel;var Rt=yt(Y.expirationTime<=We);We=n.unstable_now(),typeof Rt=="function"?Y.callback=Rt:Y===o(j)&&c(j),ke(We)}else c(j);Y=o(j)}if(Y!==null)var It=!0;else{var Sr=o(q);Sr!==null&&nr(Ve,Sr.startTime-We),It=!1}return It}finally{Y=null,W=gt,$e=!1}}var ut=!1,Qe=null,ce=-1,me=5,Le=-1;function Ye(){return!(n.unstable_now()-Le<me)}function Tt(){if(Qe!==null){var Ke=n.unstable_now();Le=Ke;var We=!0;try{We=Qe(!0,Ke)}finally{We?Ot():(ut=!1,Qe=null)}}else ut=!1}var Ot;if(typeof pe=="function")Ot=function(){pe(Tt)};else if(typeof MessageChannel<"u"){var vr=new MessageChannel,Kr=vr.port2;vr.port1.onmessage=Tt,Ot=function(){Kr.postMessage(null)}}else Ot=function(){Qt(Tt,0)};function Hr(Ke){Qe=Ke,ut||(ut=!0,Ot())}function nr(Ke,We){ce=Qt(function(){Ke(n.unstable_now())},We)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ke){Ke.callback=null},n.unstable_continueExecution=function(){He||$e||(He=!0,Hr(et))},n.unstable_forceFrameRate=function(Ke){0>Ke||125<Ke?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):me=0<Ke?Math.floor(1e3/Ke):5},n.unstable_getCurrentPriorityLevel=function(){return W},n.unstable_getFirstCallbackNode=function(){return o(j)},n.unstable_next=function(Ke){switch(W){case 1:case 2:case 3:var We=3;break;default:We=W}var gt=W;W=We;try{return Ke()}finally{W=gt}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ke,We){switch(Ke){case 1:case 2:case 3:case 4:case 5:break;default:Ke=3}var gt=W;W=Ke;try{return We()}finally{W=gt}},n.unstable_scheduleCallback=function(Ke,We,gt){var yt=n.unstable_now();switch(typeof gt=="object"&&gt!==null?(gt=gt.delay,gt=typeof gt=="number"&&0<gt?yt+gt:yt):gt=yt,Ke){case 1:var Rt=-1;break;case 2:Rt=250;break;case 5:Rt=1073741823;break;case 4:Rt=1e4;break;default:Rt=5e3}return Rt=gt+Rt,Ke={id:le++,callback:We,priorityLevel:Ke,startTime:gt,expirationTime:Rt,sortIndex:-1},gt>yt?(Ke.sortIndex=gt,r(q,Ke),o(j)===null&&Ke===o(q)&&(Je?(be(ce),ce=-1):Je=!0,nr(Ve,gt-yt))):(Ke.sortIndex=Rt,r(j,Ke),He||$e||(He=!0,Hr(et))),Ke},n.unstable_shouldYield=Ye,n.unstable_wrapCallback=function(Ke){var We=W;return function(){var gt=W;W=We;try{return Ke.apply(this,arguments)}finally{W=gt}}}})(Kx);qx.exports=Kx;var bS=qx.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SS=Kt,Ha=bS;function ht(n){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+n,o=1;o<arguments.length;o++)r+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+n+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Gx=new Set,id={};function Ru(n,r){Bc(n,r),Bc(n+"Capture",r)}function Bc(n,r){for(id[n]=r,n=0;n<r.length;n++)Gx.add(r[n])}var No=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),pg=Object.prototype.hasOwnProperty,kS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,e0={},t0={};function CS(n){return pg.call(t0,n)?!0:pg.call(e0,n)?!1:kS.test(n)?t0[n]=!0:(e0[n]=!0,!1)}function TS(n,r,o,c){if(o!==null&&o.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return c?!1:o!==null?!o.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function IS(n,r,o,c){if(r===null||typeof r>"u"||TS(n,r,o,c))return!0;if(c)return!1;if(o!==null)switch(o.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function ua(n,r,o,c,_,b,x){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=c,this.attributeNamespace=_,this.mustUseProperty=o,this.propertyName=n,this.type=r,this.sanitizeURL=b,this.removeEmptyString=x}var Di={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Di[n]=new ua(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var r=n[0];Di[r]=new ua(r,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Di[n]=new ua(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Di[n]=new ua(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Di[n]=new ua(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Di[n]=new ua(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Di[n]=new ua(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Di[n]=new ua(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Di[n]=new ua(n,5,!1,n.toLowerCase(),null,!1,!1)});var gy=/[\-:]([a-z])/g;function yy(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var r=n.replace(gy,yy);Di[r]=new ua(r,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var r=n.replace(gy,yy);Di[r]=new ua(r,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var r=n.replace(gy,yy);Di[r]=new ua(r,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Di[n]=new ua(n,1,!1,n.toLowerCase(),null,!1,!1)});Di.xlinkHref=new ua("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Di[n]=new ua(n,1,!1,n.toLowerCase(),null,!0,!0)});function _y(n,r,o,c){var _=Di.hasOwnProperty(r)?Di[r]:null;(_!==null?_.type!==0:c||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(IS(r,o,_,c)&&(o=null),c||_===null?CS(r)&&(o===null?n.removeAttribute(r):n.setAttribute(r,""+o)):_.mustUseProperty?n[_.propertyName]=o===null?_.type===3?!1:"":o:(r=_.attributeName,c=_.attributeNamespace,o===null?n.removeAttribute(r):(_=_.type,o=_===3||_===4&&o===!0?"":""+o,c?n.setAttributeNS(c,r,o):n.setAttribute(r,o))))}var $o=SS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,af=Symbol.for("react.element"),_c=Symbol.for("react.portal"),vc=Symbol.for("react.fragment"),vy=Symbol.for("react.strict_mode"),mg=Symbol.for("react.profiler"),Hx=Symbol.for("react.provider"),Zx=Symbol.for("react.context"),xy=Symbol.for("react.forward_ref"),gg=Symbol.for("react.suspense"),yg=Symbol.for("react.suspense_list"),wy=Symbol.for("react.memo"),wl=Symbol.for("react.lazy"),Wx=Symbol.for("react.offscreen"),r0=Symbol.iterator;function Lh(n){return n===null||typeof n!="object"?null:(n=r0&&n[r0]||n["@@iterator"],typeof n=="function"?n:null)}var On=Object.assign,Om;function qh(n){if(Om===void 0)try{throw Error()}catch(o){var r=o.stack.trim().match(/\n( *(at )?)/);Om=r&&r[1]||""}return`
`+Om+n}var Fm=!1;function Bm(n,r){if(!n||Fm)return"";Fm=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(q){var c=q}Reflect.construct(n,[],r)}else{try{r.call()}catch(q){c=q}n.call(r.prototype)}else{try{throw Error()}catch(q){c=q}n()}}catch(q){if(q&&c&&typeof q.stack=="string"){for(var _=q.stack.split(`
`),b=c.stack.split(`
`),x=_.length-1,h=b.length-1;1<=x&&0<=h&&_[x]!==b[h];)h--;for(;1<=x&&0<=h;x--,h--)if(_[x]!==b[h]){if(x!==1||h!==1)do if(x--,h--,0>h||_[x]!==b[h]){var j=`
`+_[x].replace(" at new "," at ");return n.displayName&&j.includes("<anonymous>")&&(j=j.replace("<anonymous>",n.displayName)),j}while(1<=x&&0<=h);break}}}finally{Fm=!1,Error.prepareStackTrace=o}return(n=n?n.displayName||n.name:"")?qh(n):""}function PS(n){switch(n.tag){case 5:return qh(n.type);case 16:return qh("Lazy");case 13:return qh("Suspense");case 19:return qh("SuspenseList");case 0:case 2:case 15:return n=Bm(n.type,!1),n;case 11:return n=Bm(n.type.render,!1),n;case 1:return n=Bm(n.type,!0),n;default:return""}}function _g(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case vc:return"Fragment";case _c:return"Portal";case mg:return"Profiler";case vy:return"StrictMode";case gg:return"Suspense";case yg:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Zx:return(n.displayName||"Context")+".Consumer";case Hx:return(n._context.displayName||"Context")+".Provider";case xy:var r=n.render;return n=n.displayName,n||(n=r.displayName||r.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case wy:return r=n.displayName||null,r!==null?r:_g(n.type)||"Memo";case wl:r=n._payload,n=n._init;try{return _g(n(r))}catch{}}return null}function ES(n){var r=n.type;switch(n.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=r.render,n=n.displayName||n.name||"",r.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _g(r);case 8:return r===vy?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function jl(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Xx(n){var r=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function AS(n){var r=Xx(n)?"checked":"value",o=Object.getOwnPropertyDescriptor(n.constructor.prototype,r),c=""+n[r];if(!n.hasOwnProperty(r)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var _=o.get,b=o.set;return Object.defineProperty(n,r,{configurable:!0,get:function(){return _.call(this)},set:function(x){c=""+x,b.call(this,x)}}),Object.defineProperty(n,r,{enumerable:o.enumerable}),{getValue:function(){return c},setValue:function(x){c=""+x},stopTracking:function(){n._valueTracker=null,delete n[r]}}}}function sf(n){n._valueTracker||(n._valueTracker=AS(n))}function Yx(n){if(!n)return!1;var r=n._valueTracker;if(!r)return!0;var o=r.getValue(),c="";return n&&(c=Xx(n)?n.checked?"true":"false":n.value),n=c,n!==o?(r.setValue(n),!0):!1}function jf(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function vg(n,r){var o=r.checked;return On({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??n._wrapperState.initialChecked})}function n0(n,r){var o=r.defaultValue==null?"":r.defaultValue,c=r.checked!=null?r.checked:r.defaultChecked;o=jl(r.value!=null?r.value:o),n._wrapperState={initialChecked:c,initialValue:o,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function Jx(n,r){r=r.checked,r!=null&&_y(n,"checked",r,!1)}function xg(n,r){Jx(n,r);var o=jl(r.value),c=r.type;if(o!=null)c==="number"?(o===0&&n.value===""||n.value!=o)&&(n.value=""+o):n.value!==""+o&&(n.value=""+o);else if(c==="submit"||c==="reset"){n.removeAttribute("value");return}r.hasOwnProperty("value")?wg(n,r.type,o):r.hasOwnProperty("defaultValue")&&wg(n,r.type,jl(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(n.defaultChecked=!!r.defaultChecked)}function i0(n,r,o){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var c=r.type;if(!(c!=="submit"&&c!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+n._wrapperState.initialValue,o||r===n.value||(n.value=r),n.defaultValue=r}o=n.name,o!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,o!==""&&(n.name=o)}function wg(n,r,o){(r!=="number"||jf(n.ownerDocument)!==n)&&(o==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+o&&(n.defaultValue=""+o))}var Kh=Array.isArray;function Mc(n,r,o,c){if(n=n.options,r){r={};for(var _=0;_<o.length;_++)r["$"+o[_]]=!0;for(o=0;o<n.length;o++)_=r.hasOwnProperty("$"+n[o].value),n[o].selected!==_&&(n[o].selected=_),_&&c&&(n[o].defaultSelected=!0)}else{for(o=""+jl(o),r=null,_=0;_<n.length;_++){if(n[_].value===o){n[_].selected=!0,c&&(n[_].defaultSelected=!0);return}r!==null||n[_].disabled||(r=n[_])}r!==null&&(r.selected=!0)}}function bg(n,r){if(r.dangerouslySetInnerHTML!=null)throw Error(ht(91));return On({},r,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function a0(n,r){var o=r.value;if(o==null){if(o=r.children,r=r.defaultValue,o!=null){if(r!=null)throw Error(ht(92));if(Kh(o)){if(1<o.length)throw Error(ht(93));o=o[0]}r=o}r==null&&(r=""),o=r}n._wrapperState={initialValue:jl(o)}}function Qx(n,r){var o=jl(r.value),c=jl(r.defaultValue);o!=null&&(o=""+o,o!==n.value&&(n.value=o),r.defaultValue==null&&n.defaultValue!==o&&(n.defaultValue=o)),c!=null&&(n.defaultValue=""+c)}function s0(n){var r=n.textContent;r===n._wrapperState.initialValue&&r!==""&&r!==null&&(n.value=r)}function e1(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Sg(n,r){return n==null||n==="http://www.w3.org/1999/xhtml"?e1(r):n==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var of,t1=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,o,c,_){MSApp.execUnsafeLocalFunction(function(){return n(r,o,c,_)})}:n}(function(n,r){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=r;else{for(of=of||document.createElement("div"),of.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=of.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;r.firstChild;)n.appendChild(r.firstChild)}});function ad(n,r){if(r){var o=n.firstChild;if(o&&o===n.lastChild&&o.nodeType===3){o.nodeValue=r;return}}n.textContent=r}var Zh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},MS=["Webkit","ms","Moz","O"];Object.keys(Zh).forEach(function(n){MS.forEach(function(r){r=r+n.charAt(0).toUpperCase()+n.substring(1),Zh[r]=Zh[n]})});function r1(n,r,o){return r==null||typeof r=="boolean"||r===""?"":o||typeof r!="number"||r===0||Zh.hasOwnProperty(n)&&Zh[n]?(""+r).trim():r+"px"}function n1(n,r){n=n.style;for(var o in r)if(r.hasOwnProperty(o)){var c=o.indexOf("--")===0,_=r1(o,r[o],c);o==="float"&&(o="cssFloat"),c?n.setProperty(o,_):n[o]=_}}var DS=On({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function kg(n,r){if(r){if(DS[n]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(ht(137,n));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(ht(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(ht(61))}if(r.style!=null&&typeof r.style!="object")throw Error(ht(62))}}function Cg(n,r){if(n.indexOf("-")===-1)return typeof r.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Tg=null;function by(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Ig=null,Dc=null,zc=null;function o0(n){if(n=Cd(n)){if(typeof Ig!="function")throw Error(ht(280));var r=n.stateNode;r&&(r=bp(r),Ig(n.stateNode,n.type,r))}}function i1(n){Dc?zc?zc.push(n):zc=[n]:Dc=n}function a1(){if(Dc){var n=Dc,r=zc;if(zc=Dc=null,o0(n),r)for(n=0;n<r.length;n++)o0(r[n])}}function s1(n,r){return n(r)}function o1(){}var Nm=!1;function l1(n,r,o){if(Nm)return n(r,o);Nm=!0;try{return s1(n,r,o)}finally{Nm=!1,(Dc!==null||zc!==null)&&(o1(),a1())}}function sd(n,r){var o=n.stateNode;if(o===null)return null;var c=bp(o);if(c===null)return null;o=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(n=n.type,c=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!c;break e;default:n=!1}if(n)return null;if(o&&typeof o!="function")throw Error(ht(231,r,typeof o));return o}var Pg=!1;if(No)try{var Rh={};Object.defineProperty(Rh,"passive",{get:function(){Pg=!0}}),window.addEventListener("test",Rh,Rh),window.removeEventListener("test",Rh,Rh)}catch{Pg=!1}function zS(n,r,o,c,_,b,x,h,j){var q=Array.prototype.slice.call(arguments,3);try{r.apply(o,q)}catch(le){this.onError(le)}}var Wh=!1,Uf=null,Vf=!1,Eg=null,LS={onError:function(n){Wh=!0,Uf=n}};function RS(n,r,o,c,_,b,x,h,j){Wh=!1,Uf=null,zS.apply(LS,arguments)}function OS(n,r,o,c,_,b,x,h,j){if(RS.apply(this,arguments),Wh){if(Wh){var q=Uf;Wh=!1,Uf=null}else throw Error(ht(198));Vf||(Vf=!0,Eg=q)}}function Ou(n){var r=n,o=n;if(n.alternate)for(;r.return;)r=r.return;else{n=r;do r=n,r.flags&4098&&(o=r.return),n=r.return;while(n)}return r.tag===3?o:null}function u1(n){if(n.tag===13){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function l0(n){if(Ou(n)!==n)throw Error(ht(188))}function FS(n){var r=n.alternate;if(!r){if(r=Ou(n),r===null)throw Error(ht(188));return r!==n?null:n}for(var o=n,c=r;;){var _=o.return;if(_===null)break;var b=_.alternate;if(b===null){if(c=_.return,c!==null){o=c;continue}break}if(_.child===b.child){for(b=_.child;b;){if(b===o)return l0(_),n;if(b===c)return l0(_),r;b=b.sibling}throw Error(ht(188))}if(o.return!==c.return)o=_,c=b;else{for(var x=!1,h=_.child;h;){if(h===o){x=!0,o=_,c=b;break}if(h===c){x=!0,c=_,o=b;break}h=h.sibling}if(!x){for(h=b.child;h;){if(h===o){x=!0,o=b,c=_;break}if(h===c){x=!0,c=b,o=_;break}h=h.sibling}if(!x)throw Error(ht(189))}}if(o.alternate!==c)throw Error(ht(190))}if(o.tag!==3)throw Error(ht(188));return o.stateNode.current===o?n:r}function c1(n){return n=FS(n),n!==null?h1(n):null}function h1(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var r=h1(n);if(r!==null)return r;n=n.sibling}return null}var d1=Ha.unstable_scheduleCallback,u0=Ha.unstable_cancelCallback,BS=Ha.unstable_shouldYield,NS=Ha.unstable_requestPaint,Kn=Ha.unstable_now,jS=Ha.unstable_getCurrentPriorityLevel,Sy=Ha.unstable_ImmediatePriority,f1=Ha.unstable_UserBlockingPriority,$f=Ha.unstable_NormalPriority,US=Ha.unstable_LowPriority,p1=Ha.unstable_IdlePriority,_p=null,oo=null;function VS(n){if(oo&&typeof oo.onCommitFiberRoot=="function")try{oo.onCommitFiberRoot(_p,n,void 0,(n.current.flags&128)===128)}catch{}}var Ls=Math.clz32?Math.clz32:KS,$S=Math.log,qS=Math.LN2;function KS(n){return n>>>=0,n===0?32:31-($S(n)/qS|0)|0}var lf=64,uf=4194304;function Gh(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function qf(n,r){var o=n.pendingLanes;if(o===0)return 0;var c=0,_=n.suspendedLanes,b=n.pingedLanes,x=o&268435455;if(x!==0){var h=x&~_;h!==0?c=Gh(h):(b&=x,b!==0&&(c=Gh(b)))}else x=o&~_,x!==0?c=Gh(x):b!==0&&(c=Gh(b));if(c===0)return 0;if(r!==0&&r!==c&&!(r&_)&&(_=c&-c,b=r&-r,_>=b||_===16&&(b&4194240)!==0))return r;if(c&4&&(c|=o&16),r=n.entangledLanes,r!==0)for(n=n.entanglements,r&=c;0<r;)o=31-Ls(r),_=1<<o,c|=n[o],r&=~_;return c}function GS(n,r){switch(n){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function HS(n,r){for(var o=n.suspendedLanes,c=n.pingedLanes,_=n.expirationTimes,b=n.pendingLanes;0<b;){var x=31-Ls(b),h=1<<x,j=_[x];j===-1?(!(h&o)||h&c)&&(_[x]=GS(h,r)):j<=r&&(n.expiredLanes|=h),b&=~h}}function Ag(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function m1(){var n=lf;return lf<<=1,!(lf&4194240)&&(lf=64),n}function jm(n){for(var r=[],o=0;31>o;o++)r.push(n);return r}function Sd(n,r,o){n.pendingLanes|=r,r!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,r=31-Ls(r),n[r]=o}function ZS(n,r){var o=n.pendingLanes&~r;n.pendingLanes=r,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=r,n.mutableReadLanes&=r,n.entangledLanes&=r,r=n.entanglements;var c=n.eventTimes;for(n=n.expirationTimes;0<o;){var _=31-Ls(o),b=1<<_;r[_]=0,c[_]=-1,n[_]=-1,o&=~b}}function ky(n,r){var o=n.entangledLanes|=r;for(n=n.entanglements;o;){var c=31-Ls(o),_=1<<c;_&r|n[c]&r&&(n[c]|=r),o&=~_}}var rn=0;function g1(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var y1,Cy,_1,v1,x1,Mg=!1,cf=[],Ml=null,Dl=null,zl=null,od=new Map,ld=new Map,Sl=[],WS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function c0(n,r){switch(n){case"focusin":case"focusout":Ml=null;break;case"dragenter":case"dragleave":Dl=null;break;case"mouseover":case"mouseout":zl=null;break;case"pointerover":case"pointerout":od.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":ld.delete(r.pointerId)}}function Oh(n,r,o,c,_,b){return n===null||n.nativeEvent!==b?(n={blockedOn:r,domEventName:o,eventSystemFlags:c,nativeEvent:b,targetContainers:[_]},r!==null&&(r=Cd(r),r!==null&&Cy(r)),n):(n.eventSystemFlags|=c,r=n.targetContainers,_!==null&&r.indexOf(_)===-1&&r.push(_),n)}function XS(n,r,o,c,_){switch(r){case"focusin":return Ml=Oh(Ml,n,r,o,c,_),!0;case"dragenter":return Dl=Oh(Dl,n,r,o,c,_),!0;case"mouseover":return zl=Oh(zl,n,r,o,c,_),!0;case"pointerover":var b=_.pointerId;return od.set(b,Oh(od.get(b)||null,n,r,o,c,_)),!0;case"gotpointercapture":return b=_.pointerId,ld.set(b,Oh(ld.get(b)||null,n,r,o,c,_)),!0}return!1}function w1(n){var r=_u(n.target);if(r!==null){var o=Ou(r);if(o!==null){if(r=o.tag,r===13){if(r=u1(o),r!==null){n.blockedOn=r,x1(n.priority,function(){_1(o)});return}}else if(r===3&&o.stateNode.current.memoizedState.isDehydrated){n.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Pf(n){if(n.blockedOn!==null)return!1;for(var r=n.targetContainers;0<r.length;){var o=Dg(n.domEventName,n.eventSystemFlags,r[0],n.nativeEvent);if(o===null){o=n.nativeEvent;var c=new o.constructor(o.type,o);Tg=c,o.target.dispatchEvent(c),Tg=null}else return r=Cd(o),r!==null&&Cy(r),n.blockedOn=o,!1;r.shift()}return!0}function h0(n,r,o){Pf(n)&&o.delete(r)}function YS(){Mg=!1,Ml!==null&&Pf(Ml)&&(Ml=null),Dl!==null&&Pf(Dl)&&(Dl=null),zl!==null&&Pf(zl)&&(zl=null),od.forEach(h0),ld.forEach(h0)}function Fh(n,r){n.blockedOn===r&&(n.blockedOn=null,Mg||(Mg=!0,Ha.unstable_scheduleCallback(Ha.unstable_NormalPriority,YS)))}function ud(n){function r(_){return Fh(_,n)}if(0<cf.length){Fh(cf[0],n);for(var o=1;o<cf.length;o++){var c=cf[o];c.blockedOn===n&&(c.blockedOn=null)}}for(Ml!==null&&Fh(Ml,n),Dl!==null&&Fh(Dl,n),zl!==null&&Fh(zl,n),od.forEach(r),ld.forEach(r),o=0;o<Sl.length;o++)c=Sl[o],c.blockedOn===n&&(c.blockedOn=null);for(;0<Sl.length&&(o=Sl[0],o.blockedOn===null);)w1(o),o.blockedOn===null&&Sl.shift()}var Lc=$o.ReactCurrentBatchConfig,Kf=!0;function JS(n,r,o,c){var _=rn,b=Lc.transition;Lc.transition=null;try{rn=1,Ty(n,r,o,c)}finally{rn=_,Lc.transition=b}}function QS(n,r,o,c){var _=rn,b=Lc.transition;Lc.transition=null;try{rn=4,Ty(n,r,o,c)}finally{rn=_,Lc.transition=b}}function Ty(n,r,o,c){if(Kf){var _=Dg(n,r,o,c);if(_===null)Xm(n,r,c,Gf,o),c0(n,c);else if(XS(_,n,r,o,c))c.stopPropagation();else if(c0(n,c),r&4&&-1<WS.indexOf(n)){for(;_!==null;){var b=Cd(_);if(b!==null&&y1(b),b=Dg(n,r,o,c),b===null&&Xm(n,r,c,Gf,o),b===_)break;_=b}_!==null&&c.stopPropagation()}else Xm(n,r,c,null,o)}}var Gf=null;function Dg(n,r,o,c){if(Gf=null,n=by(c),n=_u(n),n!==null)if(r=Ou(n),r===null)n=null;else if(o=r.tag,o===13){if(n=u1(r),n!==null)return n;n=null}else if(o===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null);return Gf=n,null}function b1(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(jS()){case Sy:return 1;case f1:return 4;case $f:case US:return 16;case p1:return 536870912;default:return 16}default:return 16}}var Cl=null,Iy=null,Ef=null;function S1(){if(Ef)return Ef;var n,r=Iy,o=r.length,c,_="value"in Cl?Cl.value:Cl.textContent,b=_.length;for(n=0;n<o&&r[n]===_[n];n++);var x=o-n;for(c=1;c<=x&&r[o-c]===_[b-c];c++);return Ef=_.slice(n,1<c?1-c:void 0)}function Af(n){var r=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&r===13&&(n=13)):n=r,n===10&&(n=13),32<=n||n===13?n:0}function hf(){return!0}function d0(){return!1}function Wa(n){function r(o,c,_,b,x){this._reactName=o,this._targetInst=_,this.type=c,this.nativeEvent=b,this.target=x,this.currentTarget=null;for(var h in n)n.hasOwnProperty(h)&&(o=n[h],this[h]=o?o(b):b[h]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?hf:d0,this.isPropagationStopped=d0,this}return On(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=hf)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=hf)},persist:function(){},isPersistent:hf}),r}var Gc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Py=Wa(Gc),kd=On({},Gc,{view:0,detail:0}),ek=Wa(kd),Um,Vm,Bh,vp=On({},kd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ey,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Bh&&(Bh&&n.type==="mousemove"?(Um=n.screenX-Bh.screenX,Vm=n.screenY-Bh.screenY):Vm=Um=0,Bh=n),Um)},movementY:function(n){return"movementY"in n?n.movementY:Vm}}),f0=Wa(vp),tk=On({},vp,{dataTransfer:0}),rk=Wa(tk),nk=On({},kd,{relatedTarget:0}),$m=Wa(nk),ik=On({},Gc,{animationName:0,elapsedTime:0,pseudoElement:0}),ak=Wa(ik),sk=On({},Gc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),ok=Wa(sk),lk=On({},Gc,{data:0}),p0=Wa(lk),uk={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ck={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hk={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dk(n){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(n):(n=hk[n])?!!r[n]:!1}function Ey(){return dk}var fk=On({},kd,{key:function(n){if(n.key){var r=uk[n.key]||n.key;if(r!=="Unidentified")return r}return n.type==="keypress"?(n=Af(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?ck[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ey,charCode:function(n){return n.type==="keypress"?Af(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Af(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),pk=Wa(fk),mk=On({},vp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),m0=Wa(mk),gk=On({},kd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ey}),yk=Wa(gk),_k=On({},Gc,{propertyName:0,elapsedTime:0,pseudoElement:0}),vk=Wa(_k),xk=On({},vp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),wk=Wa(xk),bk=[9,13,27,32],Ay=No&&"CompositionEvent"in window,Xh=null;No&&"documentMode"in document&&(Xh=document.documentMode);var Sk=No&&"TextEvent"in window&&!Xh,k1=No&&(!Ay||Xh&&8<Xh&&11>=Xh),g0=" ",y0=!1;function C1(n,r){switch(n){case"keyup":return bk.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function T1(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var xc=!1;function kk(n,r){switch(n){case"compositionend":return T1(r);case"keypress":return r.which!==32?null:(y0=!0,g0);case"textInput":return n=r.data,n===g0&&y0?null:n;default:return null}}function Ck(n,r){if(xc)return n==="compositionend"||!Ay&&C1(n,r)?(n=S1(),Ef=Iy=Cl=null,xc=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return k1&&r.locale!=="ko"?null:r.data;default:return null}}var Tk={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _0(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r==="input"?!!Tk[n.type]:r==="textarea"}function I1(n,r,o,c){i1(c),r=Hf(r,"onChange"),0<r.length&&(o=new Py("onChange","change",null,o,c),n.push({event:o,listeners:r}))}var Yh=null,cd=null;function Ik(n){B1(n,0)}function xp(n){var r=Sc(n);if(Yx(r))return n}function Pk(n,r){if(n==="change")return r}var P1=!1;if(No){var qm;if(No){var Km="oninput"in document;if(!Km){var v0=document.createElement("div");v0.setAttribute("oninput","return;"),Km=typeof v0.oninput=="function"}qm=Km}else qm=!1;P1=qm&&(!document.documentMode||9<document.documentMode)}function x0(){Yh&&(Yh.detachEvent("onpropertychange",E1),cd=Yh=null)}function E1(n){if(n.propertyName==="value"&&xp(cd)){var r=[];I1(r,cd,n,by(n)),l1(Ik,r)}}function Ek(n,r,o){n==="focusin"?(x0(),Yh=r,cd=o,Yh.attachEvent("onpropertychange",E1)):n==="focusout"&&x0()}function Ak(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return xp(cd)}function Mk(n,r){if(n==="click")return xp(r)}function Dk(n,r){if(n==="input"||n==="change")return xp(r)}function zk(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var Os=typeof Object.is=="function"?Object.is:zk;function hd(n,r){if(Os(n,r))return!0;if(typeof n!="object"||n===null||typeof r!="object"||r===null)return!1;var o=Object.keys(n),c=Object.keys(r);if(o.length!==c.length)return!1;for(c=0;c<o.length;c++){var _=o[c];if(!pg.call(r,_)||!Os(n[_],r[_]))return!1}return!0}function w0(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function b0(n,r){var o=w0(n);n=0;for(var c;o;){if(o.nodeType===3){if(c=n+o.textContent.length,n<=r&&c>=r)return{node:o,offset:r-n};n=c}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=w0(o)}}function A1(n,r){return n&&r?n===r?!0:n&&n.nodeType===3?!1:r&&r.nodeType===3?A1(n,r.parentNode):"contains"in n?n.contains(r):n.compareDocumentPosition?!!(n.compareDocumentPosition(r)&16):!1:!1}function M1(){for(var n=window,r=jf();r instanceof n.HTMLIFrameElement;){try{var o=typeof r.contentWindow.location.href=="string"}catch{o=!1}if(o)n=r.contentWindow;else break;r=jf(n.document)}return r}function My(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r&&(r==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||r==="textarea"||n.contentEditable==="true")}function Lk(n){var r=M1(),o=n.focusedElem,c=n.selectionRange;if(r!==o&&o&&o.ownerDocument&&A1(o.ownerDocument.documentElement,o)){if(c!==null&&My(o)){if(r=c.start,n=c.end,n===void 0&&(n=r),"selectionStart"in o)o.selectionStart=r,o.selectionEnd=Math.min(n,o.value.length);else if(n=(r=o.ownerDocument||document)&&r.defaultView||window,n.getSelection){n=n.getSelection();var _=o.textContent.length,b=Math.min(c.start,_);c=c.end===void 0?b:Math.min(c.end,_),!n.extend&&b>c&&(_=c,c=b,b=_),_=b0(o,b);var x=b0(o,c);_&&x&&(n.rangeCount!==1||n.anchorNode!==_.node||n.anchorOffset!==_.offset||n.focusNode!==x.node||n.focusOffset!==x.offset)&&(r=r.createRange(),r.setStart(_.node,_.offset),n.removeAllRanges(),b>c?(n.addRange(r),n.extend(x.node,x.offset)):(r.setEnd(x.node,x.offset),n.addRange(r)))}}for(r=[],n=o;n=n.parentNode;)n.nodeType===1&&r.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<r.length;o++)n=r[o],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Rk=No&&"documentMode"in document&&11>=document.documentMode,wc=null,zg=null,Jh=null,Lg=!1;function S0(n,r,o){var c=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Lg||wc==null||wc!==jf(c)||(c=wc,"selectionStart"in c&&My(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Jh&&hd(Jh,c)||(Jh=c,c=Hf(zg,"onSelect"),0<c.length&&(r=new Py("onSelect","select",null,r,o),n.push({event:r,listeners:c}),r.target=wc)))}function df(n,r){var o={};return o[n.toLowerCase()]=r.toLowerCase(),o["Webkit"+n]="webkit"+r,o["Moz"+n]="moz"+r,o}var bc={animationend:df("Animation","AnimationEnd"),animationiteration:df("Animation","AnimationIteration"),animationstart:df("Animation","AnimationStart"),transitionend:df("Transition","TransitionEnd")},Gm={},D1={};No&&(D1=document.createElement("div").style,"AnimationEvent"in window||(delete bc.animationend.animation,delete bc.animationiteration.animation,delete bc.animationstart.animation),"TransitionEvent"in window||delete bc.transitionend.transition);function wp(n){if(Gm[n])return Gm[n];if(!bc[n])return n;var r=bc[n],o;for(o in r)if(r.hasOwnProperty(o)&&o in D1)return Gm[n]=r[o];return n}var z1=wp("animationend"),L1=wp("animationiteration"),R1=wp("animationstart"),O1=wp("transitionend"),F1=new Map,k0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Vl(n,r){F1.set(n,r),Ru(r,[n])}for(var Hm=0;Hm<k0.length;Hm++){var Zm=k0[Hm],Ok=Zm.toLowerCase(),Fk=Zm[0].toUpperCase()+Zm.slice(1);Vl(Ok,"on"+Fk)}Vl(z1,"onAnimationEnd");Vl(L1,"onAnimationIteration");Vl(R1,"onAnimationStart");Vl("dblclick","onDoubleClick");Vl("focusin","onFocus");Vl("focusout","onBlur");Vl(O1,"onTransitionEnd");Bc("onMouseEnter",["mouseout","mouseover"]);Bc("onMouseLeave",["mouseout","mouseover"]);Bc("onPointerEnter",["pointerout","pointerover"]);Bc("onPointerLeave",["pointerout","pointerover"]);Ru("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ru("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ru("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ru("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ru("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ru("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Bk=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hh));function C0(n,r,o){var c=n.type||"unknown-event";n.currentTarget=o,OS(c,r,void 0,n),n.currentTarget=null}function B1(n,r){r=(r&4)!==0;for(var o=0;o<n.length;o++){var c=n[o],_=c.event;c=c.listeners;e:{var b=void 0;if(r)for(var x=c.length-1;0<=x;x--){var h=c[x],j=h.instance,q=h.currentTarget;if(h=h.listener,j!==b&&_.isPropagationStopped())break e;C0(_,h,q),b=j}else for(x=0;x<c.length;x++){if(h=c[x],j=h.instance,q=h.currentTarget,h=h.listener,j!==b&&_.isPropagationStopped())break e;C0(_,h,q),b=j}}}if(Vf)throw n=Eg,Vf=!1,Eg=null,n}function wn(n,r){var o=r[Ng];o===void 0&&(o=r[Ng]=new Set);var c=n+"__bubble";o.has(c)||(N1(r,n,2,!1),o.add(c))}function Wm(n,r,o){var c=0;r&&(c|=4),N1(o,n,c,r)}var ff="_reactListening"+Math.random().toString(36).slice(2);function dd(n){if(!n[ff]){n[ff]=!0,Gx.forEach(function(o){o!=="selectionchange"&&(Bk.has(o)||Wm(o,!1,n),Wm(o,!0,n))});var r=n.nodeType===9?n:n.ownerDocument;r===null||r[ff]||(r[ff]=!0,Wm("selectionchange",!1,r))}}function N1(n,r,o,c){switch(b1(r)){case 1:var _=JS;break;case 4:_=QS;break;default:_=Ty}o=_.bind(null,r,o,n),_=void 0,!Pg||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(_=!0),c?_!==void 0?n.addEventListener(r,o,{capture:!0,passive:_}):n.addEventListener(r,o,!0):_!==void 0?n.addEventListener(r,o,{passive:_}):n.addEventListener(r,o,!1)}function Xm(n,r,o,c,_){var b=c;if(!(r&1)&&!(r&2)&&c!==null)e:for(;;){if(c===null)return;var x=c.tag;if(x===3||x===4){var h=c.stateNode.containerInfo;if(h===_||h.nodeType===8&&h.parentNode===_)break;if(x===4)for(x=c.return;x!==null;){var j=x.tag;if((j===3||j===4)&&(j=x.stateNode.containerInfo,j===_||j.nodeType===8&&j.parentNode===_))return;x=x.return}for(;h!==null;){if(x=_u(h),x===null)return;if(j=x.tag,j===5||j===6){c=b=x;continue e}h=h.parentNode}}c=c.return}l1(function(){var q=b,le=by(o),Y=[];e:{var W=F1.get(n);if(W!==void 0){var $e=Py,He=n;switch(n){case"keypress":if(Af(o)===0)break e;case"keydown":case"keyup":$e=pk;break;case"focusin":He="focus",$e=$m;break;case"focusout":He="blur",$e=$m;break;case"beforeblur":case"afterblur":$e=$m;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$e=f0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$e=rk;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$e=yk;break;case z1:case L1:case R1:$e=ak;break;case O1:$e=vk;break;case"scroll":$e=ek;break;case"wheel":$e=wk;break;case"copy":case"cut":case"paste":$e=ok;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$e=m0}var Je=(r&4)!==0,Qt=!Je&&n==="scroll",be=Je?W!==null?W+"Capture":null:W;Je=[];for(var pe=q,ke;pe!==null;){ke=pe;var Ve=ke.stateNode;if(ke.tag===5&&Ve!==null&&(ke=Ve,be!==null&&(Ve=sd(pe,be),Ve!=null&&Je.push(fd(pe,Ve,ke)))),Qt)break;pe=pe.return}0<Je.length&&(W=new $e(W,He,null,o,le),Y.push({event:W,listeners:Je}))}}if(!(r&7)){e:{if(W=n==="mouseover"||n==="pointerover",$e=n==="mouseout"||n==="pointerout",W&&o!==Tg&&(He=o.relatedTarget||o.fromElement)&&(_u(He)||He[jo]))break e;if(($e||W)&&(W=le.window===le?le:(W=le.ownerDocument)?W.defaultView||W.parentWindow:window,$e?(He=o.relatedTarget||o.toElement,$e=q,He=He?_u(He):null,He!==null&&(Qt=Ou(He),He!==Qt||He.tag!==5&&He.tag!==6)&&(He=null)):($e=null,He=q),$e!==He)){if(Je=f0,Ve="onMouseLeave",be="onMouseEnter",pe="mouse",(n==="pointerout"||n==="pointerover")&&(Je=m0,Ve="onPointerLeave",be="onPointerEnter",pe="pointer"),Qt=$e==null?W:Sc($e),ke=He==null?W:Sc(He),W=new Je(Ve,pe+"leave",$e,o,le),W.target=Qt,W.relatedTarget=ke,Ve=null,_u(le)===q&&(Je=new Je(be,pe+"enter",He,o,le),Je.target=ke,Je.relatedTarget=Qt,Ve=Je),Qt=Ve,$e&&He)t:{for(Je=$e,be=He,pe=0,ke=Je;ke;ke=gc(ke))pe++;for(ke=0,Ve=be;Ve;Ve=gc(Ve))ke++;for(;0<pe-ke;)Je=gc(Je),pe--;for(;0<ke-pe;)be=gc(be),ke--;for(;pe--;){if(Je===be||be!==null&&Je===be.alternate)break t;Je=gc(Je),be=gc(be)}Je=null}else Je=null;$e!==null&&T0(Y,W,$e,Je,!1),He!==null&&Qt!==null&&T0(Y,Qt,He,Je,!0)}}e:{if(W=q?Sc(q):window,$e=W.nodeName&&W.nodeName.toLowerCase(),$e==="select"||$e==="input"&&W.type==="file")var et=Pk;else if(_0(W))if(P1)et=Dk;else{et=Ak;var ut=Ek}else($e=W.nodeName)&&$e.toLowerCase()==="input"&&(W.type==="checkbox"||W.type==="radio")&&(et=Mk);if(et&&(et=et(n,q))){I1(Y,et,o,le);break e}ut&&ut(n,W,q),n==="focusout"&&(ut=W._wrapperState)&&ut.controlled&&W.type==="number"&&wg(W,"number",W.value)}switch(ut=q?Sc(q):window,n){case"focusin":(_0(ut)||ut.contentEditable==="true")&&(wc=ut,zg=q,Jh=null);break;case"focusout":Jh=zg=wc=null;break;case"mousedown":Lg=!0;break;case"contextmenu":case"mouseup":case"dragend":Lg=!1,S0(Y,o,le);break;case"selectionchange":if(Rk)break;case"keydown":case"keyup":S0(Y,o,le)}var Qe;if(Ay)e:{switch(n){case"compositionstart":var ce="onCompositionStart";break e;case"compositionend":ce="onCompositionEnd";break e;case"compositionupdate":ce="onCompositionUpdate";break e}ce=void 0}else xc?C1(n,o)&&(ce="onCompositionEnd"):n==="keydown"&&o.keyCode===229&&(ce="onCompositionStart");ce&&(k1&&o.locale!=="ko"&&(xc||ce!=="onCompositionStart"?ce==="onCompositionEnd"&&xc&&(Qe=S1()):(Cl=le,Iy="value"in Cl?Cl.value:Cl.textContent,xc=!0)),ut=Hf(q,ce),0<ut.length&&(ce=new p0(ce,n,null,o,le),Y.push({event:ce,listeners:ut}),Qe?ce.data=Qe:(Qe=T1(o),Qe!==null&&(ce.data=Qe)))),(Qe=Sk?kk(n,o):Ck(n,o))&&(q=Hf(q,"onBeforeInput"),0<q.length&&(le=new p0("onBeforeInput","beforeinput",null,o,le),Y.push({event:le,listeners:q}),le.data=Qe))}B1(Y,r)})}function fd(n,r,o){return{instance:n,listener:r,currentTarget:o}}function Hf(n,r){for(var o=r+"Capture",c=[];n!==null;){var _=n,b=_.stateNode;_.tag===5&&b!==null&&(_=b,b=sd(n,o),b!=null&&c.unshift(fd(n,b,_)),b=sd(n,r),b!=null&&c.push(fd(n,b,_))),n=n.return}return c}function gc(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function T0(n,r,o,c,_){for(var b=r._reactName,x=[];o!==null&&o!==c;){var h=o,j=h.alternate,q=h.stateNode;if(j!==null&&j===c)break;h.tag===5&&q!==null&&(h=q,_?(j=sd(o,b),j!=null&&x.unshift(fd(o,j,h))):_||(j=sd(o,b),j!=null&&x.push(fd(o,j,h)))),o=o.return}x.length!==0&&n.push({event:r,listeners:x})}var Nk=/\r\n?/g,jk=/\u0000|\uFFFD/g;function I0(n){return(typeof n=="string"?n:""+n).replace(Nk,`
`).replace(jk,"")}function pf(n,r,o){if(r=I0(r),I0(n)!==r&&o)throw Error(ht(425))}function Zf(){}var Rg=null,Og=null;function Fg(n,r){return n==="textarea"||n==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Bg=typeof setTimeout=="function"?setTimeout:void 0,Uk=typeof clearTimeout=="function"?clearTimeout:void 0,P0=typeof Promise=="function"?Promise:void 0,Vk=typeof queueMicrotask=="function"?queueMicrotask:typeof P0<"u"?function(n){return P0.resolve(null).then(n).catch($k)}:Bg;function $k(n){setTimeout(function(){throw n})}function Ym(n,r){var o=r,c=0;do{var _=o.nextSibling;if(n.removeChild(o),_&&_.nodeType===8)if(o=_.data,o==="/$"){if(c===0){n.removeChild(_),ud(r);return}c--}else o!=="$"&&o!=="$?"&&o!=="$!"||c++;o=_}while(o);ud(r)}function Ll(n){for(;n!=null;n=n.nextSibling){var r=n.nodeType;if(r===1||r===3)break;if(r===8){if(r=n.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return n}function E0(n){n=n.previousSibling;for(var r=0;n;){if(n.nodeType===8){var o=n.data;if(o==="$"||o==="$!"||o==="$?"){if(r===0)return n;r--}else o==="/$"&&r++}n=n.previousSibling}return null}var Hc=Math.random().toString(36).slice(2),so="__reactFiber$"+Hc,pd="__reactProps$"+Hc,jo="__reactContainer$"+Hc,Ng="__reactEvents$"+Hc,qk="__reactListeners$"+Hc,Kk="__reactHandles$"+Hc;function _u(n){var r=n[so];if(r)return r;for(var o=n.parentNode;o;){if(r=o[jo]||o[so]){if(o=r.alternate,r.child!==null||o!==null&&o.child!==null)for(n=E0(n);n!==null;){if(o=n[so])return o;n=E0(n)}return r}n=o,o=n.parentNode}return null}function Cd(n){return n=n[so]||n[jo],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Sc(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(ht(33))}function bp(n){return n[pd]||null}var jg=[],kc=-1;function $l(n){return{current:n}}function bn(n){0>kc||(n.current=jg[kc],jg[kc]=null,kc--)}function yn(n,r){kc++,jg[kc]=n.current,n.current=r}var Ul={},Wi=$l(Ul),Ta=$l(!1),Tu=Ul;function Nc(n,r){var o=n.type.contextTypes;if(!o)return Ul;var c=n.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===r)return c.__reactInternalMemoizedMaskedChildContext;var _={},b;for(b in o)_[b]=r[b];return c&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=_),_}function Ia(n){return n=n.childContextTypes,n!=null}function Wf(){bn(Ta),bn(Wi)}function A0(n,r,o){if(Wi.current!==Ul)throw Error(ht(168));yn(Wi,r),yn(Ta,o)}function j1(n,r,o){var c=n.stateNode;if(r=r.childContextTypes,typeof c.getChildContext!="function")return o;c=c.getChildContext();for(var _ in c)if(!(_ in r))throw Error(ht(108,ES(n)||"Unknown",_));return On({},o,c)}function Xf(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Ul,Tu=Wi.current,yn(Wi,n),yn(Ta,Ta.current),!0}function M0(n,r,o){var c=n.stateNode;if(!c)throw Error(ht(169));o?(n=j1(n,r,Tu),c.__reactInternalMemoizedMergedChildContext=n,bn(Ta),bn(Wi),yn(Wi,n)):bn(Ta),yn(Ta,o)}var Ro=null,Sp=!1,Jm=!1;function U1(n){Ro===null?Ro=[n]:Ro.push(n)}function Gk(n){Sp=!0,U1(n)}function ql(){if(!Jm&&Ro!==null){Jm=!0;var n=0,r=rn;try{var o=Ro;for(rn=1;n<o.length;n++){var c=o[n];do c=c(!0);while(c!==null)}Ro=null,Sp=!1}catch(_){throw Ro!==null&&(Ro=Ro.slice(n+1)),d1(Sy,ql),_}finally{rn=r,Jm=!1}}return null}var Cc=[],Tc=0,Yf=null,Jf=0,ds=[],fs=0,Iu=null,Oo=1,Fo="";function mu(n,r){Cc[Tc++]=Jf,Cc[Tc++]=Yf,Yf=n,Jf=r}function V1(n,r,o){ds[fs++]=Oo,ds[fs++]=Fo,ds[fs++]=Iu,Iu=n;var c=Oo;n=Fo;var _=32-Ls(c)-1;c&=~(1<<_),o+=1;var b=32-Ls(r)+_;if(30<b){var x=_-_%5;b=(c&(1<<x)-1).toString(32),c>>=x,_-=x,Oo=1<<32-Ls(r)+_|o<<_|c,Fo=b+n}else Oo=1<<b|o<<_|c,Fo=n}function Dy(n){n.return!==null&&(mu(n,1),V1(n,1,0))}function zy(n){for(;n===Yf;)Yf=Cc[--Tc],Cc[Tc]=null,Jf=Cc[--Tc],Cc[Tc]=null;for(;n===Iu;)Iu=ds[--fs],ds[fs]=null,Fo=ds[--fs],ds[fs]=null,Oo=ds[--fs],ds[fs]=null}var Ga=null,Ka=null,En=!1,Ds=null;function $1(n,r){var o=ps(5,null,null,0);o.elementType="DELETED",o.stateNode=r,o.return=n,r=n.deletions,r===null?(n.deletions=[o],n.flags|=16):r.push(o)}function D0(n,r){switch(n.tag){case 5:var o=n.type;return r=r.nodeType!==1||o.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(n.stateNode=r,Ga=n,Ka=Ll(r.firstChild),!0):!1;case 6:return r=n.pendingProps===""||r.nodeType!==3?null:r,r!==null?(n.stateNode=r,Ga=n,Ka=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(o=Iu!==null?{id:Oo,overflow:Fo}:null,n.memoizedState={dehydrated:r,treeContext:o,retryLane:1073741824},o=ps(18,null,null,0),o.stateNode=r,o.return=n,n.child=o,Ga=n,Ka=null,!0):!1;default:return!1}}function Ug(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Vg(n){if(En){var r=Ka;if(r){var o=r;if(!D0(n,r)){if(Ug(n))throw Error(ht(418));r=Ll(o.nextSibling);var c=Ga;r&&D0(n,r)?$1(c,o):(n.flags=n.flags&-4097|2,En=!1,Ga=n)}}else{if(Ug(n))throw Error(ht(418));n.flags=n.flags&-4097|2,En=!1,Ga=n}}}function z0(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Ga=n}function mf(n){if(n!==Ga)return!1;if(!En)return z0(n),En=!0,!1;var r;if((r=n.tag!==3)&&!(r=n.tag!==5)&&(r=n.type,r=r!=="head"&&r!=="body"&&!Fg(n.type,n.memoizedProps)),r&&(r=Ka)){if(Ug(n))throw q1(),Error(ht(418));for(;r;)$1(n,r),r=Ll(r.nextSibling)}if(z0(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(ht(317));e:{for(n=n.nextSibling,r=0;n;){if(n.nodeType===8){var o=n.data;if(o==="/$"){if(r===0){Ka=Ll(n.nextSibling);break e}r--}else o!=="$"&&o!=="$!"&&o!=="$?"||r++}n=n.nextSibling}Ka=null}}else Ka=Ga?Ll(n.stateNode.nextSibling):null;return!0}function q1(){for(var n=Ka;n;)n=Ll(n.nextSibling)}function jc(){Ka=Ga=null,En=!1}function Ly(n){Ds===null?Ds=[n]:Ds.push(n)}var Hk=$o.ReactCurrentBatchConfig;function Nh(n,r,o){if(n=o.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(ht(309));var c=o.stateNode}if(!c)throw Error(ht(147,n));var _=c,b=""+n;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===b?r.ref:(r=function(x){var h=_.refs;x===null?delete h[b]:h[b]=x},r._stringRef=b,r)}if(typeof n!="string")throw Error(ht(284));if(!o._owner)throw Error(ht(290,n))}return n}function gf(n,r){throw n=Object.prototype.toString.call(r),Error(ht(31,n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n))}function L0(n){var r=n._init;return r(n._payload)}function K1(n){function r(be,pe){if(n){var ke=be.deletions;ke===null?(be.deletions=[pe],be.flags|=16):ke.push(pe)}}function o(be,pe){if(!n)return null;for(;pe!==null;)r(be,pe),pe=pe.sibling;return null}function c(be,pe){for(be=new Map;pe!==null;)pe.key!==null?be.set(pe.key,pe):be.set(pe.index,pe),pe=pe.sibling;return be}function _(be,pe){return be=Bl(be,pe),be.index=0,be.sibling=null,be}function b(be,pe,ke){return be.index=ke,n?(ke=be.alternate,ke!==null?(ke=ke.index,ke<pe?(be.flags|=2,pe):ke):(be.flags|=2,pe)):(be.flags|=1048576,pe)}function x(be){return n&&be.alternate===null&&(be.flags|=2),be}function h(be,pe,ke,Ve){return pe===null||pe.tag!==6?(pe=ag(ke,be.mode,Ve),pe.return=be,pe):(pe=_(pe,ke),pe.return=be,pe)}function j(be,pe,ke,Ve){var et=ke.type;return et===vc?le(be,pe,ke.props.children,Ve,ke.key):pe!==null&&(pe.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===wl&&L0(et)===pe.type)?(Ve=_(pe,ke.props),Ve.ref=Nh(be,pe,ke),Ve.return=be,Ve):(Ve=Ff(ke.type,ke.key,ke.props,null,be.mode,Ve),Ve.ref=Nh(be,pe,ke),Ve.return=be,Ve)}function q(be,pe,ke,Ve){return pe===null||pe.tag!==4||pe.stateNode.containerInfo!==ke.containerInfo||pe.stateNode.implementation!==ke.implementation?(pe=sg(ke,be.mode,Ve),pe.return=be,pe):(pe=_(pe,ke.children||[]),pe.return=be,pe)}function le(be,pe,ke,Ve,et){return pe===null||pe.tag!==7?(pe=Cu(ke,be.mode,Ve,et),pe.return=be,pe):(pe=_(pe,ke),pe.return=be,pe)}function Y(be,pe,ke){if(typeof pe=="string"&&pe!==""||typeof pe=="number")return pe=ag(""+pe,be.mode,ke),pe.return=be,pe;if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case af:return ke=Ff(pe.type,pe.key,pe.props,null,be.mode,ke),ke.ref=Nh(be,null,pe),ke.return=be,ke;case _c:return pe=sg(pe,be.mode,ke),pe.return=be,pe;case wl:var Ve=pe._init;return Y(be,Ve(pe._payload),ke)}if(Kh(pe)||Lh(pe))return pe=Cu(pe,be.mode,ke,null),pe.return=be,pe;gf(be,pe)}return null}function W(be,pe,ke,Ve){var et=pe!==null?pe.key:null;if(typeof ke=="string"&&ke!==""||typeof ke=="number")return et!==null?null:h(be,pe,""+ke,Ve);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case af:return ke.key===et?j(be,pe,ke,Ve):null;case _c:return ke.key===et?q(be,pe,ke,Ve):null;case wl:return et=ke._init,W(be,pe,et(ke._payload),Ve)}if(Kh(ke)||Lh(ke))return et!==null?null:le(be,pe,ke,Ve,null);gf(be,ke)}return null}function $e(be,pe,ke,Ve,et){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return be=be.get(ke)||null,h(pe,be,""+Ve,et);if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case af:return be=be.get(Ve.key===null?ke:Ve.key)||null,j(pe,be,Ve,et);case _c:return be=be.get(Ve.key===null?ke:Ve.key)||null,q(pe,be,Ve,et);case wl:var ut=Ve._init;return $e(be,pe,ke,ut(Ve._payload),et)}if(Kh(Ve)||Lh(Ve))return be=be.get(ke)||null,le(pe,be,Ve,et,null);gf(pe,Ve)}return null}function He(be,pe,ke,Ve){for(var et=null,ut=null,Qe=pe,ce=pe=0,me=null;Qe!==null&&ce<ke.length;ce++){Qe.index>ce?(me=Qe,Qe=null):me=Qe.sibling;var Le=W(be,Qe,ke[ce],Ve);if(Le===null){Qe===null&&(Qe=me);break}n&&Qe&&Le.alternate===null&&r(be,Qe),pe=b(Le,pe,ce),ut===null?et=Le:ut.sibling=Le,ut=Le,Qe=me}if(ce===ke.length)return o(be,Qe),En&&mu(be,ce),et;if(Qe===null){for(;ce<ke.length;ce++)Qe=Y(be,ke[ce],Ve),Qe!==null&&(pe=b(Qe,pe,ce),ut===null?et=Qe:ut.sibling=Qe,ut=Qe);return En&&mu(be,ce),et}for(Qe=c(be,Qe);ce<ke.length;ce++)me=$e(Qe,be,ce,ke[ce],Ve),me!==null&&(n&&me.alternate!==null&&Qe.delete(me.key===null?ce:me.key),pe=b(me,pe,ce),ut===null?et=me:ut.sibling=me,ut=me);return n&&Qe.forEach(function(Ye){return r(be,Ye)}),En&&mu(be,ce),et}function Je(be,pe,ke,Ve){var et=Lh(ke);if(typeof et!="function")throw Error(ht(150));if(ke=et.call(ke),ke==null)throw Error(ht(151));for(var ut=et=null,Qe=pe,ce=pe=0,me=null,Le=ke.next();Qe!==null&&!Le.done;ce++,Le=ke.next()){Qe.index>ce?(me=Qe,Qe=null):me=Qe.sibling;var Ye=W(be,Qe,Le.value,Ve);if(Ye===null){Qe===null&&(Qe=me);break}n&&Qe&&Ye.alternate===null&&r(be,Qe),pe=b(Ye,pe,ce),ut===null?et=Ye:ut.sibling=Ye,ut=Ye,Qe=me}if(Le.done)return o(be,Qe),En&&mu(be,ce),et;if(Qe===null){for(;!Le.done;ce++,Le=ke.next())Le=Y(be,Le.value,Ve),Le!==null&&(pe=b(Le,pe,ce),ut===null?et=Le:ut.sibling=Le,ut=Le);return En&&mu(be,ce),et}for(Qe=c(be,Qe);!Le.done;ce++,Le=ke.next())Le=$e(Qe,be,ce,Le.value,Ve),Le!==null&&(n&&Le.alternate!==null&&Qe.delete(Le.key===null?ce:Le.key),pe=b(Le,pe,ce),ut===null?et=Le:ut.sibling=Le,ut=Le);return n&&Qe.forEach(function(Tt){return r(be,Tt)}),En&&mu(be,ce),et}function Qt(be,pe,ke,Ve){if(typeof ke=="object"&&ke!==null&&ke.type===vc&&ke.key===null&&(ke=ke.props.children),typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case af:e:{for(var et=ke.key,ut=pe;ut!==null;){if(ut.key===et){if(et=ke.type,et===vc){if(ut.tag===7){o(be,ut.sibling),pe=_(ut,ke.props.children),pe.return=be,be=pe;break e}}else if(ut.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===wl&&L0(et)===ut.type){o(be,ut.sibling),pe=_(ut,ke.props),pe.ref=Nh(be,ut,ke),pe.return=be,be=pe;break e}o(be,ut);break}else r(be,ut);ut=ut.sibling}ke.type===vc?(pe=Cu(ke.props.children,be.mode,Ve,ke.key),pe.return=be,be=pe):(Ve=Ff(ke.type,ke.key,ke.props,null,be.mode,Ve),Ve.ref=Nh(be,pe,ke),Ve.return=be,be=Ve)}return x(be);case _c:e:{for(ut=ke.key;pe!==null;){if(pe.key===ut)if(pe.tag===4&&pe.stateNode.containerInfo===ke.containerInfo&&pe.stateNode.implementation===ke.implementation){o(be,pe.sibling),pe=_(pe,ke.children||[]),pe.return=be,be=pe;break e}else{o(be,pe);break}else r(be,pe);pe=pe.sibling}pe=sg(ke,be.mode,Ve),pe.return=be,be=pe}return x(be);case wl:return ut=ke._init,Qt(be,pe,ut(ke._payload),Ve)}if(Kh(ke))return He(be,pe,ke,Ve);if(Lh(ke))return Je(be,pe,ke,Ve);gf(be,ke)}return typeof ke=="string"&&ke!==""||typeof ke=="number"?(ke=""+ke,pe!==null&&pe.tag===6?(o(be,pe.sibling),pe=_(pe,ke),pe.return=be,be=pe):(o(be,pe),pe=ag(ke,be.mode,Ve),pe.return=be,be=pe),x(be)):o(be,pe)}return Qt}var Uc=K1(!0),G1=K1(!1),Qf=$l(null),ep=null,Ic=null,Ry=null;function Oy(){Ry=Ic=ep=null}function Fy(n){var r=Qf.current;bn(Qf),n._currentValue=r}function $g(n,r,o){for(;n!==null;){var c=n.alternate;if((n.childLanes&r)!==r?(n.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),n===o)break;n=n.return}}function Rc(n,r){ep=n,Ry=Ic=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&r&&(Ca=!0),n.firstContext=null)}function gs(n){var r=n._currentValue;if(Ry!==n)if(n={context:n,memoizedValue:r,next:null},Ic===null){if(ep===null)throw Error(ht(308));Ic=n,ep.dependencies={lanes:0,firstContext:n}}else Ic=Ic.next=n;return r}var vu=null;function By(n){vu===null?vu=[n]:vu.push(n)}function H1(n,r,o,c){var _=r.interleaved;return _===null?(o.next=o,By(r)):(o.next=_.next,_.next=o),r.interleaved=o,Uo(n,c)}function Uo(n,r){n.lanes|=r;var o=n.alternate;for(o!==null&&(o.lanes|=r),o=n,n=n.return;n!==null;)n.childLanes|=r,o=n.alternate,o!==null&&(o.childLanes|=r),o=n,n=n.return;return o.tag===3?o.stateNode:null}var bl=!1;function Ny(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Z1(n,r){n=n.updateQueue,r.updateQueue===n&&(r.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Bo(n,r){return{eventTime:n,lane:r,tag:0,payload:null,callback:null,next:null}}function Rl(n,r,o){var c=n.updateQueue;if(c===null)return null;if(c=c.shared,qr&2){var _=c.pending;return _===null?r.next=r:(r.next=_.next,_.next=r),c.pending=r,Uo(n,o)}return _=c.interleaved,_===null?(r.next=r,By(c)):(r.next=_.next,_.next=r),c.interleaved=r,Uo(n,o)}function Mf(n,r,o){if(r=r.updateQueue,r!==null&&(r=r.shared,(o&4194240)!==0)){var c=r.lanes;c&=n.pendingLanes,o|=c,r.lanes=o,ky(n,o)}}function R0(n,r){var o=n.updateQueue,c=n.alternate;if(c!==null&&(c=c.updateQueue,o===c)){var _=null,b=null;if(o=o.firstBaseUpdate,o!==null){do{var x={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};b===null?_=b=x:b=b.next=x,o=o.next}while(o!==null);b===null?_=b=r:b=b.next=r}else _=b=r;o={baseState:c.baseState,firstBaseUpdate:_,lastBaseUpdate:b,shared:c.shared,effects:c.effects},n.updateQueue=o;return}n=o.lastBaseUpdate,n===null?o.firstBaseUpdate=r:n.next=r,o.lastBaseUpdate=r}function tp(n,r,o,c){var _=n.updateQueue;bl=!1;var b=_.firstBaseUpdate,x=_.lastBaseUpdate,h=_.shared.pending;if(h!==null){_.shared.pending=null;var j=h,q=j.next;j.next=null,x===null?b=q:x.next=q,x=j;var le=n.alternate;le!==null&&(le=le.updateQueue,h=le.lastBaseUpdate,h!==x&&(h===null?le.firstBaseUpdate=q:h.next=q,le.lastBaseUpdate=j))}if(b!==null){var Y=_.baseState;x=0,le=q=j=null,h=b;do{var W=h.lane,$e=h.eventTime;if((c&W)===W){le!==null&&(le=le.next={eventTime:$e,lane:0,tag:h.tag,payload:h.payload,callback:h.callback,next:null});e:{var He=n,Je=h;switch(W=r,$e=o,Je.tag){case 1:if(He=Je.payload,typeof He=="function"){Y=He.call($e,Y,W);break e}Y=He;break e;case 3:He.flags=He.flags&-65537|128;case 0:if(He=Je.payload,W=typeof He=="function"?He.call($e,Y,W):He,W==null)break e;Y=On({},Y,W);break e;case 2:bl=!0}}h.callback!==null&&h.lane!==0&&(n.flags|=64,W=_.effects,W===null?_.effects=[h]:W.push(h))}else $e={eventTime:$e,lane:W,tag:h.tag,payload:h.payload,callback:h.callback,next:null},le===null?(q=le=$e,j=Y):le=le.next=$e,x|=W;if(h=h.next,h===null){if(h=_.shared.pending,h===null)break;W=h,h=W.next,W.next=null,_.lastBaseUpdate=W,_.shared.pending=null}}while(!0);if(le===null&&(j=Y),_.baseState=j,_.firstBaseUpdate=q,_.lastBaseUpdate=le,r=_.shared.interleaved,r!==null){_=r;do x|=_.lane,_=_.next;while(_!==r)}else b===null&&(_.shared.lanes=0);Eu|=x,n.lanes=x,n.memoizedState=Y}}function O0(n,r,o){if(n=r.effects,r.effects=null,n!==null)for(r=0;r<n.length;r++){var c=n[r],_=c.callback;if(_!==null){if(c.callback=null,c=o,typeof _!="function")throw Error(ht(191,_));_.call(c)}}}var Td={},lo=$l(Td),md=$l(Td),gd=$l(Td);function xu(n){if(n===Td)throw Error(ht(174));return n}function jy(n,r){switch(yn(gd,r),yn(md,n),yn(lo,Td),n=r.nodeType,n){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:Sg(null,"");break;default:n=n===8?r.parentNode:r,r=n.namespaceURI||null,n=n.tagName,r=Sg(r,n)}bn(lo),yn(lo,r)}function Vc(){bn(lo),bn(md),bn(gd)}function W1(n){xu(gd.current);var r=xu(lo.current),o=Sg(r,n.type);r!==o&&(yn(md,n),yn(lo,o))}function Uy(n){md.current===n&&(bn(lo),bn(md))}var Ln=$l(0);function rp(n){for(var r=n;r!==null;){if(r.tag===13){var o=r.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if(r.flags&128)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Qm=[];function Vy(){for(var n=0;n<Qm.length;n++)Qm[n]._workInProgressVersionPrimary=null;Qm.length=0}var Df=$o.ReactCurrentDispatcher,eg=$o.ReactCurrentBatchConfig,Pu=0,Rn=null,li=null,vi=null,np=!1,Qh=!1,yd=0,Zk=0;function Gi(){throw Error(ht(321))}function $y(n,r){if(r===null)return!1;for(var o=0;o<r.length&&o<n.length;o++)if(!Os(n[o],r[o]))return!1;return!0}function qy(n,r,o,c,_,b){if(Pu=b,Rn=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,Df.current=n===null||n.memoizedState===null?Jk:Qk,n=o(c,_),Qh){b=0;do{if(Qh=!1,yd=0,25<=b)throw Error(ht(301));b+=1,vi=li=null,r.updateQueue=null,Df.current=eC,n=o(c,_)}while(Qh)}if(Df.current=ip,r=li!==null&&li.next!==null,Pu=0,vi=li=Rn=null,np=!1,r)throw Error(ht(300));return n}function Ky(){var n=yd!==0;return yd=0,n}function ao(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vi===null?Rn.memoizedState=vi=n:vi=vi.next=n,vi}function ys(){if(li===null){var n=Rn.alternate;n=n!==null?n.memoizedState:null}else n=li.next;var r=vi===null?Rn.memoizedState:vi.next;if(r!==null)vi=r,li=n;else{if(n===null)throw Error(ht(310));li=n,n={memoizedState:li.memoizedState,baseState:li.baseState,baseQueue:li.baseQueue,queue:li.queue,next:null},vi===null?Rn.memoizedState=vi=n:vi=vi.next=n}return vi}function _d(n,r){return typeof r=="function"?r(n):r}function tg(n){var r=ys(),o=r.queue;if(o===null)throw Error(ht(311));o.lastRenderedReducer=n;var c=li,_=c.baseQueue,b=o.pending;if(b!==null){if(_!==null){var x=_.next;_.next=b.next,b.next=x}c.baseQueue=_=b,o.pending=null}if(_!==null){b=_.next,c=c.baseState;var h=x=null,j=null,q=b;do{var le=q.lane;if((Pu&le)===le)j!==null&&(j=j.next={lane:0,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),c=q.hasEagerState?q.eagerState:n(c,q.action);else{var Y={lane:le,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null};j===null?(h=j=Y,x=c):j=j.next=Y,Rn.lanes|=le,Eu|=le}q=q.next}while(q!==null&&q!==b);j===null?x=c:j.next=h,Os(c,r.memoizedState)||(Ca=!0),r.memoizedState=c,r.baseState=x,r.baseQueue=j,o.lastRenderedState=c}if(n=o.interleaved,n!==null){_=n;do b=_.lane,Rn.lanes|=b,Eu|=b,_=_.next;while(_!==n)}else _===null&&(o.lanes=0);return[r.memoizedState,o.dispatch]}function rg(n){var r=ys(),o=r.queue;if(o===null)throw Error(ht(311));o.lastRenderedReducer=n;var c=o.dispatch,_=o.pending,b=r.memoizedState;if(_!==null){o.pending=null;var x=_=_.next;do b=n(b,x.action),x=x.next;while(x!==_);Os(b,r.memoizedState)||(Ca=!0),r.memoizedState=b,r.baseQueue===null&&(r.baseState=b),o.lastRenderedState=b}return[b,c]}function X1(){}function Y1(n,r){var o=Rn,c=ys(),_=r(),b=!Os(c.memoizedState,_);if(b&&(c.memoizedState=_,Ca=!0),c=c.queue,Gy(ew.bind(null,o,c,n),[n]),c.getSnapshot!==r||b||vi!==null&&vi.memoizedState.tag&1){if(o.flags|=2048,vd(9,Q1.bind(null,o,c,_,r),void 0,null),xi===null)throw Error(ht(349));Pu&30||J1(o,r,_)}return _}function J1(n,r,o){n.flags|=16384,n={getSnapshot:r,value:o},r=Rn.updateQueue,r===null?(r={lastEffect:null,stores:null},Rn.updateQueue=r,r.stores=[n]):(o=r.stores,o===null?r.stores=[n]:o.push(n))}function Q1(n,r,o,c){r.value=o,r.getSnapshot=c,tw(r)&&rw(n)}function ew(n,r,o){return o(function(){tw(r)&&rw(n)})}function tw(n){var r=n.getSnapshot;n=n.value;try{var o=r();return!Os(n,o)}catch{return!0}}function rw(n){var r=Uo(n,1);r!==null&&Rs(r,n,1,-1)}function F0(n){var r=ao();return typeof n=="function"&&(n=n()),r.memoizedState=r.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_d,lastRenderedState:n},r.queue=n,n=n.dispatch=Yk.bind(null,Rn,n),[r.memoizedState,n]}function vd(n,r,o,c){return n={tag:n,create:r,destroy:o,deps:c,next:null},r=Rn.updateQueue,r===null?(r={lastEffect:null,stores:null},Rn.updateQueue=r,r.lastEffect=n.next=n):(o=r.lastEffect,o===null?r.lastEffect=n.next=n:(c=o.next,o.next=n,n.next=c,r.lastEffect=n)),n}function nw(){return ys().memoizedState}function zf(n,r,o,c){var _=ao();Rn.flags|=n,_.memoizedState=vd(1|r,o,void 0,c===void 0?null:c)}function kp(n,r,o,c){var _=ys();c=c===void 0?null:c;var b=void 0;if(li!==null){var x=li.memoizedState;if(b=x.destroy,c!==null&&$y(c,x.deps)){_.memoizedState=vd(r,o,b,c);return}}Rn.flags|=n,_.memoizedState=vd(1|r,o,b,c)}function B0(n,r){return zf(8390656,8,n,r)}function Gy(n,r){return kp(2048,8,n,r)}function iw(n,r){return kp(4,2,n,r)}function aw(n,r){return kp(4,4,n,r)}function sw(n,r){if(typeof r=="function")return n=n(),r(n),function(){r(null)};if(r!=null)return n=n(),r.current=n,function(){r.current=null}}function ow(n,r,o){return o=o!=null?o.concat([n]):null,kp(4,4,sw.bind(null,r,n),o)}function Hy(){}function lw(n,r){var o=ys();r=r===void 0?null:r;var c=o.memoizedState;return c!==null&&r!==null&&$y(r,c[1])?c[0]:(o.memoizedState=[n,r],n)}function uw(n,r){var o=ys();r=r===void 0?null:r;var c=o.memoizedState;return c!==null&&r!==null&&$y(r,c[1])?c[0]:(n=n(),o.memoizedState=[n,r],n)}function cw(n,r,o){return Pu&21?(Os(o,r)||(o=m1(),Rn.lanes|=o,Eu|=o,n.baseState=!0),r):(n.baseState&&(n.baseState=!1,Ca=!0),n.memoizedState=o)}function Wk(n,r){var o=rn;rn=o!==0&&4>o?o:4,n(!0);var c=eg.transition;eg.transition={};try{n(!1),r()}finally{rn=o,eg.transition=c}}function hw(){return ys().memoizedState}function Xk(n,r,o){var c=Fl(n);if(o={lane:c,action:o,hasEagerState:!1,eagerState:null,next:null},dw(n))fw(r,o);else if(o=H1(n,r,o,c),o!==null){var _=oa();Rs(o,n,c,_),pw(o,r,c)}}function Yk(n,r,o){var c=Fl(n),_={lane:c,action:o,hasEagerState:!1,eagerState:null,next:null};if(dw(n))fw(r,_);else{var b=n.alternate;if(n.lanes===0&&(b===null||b.lanes===0)&&(b=r.lastRenderedReducer,b!==null))try{var x=r.lastRenderedState,h=b(x,o);if(_.hasEagerState=!0,_.eagerState=h,Os(h,x)){var j=r.interleaved;j===null?(_.next=_,By(r)):(_.next=j.next,j.next=_),r.interleaved=_;return}}catch{}finally{}o=H1(n,r,_,c),o!==null&&(_=oa(),Rs(o,n,c,_),pw(o,r,c))}}function dw(n){var r=n.alternate;return n===Rn||r!==null&&r===Rn}function fw(n,r){Qh=np=!0;var o=n.pending;o===null?r.next=r:(r.next=o.next,o.next=r),n.pending=r}function pw(n,r,o){if(o&4194240){var c=r.lanes;c&=n.pendingLanes,o|=c,r.lanes=o,ky(n,o)}}var ip={readContext:gs,useCallback:Gi,useContext:Gi,useEffect:Gi,useImperativeHandle:Gi,useInsertionEffect:Gi,useLayoutEffect:Gi,useMemo:Gi,useReducer:Gi,useRef:Gi,useState:Gi,useDebugValue:Gi,useDeferredValue:Gi,useTransition:Gi,useMutableSource:Gi,useSyncExternalStore:Gi,useId:Gi,unstable_isNewReconciler:!1},Jk={readContext:gs,useCallback:function(n,r){return ao().memoizedState=[n,r===void 0?null:r],n},useContext:gs,useEffect:B0,useImperativeHandle:function(n,r,o){return o=o!=null?o.concat([n]):null,zf(4194308,4,sw.bind(null,r,n),o)},useLayoutEffect:function(n,r){return zf(4194308,4,n,r)},useInsertionEffect:function(n,r){return zf(4,2,n,r)},useMemo:function(n,r){var o=ao();return r=r===void 0?null:r,n=n(),o.memoizedState=[n,r],n},useReducer:function(n,r,o){var c=ao();return r=o!==void 0?o(r):r,c.memoizedState=c.baseState=r,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:r},c.queue=n,n=n.dispatch=Xk.bind(null,Rn,n),[c.memoizedState,n]},useRef:function(n){var r=ao();return n={current:n},r.memoizedState=n},useState:F0,useDebugValue:Hy,useDeferredValue:function(n){return ao().memoizedState=n},useTransition:function(){var n=F0(!1),r=n[0];return n=Wk.bind(null,n[1]),ao().memoizedState=n,[r,n]},useMutableSource:function(){},useSyncExternalStore:function(n,r,o){var c=Rn,_=ao();if(En){if(o===void 0)throw Error(ht(407));o=o()}else{if(o=r(),xi===null)throw Error(ht(349));Pu&30||J1(c,r,o)}_.memoizedState=o;var b={value:o,getSnapshot:r};return _.queue=b,B0(ew.bind(null,c,b,n),[n]),c.flags|=2048,vd(9,Q1.bind(null,c,b,o,r),void 0,null),o},useId:function(){var n=ao(),r=xi.identifierPrefix;if(En){var o=Fo,c=Oo;o=(c&~(1<<32-Ls(c)-1)).toString(32)+o,r=":"+r+"R"+o,o=yd++,0<o&&(r+="H"+o.toString(32)),r+=":"}else o=Zk++,r=":"+r+"r"+o.toString(32)+":";return n.memoizedState=r},unstable_isNewReconciler:!1},Qk={readContext:gs,useCallback:lw,useContext:gs,useEffect:Gy,useImperativeHandle:ow,useInsertionEffect:iw,useLayoutEffect:aw,useMemo:uw,useReducer:tg,useRef:nw,useState:function(){return tg(_d)},useDebugValue:Hy,useDeferredValue:function(n){var r=ys();return cw(r,li.memoizedState,n)},useTransition:function(){var n=tg(_d)[0],r=ys().memoizedState;return[n,r]},useMutableSource:X1,useSyncExternalStore:Y1,useId:hw,unstable_isNewReconciler:!1},eC={readContext:gs,useCallback:lw,useContext:gs,useEffect:Gy,useImperativeHandle:ow,useInsertionEffect:iw,useLayoutEffect:aw,useMemo:uw,useReducer:rg,useRef:nw,useState:function(){return rg(_d)},useDebugValue:Hy,useDeferredValue:function(n){var r=ys();return li===null?r.memoizedState=n:cw(r,li.memoizedState,n)},useTransition:function(){var n=rg(_d)[0],r=ys().memoizedState;return[n,r]},useMutableSource:X1,useSyncExternalStore:Y1,useId:hw,unstable_isNewReconciler:!1};function As(n,r){if(n&&n.defaultProps){r=On({},r),n=n.defaultProps;for(var o in n)r[o]===void 0&&(r[o]=n[o]);return r}return r}function qg(n,r,o,c){r=n.memoizedState,o=o(c,r),o=o==null?r:On({},r,o),n.memoizedState=o,n.lanes===0&&(n.updateQueue.baseState=o)}var Cp={isMounted:function(n){return(n=n._reactInternals)?Ou(n)===n:!1},enqueueSetState:function(n,r,o){n=n._reactInternals;var c=oa(),_=Fl(n),b=Bo(c,_);b.payload=r,o!=null&&(b.callback=o),r=Rl(n,b,_),r!==null&&(Rs(r,n,_,c),Mf(r,n,_))},enqueueReplaceState:function(n,r,o){n=n._reactInternals;var c=oa(),_=Fl(n),b=Bo(c,_);b.tag=1,b.payload=r,o!=null&&(b.callback=o),r=Rl(n,b,_),r!==null&&(Rs(r,n,_,c),Mf(r,n,_))},enqueueForceUpdate:function(n,r){n=n._reactInternals;var o=oa(),c=Fl(n),_=Bo(o,c);_.tag=2,r!=null&&(_.callback=r),r=Rl(n,_,c),r!==null&&(Rs(r,n,c,o),Mf(r,n,c))}};function N0(n,r,o,c,_,b,x){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(c,b,x):r.prototype&&r.prototype.isPureReactComponent?!hd(o,c)||!hd(_,b):!0}function mw(n,r,o){var c=!1,_=Ul,b=r.contextType;return typeof b=="object"&&b!==null?b=gs(b):(_=Ia(r)?Tu:Wi.current,c=r.contextTypes,b=(c=c!=null)?Nc(n,_):Ul),r=new r(o,b),n.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=Cp,n.stateNode=r,r._reactInternals=n,c&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=_,n.__reactInternalMemoizedMaskedChildContext=b),r}function j0(n,r,o,c){n=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(o,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(o,c),r.state!==n&&Cp.enqueueReplaceState(r,r.state,null)}function Kg(n,r,o,c){var _=n.stateNode;_.props=o,_.state=n.memoizedState,_.refs={},Ny(n);var b=r.contextType;typeof b=="object"&&b!==null?_.context=gs(b):(b=Ia(r)?Tu:Wi.current,_.context=Nc(n,b)),_.state=n.memoizedState,b=r.getDerivedStateFromProps,typeof b=="function"&&(qg(n,r,b,o),_.state=n.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(r=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),r!==_.state&&Cp.enqueueReplaceState(_,_.state,null),tp(n,o,_,c),_.state=n.memoizedState),typeof _.componentDidMount=="function"&&(n.flags|=4194308)}function $c(n,r){try{var o="",c=r;do o+=PS(c),c=c.return;while(c);var _=o}catch(b){_=`
Error generating stack: `+b.message+`
`+b.stack}return{value:n,source:r,stack:_,digest:null}}function ng(n,r,o){return{value:n,source:null,stack:o??null,digest:r??null}}function Gg(n,r){try{console.error(r.value)}catch(o){setTimeout(function(){throw o})}}var tC=typeof WeakMap=="function"?WeakMap:Map;function gw(n,r,o){o=Bo(-1,o),o.tag=3,o.payload={element:null};var c=r.value;return o.callback=function(){sp||(sp=!0,ry=c),Gg(n,r)},o}function yw(n,r,o){o=Bo(-1,o),o.tag=3;var c=n.type.getDerivedStateFromError;if(typeof c=="function"){var _=r.value;o.payload=function(){return c(_)},o.callback=function(){Gg(n,r)}}var b=n.stateNode;return b!==null&&typeof b.componentDidCatch=="function"&&(o.callback=function(){Gg(n,r),typeof c!="function"&&(Ol===null?Ol=new Set([this]):Ol.add(this));var x=r.stack;this.componentDidCatch(r.value,{componentStack:x!==null?x:""})}),o}function U0(n,r,o){var c=n.pingCache;if(c===null){c=n.pingCache=new tC;var _=new Set;c.set(r,_)}else _=c.get(r),_===void 0&&(_=new Set,c.set(r,_));_.has(o)||(_.add(o),n=mC.bind(null,n,r,o),r.then(n,n))}function V0(n){do{var r;if((r=n.tag===13)&&(r=n.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return n;n=n.return}while(n!==null);return null}function $0(n,r,o,c,_){return n.mode&1?(n.flags|=65536,n.lanes=_,n):(n===r?n.flags|=65536:(n.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(r=Bo(-1,1),r.tag=2,Rl(o,r,1))),o.lanes|=1),n)}var rC=$o.ReactCurrentOwner,Ca=!1;function sa(n,r,o,c){r.child=n===null?G1(r,null,o,c):Uc(r,n.child,o,c)}function q0(n,r,o,c,_){o=o.render;var b=r.ref;return Rc(r,_),c=qy(n,r,o,c,b,_),o=Ky(),n!==null&&!Ca?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~_,Vo(n,r,_)):(En&&o&&Dy(r),r.flags|=1,sa(n,r,c,_),r.child)}function K0(n,r,o,c,_){if(n===null){var b=o.type;return typeof b=="function"&&!t_(b)&&b.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(r.tag=15,r.type=b,_w(n,r,b,c,_)):(n=Ff(o.type,null,c,r,r.mode,_),n.ref=r.ref,n.return=r,r.child=n)}if(b=n.child,!(n.lanes&_)){var x=b.memoizedProps;if(o=o.compare,o=o!==null?o:hd,o(x,c)&&n.ref===r.ref)return Vo(n,r,_)}return r.flags|=1,n=Bl(b,c),n.ref=r.ref,n.return=r,r.child=n}function _w(n,r,o,c,_){if(n!==null){var b=n.memoizedProps;if(hd(b,c)&&n.ref===r.ref)if(Ca=!1,r.pendingProps=c=b,(n.lanes&_)!==0)n.flags&131072&&(Ca=!0);else return r.lanes=n.lanes,Vo(n,r,_)}return Hg(n,r,o,c,_)}function vw(n,r,o){var c=r.pendingProps,_=c.children,b=n!==null?n.memoizedState:null;if(c.mode==="hidden")if(!(r.mode&1))r.memoizedState={baseLanes:0,cachePool:null,transitions:null},yn(Ec,$a),$a|=o;else{if(!(o&1073741824))return n=b!==null?b.baseLanes|o:o,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:n,cachePool:null,transitions:null},r.updateQueue=null,yn(Ec,$a),$a|=n,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=b!==null?b.baseLanes:o,yn(Ec,$a),$a|=c}else b!==null?(c=b.baseLanes|o,r.memoizedState=null):c=o,yn(Ec,$a),$a|=c;return sa(n,r,_,o),r.child}function xw(n,r){var o=r.ref;(n===null&&o!==null||n!==null&&n.ref!==o)&&(r.flags|=512,r.flags|=2097152)}function Hg(n,r,o,c,_){var b=Ia(o)?Tu:Wi.current;return b=Nc(r,b),Rc(r,_),o=qy(n,r,o,c,b,_),c=Ky(),n!==null&&!Ca?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~_,Vo(n,r,_)):(En&&c&&Dy(r),r.flags|=1,sa(n,r,o,_),r.child)}function G0(n,r,o,c,_){if(Ia(o)){var b=!0;Xf(r)}else b=!1;if(Rc(r,_),r.stateNode===null)Lf(n,r),mw(r,o,c),Kg(r,o,c,_),c=!0;else if(n===null){var x=r.stateNode,h=r.memoizedProps;x.props=h;var j=x.context,q=o.contextType;typeof q=="object"&&q!==null?q=gs(q):(q=Ia(o)?Tu:Wi.current,q=Nc(r,q));var le=o.getDerivedStateFromProps,Y=typeof le=="function"||typeof x.getSnapshotBeforeUpdate=="function";Y||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(h!==c||j!==q)&&j0(r,x,c,q),bl=!1;var W=r.memoizedState;x.state=W,tp(r,c,x,_),j=r.memoizedState,h!==c||W!==j||Ta.current||bl?(typeof le=="function"&&(qg(r,o,le,c),j=r.memoizedState),(h=bl||N0(r,o,h,c,W,j,q))?(Y||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(r.flags|=4194308)):(typeof x.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=j),x.props=c,x.state=j,x.context=q,c=h):(typeof x.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{x=r.stateNode,Z1(n,r),h=r.memoizedProps,q=r.type===r.elementType?h:As(r.type,h),x.props=q,Y=r.pendingProps,W=x.context,j=o.contextType,typeof j=="object"&&j!==null?j=gs(j):(j=Ia(o)?Tu:Wi.current,j=Nc(r,j));var $e=o.getDerivedStateFromProps;(le=typeof $e=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(h!==Y||W!==j)&&j0(r,x,c,j),bl=!1,W=r.memoizedState,x.state=W,tp(r,c,x,_);var He=r.memoizedState;h!==Y||W!==He||Ta.current||bl?(typeof $e=="function"&&(qg(r,o,$e,c),He=r.memoizedState),(q=bl||N0(r,o,q,c,W,He,j)||!1)?(le||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(c,He,j),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(c,He,j)),typeof x.componentDidUpdate=="function"&&(r.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof x.componentDidUpdate!="function"||h===n.memoizedProps&&W===n.memoizedState||(r.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||h===n.memoizedProps&&W===n.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=He),x.props=c,x.state=He,x.context=j,c=q):(typeof x.componentDidUpdate!="function"||h===n.memoizedProps&&W===n.memoizedState||(r.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||h===n.memoizedProps&&W===n.memoizedState||(r.flags|=1024),c=!1)}return Zg(n,r,o,c,b,_)}function Zg(n,r,o,c,_,b){xw(n,r);var x=(r.flags&128)!==0;if(!c&&!x)return _&&M0(r,o,!1),Vo(n,r,b);c=r.stateNode,rC.current=r;var h=x&&typeof o.getDerivedStateFromError!="function"?null:c.render();return r.flags|=1,n!==null&&x?(r.child=Uc(r,n.child,null,b),r.child=Uc(r,null,h,b)):sa(n,r,h,b),r.memoizedState=c.state,_&&M0(r,o,!0),r.child}function ww(n){var r=n.stateNode;r.pendingContext?A0(n,r.pendingContext,r.pendingContext!==r.context):r.context&&A0(n,r.context,!1),jy(n,r.containerInfo)}function H0(n,r,o,c,_){return jc(),Ly(_),r.flags|=256,sa(n,r,o,c),r.child}var Wg={dehydrated:null,treeContext:null,retryLane:0};function Xg(n){return{baseLanes:n,cachePool:null,transitions:null}}function bw(n,r,o){var c=r.pendingProps,_=Ln.current,b=!1,x=(r.flags&128)!==0,h;if((h=x)||(h=n!==null&&n.memoizedState===null?!1:(_&2)!==0),h?(b=!0,r.flags&=-129):(n===null||n.memoizedState!==null)&&(_|=1),yn(Ln,_&1),n===null)return Vg(r),n=r.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(r.mode&1?n.data==="$!"?r.lanes=8:r.lanes=1073741824:r.lanes=1,null):(x=c.children,n=c.fallback,b?(c=r.mode,b=r.child,x={mode:"hidden",children:x},!(c&1)&&b!==null?(b.childLanes=0,b.pendingProps=x):b=Pp(x,c,0,null),n=Cu(n,c,o,null),b.return=r,n.return=r,b.sibling=n,r.child=b,r.child.memoizedState=Xg(o),r.memoizedState=Wg,n):Zy(r,x));if(_=n.memoizedState,_!==null&&(h=_.dehydrated,h!==null))return nC(n,r,x,c,h,_,o);if(b){b=c.fallback,x=r.mode,_=n.child,h=_.sibling;var j={mode:"hidden",children:c.children};return!(x&1)&&r.child!==_?(c=r.child,c.childLanes=0,c.pendingProps=j,r.deletions=null):(c=Bl(_,j),c.subtreeFlags=_.subtreeFlags&14680064),h!==null?b=Bl(h,b):(b=Cu(b,x,o,null),b.flags|=2),b.return=r,c.return=r,c.sibling=b,r.child=c,c=b,b=r.child,x=n.child.memoizedState,x=x===null?Xg(o):{baseLanes:x.baseLanes|o,cachePool:null,transitions:x.transitions},b.memoizedState=x,b.childLanes=n.childLanes&~o,r.memoizedState=Wg,c}return b=n.child,n=b.sibling,c=Bl(b,{mode:"visible",children:c.children}),!(r.mode&1)&&(c.lanes=o),c.return=r,c.sibling=null,n!==null&&(o=r.deletions,o===null?(r.deletions=[n],r.flags|=16):o.push(n)),r.child=c,r.memoizedState=null,c}function Zy(n,r){return r=Pp({mode:"visible",children:r},n.mode,0,null),r.return=n,n.child=r}function yf(n,r,o,c){return c!==null&&Ly(c),Uc(r,n.child,null,o),n=Zy(r,r.pendingProps.children),n.flags|=2,r.memoizedState=null,n}function nC(n,r,o,c,_,b,x){if(o)return r.flags&256?(r.flags&=-257,c=ng(Error(ht(422))),yf(n,r,x,c)):r.memoizedState!==null?(r.child=n.child,r.flags|=128,null):(b=c.fallback,_=r.mode,c=Pp({mode:"visible",children:c.children},_,0,null),b=Cu(b,_,x,null),b.flags|=2,c.return=r,b.return=r,c.sibling=b,r.child=c,r.mode&1&&Uc(r,n.child,null,x),r.child.memoizedState=Xg(x),r.memoizedState=Wg,b);if(!(r.mode&1))return yf(n,r,x,null);if(_.data==="$!"){if(c=_.nextSibling&&_.nextSibling.dataset,c)var h=c.dgst;return c=h,b=Error(ht(419)),c=ng(b,c,void 0),yf(n,r,x,c)}if(h=(x&n.childLanes)!==0,Ca||h){if(c=xi,c!==null){switch(x&-x){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(c.suspendedLanes|x)?0:_,_!==0&&_!==b.retryLane&&(b.retryLane=_,Uo(n,_),Rs(c,n,_,-1))}return e_(),c=ng(Error(ht(421))),yf(n,r,x,c)}return _.data==="$?"?(r.flags|=128,r.child=n.child,r=gC.bind(null,n),_._reactRetry=r,null):(n=b.treeContext,Ka=Ll(_.nextSibling),Ga=r,En=!0,Ds=null,n!==null&&(ds[fs++]=Oo,ds[fs++]=Fo,ds[fs++]=Iu,Oo=n.id,Fo=n.overflow,Iu=r),r=Zy(r,c.children),r.flags|=4096,r)}function Z0(n,r,o){n.lanes|=r;var c=n.alternate;c!==null&&(c.lanes|=r),$g(n.return,r,o)}function ig(n,r,o,c,_){var b=n.memoizedState;b===null?n.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:o,tailMode:_}:(b.isBackwards=r,b.rendering=null,b.renderingStartTime=0,b.last=c,b.tail=o,b.tailMode=_)}function Sw(n,r,o){var c=r.pendingProps,_=c.revealOrder,b=c.tail;if(sa(n,r,c.children,o),c=Ln.current,c&2)c=c&1|2,r.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=r.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Z0(n,o,r);else if(n.tag===19)Z0(n,o,r);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break e;for(;n.sibling===null;){if(n.return===null||n.return===r)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}c&=1}if(yn(Ln,c),!(r.mode&1))r.memoizedState=null;else switch(_){case"forwards":for(o=r.child,_=null;o!==null;)n=o.alternate,n!==null&&rp(n)===null&&(_=o),o=o.sibling;o=_,o===null?(_=r.child,r.child=null):(_=o.sibling,o.sibling=null),ig(r,!1,_,o,b);break;case"backwards":for(o=null,_=r.child,r.child=null;_!==null;){if(n=_.alternate,n!==null&&rp(n)===null){r.child=_;break}n=_.sibling,_.sibling=o,o=_,_=n}ig(r,!0,o,null,b);break;case"together":ig(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Lf(n,r){!(r.mode&1)&&n!==null&&(n.alternate=null,r.alternate=null,r.flags|=2)}function Vo(n,r,o){if(n!==null&&(r.dependencies=n.dependencies),Eu|=r.lanes,!(o&r.childLanes))return null;if(n!==null&&r.child!==n.child)throw Error(ht(153));if(r.child!==null){for(n=r.child,o=Bl(n,n.pendingProps),r.child=o,o.return=r;n.sibling!==null;)n=n.sibling,o=o.sibling=Bl(n,n.pendingProps),o.return=r;o.sibling=null}return r.child}function iC(n,r,o){switch(r.tag){case 3:ww(r),jc();break;case 5:W1(r);break;case 1:Ia(r.type)&&Xf(r);break;case 4:jy(r,r.stateNode.containerInfo);break;case 10:var c=r.type._context,_=r.memoizedProps.value;yn(Qf,c._currentValue),c._currentValue=_;break;case 13:if(c=r.memoizedState,c!==null)return c.dehydrated!==null?(yn(Ln,Ln.current&1),r.flags|=128,null):o&r.child.childLanes?bw(n,r,o):(yn(Ln,Ln.current&1),n=Vo(n,r,o),n!==null?n.sibling:null);yn(Ln,Ln.current&1);break;case 19:if(c=(o&r.childLanes)!==0,n.flags&128){if(c)return Sw(n,r,o);r.flags|=128}if(_=r.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),yn(Ln,Ln.current),c)break;return null;case 22:case 23:return r.lanes=0,vw(n,r,o)}return Vo(n,r,o)}var kw,Yg,Cw,Tw;kw=function(n,r){for(var o=r.child;o!==null;){if(o.tag===5||o.tag===6)n.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};Yg=function(){};Cw=function(n,r,o,c){var _=n.memoizedProps;if(_!==c){n=r.stateNode,xu(lo.current);var b=null;switch(o){case"input":_=vg(n,_),c=vg(n,c),b=[];break;case"select":_=On({},_,{value:void 0}),c=On({},c,{value:void 0}),b=[];break;case"textarea":_=bg(n,_),c=bg(n,c),b=[];break;default:typeof _.onClick!="function"&&typeof c.onClick=="function"&&(n.onclick=Zf)}kg(o,c);var x;o=null;for(q in _)if(!c.hasOwnProperty(q)&&_.hasOwnProperty(q)&&_[q]!=null)if(q==="style"){var h=_[q];for(x in h)h.hasOwnProperty(x)&&(o||(o={}),o[x]="")}else q!=="dangerouslySetInnerHTML"&&q!=="children"&&q!=="suppressContentEditableWarning"&&q!=="suppressHydrationWarning"&&q!=="autoFocus"&&(id.hasOwnProperty(q)?b||(b=[]):(b=b||[]).push(q,null));for(q in c){var j=c[q];if(h=_?.[q],c.hasOwnProperty(q)&&j!==h&&(j!=null||h!=null))if(q==="style")if(h){for(x in h)!h.hasOwnProperty(x)||j&&j.hasOwnProperty(x)||(o||(o={}),o[x]="");for(x in j)j.hasOwnProperty(x)&&h[x]!==j[x]&&(o||(o={}),o[x]=j[x])}else o||(b||(b=[]),b.push(q,o)),o=j;else q==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,h=h?h.__html:void 0,j!=null&&h!==j&&(b=b||[]).push(q,j)):q==="children"?typeof j!="string"&&typeof j!="number"||(b=b||[]).push(q,""+j):q!=="suppressContentEditableWarning"&&q!=="suppressHydrationWarning"&&(id.hasOwnProperty(q)?(j!=null&&q==="onScroll"&&wn("scroll",n),b||h===j||(b=[])):(b=b||[]).push(q,j))}o&&(b=b||[]).push("style",o);var q=b;(r.updateQueue=q)&&(r.flags|=4)}};Tw=function(n,r,o,c){o!==c&&(r.flags|=4)};function jh(n,r){if(!En)switch(n.tailMode){case"hidden":r=n.tail;for(var o=null;r!==null;)r.alternate!==null&&(o=r),r=r.sibling;o===null?n.tail=null:o.sibling=null;break;case"collapsed":o=n.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?r||n.tail===null?n.tail=null:n.tail.sibling=null:c.sibling=null}}function Hi(n){var r=n.alternate!==null&&n.alternate.child===n.child,o=0,c=0;if(r)for(var _=n.child;_!==null;)o|=_.lanes|_.childLanes,c|=_.subtreeFlags&14680064,c|=_.flags&14680064,_.return=n,_=_.sibling;else for(_=n.child;_!==null;)o|=_.lanes|_.childLanes,c|=_.subtreeFlags,c|=_.flags,_.return=n,_=_.sibling;return n.subtreeFlags|=c,n.childLanes=o,r}function aC(n,r,o){var c=r.pendingProps;switch(zy(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hi(r),null;case 1:return Ia(r.type)&&Wf(),Hi(r),null;case 3:return c=r.stateNode,Vc(),bn(Ta),bn(Wi),Vy(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(n===null||n.child===null)&&(mf(r)?r.flags|=4:n===null||n.memoizedState.isDehydrated&&!(r.flags&256)||(r.flags|=1024,Ds!==null&&(ay(Ds),Ds=null))),Yg(n,r),Hi(r),null;case 5:Uy(r);var _=xu(gd.current);if(o=r.type,n!==null&&r.stateNode!=null)Cw(n,r,o,c,_),n.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!c){if(r.stateNode===null)throw Error(ht(166));return Hi(r),null}if(n=xu(lo.current),mf(r)){c=r.stateNode,o=r.type;var b=r.memoizedProps;switch(c[so]=r,c[pd]=b,n=(r.mode&1)!==0,o){case"dialog":wn("cancel",c),wn("close",c);break;case"iframe":case"object":case"embed":wn("load",c);break;case"video":case"audio":for(_=0;_<Hh.length;_++)wn(Hh[_],c);break;case"source":wn("error",c);break;case"img":case"image":case"link":wn("error",c),wn("load",c);break;case"details":wn("toggle",c);break;case"input":n0(c,b),wn("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!b.multiple},wn("invalid",c);break;case"textarea":a0(c,b),wn("invalid",c)}kg(o,b),_=null;for(var x in b)if(b.hasOwnProperty(x)){var h=b[x];x==="children"?typeof h=="string"?c.textContent!==h&&(b.suppressHydrationWarning!==!0&&pf(c.textContent,h,n),_=["children",h]):typeof h=="number"&&c.textContent!==""+h&&(b.suppressHydrationWarning!==!0&&pf(c.textContent,h,n),_=["children",""+h]):id.hasOwnProperty(x)&&h!=null&&x==="onScroll"&&wn("scroll",c)}switch(o){case"input":sf(c),i0(c,b,!0);break;case"textarea":sf(c),s0(c);break;case"select":case"option":break;default:typeof b.onClick=="function"&&(c.onclick=Zf)}c=_,r.updateQueue=c,c!==null&&(r.flags|=4)}else{x=_.nodeType===9?_:_.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=e1(o)),n==="http://www.w3.org/1999/xhtml"?o==="script"?(n=x.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof c.is=="string"?n=x.createElement(o,{is:c.is}):(n=x.createElement(o),o==="select"&&(x=n,c.multiple?x.multiple=!0:c.size&&(x.size=c.size))):n=x.createElementNS(n,o),n[so]=r,n[pd]=c,kw(n,r,!1,!1),r.stateNode=n;e:{switch(x=Cg(o,c),o){case"dialog":wn("cancel",n),wn("close",n),_=c;break;case"iframe":case"object":case"embed":wn("load",n),_=c;break;case"video":case"audio":for(_=0;_<Hh.length;_++)wn(Hh[_],n);_=c;break;case"source":wn("error",n),_=c;break;case"img":case"image":case"link":wn("error",n),wn("load",n),_=c;break;case"details":wn("toggle",n),_=c;break;case"input":n0(n,c),_=vg(n,c),wn("invalid",n);break;case"option":_=c;break;case"select":n._wrapperState={wasMultiple:!!c.multiple},_=On({},c,{value:void 0}),wn("invalid",n);break;case"textarea":a0(n,c),_=bg(n,c),wn("invalid",n);break;default:_=c}kg(o,_),h=_;for(b in h)if(h.hasOwnProperty(b)){var j=h[b];b==="style"?n1(n,j):b==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,j!=null&&t1(n,j)):b==="children"?typeof j=="string"?(o!=="textarea"||j!=="")&&ad(n,j):typeof j=="number"&&ad(n,""+j):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(id.hasOwnProperty(b)?j!=null&&b==="onScroll"&&wn("scroll",n):j!=null&&_y(n,b,j,x))}switch(o){case"input":sf(n),i0(n,c,!1);break;case"textarea":sf(n),s0(n);break;case"option":c.value!=null&&n.setAttribute("value",""+jl(c.value));break;case"select":n.multiple=!!c.multiple,b=c.value,b!=null?Mc(n,!!c.multiple,b,!1):c.defaultValue!=null&&Mc(n,!!c.multiple,c.defaultValue,!0);break;default:typeof _.onClick=="function"&&(n.onclick=Zf)}switch(o){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Hi(r),null;case 6:if(n&&r.stateNode!=null)Tw(n,r,n.memoizedProps,c);else{if(typeof c!="string"&&r.stateNode===null)throw Error(ht(166));if(o=xu(gd.current),xu(lo.current),mf(r)){if(c=r.stateNode,o=r.memoizedProps,c[so]=r,(b=c.nodeValue!==o)&&(n=Ga,n!==null))switch(n.tag){case 3:pf(c.nodeValue,o,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&pf(c.nodeValue,o,(n.mode&1)!==0)}b&&(r.flags|=4)}else c=(o.nodeType===9?o:o.ownerDocument).createTextNode(c),c[so]=r,r.stateNode=c}return Hi(r),null;case 13:if(bn(Ln),c=r.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(En&&Ka!==null&&r.mode&1&&!(r.flags&128))q1(),jc(),r.flags|=98560,b=!1;else if(b=mf(r),c!==null&&c.dehydrated!==null){if(n===null){if(!b)throw Error(ht(318));if(b=r.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(ht(317));b[so]=r}else jc(),!(r.flags&128)&&(r.memoizedState=null),r.flags|=4;Hi(r),b=!1}else Ds!==null&&(ay(Ds),Ds=null),b=!0;if(!b)return r.flags&65536?r:null}return r.flags&128?(r.lanes=o,r):(c=c!==null,c!==(n!==null&&n.memoizedState!==null)&&c&&(r.child.flags|=8192,r.mode&1&&(n===null||Ln.current&1?ui===0&&(ui=3):e_())),r.updateQueue!==null&&(r.flags|=4),Hi(r),null);case 4:return Vc(),Yg(n,r),n===null&&dd(r.stateNode.containerInfo),Hi(r),null;case 10:return Fy(r.type._context),Hi(r),null;case 17:return Ia(r.type)&&Wf(),Hi(r),null;case 19:if(bn(Ln),b=r.memoizedState,b===null)return Hi(r),null;if(c=(r.flags&128)!==0,x=b.rendering,x===null)if(c)jh(b,!1);else{if(ui!==0||n!==null&&n.flags&128)for(n=r.child;n!==null;){if(x=rp(n),x!==null){for(r.flags|=128,jh(b,!1),c=x.updateQueue,c!==null&&(r.updateQueue=c,r.flags|=4),r.subtreeFlags=0,c=o,o=r.child;o!==null;)b=o,n=c,b.flags&=14680066,x=b.alternate,x===null?(b.childLanes=0,b.lanes=n,b.child=null,b.subtreeFlags=0,b.memoizedProps=null,b.memoizedState=null,b.updateQueue=null,b.dependencies=null,b.stateNode=null):(b.childLanes=x.childLanes,b.lanes=x.lanes,b.child=x.child,b.subtreeFlags=0,b.deletions=null,b.memoizedProps=x.memoizedProps,b.memoizedState=x.memoizedState,b.updateQueue=x.updateQueue,b.type=x.type,n=x.dependencies,b.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),o=o.sibling;return yn(Ln,Ln.current&1|2),r.child}n=n.sibling}b.tail!==null&&Kn()>qc&&(r.flags|=128,c=!0,jh(b,!1),r.lanes=4194304)}else{if(!c)if(n=rp(x),n!==null){if(r.flags|=128,c=!0,o=n.updateQueue,o!==null&&(r.updateQueue=o,r.flags|=4),jh(b,!0),b.tail===null&&b.tailMode==="hidden"&&!x.alternate&&!En)return Hi(r),null}else 2*Kn()-b.renderingStartTime>qc&&o!==1073741824&&(r.flags|=128,c=!0,jh(b,!1),r.lanes=4194304);b.isBackwards?(x.sibling=r.child,r.child=x):(o=b.last,o!==null?o.sibling=x:r.child=x,b.last=x)}return b.tail!==null?(r=b.tail,b.rendering=r,b.tail=r.sibling,b.renderingStartTime=Kn(),r.sibling=null,o=Ln.current,yn(Ln,c?o&1|2:o&1),r):(Hi(r),null);case 22:case 23:return Qy(),c=r.memoizedState!==null,n!==null&&n.memoizedState!==null!==c&&(r.flags|=8192),c&&r.mode&1?$a&1073741824&&(Hi(r),r.subtreeFlags&6&&(r.flags|=8192)):Hi(r),null;case 24:return null;case 25:return null}throw Error(ht(156,r.tag))}function sC(n,r){switch(zy(r),r.tag){case 1:return Ia(r.type)&&Wf(),n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 3:return Vc(),bn(Ta),bn(Wi),Vy(),n=r.flags,n&65536&&!(n&128)?(r.flags=n&-65537|128,r):null;case 5:return Uy(r),null;case 13:if(bn(Ln),n=r.memoizedState,n!==null&&n.dehydrated!==null){if(r.alternate===null)throw Error(ht(340));jc()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 19:return bn(Ln),null;case 4:return Vc(),null;case 10:return Fy(r.type._context),null;case 22:case 23:return Qy(),null;case 24:return null;default:return null}}var _f=!1,Zi=!1,oC=typeof WeakSet=="function"?WeakSet:Set,qt=null;function Pc(n,r){var o=n.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(c){Vn(n,r,c)}else o.current=null}function Jg(n,r,o){try{o()}catch(c){Vn(n,r,c)}}var W0=!1;function lC(n,r){if(Rg=Kf,n=M1(),My(n)){if("selectionStart"in n)var o={start:n.selectionStart,end:n.selectionEnd};else e:{o=(o=n.ownerDocument)&&o.defaultView||window;var c=o.getSelection&&o.getSelection();if(c&&c.rangeCount!==0){o=c.anchorNode;var _=c.anchorOffset,b=c.focusNode;c=c.focusOffset;try{o.nodeType,b.nodeType}catch{o=null;break e}var x=0,h=-1,j=-1,q=0,le=0,Y=n,W=null;t:for(;;){for(var $e;Y!==o||_!==0&&Y.nodeType!==3||(h=x+_),Y!==b||c!==0&&Y.nodeType!==3||(j=x+c),Y.nodeType===3&&(x+=Y.nodeValue.length),($e=Y.firstChild)!==null;)W=Y,Y=$e;for(;;){if(Y===n)break t;if(W===o&&++q===_&&(h=x),W===b&&++le===c&&(j=x),($e=Y.nextSibling)!==null)break;Y=W,W=Y.parentNode}Y=$e}o=h===-1||j===-1?null:{start:h,end:j}}else o=null}o=o||{start:0,end:0}}else o=null;for(Og={focusedElem:n,selectionRange:o},Kf=!1,qt=r;qt!==null;)if(r=qt,n=r.child,(r.subtreeFlags&1028)!==0&&n!==null)n.return=r,qt=n;else for(;qt!==null;){r=qt;try{var He=r.alternate;if(r.flags&1024)switch(r.tag){case 0:case 11:case 15:break;case 1:if(He!==null){var Je=He.memoizedProps,Qt=He.memoizedState,be=r.stateNode,pe=be.getSnapshotBeforeUpdate(r.elementType===r.type?Je:As(r.type,Je),Qt);be.__reactInternalSnapshotBeforeUpdate=pe}break;case 3:var ke=r.stateNode.containerInfo;ke.nodeType===1?ke.textContent="":ke.nodeType===9&&ke.documentElement&&ke.removeChild(ke.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ht(163))}}catch(Ve){Vn(r,r.return,Ve)}if(n=r.sibling,n!==null){n.return=r.return,qt=n;break}qt=r.return}return He=W0,W0=!1,He}function ed(n,r,o){var c=r.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var _=c=c.next;do{if((_.tag&n)===n){var b=_.destroy;_.destroy=void 0,b!==void 0&&Jg(r,o,b)}_=_.next}while(_!==c)}}function Tp(n,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&n)===n){var c=o.create;o.destroy=c()}o=o.next}while(o!==r)}}function Qg(n){var r=n.ref;if(r!==null){var o=n.stateNode;switch(n.tag){case 5:n=o;break;default:n=o}typeof r=="function"?r(n):r.current=n}}function Iw(n){var r=n.alternate;r!==null&&(n.alternate=null,Iw(r)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(r=n.stateNode,r!==null&&(delete r[so],delete r[pd],delete r[Ng],delete r[qk],delete r[Kk])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Pw(n){return n.tag===5||n.tag===3||n.tag===4}function X0(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Pw(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function ey(n,r,o){var c=n.tag;if(c===5||c===6)n=n.stateNode,r?o.nodeType===8?o.parentNode.insertBefore(n,r):o.insertBefore(n,r):(o.nodeType===8?(r=o.parentNode,r.insertBefore(n,o)):(r=o,r.appendChild(n)),o=o._reactRootContainer,o!=null||r.onclick!==null||(r.onclick=Zf));else if(c!==4&&(n=n.child,n!==null))for(ey(n,r,o),n=n.sibling;n!==null;)ey(n,r,o),n=n.sibling}function ty(n,r,o){var c=n.tag;if(c===5||c===6)n=n.stateNode,r?o.insertBefore(n,r):o.appendChild(n);else if(c!==4&&(n=n.child,n!==null))for(ty(n,r,o),n=n.sibling;n!==null;)ty(n,r,o),n=n.sibling}var Ai=null,Ms=!1;function xl(n,r,o){for(o=o.child;o!==null;)Ew(n,r,o),o=o.sibling}function Ew(n,r,o){if(oo&&typeof oo.onCommitFiberUnmount=="function")try{oo.onCommitFiberUnmount(_p,o)}catch{}switch(o.tag){case 5:Zi||Pc(o,r);case 6:var c=Ai,_=Ms;Ai=null,xl(n,r,o),Ai=c,Ms=_,Ai!==null&&(Ms?(n=Ai,o=o.stateNode,n.nodeType===8?n.parentNode.removeChild(o):n.removeChild(o)):Ai.removeChild(o.stateNode));break;case 18:Ai!==null&&(Ms?(n=Ai,o=o.stateNode,n.nodeType===8?Ym(n.parentNode,o):n.nodeType===1&&Ym(n,o),ud(n)):Ym(Ai,o.stateNode));break;case 4:c=Ai,_=Ms,Ai=o.stateNode.containerInfo,Ms=!0,xl(n,r,o),Ai=c,Ms=_;break;case 0:case 11:case 14:case 15:if(!Zi&&(c=o.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){_=c=c.next;do{var b=_,x=b.destroy;b=b.tag,x!==void 0&&(b&2||b&4)&&Jg(o,r,x),_=_.next}while(_!==c)}xl(n,r,o);break;case 1:if(!Zi&&(Pc(o,r),c=o.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=o.memoizedProps,c.state=o.memoizedState,c.componentWillUnmount()}catch(h){Vn(o,r,h)}xl(n,r,o);break;case 21:xl(n,r,o);break;case 22:o.mode&1?(Zi=(c=Zi)||o.memoizedState!==null,xl(n,r,o),Zi=c):xl(n,r,o);break;default:xl(n,r,o)}}function Y0(n){var r=n.updateQueue;if(r!==null){n.updateQueue=null;var o=n.stateNode;o===null&&(o=n.stateNode=new oC),r.forEach(function(c){var _=yC.bind(null,n,c);o.has(c)||(o.add(c),c.then(_,_))})}}function Es(n,r){var o=r.deletions;if(o!==null)for(var c=0;c<o.length;c++){var _=o[c];try{var b=n,x=r,h=x;e:for(;h!==null;){switch(h.tag){case 5:Ai=h.stateNode,Ms=!1;break e;case 3:Ai=h.stateNode.containerInfo,Ms=!0;break e;case 4:Ai=h.stateNode.containerInfo,Ms=!0;break e}h=h.return}if(Ai===null)throw Error(ht(160));Ew(b,x,_),Ai=null,Ms=!1;var j=_.alternate;j!==null&&(j.return=null),_.return=null}catch(q){Vn(_,r,q)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)Aw(r,n),r=r.sibling}function Aw(n,r){var o=n.alternate,c=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Es(r,n),io(n),c&4){try{ed(3,n,n.return),Tp(3,n)}catch(Je){Vn(n,n.return,Je)}try{ed(5,n,n.return)}catch(Je){Vn(n,n.return,Je)}}break;case 1:Es(r,n),io(n),c&512&&o!==null&&Pc(o,o.return);break;case 5:if(Es(r,n),io(n),c&512&&o!==null&&Pc(o,o.return),n.flags&32){var _=n.stateNode;try{ad(_,"")}catch(Je){Vn(n,n.return,Je)}}if(c&4&&(_=n.stateNode,_!=null)){var b=n.memoizedProps,x=o!==null?o.memoizedProps:b,h=n.type,j=n.updateQueue;if(n.updateQueue=null,j!==null)try{h==="input"&&b.type==="radio"&&b.name!=null&&Jx(_,b),Cg(h,x);var q=Cg(h,b);for(x=0;x<j.length;x+=2){var le=j[x],Y=j[x+1];le==="style"?n1(_,Y):le==="dangerouslySetInnerHTML"?t1(_,Y):le==="children"?ad(_,Y):_y(_,le,Y,q)}switch(h){case"input":xg(_,b);break;case"textarea":Qx(_,b);break;case"select":var W=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!b.multiple;var $e=b.value;$e!=null?Mc(_,!!b.multiple,$e,!1):W!==!!b.multiple&&(b.defaultValue!=null?Mc(_,!!b.multiple,b.defaultValue,!0):Mc(_,!!b.multiple,b.multiple?[]:"",!1))}_[pd]=b}catch(Je){Vn(n,n.return,Je)}}break;case 6:if(Es(r,n),io(n),c&4){if(n.stateNode===null)throw Error(ht(162));_=n.stateNode,b=n.memoizedProps;try{_.nodeValue=b}catch(Je){Vn(n,n.return,Je)}}break;case 3:if(Es(r,n),io(n),c&4&&o!==null&&o.memoizedState.isDehydrated)try{ud(r.containerInfo)}catch(Je){Vn(n,n.return,Je)}break;case 4:Es(r,n),io(n);break;case 13:Es(r,n),io(n),_=n.child,_.flags&8192&&(b=_.memoizedState!==null,_.stateNode.isHidden=b,!b||_.alternate!==null&&_.alternate.memoizedState!==null||(Yy=Kn())),c&4&&Y0(n);break;case 22:if(le=o!==null&&o.memoizedState!==null,n.mode&1?(Zi=(q=Zi)||le,Es(r,n),Zi=q):Es(r,n),io(n),c&8192){if(q=n.memoizedState!==null,(n.stateNode.isHidden=q)&&!le&&n.mode&1)for(qt=n,le=n.child;le!==null;){for(Y=qt=le;qt!==null;){switch(W=qt,$e=W.child,W.tag){case 0:case 11:case 14:case 15:ed(4,W,W.return);break;case 1:Pc(W,W.return);var He=W.stateNode;if(typeof He.componentWillUnmount=="function"){c=W,o=W.return;try{r=c,He.props=r.memoizedProps,He.state=r.memoizedState,He.componentWillUnmount()}catch(Je){Vn(c,o,Je)}}break;case 5:Pc(W,W.return);break;case 22:if(W.memoizedState!==null){Q0(Y);continue}}$e!==null?($e.return=W,qt=$e):Q0(Y)}le=le.sibling}e:for(le=null,Y=n;;){if(Y.tag===5){if(le===null){le=Y;try{_=Y.stateNode,q?(b=_.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none"):(h=Y.stateNode,j=Y.memoizedProps.style,x=j!=null&&j.hasOwnProperty("display")?j.display:null,h.style.display=r1("display",x))}catch(Je){Vn(n,n.return,Je)}}}else if(Y.tag===6){if(le===null)try{Y.stateNode.nodeValue=q?"":Y.memoizedProps}catch(Je){Vn(n,n.return,Je)}}else if((Y.tag!==22&&Y.tag!==23||Y.memoizedState===null||Y===n)&&Y.child!==null){Y.child.return=Y,Y=Y.child;continue}if(Y===n)break e;for(;Y.sibling===null;){if(Y.return===null||Y.return===n)break e;le===Y&&(le=null),Y=Y.return}le===Y&&(le=null),Y.sibling.return=Y.return,Y=Y.sibling}}break;case 19:Es(r,n),io(n),c&4&&Y0(n);break;case 21:break;default:Es(r,n),io(n)}}function io(n){var r=n.flags;if(r&2){try{e:{for(var o=n.return;o!==null;){if(Pw(o)){var c=o;break e}o=o.return}throw Error(ht(160))}switch(c.tag){case 5:var _=c.stateNode;c.flags&32&&(ad(_,""),c.flags&=-33);var b=X0(n);ty(n,b,_);break;case 3:case 4:var x=c.stateNode.containerInfo,h=X0(n);ey(n,h,x);break;default:throw Error(ht(161))}}catch(j){Vn(n,n.return,j)}n.flags&=-3}r&4096&&(n.flags&=-4097)}function uC(n,r,o){qt=n,Mw(n)}function Mw(n,r,o){for(var c=(n.mode&1)!==0;qt!==null;){var _=qt,b=_.child;if(_.tag===22&&c){var x=_.memoizedState!==null||_f;if(!x){var h=_.alternate,j=h!==null&&h.memoizedState!==null||Zi;h=_f;var q=Zi;if(_f=x,(Zi=j)&&!q)for(qt=_;qt!==null;)x=qt,j=x.child,x.tag===22&&x.memoizedState!==null?ex(_):j!==null?(j.return=x,qt=j):ex(_);for(;b!==null;)qt=b,Mw(b),b=b.sibling;qt=_,_f=h,Zi=q}J0(n)}else _.subtreeFlags&8772&&b!==null?(b.return=_,qt=b):J0(n)}}function J0(n){for(;qt!==null;){var r=qt;if(r.flags&8772){var o=r.alternate;try{if(r.flags&8772)switch(r.tag){case 0:case 11:case 15:Zi||Tp(5,r);break;case 1:var c=r.stateNode;if(r.flags&4&&!Zi)if(o===null)c.componentDidMount();else{var _=r.elementType===r.type?o.memoizedProps:As(r.type,o.memoizedProps);c.componentDidUpdate(_,o.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var b=r.updateQueue;b!==null&&O0(r,b,c);break;case 3:var x=r.updateQueue;if(x!==null){if(o=null,r.child!==null)switch(r.child.tag){case 5:o=r.child.stateNode;break;case 1:o=r.child.stateNode}O0(r,x,o)}break;case 5:var h=r.stateNode;if(o===null&&r.flags&4){o=h;var j=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":j.autoFocus&&o.focus();break;case"img":j.src&&(o.src=j.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var q=r.alternate;if(q!==null){var le=q.memoizedState;if(le!==null){var Y=le.dehydrated;Y!==null&&ud(Y)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ht(163))}Zi||r.flags&512&&Qg(r)}catch(W){Vn(r,r.return,W)}}if(r===n){qt=null;break}if(o=r.sibling,o!==null){o.return=r.return,qt=o;break}qt=r.return}}function Q0(n){for(;qt!==null;){var r=qt;if(r===n){qt=null;break}var o=r.sibling;if(o!==null){o.return=r.return,qt=o;break}qt=r.return}}function ex(n){for(;qt!==null;){var r=qt;try{switch(r.tag){case 0:case 11:case 15:var o=r.return;try{Tp(4,r)}catch(j){Vn(r,o,j)}break;case 1:var c=r.stateNode;if(typeof c.componentDidMount=="function"){var _=r.return;try{c.componentDidMount()}catch(j){Vn(r,_,j)}}var b=r.return;try{Qg(r)}catch(j){Vn(r,b,j)}break;case 5:var x=r.return;try{Qg(r)}catch(j){Vn(r,x,j)}}}catch(j){Vn(r,r.return,j)}if(r===n){qt=null;break}var h=r.sibling;if(h!==null){h.return=r.return,qt=h;break}qt=r.return}}var cC=Math.ceil,ap=$o.ReactCurrentDispatcher,Wy=$o.ReactCurrentOwner,ms=$o.ReactCurrentBatchConfig,qr=0,xi=null,Qn=null,Mi=0,$a=0,Ec=$l(0),ui=0,xd=null,Eu=0,Ip=0,Xy=0,td=null,Sa=null,Yy=0,qc=1/0,Lo=null,sp=!1,ry=null,Ol=null,vf=!1,Tl=null,op=0,rd=0,ny=null,Rf=-1,Of=0;function oa(){return qr&6?Kn():Rf!==-1?Rf:Rf=Kn()}function Fl(n){return n.mode&1?qr&2&&Mi!==0?Mi&-Mi:Hk.transition!==null?(Of===0&&(Of=m1()),Of):(n=rn,n!==0||(n=window.event,n=n===void 0?16:b1(n.type)),n):1}function Rs(n,r,o,c){if(50<rd)throw rd=0,ny=null,Error(ht(185));Sd(n,o,c),(!(qr&2)||n!==xi)&&(n===xi&&(!(qr&2)&&(Ip|=o),ui===4&&kl(n,Mi)),Pa(n,c),o===1&&qr===0&&!(r.mode&1)&&(qc=Kn()+500,Sp&&ql()))}function Pa(n,r){var o=n.callbackNode;HS(n,r);var c=qf(n,n===xi?Mi:0);if(c===0)o!==null&&u0(o),n.callbackNode=null,n.callbackPriority=0;else if(r=c&-c,n.callbackPriority!==r){if(o!=null&&u0(o),r===1)n.tag===0?Gk(tx.bind(null,n)):U1(tx.bind(null,n)),Vk(function(){!(qr&6)&&ql()}),o=null;else{switch(g1(c)){case 1:o=Sy;break;case 4:o=f1;break;case 16:o=$f;break;case 536870912:o=p1;break;default:o=$f}o=Nw(o,Dw.bind(null,n))}n.callbackPriority=r,n.callbackNode=o}}function Dw(n,r){if(Rf=-1,Of=0,qr&6)throw Error(ht(327));var o=n.callbackNode;if(Oc()&&n.callbackNode!==o)return null;var c=qf(n,n===xi?Mi:0);if(c===0)return null;if(c&30||c&n.expiredLanes||r)r=lp(n,c);else{r=c;var _=qr;qr|=2;var b=Lw();(xi!==n||Mi!==r)&&(Lo=null,qc=Kn()+500,ku(n,r));do try{fC();break}catch(h){zw(n,h)}while(!0);Oy(),ap.current=b,qr=_,Qn!==null?r=0:(xi=null,Mi=0,r=ui)}if(r!==0){if(r===2&&(_=Ag(n),_!==0&&(c=_,r=iy(n,_))),r===1)throw o=xd,ku(n,0),kl(n,c),Pa(n,Kn()),o;if(r===6)kl(n,c);else{if(_=n.current.alternate,!(c&30)&&!hC(_)&&(r=lp(n,c),r===2&&(b=Ag(n),b!==0&&(c=b,r=iy(n,b))),r===1))throw o=xd,ku(n,0),kl(n,c),Pa(n,Kn()),o;switch(n.finishedWork=_,n.finishedLanes=c,r){case 0:case 1:throw Error(ht(345));case 2:gu(n,Sa,Lo);break;case 3:if(kl(n,c),(c&130023424)===c&&(r=Yy+500-Kn(),10<r)){if(qf(n,0)!==0)break;if(_=n.suspendedLanes,(_&c)!==c){oa(),n.pingedLanes|=n.suspendedLanes&_;break}n.timeoutHandle=Bg(gu.bind(null,n,Sa,Lo),r);break}gu(n,Sa,Lo);break;case 4:if(kl(n,c),(c&4194240)===c)break;for(r=n.eventTimes,_=-1;0<c;){var x=31-Ls(c);b=1<<x,x=r[x],x>_&&(_=x),c&=~b}if(c=_,c=Kn()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*cC(c/1960))-c,10<c){n.timeoutHandle=Bg(gu.bind(null,n,Sa,Lo),c);break}gu(n,Sa,Lo);break;case 5:gu(n,Sa,Lo);break;default:throw Error(ht(329))}}}return Pa(n,Kn()),n.callbackNode===o?Dw.bind(null,n):null}function iy(n,r){var o=td;return n.current.memoizedState.isDehydrated&&(ku(n,r).flags|=256),n=lp(n,r),n!==2&&(r=Sa,Sa=o,r!==null&&ay(r)),n}function ay(n){Sa===null?Sa=n:Sa.push.apply(Sa,n)}function hC(n){for(var r=n;;){if(r.flags&16384){var o=r.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var c=0;c<o.length;c++){var _=o[c],b=_.getSnapshot;_=_.value;try{if(!Os(b(),_))return!1}catch{return!1}}}if(o=r.child,r.subtreeFlags&16384&&o!==null)o.return=r,r=o;else{if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function kl(n,r){for(r&=~Xy,r&=~Ip,n.suspendedLanes|=r,n.pingedLanes&=~r,n=n.expirationTimes;0<r;){var o=31-Ls(r),c=1<<o;n[o]=-1,r&=~c}}function tx(n){if(qr&6)throw Error(ht(327));Oc();var r=qf(n,0);if(!(r&1))return Pa(n,Kn()),null;var o=lp(n,r);if(n.tag!==0&&o===2){var c=Ag(n);c!==0&&(r=c,o=iy(n,c))}if(o===1)throw o=xd,ku(n,0),kl(n,r),Pa(n,Kn()),o;if(o===6)throw Error(ht(345));return n.finishedWork=n.current.alternate,n.finishedLanes=r,gu(n,Sa,Lo),Pa(n,Kn()),null}function Jy(n,r){var o=qr;qr|=1;try{return n(r)}finally{qr=o,qr===0&&(qc=Kn()+500,Sp&&ql())}}function Au(n){Tl!==null&&Tl.tag===0&&!(qr&6)&&Oc();var r=qr;qr|=1;var o=ms.transition,c=rn;try{if(ms.transition=null,rn=1,n)return n()}finally{rn=c,ms.transition=o,qr=r,!(qr&6)&&ql()}}function Qy(){$a=Ec.current,bn(Ec)}function ku(n,r){n.finishedWork=null,n.finishedLanes=0;var o=n.timeoutHandle;if(o!==-1&&(n.timeoutHandle=-1,Uk(o)),Qn!==null)for(o=Qn.return;o!==null;){var c=o;switch(zy(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&Wf();break;case 3:Vc(),bn(Ta),bn(Wi),Vy();break;case 5:Uy(c);break;case 4:Vc();break;case 13:bn(Ln);break;case 19:bn(Ln);break;case 10:Fy(c.type._context);break;case 22:case 23:Qy()}o=o.return}if(xi=n,Qn=n=Bl(n.current,null),Mi=$a=r,ui=0,xd=null,Xy=Ip=Eu=0,Sa=td=null,vu!==null){for(r=0;r<vu.length;r++)if(o=vu[r],c=o.interleaved,c!==null){o.interleaved=null;var _=c.next,b=o.pending;if(b!==null){var x=b.next;b.next=_,c.next=x}o.pending=c}vu=null}return n}function zw(n,r){do{var o=Qn;try{if(Oy(),Df.current=ip,np){for(var c=Rn.memoizedState;c!==null;){var _=c.queue;_!==null&&(_.pending=null),c=c.next}np=!1}if(Pu=0,vi=li=Rn=null,Qh=!1,yd=0,Wy.current=null,o===null||o.return===null){ui=1,xd=r,Qn=null;break}e:{var b=n,x=o.return,h=o,j=r;if(r=Mi,h.flags|=32768,j!==null&&typeof j=="object"&&typeof j.then=="function"){var q=j,le=h,Y=le.tag;if(!(le.mode&1)&&(Y===0||Y===11||Y===15)){var W=le.alternate;W?(le.updateQueue=W.updateQueue,le.memoizedState=W.memoizedState,le.lanes=W.lanes):(le.updateQueue=null,le.memoizedState=null)}var $e=V0(x);if($e!==null){$e.flags&=-257,$0($e,x,h,b,r),$e.mode&1&&U0(b,q,r),r=$e,j=q;var He=r.updateQueue;if(He===null){var Je=new Set;Je.add(j),r.updateQueue=Je}else He.add(j);break e}else{if(!(r&1)){U0(b,q,r),e_();break e}j=Error(ht(426))}}else if(En&&h.mode&1){var Qt=V0(x);if(Qt!==null){!(Qt.flags&65536)&&(Qt.flags|=256),$0(Qt,x,h,b,r),Ly($c(j,h));break e}}b=j=$c(j,h),ui!==4&&(ui=2),td===null?td=[b]:td.push(b),b=x;do{switch(b.tag){case 3:b.flags|=65536,r&=-r,b.lanes|=r;var be=gw(b,j,r);R0(b,be);break e;case 1:h=j;var pe=b.type,ke=b.stateNode;if(!(b.flags&128)&&(typeof pe.getDerivedStateFromError=="function"||ke!==null&&typeof ke.componentDidCatch=="function"&&(Ol===null||!Ol.has(ke)))){b.flags|=65536,r&=-r,b.lanes|=r;var Ve=yw(b,h,r);R0(b,Ve);break e}}b=b.return}while(b!==null)}Ow(o)}catch(et){r=et,Qn===o&&o!==null&&(Qn=o=o.return);continue}break}while(!0)}function Lw(){var n=ap.current;return ap.current=ip,n===null?ip:n}function e_(){(ui===0||ui===3||ui===2)&&(ui=4),xi===null||!(Eu&268435455)&&!(Ip&268435455)||kl(xi,Mi)}function lp(n,r){var o=qr;qr|=2;var c=Lw();(xi!==n||Mi!==r)&&(Lo=null,ku(n,r));do try{dC();break}catch(_){zw(n,_)}while(!0);if(Oy(),qr=o,ap.current=c,Qn!==null)throw Error(ht(261));return xi=null,Mi=0,ui}function dC(){for(;Qn!==null;)Rw(Qn)}function fC(){for(;Qn!==null&&!BS();)Rw(Qn)}function Rw(n){var r=Bw(n.alternate,n,$a);n.memoizedProps=n.pendingProps,r===null?Ow(n):Qn=r,Wy.current=null}function Ow(n){var r=n;do{var o=r.alternate;if(n=r.return,r.flags&32768){if(o=sC(o,r),o!==null){o.flags&=32767,Qn=o;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{ui=6,Qn=null;return}}else if(o=aC(o,r,$a),o!==null){Qn=o;return}if(r=r.sibling,r!==null){Qn=r;return}Qn=r=n}while(r!==null);ui===0&&(ui=5)}function gu(n,r,o){var c=rn,_=ms.transition;try{ms.transition=null,rn=1,pC(n,r,o,c)}finally{ms.transition=_,rn=c}return null}function pC(n,r,o,c){do Oc();while(Tl!==null);if(qr&6)throw Error(ht(327));o=n.finishedWork;var _=n.finishedLanes;if(o===null)return null;if(n.finishedWork=null,n.finishedLanes=0,o===n.current)throw Error(ht(177));n.callbackNode=null,n.callbackPriority=0;var b=o.lanes|o.childLanes;if(ZS(n,b),n===xi&&(Qn=xi=null,Mi=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||vf||(vf=!0,Nw($f,function(){return Oc(),null})),b=(o.flags&15990)!==0,o.subtreeFlags&15990||b){b=ms.transition,ms.transition=null;var x=rn;rn=1;var h=qr;qr|=4,Wy.current=null,lC(n,o),Aw(o,n),Lk(Og),Kf=!!Rg,Og=Rg=null,n.current=o,uC(o),NS(),qr=h,rn=x,ms.transition=b}else n.current=o;if(vf&&(vf=!1,Tl=n,op=_),b=n.pendingLanes,b===0&&(Ol=null),VS(o.stateNode),Pa(n,Kn()),r!==null)for(c=n.onRecoverableError,o=0;o<r.length;o++)_=r[o],c(_.value,{componentStack:_.stack,digest:_.digest});if(sp)throw sp=!1,n=ry,ry=null,n;return op&1&&n.tag!==0&&Oc(),b=n.pendingLanes,b&1?n===ny?rd++:(rd=0,ny=n):rd=0,ql(),null}function Oc(){if(Tl!==null){var n=g1(op),r=ms.transition,o=rn;try{if(ms.transition=null,rn=16>n?16:n,Tl===null)var c=!1;else{if(n=Tl,Tl=null,op=0,qr&6)throw Error(ht(331));var _=qr;for(qr|=4,qt=n.current;qt!==null;){var b=qt,x=b.child;if(qt.flags&16){var h=b.deletions;if(h!==null){for(var j=0;j<h.length;j++){var q=h[j];for(qt=q;qt!==null;){var le=qt;switch(le.tag){case 0:case 11:case 15:ed(8,le,b)}var Y=le.child;if(Y!==null)Y.return=le,qt=Y;else for(;qt!==null;){le=qt;var W=le.sibling,$e=le.return;if(Iw(le),le===q){qt=null;break}if(W!==null){W.return=$e,qt=W;break}qt=$e}}}var He=b.alternate;if(He!==null){var Je=He.child;if(Je!==null){He.child=null;do{var Qt=Je.sibling;Je.sibling=null,Je=Qt}while(Je!==null)}}qt=b}}if(b.subtreeFlags&2064&&x!==null)x.return=b,qt=x;else e:for(;qt!==null;){if(b=qt,b.flags&2048)switch(b.tag){case 0:case 11:case 15:ed(9,b,b.return)}var be=b.sibling;if(be!==null){be.return=b.return,qt=be;break e}qt=b.return}}var pe=n.current;for(qt=pe;qt!==null;){x=qt;var ke=x.child;if(x.subtreeFlags&2064&&ke!==null)ke.return=x,qt=ke;else e:for(x=pe;qt!==null;){if(h=qt,h.flags&2048)try{switch(h.tag){case 0:case 11:case 15:Tp(9,h)}}catch(et){Vn(h,h.return,et)}if(h===x){qt=null;break e}var Ve=h.sibling;if(Ve!==null){Ve.return=h.return,qt=Ve;break e}qt=h.return}}if(qr=_,ql(),oo&&typeof oo.onPostCommitFiberRoot=="function")try{oo.onPostCommitFiberRoot(_p,n)}catch{}c=!0}return c}finally{rn=o,ms.transition=r}}return!1}function rx(n,r,o){r=$c(o,r),r=gw(n,r,1),n=Rl(n,r,1),r=oa(),n!==null&&(Sd(n,1,r),Pa(n,r))}function Vn(n,r,o){if(n.tag===3)rx(n,n,o);else for(;r!==null;){if(r.tag===3){rx(r,n,o);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Ol===null||!Ol.has(c))){n=$c(o,n),n=yw(r,n,1),r=Rl(r,n,1),n=oa(),r!==null&&(Sd(r,1,n),Pa(r,n));break}}r=r.return}}function mC(n,r,o){var c=n.pingCache;c!==null&&c.delete(r),r=oa(),n.pingedLanes|=n.suspendedLanes&o,xi===n&&(Mi&o)===o&&(ui===4||ui===3&&(Mi&130023424)===Mi&&500>Kn()-Yy?ku(n,0):Xy|=o),Pa(n,r)}function Fw(n,r){r===0&&(n.mode&1?(r=uf,uf<<=1,!(uf&130023424)&&(uf=4194304)):r=1);var o=oa();n=Uo(n,r),n!==null&&(Sd(n,r,o),Pa(n,o))}function gC(n){var r=n.memoizedState,o=0;r!==null&&(o=r.retryLane),Fw(n,o)}function yC(n,r){var o=0;switch(n.tag){case 13:var c=n.stateNode,_=n.memoizedState;_!==null&&(o=_.retryLane);break;case 19:c=n.stateNode;break;default:throw Error(ht(314))}c!==null&&c.delete(r),Fw(n,o)}var Bw;Bw=function(n,r,o){if(n!==null)if(n.memoizedProps!==r.pendingProps||Ta.current)Ca=!0;else{if(!(n.lanes&o)&&!(r.flags&128))return Ca=!1,iC(n,r,o);Ca=!!(n.flags&131072)}else Ca=!1,En&&r.flags&1048576&&V1(r,Jf,r.index);switch(r.lanes=0,r.tag){case 2:var c=r.type;Lf(n,r),n=r.pendingProps;var _=Nc(r,Wi.current);Rc(r,o),_=qy(null,r,c,n,_,o);var b=Ky();return r.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,Ia(c)?(b=!0,Xf(r)):b=!1,r.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,Ny(r),_.updater=Cp,r.stateNode=_,_._reactInternals=r,Kg(r,c,n,o),r=Zg(null,r,c,!0,b,o)):(r.tag=0,En&&b&&Dy(r),sa(null,r,_,o),r=r.child),r;case 16:c=r.elementType;e:{switch(Lf(n,r),n=r.pendingProps,_=c._init,c=_(c._payload),r.type=c,_=r.tag=vC(c),n=As(c,n),_){case 0:r=Hg(null,r,c,n,o);break e;case 1:r=G0(null,r,c,n,o);break e;case 11:r=q0(null,r,c,n,o);break e;case 14:r=K0(null,r,c,As(c.type,n),o);break e}throw Error(ht(306,c,""))}return r;case 0:return c=r.type,_=r.pendingProps,_=r.elementType===c?_:As(c,_),Hg(n,r,c,_,o);case 1:return c=r.type,_=r.pendingProps,_=r.elementType===c?_:As(c,_),G0(n,r,c,_,o);case 3:e:{if(ww(r),n===null)throw Error(ht(387));c=r.pendingProps,b=r.memoizedState,_=b.element,Z1(n,r),tp(r,c,null,o);var x=r.memoizedState;if(c=x.element,b.isDehydrated)if(b={element:c,isDehydrated:!1,cache:x.cache,pendingSuspenseBoundaries:x.pendingSuspenseBoundaries,transitions:x.transitions},r.updateQueue.baseState=b,r.memoizedState=b,r.flags&256){_=$c(Error(ht(423)),r),r=H0(n,r,c,o,_);break e}else if(c!==_){_=$c(Error(ht(424)),r),r=H0(n,r,c,o,_);break e}else for(Ka=Ll(r.stateNode.containerInfo.firstChild),Ga=r,En=!0,Ds=null,o=G1(r,null,c,o),r.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(jc(),c===_){r=Vo(n,r,o);break e}sa(n,r,c,o)}r=r.child}return r;case 5:return W1(r),n===null&&Vg(r),c=r.type,_=r.pendingProps,b=n!==null?n.memoizedProps:null,x=_.children,Fg(c,_)?x=null:b!==null&&Fg(c,b)&&(r.flags|=32),xw(n,r),sa(n,r,x,o),r.child;case 6:return n===null&&Vg(r),null;case 13:return bw(n,r,o);case 4:return jy(r,r.stateNode.containerInfo),c=r.pendingProps,n===null?r.child=Uc(r,null,c,o):sa(n,r,c,o),r.child;case 11:return c=r.type,_=r.pendingProps,_=r.elementType===c?_:As(c,_),q0(n,r,c,_,o);case 7:return sa(n,r,r.pendingProps,o),r.child;case 8:return sa(n,r,r.pendingProps.children,o),r.child;case 12:return sa(n,r,r.pendingProps.children,o),r.child;case 10:e:{if(c=r.type._context,_=r.pendingProps,b=r.memoizedProps,x=_.value,yn(Qf,c._currentValue),c._currentValue=x,b!==null)if(Os(b.value,x)){if(b.children===_.children&&!Ta.current){r=Vo(n,r,o);break e}}else for(b=r.child,b!==null&&(b.return=r);b!==null;){var h=b.dependencies;if(h!==null){x=b.child;for(var j=h.firstContext;j!==null;){if(j.context===c){if(b.tag===1){j=Bo(-1,o&-o),j.tag=2;var q=b.updateQueue;if(q!==null){q=q.shared;var le=q.pending;le===null?j.next=j:(j.next=le.next,le.next=j),q.pending=j}}b.lanes|=o,j=b.alternate,j!==null&&(j.lanes|=o),$g(b.return,o,r),h.lanes|=o;break}j=j.next}}else if(b.tag===10)x=b.type===r.type?null:b.child;else if(b.tag===18){if(x=b.return,x===null)throw Error(ht(341));x.lanes|=o,h=x.alternate,h!==null&&(h.lanes|=o),$g(x,o,r),x=b.sibling}else x=b.child;if(x!==null)x.return=b;else for(x=b;x!==null;){if(x===r){x=null;break}if(b=x.sibling,b!==null){b.return=x.return,x=b;break}x=x.return}b=x}sa(n,r,_.children,o),r=r.child}return r;case 9:return _=r.type,c=r.pendingProps.children,Rc(r,o),_=gs(_),c=c(_),r.flags|=1,sa(n,r,c,o),r.child;case 14:return c=r.type,_=As(c,r.pendingProps),_=As(c.type,_),K0(n,r,c,_,o);case 15:return _w(n,r,r.type,r.pendingProps,o);case 17:return c=r.type,_=r.pendingProps,_=r.elementType===c?_:As(c,_),Lf(n,r),r.tag=1,Ia(c)?(n=!0,Xf(r)):n=!1,Rc(r,o),mw(r,c,_),Kg(r,c,_,o),Zg(null,r,c,!0,n,o);case 19:return Sw(n,r,o);case 22:return vw(n,r,o)}throw Error(ht(156,r.tag))};function Nw(n,r){return d1(n,r)}function _C(n,r,o,c){this.tag=n,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ps(n,r,o,c){return new _C(n,r,o,c)}function t_(n){return n=n.prototype,!(!n||!n.isReactComponent)}function vC(n){if(typeof n=="function")return t_(n)?1:0;if(n!=null){if(n=n.$$typeof,n===xy)return 11;if(n===wy)return 14}return 2}function Bl(n,r){var o=n.alternate;return o===null?(o=ps(n.tag,r,n.key,n.mode),o.elementType=n.elementType,o.type=n.type,o.stateNode=n.stateNode,o.alternate=n,n.alternate=o):(o.pendingProps=r,o.type=n.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=n.flags&14680064,o.childLanes=n.childLanes,o.lanes=n.lanes,o.child=n.child,o.memoizedProps=n.memoizedProps,o.memoizedState=n.memoizedState,o.updateQueue=n.updateQueue,r=n.dependencies,o.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},o.sibling=n.sibling,o.index=n.index,o.ref=n.ref,o}function Ff(n,r,o,c,_,b){var x=2;if(c=n,typeof n=="function")t_(n)&&(x=1);else if(typeof n=="string")x=5;else e:switch(n){case vc:return Cu(o.children,_,b,r);case vy:x=8,_|=8;break;case mg:return n=ps(12,o,r,_|2),n.elementType=mg,n.lanes=b,n;case gg:return n=ps(13,o,r,_),n.elementType=gg,n.lanes=b,n;case yg:return n=ps(19,o,r,_),n.elementType=yg,n.lanes=b,n;case Wx:return Pp(o,_,b,r);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Hx:x=10;break e;case Zx:x=9;break e;case xy:x=11;break e;case wy:x=14;break e;case wl:x=16,c=null;break e}throw Error(ht(130,n==null?n:typeof n,""))}return r=ps(x,o,r,_),r.elementType=n,r.type=c,r.lanes=b,r}function Cu(n,r,o,c){return n=ps(7,n,c,r),n.lanes=o,n}function Pp(n,r,o,c){return n=ps(22,n,c,r),n.elementType=Wx,n.lanes=o,n.stateNode={isHidden:!1},n}function ag(n,r,o){return n=ps(6,n,null,r),n.lanes=o,n}function sg(n,r,o){return r=ps(4,n.children!==null?n.children:[],n.key,r),r.lanes=o,r.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},r}function xC(n,r,o,c,_){this.tag=r,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=jm(0),this.expirationTimes=jm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jm(0),this.identifierPrefix=c,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function r_(n,r,o,c,_,b,x,h,j){return n=new xC(n,r,o,h,j),r===1?(r=1,b===!0&&(r|=8)):r=0,b=ps(3,null,null,r),n.current=b,b.stateNode=n,b.memoizedState={element:c,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ny(b),n}function wC(n,r,o){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_c,key:c==null?null:""+c,children:n,containerInfo:r,implementation:o}}function jw(n){if(!n)return Ul;n=n._reactInternals;e:{if(Ou(n)!==n||n.tag!==1)throw Error(ht(170));var r=n;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(Ia(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(ht(171))}if(n.tag===1){var o=n.type;if(Ia(o))return j1(n,o,r)}return r}function Uw(n,r,o,c,_,b,x,h,j){return n=r_(o,c,!0,n,_,b,x,h,j),n.context=jw(null),o=n.current,c=oa(),_=Fl(o),b=Bo(c,_),b.callback=r??null,Rl(o,b,_),n.current.lanes=_,Sd(n,_,c),Pa(n,c),n}function Ep(n,r,o,c){var _=r.current,b=oa(),x=Fl(_);return o=jw(o),r.context===null?r.context=o:r.pendingContext=o,r=Bo(b,x),r.payload={element:n},c=c===void 0?null:c,c!==null&&(r.callback=c),n=Rl(_,r,x),n!==null&&(Rs(n,_,x,b),Mf(n,_,x)),x}function up(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function nx(n,r){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var o=n.retryLane;n.retryLane=o!==0&&o<r?o:r}}function n_(n,r){nx(n,r),(n=n.alternate)&&nx(n,r)}function bC(){return null}var Vw=typeof reportError=="function"?reportError:function(n){console.error(n)};function i_(n){this._internalRoot=n}Ap.prototype.render=i_.prototype.render=function(n){var r=this._internalRoot;if(r===null)throw Error(ht(409));Ep(n,r,null,null)};Ap.prototype.unmount=i_.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var r=n.containerInfo;Au(function(){Ep(null,n,null,null)}),r[jo]=null}};function Ap(n){this._internalRoot=n}Ap.prototype.unstable_scheduleHydration=function(n){if(n){var r=v1();n={blockedOn:null,target:n,priority:r};for(var o=0;o<Sl.length&&r!==0&&r<Sl[o].priority;o++);Sl.splice(o,0,n),o===0&&w1(n)}};function a_(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Mp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function ix(){}function SC(n,r,o,c,_){if(_){if(typeof c=="function"){var b=c;c=function(){var q=up(x);b.call(q)}}var x=Uw(r,c,n,0,null,!1,!1,"",ix);return n._reactRootContainer=x,n[jo]=x.current,dd(n.nodeType===8?n.parentNode:n),Au(),x}for(;_=n.lastChild;)n.removeChild(_);if(typeof c=="function"){var h=c;c=function(){var q=up(j);h.call(q)}}var j=r_(n,0,!1,null,null,!1,!1,"",ix);return n._reactRootContainer=j,n[jo]=j.current,dd(n.nodeType===8?n.parentNode:n),Au(function(){Ep(r,j,o,c)}),j}function Dp(n,r,o,c,_){var b=o._reactRootContainer;if(b){var x=b;if(typeof _=="function"){var h=_;_=function(){var j=up(x);h.call(j)}}Ep(r,x,n,_)}else x=SC(o,r,n,_,c);return up(x)}y1=function(n){switch(n.tag){case 3:var r=n.stateNode;if(r.current.memoizedState.isDehydrated){var o=Gh(r.pendingLanes);o!==0&&(ky(r,o|1),Pa(r,Kn()),!(qr&6)&&(qc=Kn()+500,ql()))}break;case 13:Au(function(){var c=Uo(n,1);if(c!==null){var _=oa();Rs(c,n,1,_)}}),n_(n,1)}};Cy=function(n){if(n.tag===13){var r=Uo(n,134217728);if(r!==null){var o=oa();Rs(r,n,134217728,o)}n_(n,134217728)}};_1=function(n){if(n.tag===13){var r=Fl(n),o=Uo(n,r);if(o!==null){var c=oa();Rs(o,n,r,c)}n_(n,r)}};v1=function(){return rn};x1=function(n,r){var o=rn;try{return rn=n,r()}finally{rn=o}};Ig=function(n,r,o){switch(r){case"input":if(xg(n,o),r=o.name,o.type==="radio"&&r!=null){for(o=n;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<o.length;r++){var c=o[r];if(c!==n&&c.form===n.form){var _=bp(c);if(!_)throw Error(ht(90));Yx(c),xg(c,_)}}}break;case"textarea":Qx(n,o);break;case"select":r=o.value,r!=null&&Mc(n,!!o.multiple,r,!1)}};s1=Jy;o1=Au;var kC={usingClientEntryPoint:!1,Events:[Cd,Sc,bp,i1,a1,Jy]},Uh={findFiberByHostInstance:_u,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},CC={bundleType:Uh.bundleType,version:Uh.version,rendererPackageName:Uh.rendererPackageName,rendererConfig:Uh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$o.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=c1(n),n===null?null:n.stateNode},findFiberByHostInstance:Uh.findFiberByHostInstance||bC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xf.isDisabled&&xf.supportsFiber)try{_p=xf.inject(CC),oo=xf}catch{}}Za.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kC;Za.createPortal=function(n,r){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!a_(r))throw Error(ht(200));return wC(n,r,null,o)};Za.createRoot=function(n,r){if(!a_(n))throw Error(ht(299));var o=!1,c="",_=Vw;return r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onRecoverableError!==void 0&&(_=r.onRecoverableError)),r=r_(n,1,!1,null,null,o,!1,c,_),n[jo]=r.current,dd(n.nodeType===8?n.parentNode:n),new i_(r)};Za.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var r=n._reactInternals;if(r===void 0)throw typeof n.render=="function"?Error(ht(188)):(n=Object.keys(n).join(","),Error(ht(268,n)));return n=c1(r),n=n===null?null:n.stateNode,n};Za.flushSync=function(n){return Au(n)};Za.hydrate=function(n,r,o){if(!Mp(r))throw Error(ht(200));return Dp(null,n,r,!0,o)};Za.hydrateRoot=function(n,r,o){if(!a_(n))throw Error(ht(405));var c=o!=null&&o.hydratedSources||null,_=!1,b="",x=Vw;if(o!=null&&(o.unstable_strictMode===!0&&(_=!0),o.identifierPrefix!==void 0&&(b=o.identifierPrefix),o.onRecoverableError!==void 0&&(x=o.onRecoverableError)),r=Uw(r,null,n,1,o??null,_,!1,b,x),n[jo]=r.current,dd(n),c)for(n=0;n<c.length;n++)o=c[n],_=o._getVersion,_=_(o._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[o,_]:r.mutableSourceEagerHydrationData.push(o,_);return new Ap(r)};Za.render=function(n,r,o){if(!Mp(r))throw Error(ht(200));return Dp(null,n,r,!1,o)};Za.unmountComponentAtNode=function(n){if(!Mp(n))throw Error(ht(40));return n._reactRootContainer?(Au(function(){Dp(null,null,n,!1,function(){n._reactRootContainer=null,n[jo]=null})}),!0):!1};Za.unstable_batchedUpdates=Jy;Za.unstable_renderSubtreeIntoContainer=function(n,r,o,c){if(!Mp(o))throw Error(ht(200));if(n==null||n._reactInternals===void 0)throw Error(ht(38));return Dp(n,r,o,!1,c)};Za.version="18.3.1-next-f1338f8080-20240426";function $w(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE($w)}catch(n){console.error(n)}}$w(),$x.exports=Za;var TC=$x.exports,ax=TC;fg.createRoot=ax.createRoot,fg.hydrateRoot=ax.hydrateRoot;var qw={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(n,r){(function(o,c){n.exports=c()})(Nf,function(){var o={},c={};function _(x,h,j){if(c[x]=j,x==="index"){var q="var sharedModule = {}; ("+c.shared+")(sharedModule); ("+c.worker+")(sharedModule);",le={};return c.shared(le),c.index(o,le),typeof window<"u"&&o.setWorkerUrl(window.URL.createObjectURL(new Blob([q],{type:"text/javascript"}))),o}}_("shared",["exports"],function(x){function h(i,t,a,l){return new(a||(a=Promise))(function(f,g){function y(P){try{C(l.next(P))}catch(A){g(A)}}function w(P){try{C(l.throw(P))}catch(A){g(A)}}function C(P){var A;P.done?f(P.value):(A=P.value,A instanceof a?A:new a(function(z){z(A)})).then(y,w)}C((l=l.apply(i,t||[])).next())})}function j(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var q=le;function le(i,t){this.x=i,this.y=t}le.prototype={clone:function(){return new le(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,a=i.y-this.y;return t*t+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),a=Math.sin(i),l=a*this.x+t*this.y;return this.x=t*this.x-a*this.y,this.y=l,this},_rotateAround:function(i,t){var a=Math.cos(i),l=Math.sin(i),f=t.y+l*(this.x-t.x)+a*(this.y-t.y);return this.x=t.x+a*(this.x-t.x)-l*(this.y-t.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},le.convert=function(i){return i instanceof le?i:Array.isArray(i)?new le(i[0],i[1]):i};var Y=j(q),W=$e;function $e(i,t,a,l){this.cx=3*i,this.bx=3*(a-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=a,this.p2y=l}$e.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var a=i,l=0;l<8;l++){var f=this.sampleCurveX(a)-i;if(Math.abs(f)<t)return a;var g=this.sampleCurveDerivativeX(a);if(Math.abs(g)<1e-6)break;a-=f/g}var y=0,w=1;for(a=i,l=0;l<20&&(f=this.sampleCurveX(a),!(Math.abs(f-i)<t));l++)i>f?y=a:w=a,a=.5*(w-y)+y;return a},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var He=j(W);let Je,Qt;function be(){return Je==null&&(Je=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Je}function pe(){if(Qt==null&&(Qt=!1,be())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let l=0;l<5*5;l++){const f=4*l;t.fillStyle=`rgb(${f},${f+1},${f+2})`,t.fillRect(l%5,Math.floor(l/5),1,1)}const a=t.getImageData(0,0,5,5).data;for(let l=0;l<5*5*4;l++)if(l%4!=3&&a[l]!==l){Qt=!0;break}}}return Qt||!1}function ke(i,t,a,l){const f=new He(i,t,a,l);return g=>f.solve(g)}const Ve=ke(.25,.1,.25,1);function et(i,t,a){return Math.min(a,Math.max(t,i))}function ut(i,t,a){const l=a-t,f=((i-t)%l+l)%l+t;return f===t?a:f}function Qe(i,...t){for(const a of t)for(const l in a)i[l]=a[l];return i}let ce=1;function me(i,t,a){const l={};for(const f in i)l[f]=t.call(this,i[f],f,i);return l}function Le(i,t,a){const l={};for(const f in i)t.call(this,i[f],f,i)&&(l[f]=i[f]);return l}function Ye(i){return Array.isArray(i)?i.map(Ye):typeof i=="object"&&i?me(i,Ye):i}const Tt={};function Ot(i){Tt[i]||(typeof console<"u"&&console.warn(i),Tt[i]=!0)}function vr(i,t,a){return(a.y-i.y)*(t.x-i.x)>(t.y-i.y)*(a.x-i.x)}function Kr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Hr=null;function nr(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Ke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function We(i,t,a,l,f){return h(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(i,{timestamp:0});try{const y=g?.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const w=y.startsWith("BGR"),C=new Uint8ClampedArray(l*f*4);if(yield g.copyTo(C,function(P,A,z,O,U){const K=4*Math.max(-A,0),G=(Math.max(0,z)-z)*O*4+K,te=4*O,ie=Math.max(0,A),ze=Math.max(0,z);return{rect:{x:ie,y:ze,width:Math.min(P.width,A+O)-ie,height:Math.min(P.height,z+U)-ze},layout:[{offset:G,stride:te}]}}(i,t,a,l,f)),w)for(let P=0;P<C.length;P+=4){const A=C[P];C[P]=C[P+2],C[P+2]=A}return C}finally{g.close()}})}let gt,yt;const Rt="AbortError";function It(){return new Error(Rt)}const Sr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function wr(i){return Sr.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const kr="global-dispatcher";class zr extends Error{constructor(t,a,l,f){super(`AJAXError: ${a} (${t}): ${l}`),this.status=t,this.statusText=a,this.url=l,this.body=f}}const ur=()=>Kr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ct=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const l=wr(i.url);if(l)return l(i,t);if(Kr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:kr},t)}if(!(/^file:/.test(a=i.url)||/^file:/.test(ur())&&!/^\w+:/.test(a))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(l,f){return h(this,void 0,void 0,function*(){const g=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:ur(),signal:f.signal});l.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");const y=yield fetch(g);if(!y.ok){const P=yield y.blob();throw new zr(y.status,y.statusText,l.url,P)}let w;w=l.type==="arrayBuffer"||l.type==="image"?y.arrayBuffer():l.type==="json"?y.json():y.text();const C=yield w;if(f.signal.aborted)throw It();return{data:C,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}})}(i,t);if(Kr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:kr},t)}var a;return function(l,f){return new Promise((g,y)=>{var w;const C=new XMLHttpRequest;C.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(C.responseType="arraybuffer");for(const P in l.headers)C.setRequestHeader(P,l.headers[P]);l.type==="json"&&(C.responseType="text",!((w=l.headers)===null||w===void 0)&&w.Accept||C.setRequestHeader("Accept","application/json")),C.withCredentials=l.credentials==="include",C.onerror=()=>{y(new Error(C.statusText))},C.onload=()=>{if(!f.signal.aborted)if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){let P=C.response;if(l.type==="json")try{P=JSON.parse(C.response)}catch(A){return void y(A)}g({data:P,cacheControl:C.getResponseHeader("Cache-Control"),expires:C.getResponseHeader("Expires")})}else{const P=new Blob([C.response],{type:C.getResponseHeader("Content-Type")});y(new zr(C.status,C.statusText,l.url,P))}},f.signal.addEventListener("abort",()=>{C.abort(),y(It())}),C.send(l.body)})}(i,t)};function Br(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),a=window.location;return t.protocol===a.protocol&&t.host===a.host}function cr(i,t,a){a[i]&&a[i].indexOf(t)!==-1||(a[i]=a[i]||[],a[i].push(t))}function Gt(i,t,a){if(a&&a[i]){const l=a[i].indexOf(t);l!==-1&&a[i].splice(l,1)}}class Nr{constructor(t,a={}){Qe(this,a),this.type=t}}class Lr extends Nr{constructor(t,a={}){super("error",Qe({error:t},a))}}class gr{on(t,a){return this._listeners=this._listeners||{},cr(t,a,this._listeners),this}off(t,a){return Gt(t,a,this._listeners),Gt(t,a,this._oneTimeListeners),this}once(t,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},cr(t,a,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,a){typeof t=="string"&&(t=new Nr(t,a||{}));const l=t.type;if(this.listens(l)){t.target=this;const f=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const w of f)w.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const w of g)Gt(l,w,this._oneTimeListeners),w.call(this,t);const y=this._eventedParent;y&&(Qe(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(t))}else t instanceof Lr&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,a){return this._eventedParent=t,this._eventedParentData=a,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const nn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Tr(i,t){const a={};for(const l in i)l!=="ref"&&(a[l]=i[l]);return nn.forEach(l=>{l in t&&(a[l]=t[l])}),a}function Wt(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let a=0;a<i.length;a++)if(!Wt(i[a],t[a]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const a in i)if(!Wt(i[a],t[a]))return!1;return!0}return i===t}function dr(i,t){i.push(t)}function _n(i,t,a){dr(a,{command:"addSource",args:[i,t[i]]})}function Sn(i,t,a){dr(t,{command:"removeSource",args:[i]}),a[i]=!0}function An(i,t,a,l){Sn(i,a,l),_n(i,t,a)}function an(i,t,a){let l;for(l in i[a])if(Object.prototype.hasOwnProperty.call(i[a],l)&&l!=="data"&&!Wt(i[a][l],t[a][l]))return!1;for(l in t[a])if(Object.prototype.hasOwnProperty.call(t[a],l)&&l!=="data"&&!Wt(i[a][l],t[a][l]))return!1;return!0}function Zr(i,t,a,l,f,g){i=i||{},t=t||{};for(const y in i)Object.prototype.hasOwnProperty.call(i,y)&&(Wt(i[y],t[y])||a.push({command:g,args:[l,y,t[y],f]}));for(const y in t)Object.prototype.hasOwnProperty.call(t,y)&&!Object.prototype.hasOwnProperty.call(i,y)&&(Wt(i[y],t[y])||a.push({command:g,args:[l,y,t[y],f]}))}function Vr(i){return i.id}function Yr(i,t){return i[t.id]=t,i}class rt{constructor(t,a,l,f){this.message=(t?`${t}: `:"")+l,f&&(this.identifier=f),a!=null&&a.__line__&&(this.line=a.__line__)}}function Fn(i,...t){for(const a of t)for(const l in a)i[l]=a[l];return i}class kn extends Error{constructor(t,a){super(a),this.message=a,this.key=t}}class Cn{constructor(t,a=[]){this.parent=t,this.bindings={};for(const[l,f]of a)this.bindings[l]=f}concat(t){return new Cn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const en={kind:"null"},at={kind:"number"},lr={kind:"string"},Ht={kind:"boolean"},zt={kind:"color"},ti={kind:"object"},er={kind:"value"},bi={kind:"collator"},wt={kind:"formatted"},ca={kind:"padding"},Xi={kind:"resolvedImage"},ne={kind:"variableAnchorOffsetCollection"};function N(i,t){return{kind:"array",itemType:i,N:t}}function B(i){if(i.kind==="array"){const t=B(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const H=[en,at,lr,Ht,zt,wt,ti,N(er),ca,Xi,ne];function ee(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ee(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const a of H)if(!ee(a,t))return null}}return`Expected ${B(i)} but found ${B(t)} instead.`}function fe(i,t){return t.some(a=>a.kind===i.kind)}function _e(i,t){return t.some(a=>a==="null"?i===null:a==="array"?Array.isArray(i):a==="object"?i&&!Array.isArray(i)&&typeof i=="object":a===typeof i)}function Ae(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const ue=.96422,Oe=.82521,qe=4/29,Be=6/29,ot=3*Be*Be,Ft=Be*Be*Be,$t=Math.PI/180,Er=180/Math.PI;function tr(i){return(i%=360)<0&&(i+=360),i}function xr([i,t,a,l]){let f,g;const y=dn((.2225045*(i=hr(i))+.7168786*(t=hr(t))+.0606169*(a=hr(a)))/1);i===t&&t===a?f=g=y:(f=dn((.4360747*i+.3850649*t+.1430804*a)/ue),g=dn((.0139322*i+.0971045*t+.7141733*a)/Oe));const w=116*y-16;return[w<0?0:w,500*(f-y),200*(y-g),l]}function hr(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function dn(i){return i>Ft?Math.pow(i,1/3):i/ot+qe}function fn([i,t,a,l]){let f=(i+16)/116,g=isNaN(t)?f:f+t/500,y=isNaN(a)?f:f-a/200;return f=1*jr(f),g=ue*jr(g),y=Oe*jr(y),[sr(3.1338561*g-1.6168667*f-.4906146*y),sr(-.9787684*g+1.9161415*f+.033454*y),sr(.0719453*g-.2289914*f+1.4052427*y),l]}function sr(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function jr(i){return i>Be?i*i*i:ot*(i-qe)}function Ur(i){return parseInt(i.padEnd(2,i),16)/255}function Mn(i,t){return Dn(t?i/100:i,0,1)}function Dn(i,t,a){return Math.min(Math.max(t,i),a)}function Ar(i){return!i.some(Number.isNaN)}const zi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class br{constructor(t,a,l,f=1,g=!0){this.r=t,this.g=a,this.b=l,this.a=f,g||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[t,a,l,f]))}static parse(t){if(t instanceof br)return t;if(typeof t!="string")return;const a=function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=zi[l];if(f){const[y,w,C]=f;return[y/255,w/255,C/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const y=l.length<6?1:2;let w=1;return[Ur(l.slice(w,w+=y)),Ur(l.slice(w,w+=y)),Ur(l.slice(w,w+=y)),Ur(l.slice(w,w+y)||"ff")]}if(l.startsWith("rgb")){const y=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[w,C,P,A,z,O,U,K,G,te,ie,ze]=y,ge=[A||" ",U||" ",te].join("");if(ge==="  "||ge==="  /"||ge===",,"||ge===",,,"){const Pe=[P,O,G].join(""),je=Pe==="%%%"?100:Pe===""?255:0;if(je){const nt=[Dn(+C/je,0,1),Dn(+z/je,0,1),Dn(+K/je,0,1),ie?Mn(+ie,ze):1];if(Ar(nt))return nt}}return}}const g=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,w,C,P,A,z,O,U,K]=g,G=[C||" ",A||" ",O].join("");if(G==="  "||G==="  /"||G===",,"||G===",,,"){const te=[+w,Dn(+P,0,100),Dn(+z,0,100),U?Mn(+U,K):1];if(Ar(te))return function([ie,ze,ge,Pe]){function je(nt){const Pt=(nt+ie/30)%12,Xt=ze*Math.min(ge,1-ge);return ge-Xt*Math.max(-1,Math.min(Pt-3,9-Pt,1))}return ie=tr(ie),ze/=100,ge/=100,[je(0),je(8),je(4),Pe]}(te)}}}(t);return a?new br(...a,!1):void 0}get rgb(){const{r:t,g:a,b:l,a:f}=this,g=f||1/0;return this.overwriteGetter("rgb",[t/g,a/g,l/g,f])}get hcl(){return this.overwriteGetter("hcl",function(t){const[a,l,f,g]=xr(t),y=Math.sqrt(l*l+f*f);return[Math.round(1e4*y)?tr(Math.atan2(f,l)*Er):NaN,y,a,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",xr(this.rgb))}overwriteGetter(t,a){return Object.defineProperty(this,t,{value:a}),a}toString(){const[t,a,l,f]=this.rgb;return`rgba(${[t,a,l].map(g=>Math.round(255*g)).join(",")},${f})`}}br.black=new br(0,0,0,1),br.white=new br(1,1,1,1),br.transparent=new br(0,0,0,0),br.red=new br(1,0,0,1);class qo{constructor(t,a,l){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,a){return this.collator.compare(t,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xa{constructor(t,a,l,f,g){this.text=t,this.image=a,this.scale=l,this.fontStack=f,this.textColor=g}}class Hn{constructor(t){this.sections=t}static fromString(t){return new Hn([new Xa(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Hn?t:Hn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class ri{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ri)return t;if(typeof t=="number")return new ri([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const a of t)if(typeof a!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new ri(t)}}toString(){return JSON.stringify(this.values)}}const Gl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Bn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Bn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let a=0;a<t.length;a+=2){const l=t[a],f=t[a+1];if(typeof l!="string"||!Gl.has(l)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new Bn(t)}}toString(){return JSON.stringify(this.values)}}class ci{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ci({name:t,available:!1}):null}}function Ea(i,t,a,l){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,t,a,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,t,a,l]:[i,t,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ya(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof br||i instanceof qo||i instanceof Hn||i instanceof ri||i instanceof Bn||i instanceof ci)return!0;if(Array.isArray(i)){for(const t of i)if(!Ya(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Ya(i[t]))return!1;return!0}return!1}function rr(i){if(i===null)return en;if(typeof i=="string")return lr;if(typeof i=="boolean")return Ht;if(typeof i=="number")return at;if(i instanceof br)return zt;if(i instanceof qo)return bi;if(i instanceof Hn)return wt;if(i instanceof ri)return ca;if(i instanceof Bn)return ne;if(i instanceof ci)return Xi;if(Array.isArray(i)){const t=i.length;let a;for(const l of i){const f=rr(l);if(a){if(a===f)continue;a=er;break}a=f}return N(a||er,t)}return ti}function Bs(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof br||i instanceof Hn||i instanceof ri||i instanceof Bn||i instanceof ci?i.toString():JSON.stringify(i)}class Li{constructor(t,a){this.type=t,this.value=a}static parse(t,a){if(t.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ya(t[1]))return a.error("invalid value");const l=t[1];let f=rr(l);const g=a.expectedType;return f.kind!=="array"||f.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(f=g),new Li(f,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class sn{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ja={string:lr,number:at,boolean:Ht,object:ti};class Ri{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");let l,f=1;const g=t[0];if(g==="array"){let w,C;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in Ja)||P==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);w=Ja[P],f++}else w=er;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);C=t[2],f++}l=N(w,C)}else{if(!Ja[g])throw new Error(`Types doesn't contain name = ${g}`);l=Ja[g]}const y=[];for(;f<t.length;f++){const w=a.parse(t[f],f,er);if(!w)return null;y.push(w)}return new Ri(l,y)}evaluate(t){for(let a=0;a<this.args.length;a++){const l=this.args[a].evaluate(t);if(!ee(this.type,rr(l)))return l;if(a===this.args.length-1)throw new sn(`Expected value to be of type ${B(this.type)}, but found ${B(rr(l))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Ko={"to-boolean":Ht,"to-color":zt,"to-number":at,"to-string":lr};class Oi{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const l=t[0];if(!Ko[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&t.length!==2)return a.error("Expected one argument.");const f=Ko[l],g=[];for(let y=1;y<t.length;y++){const w=a.parse(t[y],y,er);if(!w)return null;g.push(w)}return new Oi(f,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let a,l;for(const f of this.args){if(a=f.evaluate(t),l=null,a instanceof br)return a;if(typeof a=="string"){const g=t.parseColor(a);if(g)return g}else if(Array.isArray(a)&&(l=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Ea(a[0],a[1],a[2],a[3]),!l))return new br(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new sn(l||`Could not parse color from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"padding":{let a;for(const l of this.args){a=l.evaluate(t);const f=ri.parse(a);if(f)return f}throw new sn(`Could not parse padding from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"variableAnchorOffsetCollection":{let a;for(const l of this.args){a=l.evaluate(t);const f=Bn.parse(a);if(f)return f}throw new sn(`Could not parse variableAnchorOffsetCollection from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"number":{let a=null;for(const l of this.args){if(a=l.evaluate(t),a===null)return 0;const f=Number(a);if(!isNaN(f))return f}throw new sn(`Could not convert ${JSON.stringify(a)} to number.`)}case"formatted":return Hn.fromString(Bs(this.args[0].evaluate(t)));case"resolvedImage":return ci.fromString(Bs(this.args[0].evaluate(t)));default:return Bs(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Jr=["Unknown","Point","LineString","Polygon"];class Qa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Jr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=br.parse(t)),a}}class Yi{constructor(t,a,l=[],f,g=new Cn,y=[]){this.registry=t,this.path=l,this.key=l.map(w=>`[${w}]`).join(""),this.scope=g,this.errors=y,this.expectedType=f,this._isConstant=a}parse(t,a,l,f,g={}){return a?this.concat(a,l,f)._parse(t,g):this._parse(t,g)}_parse(t,a){function l(f,g,y){return y==="assert"?new Ri(g,[f]):y==="coerce"?new Oi(g,[f]):f}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=t[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[f];if(g){let y=g.parse(t,this);if(!y)return null;if(this.expectedType){const w=this.expectedType,C=y.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||C.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(w.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array")if(w.kind!=="variableAnchorOffsetCollection"||C.kind!=="value"&&C.kind!=="array"){if(this.checkSubtype(w,C))return null}else y=l(y,w,a.typeAnnotation||"coerce");else y=l(y,w,a.typeAnnotation||"coerce");else y=l(y,w,a.typeAnnotation||"coerce");else y=l(y,w,a.typeAnnotation||"assert")}if(!(y instanceof Li)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const w=new Qa;try{y=new Li(y.type,y.evaluate(w))}catch(C){return this.error(C.message),null}}return y}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,a,l){const f=typeof t=="number"?this.path.concat(t):this.path,g=l?this.scope.concat(l):this.scope;return new Yi(this.registry,this._isConstant,f,a||null,g,this.errors)}error(t,...a){const l=`${this.key}${a.map(f=>`[${f}]`).join("")}`;this.errors.push(new kn(l,t))}checkSubtype(t,a){const l=ee(t,a);return l&&this.error(l),l}}class Si{constructor(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const a of this.bindings)t(a[1]);t(this.result)}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let g=1;g<t.length-1;g+=2){const y=t[g];if(typeof y!="string")return a.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return a.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=a.parse(t[g+1],g+1);if(!w)return null;l.push([y,w])}const f=a.parse(t[t.length-1],t.length-1,a.expectedType,l);return f?new Si(l,f):null}outputDefined(){return this.result.outputDefined()}}class Mr{constructor(t,a){this.type=a.type,this.name=t,this.boundExpression=a}static parse(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const l=t[1];return a.scope.has(l)?new Mr(l,a.scope.get(l)):a.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ho{constructor(t,a,l){this.type=t,this.index=a,this.input=l}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=a.parse(t[1],1,at),f=a.parse(t[2],2,N(a.expectedType||er));return l&&f?new ho(f.type.itemType,l,f):null}evaluate(t){const a=this.index.evaluate(t),l=this.input.evaluate(t);if(a<0)throw new sn(`Array index out of bounds: ${a} < 0.`);if(a>=l.length)throw new sn(`Array index out of bounds: ${a} > ${l.length-1}.`);if(a!==Math.floor(a))throw new sn(`Array index must be an integer, but found ${a} instead.`);return l[a]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Ns{constructor(t,a){this.type=Ht,this.needle=t,this.haystack=a}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=a.parse(t[1],1,er),f=a.parse(t[2],2,er);return l&&f?fe(l.type,[Ht,lr,at,en,er])?new Ns(l,f):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${B(l.type)} instead`):null}evaluate(t){const a=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!_e(a,["boolean","string","number","null"]))throw new sn(`Expected first argument to be of type boolean, string, number or null, but found ${B(rr(a))} instead.`);if(!_e(l,["string","array"]))throw new sn(`Expected second argument to be of type array or string, but found ${B(rr(l))} instead.`);return l.indexOf(a)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class _s{constructor(t,a,l){this.type=at,this.needle=t,this.haystack=a,this.fromIndex=l}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=a.parse(t[1],1,er),f=a.parse(t[2],2,er);if(!l||!f)return null;if(!fe(l.type,[Ht,lr,at,en,er]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${B(l.type)} instead`);if(t.length===4){const g=a.parse(t[3],3,at);return g?new _s(l,f,g):null}return new _s(l,f)}evaluate(t){const a=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!_e(a,["boolean","string","number","null"]))throw new sn(`Expected first argument to be of type boolean, string, number or null, but found ${B(rr(a))} instead.`);let f;if(this.fromIndex&&(f=this.fromIndex.evaluate(t)),_e(l,["string"])){const g=l.indexOf(a,f);return g===-1?-1:[...l.slice(0,g)].length}if(_e(l,["array"]))return l.indexOf(a,f);throw new sn(`Expected second argument to be of type array or string, but found ${B(rr(l))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class js{constructor(t,a,l,f,g,y){this.inputType=t,this.type=a,this.input=l,this.cases=f,this.outputs=g,this.otherwise=y}static parse(t,a){if(t.length<5)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return a.error("Expected an even number of arguments.");let l,f;a.expectedType&&a.expectedType.kind!=="value"&&(f=a.expectedType);const g={},y=[];for(let P=2;P<t.length-1;P+=2){let A=t[P];const z=t[P+1];Array.isArray(A)||(A=[A]);const O=a.concat(P);if(A.length===0)return O.error("Expected at least one branch label.");for(const K of A){if(typeof K!="number"&&typeof K!="string")return O.error("Branch labels must be numbers or strings.");if(typeof K=="number"&&Math.abs(K)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof K=="number"&&Math.floor(K)!==K)return O.error("Numeric branch labels must be integer values.");if(l){if(O.checkSubtype(l,rr(K)))return null}else l=rr(K);if(g[String(K)]!==void 0)return O.error("Branch labels must be unique.");g[String(K)]=y.length}const U=a.parse(z,P,f);if(!U)return null;f=f||U.type,y.push(U)}const w=a.parse(t[1],1,er);if(!w)return null;const C=a.parse(t[t.length-1],t.length-1,f);return C?w.type.kind!=="value"&&a.concat(1).checkSubtype(l,w.type)?null:new js(l,f,w,g,y,C):null}evaluate(t){const a=this.input.evaluate(t);return(rr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class fo{constructor(t,a,l){this.type=t,this.branches=a,this.otherwise=l}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return a.error("Expected an odd number of arguments.");let l;a.expectedType&&a.expectedType.kind!=="value"&&(l=a.expectedType);const f=[];for(let y=1;y<t.length-1;y+=2){const w=a.parse(t[y],y,Ht);if(!w)return null;const C=a.parse(t[y+1],y+1,l);if(!C)return null;f.push([w,C]),l=l||C.type}const g=a.parse(t[t.length-1],t.length-1,l);if(!g)return null;if(!l)throw new Error("Can't infer output type");return new fo(l,f,g)}evaluate(t){for(const[a,l]of this.branches)if(a.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[a,l]of this.branches)t(a),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,a])=>a.outputDefined())&&this.otherwise.outputDefined()}}class po{constructor(t,a,l,f){this.type=t,this.input=a,this.beginIndex=l,this.endIndex=f}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=a.parse(t[1],1,er),f=a.parse(t[2],2,at);if(!l||!f)return null;if(!fe(l.type,[N(er),lr,er]))return a.error(`Expected first argument to be of type array or string, but found ${B(l.type)} instead`);if(t.length===4){const g=a.parse(t[3],3,at);return g?new po(l.type,l,f,g):null}return new po(l.type,l,f)}evaluate(t){const a=this.input.evaluate(t),l=this.beginIndex.evaluate(t);let f;if(this.endIndex&&(f=this.endIndex.evaluate(t)),_e(a,["string"]))return[...a].slice(l,f).join("");if(_e(a,["array"]))return a.slice(l,f);throw new sn(`Expected first argument to be of type array or string, but found ${B(rr(a))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Dr(i,t){const a=i.length-1;let l,f,g=0,y=a,w=0;for(;g<=y;)if(w=Math.floor((g+y)/2),l=i[w],f=i[w+1],l<=t){if(w===a||t<f)return w;g=w+1}else{if(!(l>t))throw new sn("Input is not a number.");y=w-1}return 0}class vs{constructor(t,a,l){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(const[f,g]of l)this.labels.push(f),this.outputs.push(g)}static parse(t,a){if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");const l=a.parse(t[1],1,at);if(!l)return null;const f=[];let g=null;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);for(let y=1;y<t.length;y+=2){const w=y===1?-1/0:t[y],C=t[y+1],P=y,A=y+1;if(typeof w!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(f.length&&f[f.length-1][0]>=w)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const z=a.parse(C,A,g);if(!z)return null;g=g||z.type,f.push([w,z])}return new vs(g,l,f)}evaluate(t){const a=this.labels,l=this.outputs;if(a.length===1)return l[0].evaluate(t);const f=this.input.evaluate(t);if(f<=a[0])return l[0].evaluate(t);const g=a.length;return f>=a[g-1]?l[g-1].evaluate(t):l[Dr(a,f)].evaluate(t)}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Bu(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Xc=hi;function hi(i,t,a,l){this.cx=3*i,this.bx=3*(a-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=a,this.p2y=l}hi.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var a=i,l=0;l<8;l++){var f=this.sampleCurveX(a)-i;if(Math.abs(f)<t)return a;var g=this.sampleCurveDerivativeX(a);if(Math.abs(g)<1e-6)break;a-=f/g}var y=0,w=1;for(a=i,l=0;l<20&&(f=this.sampleCurveX(a),!(Math.abs(f-i)<t));l++)i>f?y=a:w=a,a=.5*(w-y)+y;return a},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Us=Bu(Xc);function ha(i,t,a){return i+a*(t-i)}function Fi(i,t,a){return i.map((l,f)=>ha(l,t[f],a))}const ni={number:ha,color:function(i,t,a,l="rgb"){switch(l){case"rgb":{const[f,g,y,w]=Fi(i.rgb,t.rgb,a);return new br(f,g,y,w,!1)}case"hcl":{const[f,g,y,w]=i.hcl,[C,P,A,z]=t.hcl;let O,U;if(isNaN(f)||isNaN(C))isNaN(f)?isNaN(C)?O=NaN:(O=C,y!==1&&y!==0||(U=P)):(O=f,A!==1&&A!==0||(U=g));else{let ze=C-f;C>f&&ze>180?ze-=360:C<f&&f-C>180&&(ze+=360),O=f+a*ze}const[K,G,te,ie]=function([ze,ge,Pe,je]){return ze=isNaN(ze)?0:ze*$t,fn([Pe,Math.cos(ze)*ge,Math.sin(ze)*ge,je])}([O,U??ha(g,P,a),ha(y,A,a),ha(w,z,a)]);return new br(K,G,te,ie,!1)}case"lab":{const[f,g,y,w]=fn(Fi(i.lab,t.lab,a));return new br(f,g,y,w,!1)}}},array:Fi,padding:function(i,t,a){return new ri(Fi(i.values,t.values,a))},variableAnchorOffsetCollection:function(i,t,a){const l=i.values,f=t.values;if(l.length!==f.length)throw new sn(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const g=[];for(let y=0;y<l.length;y+=2){if(l[y]!==f[y])throw new sn(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${l[y]}, to[${y}]: ${f[y]}`);g.push(l[y]);const[w,C]=l[y+1],[P,A]=f[y+1];g.push([ha(w,P,a),ha(C,A,a)])}return new Bn(g)}};class ii{constructor(t,a,l,f,g){this.type=t,this.operator=a,this.interpolation=l,this.input=f,this.labels=[],this.outputs=[];for(const[y,w]of g)this.labels.push(y),this.outputs.push(w)}static interpolationFactor(t,a,l,f){let g=0;if(t.name==="exponential")g=vn(a,t.base,l,f);else if(t.name==="linear")g=vn(a,1,l,f);else if(t.name==="cubic-bezier"){const y=t.controlPoints;g=new Us(y[0],y[1],y[2],y[3]).solve(vn(a,1,l,f))}return g}static parse(t,a){let[l,f,g,...y]=t;if(!Array.isArray(f)||f.length===0)return a.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const P=f[1];if(typeof P!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:P}}else{if(f[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const P=f.slice(1);if(P.length!==4||P.some(A=>typeof A!="number"||A<0||A>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(g=a.parse(g,2,at),!g)return null;const w=[];let C=null;l==="interpolate-hcl"||l==="interpolate-lab"?C=zt:a.expectedType&&a.expectedType.kind!=="value"&&(C=a.expectedType);for(let P=0;P<y.length;P+=2){const A=y[P],z=y[P+1],O=P+3,U=P+4;if(typeof A!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(w.length&&w[w.length-1][0]>=A)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const K=a.parse(z,U,C);if(!K)return null;C=C||K.type,w.push([A,K])}return Ae(C,at)||Ae(C,zt)||Ae(C,ca)||Ae(C,ne)||Ae(C,N(at))?new ii(C,l,f,g,w):a.error(`Type ${B(C)} is not interpolatable.`)}evaluate(t){const a=this.labels,l=this.outputs;if(a.length===1)return l[0].evaluate(t);const f=this.input.evaluate(t);if(f<=a[0])return l[0].evaluate(t);const g=a.length;if(f>=a[g-1])return l[g-1].evaluate(t);const y=Dr(a,f),w=ii.interpolationFactor(this.interpolation,f,a[y],a[y+1]),C=l[y].evaluate(t),P=l[y+1].evaluate(t);switch(this.operator){case"interpolate":return ni[this.type.kind](C,P,w);case"interpolate-hcl":return ni.color(C,P,w,"hcl");case"interpolate-lab":return ni.color(C,P,w,"lab")}}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function vn(i,t,a,l){const f=l-a,g=i-a;return f===0?0:t===1?g/f:(Math.pow(t,g)-1)/(Math.pow(t,f)-1)}class ki{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expectected at least one argument.");let l=null;const f=a.expectedType;f&&f.kind!=="value"&&(l=f);const g=[];for(const w of t.slice(1)){const C=a.parse(w,1+g.length,l,void 0,{typeAnnotation:"omit"});if(!C)return null;l=l||C.type,g.push(C)}if(!l)throw new Error("No output type");const y=f&&g.some(w=>ee(f,w.type));return new ki(y?er:l,g)}evaluate(t){let a,l=null,f=0;for(const g of this.args)if(f++,l=g.evaluate(t),l&&l instanceof ci&&!l.available&&(a||(a=l.name),l=null,f===this.args.length&&(l=a)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function es(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Vs(i,t,a,l){return l.compare(t,a)===0}function ts(i,t,a){const l=i!=="=="&&i!=="!=";return class Kw{constructor(g,y,w){this.type=Ht,this.lhs=g,this.rhs=y,this.collator=w,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const w=g[0];let C=y.parse(g[1],1,er);if(!C)return null;if(!es(w,C.type))return y.concat(1).error(`"${w}" comparisons are not supported for type '${B(C.type)}'.`);let P=y.parse(g[2],2,er);if(!P)return null;if(!es(w,P.type))return y.concat(2).error(`"${w}" comparisons are not supported for type '${B(P.type)}'.`);if(C.type.kind!==P.type.kind&&C.type.kind!=="value"&&P.type.kind!=="value")return y.error(`Cannot compare types '${B(C.type)}' and '${B(P.type)}'.`);l&&(C.type.kind==="value"&&P.type.kind!=="value"?C=new Ri(P.type,[C]):C.type.kind!=="value"&&P.type.kind==="value"&&(P=new Ri(C.type,[P])));let A=null;if(g.length===4){if(C.type.kind!=="string"&&P.type.kind!=="string"&&C.type.kind!=="value"&&P.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(A=y.parse(g[3],3,bi),!A)return null}return new Kw(C,P,A)}evaluate(g){const y=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(l&&this.hasUntypedArgument){const C=rr(y),P=rr(w);if(C.kind!==P.kind||C.kind!=="string"&&C.kind!=="number")throw new sn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${C.kind}, ${P.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const C=rr(y),P=rr(w);if(C.kind!=="string"||P.kind!=="string")return t(g,y,w)}return this.collator?a(g,y,w,this.collator.evaluate(g)):t(g,y,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const rs=ts("==",function(i,t,a){return t===a},Vs),Nu=ts("!=",function(i,t,a){return t!==a},function(i,t,a,l){return!Vs(0,t,a,l)}),Ji=ts("<",function(i,t,a){return t<a},function(i,t,a,l){return l.compare(t,a)<0}),Hl=ts(">",function(i,t,a){return t>a},function(i,t,a,l){return l.compare(t,a)>0}),ju=ts("<=",function(i,t,a){return t<=a},function(i,t,a,l){return l.compare(t,a)<=0}),Go=ts(">=",function(i,t,a){return t>=a},function(i,t,a,l){return l.compare(t,a)>=0});class Aa{constructor(t,a,l){this.type=bi,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=a}static parse(t,a){if(t.length!==2)return a.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return a.error("Collator options argument must be an object.");const f=a.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Ht);if(!f)return null;const g=a.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Ht);if(!g)return null;let y=null;return l.locale&&(y=a.parse(l.locale,1,lr),!y)?null:new Aa(f,g,y)}evaluate(t){return new qo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class mo{constructor(t,a,l,f,g){this.type=lr,this.number=t,this.locale=a,this.currency=l,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(t,a){if(t.length!==3)return a.error("Expected two arguments.");const l=a.parse(t[1],1,at);if(!l)return null;const f=t[2];if(typeof f!="object"||Array.isArray(f))return a.error("NumberFormat options argument must be an object.");let g=null;if(f.locale&&(g=a.parse(f.locale,1,lr),!g))return null;let y=null;if(f.currency&&(y=a.parse(f.currency,1,lr),!y))return null;let w=null;if(f["min-fraction-digits"]&&(w=a.parse(f["min-fraction-digits"],1,at),!w))return null;let C=null;return f["max-fraction-digits"]&&(C=a.parse(f["max-fraction-digits"],1,at),!C)?null:new mo(l,g,y,w,C)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class go{constructor(t){this.type=wt,this.sections=t}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return a.error("First argument must be an image or text section.");const f=[];let g=!1;for(let y=1;y<=t.length-1;++y){const w=t[y];if(g&&typeof w=="object"&&!Array.isArray(w)){g=!1;let C=null;if(w["font-scale"]&&(C=a.parse(w["font-scale"],1,at),!C))return null;let P=null;if(w["text-font"]&&(P=a.parse(w["text-font"],1,N(lr)),!P))return null;let A=null;if(w["text-color"]&&(A=a.parse(w["text-color"],1,zt),!A))return null;const z=f[f.length-1];z.scale=C,z.font=P,z.textColor=A}else{const C=a.parse(t[y],1,er);if(!C)return null;const P=C.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,f.push({content:C,scale:null,font:null,textColor:null})}}return new go(f)}evaluate(t){return new Hn(this.sections.map(a=>{const l=a.content.evaluate(t);return rr(l)===Xi?new Xa("",l,null,null,null):new Xa(Bs(l),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))}eachChild(t){for(const a of this.sections)t(a.content),a.scale&&t(a.scale),a.font&&t(a.font),a.textColor&&t(a.textColor)}outputDefined(){return!1}}class Zl{constructor(t){this.type=Xi,this.input=t}static parse(t,a){if(t.length!==2)return a.error("Expected two arguments.");const l=a.parse(t[1],1,lr);return l?new Zl(l):a.error("No image name provided.")}evaluate(t){const a=this.input.evaluate(t),l=ci.fromString(a);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(a)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}}class xs{constructor(t){this.type=at,this.input=t}static parse(t,a){if(t.length!==2)return a.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=a.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${B(l.type)} instead.`):new xs(l):null}evaluate(t){const a=this.input.evaluate(t);if(typeof a=="string")return[...a].length;if(Array.isArray(a))return a.length;throw new sn(`Expected value to be of type string or array, but found ${B(rr(a))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const da=8192;function Yc(i,t){const a=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(a*f*da),Math.round(l*f*da)]}function $s(i,t){const a=Math.pow(2,t.z);return[(f=(i[0]/da+t.x)/a,360*f-180),(l=(i[1]/da+t.y)/a,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,f}function fa(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function pa(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function Or(i,t,a){const l=i[0]-t[0],f=i[1]-t[1],g=i[0]-a[0],y=i[1]-a[1];return l*y-g*f==0&&l*g<=0&&f*y<=0}function Ho(i,t,a,l){return(f=[l[0]-a[0],l[1]-a[1]])[0]*(g=[t[0]-i[0],t[1]-i[1]])[1]-f[1]*g[0]!=0&&!(!yo(i,t,a,l)||!yo(a,l,i,t));var f,g}function Jc(i,t,a){for(const l of a)for(let f=0;f<l.length-1;++f)if(Ho(i,t,l[f],l[f+1]))return!0;return!1}function ns(i,t,a=!1){let l=!1;for(const w of t)for(let C=0;C<w.length-1;C++){if(Or(i,w[C],w[C+1]))return a;(g=w[C])[1]>(f=i)[1]!=(y=w[C+1])[1]>f[1]&&f[0]<(y[0]-g[0])*(f[1]-g[1])/(y[1]-g[1])+g[0]&&(l=!l)}var f,g,y;return l}function Wl(i,t){for(const a of t)if(ns(i,a))return!0;return!1}function Xl(i,t){for(const a of i)if(!ns(a,t))return!1;for(let a=0;a<i.length-1;++a)if(Jc(i[a],i[a+1],t))return!1;return!0}function Zo(i,t){for(const a of t)if(Xl(i,a))return!0;return!1}function yo(i,t,a,l){const f=l[0]-a[0],g=l[1]-a[1],y=(i[0]-a[0])*g-f*(i[1]-a[1]),w=(t[0]-a[0])*g-f*(t[1]-a[1]);return y>0&&w<0||y<0&&w>0}function qs(i,t,a){const l=[];for(let f=0;f<i.length;f++){const g=[];for(let y=0;y<i[f].length;y++){const w=Yc(i[f][y],a);fa(t,w),g.push(w)}l.push(g)}return l}function Yl(i,t,a){const l=[];for(let f=0;f<i.length;f++){const g=qs(i[f],t,a);l.push(g)}return l}function Uu(i,t,a,l){if(i[0]<a[0]||i[0]>a[2]){const f=.5*l;let g=i[0]-a[0]>f?-l:a[0]-i[0]>f?l:0;g===0&&(g=i[0]-a[2]>f?-l:a[2]-i[0]>f?l:0),i[0]+=g}fa(t,i)}function ws(i,t,a,l){const f=Math.pow(2,l.z)*da,g=[l.x*da,l.y*da],y=[];for(const w of i)for(const C of w){const P=[C.x+g[0],C.y+g[1]];Uu(P,t,a,f),y.push(P)}return y}function Wo(i,t,a,l){const f=Math.pow(2,l.z)*da,g=[l.x*da,l.y*da],y=[];for(const C of i){const P=[];for(const A of C){const z=[A.x+g[0],A.y+g[1]];fa(t,z),P.push(z)}y.push(P)}if(t[2]-t[0]<=f/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const C of y)for(const P of C)Uu(P,t,a,f)}var w;return y}class Ma{constructor(t,a){this.type=Ht,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ya(t[1])){const l=t[1];if(l.type==="FeatureCollection"){const f=[];for(const g of l.features){const{type:y,coordinates:w}=g.geometry;y==="Polygon"&&f.push(w),y==="MultiPolygon"&&f.push(...w)}if(f.length)return new Ma(l,{type:"MultiPolygon",coordinates:f})}else if(l.type==="Feature"){const f=l.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Ma(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Ma(l,l)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,l){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(l.type==="Polygon"){const w=qs(l.coordinates,g,y),C=ws(a.geometry(),f,g,y);if(!pa(f,g))return!1;for(const P of C)if(!ns(P,w))return!1}if(l.type==="MultiPolygon"){const w=Yl(l.coordinates,g,y),C=ws(a.geometry(),f,g,y);if(!pa(f,g))return!1;for(const P of C)if(!Wl(P,w))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,l){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(l.type==="Polygon"){const w=qs(l.coordinates,g,y),C=Wo(a.geometry(),f,g,y);if(!pa(f,g))return!1;for(const P of C)if(!Xl(P,w))return!1}if(l.type==="MultiPolygon"){const w=Yl(l.coordinates,g,y),C=Wo(a.geometry(),f,g,y);if(!pa(f,g))return!1;for(const P of C)if(!Zo(P,w))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Xo=class{constructor(i=[],t=(a,l)=>a<l?-1:a>l?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:a}=this,l=t[i];for(;i>0;){const f=i-1>>1,g=t[f];if(a(l,g)>=0)break;t[i]=g,i=f}t[i]=l}_down(i){const{data:t,compare:a}=this,l=this.length>>1,f=t[i];for(;i<l;){let g=1+(i<<1);const y=g+1;if(y<this.length&&a(t[y],t[g])<0&&(g=y),a(t[g],f)>=0)break;t[i]=t[g],i=g}t[i]=f}};function Jl(i,t,a,l,f){$n(i,t,a,l||i.length-1,f||_o)}function $n(i,t,a,l,f){for(;l>a;){if(l-a>600){var g=l-a+1,y=t-a+1,w=Math.log(g),C=.5*Math.exp(2*w/3),P=.5*Math.sqrt(w*C*(g-C)/g)*(y-g/2<0?-1:1);$n(i,t,Math.max(a,Math.floor(t-y*C/g+P)),Math.min(l,Math.floor(t+(g-y)*C/g+P)),f)}var A=i[t],z=a,O=l;for(Da(i,a,t),f(i[l],A)>0&&Da(i,a,l);z<O;){for(Da(i,z,O),z++,O--;f(i[z],A)<0;)z++;for(;f(i[O],A)>0;)O--}f(i[a],A)===0?Da(i,a,O):Da(i,++O,l),O<=t&&(a=O+1),t<=O&&(l=O-1)}}function Da(i,t,a){var l=i[t];i[t]=i[a],i[a]=l}function _o(i,t){return i<t?-1:i>t?1:0}function vo(i,t){if(i.length<=1)return[i];const a=[];let l,f;for(const g of i){const y=Vu(g);y!==0&&(g.area=Math.abs(y),f===void 0&&(f=y<0),f===y<0?(l&&a.push(l),l=[g]):l.push(g))}if(l&&a.push(l),t>1)for(let g=0;g<a.length;g++)a[g].length<=t||(Jl(a[g],t,1,a[g].length-1,Yo),a[g]=a[g].slice(0,t));return a}function Yo(i,t){return t.area-i.area}function Vu(i){let t=0;for(let a,l,f=0,g=i.length,y=g-1;f<g;y=f++)a=i[f],l=i[y],t+=(l.x-a.x)*(a.y+l.y);return t}const Ql=1/298.257223563,xo=Ql*(2-Ql),Jo=Math.PI/180;class za{constructor(t){const a=6378.137*Jo*1e3,l=Math.cos(t*Jo),f=1/(1-xo*(1-l*l)),g=Math.sqrt(f);this.kx=a*g*l,this.ky=a*g*f*(1-xo)}distance(t,a){const l=this.wrap(t[0]-a[0])*this.kx,f=(t[1]-a[1])*this.ky;return Math.sqrt(l*l+f*f)}pointOnLine(t,a){let l,f,g,y,w=1/0;for(let C=0;C<t.length-1;C++){let P=t[C][0],A=t[C][1],z=this.wrap(t[C+1][0]-P)*this.kx,O=(t[C+1][1]-A)*this.ky,U=0;z===0&&O===0||(U=(this.wrap(a[0]-P)*this.kx*z+(a[1]-A)*this.ky*O)/(z*z+O*O),U>1?(P=t[C+1][0],A=t[C+1][1]):U>0&&(P+=z/this.kx*U,A+=O/this.ky*U)),z=this.wrap(a[0]-P)*this.kx,O=(a[1]-A)*this.ky;const K=z*z+O*O;K<w&&(w=K,l=P,f=A,g=C,y=U)}return{point:[l,f],index:g,t:Math.max(0,Math.min(1,y))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Qo(i,t){return t[0]-i[0]}function Ks(i){return i[1]-i[0]+1}function Bi(i,t){return i[1]>=i[0]&&i[1]<t}function wo(i,t){if(i[0]>i[1])return[null,null];const a=Ks(i);if(t){if(a===2)return[i,null];const f=Math.floor(a/2);return[[i[0],i[0]+f],[i[0]+f,i[1]]]}if(a===1)return[i,null];const l=Math.floor(a/2)-1;return[[i[0],i[0]+l],[i[0]+l+1,i[1]]]}function el(i,t){if(!Bi(t,i.length))return[1/0,1/0,-1/0,-1/0];const a=[1/0,1/0,-1/0,-1/0];for(let l=t[0];l<=t[1];++l)fa(a,i[l]);return a}function eu(i){const t=[1/0,1/0,-1/0,-1/0];for(const a of i)for(const l of a)fa(t,l);return t}function Gs(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Hs(i,t,a){if(!Gs(i)||!Gs(t))return NaN;let l=0,f=0;return i[2]<t[0]&&(l=t[0]-i[2]),i[0]>t[2]&&(l=i[0]-t[2]),i[1]>t[3]&&(f=i[1]-t[3]),i[3]<t[1]&&(f=t[1]-i[3]),a.distance([0,0],[l,f])}function bs(i,t,a){const l=a.pointOnLine(t,i);return a.distance(i,l.point)}function bo(i,t,a,l,f){const g=Math.min(bs(i,[a,l],f),bs(t,[a,l],f)),y=Math.min(bs(a,[i,t],f),bs(l,[i,t],f));return Math.min(g,y)}function tu(i,t,a,l,f){if(!Bi(t,i.length)||!Bi(l,a.length))return 1/0;let g=1/0;for(let y=t[0];y<t[1];++y){const w=i[y],C=i[y+1];for(let P=l[0];P<l[1];++P){const A=a[P],z=a[P+1];if(Ho(w,C,A,z))return 0;g=Math.min(g,bo(w,C,A,z,f))}}return g}function gn(i,t,a,l,f){if(!Bi(t,i.length)||!Bi(l,a.length))return NaN;let g=1/0;for(let y=t[0];y<=t[1];++y)for(let w=l[0];w<=l[1];++w)if(g=Math.min(g,f.distance(i[y],a[w])),g===0)return g;return g}function $u(i,t,a){if(ns(i,t,!0))return 0;let l=1/0;for(const f of t){const g=f[0],y=f[f.length-1];if(g!==y&&(l=Math.min(l,bs(i,[y,g],a)),l===0))return l;const w=a.pointOnLine(f,i);if(l=Math.min(l,a.distance(i,w.point)),l===0)return l}return l}function yr(i,t,a,l){if(!Bi(t,i.length))return NaN;for(let g=t[0];g<=t[1];++g)if(ns(i[g],a,!0))return 0;let f=1/0;for(let g=t[0];g<t[1];++g){const y=i[g],w=i[g+1];for(const C of a)for(let P=0,A=C.length,z=A-1;P<A;z=P++){const O=C[z],U=C[P];if(Ho(y,w,O,U))return 0;f=Math.min(f,bo(y,w,O,U,l))}}return f}function So(i,t){for(const a of i)for(const l of a)if(ns(l,t,!0))return!0;return!1}function Gr(i,t,a,l=1/0){const f=eu(i),g=eu(t);if(l!==1/0&&Hs(f,g,a)>=l)return l;if(pa(f,g)){if(So(i,t))return 0}else if(So(t,i))return 0;let y=1/0;for(const w of i)for(let C=0,P=w.length,A=P-1;C<P;A=C++){const z=w[A],O=w[C];for(const U of t)for(let K=0,G=U.length,te=G-1;K<G;te=K++){const ie=U[te],ze=U[K];if(Ho(z,O,ie,ze))return 0;y=Math.min(y,bo(z,O,ie,ze,a))}}return y}function $r(i,t,a,l,f,g){if(!g)return;const y=Hs(el(l,g),f,a);y<t&&i.push([y,g,[0,0]])}function is(i,t,a,l,f,g,y){if(!g||!y)return;const w=Hs(el(l,g),el(f,y),a);w<t&&i.push([w,g,y])}function Ss(i,t,a,l,f=1/0){let g=Math.min(l.distance(i[0],a[0][0]),f);if(g===0)return g;const y=new Xo([[0,[0,i.length-1],[0,0]]],Qo),w=eu(a);for(;y.length>0;){const C=y.pop();if(C[0]>=g)continue;const P=C[1],A=t?50:100;if(Ks(P)<=A){if(!Bi(P,i.length))return NaN;if(t){const z=yr(i,P,a,l);if(isNaN(z)||z===0)return z;g=Math.min(g,z)}else for(let z=P[0];z<=P[1];++z){const O=$u(i[z],a,l);if(g=Math.min(g,O),g===0)return 0}}else{const z=wo(P,t);$r(y,g,l,i,w,z[0]),$r(y,g,l,i,w,z[1])}}return g}function Zs(i,t,a,l,f,g=1/0){let y=Math.min(g,f.distance(i[0],a[0]));if(y===0)return y;const w=new Xo([[0,[0,i.length-1],[0,a.length-1]]],Qo);for(;w.length>0;){const C=w.pop();if(C[0]>=y)continue;const P=C[1],A=C[2],z=t?50:100,O=l?50:100;if(Ks(P)<=z&&Ks(A)<=O){if(!Bi(P,i.length)&&Bi(A,a.length))return NaN;let U;if(t&&l)U=tu(i,P,a,A,f),y=Math.min(y,U);else if(t&&!l){const K=i.slice(P[0],P[1]+1);for(let G=A[0];G<=A[1];++G)if(U=bs(a[G],K,f),y=Math.min(y,U),y===0)return y}else if(!t&&l){const K=a.slice(A[0],A[1]+1);for(let G=P[0];G<=P[1];++G)if(U=bs(i[G],K,f),y=Math.min(y,U),y===0)return y}else U=gn(i,P,a,A,f),y=Math.min(y,U)}else{const U=wo(P,t),K=wo(A,l);is(w,y,f,i,a,U[0],K[0]),is(w,y,f,i,a,U[0],K[1]),is(w,y,f,i,a,U[1],K[0]),is(w,y,f,i,a,U[1],K[1])}}return y}function tl(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class ks{constructor(t,a){this.type=at,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ya(t[1])){const l=t[1];if(l.type==="FeatureCollection")return new ks(l,l.features.map(f=>tl(f.geometry)).flat());if(l.type==="Feature")return new ks(l,tl(l.geometry));if("type"in l&&"coordinates"in l)return new ks(l,tl(l))}return a.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,l){const f=a.geometry(),g=f.flat().map(C=>$s([C.x,C.y],a.canonical));if(f.length===0)return NaN;const y=new za(g[0][1]);let w=1/0;for(const C of l){switch(C.type){case"Point":w=Math.min(w,Zs(g,!1,[C.coordinates],!1,y,w));break;case"LineString":w=Math.min(w,Zs(g,!1,C.coordinates,!0,y,w));break;case"Polygon":w=Math.min(w,Ss(g,!1,C.coordinates,y,w))}if(w===0)return w}return w}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,l){const f=a.geometry(),g=f.flat().map(C=>$s([C.x,C.y],a.canonical));if(f.length===0)return NaN;const y=new za(g[0][1]);let w=1/0;for(const C of l){switch(C.type){case"Point":w=Math.min(w,Zs(g,!0,[C.coordinates],!1,y,w));break;case"LineString":w=Math.min(w,Zs(g,!0,C.coordinates,!0,y,w));break;case"Polygon":w=Math.min(w,Ss(g,!0,C.coordinates,y,w))}if(w===0)return w}return w}(t,this.geometries);if(t.geometryType()==="Polygon")return function(a,l){const f=a.geometry();if(f.length===0||f[0].length===0)return NaN;const g=vo(f,0).map(C=>C.map(P=>P.map(A=>$s([A.x,A.y],a.canonical)))),y=new za(g[0][0][0][1]);let w=1/0;for(const C of l)for(const P of g){switch(C.type){case"Point":w=Math.min(w,Ss([C.coordinates],!1,P,y,w));break;case"LineString":w=Math.min(w,Ss(C.coordinates,!0,P,y,w));break;case"Polygon":w=Math.min(w,Gr(P,C.coordinates,y,w))}if(w===0)return w}return w}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ws={"==":rs,"!=":Nu,">":Hl,"<":Ji,">=":Go,"<=":ju,array:Ri,at:ho,boolean:Ri,case:fo,coalesce:ki,collator:Aa,format:go,image:Zl,in:Ns,"index-of":_s,interpolate:ii,"interpolate-hcl":ii,"interpolate-lab":ii,length:xs,let:Si,literal:Li,match:js,number:Ri,"number-format":mo,object:Ri,slice:po,step:vs,string:Ri,"to-boolean":Oi,"to-color":Oi,"to-number":Oi,"to-string":Oi,var:Mr,within:Ma,distance:ks};class Ni{constructor(t,a,l,f){this.name=t,this.type=a,this._evaluate=l,this.args=f}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,a){const l=t[0],f=Ni.definitions[l];if(!f)return a.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=y.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let C=null;for(const[P,A]of w){C=new Yi(a.registry,Zn,a.path,null,a.scope);const z=[];let O=!1;for(let U=1;U<t.length;U++){const K=t[U],G=Array.isArray(P)?P[U-1]:P.type,te=C.parse(K,1+z.length,G);if(!te){O=!0;break}z.push(te)}if(!O)if(Array.isArray(P)&&P.length!==z.length)C.error(`Expected ${P.length} arguments, but found ${z.length} instead.`);else{for(let U=0;U<z.length;U++){const K=Array.isArray(P)?P[U]:P.type,G=z[U];C.concat(U+1).checkSubtype(K,G.type)}if(C.errors.length===0)return new Ni(l,g,A,z)}}if(w.length===1)a.errors.push(...C.errors);else{const P=(w.length?w:y).map(([z])=>{return O=z,Array.isArray(O)?`(${O.map(B).join(", ")})`:`(${B(O.type)}...)`;var O}).join(" | "),A=[];for(let z=1;z<t.length;z++){const O=a.parse(t[z],1+A.length);if(!O)return null;A.push(B(O.type))}a.error(`Expected arguments of type ${P}, but found (${A.join(", ")}) instead.`)}return null}static register(t,a){Ni.definitions=a;for(const l in a)t[l]=Ni}}function Xs(i,[t,a,l,f]){t=t.evaluate(i),a=a.evaluate(i),l=l.evaluate(i);const g=f?f.evaluate(i):1,y=Ea(t,a,l,g);if(y)throw new sn(y);return new br(t/255,a/255,l/255,g,!1)}function Qi(i,t){return i in t}function pn(i,t){const a=t[i];return a===void 0?null:a}function ma(i){return{type:i}}function Zn(i){if(i instanceof Mr)return Zn(i.boundExpression);if(i instanceof Ni&&i.name==="error"||i instanceof Aa||i instanceof Ma||i instanceof ks)return!1;const t=i instanceof Oi||i instanceof Ri;let a=!0;return i.eachChild(l=>{a=t?a&&Zn(l):a&&l instanceof Li}),!!a&&ko(i)&&Ys(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ko(i){if(i instanceof Ni&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ma||i instanceof ks)return!1;let t=!0;return i.eachChild(a=>{t&&!ko(a)&&(t=!1)}),t}function as(i){if(i instanceof Ni&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(a=>{t&&!as(a)&&(t=!1)}),t}function Ys(i,t){if(i instanceof Ni&&t.indexOf(i.name)>=0)return!1;let a=!0;return i.eachChild(l=>{a&&!Ys(l,t)&&(a=!1)}),a}function ga(i){return{result:"success",value:i}}function ss(i){return{result:"error",value:i}}function ea(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function La(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function rl(i){return!!i.expression&&i.expression.interpolated}function v(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function k(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function E(i){return i}function D(i,t){const a=t.type==="color",l=i.stops&&typeof i.stops[0][0]=="object",f=l||!(l||i.property!==void 0),g=i.type||(rl(t)?"exponential":"interval");if(a||t.type==="padding"){const A=a?br.parse:ri.parse;(i=Fn({},i)).stops&&(i.stops=i.stops.map(z=>[z[0],A(z[1])])),i.default=A(i.default?i.default:t.default)}if(i.colorSpace&&(y=i.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var y;let w,C,P;if(g==="exponential")w=se;else if(g==="interval")w=J;else if(g==="categorical"){w=$,C=Object.create(null);for(const A of i.stops)C[A[0]]=A[1];P=typeof i.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);w=ye}if(l){const A={},z=[];for(let K=0;K<i.stops.length;K++){const G=i.stops[K],te=G[0].zoom;A[te]===void 0&&(A[te]={zoom:te,type:i.type,property:i.property,default:i.default,stops:[]},z.push(te)),A[te].stops.push([G[0].value,G[1]])}const O=[];for(const K of z)O.push([A[K].zoom,D(A[K],t)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:ii.interpolationFactor.bind(void 0,U),zoomStops:O.map(K=>K[0]),evaluate:({zoom:K},G)=>se({stops:O,base:i.base},t,K).evaluate(K,G)}}if(f){const A=g==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:ii.interpolationFactor.bind(void 0,A),zoomStops:i.stops.map(z=>z[0]),evaluate:({zoom:z})=>w(i,t,z,C,P)}}return{kind:"source",evaluate(A,z){const O=z&&z.properties?z.properties[i.property]:void 0;return O===void 0?F(i.default,t.default):w(i,t,O,C,P)}}}function F(i,t,a){return i!==void 0?i:t!==void 0?t:a!==void 0?a:void 0}function $(i,t,a,l,f){return F(typeof a===f?l[a]:void 0,i.default,t.default)}function J(i,t,a){if(v(a)!=="number")return F(i.default,t.default);const l=i.stops.length;if(l===1||a<=i.stops[0][0])return i.stops[0][1];if(a>=i.stops[l-1][0])return i.stops[l-1][1];const f=Dr(i.stops.map(g=>g[0]),a);return i.stops[f][1]}function se(i,t,a){const l=i.base!==void 0?i.base:1;if(v(a)!=="number")return F(i.default,t.default);const f=i.stops.length;if(f===1||a<=i.stops[0][0])return i.stops[0][1];if(a>=i.stops[f-1][0])return i.stops[f-1][1];const g=Dr(i.stops.map(A=>A[0]),a),y=function(A,z,O,U){const K=U-O,G=A-O;return K===0?0:z===1?G/K:(Math.pow(z,G)-1)/(Math.pow(z,K)-1)}(a,l,i.stops[g][0],i.stops[g+1][0]),w=i.stops[g][1],C=i.stops[g+1][1],P=ni[t.type]||E;return typeof w.evaluate=="function"?{evaluate(...A){const z=w.evaluate.apply(void 0,A),O=C.evaluate.apply(void 0,A);if(z!==void 0&&O!==void 0)return P(z,O,y,i.colorSpace)}}:P(w,C,y,i.colorSpace)}function ye(i,t,a){switch(t.type){case"color":a=br.parse(a);break;case"formatted":a=Hn.fromString(a.toString());break;case"resolvedImage":a=ci.fromString(a.toString());break;case"padding":a=ri.parse(a);break;default:v(a)===t.type||t.type==="enum"&&t.values[a]||(a=void 0)}return F(a,i.default,t.default)}Ni.register(Ws,{error:[{kind:"error"},[lr],(i,[t])=>{throw new sn(t.evaluate(i))}],typeof:[lr,[er],(i,[t])=>B(rr(t.evaluate(i)))],"to-rgba":[N(at,4),[zt],(i,[t])=>{const[a,l,f,g]=t.evaluate(i).rgb;return[255*a,255*l,255*f,g]}],rgb:[zt,[at,at,at],Xs],rgba:[zt,[at,at,at,at],Xs],has:{type:Ht,overloads:[[[lr],(i,[t])=>Qi(t.evaluate(i),i.properties())],[[lr,ti],(i,[t,a])=>Qi(t.evaluate(i),a.evaluate(i))]]},get:{type:er,overloads:[[[lr],(i,[t])=>pn(t.evaluate(i),i.properties())],[[lr,ti],(i,[t,a])=>pn(t.evaluate(i),a.evaluate(i))]]},"feature-state":[er,[lr],(i,[t])=>pn(t.evaluate(i),i.featureState||{})],properties:[ti,[],i=>i.properties()],"geometry-type":[lr,[],i=>i.geometryType()],id:[er,[],i=>i.id()],zoom:[at,[],i=>i.globals.zoom],"heatmap-density":[at,[],i=>i.globals.heatmapDensity||0],"line-progress":[at,[],i=>i.globals.lineProgress||0],accumulated:[er,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[at,ma(at),(i,t)=>{let a=0;for(const l of t)a+=l.evaluate(i);return a}],"*":[at,ma(at),(i,t)=>{let a=1;for(const l of t)a*=l.evaluate(i);return a}],"-":{type:at,overloads:[[[at,at],(i,[t,a])=>t.evaluate(i)-a.evaluate(i)],[[at],(i,[t])=>-t.evaluate(i)]]},"/":[at,[at,at],(i,[t,a])=>t.evaluate(i)/a.evaluate(i)],"%":[at,[at,at],(i,[t,a])=>t.evaluate(i)%a.evaluate(i)],ln2:[at,[],()=>Math.LN2],pi:[at,[],()=>Math.PI],e:[at,[],()=>Math.E],"^":[at,[at,at],(i,[t,a])=>Math.pow(t.evaluate(i),a.evaluate(i))],sqrt:[at,[at],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[at,[at],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[at,[at],(i,[t])=>Math.log(t.evaluate(i))],log2:[at,[at],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[at,[at],(i,[t])=>Math.sin(t.evaluate(i))],cos:[at,[at],(i,[t])=>Math.cos(t.evaluate(i))],tan:[at,[at],(i,[t])=>Math.tan(t.evaluate(i))],asin:[at,[at],(i,[t])=>Math.asin(t.evaluate(i))],acos:[at,[at],(i,[t])=>Math.acos(t.evaluate(i))],atan:[at,[at],(i,[t])=>Math.atan(t.evaluate(i))],min:[at,ma(at),(i,t)=>Math.min(...t.map(a=>a.evaluate(i)))],max:[at,ma(at),(i,t)=>Math.max(...t.map(a=>a.evaluate(i)))],abs:[at,[at],(i,[t])=>Math.abs(t.evaluate(i))],round:[at,[at],(i,[t])=>{const a=t.evaluate(i);return a<0?-Math.round(-a):Math.round(a)}],floor:[at,[at],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[at,[at],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Ht,[lr,er],(i,[t,a])=>i.properties()[t.value]===a.value],"filter-id-==":[Ht,[er],(i,[t])=>i.id()===t.value],"filter-type-==":[Ht,[lr],(i,[t])=>i.geometryType()===t.value],"filter-<":[Ht,[lr,er],(i,[t,a])=>{const l=i.properties()[t.value],f=a.value;return typeof l==typeof f&&l<f}],"filter-id-<":[Ht,[er],(i,[t])=>{const a=i.id(),l=t.value;return typeof a==typeof l&&a<l}],"filter->":[Ht,[lr,er],(i,[t,a])=>{const l=i.properties()[t.value],f=a.value;return typeof l==typeof f&&l>f}],"filter-id->":[Ht,[er],(i,[t])=>{const a=i.id(),l=t.value;return typeof a==typeof l&&a>l}],"filter-<=":[Ht,[lr,er],(i,[t,a])=>{const l=i.properties()[t.value],f=a.value;return typeof l==typeof f&&l<=f}],"filter-id-<=":[Ht,[er],(i,[t])=>{const a=i.id(),l=t.value;return typeof a==typeof l&&a<=l}],"filter->=":[Ht,[lr,er],(i,[t,a])=>{const l=i.properties()[t.value],f=a.value;return typeof l==typeof f&&l>=f}],"filter-id->=":[Ht,[er],(i,[t])=>{const a=i.id(),l=t.value;return typeof a==typeof l&&a>=l}],"filter-has":[Ht,[er],(i,[t])=>t.value in i.properties()],"filter-has-id":[Ht,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ht,[N(lr)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ht,[N(er)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Ht,[lr,N(er)],(i,[t,a])=>a.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Ht,[lr,N(er)],(i,[t,a])=>function(l,f,g,y){for(;g<=y;){const w=g+y>>1;if(f[w]===l)return!0;f[w]>l?y=w-1:g=w+1}return!1}(i.properties()[t.value],a.value,0,a.value.length-1)],all:{type:Ht,overloads:[[[Ht,Ht],(i,[t,a])=>t.evaluate(i)&&a.evaluate(i)],[ma(Ht),(i,t)=>{for(const a of t)if(!a.evaluate(i))return!1;return!0}]]},any:{type:Ht,overloads:[[[Ht,Ht],(i,[t,a])=>t.evaluate(i)||a.evaluate(i)],[ma(Ht),(i,t)=>{for(const a of t)if(a.evaluate(i))return!0;return!1}]]},"!":[Ht,[Ht],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Ht,[lr],(i,[t])=>{const a=i.globals&&i.globals.isSupportedScript;return!a||a(t.evaluate(i))}],upcase:[lr,[lr],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[lr,[lr],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[lr,ma(er),(i,t)=>t.map(a=>Bs(a.evaluate(i))).join("")],"resolved-locale":[lr,[bi],(i,[t])=>t.evaluate(i).resolvedLocale()]});class xe{constructor(t,a){var l;this.expression=t,this._warningHistory={},this._evaluator=new Qa,this._defaultValue=a?(l=a).type==="color"&&k(l.default)?new br(0,0,0,0):l.type==="color"?br.parse(l.default)||null:l.type==="padding"?ri.parse(l.default)||null:l.type==="variableAnchorOffsetCollection"?Bn.parse(l.default)||null:l.default===void 0?null:l.default:null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(t,a,l,f,g,y){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=l,this._evaluator.canonical=f,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(t,a,l,f,g,y){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=l||null,this._evaluator.canonical=f,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new sn(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Ee(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ws}function he(i,t){const a=new Yi(Ws,Zn,[],t?function(f){const g={color:zt,string:lr,number:at,enum:lr,boolean:Ht,formatted:wt,padding:ca,resolvedImage:Xi,variableAnchorOffsetCollection:ne};return f.type==="array"?N(g[f.value]||er,f.length):g[f.type]}(t):void 0),l=a.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?ga(new xe(l,t)):ss(a.errors)}class De{constructor(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!as(a.expression)}evaluateWithoutErrorHandling(t,a,l,f,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,a,l,f,g,y)}evaluate(t,a,l,f,g,y){return this._styleExpression.evaluate(t,a,l,f,g,y)}}class ve{constructor(t,a,l,f){this.kind=t,this.zoomStops=l,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!as(a.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,a,l,f,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,a,l,f,g,y)}evaluate(t,a,l,f,g,y){return this._styleExpression.evaluate(t,a,l,f,g,y)}interpolationFactor(t,a,l){return this.interpolationType?ii.interpolationFactor(this.interpolationType,t,a,l):0}}function Ce(i,t){const a=he(i,t);if(a.result==="error")return a;const l=a.value.expression,f=ko(l);if(!f&&!ea(t))return ss([new kn("","data expressions not supported")]);const g=Ys(l,["zoom"]);if(!g&&!La(t))return ss([new kn("","zoom expressions not supported")]);const y=Me(l);return y||g?y instanceof kn?ss([y]):y instanceof ii&&!rl(t)?ss([new kn("",'"interpolate" expressions cannot be used with this property')]):ga(y?new ve(f?"camera":"composite",a.value,y.labels,y instanceof ii?y.interpolation:void 0):new De(f?"constant":"source",a.value)):ss([new kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Se{constructor(t,a){this._parameters=t,this._specification=a,Fn(this,D(this._parameters,this._specification))}static deserialize(t){return new Se(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Me(i){let t=null;if(i instanceof Si)t=Me(i.result);else if(i instanceof ki){for(const a of i.args)if(t=Me(a),t)break}else(i instanceof vs||i instanceof ii)&&i.input instanceof Ni&&i.input.name==="zoom"&&(t=i);return t instanceof kn||i.eachChild(a=>{const l=Me(a);l instanceof kn?t=l:!t&&l?t=new kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new kn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Fe(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Fe(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Ne={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ge(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Fe(i)||(i=bt(i));const t=he(i,Ne);if(t.result==="error")throw new Error(t.value.map(a=>`${a.key}: ${a.message}`).join(", "));return{filter:(a,l,f)=>t.value.evaluate(a,l,{},f),needGeometry:dt(i)}}function tt(i,t){return i<t?-1:i>t?1:0}function dt(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(dt(i[t]))return!0;return!1}function bt(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?lt(i[1],i[2],"=="):t==="!="?it(lt(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?lt(i[1],i[2],t):t==="any"?(a=i.slice(1),["any"].concat(a.map(bt))):t==="all"?["all"].concat(i.slice(1).map(bt)):t==="none"?["all"].concat(i.slice(1).map(bt).map(it)):t==="in"?ft(i[1],i.slice(2)):t==="!in"?it(ft(i[1],i.slice(2))):t==="has"?St(i[1]):t!=="!has"||it(St(i[1]));var a}function lt(i,t,a){switch(i){case"$type":return[`filter-type-${a}`,t];case"$id":return[`filter-id-${a}`,t];default:return[`filter-${a}`,i,t]}}function ft(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(a=>typeof a!=typeof t[0])?["filter-in-large",i,["literal",t.sort(tt)]]:["filter-in-small",i,["literal",t]]}}function St(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function it(i){return["!",i]}function Mt(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let f="[";for(const g of i)f+=`${Mt(g)},`;return`${f}]`}const a=Object.keys(i).sort();let l="{";for(let f=0;f<a.length;f++)l+=`${JSON.stringify(a[f])}:${Mt(i[a[f]])},`;return`${l}}`}function pr(i){let t="";for(const a of nn)t+=`/${Mt(i[a])}`;return t}function _r(i){const t=i.value;return t?[new rt(i.key,t,"constants have been deprecated as of v8")]:[]}function Zt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function mn(i){if(Array.isArray(i))return i.map(mn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const a in i)t[a]=mn(i[a]);return t}return Zt(i)}function Yt(i){const t=i.key,a=i.value,l=i.valueSpec||{},f=i.objectElementValidators||{},g=i.style,y=i.styleSpec,w=i.validateSpec;let C=[];const P=v(a);if(P!=="object")return[new rt(t,a,`object expected, ${P} found`)];for(const A in a){const z=A.split(".")[0],O=l[z]||l["*"];let U;if(f[z])U=f[z];else if(l[z])U=w;else if(f["*"])U=f["*"];else{if(!l["*"]){C.push(new rt(t,a[A],`unknown property "${A}"`));continue}U=w}C=C.concat(U({key:(t&&`${t}.`)+A,value:a[A],valueSpec:O,style:g,styleSpec:y,object:a,objectKey:A,validateSpec:w},a))}for(const A in l)f[A]||l[A].required&&l[A].default===void 0&&a[A]===void 0&&C.push(new rt(t,a,`missing required property "${A}"`));return C}function Tn(i){const t=i.value,a=i.valueSpec,l=i.style,f=i.styleSpec,g=i.key,y=i.arrayElementValidator||i.validateSpec;if(v(t)!=="array")return[new rt(g,t,`array expected, ${v(t)} found`)];if(a.length&&t.length!==a.length)return[new rt(g,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new rt(g,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let w={type:a.value,values:a.values};f.$version<7&&(w.function=a.function),v(a.value)==="object"&&(w=a.value);let C=[];for(let P=0;P<t.length;P++)C=C.concat(y({array:t,arrayIndex:P,value:t[P],valueSpec:w,validateSpec:i.validateSpec,style:l,styleSpec:f,key:`${g}[${P}]`}));return C}function Nn(i){const t=i.key,a=i.value,l=i.valueSpec;let f=v(a);return f==="number"&&a!=a&&(f="NaN"),f!=="number"?[new rt(t,a,`number expected, ${f} found`)]:"minimum"in l&&a<l.minimum?[new rt(t,a,`${a} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&a>l.maximum?[new rt(t,a,`${a} is greater than the maximum value ${l.maximum}`)]:[]}function Cs(i){const t=i.valueSpec,a=Zt(i.value.type);let l,f,g,y={};const w=a!=="categorical"&&i.value.property===void 0,C=!w,P=v(i.value.stops)==="array"&&v(i.value.stops[0])==="array"&&v(i.value.stops[0][0])==="object",A=Yt({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(U){if(a==="identity")return[new rt(U.key,U.value,'identity function may not have a "stops" property')];let K=[];const G=U.value;return K=K.concat(Tn({key:U.key,value:G,valueSpec:U.valueSpec,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:z})),v(G)==="array"&&G.length===0&&K.push(new rt(U.key,G,"array must have at least one stop")),K},default:function(U){return U.validateSpec({key:U.key,value:U.value,valueSpec:t,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec})}}});return a==="identity"&&w&&A.push(new rt(i.key,i.value,'missing required property "property"')),a==="identity"||i.value.stops||A.push(new rt(i.key,i.value,'missing required property "stops"')),a==="exponential"&&i.valueSpec.expression&&!rl(i.valueSpec)&&A.push(new rt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(C&&!ea(i.valueSpec)?A.push(new rt(i.key,i.value,"property functions not supported")):w&&!La(i.valueSpec)&&A.push(new rt(i.key,i.value,"zoom functions not supported"))),a!=="categorical"&&!P||i.value.property!==void 0||A.push(new rt(i.key,i.value,'"property" property is required')),A;function z(U){let K=[];const G=U.value,te=U.key;if(v(G)!=="array")return[new rt(te,G,`array expected, ${v(G)} found`)];if(G.length!==2)return[new rt(te,G,`array length 2 expected, length ${G.length} found`)];if(P){if(v(G[0])!=="object")return[new rt(te,G,`object expected, ${v(G[0])} found`)];if(G[0].zoom===void 0)return[new rt(te,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new rt(te,G,"object stop key must have value")];if(g&&g>Zt(G[0].zoom))return[new rt(te,G[0].zoom,"stop zoom values must appear in ascending order")];Zt(G[0].zoom)!==g&&(g=Zt(G[0].zoom),f=void 0,y={}),K=K.concat(Yt({key:`${te}[0]`,value:G[0],valueSpec:{zoom:{}},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:Nn,value:O}}))}else K=K.concat(O({key:`${te}[0]`,value:G[0],validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec},G));return Ee(mn(G[1]))?K.concat([new rt(`${te}[1]`,G[1],"expressions are not allowed in function stops.")]):K.concat(U.validateSpec({key:`${te}[1]`,value:G[1],valueSpec:t,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec}))}function O(U,K){const G=v(U.value),te=Zt(U.value),ie=U.value!==null?U.value:K;if(l){if(G!==l)return[new rt(U.key,ie,`${G} stop domain type must match previous stop domain type ${l}`)]}else l=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new rt(U.key,ie,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&a!=="categorical"){let ze=`number expected, ${G} found`;return ea(t)&&a===void 0&&(ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new rt(U.key,ie,ze)]}return a!=="categorical"||G!=="number"||isFinite(te)&&Math.floor(te)===te?a!=="categorical"&&G==="number"&&f!==void 0&&te<f?[new rt(U.key,ie,"stop domain values must appear in ascending order")]:(f=te,a==="categorical"&&te in y?[new rt(U.key,ie,"stop domain values must be unique")]:(y[te]=!0,[])):[new rt(U.key,ie,`integer expected, found ${te}`)]}}function In(i){const t=(i.expressionContext==="property"?Ce:he)(mn(i.value),i.valueSpec);if(t.result==="error")return t.value.map(l=>new rt(`${i.key}${l.key}`,i.value,l.message));const a=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!a.outputDefined())return[new rt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!as(a))return[new rt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!as(a))return[new rt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ys(a,["zoom","feature-state"]))return[new rt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ko(a))return[new rt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ai(i){const t=i.key,a=i.value,l=i.valueSpec,f=[];return Array.isArray(l.values)?l.values.indexOf(Zt(a))===-1&&f.push(new rt(t,a,`expected one of [${l.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(l.values).indexOf(Zt(a))===-1&&f.push(new rt(t,a,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(a)} found`)),f}function Co(i){return Fe(mn(i.value))?In(Fn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):qu(i)}function qu(i){const t=i.value,a=i.key;if(v(t)!=="array")return[new rt(a,t,`array expected, ${v(t)} found`)];const l=i.styleSpec;let f,g=[];if(t.length<1)return[new rt(a,t,"filter array must have at least 1 element")];switch(g=g.concat(ai({key:`${a}[0]`,value:t[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),Zt(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Zt(t[1])==="$type"&&g.push(new rt(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new rt(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=v(t[1]),f!=="string"&&g.push(new rt(`${a}[1]`,t[1],`string expected, ${f} found`)));for(let y=2;y<t.length;y++)f=v(t[y]),Zt(t[1])==="$type"?g=g.concat(ai({key:`${a}[${y}]`,value:t[y],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&g.push(new rt(`${a}[${y}]`,t[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)g=g.concat(qu({key:`${a}[${y}]`,value:t[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":f=v(t[1]),t.length!==2?g.push(new rt(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&g.push(new rt(`${a}[1]`,t[1],`string expected, ${f} found`))}return g}function Qc(i,t){const a=i.key,l=i.validateSpec,f=i.style,g=i.styleSpec,y=i.value,w=i.objectKey,C=g[`${t}_${i.layerType}`];if(!C)return[];const P=w.match(/^(.*)-transition$/);if(t==="paint"&&P&&C[P[1]]&&C[P[1]].transition)return l({key:a,value:y,valueSpec:g.transition,style:f,styleSpec:g});const A=i.valueSpec||C[w];if(!A)return[new rt(a,y,`unknown property "${w}"`)];let z;if(v(y)==="string"&&ea(A)&&!A.tokens&&(z=/^{([^}]+)}$/.exec(y)))return[new rt(a,y,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const O=[];return i.layerType==="symbol"&&(w==="text-field"&&f&&!f.glyphs&&O.push(new rt(a,y,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&k(mn(y))&&Zt(y.type)==="identity"&&O.push(new rt(a,y,'"text-font" does not support identity functions'))),O.concat(l({key:i.key,value:y,valueSpec:A,style:f,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:w}))}function Ku(i){return Qc(i,"paint")}function eh(i){return Qc(i,"layout")}function th(i){let t=[];const a=i.value,l=i.key,f=i.style,g=i.styleSpec;a.type||a.ref||t.push(new rt(l,a,'either "type" or "ref" is required'));let y=Zt(a.type);const w=Zt(a.ref);if(a.id){const C=Zt(a.id);for(let P=0;P<i.arrayIndex;P++){const A=f.layers[P];Zt(A.id)===C&&t.push(new rt(l,a.id,`duplicate layer id "${a.id}", previously used at line ${A.id.__line__}`))}}if("ref"in a){let C;["type","source","source-layer","filter","layout"].forEach(P=>{P in a&&t.push(new rt(l,a[P],`"${P}" is prohibited for ref layers`))}),f.layers.forEach(P=>{Zt(P.id)===w&&(C=P)}),C?C.ref?t.push(new rt(l,a.ref,"ref cannot reference another ref layer")):y=Zt(C.type):t.push(new rt(l,a.ref,`ref layer "${w}" not found`))}else if(y!=="background")if(a.source){const C=f.sources&&f.sources[a.source],P=C&&Zt(C.type);C?P==="vector"&&y==="raster"?t.push(new rt(l,a.source,`layer "${a.id}" requires a raster source`)):P!=="raster-dem"&&y==="hillshade"?t.push(new rt(l,a.source,`layer "${a.id}" requires a raster-dem source`)):P==="raster"&&y!=="raster"?t.push(new rt(l,a.source,`layer "${a.id}" requires a vector source`)):P!=="vector"||a["source-layer"]?P==="raster-dem"&&y!=="hillshade"?t.push(new rt(l,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!a.paint||!a.paint["line-gradient"]||P==="geojson"&&C.lineMetrics||t.push(new rt(l,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new rt(l,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new rt(l,a.source,`source "${a.source}" not found`))}else t.push(new rt(l,a,'missing required property "source"'));return t=t.concat(Yt({key:l,value:a,valueSpec:g.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${l}.type`,value:a.type,valueSpec:g.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:a,objectKey:"type"}),filter:Co,layout:C=>Yt({layer:a,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":P=>eh(Fn({layerType:y},P))}}),paint:C=>Yt({layer:a,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":P=>Ku(Fn({layerType:y},P))}})}})),t}function To(i){const t=i.value,a=i.key,l=v(t);return l!=="string"?[new rt(a,t,`string expected, ${l} found`)]:[]}const Gu={promoteId:function({key:i,value:t}){if(v(t)==="string")return To({key:i,value:t});{const a=[];for(const l in t)a.push(...To({key:`${i}.${l}`,value:t[l]}));return a}}};function ru(i){const t=i.value,a=i.key,l=i.styleSpec,f=i.style,g=i.validateSpec;if(!t.type)return[new rt(a,t,'"type" is required')];const y=Zt(t.type);let w;switch(y){case"vector":case"raster":return w=Yt({key:a,value:t,valueSpec:l[`source_${y.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:Gu,validateSpec:g}),w;case"raster-dem":return w=function(C){var P;const A=(P=C.sourceName)!==null&&P!==void 0?P:"",z=C.value,O=C.styleSpec,U=O.source_raster_dem,K=C.style;let G=[];const te=v(z);if(z===void 0)return G;if(te!=="object")return G.push(new rt("source_raster_dem",z,`object expected, ${te} found`)),G;const ie=Zt(z.encoding)==="custom",ze=["redFactor","greenFactor","blueFactor","baseShift"],ge=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const Pe in z)!ie&&ze.includes(Pe)?G.push(new rt(Pe,z[Pe],`In "${A}": "${Pe}" is only valid when "encoding" is set to "custom". ${ge} encoding found`)):U[Pe]?G=G.concat(C.validateSpec({key:Pe,value:z[Pe],valueSpec:U[Pe],validateSpec:C.validateSpec,style:K,styleSpec:O})):G.push(new rt(Pe,z[Pe],`unknown property "${Pe}"`));return G}({sourceName:a,value:t,style:i.style,styleSpec:l,validateSpec:g}),w;case"geojson":if(w=Yt({key:a,value:t,valueSpec:l.source_geojson,style:f,styleSpec:l,validateSpec:g,objectElementValidators:Gu}),t.cluster)for(const C in t.clusterProperties){const[P,A]=t.clusterProperties[C],z=typeof P=="string"?[P,["accumulated"],["get",C]]:P;w.push(...In({key:`${a}.${C}.map`,value:A,expressionContext:"cluster-map"})),w.push(...In({key:`${a}.${C}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return w;case"video":return Yt({key:a,value:t,valueSpec:l.source_video,style:f,validateSpec:g,styleSpec:l});case"image":return Yt({key:a,value:t,valueSpec:l.source_image,style:f,validateSpec:g,styleSpec:l});case"canvas":return[new rt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ai({key:`${a}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function rh(i){const t=i.value,a=i.styleSpec,l=a.light,f=i.style;let g=[];const y=v(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new rt("light",t,`object expected, ${y} found`)]),g;for(const w in t){const C=w.match(/^(.*)-transition$/);g=g.concat(C&&l[C[1]]&&l[C[1]].transition?i.validateSpec({key:w,value:t[w],valueSpec:a.transition,validateSpec:i.validateSpec,style:f,styleSpec:a}):l[w]?i.validateSpec({key:w,value:t[w],valueSpec:l[w],validateSpec:i.validateSpec,style:f,styleSpec:a}):[new rt(w,t[w],`unknown property "${w}"`)])}return g}function nh(i){const t=i.value,a=i.styleSpec,l=a.sky,f=i.style,g=v(t);if(t===void 0)return[];if(g!=="object")return[new rt("sky",t,`object expected, ${g} found`)];let y=[];for(const w in t)y=y.concat(l[w]?i.validateSpec({key:w,value:t[w],valueSpec:l[w],style:f,styleSpec:a}):[new rt(w,t[w],`unknown property "${w}"`)]);return y}function ih(i){const t=i.value,a=i.styleSpec,l=a.terrain,f=i.style;let g=[];const y=v(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new rt("terrain",t,`object expected, ${y} found`)]),g;for(const w in t)g=g.concat(l[w]?i.validateSpec({key:w,value:t[w],valueSpec:l[w],validateSpec:i.validateSpec,style:f,styleSpec:a}):[new rt(w,t[w],`unknown property "${w}"`)]);return g}function ah(i){let t=[];const a=i.value,l=i.key;if(Array.isArray(a)){const f=[],g=[];for(const y in a)a[y].id&&f.includes(a[y].id)&&t.push(new rt(l,a,`all the sprites' ids must be unique, but ${a[y].id} is duplicated`)),f.push(a[y].id),a[y].url&&g.includes(a[y].url)&&t.push(new rt(l,a,`all the sprites' URLs must be unique, but ${a[y].url} is duplicated`)),g.push(a[y].url),t=t.concat(Yt({key:`${l}[${y}]`,value:a[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return To({key:l,value:a})}const Hu={"*":()=>[],array:Tn,boolean:function(i){const t=i.value,a=i.key,l=v(t);return l!=="boolean"?[new rt(a,t,`boolean expected, ${l} found`)]:[]},number:Nn,color:function(i){const t=i.key,a=i.value,l=v(a);return l!=="string"?[new rt(t,a,`color expected, ${l} found`)]:br.parse(String(a))?[]:[new rt(t,a,`color expected, "${a}" found`)]},constants:_r,enum:ai,filter:Co,function:Cs,layer:th,object:Yt,source:ru,light:rh,sky:nh,terrain:ih,projection:function(i){const t=i.value,a=i.styleSpec,l=a.projection,f=i.style,g=v(t);if(t===void 0)return[];if(g!=="object")return[new rt("projection",t,`object expected, ${g} found`)];let y=[];for(const w in t)y=y.concat(l[w]?i.validateSpec({key:w,value:t[w],valueSpec:l[w],style:f,styleSpec:a}):[new rt(w,t[w],`unknown property "${w}"`)]);return y},string:To,formatted:function(i){return To(i).length===0?[]:In(i)},resolvedImage:function(i){return To(i).length===0?[]:In(i)},padding:function(i){const t=i.key,a=i.value;if(v(a)==="array"){if(a.length<1||a.length>4)return[new rt(t,a,`padding requires 1 to 4 values; ${a.length} values found`)];const l={type:"number"};let f=[];for(let g=0;g<a.length;g++)f=f.concat(i.validateSpec({key:`${t}[${g}]`,value:a[g],validateSpec:i.validateSpec,valueSpec:l}));return f}return Nn({key:t,value:a,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,a=i.value,l=v(a),f=i.styleSpec;if(l!=="array"||a.length<1||a.length%2!=0)return[new rt(t,a,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let y=0;y<a.length;y+=2)g=g.concat(ai({key:`${t}[${y}]`,value:a[y],valueSpec:f.layout_symbol["text-anchor"]})),g=g.concat(Tn({key:`${t}[${y+1}]`,value:a[y+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:f}));return g},sprite:ah};function nu(i){const t=i.value,a=i.valueSpec,l=i.styleSpec;return i.validateSpec=nu,a.expression&&k(Zt(t))?Cs(i):a.expression&&Ee(mn(t))?In(i):a.type&&Hu[a.type]?Hu[a.type](i):Yt(Fn({},i,{valueSpec:a.type?l[a.type]:a}))}function Id(i){const t=i.value,a=i.key,l=To(i);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new rt(a,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new rt(a,t,'"glyphs" url must include a "{range}" token'))),l}function ya(i,t=Te){let a=[];return a=a.concat(nu({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:nu,objectElementValidators:{glyphs:Id,"*":()=>[]}})),i.constants&&(a=a.concat(_r({key:"constants",value:i.constants}))),sh(a)}function os(i){return function(t){return i({...t,validateSpec:nu})}}function sh(i){return[].concat(i).sort((t,a)=>t.line-a.line)}function Ra(i){return function(...t){return sh(i.apply(this,t))}}ya.source=Ra(os(ru)),ya.sprite=Ra(os(ah)),ya.glyphs=Ra(os(Id)),ya.light=Ra(os(rh)),ya.sky=Ra(os(nh)),ya.terrain=Ra(os(ih)),ya.layer=Ra(os(th)),ya.filter=Ra(os(Co)),ya.paintProperty=Ra(os(Ku)),ya.layoutProperty=Ra(os(eh));const Io=ya,Np=Io.light,jp=Io.sky,Pd=Io.paintProperty,Ed=Io.layoutProperty;function oh(i,t){let a=!1;if(t&&t.length)for(const l of t)i.fire(new Lr(new Error(l.message))),a=!0;return a}class nl{constructor(t,a,l){const f=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(a=y[1])+2*(l=y[2]);for(let C=0;C<this.d*this.d;C++){const P=y[3+C],A=y[3+C+1];f.push(P===A?null:y.subarray(P,A))}const w=y[3+f.length+1];this.keys=y.subarray(y[3+f.length],w),this.bboxes=y.subarray(w),this.insert=this._insertReadonly}else{this.d=a+2*l;for(let y=0;y<this.d*this.d;y++)f.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=l,this.scale=a/t,this.uid=0;const g=l/a*t;this.min=-g,this.max=t+g}insert(t,a,l,f,g){this._forEachCell(a,l,f,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,a,l,f,g,y){this.cells[g].push(y)}query(t,a,l,f,g){const y=this.min,w=this.max;if(t<=y&&a<=y&&w<=l&&w<=f&&!g)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(t,a,l,f,this._queryCell,C,{},g),C}}_queryCell(t,a,l,f,g,y,w,C){const P=this.cells[g];if(P!==null){const A=this.keys,z=this.bboxes;for(let O=0;O<P.length;O++){const U=P[O];if(w[U]===void 0){const K=4*U;(C?C(z[K+0],z[K+1],z[K+2],z[K+3]):t<=z[K+2]&&a<=z[K+3]&&l>=z[K+0]&&f>=z[K+1])?(w[U]=!0,y.push(A[U])):w[U]=!1}}}}_forEachCell(t,a,l,f,g,y,w,C){const P=this._convertToCellCoord(t),A=this._convertToCellCoord(a),z=this._convertToCellCoord(l),O=this._convertToCellCoord(f);for(let U=P;U<=z;U++)for(let K=A;K<=O;K++){const G=this.d*K+U;if((!C||C(this._convertFromCellCoord(U),this._convertFromCellCoord(K),this._convertFromCellCoord(U+1),this._convertFromCellCoord(K+1)))&&g.call(this,t,a,l,f,G,y,w,C))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,a=3+this.cells.length+1+1;let l=0;for(let y=0;y<this.cells.length;y++)l+=this.cells[y].length;const f=new Int32Array(a+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let g=a;for(let y=0;y<t.length;y++){const w=t[y];f[3+y]=g,f.set(w,g),g+=w.length}return f[3+t.length]=g,f.set(this.keys,g),g+=this.keys.length,f[3+t.length+1]=g,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer}static serialize(t,a){const l=t.toArrayBuffer();return a&&a.push(l),{buffer:l}}static deserialize(t){return new nl(t.buffer)}}const _a={};function Dt(i,t,a={}){if(_a[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),_a[i]={klass:t,omit:a.omit||[],shallow:a.shallow||[]}}Dt("Object",Object),Dt("TransferableGridIndex",nl),Dt("Color",br),Dt("Error",Error),Dt("AJAXError",zr),Dt("ResolvedImage",ci),Dt("StylePropertyFunction",Se),Dt("StyleExpression",xe,{omit:["_evaluator"]}),Dt("ZoomDependentExpression",ve),Dt("ZoomConstantExpression",De),Dt("CompoundExpression",Ni,{omit:["_evaluate"]});for(const i in Ws)Ws[i]._classRegistryKey||Dt(`Expression_${i}`,Ws[i]);function Zu(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function lh(i){return i.$name||i.constructor._classRegistryKey}function Ad(i){return!function(t){if(t===null||typeof t!="object")return!1;const a=lh(t);return!(!a||a==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Zu(i)||nr(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function il(i,t){if(Ad(i))return(Zu(i)||nr(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const g=[];for(const y of i)g.push(il(y,t));return g}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const a=lh(i);if(!a)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!_a[a])throw new Error(`${a} is not registered.`);const{klass:l}=_a[a],f=l.serialize?l.serialize(i,t):{};if(l.serialize){if(t&&f===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in i){if(!i.hasOwnProperty(g)||_a[a].omit.indexOf(g)>=0)continue;const y=i[g];f[g]=_a[a].shallow.indexOf(g)>=0?y:il(y,t)}i instanceof Error&&(f.message=i.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(f.$name=a),f}function al(i){if(Ad(i))return i;if(Array.isArray(i))return i.map(al);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=lh(i)||"Object";if(!_a[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:a}=_a[t];if(!a)throw new Error(`can't deserialize unregistered class ${t}`);if(a.deserialize)return a.deserialize(i);const l=Object.create(a.prototype);for(const f of Object.keys(i)){if(f==="$name")continue;const g=i[f];l[f]=_a[t].shallow.indexOf(f)>=0?g:al(g)}return l}class uh{constructor(){this.first=!0}update(t,a){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const Ir={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function ch(i){for(const t of i)if(dh(t.charCodeAt(0)))return!0;return!1}function Up(i){for(const t of i)if(!sl(t.charCodeAt(0)))return!1;return!0}function hh(i){const t=i.map(a=>{try{return new RegExp(`\\p{sc=${a}}`,"u").source}catch{return null}}).filter(a=>a);return new RegExp(t.join("|"),"u")}const Vp=hh(["Arab","Dupl","Mong","Ougr","Syrc"]);function sl(i){return!Vp.test(String.fromCodePoint(i))}const Md=hh(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function dh(i){return!(i!==746&&i!==747&&(i<4352||!(Ir["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ir["CJK Compatibility"](i)||Ir["CJK Strokes"](i)||!(!Ir["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ir["Enclosed CJK Letters and Months"](i)||Ir["Ideographic Description Characters"](i)||Ir.Kanbun(i)||Ir.Katakana(i)&&i!==12540||!(!Ir["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ir["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ir["Vertical Forms"](i)||Ir["Yijing Hexagram Symbols"](i)||/\p{sc=Cans}/u.test(String.fromCodePoint(i))||/\p{sc=Hang}/u.test(String.fromCodePoint(i))||Md.test(String.fromCodePoint(i)))))}function Dd(i){return!(dh(i)||function(t){return!!(Ir["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ir["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ir["Letterlike Symbols"](t)||Ir["Number Forms"](t)||Ir["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ir["Control Pictures"](t)&&t!==9251||Ir["Optical Character Recognition"](t)||Ir["Enclosed Alphanumerics"](t)||Ir["Geometric Shapes"](t)||Ir["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ir["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ir["CJK Symbols and Punctuation"](t)||Ir.Katakana(t)||Ir["Private Use Area"](t)||Ir["CJK Compatibility Forms"](t)||Ir["Small Form Variants"](t)||Ir["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const $p=hh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function fh(i){return $p.test(String.fromCodePoint(i))}function qp(i,t){return!(!t&&fh(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ir.Khmer(i))}function Kp(i){for(const t of i)if(fh(t.charCodeAt(0)))return!0;return!1}const ta=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class on{constructor(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new uh,this.transition={})}isSupportedScript(t){return function(a,l){for(const f of a)if(!qp(f.charCodeAt(0),l))return!1;return!0}(t,ta.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,a=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*a}}}class ol{constructor(t,a){this.property=t,this.value=a,this.expression=function(l,f){if(k(l))return new Se(l,f);if(Ee(l)){const g=Ce(l,f);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=l;return f.type==="color"&&typeof l=="string"?g=br.parse(l):f.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(l)&&(g=Bn.parse(l)):g=ri.parse(l),{kind:"constant",evaluate:()=>g}}}(a===void 0?t.specification.default:a,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,a,l){return this.property.possiblyEvaluate(this,t,a,l)}}class Wu{constructor(t){this.property=t,this.value=new ol(t,void 0)}transitioned(t,a){return new zd(this.property,this.value,a,Qe({},t.transition,this.transition),t.now)}untransitioned(){return new zd(this.property,this.value,null,{},0)}}class Xu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Ye(this._values[t].value.value)}setValue(t,a){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Wu(this._values[t].property)),this._values[t].value=new ol(this._values[t].property,a===null?void 0:Ye(a))}getTransition(t){return Ye(this._values[t].transition)}setTransition(t,a){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Wu(this._values[t].property)),this._values[t].transition=Ye(a)||void 0}serialize(){const t={};for(const a of Object.keys(this._values)){const l=this.getValue(a);l!==void 0&&(t[a]=l);const f=this.getTransition(a);f!==void 0&&(t[`${a}-transition`]=f)}return t}transitioned(t,a){const l=new iu(this._properties);for(const f of Object.keys(this._values))l._values[f]=this._values[f].transitioned(t,a._values[f]);return l}untransitioned(){const t=new iu(this._properties);for(const a of Object.keys(this._values))t._values[a]=this._values[a].untransitioned();return t}}class zd{constructor(t,a,l,f,g){this.property=t,this.value=a,this.begin=g+f.delay||0,this.end=this.begin+f.duration||0,t.specification.transition&&(f.delay||f.duration)&&(this.prior=l)}possiblyEvaluate(t,a,l){const f=t.now||0,g=this.value.possiblyEvaluate(t,a,l),y=this.prior;if(y){if(f>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(f<this.begin)return y.possiblyEvaluate(t,a,l);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(t,a,l),g,function(C){if(C<=0)return 0;if(C>=1)return 1;const P=C*C,A=P*C;return 4*(C<.5?A:3*(C-P)+A-.75)}(w))}}return g}}class iu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,a,l){const f=new su(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(t,a,l);return f}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class au{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Ye(this._values[t].value)}setValue(t,a){this._values[t]=new ol(this._values[t].property,a===null?void 0:Ye(a))}serialize(){const t={};for(const a of Object.keys(this._values)){const l=this.getValue(a);l!==void 0&&(t[a]=l)}return t}possiblyEvaluate(t,a,l){const f=new su(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(t,a,l);return f}}class ls{constructor(t,a,l){this.property=t,this.value=a,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,a,l,f){return this.property.evaluate(this.value,this.parameters,t,a,l,f)}}class su{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Bt{constructor(t){this.specification=t}possiblyEvaluate(t,a){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(a)}interpolate(t,a,l){const f=ni[this.specification.type];return f?f(t,a,l):t}}class Jt{constructor(t,a){this.specification=t,this.overrides=a}possiblyEvaluate(t,a,l,f){return new ls(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},l,f)}:t.expression,a)}interpolate(t,a,l){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new ls(this,{kind:"constant",value:void 0},t.parameters);const f=ni[this.specification.type];if(f){const g=f(t.value.value,a.value.value,l);return new ls(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,a,l,f,g,y){return t.kind==="constant"?t.value:t.evaluate(a,l,f,g,y)}}class Yu extends Jt{possiblyEvaluate(t,a,l,f){if(t.value===void 0)return new ls(this,{kind:"constant",value:void 0},a);if(t.expression.kind==="constant"){const g=t.expression.evaluate(a,null,{},l,f),y=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,w=this._calculate(y,y,y,a);return new ls(this,{kind:"constant",value:w},a)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:a.zoom-1}),t.expression.evaluate({zoom:a.zoom}),t.expression.evaluate({zoom:a.zoom+1}),a);return new ls(this,{kind:"constant",value:g},a)}return new ls(this,t.expression,a)}evaluate(t,a,l,f,g,y){if(t.kind==="source"){const w=t.evaluate(a,l,f,g,y);return this._calculate(w,w,w,a)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(a.zoom)-1},l,f),t.evaluate({zoom:Math.floor(a.zoom)},l,f),t.evaluate({zoom:Math.floor(a.zoom)+1},l,f),a):t.value}_calculate(t,a,l,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:l,to:a}}interpolate(t){return t}}class Ju{constructor(t){this.specification=t}possiblyEvaluate(t,a,l,f){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(a,null,{},l,f);return this._calculate(g,g,g,a)}return this._calculate(t.expression.evaluate(new on(Math.floor(a.zoom-1),a)),t.expression.evaluate(new on(Math.floor(a.zoom),a)),t.expression.evaluate(new on(Math.floor(a.zoom+1),a)),a)}}_calculate(t,a,l,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:l,to:a}}interpolate(t){return t}}class ph{constructor(t){this.specification=t}possiblyEvaluate(t,a,l,f){return!!t.expression.evaluate(a,null,{},l,f)}interpolate(){return!1}}class m{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in t){const l=t[a];l.specification.overridable&&this.overridableProperties.push(a);const f=this.defaultPropertyValues[a]=new ol(l,void 0),g=this.defaultTransitionablePropertyValues[a]=new Wu(l);this.defaultTransitioningPropertyValues[a]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=f.possiblyEvaluate({})}}}Dt("DataDrivenProperty",Jt),Dt("DataConstantProperty",Bt),Dt("CrossFadedDataDrivenProperty",Yu),Dt("CrossFadedProperty",Ju),Dt("ColorRampProperty",ph);const e="-transition";class s extends gr{constructor(t,a){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),a.layout&&(this._unevaluatedLayout=new au(a.layout)),a.paint)){this._transitionablePaint=new Xu(a.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new su(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,a,l={}){a!=null&&this._validate(Ed,`layers.${this.id}.layout.${t}`,t,a,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,a):this.visibility=a)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,a,l={}){if(a!=null&&this._validate(Pd,`layers.${this.id}.paint.${t}`,t,a,l))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),a||void 0),!1;{const f=this._transitionablePaint._values[t],g=f.property.specification["property-type"]==="cross-faded-data-driven",y=f.value.isDataDriven(),w=f.value;this._transitionablePaint.setValue(t,a),this._handleSpecialPaintPropertyUpdate(t);const C=this._transitionablePaint._values[t].value;return C.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(t,w,C)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,a,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,a){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,a)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Le(t,(a,l)=>!(a===void 0||l==="layout"&&!Object.keys(a).length||l==="paint"&&!Object.keys(a).length))}_validate(t,a,l,f,g={}){return(!g||g.validate!==!1)&&oh(this,t.call(Io,{key:a,layerType:this.type,objectKey:l,value:f,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const a=this.paint.get(t);if(a instanceof ls&&ea(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}}const u={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class d{constructor(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class p{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function S(i,t=1){let a=0,l=0;return{members:i.map(f=>{const g=u[f.type].BYTES_PER_ELEMENT,y=a=T(a,Math.max(t,g)),w=f.components||1;return l=Math.max(l,g),a+=g*w,{name:f.name,type:f.type,components:w,offset:y}}),size:T(a,Math.max(l,t)),alignment:t}}function T(i,t){return Math.ceil(i/t)*t}class I extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,a)}emplace(t,a,l){const f=2*t;return this.int16[f+0]=a,this.int16[f+1]=l,t}}I.prototype.bytesPerElement=4,Dt("StructArrayLayout2i4",I);class M extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,a,l)}emplace(t,a,l,f){const g=3*t;return this.int16[g+0]=a,this.int16[g+1]=l,this.int16[g+2]=f,t}}M.prototype.bytesPerElement=6,Dt("StructArrayLayout3i6",M);class L extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,a,l,f)}emplace(t,a,l,f,g){const y=4*t;return this.int16[y+0]=a,this.int16[y+1]=l,this.int16[y+2]=f,this.int16[y+3]=g,t}}L.prototype.bytesPerElement=8,Dt("StructArrayLayout4i8",L);class R extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,f,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,a,l,f,g,y)}emplace(t,a,l,f,g,y,w){const C=6*t;return this.int16[C+0]=a,this.int16[C+1]=l,this.int16[C+2]=f,this.int16[C+3]=g,this.int16[C+4]=y,this.int16[C+5]=w,t}}R.prototype.bytesPerElement=12,Dt("StructArrayLayout2i4i12",R);class V extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,f,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,a,l,f,g,y)}emplace(t,a,l,f,g,y,w){const C=4*t,P=8*t;return this.int16[C+0]=a,this.int16[C+1]=l,this.uint8[P+4]=f,this.uint8[P+5]=g,this.uint8[P+6]=y,this.uint8[P+7]=w,t}}V.prototype.bytesPerElement=8,Dt("StructArrayLayout2i4ub8",V);class Z extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,a)}emplace(t,a,l){const f=2*t;return this.float32[f+0]=a,this.float32[f+1]=l,t}}Z.prototype.bytesPerElement=8,Dt("StructArrayLayout2f8",Z);class X extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l,f,g,y,w,C,P,A){const z=this.length;return this.resize(z+1),this.emplace(z,t,a,l,f,g,y,w,C,P,A)}emplace(t,a,l,f,g,y,w,C,P,A,z){const O=10*t;return this.uint16[O+0]=a,this.uint16[O+1]=l,this.uint16[O+2]=f,this.uint16[O+3]=g,this.uint16[O+4]=y,this.uint16[O+5]=w,this.uint16[O+6]=C,this.uint16[O+7]=P,this.uint16[O+8]=A,this.uint16[O+9]=z,t}}X.prototype.bytesPerElement=20,Dt("StructArrayLayout10ui20",X);class re extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l,f,g,y,w,C,P,A,z,O){const U=this.length;return this.resize(U+1),this.emplace(U,t,a,l,f,g,y,w,C,P,A,z,O)}emplace(t,a,l,f,g,y,w,C,P,A,z,O,U){const K=12*t;return this.int16[K+0]=a,this.int16[K+1]=l,this.int16[K+2]=f,this.int16[K+3]=g,this.uint16[K+4]=y,this.uint16[K+5]=w,this.uint16[K+6]=C,this.uint16[K+7]=P,this.int16[K+8]=A,this.int16[K+9]=z,this.int16[K+10]=O,this.int16[K+11]=U,t}}re.prototype.bytesPerElement=24,Dt("StructArrayLayout4i4ui4i24",re);class ae extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,a,l)}emplace(t,a,l,f){const g=3*t;return this.float32[g+0]=a,this.float32[g+1]=l,this.float32[g+2]=f,t}}ae.prototype.bytesPerElement=12,Dt("StructArrayLayout3f12",ae);class oe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint32[1*t+0]=a,t}}oe.prototype.bytesPerElement=4,Dt("StructArrayLayout1ul4",oe);class de extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l,f,g,y,w,C,P){const A=this.length;return this.resize(A+1),this.emplace(A,t,a,l,f,g,y,w,C,P)}emplace(t,a,l,f,g,y,w,C,P,A){const z=10*t,O=5*t;return this.int16[z+0]=a,this.int16[z+1]=l,this.int16[z+2]=f,this.int16[z+3]=g,this.int16[z+4]=y,this.int16[z+5]=w,this.uint32[O+3]=C,this.uint16[z+8]=P,this.uint16[z+9]=A,t}}de.prototype.bytesPerElement=20,Dt("StructArrayLayout6i1ul2ui20",de);class Q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,f,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,a,l,f,g,y)}emplace(t,a,l,f,g,y,w){const C=6*t;return this.int16[C+0]=a,this.int16[C+1]=l,this.int16[C+2]=f,this.int16[C+3]=g,this.int16[C+4]=y,this.int16[C+5]=w,t}}Q.prototype.bytesPerElement=12,Dt("StructArrayLayout2i2i2i12",Q);class we extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,a,l,f,g)}emplace(t,a,l,f,g,y){const w=4*t,C=8*t;return this.float32[w+0]=a,this.float32[w+1]=l,this.float32[w+2]=f,this.int16[C+6]=g,this.int16[C+7]=y,t}}we.prototype.bytesPerElement=16,Dt("StructArrayLayout2f1f2i16",we);class Ie extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,f,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,a,l,f,g,y)}emplace(t,a,l,f,g,y,w){const C=16*t,P=4*t,A=8*t;return this.uint8[C+0]=a,this.uint8[C+1]=l,this.float32[P+1]=f,this.float32[P+2]=g,this.int16[A+6]=y,this.int16[A+7]=w,t}}Ie.prototype.bytesPerElement=16,Dt("StructArrayLayout2ub2f2i16",Ie);class Re extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,a,l)}emplace(t,a,l,f){const g=3*t;return this.uint16[g+0]=a,this.uint16[g+1]=l,this.uint16[g+2]=f,t}}Re.prototype.bytesPerElement=6,Dt("StructArrayLayout3ui6",Re);class Xe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l,f,g,y,w,C,P,A,z,O,U,K,G,te,ie){const ze=this.length;return this.resize(ze+1),this.emplace(ze,t,a,l,f,g,y,w,C,P,A,z,O,U,K,G,te,ie)}emplace(t,a,l,f,g,y,w,C,P,A,z,O,U,K,G,te,ie,ze){const ge=24*t,Pe=12*t,je=48*t;return this.int16[ge+0]=a,this.int16[ge+1]=l,this.uint16[ge+2]=f,this.uint16[ge+3]=g,this.uint32[Pe+2]=y,this.uint32[Pe+3]=w,this.uint32[Pe+4]=C,this.uint16[ge+10]=P,this.uint16[ge+11]=A,this.uint16[ge+12]=z,this.float32[Pe+7]=O,this.float32[Pe+8]=U,this.uint8[je+36]=K,this.uint8[je+37]=G,this.uint8[je+38]=te,this.uint32[Pe+10]=ie,this.int16[ge+22]=ze,t}}Xe.prototype.bytesPerElement=48,Dt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Xe);class st extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l,f,g,y,w,C,P,A,z,O,U,K,G,te,ie,ze,ge,Pe,je,nt,Pt,Xt,kt,vt,Ut,Lt){const At=this.length;return this.resize(At+1),this.emplace(At,t,a,l,f,g,y,w,C,P,A,z,O,U,K,G,te,ie,ze,ge,Pe,je,nt,Pt,Xt,kt,vt,Ut,Lt)}emplace(t,a,l,f,g,y,w,C,P,A,z,O,U,K,G,te,ie,ze,ge,Pe,je,nt,Pt,Xt,kt,vt,Ut,Lt,At){const Ze=32*t,Vt=16*t;return this.int16[Ze+0]=a,this.int16[Ze+1]=l,this.int16[Ze+2]=f,this.int16[Ze+3]=g,this.int16[Ze+4]=y,this.int16[Ze+5]=w,this.int16[Ze+6]=C,this.int16[Ze+7]=P,this.uint16[Ze+8]=A,this.uint16[Ze+9]=z,this.uint16[Ze+10]=O,this.uint16[Ze+11]=U,this.uint16[Ze+12]=K,this.uint16[Ze+13]=G,this.uint16[Ze+14]=te,this.uint16[Ze+15]=ie,this.uint16[Ze+16]=ze,this.uint16[Ze+17]=ge,this.uint16[Ze+18]=Pe,this.uint16[Ze+19]=je,this.uint16[Ze+20]=nt,this.uint16[Ze+21]=Pt,this.uint16[Ze+22]=Xt,this.uint32[Vt+12]=kt,this.float32[Vt+13]=vt,this.float32[Vt+14]=Ut,this.uint16[Ze+30]=Lt,this.uint16[Ze+31]=At,t}}st.prototype.bytesPerElement=64,Dt("StructArrayLayout8i15ui1ul2f2ui64",st);class xt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.float32[1*t+0]=a,t}}xt.prototype.bytesPerElement=4,Dt("StructArrayLayout1f4",xt);class Et extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,a,l)}emplace(t,a,l,f){const g=3*t;return this.uint16[6*t+0]=a,this.float32[g+1]=l,this.float32[g+2]=f,t}}Et.prototype.bytesPerElement=12,Dt("StructArrayLayout1ui2f12",Et);class mt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,a,l)}emplace(t,a,l,f){const g=4*t;return this.uint32[2*t+0]=a,this.uint16[g+2]=l,this.uint16[g+3]=f,t}}mt.prototype.bytesPerElement=8,Dt("StructArrayLayout1ul2ui8",mt);class pt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,a)}emplace(t,a,l){const f=2*t;return this.uint16[f+0]=a,this.uint16[f+1]=l,t}}pt.prototype.bytesPerElement=4,Dt("StructArrayLayout2ui4",pt);class Nt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint16[1*t+0]=a,t}}Nt.prototype.bytesPerElement=2,Dt("StructArrayLayout1ui2",Nt);class or extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,a,l,f)}emplace(t,a,l,f,g){const y=4*t;return this.float32[y+0]=a,this.float32[y+1]=l,this.float32[y+2]=f,this.float32[y+3]=g,t}}or.prototype.bytesPerElement=16,Dt("StructArrayLayout4f16",or);class _t extends d{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Y(this.anchorPointX,this.anchorPointY)}}_t.prototype.size=20;class Ct extends de{get(t){return new _t(this,t)}}Dt("CollisionBoxArray",Ct);class ir extends d{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ir.prototype.size=48;class ln extends Xe{get(t){return new ir(this,t)}}Dt("PlacedSymbolArray",ln);class mr extends d{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}mr.prototype.size=64;class Cr extends st{get(t){return new mr(this,t)}}Dt("SymbolInstanceArray",Cr);class un extends xt{getoffsetX(t){return this.float32[1*t+0]}}Dt("GlyphOffsetArray",un);class di extends M{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Dt("SymbolLineVertexArray",di);class Oa extends d{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Oa.prototype.size=12;class cn extends Et{get(t){return new Oa(this,t)}}Dt("TextAnchorOffsetArray",cn);class ji extends d{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ji.prototype.size=8;class Ci extends mt{get(t){return new ji(this,t)}}Dt("FeatureIndexArray",Ci);class fi extends I{}class Ti extends I{}class us extends I{}class ll extends R{}class Qu extends V{}class ul extends Z{}class va extends X{}class ec extends re{}class mh extends ae{}class xa extends oe{}class wa extends Q{}class Js extends Ie{}class Fa extends Re{}class si extends pt{}const pi=S([{name:"a_pos",components:2,type:"Int16"}],4),{members:ra}=pi;class Pr{constructor(t=[]){this.segments=t}prepareSegment(t,a,l,f){let g=this.segments[this.segments.length-1];return t>Pr.MAX_VERTEX_ARRAY_LENGTH&&Ot(`Max vertices per segment is ${Pr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>Pr.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==f)&&(g={vertexOffset:a.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},f!==void 0&&(g.sortKey=f),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const t of this.segments)for(const a in t.vaos)t.vaos[a].destroy()}static simpleSegment(t,a,l,f){return new Pr([{vertexOffset:t,primitiveOffset:a,vertexLength:l,primitiveLength:f,vaos:{},sortKey:0}])}}function Po(i,t){return 256*(i=et(Math.floor(i),0,255))+et(Math.floor(t),0,255)}Pr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dt("SegmentVector",Pr);const cl=S([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var hl={exports:{}},Ld={exports:{}};Ld.exports=function(i,t){var a,l,f,g,y,w,C,P;for(l=i.length-(a=3&i.length),f=t,y=3432918353,w=461845907,P=0;P<l;)C=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,f=27492+(65535&(g=5*(65535&(f=(f^=C=(65535&(C=(C=(65535&C)*y+(((C>>>16)*y&65535)<<16)&4294967295)<<15|C>>>17))*w+(((C>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(C=0,a){case 3:C^=(255&i.charCodeAt(P+2))<<16;case 2:C^=(255&i.charCodeAt(P+1))<<8;case 1:f^=C=(65535&(C=(C=(65535&(C^=255&i.charCodeAt(P)))*y+(((C>>>16)*y&65535)<<16)&4294967295)<<15|C>>>17))*w+(((C>>>16)*w&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var Gp=Ld.exports,Rd={exports:{}};Rd.exports=function(i,t){for(var a,l=i.length,f=t^l,g=0;l>=4;)a=1540483477*(65535&(a=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(a>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),l-=4,++g;switch(l){case 3:f^=(255&i.charCodeAt(g+2))<<16;case 2:f^=(255&i.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var Qs=Gp,Od=Rd.exports;hl.exports=Qs,hl.exports.murmur3=Qs,hl.exports.murmur2=Od;var tc=j(hl.exports);class ou{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,a,l,f){this.ids.push(rc(t)),this.positions.push(a,l,f)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const a=rc(t);let l=0,f=this.ids.length-1;for(;l<f;){const y=l+f>>1;this.ids[y]>=a?f=y:l=y+1}const g=[];for(;this.ids[l]===a;)g.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return g}static serialize(t,a){const l=new Float64Array(t.ids),f=new Uint32Array(t.positions);return nc(l,f,0,l.length-1),a&&a.push(l.buffer,f.buffer),{ids:l,positions:f}}static deserialize(t){const a=new ou;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a}}function rc(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:tc(String(i))}function nc(i,t,a,l){for(;a<l;){const f=i[a+l>>1];let g=a-1,y=l+1;for(;;){do g++;while(i[g]<f);do y--;while(i[y]>f);if(g>=y)break;dl(i,g,y),dl(t,3*g,3*y),dl(t,3*g+1,3*y+1),dl(t,3*g+2,3*y+2)}y-a<l-y?(nc(i,t,a,y),a=y+1):(nc(i,t,y+1,l),l=y)}}function dl(i,t,a){const l=i[t];i[t]=i[a],i[a]=l}Dt("FeaturePositionMap",ou);class lu{constructor(t,a){this.gl=t.gl,this.location=a}}class Fd extends lu{constructor(t,a){super(t,a),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class p_ extends lu{constructor(t,a){super(t,a),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class m_ extends lu{constructor(t,a){super(t,a),this.current=br.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const ub=new Float32Array(16);function Hp(i){return[Po(255*i.r,255*i.g),Po(255*i.b,255*i.a)]}class gh{constructor(t,a,l){this.value=t,this.uniformNames=a.map(f=>`u_${f}`),this.type=l}setUniform(t,a,l){t.set(l.constantOr(this.value))}getBinding(t,a,l){return this.type==="color"?new m_(t,a):new Fd(t,a)}}class ic{constructor(t,a){this.uniformNames=a.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr}setUniform(t,a,l,f){const g=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,a,l){return l.substr(0,9)==="u_pattern"?new p_(t,a):new Fd(t,a)}}class Eo{constructor(t,a,l,f){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=a.map(g=>({name:`a_${g}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,a,l,f,g){const y=this.paintVertexArray.length,w=this.expression.evaluate(new on(0),a,{},f,[],g);this.paintVertexArray.resize(t),this._setPaintValue(y,t,w)}updatePaintArray(t,a,l,f){const g=this.expression.evaluate({zoom:0},l,f);this._setPaintValue(t,a,g)}_setPaintValue(t,a,l){if(this.type==="color"){const f=Hp(l);for(let g=t;g<a;g++)this.paintVertexArray.emplace(g,f[0],f[1])}else{for(let f=t;f<a;f++)this.paintVertexArray.emplace(f,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ts{constructor(t,a,l,f,g,y){this.expression=t,this.uniformNames=a.map(w=>`u_${w}_t`),this.type=l,this.useIntegerZoom=f,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=a.map(w=>({name:`a_${w}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(t,a,l,f,g){const y=this.expression.evaluate(new on(this.zoom),a,{},f,[],g),w=this.expression.evaluate(new on(this.zoom+1),a,{},f,[],g),C=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(C,t,y,w)}updatePaintArray(t,a,l,f){const g=this.expression.evaluate({zoom:this.zoom},l,f),y=this.expression.evaluate({zoom:this.zoom+1},l,f);this._setPaintValue(t,a,g,y)}_setPaintValue(t,a,l,f){if(this.type==="color"){const g=Hp(l),y=Hp(f);for(let w=t;w<a;w++)this.paintVertexArray.emplace(w,g[0],g[1],y[0],y[1])}else{for(let g=t;g<a;g++)this.paintVertexArray.emplace(g,l,f);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,a){const l=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,f=et(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(f)}getBinding(t,a,l){return new Fd(t,a)}}class fl{constructor(t,a,l,f,g,y){this.expression=t,this.type=a,this.useIntegerZoom=l,this.zoom=f,this.layerId=y,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,a,l){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(f,t,a.patterns&&a.patterns[this.layerId],l)}updatePaintArray(t,a,l,f,g){this._setPaintValues(t,a,l.patterns&&l.patterns[this.layerId],g)}_setPaintValues(t,a,l,f){if(!f||!l)return;const{min:g,mid:y,max:w}=l,C=f[g],P=f[y],A=f[w];if(C&&P&&A)for(let z=t;z<a;z++)this.zoomInPaintVertexArray.emplace(z,P.tl[0],P.tl[1],P.br[0],P.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],P.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,P.tl[0],P.tl[1],P.br[0],P.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],P.pixelRatio,A.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,cl.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,cl.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class g_{constructor(t,a,l){this.binders={},this._buffers=[];const f=[];for(const g in t.paint._values){if(!l(g))continue;const y=t.paint.get(g);if(!(y instanceof ls&&ea(y.property.specification)))continue;const w=cb(g,t.type),C=y.value,P=y.property.specification.type,A=y.property.useIntegerZoom,z=y.property.specification["property-type"],O=z==="cross-faded"||z==="cross-faded-data-driven";if(C.kind==="constant")this.binders[g]=O?new ic(C.value,w):new gh(C.value,w,P),f.push(`/u_${g}`);else if(C.kind==="source"||O){const U=y_(g,P,"source");this.binders[g]=O?new fl(C,P,A,a,U,t.id):new Eo(C,w,P,U),f.push(`/a_${g}`)}else{const U=y_(g,P,"composite");this.binders[g]=new Ts(C,w,P,A,a,U),f.push(`/z_${g}`)}}this.cacheKey=f.sort().join("")}getMaxValue(t){const a=this.binders[t];return a instanceof Eo||a instanceof Ts?a.maxValue:0}populatePaintArrays(t,a,l,f,g){for(const y in this.binders){const w=this.binders[y];(w instanceof Eo||w instanceof Ts||w instanceof fl)&&w.populatePaintArray(t,a,l,f,g)}}setConstantPatternPositions(t,a){for(const l in this.binders){const f=this.binders[l];f instanceof ic&&f.setConstantPatternPositions(t,a)}}updatePaintArrays(t,a,l,f,g){let y=!1;for(const w in t){const C=a.getPositions(w);for(const P of C){const A=l.feature(P.index);for(const z in this.binders){const O=this.binders[z];if((O instanceof Eo||O instanceof Ts||O instanceof fl)&&O.expression.isStateDependent===!0){const U=f.paint.get(z);O.expression=U.value,O.updatePaintArray(P.start,P.end,A,t[w],g),y=!0}}}}return y}defines(){const t=[];for(const a in this.binders){const l=this.binders[a];(l instanceof gh||l instanceof ic)&&t.push(...l.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return t}getBinderAttributes(){const t=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof Eo||l instanceof Ts)for(let f=0;f<l.paintVertexAttributes.length;f++)t.push(l.paintVertexAttributes[f].name);else if(l instanceof fl)for(let f=0;f<cl.members.length;f++)t.push(cl.members[f].name)}return t}getBinderUniforms(){const t=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof gh||l instanceof ic||l instanceof Ts)for(const f of l.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,a){const l=[];for(const f in this.binders){const g=this.binders[f];if(g instanceof gh||g instanceof ic||g instanceof Ts){for(const y of g.uniformNames)if(a[y]){const w=g.getBinding(t,a[y],y);l.push({name:y,property:f,binding:w})}}}return l}setUniforms(t,a,l,f){for(const{name:g,property:y,binding:w}of a)this.binders[y].setUniform(w,f,l.get(y),g)}updatePaintBuffers(t){this._buffers=[];for(const a in this.binders){const l=this.binders[a];if(t&&l instanceof fl){const f=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(l instanceof Eo||l instanceof Ts)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const a in this.binders){const l=this.binders[a];(l instanceof Eo||l instanceof Ts||l instanceof fl)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const a=this.binders[t];(a instanceof Eo||a instanceof Ts||a instanceof fl)&&a.destroy()}}}class uu{constructor(t,a,l=()=>!0){this.programConfigurations={};for(const f of t)this.programConfigurations[f.id]=new g_(f,a,l);this.needsUpload=!1,this._featureMap=new ou,this._bufferOffset=0}populatePaintArrays(t,a,l,f,g,y){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,a,f,g,y);a.id!==void 0&&this._featureMap.add(a.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,a,l,f){for(const g of l)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,a,g,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function cb(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function y_(i,t,a){const l={color:{source:Z,composite:or},number:{source:xt,composite:Z}},f=function(g){return{"line-pattern":{source:va,composite:va},"fill-pattern":{source:va,composite:va},"fill-extrusion-pattern":{source:va,composite:va}}[g]}(i);return f&&f[a]||l[t][a]}Dt("ConstantBinder",gh),Dt("CrossFadedConstantBinder",ic),Dt("SourceExpressionBinder",Eo),Dt("CrossFadedCompositeBinder",fl),Dt("CompositeExpressionBinder",Ts),Dt("ProgramConfiguration",g_,{omit:["_buffers"]}),Dt("ProgramConfigurationSet",uu);const jn=8192,Zp=Math.pow(2,14)-1,__=-Zp-1;function cu(i){const t=jn/i.extent,a=i.loadGeometry();for(let l=0;l<a.length;l++){const f=a[l];for(let g=0;g<f.length;g++){const y=f[g],w=Math.round(y.x*t),C=Math.round(y.y*t);y.x=et(w,__,Zp),y.y=et(C,__,Zp),(w<y.x||w>y.x+1||C<y.y||C>y.y+1)&&Ot("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return a}function hu(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?cu(i):[]}}function Bd(i,t,a,l,f){i.emplaceBack(2*t+(l+1)/2,2*a+(f+1)/2)}class Wp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ti,this.indexArray=new Fa,this.segments=new Pr,this.programConfigurations=new uu(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,l){const f=this.layers[0],g=[];let y=null,w=!1;f.type==="circle"&&(y=f.layout.get("circle-sort-key"),w=!y.isConstant());for(const{feature:C,id:P,index:A,sourceLayerIndex:z}of t){const O=this.layers[0]._featureFilter.needGeometry,U=hu(C,O);if(!this.layers[0]._featureFilter.filter(new on(this.zoom),U,l))continue;const K=w?y.evaluate(U,{},l):void 0,G={id:P,properties:C.properties,type:C.type,sourceLayerIndex:z,index:A,geometry:O?U.geometry:cu(C),patterns:{},sortKey:K};g.push(G)}w&&g.sort((C,P)=>C.sortKey-P.sortKey);for(const C of g){const{geometry:P,index:A,sourceLayerIndex:z}=C,O=t[A].feature;this.addFeature(C,P,A,l),a.featureIndex.insert(O,P,A,z,this.index)}}update(t,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ra),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,a,l,f){for(const g of a)for(const y of g){const w=y.x,C=y.y;if(w<0||w>=jn||C<0||C>=jn)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),A=P.vertexLength;Bd(this.layoutVertexArray,w,C,-1,-1),Bd(this.layoutVertexArray,w,C,1,-1),Bd(this.layoutVertexArray,w,C,1,1),Bd(this.layoutVertexArray,w,C,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+3,A+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},f)}}function v_(i,t){for(let a=0;a<i.length;a++)if(ac(t,i[a]))return!0;for(let a=0;a<t.length;a++)if(ac(i,t[a]))return!0;return!!Xp(i,t)}function hb(i,t,a){return!!ac(i,t)||!!Yp(t,i,a)}function x_(i,t){if(i.length===1)return b_(t,i[0]);for(let a=0;a<t.length;a++){const l=t[a];for(let f=0;f<l.length;f++)if(ac(i,l[f]))return!0}for(let a=0;a<i.length;a++)if(b_(t,i[a]))return!0;for(let a=0;a<t.length;a++)if(Xp(i,t[a]))return!0;return!1}function db(i,t,a){if(i.length>1){if(Xp(i,t))return!0;for(let l=0;l<t.length;l++)if(Yp(t[l],i,a))return!0}for(let l=0;l<i.length;l++)if(Yp(i[l],t,a))return!0;return!1}function Xp(i,t){if(i.length===0||t.length===0)return!1;for(let a=0;a<i.length-1;a++){const l=i[a],f=i[a+1];for(let g=0;g<t.length-1;g++)if(fb(l,f,t[g],t[g+1]))return!0}return!1}function fb(i,t,a,l){return vr(i,a,l)!==vr(t,a,l)&&vr(i,t,a)!==vr(i,t,l)}function Yp(i,t,a){const l=a*a;if(t.length===1)return i.distSqr(t[0])<l;for(let f=1;f<t.length;f++)if(w_(i,t[f-1],t[f])<l)return!0;return!1}function w_(i,t,a){const l=t.distSqr(a);if(l===0)return i.distSqr(t);const f=((i.x-t.x)*(a.x-t.x)+(i.y-t.y)*(a.y-t.y))/l;return i.distSqr(f<0?t:f>1?a:a.sub(t)._mult(f)._add(t))}function b_(i,t){let a,l,f,g=!1;for(let y=0;y<i.length;y++){a=i[y];for(let w=0,C=a.length-1;w<a.length;C=w++)l=a[w],f=a[C],l.y>t.y!=f.y>t.y&&t.x<(f.x-l.x)*(t.y-l.y)/(f.y-l.y)+l.x&&(g=!g)}return g}function ac(i,t){let a=!1;for(let l=0,f=i.length-1;l<i.length;f=l++){const g=i[l],y=i[f];g.y>t.y!=y.y>t.y&&t.x<(y.x-g.x)*(t.y-g.y)/(y.y-g.y)+g.x&&(a=!a)}return a}function pb(i,t,a){const l=a[0],f=a[2];if(i.x<l.x&&t.x<l.x||i.x>f.x&&t.x>f.x||i.y<l.y&&t.y<l.y||i.y>f.y&&t.y>f.y)return!1;const g=vr(i,t,a[0]);return g!==vr(i,t,a[1])||g!==vr(i,t,a[2])||g!==vr(i,t,a[3])}function yh(i,t,a){const l=t.paint.get(i).value;return l.kind==="constant"?l.value:a.programConfigurations.get(t.id).getMaxValue(i)}function Nd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function jd(i,t,a,l,f){if(!t[0]&&!t[1])return i;const g=Y.convert(t)._mult(f);a==="viewport"&&g._rotate(-l);const y=[];for(let w=0;w<i.length;w++)y.push(i[w].sub(g));return y}let S_,k_;Dt("CircleBucket",Wp,{omit:["layers"]});var mb={get paint(){return k_=k_||new m({"circle-radius":new Jt(Te.paint_circle["circle-radius"]),"circle-color":new Jt(Te.paint_circle["circle-color"]),"circle-blur":new Jt(Te.paint_circle["circle-blur"]),"circle-opacity":new Jt(Te.paint_circle["circle-opacity"]),"circle-translate":new Bt(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new Bt(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Bt(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Bt(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Jt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Jt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Jt(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return S_=S_||new m({"circle-sort-key":new Jt(Te.layout_circle["circle-sort-key"])})}},Ui=1e-6,sc=typeof Float32Array<"u"?Float32Array:Array;function Jp(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function C_(i,t,a){var l=t[0],f=t[1],g=t[2],y=t[3],w=t[4],C=t[5],P=t[6],A=t[7],z=t[8],O=t[9],U=t[10],K=t[11],G=t[12],te=t[13],ie=t[14],ze=t[15],ge=a[0],Pe=a[1],je=a[2],nt=a[3];return i[0]=ge*l+Pe*w+je*z+nt*G,i[1]=ge*f+Pe*C+je*O+nt*te,i[2]=ge*g+Pe*P+je*U+nt*ie,i[3]=ge*y+Pe*A+je*K+nt*ze,i[4]=(ge=a[4])*l+(Pe=a[5])*w+(je=a[6])*z+(nt=a[7])*G,i[5]=ge*f+Pe*C+je*O+nt*te,i[6]=ge*g+Pe*P+je*U+nt*ie,i[7]=ge*y+Pe*A+je*K+nt*ze,i[8]=(ge=a[8])*l+(Pe=a[9])*w+(je=a[10])*z+(nt=a[11])*G,i[9]=ge*f+Pe*C+je*O+nt*te,i[10]=ge*g+Pe*P+je*U+nt*ie,i[11]=ge*y+Pe*A+je*K+nt*ze,i[12]=(ge=a[12])*l+(Pe=a[13])*w+(je=a[14])*z+(nt=a[15])*G,i[13]=ge*f+Pe*C+je*O+nt*te,i[14]=ge*g+Pe*P+je*U+nt*ie,i[15]=ge*y+Pe*A+je*K+nt*ze,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var _h,gb=C_;function Ud(i,t,a){var l=t[0],f=t[1],g=t[2],y=t[3];return i[0]=a[0]*l+a[4]*f+a[8]*g+a[12]*y,i[1]=a[1]*l+a[5]*f+a[9]*g+a[13]*y,i[2]=a[2]*l+a[6]*f+a[10]*g+a[14]*y,i[3]=a[3]*l+a[7]*f+a[11]*g+a[15]*y,i}_h=new sc(4),sc!=Float32Array&&(_h[0]=0,_h[1]=0,_h[2]=0,_h[3]=0);class yb extends s{constructor(t){super(t,mb)}createBucket(t){return new Wp(t)}queryRadius(t){const a=t;return yh("circle-radius",this,a)+yh("circle-stroke-width",this,a)+Nd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,a,l,f,g,y,w,C){const P=jd(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,w),A=this.paint.get("circle-radius").evaluate(a,l)+this.paint.get("circle-stroke-width").evaluate(a,l),z=this.paint.get("circle-pitch-alignment")==="map",O=z?P:function(K,G){return K.map(te=>T_(te,G))}(P,C),U=z?A*w:A;for(const K of f)for(const G of K){const te=z?G:T_(G,C);let ie=U;const ze=Ud([],[G.x,G.y,0,1],C);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ie*=ze[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ie*=y.cameraToCenterDistance/ze[3]),hb(O,te,ie))return!0}return!1}}function T_(i,t){const a=Ud([],[i.x,i.y,0,1],t);return new Y(a[0]/a[3],a[1]/a[3])}class I_ extends Wp{}let P_;Dt("HeatmapBucket",I_,{omit:["layers"]});var _b={get paint(){return P_=P_||new m({"heatmap-radius":new Jt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Jt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Bt(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ph(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Bt(Te.paint_heatmap["heatmap-opacity"])})}};function Qp(i,{width:t,height:a},l,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*a*l)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${t*a*l}`)}else f=new Uint8Array(t*a*l);return i.width=t,i.height=a,i.data=f,i}function E_(i,{width:t,height:a},l){if(t===i.width&&a===i.height)return;const f=Qp({},{width:t,height:a},l);em(i,f,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,a)},l),i.width=t,i.height=a,i.data=f.data}function em(i,t,a,l,f,g){if(f.width===0||f.height===0)return t;if(f.width>i.width||f.height>i.height||a.x>i.width-f.width||a.y>i.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||l.x>t.width-f.width||l.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,w=t.data;if(y===w)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<f.height;C++){const P=((a.y+C)*i.width+a.x)*g,A=((l.y+C)*t.width+l.x)*g;for(let z=0;z<f.width*g;z++)w[A+z]=y[P+z]}return t}class vh{constructor(t,a){Qp(this,t,1,a)}resize(t){E_(this,t,1)}clone(){return new vh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,l,f,g){em(t,a,l,f,g,1)}}class Ba{constructor(t,a){Qp(this,t,4,a)}resize(t){E_(this,t,4)}replace(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ba({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,l,f,g){em(t,a,l,f,g,4)}}function A_(i){const t={},a=i.resolution||256,l=i.clips?i.clips.length:1,f=i.image||new Ba({width:a,height:l});if(Math.log(a)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${a}`);const g=(y,w,C)=>{t[i.evaluationKey]=C;const P=i.expression.evaluate(t);f.data[y+w+0]=Math.floor(255*P.r/P.a),f.data[y+w+1]=Math.floor(255*P.g/P.a),f.data[y+w+2]=Math.floor(255*P.b/P.a),f.data[y+w+3]=Math.floor(255*P.a)};if(i.clips)for(let y=0,w=0;y<l;++y,w+=4*a)for(let C=0,P=0;C<a;C++,P+=4){const A=C/(a-1),{start:z,end:O}=i.clips[y];g(w,P,z*(1-A)+O*A)}else for(let y=0,w=0;y<a;y++,w+=4)g(0,w,y/(a-1));return f}Dt("AlphaImage",vh),Dt("RGBAImage",Ba);const tm="big-fb";class vb extends s{createBucket(t){return new I_(t)}constructor(t){super(t,_b),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=A_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(tm)&&this.heatmapFbos.delete(tm)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let M_;var xb={get paint(){return M_=M_||new m({"hillshade-illumination-direction":new Bt(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Bt(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Bt(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Bt(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Bt(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Bt(Te.paint_hillshade["hillshade-accent-color"])})}};class wb extends s{constructor(t){super(t,xb)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const bb=S([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sb}=bb;function D_(i,t,a=2){const l=t&&t.length,f=l?t[0]*a:i.length;let g=z_(i,0,f,a,!0);const y=[];if(!g||g.next===g.prev)return y;let w,C,P;if(l&&(g=function(A,z,O,U){const K=[];for(let G=0,te=z.length;G<te;G++){const ie=z_(A,z[G]*U,G<te-1?z[G+1]*U:A.length,U,!1);ie===ie.next&&(ie.steiner=!0),K.push(Mb(ie))}K.sort(Pb);for(let G=0;G<K.length;G++)O=Eb(K[G],O);return O}(i,t,g,a)),i.length>80*a){w=1/0,C=1/0;let A=-1/0,z=-1/0;for(let O=a;O<f;O+=a){const U=i[O],K=i[O+1];U<w&&(w=U),K<C&&(C=K),U>A&&(A=U),K>z&&(z=K)}P=Math.max(A-w,z-C),P=P!==0?32767/P:0}return xh(g,y,a,w,C,P,0),y}function z_(i,t,a,l,f){let g;if(f===function(y,w,C,P){let A=0;for(let z=w,O=C-P;z<C;z+=P)A+=(y[O]-y[z])*(y[z+1]+y[O+1]),O=z;return A}(i,t,a,l)>0)for(let y=t;y<a;y+=l)g=O_(y/l|0,i[y],i[y+1],g);else for(let y=a-l;y>=t;y-=l)g=O_(y/l|0,i[y],i[y+1],g);return g&&Vd(g,g.next)&&(bh(g),g=g.next),g}function du(i,t){if(!i)return i;t||(t=i);let a,l=i;do if(a=!1,l.steiner||!Vd(l,l.next)&&zn(l.prev,l,l.next)!==0)l=l.next;else{if(bh(l),l=t=l.prev,l===l.next)break;a=!0}while(a||l!==t);return t}function xh(i,t,a,l,f,g,y){if(!i)return;!y&&g&&function(C,P,A,z){let O=C;do O.z===0&&(O.z=rm(O.x,O.y,P,A,z)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==C);O.prevZ.nextZ=null,O.prevZ=null,function(U){let K,G=1;do{let te,ie=U;U=null;let ze=null;for(K=0;ie;){K++;let ge=ie,Pe=0;for(let nt=0;nt<G&&(Pe++,ge=ge.nextZ,ge);nt++);let je=G;for(;Pe>0||je>0&&ge;)Pe!==0&&(je===0||!ge||ie.z<=ge.z)?(te=ie,ie=ie.nextZ,Pe--):(te=ge,ge=ge.nextZ,je--),ze?ze.nextZ=te:U=te,te.prevZ=ze,ze=te;ie=ge}ze.nextZ=null,G*=2}while(K>1)}(O)}(i,l,f,g);let w=i;for(;i.prev!==i.next;){const C=i.prev,P=i.next;if(g?Cb(i,l,f,g):kb(i))t.push(C.i,i.i,P.i),bh(i),i=P.next,w=P.next;else if((i=P)===w){y?y===1?xh(i=Tb(du(i),t),t,a,l,f,g,2):y===2&&Ib(i,t,a,l,f,g):xh(du(i),t,a,l,f,g,1);break}}}function kb(i){const t=i.prev,a=i,l=i.next;if(zn(t,a,l)>=0)return!1;const f=t.x,g=a.x,y=l.x,w=t.y,C=a.y,P=l.y,A=f<g?f<y?f:y:g<y?g:y,z=w<C?w<P?w:P:C<P?C:P,O=f>g?f>y?f:y:g>y?g:y,U=w>C?w>P?w:P:C>P?C:P;let K=l.next;for(;K!==t;){if(K.x>=A&&K.x<=O&&K.y>=z&&K.y<=U&&oc(f,w,g,C,y,P,K.x,K.y)&&zn(K.prev,K,K.next)>=0)return!1;K=K.next}return!0}function Cb(i,t,a,l){const f=i.prev,g=i,y=i.next;if(zn(f,g,y)>=0)return!1;const w=f.x,C=g.x,P=y.x,A=f.y,z=g.y,O=y.y,U=w<C?w<P?w:P:C<P?C:P,K=A<z?A<O?A:O:z<O?z:O,G=w>C?w>P?w:P:C>P?C:P,te=A>z?A>O?A:O:z>O?z:O,ie=rm(U,K,t,a,l),ze=rm(G,te,t,a,l);let ge=i.prevZ,Pe=i.nextZ;for(;ge&&ge.z>=ie&&Pe&&Pe.z<=ze;){if(ge.x>=U&&ge.x<=G&&ge.y>=K&&ge.y<=te&&ge!==f&&ge!==y&&oc(w,A,C,z,P,O,ge.x,ge.y)&&zn(ge.prev,ge,ge.next)>=0||(ge=ge.prevZ,Pe.x>=U&&Pe.x<=G&&Pe.y>=K&&Pe.y<=te&&Pe!==f&&Pe!==y&&oc(w,A,C,z,P,O,Pe.x,Pe.y)&&zn(Pe.prev,Pe,Pe.next)>=0))return!1;Pe=Pe.nextZ}for(;ge&&ge.z>=ie;){if(ge.x>=U&&ge.x<=G&&ge.y>=K&&ge.y<=te&&ge!==f&&ge!==y&&oc(w,A,C,z,P,O,ge.x,ge.y)&&zn(ge.prev,ge,ge.next)>=0)return!1;ge=ge.prevZ}for(;Pe&&Pe.z<=ze;){if(Pe.x>=U&&Pe.x<=G&&Pe.y>=K&&Pe.y<=te&&Pe!==f&&Pe!==y&&oc(w,A,C,z,P,O,Pe.x,Pe.y)&&zn(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.nextZ}return!0}function Tb(i,t){let a=i;do{const l=a.prev,f=a.next.next;!Vd(l,f)&&L_(l,a,a.next,f)&&wh(l,f)&&wh(f,l)&&(t.push(l.i,a.i,f.i),bh(a),bh(a.next),a=i=f),a=a.next}while(a!==i);return du(a)}function Ib(i,t,a,l,f,g){let y=i;do{let w=y.next.next;for(;w!==y.prev;){if(y.i!==w.i&&Db(y,w)){let C=R_(y,w);return y=du(y,y.next),C=du(C,C.next),xh(y,t,a,l,f,g,0),void xh(C,t,a,l,f,g,0)}w=w.next}y=y.next}while(y!==i)}function Pb(i,t){return i.x-t.x}function Eb(i,t){const a=function(f,g){let y=g;const w=f.x,C=f.y;let P,A=-1/0;do{if(C<=y.y&&C>=y.next.y&&y.next.y!==y.y){const G=y.x+(C-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(G<=w&&G>A&&(A=G,P=y.x<y.next.x?y:y.next,G===w))return P}y=y.next}while(y!==g);if(!P)return null;const z=P,O=P.x,U=P.y;let K=1/0;y=P;do{if(w>=y.x&&y.x>=O&&w!==y.x&&oc(C<U?w:A,C,O,U,C<U?A:w,C,y.x,y.y)){const G=Math.abs(C-y.y)/(w-y.x);wh(y,f)&&(G<K||G===K&&(y.x>P.x||y.x===P.x&&Ab(P,y)))&&(P=y,K=G)}y=y.next}while(y!==z);return P}(i,t);if(!a)return t;const l=R_(a,i);return du(l,l.next),du(a,a.next)}function Ab(i,t){return zn(i.prev,i,t.prev)<0&&zn(t.next,i,i.next)<0}function rm(i,t,a,l,f){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-a)*f|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*f|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Mb(i){let t=i,a=i;do(t.x<a.x||t.x===a.x&&t.y<a.y)&&(a=t),t=t.next;while(t!==i);return a}function oc(i,t,a,l,f,g,y,w){return(f-y)*(t-w)>=(i-y)*(g-w)&&(i-y)*(l-w)>=(a-y)*(t-w)&&(a-y)*(g-w)>=(f-y)*(l-w)}function Db(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(a,l){let f=a;do{if(f.i!==a.i&&f.next.i!==a.i&&f.i!==l.i&&f.next.i!==l.i&&L_(f,f.next,a,l))return!0;f=f.next}while(f!==a);return!1}(i,t)&&(wh(i,t)&&wh(t,i)&&function(a,l){let f=a,g=!1;const y=(a.x+l.x)/2,w=(a.y+l.y)/2;do f.y>w!=f.next.y>w&&f.next.y!==f.y&&y<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(g=!g),f=f.next;while(f!==a);return g}(i,t)&&(zn(i.prev,i,t.prev)||zn(i,t.prev,t))||Vd(i,t)&&zn(i.prev,i,i.next)>0&&zn(t.prev,t,t.next)>0)}function zn(i,t,a){return(t.y-i.y)*(a.x-t.x)-(t.x-i.x)*(a.y-t.y)}function Vd(i,t){return i.x===t.x&&i.y===t.y}function L_(i,t,a,l){const f=qd(zn(i,t,a)),g=qd(zn(i,t,l)),y=qd(zn(a,l,i)),w=qd(zn(a,l,t));return f!==g&&y!==w||!(f!==0||!$d(i,a,t))||!(g!==0||!$d(i,l,t))||!(y!==0||!$d(a,i,l))||!(w!==0||!$d(a,t,l))}function $d(i,t,a){return t.x<=Math.max(i.x,a.x)&&t.x>=Math.min(i.x,a.x)&&t.y<=Math.max(i.y,a.y)&&t.y>=Math.min(i.y,a.y)}function qd(i){return i>0?1:i<0?-1:0}function wh(i,t){return zn(i.prev,i,i.next)<0?zn(i,t,i.next)>=0&&zn(i,i.prev,t)>=0:zn(i,t,i.prev)<0||zn(i,i.next,t)<0}function R_(i,t){const a=nm(i.i,i.x,i.y),l=nm(t.i,t.x,t.y),f=i.next,g=t.prev;return i.next=t,t.prev=i,a.next=f,f.prev=a,l.next=a,a.prev=l,g.next=l,l.prev=g,l}function O_(i,t,a,l){const f=nm(i,t,a);return l?(f.next=l.next,f.prev=l,l.next.prev=f,l.next=f):(f.prev=f,f.next=f),f}function bh(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function nm(i,t,a){return{i,x:t,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function im(i,t,a){const l=a.patternDependencies;let f=!1;for(const g of t){const y=g.paint.get(`${i}-pattern`);y.isConstant()||(f=!0);const w=y.constantOr(null);w&&(f=!0,l[w.to]=!0,l[w.from]=!0)}return f}function am(i,t,a,l,f){const g=f.patternDependencies;for(const y of t){const w=y.paint.get(`${i}-pattern`).value;if(w.kind!=="constant"){let C=w.evaluate({zoom:l-1},a,{},f.availableImages),P=w.evaluate({zoom:l},a,{},f.availableImages),A=w.evaluate({zoom:l+1},a,{},f.availableImages);C=C&&C.name?C.name:C,P=P&&P.name?P.name:P,A=A&&A.name?A.name:A,g[C]=!0,g[P]=!0,g[A]=!0,a.patterns[y.id]={min:C,mid:P,max:A}}}return a}class sm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new us,this.indexArray=new Fa,this.indexArray2=new si,this.programConfigurations=new uu(t.layers,t.zoom),this.segments=new Pr,this.segments2=new Pr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,l){this.hasPattern=im("fill",this.layers,a);const f=this.layers[0].layout.get("fill-sort-key"),g=!f.isConstant(),y=[];for(const{feature:w,id:C,index:P,sourceLayerIndex:A}of t){const z=this.layers[0]._featureFilter.needGeometry,O=hu(w,z);if(!this.layers[0]._featureFilter.filter(new on(this.zoom),O,l))continue;const U=g?f.evaluate(O,{},l,a.availableImages):void 0,K={id:C,properties:w.properties,type:w.type,sourceLayerIndex:A,index:P,geometry:z?O.geometry:cu(w),patterns:{},sortKey:U};y.push(K)}g&&y.sort((w,C)=>w.sortKey-C.sortKey);for(const w of y){const{geometry:C,index:P,sourceLayerIndex:A}=w;if(this.hasPattern){const z=am("fill",this.layers,w,this.zoom,a);this.patternFeatures.push(z)}else this.addFeature(w,C,P,l,{});a.featureIndex.insert(t[P].feature,C,P,A,this.index)}}update(t,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,l)}addFeatures(t,a,l){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Sb),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,a,l,f,g){for(const y of vo(a,500)){let w=0;for(const U of y)w+=U.length;const C=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),P=C.vertexLength,A=[],z=[];for(const U of y){if(U.length===0)continue;U!==y[0]&&z.push(A.length/2);const K=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),G=K.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(G+U.length-1,G),A.push(U[0].x),A.push(U[0].y);for(let te=1;te<U.length;te++)this.layoutVertexArray.emplaceBack(U[te].x,U[te].y),this.indexArray2.emplaceBack(G+te-1,G+te),A.push(U[te].x),A.push(U[te].y);K.vertexLength+=U.length,K.primitiveLength+=U.length}const O=D_(A,z);for(let U=0;U<O.length;U+=3)this.indexArray.emplaceBack(P+O[U],P+O[U+1],P+O[U+2]);C.vertexLength+=w,C.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,g,f)}}let F_,B_;Dt("FillBucket",sm,{omit:["layers","patternFeatures"]});var zb={get paint(){return B_=B_||new m({"fill-antialias":new Bt(Te.paint_fill["fill-antialias"]),"fill-opacity":new Jt(Te.paint_fill["fill-opacity"]),"fill-color":new Jt(Te.paint_fill["fill-color"]),"fill-outline-color":new Jt(Te.paint_fill["fill-outline-color"]),"fill-translate":new Bt(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new Bt(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Yu(Te.paint_fill["fill-pattern"])})},get layout(){return F_=F_||new m({"fill-sort-key":new Jt(Te.layout_fill["fill-sort-key"])})}};class Lb extends s{constructor(t){super(t,zb)}recalculate(t,a){super.recalculate(t,a);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new sm(t)}queryRadius(){return Nd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,a,l,f,g,y,w){return x_(jd(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,w),f)}isTileClipped(){return!0}}const Rb=S([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ob=S([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Fb}=Rb;var pl={},Bb=q,N_=lc;function lc(i,t,a,l,f){this.properties={},this.extent=a,this.type=0,this._pbf=i,this._geometry=-1,this._keys=l,this._values=f,i.readFields(Nb,this,t)}function Nb(i,t,a){i==1?t.id=a.readVarint():i==2?function(l,f){for(var g=l.readVarint()+l.pos;l.pos<g;){var y=f._keys[l.readVarint()],w=f._values[l.readVarint()];f.properties[y]=w}}(a,t):i==3?t.type=a.readVarint():i==4&&(t._geometry=a.pos)}function jb(i){for(var t,a,l=0,f=0,g=i.length,y=g-1;f<g;y=f++)l+=((a=i[y]).x-(t=i[f]).x)*(t.y+a.y);return l}lc.types=["Unknown","Point","LineString","Polygon"],lc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,a=i.readVarint()+i.pos,l=1,f=0,g=0,y=0,w=[];i.pos<a;){if(f<=0){var C=i.readVarint();l=7&C,f=C>>3}if(f--,l===1||l===2)g+=i.readSVarint(),y+=i.readSVarint(),l===1&&(t&&w.push(t),t=[]),t.push(new Bb(g,y));else{if(l!==7)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&w.push(t),w},lc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,a=1,l=0,f=0,g=0,y=1/0,w=-1/0,C=1/0,P=-1/0;i.pos<t;){if(l<=0){var A=i.readVarint();a=7&A,l=A>>3}if(l--,a===1||a===2)(f+=i.readSVarint())<y&&(y=f),f>w&&(w=f),(g+=i.readSVarint())<C&&(C=g),g>P&&(P=g);else if(a!==7)throw new Error("unknown command "+a)}return[y,C,w,P]},lc.prototype.toGeoJSON=function(i,t,a){var l,f,g=this.extent*Math.pow(2,a),y=this.extent*i,w=this.extent*t,C=this.loadGeometry(),P=lc.types[this.type];function A(U){for(var K=0;K<U.length;K++){var G=U[K];U[K]=[360*(G.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+w)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(l=0;l<C.length;l++)z[l]=C[l][0];A(C=z);break;case 2:for(l=0;l<C.length;l++)A(C[l]);break;case 3:for(C=function(U){var K=U.length;if(K<=1)return[U];for(var G,te,ie=[],ze=0;ze<K;ze++){var ge=jb(U[ze]);ge!==0&&(te===void 0&&(te=ge<0),te===ge<0?(G&&ie.push(G),G=[U[ze]]):G.push(U[ze]))}return G&&ie.push(G),ie}(C),l=0;l<C.length;l++)for(f=0;f<C[l].length;f++)A(C[l][f])}C.length===1?C=C[0]:P="Multi"+P;var O={type:"Feature",geometry:{type:P,coordinates:C},properties:this.properties};return"id"in this&&(O.id=this.id),O};var Ub=N_,j_=U_;function U_(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Vb,this,t),this.length=this._features.length}function Vb(i,t,a){i===15?t.version=a.readVarint():i===1?t.name=a.readString():i===5?t.extent=a.readVarint():i===2?t._features.push(a.pos):i===3?t._keys.push(a.readString()):i===4&&t._values.push(function(l){for(var f=null,g=l.readVarint()+l.pos;l.pos<g;){var y=l.readVarint()>>3;f=y===1?l.readString():y===2?l.readFloat():y===3?l.readDouble():y===4?l.readVarint64():y===5?l.readVarint():y===6?l.readSVarint():y===7?l.readBoolean():null}return f}(a))}U_.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Ub(this._pbf,t,this.extent,this._keys,this._values)};var $b=j_;function qb(i,t,a){if(i===3){var l=new $b(a,a.readVarint()+a.pos);l.length&&(t[l.name]=l)}}pl.VectorTile=function(i,t){this.layers=i.readFields(qb,{},t)},pl.VectorTileFeature=N_,pl.VectorTileLayer=j_;const Kb=pl.VectorTileFeature.types,om=Math.pow(2,13);function Sh(i,t,a,l,f,g,y,w){i.emplaceBack(t,a,2*Math.floor(l*om)+y,f*om*2,g*om*2,Math.round(w))}class lm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ll,this.centroidVertexArray=new fi,this.indexArray=new Fa,this.programConfigurations=new uu(t.layers,t.zoom),this.segments=new Pr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,l){this.features=[],this.hasPattern=im("fill-extrusion",this.layers,a);for(const{feature:f,id:g,index:y,sourceLayerIndex:w}of t){const C=this.layers[0]._featureFilter.needGeometry,P=hu(f,C);if(!this.layers[0]._featureFilter.filter(new on(this.zoom),P,l))continue;const A={id:g,sourceLayerIndex:w,index:y,geometry:C?P.geometry:cu(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(am("fill-extrusion",this.layers,A,this.zoom,a)):this.addFeature(A,A.geometry,y,l,{}),a.featureIndex.insert(f,A.geometry,y,w,this.index,!0)}}addFeatures(t,a,l){for(const f of this.features){const{geometry:g}=f;this.addFeature(f,g,f.index,a,l)}}update(t,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fb),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ob.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,a,l,f,g){for(const y of vo(a,500)){const w={x:0,y:0,vertexCount:0};let C=0;for(const K of y)C+=K.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const K of y){if(K.length===0||Hb(K))continue;let G=0;for(let te=0;te<K.length;te++){const ie=K[te];if(te>=1){const ze=K[te-1];if(!Gb(ie,ze)){P.vertexLength+4>Pr.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ge=ie.sub(ze)._perp()._unit(),Pe=ze.dist(ie);G+Pe>32768&&(G=0),Sh(this.layoutVertexArray,ie.x,ie.y,ge.x,ge.y,0,0,G),Sh(this.layoutVertexArray,ie.x,ie.y,ge.x,ge.y,0,1,G),w.x+=2*ie.x,w.y+=2*ie.y,w.vertexCount+=2,G+=Pe,Sh(this.layoutVertexArray,ze.x,ze.y,ge.x,ge.y,0,0,G),Sh(this.layoutVertexArray,ze.x,ze.y,ge.x,ge.y,0,1,G),w.x+=2*ze.x,w.y+=2*ze.y,w.vertexCount+=2;const je=P.vertexLength;this.indexArray.emplaceBack(je,je+2,je+1),this.indexArray.emplaceBack(je+1,je+2,je+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+C>Pr.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray)),Kb[t.type]!=="Polygon")continue;const A=[],z=[],O=P.vertexLength;for(const K of y)if(K.length!==0){K!==y[0]&&z.push(A.length/2);for(let G=0;G<K.length;G++){const te=K[G];Sh(this.layoutVertexArray,te.x,te.y,0,0,1,1,0),w.x+=te.x,w.y+=te.y,w.vertexCount+=1,A.push(te.x),A.push(te.y)}}const U=D_(A,z);for(let K=0;K<U.length;K+=3)this.indexArray.emplaceBack(O+U[K],O+U[K+2],O+U[K+1]);P.primitiveLength+=U.length/3,P.vertexLength+=C;for(let K=0;K<w.vertexCount;K++){const G=Math.floor(w.x/w.vertexCount),te=Math.floor(w.y/w.vertexCount);this.centroidVertexArray.emplaceBack(G,te)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,g,f)}}function Gb(i,t){return i.x===t.x&&(i.x<0||i.x>jn)||i.y===t.y&&(i.y<0||i.y>jn)}function Hb(i){return i.every(t=>t.x<0)||i.every(t=>t.x>jn)||i.every(t=>t.y<0)||i.every(t=>t.y>jn)}let V_;Dt("FillExtrusionBucket",lm,{omit:["layers","features"]});var Zb={get paint(){return V_=V_||new m({"fill-extrusion-opacity":new Bt(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Jt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Bt(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Bt(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Yu(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Jt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Jt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Bt(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Wb extends s{constructor(t){super(t,Zb)}createBucket(t){return new lm(t)}queryRadius(){return Nd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,a,l,f,g,y,w,C){const P=jd(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,w),A=this.paint.get("fill-extrusion-height").evaluate(a,l),z=this.paint.get("fill-extrusion-base").evaluate(a,l),O=function(K,G,te,ie){const ze=[];for(const ge of K){const Pe=[ge.x,ge.y,0,1];Ud(Pe,Pe,G),ze.push(new Y(Pe[0]/Pe[3],Pe[1]/Pe[3]))}return ze}(P,C),U=function(K,G,te,ie){const ze=[],ge=[],Pe=ie[8]*G,je=ie[9]*G,nt=ie[10]*G,Pt=ie[11]*G,Xt=ie[8]*te,kt=ie[9]*te,vt=ie[10]*te,Ut=ie[11]*te;for(const Lt of K){const At=[],Ze=[];for(const Vt of Lt){const jt=Vt.x,ar=Vt.y,Qr=ie[0]*jt+ie[4]*ar+ie[12],Xr=ie[1]*jt+ie[5]*ar+ie[13],Wn=ie[2]*jt+ie[6]*ar+ie[14],cs=ie[3]*jt+ie[7]*ar+ie[15],gi=Wn+nt,Xn=cs+Pt,Vi=Qr+Xt,$i=Xr+kt,qi=Wn+vt,Pn=cs+Ut,Yn=new Y((Qr+Pe)/Xn,(Xr+je)/Xn);Yn.z=gi/Xn,At.push(Yn);const Ii=new Y(Vi/Pn,$i/Pn);Ii.z=qi/Pn,Ze.push(Ii)}ze.push(At),ge.push(Ze)}return[ze,ge]}(f,z,A,C);return function(K,G,te){let ie=1/0;x_(te,G)&&(ie=$_(te,G[0]));for(let ze=0;ze<G.length;ze++){const ge=G[ze],Pe=K[ze];for(let je=0;je<ge.length-1;je++){const nt=ge[je],Pt=[nt,ge[je+1],Pe[je+1],Pe[je],nt];v_(te,Pt)&&(ie=Math.min(ie,$_(te,Pt)))}}return ie!==1/0&&ie}(U[0],U[1],O)}}function kh(i,t){return i.x*t.x+i.y*t.y}function $_(i,t){if(i.length===1){let a=0;const l=t[a++];let f;for(;!f||l.equals(f);)if(f=t[a++],!f)return 1/0;for(;a<t.length;a++){const g=t[a],y=i[0],w=f.sub(l),C=g.sub(l),P=y.sub(l),A=kh(w,w),z=kh(w,C),O=kh(C,C),U=kh(P,w),K=kh(P,C),G=A*O-z*z,te=(O*U-z*K)/G,ie=(A*K-z*U)/G,ze=l.z*(1-te-ie)+f.z*te+g.z*ie;if(isFinite(ze))return ze}return 1/0}{let a=1/0;for(const l of t)a=Math.min(a,l.z);return a}}const Xb=S([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Yb}=Xb,Jb=S([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Qb}=Jb,e2=pl.VectorTileFeature.types,t2=Math.cos(Math.PI/180*37.5),q_=Math.pow(2,14)/.5;class um{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Qu,this.layoutVertexArray2=new ul,this.indexArray=new Fa,this.programConfigurations=new uu(t.layers,t.zoom),this.segments=new Pr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,l){this.hasPattern=im("line",this.layers,a);const f=this.layers[0].layout.get("line-sort-key"),g=!f.isConstant(),y=[];for(const{feature:w,id:C,index:P,sourceLayerIndex:A}of t){const z=this.layers[0]._featureFilter.needGeometry,O=hu(w,z);if(!this.layers[0]._featureFilter.filter(new on(this.zoom),O,l))continue;const U=g?f.evaluate(O,{},l):void 0,K={id:C,properties:w.properties,type:w.type,sourceLayerIndex:A,index:P,geometry:z?O.geometry:cu(w),patterns:{},sortKey:U};y.push(K)}g&&y.sort((w,C)=>w.sortKey-C.sortKey);for(const w of y){const{geometry:C,index:P,sourceLayerIndex:A}=w;if(this.hasPattern){const z=am("line",this.layers,w,this.zoom,a);this.patternFeatures.push(z)}else this.addFeature(w,C,P,l,{});a.featureIndex.insert(t[P].feature,C,P,A,this.index)}}update(t,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,l)}addFeatures(t,a,l){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Qb)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yb),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,a,l,f,g){const y=this.layers[0].layout,w=y.get("line-join").evaluate(t,{}),C=y.get("line-cap"),P=y.get("line-miter-limit"),A=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const z of a)this.addLine(z,t,w,C,P,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,g,f)}addLine(t,a,l,f,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<t.length-1;ie++)this.totalDistance+=t[ie].dist(t[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=e2[a.type]==="Polygon";let C=t.length;for(;C>=2&&t[C-1].equals(t[C-2]);)C--;let P=0;for(;P<C-1&&t[P].equals(t[P+1]);)P++;if(C<(w?3:2))return;l==="bevel"&&(g=1.05);const A=this.overscaling<=16?15*jn/(512*this.overscaling):0,z=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let O,U,K,G,te;this.e1=this.e2=-1,w&&(O=t[C-2],te=t[P].sub(O)._unit()._perp());for(let ie=P;ie<C;ie++){if(K=ie===C-1?w?t[P+1]:void 0:t[ie+1],K&&t[ie].equals(K))continue;te&&(G=te),O&&(U=O),O=t[ie],te=K?K.sub(O)._unit()._perp():G,G=G||te;let ze=G.add(te);ze.x===0&&ze.y===0||ze._unit();const ge=G.x*te.x+G.y*te.y,Pe=ze.x*te.x+ze.y*te.y,je=Pe!==0?1/Pe:1/0,nt=2*Math.sqrt(2-2*Pe),Pt=Pe<t2&&U&&K,Xt=G.x*te.y-G.y*te.x>0;if(Pt&&ie>P){const Ut=O.dist(U);if(Ut>2*A){const Lt=O.sub(O.sub(U)._mult(A/Ut)._round());this.updateDistance(U,Lt),this.addCurrentVertex(Lt,G,0,0,z),U=Lt}}const kt=U&&K;let vt=kt?l:w?"butt":f;if(kt&&vt==="round"&&(je<y?vt="miter":je<=2&&(vt="fakeround")),vt==="miter"&&je>g&&(vt="bevel"),vt==="bevel"&&(je>2&&(vt="flipbevel"),je<g&&(vt="miter")),U&&this.updateDistance(U,O),vt==="miter")ze._mult(je),this.addCurrentVertex(O,ze,0,0,z);else if(vt==="flipbevel"){if(je>100)ze=te.mult(-1);else{const Ut=je*G.add(te).mag()/G.sub(te).mag();ze._perp()._mult(Ut*(Xt?-1:1))}this.addCurrentVertex(O,ze,0,0,z),this.addCurrentVertex(O,ze.mult(-1),0,0,z)}else if(vt==="bevel"||vt==="fakeround"){const Ut=-Math.sqrt(je*je-1),Lt=Xt?Ut:0,At=Xt?0:Ut;if(U&&this.addCurrentVertex(O,G,Lt,At,z),vt==="fakeround"){const Ze=Math.round(180*nt/Math.PI/20);for(let Vt=1;Vt<Ze;Vt++){let jt=Vt/Ze;if(jt!==.5){const Qr=jt-.5;jt+=jt*Qr*(jt-1)*((1.0904+ge*(ge*(3.55645-1.43519*ge)-3.2452))*Qr*Qr+(.848013+ge*(.215638*ge-1.06021)))}const ar=te.sub(G)._mult(jt)._add(G)._unit()._mult(Xt?-1:1);this.addHalfVertex(O,ar.x,ar.y,!1,Xt,0,z)}}K&&this.addCurrentVertex(O,te,-Lt,-At,z)}else if(vt==="butt")this.addCurrentVertex(O,ze,0,0,z);else if(vt==="square"){const Ut=U?1:-1;this.addCurrentVertex(O,ze,Ut,Ut,z)}else vt==="round"&&(U&&(this.addCurrentVertex(O,G,0,0,z),this.addCurrentVertex(O,G,1,1,z,!0)),K&&(this.addCurrentVertex(O,te,-1,-1,z,!0),this.addCurrentVertex(O,te,0,0,z)));if(Pt&&ie<C-1){const Ut=O.dist(K);if(Ut>2*A){const Lt=O.add(K.sub(O)._mult(A/Ut)._round());this.updateDistance(O,Lt),this.addCurrentVertex(Lt,te,0,0,z),O=Lt}}}}addCurrentVertex(t,a,l,f,g,y=!1){const w=a.y*f-a.x,C=-a.y-a.x*f;this.addHalfVertex(t,a.x+a.y*l,a.y-a.x*l,y,!1,l,g),this.addHalfVertex(t,w,C,y,!0,-f,g),this.distance>q_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,a,l,f,g,y))}addHalfVertex({x:t,y:a},l,f,g,y,w,C){const P=.5*(this.lineClips?this.scaledDistance*(q_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(a<<1)+(y?1:0),Math.round(63*l)+128,Math.round(63*f)+128,1+(w===0?0:w<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),C.primitiveLength++),y?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,a){this.distance+=t.dist(a),this.updateScaledDistance()}}let K_,G_;Dt("LineBucket",um,{omit:["layers","patternFeatures"]});var H_={get paint(){return G_=G_||new m({"line-opacity":new Jt(Te.paint_line["line-opacity"]),"line-color":new Jt(Te.paint_line["line-color"]),"line-translate":new Bt(Te.paint_line["line-translate"]),"line-translate-anchor":new Bt(Te.paint_line["line-translate-anchor"]),"line-width":new Jt(Te.paint_line["line-width"]),"line-gap-width":new Jt(Te.paint_line["line-gap-width"]),"line-offset":new Jt(Te.paint_line["line-offset"]),"line-blur":new Jt(Te.paint_line["line-blur"]),"line-dasharray":new Ju(Te.paint_line["line-dasharray"]),"line-pattern":new Yu(Te.paint_line["line-pattern"]),"line-gradient":new ph(Te.paint_line["line-gradient"])})},get layout(){return K_=K_||new m({"line-cap":new Bt(Te.layout_line["line-cap"]),"line-join":new Jt(Te.layout_line["line-join"]),"line-miter-limit":new Bt(Te.layout_line["line-miter-limit"]),"line-round-limit":new Bt(Te.layout_line["line-round-limit"]),"line-sort-key":new Jt(Te.layout_line["line-sort-key"])})}};class r2 extends Jt{possiblyEvaluate(t,a){return a=new on(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(t,a)}evaluate(t,a,l,f){return a=Qe({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(t,a,l,f)}}let Kd;class n2 extends s{constructor(t){super(t,H_),this.gradientVersion=0,Kd||(Kd=new r2(H_.paint.properties["line-width"].specification),Kd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const a=this.gradientExpression();this.stepInterpolant=!!function(l){return l._styleExpression!==void 0}(a)&&a._styleExpression.expression instanceof vs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,a){super.recalculate(t,a),this.paint._values["line-floorwidth"]=Kd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new um(t)}queryRadius(t){const a=t,l=Z_(yh("line-width",this,a),yh("line-gap-width",this,a)),f=yh("line-offset",this,a);return l/2+Math.abs(f)+Nd(this.paint.get("line-translate"))}queryIntersectsFeature(t,a,l,f,g,y,w){const C=jd(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,w),P=w/2*Z_(this.paint.get("line-width").evaluate(a,l),this.paint.get("line-gap-width").evaluate(a,l)),A=this.paint.get("line-offset").evaluate(a,l);return A&&(f=function(z,O){const U=[];for(let K=0;K<z.length;K++){const G=z[K],te=[];for(let ie=0;ie<G.length;ie++){const ze=G[ie-1],ge=G[ie],Pe=G[ie+1],je=ie===0?new Y(0,0):ge.sub(ze)._unit()._perp(),nt=ie===G.length-1?new Y(0,0):Pe.sub(ge)._unit()._perp(),Pt=je._add(nt)._unit(),Xt=Pt.x*nt.x+Pt.y*nt.y;Xt!==0&&Pt._mult(1/Xt),te.push(Pt._mult(O)._add(ge))}U.push(te)}return U}(f,A*w)),function(z,O,U){for(let K=0;K<O.length;K++){const G=O[K];if(z.length>=3){for(let te=0;te<G.length;te++)if(ac(z,G[te]))return!0}if(db(z,G,U))return!0}return!1}(C,f,P)}isTileClipped(){return!0}}function Z_(i,t){return t>0?t+2*i:i}const i2=S([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),a2=S([{name:"a_projected_pos",components:3,type:"Float32"}],4);S([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const s2=S([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);S([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const W_=S([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),o2=S([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function l2(i,t,a){return i.sections.forEach(l=>{l.text=function(f,g,y){const w=g.layout.get("text-transform").evaluate(y,{});return w==="uppercase"?f=f.toLocaleUpperCase():w==="lowercase"&&(f=f.toLocaleLowerCase()),ta.applyArabicShaping&&(f=ta.applyArabicShaping(f)),f}(l.text,t,a)}),i}S([{name:"triangle",components:3,type:"Uint16"}]),S([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),S([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),S([{type:"Float32",name:"offsetX"}]),S([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),S([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ch={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var qn=24,X_=Wr,Y_=function(i,t,a,l,f){var g,y,w=8*f-l-1,C=(1<<w)-1,P=C>>1,A=-7,z=f-1,O=-1,U=i[t+z];for(z+=O,g=U&(1<<-A)-1,U>>=-A,A+=w;A>0;g=256*g+i[t+z],z+=O,A-=8);for(y=g&(1<<-A)-1,g>>=-A,A+=l;A>0;y=256*y+i[t+z],z+=O,A-=8);if(g===0)g=1-P;else{if(g===C)return y?NaN:1/0*(U?-1:1);y+=Math.pow(2,l),g-=P}return(U?-1:1)*y*Math.pow(2,g-l)},J_=function(i,t,a,l,f,g){var y,w,C,P=8*g-f-1,A=(1<<P)-1,z=A>>1,O=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=0,K=1,G=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(w=isNaN(t)?1:0,y=A):(y=Math.floor(Math.log(t)/Math.LN2),t*(C=Math.pow(2,-y))<1&&(y--,C*=2),(t+=y+z>=1?O/C:O*Math.pow(2,1-z))*C>=2&&(y++,C/=2),y+z>=A?(w=0,y=A):y+z>=1?(w=(t*C-1)*Math.pow(2,f),y+=z):(w=t*Math.pow(2,z-1)*Math.pow(2,f),y=0));f>=8;i[a+U]=255&w,U+=K,w/=256,f-=8);for(y=y<<f|w,P+=f;P>0;i[a+U]=255&y,U+=K,y/=256,P-=8);i[a+U-K]|=128*G};function Wr(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Wr.Varint=0,Wr.Fixed64=1,Wr.Bytes=2,Wr.Fixed32=5;var cm=4294967296,Q_=1/cm,ev=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ao(i){return i.type===Wr.Bytes?i.readVarint()+i.pos:i.pos+1}function uc(i,t,a){return a?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function tv(i,t,a){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));a.realloc(l);for(var f=a.pos-1;f>=i;f--)a.buf[f+l]=a.buf[f]}function u2(i,t){for(var a=0;a<i.length;a++)t.writeVarint(i[a])}function c2(i,t){for(var a=0;a<i.length;a++)t.writeSVarint(i[a])}function h2(i,t){for(var a=0;a<i.length;a++)t.writeFloat(i[a])}function d2(i,t){for(var a=0;a<i.length;a++)t.writeDouble(i[a])}function f2(i,t){for(var a=0;a<i.length;a++)t.writeBoolean(i[a])}function p2(i,t){for(var a=0;a<i.length;a++)t.writeFixed32(i[a])}function m2(i,t){for(var a=0;a<i.length;a++)t.writeSFixed32(i[a])}function g2(i,t){for(var a=0;a<i.length;a++)t.writeFixed64(i[a])}function y2(i,t){for(var a=0;a<i.length;a++)t.writeSFixed64(i[a])}function Gd(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function cc(i,t,a){i[a]=t,i[a+1]=t>>>8,i[a+2]=t>>>16,i[a+3]=t>>>24}function rv(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Wr.prototype={destroy:function(){this.buf=null},readFields:function(i,t,a){for(a=a||this.length;this.pos<a;){var l=this.readVarint(),f=l>>3,g=this.pos;this.type=7&l,i(f,t,this),this.pos===g&&this.skip(l)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Gd(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=rv(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Gd(this.buf,this.pos)+Gd(this.buf,this.pos+4)*cm;return this.pos+=8,i},readSFixed64:function(){var i=Gd(this.buf,this.pos)+rv(this.buf,this.pos+4)*cm;return this.pos+=8,i},readFloat:function(){var i=Y_(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Y_(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,a,l=this.buf;return t=127&(a=l[this.pos++]),a<128?t:(t|=(127&(a=l[this.pos++]))<<7,a<128?t:(t|=(127&(a=l[this.pos++]))<<14,a<128?t:(t|=(127&(a=l[this.pos++]))<<21,a<128?t:function(f,g,y){var w,C,P=y.buf;if(w=(112&(C=P[y.pos++]))>>4,C<128||(w|=(127&(C=P[y.pos++]))<<3,C<128)||(w|=(127&(C=P[y.pos++]))<<10,C<128)||(w|=(127&(C=P[y.pos++]))<<17,C<128)||(w|=(127&(C=P[y.pos++]))<<24,C<128)||(w|=(1&(C=P[y.pos++]))<<31,C<128))return uc(f,w,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(a=l[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&ev?function(a,l,f){return ev.decode(a.subarray(l,f))}(this.buf,t,i):function(a,l,f){for(var g="",y=l;y<f;){var w,C,P,A=a[y],z=null,O=A>239?4:A>223?3:A>191?2:1;if(y+O>f)break;O===1?A<128&&(z=A):O===2?(192&(w=a[y+1]))==128&&(z=(31&A)<<6|63&w)<=127&&(z=null):O===3?(C=a[y+2],(192&(w=a[y+1]))==128&&(192&C)==128&&((z=(15&A)<<12|(63&w)<<6|63&C)<=2047||z>=55296&&z<=57343)&&(z=null)):O===4&&(C=a[y+2],P=a[y+3],(192&(w=a[y+1]))==128&&(192&C)==128&&(192&P)==128&&((z=(15&A)<<18|(63&w)<<12|(63&C)<<6|63&P)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,O=1):z>65535&&(z-=65536,g+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),g+=String.fromCharCode(z),y+=O}return g}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Wr.Bytes)return i.push(this.readVarint(t));var a=Ao(this);for(i=i||[];this.pos<a;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Wr.Bytes)return i.push(this.readSVarint());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Wr.Bytes)return i.push(this.readBoolean());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Wr.Bytes)return i.push(this.readFloat());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Wr.Bytes)return i.push(this.readDouble());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Wr.Bytes)return i.push(this.readFixed32());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Wr.Bytes)return i.push(this.readSFixed32());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Wr.Bytes)return i.push(this.readFixed64());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Wr.Bytes)return i.push(this.readSFixed64());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Wr.Varint)for(;this.buf[this.pos++]>127;);else if(t===Wr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Wr.Fixed32)this.pos+=4;else{if(t!==Wr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var a=new Uint8Array(t);a.set(this.buf),this.buf=a,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),cc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),cc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),cc(this.buf,-1&i,this.pos),cc(this.buf,Math.floor(i*Q_),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),cc(this.buf,-1&i,this.pos),cc(this.buf,Math.floor(i*Q_),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,a){var l,f;if(t>=0?(l=t%4294967296|0,f=t/4294967296|0):(f=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,f=f+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(g,y,w){w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7)}(l,0,a),function(g,y){var w=(7&g)<<4;y.buf[y.pos++]|=w|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(f,a)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(l,f,g){for(var y,w,C=0;C<f.length;C++){if((y=f.charCodeAt(C))>55295&&y<57344){if(!w){y>56319||C+1===f.length?(l[g++]=239,l[g++]=191,l[g++]=189):w=y;continue}if(y<56320){l[g++]=239,l[g++]=191,l[g++]=189,w=y;continue}y=w-55296<<10|y-56320|65536,w=null}else w&&(l[g++]=239,l[g++]=191,l[g++]=189,w=null);y<128?l[g++]=y:(y<2048?l[g++]=y>>6|192:(y<65536?l[g++]=y>>12|224:(l[g++]=y>>18|240,l[g++]=y>>12&63|128),l[g++]=y>>6&63|128),l[g++]=63&y|128)}return g}(this.buf,i,this.pos);var a=this.pos-t;a>=128&&tv(t,a,this),this.pos=t-1,this.writeVarint(a),this.pos+=a},writeFloat:function(i){this.realloc(4),J_(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),J_(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var a=0;a<t;a++)this.buf[this.pos++]=i[a]},writeRawMessage:function(i,t){this.pos++;var a=this.pos;i(t,this);var l=this.pos-a;l>=128&&tv(a,l,this),this.pos=a-1,this.writeVarint(l),this.pos+=l},writeMessage:function(i,t,a){this.writeTag(i,Wr.Bytes),this.writeRawMessage(t,a)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,u2,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,c2,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,f2,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,h2,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,d2,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,p2,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,m2,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,g2,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,y2,t)},writeBytesField:function(i,t){this.writeTag(i,Wr.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Wr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Wr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Wr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Wr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Wr.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Wr.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Wr.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Wr.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Wr.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var hm=j(X_);const dm=3;function _2(i,t,a){i===1&&a.readMessage(v2,t)}function v2(i,t,a){if(i===3){const{id:l,bitmap:f,width:g,height:y,left:w,top:C,advance:P}=a.readMessage(x2,{});t.push({id:l,bitmap:new vh({width:g+2*dm,height:y+2*dm},f),metrics:{width:g,height:y,left:w,top:C,advance:P}})}}function x2(i,t,a){i===1?t.id=a.readVarint():i===2?t.bitmap=a.readBytes():i===3?t.width=a.readVarint():i===4?t.height=a.readVarint():i===5?t.left=a.readSVarint():i===6?t.top=a.readSVarint():i===7&&(t.advance=a.readVarint())}const nv=dm;function iv(i){let t=0,a=0;for(const y of i)t+=y.w*y.h,a=Math.max(a,y.w);i.sort((y,w)=>w.h-y.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),a),h:1/0}];let f=0,g=0;for(const y of i)for(let w=l.length-1;w>=0;w--){const C=l[w];if(!(y.w>C.w||y.h>C.h)){if(y.x=C.x,y.y=C.y,g=Math.max(g,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===C.w&&y.h===C.h){const P=l.pop();w<l.length&&(l[w]=P)}else y.h===C.h?(C.x+=y.w,C.w-=y.w):y.w===C.w?(C.y+=y.h,C.h-=y.h):(l.push({x:C.x+y.w,y:C.y,w:C.w-y.w,h:y.h}),C.y+=y.h,C.h-=y.h);break}}return{w:f,h:g,fill:t/(f*g)||0}}const na=1;class fm{constructor(t,{pixelRatio:a,version:l,stretchX:f,stretchY:g,content:y,textFitWidth:w,textFitHeight:C}){this.paddedRect=t,this.pixelRatio=a,this.stretchX=f,this.stretchY=g,this.content=y,this.version=l,this.textFitWidth=w,this.textFitHeight=C}get tl(){return[this.paddedRect.x+na,this.paddedRect.y+na]}get br(){return[this.paddedRect.x+this.paddedRect.w-na,this.paddedRect.y+this.paddedRect.h-na]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*na)/this.pixelRatio,(this.paddedRect.h-2*na)/this.pixelRatio]}}class av{constructor(t,a){const l={},f={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,l,g),this.addImages(a,f,g);const{w:y,h:w}=iv(g),C=new Ba({width:y||1,height:w||1});for(const P in t){const A=t[P],z=l[P].paddedRect;Ba.copy(A.data,C,{x:0,y:0},{x:z.x+na,y:z.y+na},A.data)}for(const P in a){const A=a[P],z=f[P].paddedRect,O=z.x+na,U=z.y+na,K=A.data.width,G=A.data.height;Ba.copy(A.data,C,{x:0,y:0},{x:O,y:U},A.data),Ba.copy(A.data,C,{x:0,y:G-1},{x:O,y:U-1},{width:K,height:1}),Ba.copy(A.data,C,{x:0,y:0},{x:O,y:U+G},{width:K,height:1}),Ba.copy(A.data,C,{x:K-1,y:0},{x:O-1,y:U},{width:1,height:G}),Ba.copy(A.data,C,{x:0,y:0},{x:O+K,y:U},{width:1,height:G})}this.image=C,this.iconPositions=l,this.patternPositions=f}addImages(t,a,l){for(const f in t){const g=t[f],y={x:0,y:0,w:g.data.width+2*na,h:g.data.height+2*na};l.push(y),a[f]=new fm(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(t,a){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),a),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),a)}patchUpdatedImage(t,a,l){if(!t||!a||t.version===a.version)return;t.version=a.version;const[f,g]=t.tl;l.update(a.data,void 0,{x:f,y:g})}}var ml;Dt("ImagePosition",fm),Dt("ImageAtlas",av),x.ah=void 0,(ml=x.ah||(x.ah={}))[ml.none=0]="none",ml[ml.horizontal=1]="horizontal",ml[ml.vertical=2]="vertical",ml[ml.horizontalOnly=3]="horizontalOnly";const Th=-17;class Ih{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,a){const l=new Ih;return l.scale=t||1,l.fontStack=a,l}static forImage(t){const a=new Ih;return a.imageName=t,a}}class hc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,a){const l=new hc;for(let f=0;f<t.sections.length;f++){const g=t.sections[f];g.image?l.addImageSection(g):l.addTextSection(g,a)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let a="";for(let l=0;l<t.length;l++){const f=t.charCodeAt(l+1)||null,g=t.charCodeAt(l-1)||null;a+=f&&Dd(f)&&!Ch[t[l+1]]||g&&Dd(g)&&!Ch[t[l-1]]||!Ch[t[l]]?t[l]:Ch[t[l]]}return a}(this.text)}trim(){let t=0;for(let l=0;l<this.text.length&&Zd[this.text.charCodeAt(l)];l++)t++;let a=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&Zd[this.text.charCodeAt(l)];l--)a--;this.text=this.text.substring(t,a),this.sectionIndex=this.sectionIndex.slice(t,a)}substring(t,a){const l=new hc;return l.text=this.text.substring(t,a),l.sectionIndex=this.sectionIndex.slice(t,a),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,a)=>Math.max(t,this.sections[a].scale),0)}addTextSection(t,a){this.text+=t.text,this.sections.push(Ih.forText(t.scale,t.fontStack||a));const l=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(l)}addImageSection(t){const a=t.image?t.image.name:"";if(a.length===0)return void Ot("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Ih.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Ot("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Hd(i,t,a,l,f,g,y,w,C,P,A,z,O,U,K){const G=hc.fromFeature(i,f);let te;z===x.ah.vertical&&G.verticalizePunctuation();const{processBidirectionalText:ie,processStyledBidirectionalText:ze}=ta;if(ie&&G.sections.length===1){te=[];const je=ie(G.toString(),pm(G,P,g,t,l,U));for(const nt of je){const Pt=new hc;Pt.text=nt,Pt.sections=G.sections;for(let Xt=0;Xt<nt.length;Xt++)Pt.sectionIndex.push(0);te.push(Pt)}}else if(ze){te=[];const je=ze(G.text,G.sectionIndex,pm(G,P,g,t,l,U));for(const nt of je){const Pt=new hc;Pt.text=nt[0],Pt.sectionIndex=nt[1],Pt.sections=G.sections,te.push(Pt)}}else te=function(je,nt){const Pt=[],Xt=je.text;let kt=0;for(const vt of nt)Pt.push(je.substring(kt,vt)),kt=vt;return kt<Xt.length&&Pt.push(je.substring(kt,Xt.length)),Pt}(G,pm(G,P,g,t,l,U));const ge=[],Pe={positionedLines:ge,text:G.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(je,nt,Pt,Xt,kt,vt,Ut,Lt,At,Ze,Vt,jt){let ar=0,Qr=Th,Xr=0,Wn=0;const cs=Lt==="right"?1:Lt==="left"?0:.5;let gi=0;for(const Pn of kt){Pn.trim();const Yn=Pn.getMaxScale(),Ii=(Yn-1)*qn,yi={positionedGlyphs:[],lineOffset:0};je.positionedLines[gi]=yi;const Ki=yi.positionedGlyphs;let _i=0;if(!Pn.length()){Qr+=vt,++gi;continue}for(let ia=0;ia<Pn.length();ia++){const Fr=Pn.getSection(ia),tn=Pn.getSectionIndex(ia),hn=Pn.getCharCode(ia);let ba=0,xn=null,mc=null,to=null,ro=qn;const hs=!(At===x.ah.horizontal||!Vt&&!dh(hn)||Vt&&(Zd[hn]||(Xn=hn,/\p{sc=Arab}/u.test(String.fromCodePoint(Xn)))));if(Fr.imageName){const Ua=Xt[Fr.imageName];if(!Ua)continue;to=Fr.imageName,je.iconsInText=je.iconsInText||!0,mc=Ua.paddedRect;const oi=Ua.displaySize;Fr.scale=Fr.scale*qn/jt,xn={width:oi[0],height:oi[1],left:na,top:-nv,advance:hs?oi[1]:oi[0]},ba=Ii+(qn-oi[1]*Fr.scale),ro=xn.advance;const Mo=hs?oi[0]*Fr.scale-qn*Yn:oi[1]*Fr.scale-qn*Yn;Mo>0&&Mo>_i&&(_i=Mo)}else{const Ua=Pt[Fr.fontStack],oi=Ua&&Ua[hn];if(oi&&oi.rect)mc=oi.rect,xn=oi.metrics;else{const Mo=nt[Fr.fontStack],zh=Mo&&Mo[hn];if(!zh)continue;xn=zh.metrics}ba=(Yn-Fr.scale)*qn}hs?(je.verticalizable=!0,Ki.push({glyph:hn,imageName:to,x:ar,y:Qr+ba,vertical:hs,scale:Fr.scale,fontStack:Fr.fontStack,sectionIndex:tn,metrics:xn,rect:mc}),ar+=ro*Fr.scale+Ze):(Ki.push({glyph:hn,imageName:to,x:ar,y:Qr+ba,vertical:hs,scale:Fr.scale,fontStack:Fr.fontStack,sectionIndex:tn,metrics:xn,rect:mc}),ar+=xn.advance*Fr.scale+Ze)}Ki.length!==0&&(Xr=Math.max(ar-Ze,Xr),k2(Ki,0,Ki.length-1,cs,_i)),ar=0;const ja=vt*Yn+_i;yi.lineOffset=Math.max(_i,Ii),Qr+=ja,Wn=Math.max(ja,Wn),++gi}var Xn;const Vi=Qr-Th,{horizontalAlign:$i,verticalAlign:qi}=mm(Ut);(function(Pn,Yn,Ii,yi,Ki,_i,ja,ia,Fr){const tn=(Yn-Ii)*Ki;let hn=0;hn=_i!==ja?-ia*yi-Th:(-yi*Fr+.5)*ja;for(const ba of Pn)for(const xn of ba.positionedGlyphs)xn.x+=tn,xn.y+=hn})(je.positionedLines,cs,$i,qi,Xr,Wn,vt,Vi,kt.length),je.top+=-qi*Vi,je.bottom=je.top+Vi,je.left+=-$i*Xr,je.right=je.left+Xr}(Pe,t,a,l,te,y,w,C,z,P,O,K),!function(je){for(const nt of je)if(nt.positionedGlyphs.length!==0)return!1;return!0}(ge)&&Pe}const Zd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},w2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},b2={40:!0};function sv(i,t,a,l,f,g){if(t.imageName){const y=l[t.imageName];return y?y.displaySize[0]*t.scale*qn/g+f:0}{const y=a[t.fontStack],w=y&&y[i];return w?w.metrics.advance*t.scale+f:0}}function ov(i,t,a,l){const f=Math.pow(i-t,2);return l?i<t?f/2:2*f:f+Math.abs(a)*a}function S2(i,t,a){let l=0;return i===10&&(l-=1e4),a&&(l+=150),i!==40&&i!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function lv(i,t,a,l,f,g){let y=null,w=ov(t,a,f,g);for(const C of l){const P=ov(t-C.x,a,f,g)+C.badness;P<=w&&(y=C,w=P)}return{index:i,x:t,priorBreak:y,badness:w}}function uv(i){return i?uv(i.priorBreak).concat(i.index):[]}function pm(i,t,a,l,f,g){if(!i)return[];const y=[],w=function(z,O,U,K,G,te){let ie=0;for(let ze=0;ze<z.length();ze++){const ge=z.getSection(ze);ie+=sv(z.getCharCode(ze),ge,K,G,O,te)}return ie/Math.max(1,Math.ceil(ie/U))}(i,t,a,l,f,g),C=i.text.indexOf("")>=0;let P=0;for(let z=0;z<i.length();z++){const O=i.getSection(z),U=i.getCharCode(z);if(Zd[U]||(P+=sv(U,O,l,f,t,g)),z<i.length()-1){const K=!((A=U)<11904)&&(!!Ir["CJK Compatibility Forms"](A)||!!Ir["CJK Compatibility"](A)||!!Ir["CJK Strokes"](A)||!!Ir["CJK Symbols and Punctuation"](A)||!!Ir["Enclosed CJK Letters and Months"](A)||!!Ir["Halfwidth and Fullwidth Forms"](A)||!!Ir["Ideographic Description Characters"](A)||!!Ir["Vertical Forms"](A)||Md.test(String.fromCodePoint(A)));(w2[U]||K||O.imageName||z!==i.length()-2&&b2[i.getCharCode(z+1)])&&y.push(lv(z+1,P,w,y,S2(U,i.getCharCode(z+1),K&&C),!1))}}var A;return uv(lv(i.length(),P,w,y,0,!0))}function mm(i){let t=.5,a=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:t,verticalAlign:a}}function k2(i,t,a,l,f){if(!l&&!f)return;const g=i[a],y=(i[a].x+g.metrics.advance*g.scale)*l;for(let w=t;w<=a;w++)i[w].x-=y,i[w].y+=f}function C2(i,t,a){const{horizontalAlign:l,verticalAlign:f}=mm(a),g=t[0]-i.displaySize[0]*l,y=t[1]-i.displaySize[1]*f;return{image:i,top:y,bottom:y+i.displaySize[1],left:g,right:g+i.displaySize[0]}}function cv(i){var t,a;let l=i.left,f=i.top,g=i.right-l,y=i.bottom-f;const w=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",C=(a=i.image.textFitHeight)!==null&&a!==void 0?a:"stretchOrShrink",P=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(C==="proportional"){if(w==="stretchOnly"&&g/y<P||w==="proportional"){const A=Math.ceil(y*P);l*=A/g,g=A}}else if(w==="proportional"&&C==="stretchOnly"&&P!==0&&g/y>P){const A=Math.ceil(g/P);f*=A/y,y=A}return{x1:l,y1:f,x2:l+g,y2:f+y}}function hv(i,t,a,l,f,g){const y=i.image;let w;if(y.content){const te=y.content,ie=y.pixelRatio||1;w=[te[0]/ie,te[1]/ie,y.displaySize[0]-te[2]/ie,y.displaySize[1]-te[3]/ie]}const C=t.left*g,P=t.right*g;let A,z,O,U;a==="width"||a==="both"?(U=f[0]+C-l[3],z=f[0]+P+l[1]):(U=f[0]+(C+P-y.displaySize[0])/2,z=U+y.displaySize[0]);const K=t.top*g,G=t.bottom*g;return a==="height"||a==="both"?(A=f[1]+K-l[0],O=f[1]+G+l[2]):(A=f[1]+(K+G-y.displaySize[1])/2,O=A+y.displaySize[1]),{image:y,top:A,right:z,bottom:O,left:U,collisionPadding:w}}const Ph=255,eo=128,gl=Ph*eo;function dv(i,t){const{expression:a}=t;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new on(i+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:f}=a;let g=0;for(;g<l.length&&l[g]<=i;)g++;g=Math.max(0,g-1);let y=g;for(;y<l.length&&l[y]<i+1;)y++;y=Math.min(l.length-1,y);const w=l[g],C=l[y];return a.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:C,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:C,minSize:a.evaluate(new on(w)),maxSize:a.evaluate(new on(C)),interpolationType:f}}}function gm(i,t,a){let l="never";const f=i.get(t);return f?l=f:i.get(a)&&(l="always"),l}const T2=pl.VectorTileFeature.types,I2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wd(i,t,a,l,f,g,y,w,C,P,A,z,O){const U=w?Math.min(gl,Math.round(w[0])):0,K=w?Math.min(gl,Math.round(w[1])):0;i.emplaceBack(t,a,Math.round(32*l),Math.round(32*f),g,y,(U<<1)+(C?1:0),K,16*P,16*A,256*z,256*O)}function ym(i,t,a){i.emplaceBack(t.x,t.y,a),i.emplaceBack(t.x,t.y,a),i.emplaceBack(t.x,t.y,a),i.emplaceBack(t.x,t.y,a)}function P2(i){for(const t of i.sections)if(Kp(t.text))return!0;return!1}class _m{constructor(t){this.layoutVertexArray=new ec,this.indexArray=new Fa,this.programConfigurations=t,this.segments=new Pr,this.dynamicLayoutVertexArray=new mh,this.opacityVertexArray=new xa,this.hasVisibleVertices=!1,this.placedSymbolArray=new ln}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,a,l,f){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,i2.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,a2.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,I2,!0),this.opacityVertexBuffer.itemSize=1),(l||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Dt("SymbolBuffers",_m);class vm{constructor(t,a,l){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new l,this.segments=new Pr,this.collisionVertexArray=new Js}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,s2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Dt("CollisionBuffers",vm);class dc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(y=>y.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Jp([]),this.placementViewportMatrix=Jp([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dv(this.zoom,a["text-size"]),this.iconSizeData=dv(this.zoom,a["icon-size"]);const l=this.layers[0].layout,f=l.get("symbol-sort-key"),g=l.get("symbol-z-order");this.canOverlap=gm(l,"text-overlap","text-allow-overlap")!=="never"||gm(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(y=>x.ah[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=t.sourceID}createArrays(){this.text=new _m(new uu(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new _m(new uu(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new un,this.lineVertexArray=new di,this.symbolInstances=new Cr,this.textAnchorOffsets=new cn}calculateGlyphDependencies(t,a,l,f,g){for(let y=0;y<t.length;y++)if(a[t.charCodeAt(y)]=!0,(l||f)&&g){const w=Ch[t.charAt(y)];w&&(a[w.charCodeAt(0)]=!0)}}populate(t,a,l){const f=this.layers[0],g=f.layout,y=g.get("text-font"),w=g.get("text-field"),C=g.get("icon-image"),P=(w.value.kind!=="constant"||w.value.value instanceof Hn&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),A=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,z=g.get("symbol-sort-key");if(this.features=[],!P&&!A)return;const O=a.iconDependencies,U=a.glyphDependencies,K=a.availableImages,G=new on(this.zoom);for(const{feature:te,id:ie,index:ze,sourceLayerIndex:ge}of t){const Pe=f._featureFilter.needGeometry,je=hu(te,Pe);if(!f._featureFilter.filter(G,je,l))continue;let nt,Pt;if(Pe||(je.geometry=cu(te)),P){const kt=f.getValueAndResolveTokens("text-field",je,l,K),vt=Hn.factory(kt),Ut=this.hasRTLText=this.hasRTLText||P2(vt);(!Ut||ta.getRTLTextPluginStatus()==="unavailable"||Ut&&ta.isParsed())&&(nt=l2(vt,f,je))}if(A){const kt=f.getValueAndResolveTokens("icon-image",je,l,K);Pt=kt instanceof ci?kt:ci.fromString(kt)}if(!nt&&!Pt)continue;const Xt=this.sortFeaturesByKey?z.evaluate(je,{},l):void 0;if(this.features.push({id:ie,text:nt,icon:Pt,index:ze,sourceLayerIndex:ge,geometry:je.geometry,properties:te.properties,type:T2[te.type],sortKey:Xt}),Pt&&(O[Pt.name]=!0),nt){const kt=y.evaluate(je,{},l).join(","),vt=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(x.ah.vertical)>=0;for(const Ut of nt.sections)if(Ut.image)O[Ut.image.name]=!0;else{const Lt=ch(nt.toString()),At=Ut.fontStack||kt,Ze=U[At]=U[At]||{};this.calculateGlyphDependencies(Ut.text,Ze,vt,this.allowVerticalPlacement,Lt)}}}g.get("symbol-placement")==="line"&&(this.features=function(te){const ie={},ze={},ge=[];let Pe=0;function je(kt){ge.push(te[kt]),Pe++}function nt(kt,vt,Ut){const Lt=ze[kt];return delete ze[kt],ze[vt]=Lt,ge[Lt].geometry[0].pop(),ge[Lt].geometry[0]=ge[Lt].geometry[0].concat(Ut[0]),Lt}function Pt(kt,vt,Ut){const Lt=ie[vt];return delete ie[vt],ie[kt]=Lt,ge[Lt].geometry[0].shift(),ge[Lt].geometry[0]=Ut[0].concat(ge[Lt].geometry[0]),Lt}function Xt(kt,vt,Ut){const Lt=Ut?vt[0][vt[0].length-1]:vt[0][0];return`${kt}:${Lt.x}:${Lt.y}`}for(let kt=0;kt<te.length;kt++){const vt=te[kt],Ut=vt.geometry,Lt=vt.text?vt.text.toString():null;if(!Lt){je(kt);continue}const At=Xt(Lt,Ut),Ze=Xt(Lt,Ut,!0);if(At in ze&&Ze in ie&&ze[At]!==ie[Ze]){const Vt=Pt(At,Ze,Ut),jt=nt(At,Ze,ge[Vt].geometry);delete ie[At],delete ze[Ze],ze[Xt(Lt,ge[jt].geometry,!0)]=jt,ge[Vt].geometry=null}else At in ze?nt(At,Ze,Ut):Ze in ie?Pt(At,Ze,Ut):(je(kt),ie[At]=Pe-1,ze[Ze]=Pe-1)}return ge.filter(kt=>kt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((te,ie)=>te.sortKey-ie.sortKey)}update(t,a,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,l),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,a){const l=this.lineVertexArray.length;if(t.segment!==void 0){let f=t.dist(a[t.segment+1]),g=t.dist(a[t.segment]);const y={};for(let w=t.segment+1;w<a.length;w++)y[w]={x:a[w].x,y:a[w].y,tileUnitDistanceFromAnchor:f},w<a.length-1&&(f+=a[w+1].dist(a[w]));for(let w=t.segment||0;w>=0;w--)y[w]={x:a[w].x,y:a[w].y,tileUnitDistanceFromAnchor:g},w>0&&(g+=a[w-1].dist(a[w]));for(let w=0;w<a.length;w++){const C=y[w];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,a,l,f,g,y,w,C,P,A,z,O){const U=t.indexArray,K=t.layoutVertexArray,G=t.segments.prepareSegment(4*a.length,K,U,this.canOverlap?y.sortKey:void 0),te=this.glyphOffsetArray.length,ie=G.vertexLength,ze=this.allowVerticalPlacement&&w===x.ah.vertical?Math.PI/2:0,ge=y.text&&y.text.sections;for(let Pe=0;Pe<a.length;Pe++){const{tl:je,tr:nt,bl:Pt,br:Xt,tex:kt,pixelOffsetTL:vt,pixelOffsetBR:Ut,minFontScaleX:Lt,minFontScaleY:At,glyphOffset:Ze,isSDF:Vt,sectionIndex:jt}=a[Pe],ar=G.vertexLength,Qr=Ze[1];Wd(K,C.x,C.y,je.x,Qr+je.y,kt.x,kt.y,l,Vt,vt.x,vt.y,Lt,At),Wd(K,C.x,C.y,nt.x,Qr+nt.y,kt.x+kt.w,kt.y,l,Vt,Ut.x,vt.y,Lt,At),Wd(K,C.x,C.y,Pt.x,Qr+Pt.y,kt.x,kt.y+kt.h,l,Vt,vt.x,Ut.y,Lt,At),Wd(K,C.x,C.y,Xt.x,Qr+Xt.y,kt.x+kt.w,kt.y+kt.h,l,Vt,Ut.x,Ut.y,Lt,At),ym(t.dynamicLayoutVertexArray,C,ze),U.emplaceBack(ar,ar+1,ar+2),U.emplaceBack(ar+1,ar+2,ar+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ze[0]),Pe!==a.length-1&&jt===a[Pe+1].sectionIndex||t.programConfigurations.populatePaintArrays(K.length,y,y.index,{},O,ge&&ge[jt])}t.placedSymbolArray.emplaceBack(C.x,C.y,te,this.glyphOffsetArray.length-te,ie,P,A,C.segment,l?l[0]:0,l?l[1]:0,f[0],f[1],w,0,!1,0,z)}_addCollisionDebugVertex(t,a,l,f,g,y){return a.emplaceBack(0,0),t.emplaceBack(l.x,l.y,f,g,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(t,a,l,f,g,y,w){const C=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),P=C.vertexLength,A=g.layoutVertexArray,z=g.collisionVertexArray,O=w.anchorX,U=w.anchorY;this._addCollisionDebugVertex(A,z,y,O,U,new Y(t,a)),this._addCollisionDebugVertex(A,z,y,O,U,new Y(l,a)),this._addCollisionDebugVertex(A,z,y,O,U,new Y(l,f)),this._addCollisionDebugVertex(A,z,y,O,U,new Y(t,f)),C.vertexLength+=4;const K=g.indexArray;K.emplaceBack(P,P+1),K.emplaceBack(P+1,P+2),K.emplaceBack(P+2,P+3),K.emplaceBack(P+3,P),C.primitiveLength+=4}addDebugCollisionBoxes(t,a,l,f){for(let g=t;g<a;g++){const y=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,f?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vm(wa,W_.members,si),this.iconCollisionBox=new vm(wa,W_.members,si);for(let t=0;t<this.symbolInstances.length;t++){const a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(t,a,l,f,g,y,w,C,P){const A={};for(let z=a;z<l;z++){const O=t.get(z);A.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},A.textFeatureIndex=O.featureIndex;break}for(let z=f;z<g;z++){const O=t.get(z);A.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},A.verticalTextFeatureIndex=O.featureIndex;break}for(let z=y;z<w;z++){const O=t.get(z);A.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},A.iconFeatureIndex=O.featureIndex;break}for(let z=C;z<P;z++){const O=t.get(z);A.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},A.verticalIconFeatureIndex=O.featureIndex;break}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const l=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,a){const l=t.placedSymbolArray.get(a),f=l.vertexStartIndex+4*l.numGlyphs;for(let g=l.vertexStartIndex;g<f;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(t),l=Math.cos(t),f=[],g=[],y=[];for(let w=0;w<this.symbolInstances.length;++w){y.push(w);const C=this.symbolInstances.get(w);f.push(0|Math.round(a*C.anchorX+l*C.anchorY)),g.push(C.featureIndex)}return y.sort((w,C)=>f[w]-f[C]||g[C]-g[w]),y}addToSortKeyRanges(t,a){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===a?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const l=this.symbolInstances.get(a);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((f,g,y)=>{f>=0&&y.indexOf(f)===g&&this.addIndicesForPlacedSymbol(this.text,f)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let fv,pv;Dt("SymbolBucket",dc,{omit:["layers","collisionBoxArray","features","compareText"]}),dc.MAX_GLYPHS=65535,dc.addDynamicAttributes=ym;var xm={get paint(){return pv=pv||new m({"icon-opacity":new Jt(Te.paint_symbol["icon-opacity"]),"icon-color":new Jt(Te.paint_symbol["icon-color"]),"icon-halo-color":new Jt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Jt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Jt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new Bt(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Bt(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Jt(Te.paint_symbol["text-opacity"]),"text-color":new Jt(Te.paint_symbol["text-color"],{runtimeType:zt,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Jt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new Jt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new Jt(Te.paint_symbol["text-halo-blur"]),"text-translate":new Bt(Te.paint_symbol["text-translate"]),"text-translate-anchor":new Bt(Te.paint_symbol["text-translate-anchor"])})},get layout(){return fv=fv||new m({"symbol-placement":new Bt(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new Bt(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Bt(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Jt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Bt(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Bt(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Bt(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Bt(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Bt(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Bt(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Jt(Te.layout_symbol["icon-size"]),"icon-text-fit":new Bt(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bt(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Jt(Te.layout_symbol["icon-image"]),"icon-rotate":new Jt(Te.layout_symbol["icon-rotate"]),"icon-padding":new Jt(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new Bt(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new Jt(Te.layout_symbol["icon-offset"]),"icon-anchor":new Jt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Bt(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Bt(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Bt(Te.layout_symbol["text-rotation-alignment"]),"text-field":new Jt(Te.layout_symbol["text-field"]),"text-font":new Jt(Te.layout_symbol["text-font"]),"text-size":new Jt(Te.layout_symbol["text-size"]),"text-max-width":new Jt(Te.layout_symbol["text-max-width"]),"text-line-height":new Bt(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new Jt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new Jt(Te.layout_symbol["text-justify"]),"text-radial-offset":new Jt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Bt(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Jt(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Jt(Te.layout_symbol["text-anchor"]),"text-max-angle":new Bt(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new Bt(Te.layout_symbol["text-writing-mode"]),"text-rotate":new Jt(Te.layout_symbol["text-rotate"]),"text-padding":new Bt(Te.layout_symbol["text-padding"]),"text-keep-upright":new Bt(Te.layout_symbol["text-keep-upright"]),"text-transform":new Jt(Te.layout_symbol["text-transform"]),"text-offset":new Jt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new Bt(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new Bt(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new Bt(Te.layout_symbol["text-ignore-placement"]),"text-optional":new Bt(Te.layout_symbol["text-optional"])})}};class mv{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:en,this.defaultValue=t}evaluate(t){if(t.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Dt("FormatSectionOverride",mv,{omit:["defaultValue"]});class Xd extends s{constructor(t){super(t,xm)}recalculate(t,a){if(super.recalculate(t,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const f=[];for(const g of l)f.indexOf(g)<0&&f.push(g);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,a,l,f){const g=this.layout.get(t).evaluate(a,{},l,f),y=this._unevaluatedLayout._values[t];return y.isDataDriven()||Ee(y.value)||!g?g:function(w,C){return C.replace(/{([^{}]+)}/g,(P,A)=>w&&A in w?String(w[A]):"")}(a.properties,g)}createBucket(t){return new dc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of xm.paint.overridableProperties){if(!Xd.hasPaintOverride(this.layout,t))continue;const a=this.paint.get(t),l=new mv(a),f=new xe(l,a.property.specification);let g=null;g=a.value.kind==="constant"||a.value.kind==="source"?new De("source",f):new ve("composite",f,a.value.zoomStops),this.paint._values[t]=new ls(a.property,g,a.parameters)}}_handleOverridablePaintPropertyUpdate(t,a,l){return!(!this.layout||a.isDataDriven()||l.isDataDriven())&&Xd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,a){const l=t.get("text-field"),f=xm.paint.properties[a];let g=!1;const y=w=>{for(const C of w)if(f.overrides&&f.overrides.hasOverride(C))return void(g=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Hn)y(l.value.value.sections);else if(l.value.kind==="source"){const w=P=>{g||(P instanceof Li&&rr(P.value)===wt?y(P.value.sections):P instanceof go?y(P.sections):P.eachChild(w))},C=l.value;C._styleExpression&&w(C._styleExpression.expression)}return g}}let gv;var E2={get paint(){return gv=gv||new m({"background-color":new Bt(Te.paint_background["background-color"]),"background-pattern":new Ju(Te.paint_background["background-pattern"]),"background-opacity":new Bt(Te.paint_background["background-opacity"])})}};class A2 extends s{constructor(t){super(t,E2)}}let yv;var M2={get paint(){return yv=yv||new m({"raster-opacity":new Bt(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new Bt(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Bt(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Bt(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new Bt(Te.paint_raster["raster-saturation"]),"raster-contrast":new Bt(Te.paint_raster["raster-contrast"]),"raster-resampling":new Bt(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new Bt(Te.paint_raster["raster-fade-duration"])})}};class D2 extends s{constructor(t){super(t,M2)}}class z2 extends s{constructor(t){super(t,{}),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class L2{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const wm=63710088e-1;class yl{constructor(t,a){if(isNaN(t)||isNaN(a))throw new Error(`Invalid LngLat object: (${t}, ${a})`);if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new yl(ut(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const a=Math.PI/180,l=this.lat*a,f=t.lat*a,g=Math.sin(l)*Math.sin(f)+Math.cos(l)*Math.cos(f)*Math.cos((t.lng-this.lng)*a);return wm*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof yl)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new yl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new yl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const _v=2*Math.PI*wm;function vv(i){return _v*Math.cos(i*Math.PI/180)}function xv(i){return(180+i)/360}function wv(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function bv(i,t){return i/vv(t)}function bm(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Eh{constructor(t,a,l=0){this.x=+t,this.y=+a,this.z=+l}static fromLngLat(t,a=0){const l=yl.convert(t);return new Eh(xv(l.lng),wv(l.lat),bv(a,l.lat))}toLngLat(){return new yl(360*this.x-180,bm(this.y))}toAltitude(){return this.z*vv(bm(this.y))}meterInMercatorCoordinateUnits(){return 1/_v*(t=bm(this.y),1/Math.cos(t*Math.PI/180));var t}}function Sv(i,t,a){var l=2*Math.PI*6378137/256/Math.pow(2,a);return[i*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class Sm{constructor(t,a,l){if(!function(f,g,y){return!(f<0||f>25||y<0||y>=Math.pow(2,f)||g<0||g>=Math.pow(2,f))}(t,a,l))throw new Error(`x=${a}, y=${l}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=a,this.y=l,this.key=Ah(0,t,t,a,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,a,l){const f=(y=this.y,w=this.z,C=Sv(256*(g=this.x),256*(y=Math.pow(2,w)-y-1),w),P=Sv(256*(g+1),256*(y+1),w),C[0]+","+C[1]+","+P[0]+","+P[1]);var g,y,w,C,P;const A=function(z,O,U){let K,G="";for(let te=z;te>0;te--)K=1<<te-1,G+=(O&K?1:0)+(U&K?2:0);return G}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,a>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,f)}isChildOf(t){const a=this.z-t.z;return a>0&&t.x===this.x>>a&&t.y===this.y>>a}getTilePoint(t){const a=Math.pow(2,this.z);return new Y((t.x*a-this.x)*jn,(t.y*a-this.y)*jn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kv{constructor(t,a){this.wrap=t,this.canonical=a,this.key=Ah(t,a.z,a.z,a.x,a.y)}}class Na{constructor(t,a,l,f,g){if(t<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${l}`);this.overscaledZ=t,this.wrap=a,this.canonical=new Sm(l,+f,+g),this.key=Ah(a,t,l,f,g)}clone(){return new Na(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?new Na(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Na(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(t,a){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?Ah(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):Ah(this.wrap*+a,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a}children(t){if(this.overscaledZ>=t)return[new Na(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,l=2*this.canonical.x,f=2*this.canonical.y;return[new Na(a,this.wrap,a,l,f),new Na(a,this.wrap,a,l+1,f),new Na(a,this.wrap,a,l,f+1),new Na(a,this.wrap,a,l+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Na(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Na(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Eh(t.x-this.wrap,t.y))}}function Ah(i,t,a,l,f){(i*=2)<0&&(i=-1*i-1);const g=1<<a;return(g*g*i+g*f+l).toString(36)+a.toString(36)+t.toString(36)}Dt("CanonicalTileID",Sm),Dt("OverscaledTileID",Na,{omit:["posMatrix"]});class Cv{constructor(t,a,l,f=1,g=1,y=1,w=0){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void Ot(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=a.height;const C=this.dim=a.height-2;switch(this.data=new Uint32Array(a.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=g,this.blueFactor=y,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<C;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(C,P)]=this.data[this._idx(C-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,C)]=this.data[this._idx(P,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<C;P++)for(let A=0;A<C;A++){const z=this.get(P,A);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(t,a){const l=new Uint8Array(this.data.buffer),f=4*this._idx(t,a);return this.unpack(l[f],l[f+1],l[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)}unpack(t,a,l){return t*this.redFactor+a*this.greenFactor+l*this.blueFactor-this.baseShift}getPixels(){return new Ba({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,a,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=a*this.dim,g=a*this.dim+this.dim,y=l*this.dim,w=l*this.dim+this.dim;switch(a){case-1:f=g-1;break;case 1:g=f+1}switch(l){case-1:y=w-1;break;case 1:w=y+1}const C=-a*this.dim,P=-l*this.dim;for(let A=y;A<w;A++)for(let z=f;z<g;z++)this.data[this._idx(z,A)]=t.data[this._idx(z+C,A+P)]}}Dt("DEMData",Cv);class Tv{constructor(t){this._stringToNumber={},this._numberToString=[];for(let a=0;a<t.length;a++){const l=t[a];this._stringToNumber[l]=a,this._numberToString[a]=l}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Iv{constructor(t,a,l,f,g){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=l,t._y=f,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t}}class Pv{constructor(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new nl(jn,16,0),this.grid3D=new nl(jn,16,0),this.featureIndexArray=new Ci,this.promoteId=a}insert(t,a,l,f,g,y){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,f,g);const C=y?this.grid3D:this.grid;for(let P=0;P<a.length;P++){const A=a[P],z=[1/0,1/0,-1/0,-1/0];for(let O=0;O<A.length;O++){const U=A[O];z[0]=Math.min(z[0],U.x),z[1]=Math.min(z[1],U.y),z[2]=Math.max(z[2],U.x),z[3]=Math.max(z[3],U.y)}z[0]<jn&&z[1]<jn&&z[2]>=0&&z[3]>=0&&C.insert(w,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new pl.VectorTile(new hm(this.rawTileData)).layers,this.sourceLayerCoder=new Tv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,a,l,f){this.loadVTLayers();const g=t.params||{},y=jn/t.tileSize/t.scale,w=Ge(g.filter),C=t.queryGeometry,P=t.queryPadding*y,A=Av(C),z=this.grid.query(A.minX-P,A.minY-P,A.maxX+P,A.maxY+P),O=Av(t.cameraQueryGeometry),U=this.grid3D.query(O.minX-P,O.minY-P,O.maxX+P,O.maxY+P,(te,ie,ze,ge)=>function(Pe,je,nt,Pt,Xt){for(const vt of Pe)if(je<=vt.x&&nt<=vt.y&&Pt>=vt.x&&Xt>=vt.y)return!0;const kt=[new Y(je,nt),new Y(je,Xt),new Y(Pt,Xt),new Y(Pt,nt)];if(Pe.length>2){for(const vt of kt)if(ac(Pe,vt))return!0}for(let vt=0;vt<Pe.length-1;vt++)if(pb(Pe[vt],Pe[vt+1],kt))return!0;return!1}(t.cameraQueryGeometry,te-P,ie-P,ze+P,ge+P));for(const te of U)z.push(te);z.sort(R2);const K={};let G;for(let te=0;te<z.length;te++){const ie=z[te];if(ie===G)continue;G=ie;const ze=this.featureIndexArray.get(ie);let ge=null;this.loadMatchingFeature(K,ze.bucketIndex,ze.sourceLayerIndex,ze.featureIndex,w,g.layers,g.availableImages,a,l,f,(Pe,je,nt)=>(ge||(ge=cu(Pe)),je.queryIntersectsFeature(C,Pe,nt,ge,this.z,t.transform,y,t.pixelPosMatrix)))}return K}loadMatchingFeature(t,a,l,f,g,y,w,C,P,A,z){const O=this.bucketLayerIDs[a];if(y&&!function(te,ie){for(let ze=0;ze<te.length;ze++)if(ie.indexOf(te[ze])>=0)return!0;return!1}(y,O))return;const U=this.sourceLayerCoder.decode(l),K=this.vtLayers[U].feature(f);if(g.needGeometry){const te=hu(K,!0);if(!g.filter(new on(this.tileID.overscaledZ),te,this.tileID.canonical))return}else if(!g.filter(new on(this.tileID.overscaledZ),K))return;const G=this.getId(K,U);for(let te=0;te<O.length;te++){const ie=O[te];if(y&&y.indexOf(ie)<0)continue;const ze=C[ie];if(!ze)continue;let ge={};G&&A&&(ge=A.getState(ze.sourceLayer||"_geojsonTileLayer",G));const Pe=Qe({},P[ie]);Pe.paint=Ev(Pe.paint,ze.paint,K,ge,w),Pe.layout=Ev(Pe.layout,ze.layout,K,ge,w);const je=!z||z(K,ze,ge);if(!je)continue;const nt=new Iv(K,this.z,this.x,this.y,G);nt.layer=Pe;let Pt=t[ie];Pt===void 0&&(Pt=t[ie]=[]),Pt.push({featureIndex:f,feature:nt,intersectionZ:je})}}lookupSymbolFeatures(t,a,l,f,g,y,w,C){const P={};this.loadVTLayers();const A=Ge(g);for(const z of t)this.loadMatchingFeature(P,l,f,z,A,y,w,C,a);return P}hasLayer(t){for(const a of this.bucketLayerIDs)for(const l of a)if(t===l)return!0;return!1}getId(t,a){let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]],typeof l=="boolean"&&(l=Number(l))),l}}function Ev(i,t,a,l,f){return me(i,(g,y)=>{const w=t instanceof su?t.get(y):null;return w&&w.evaluate?w.evaluate(a,l,f):w})}function Av(i){let t=1/0,a=1/0,l=-1/0,f=-1/0;for(const g of i)t=Math.min(t,g.x),a=Math.min(a,g.y),l=Math.max(l,g.x),f=Math.max(f,g.y);return{minX:t,minY:a,maxX:l,maxY:f}}function R2(i,t){return t-i}function Mv(i,t,a,l,f){const g=[];for(let y=0;y<i.length;y++){const w=i[y];let C;for(let P=0;P<w.length-1;P++){let A=w[P],z=w[P+1];A.x<t&&z.x<t||(A.x<t?A=new Y(t,A.y+(t-A.x)/(z.x-A.x)*(z.y-A.y))._round():z.x<t&&(z=new Y(t,A.y+(t-A.x)/(z.x-A.x)*(z.y-A.y))._round()),A.y<a&&z.y<a||(A.y<a?A=new Y(A.x+(a-A.y)/(z.y-A.y)*(z.x-A.x),a)._round():z.y<a&&(z=new Y(A.x+(a-A.y)/(z.y-A.y)*(z.x-A.x),a)._round()),A.x>=l&&z.x>=l||(A.x>=l?A=new Y(l,A.y+(l-A.x)/(z.x-A.x)*(z.y-A.y))._round():z.x>=l&&(z=new Y(l,A.y+(l-A.x)/(z.x-A.x)*(z.y-A.y))._round()),A.y>=f&&z.y>=f||(A.y>=f?A=new Y(A.x+(f-A.y)/(z.y-A.y)*(z.x-A.x),f)._round():z.y>=f&&(z=new Y(A.x+(f-A.y)/(z.y-A.y)*(z.x-A.x),f)._round()),C&&A.equals(C[C.length-1])||(C=[A],g.push(C)),C.push(z)))))}}return g}Dt("FeatureIndex",Pv,{omit:["rawTileData","sourceLayerCoder"]});class _l extends Y{constructor(t,a,l,f){super(t,a),this.angle=l,f!==void 0&&(this.segment=f)}clone(){return new _l(this.x,this.y,this.angle,this.segment)}}function Dv(i,t,a,l,f){if(t.segment===void 0||a===0)return!0;let g=t,y=t.segment+1,w=0;for(;w>-a/2;){if(y--,y<0)return!1;w-=i[y].dist(g),g=i[y]}w+=i[y].dist(i[y+1]),y++;const C=[];let P=0;for(;w<a/2;){const A=i[y],z=i[y+1];if(!z)return!1;let O=i[y-1].angleTo(A)-A.angleTo(z);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:w,angleDelta:O}),P+=O;w-C[0].distance>l;)P-=C.shift().angleDelta;if(P>f)return!1;y++,w+=A.dist(z)}return!0}function zv(i){let t=0;for(let a=0;a<i.length-1;a++)t+=i[a].dist(i[a+1]);return t}function Lv(i,t,a){return i?.6*t*a:0}function Rv(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function O2(i,t,a,l,f,g){const y=Lv(a,f,g),w=Rv(a,l)*g;let C=0;const P=zv(i)/2;for(let A=0;A<i.length-1;A++){const z=i[A],O=i[A+1],U=z.dist(O);if(C+U>P){const K=(P-C)/U,G=ni.number(z.x,O.x,K),te=ni.number(z.y,O.y,K),ie=new _l(G,te,O.angleTo(z),A);return ie._round(),!y||Dv(i,ie,w,y,t)?ie:void 0}C+=U}}function F2(i,t,a,l,f,g,y,w,C){const P=Lv(l,g,y),A=Rv(l,f),z=A*y,O=i[0].x===0||i[0].x===C||i[0].y===0||i[0].y===C;return t-z<t/4&&(t=z+t/4),Ov(i,O?t/2*w%t:(A/2+2*g)*y*w%t,t,P,a,z,O,!1,C)}function Ov(i,t,a,l,f,g,y,w,C){const P=g/2,A=zv(i);let z=0,O=t-a,U=[];for(let K=0;K<i.length-1;K++){const G=i[K],te=i[K+1],ie=G.dist(te),ze=te.angleTo(G);for(;O+a<z+ie;){O+=a;const ge=(O-z)/ie,Pe=ni.number(G.x,te.x,ge),je=ni.number(G.y,te.y,ge);if(Pe>=0&&Pe<C&&je>=0&&je<C&&O-P>=0&&O+P<=A){const nt=new _l(Pe,je,ze,K);nt._round(),l&&!Dv(i,nt,g,l,f)||U.push(nt)}}z+=ie}return w||U.length||y||(U=Ov(i,z/2,a,l,f,g,y,!0,C)),U}Dt("Anchor",_l);const fc=na;function Fv(i,t,a,l){const f=[],g=i.image,y=g.pixelRatio,w=g.paddedRect.w-2*fc,C=g.paddedRect.h-2*fc;let P={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const A=g.stretchX||[[0,w]],z=g.stretchY||[[0,C]],O=(Ze,Vt)=>Ze+Vt[1]-Vt[0],U=A.reduce(O,0),K=z.reduce(O,0),G=w-U,te=C-K;let ie=0,ze=U,ge=0,Pe=K,je=0,nt=G,Pt=0,Xt=te;if(g.content&&l){const Ze=g.content,Vt=Ze[2]-Ze[0],jt=Ze[3]-Ze[1];(g.textFitWidth||g.textFitHeight)&&(P=cv(i)),ie=Yd(A,0,Ze[0]),ge=Yd(z,0,Ze[1]),ze=Yd(A,Ze[0],Ze[2]),Pe=Yd(z,Ze[1],Ze[3]),je=Ze[0]-ie,Pt=Ze[1]-ge,nt=Vt-ze,Xt=jt-Pe}const kt=P.x1,vt=P.y1,Ut=P.x2-kt,Lt=P.y2-vt,At=(Ze,Vt,jt,ar)=>{const Qr=Jd(Ze.stretch-ie,ze,Ut,kt),Xr=Qd(Ze.fixed-je,nt,Ze.stretch,U),Wn=Jd(Vt.stretch-ge,Pe,Lt,vt),cs=Qd(Vt.fixed-Pt,Xt,Vt.stretch,K),gi=Jd(jt.stretch-ie,ze,Ut,kt),Xn=Qd(jt.fixed-je,nt,jt.stretch,U),Vi=Jd(ar.stretch-ge,Pe,Lt,vt),$i=Qd(ar.fixed-Pt,Xt,ar.stretch,K),qi=new Y(Qr,Wn),Pn=new Y(gi,Wn),Yn=new Y(gi,Vi),Ii=new Y(Qr,Vi),yi=new Y(Xr/y,cs/y),Ki=new Y(Xn/y,$i/y),_i=t*Math.PI/180;if(_i){const Fr=Math.sin(_i),tn=Math.cos(_i),hn=[tn,-Fr,Fr,tn];qi._matMult(hn),Pn._matMult(hn),Ii._matMult(hn),Yn._matMult(hn)}const ja=Ze.stretch+Ze.fixed,ia=Vt.stretch+Vt.fixed;return{tl:qi,tr:Pn,bl:Ii,br:Yn,tex:{x:g.paddedRect.x+fc+ja,y:g.paddedRect.y+fc+ia,w:jt.stretch+jt.fixed-ja,h:ar.stretch+ar.fixed-ia},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yi,pixelOffsetBR:Ki,minFontScaleX:nt/y/Ut,minFontScaleY:Xt/y/Lt,isSDF:a}};if(l&&(g.stretchX||g.stretchY)){const Ze=Bv(A,G,U),Vt=Bv(z,te,K);for(let jt=0;jt<Ze.length-1;jt++){const ar=Ze[jt],Qr=Ze[jt+1];for(let Xr=0;Xr<Vt.length-1;Xr++)f.push(At(ar,Vt[Xr],Qr,Vt[Xr+1]))}}else f.push(At({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:C+1}));return f}function Yd(i,t,a){let l=0;for(const f of i)l+=Math.max(t,Math.min(a,f[1]))-Math.max(t,Math.min(a,f[0]));return l}function Bv(i,t,a){const l=[{fixed:-fc,stretch:0}];for(const[f,g]of i){const y=l[l.length-1];l.push({fixed:f-y.stretch,stretch:y.stretch}),l.push({fixed:f-y.stretch,stretch:y.stretch+(g-f)})}return l.push({fixed:t+fc,stretch:a}),l}function Jd(i,t,a,l){return i/t*a+l}function Qd(i,t,a,l){return i-t*a/l}class ef{constructor(t,a,l,f,g,y,w,C,P,A){var z;if(this.boxStartIndex=t.length,P){let O=y.top,U=y.bottom;const K=y.collisionPadding;K&&(O-=K[1],U+=K[3]);let G=U-O;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{const O=!((z=y.image)===null||z===void 0)&&z.content&&(y.image.textFitWidth||y.image.textFitHeight)?cv(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};O.y1=O.y1*w-C[0],O.y2=O.y2*w+C[2],O.x1=O.x1*w-C[3],O.x2=O.x2*w+C[1];const U=y.collisionPadding;if(U&&(O.x1-=U[0]*w,O.y1-=U[1]*w,O.x2+=U[2]*w,O.y2+=U[3]*w),A){const K=new Y(O.x1,O.y1),G=new Y(O.x2,O.y1),te=new Y(O.x1,O.y2),ie=new Y(O.x2,O.y2),ze=A*Math.PI/180;K._rotate(ze),G._rotate(ze),te._rotate(ze),ie._rotate(ze),O.x1=Math.min(K.x,G.x,te.x,ie.x),O.x2=Math.max(K.x,G.x,te.x,ie.x),O.y1=Math.min(K.y,G.y,te.y,ie.y),O.y2=Math.max(K.y,G.y,te.y,ie.y)}t.emplaceBack(a.x,a.y,O.x1,O.y1,O.x2,O.y2,l,f,g)}this.boxEndIndex=t.length}}class B2{constructor(t=[],a=(l,f)=>l<f?-1:l>f?1:0){if(this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:a,compare:l}=this,f=a[t];for(;t>0;){const g=t-1>>1,y=a[g];if(l(f,y)>=0)break;a[t]=y,t=g}a[t]=f}_down(t){const{data:a,compare:l}=this,f=this.length>>1,g=a[t];for(;t<f;){let y=1+(t<<1);const w=y+1;if(w<this.length&&l(a[w],a[y])<0&&(y=w),l(a[y],g)>=0)break;a[t]=a[y],t=y}a[t]=g}}function N2(i,t=1,a=!1){let l=1/0,f=1/0,g=-1/0,y=-1/0;const w=i[0];for(let U=0;U<w.length;U++){const K=w[U];(!U||K.x<l)&&(l=K.x),(!U||K.y<f)&&(f=K.y),(!U||K.x>g)&&(g=K.x),(!U||K.y>y)&&(y=K.y)}const C=Math.min(g-l,y-f);let P=C/2;const A=new B2([],j2);if(C===0)return new Y(l,f);for(let U=l;U<g;U+=C)for(let K=f;K<y;K+=C)A.push(new pc(U+P,K+P,P,i));let z=function(U){let K=0,G=0,te=0;const ie=U[0];for(let ze=0,ge=ie.length,Pe=ge-1;ze<ge;Pe=ze++){const je=ie[ze],nt=ie[Pe],Pt=je.x*nt.y-nt.x*je.y;G+=(je.x+nt.x)*Pt,te+=(je.y+nt.y)*Pt,K+=3*Pt}return new pc(G/K,te/K,0,U)}(i),O=A.length;for(;A.length;){const U=A.pop();(U.d>z.d||!z.d)&&(z=U,a&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,O)),U.max-z.d<=t||(P=U.h/2,A.push(new pc(U.p.x-P,U.p.y-P,P,i)),A.push(new pc(U.p.x+P,U.p.y-P,P,i)),A.push(new pc(U.p.x-P,U.p.y+P,P,i)),A.push(new pc(U.p.x+P,U.p.y+P,P,i)),O+=4)}return a&&(console.log(`num probes: ${O}`),console.log(`best distance: ${z.d}`)),z.p}function j2(i,t){return t.max-i.max}function pc(i,t,a,l){this.p=new Y(i,t),this.h=a,this.d=function(f,g){let y=!1,w=1/0;for(let C=0;C<g.length;C++){const P=g[C];for(let A=0,z=P.length,O=z-1;A<z;O=A++){const U=P[A],K=P[O];U.y>f.y!=K.y>f.y&&f.x<(K.x-U.x)*(f.y-U.y)/(K.y-U.y)+U.x&&(y=!y),w=Math.min(w,w_(f,U,K))}}return(y?1:-1)*Math.sqrt(w)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}var mi;x.aq=void 0,(mi=x.aq||(x.aq={}))[mi.center=1]="center",mi[mi.left=2]="left",mi[mi.right=3]="right",mi[mi.top=4]="top",mi[mi.bottom=5]="bottom",mi[mi["top-left"]=6]="top-left",mi[mi["top-right"]=7]="top-right",mi[mi["bottom-left"]=8]="bottom-left",mi[mi["bottom-right"]=9]="bottom-right";const vl=7,km=Number.POSITIVE_INFINITY;function Nv(i,t){return t[1]!==km?function(a,l,f){let g=0,y=0;switch(l=Math.abs(l),f=Math.abs(f),a){case"top-right":case"top-left":case"top":y=f-vl;break;case"bottom-right":case"bottom-left":case"bottom":y=-f+vl}switch(a){case"top-right":case"bottom-right":case"right":g=-l;break;case"top-left":case"bottom-left":case"left":g=l}return[g,y]}(i,t[0],t[1]):function(a,l){let f=0,g=0;l<0&&(l=0);const y=l/Math.SQRT2;switch(a){case"top-right":case"top-left":g=y-vl;break;case"bottom-right":case"bottom-left":g=-y+vl;break;case"bottom":g=-l+vl;break;case"top":g=l-vl}switch(a){case"top-right":case"bottom-right":f=-y;break;case"top-left":case"bottom-left":f=y;break;case"left":f=l;break;case"right":f=-l}return[f,g]}(i,t[0])}function jv(i,t,a){var l;const f=i.layout,g=(l=f.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(t,{},a);if(g){const w=g.values,C=[];for(let P=0;P<w.length;P+=2){const A=C[P]=w[P],z=w[P+1].map(O=>O*qn);A.startsWith("top")?z[1]-=vl:A.startsWith("bottom")&&(z[1]+=vl),C[P+1]=z}return new Bn(C)}const y=f.get("text-variable-anchor");if(y){let w;w=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(t,{},a)*qn,km]:f.get("text-offset").evaluate(t,{},a).map(P=>P*qn);const C=[];for(const P of y)C.push(P,Nv(P,w));return new Bn(C)}return null}function Cm(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function U2(i,t,a,l,f,g,y,w,C,P,A){let z=g.textMaxSize.evaluate(t,{});z===void 0&&(z=y);const O=i.layers[0].layout,U=O.get("icon-offset").evaluate(t,{},A),K=Vv(a.horizontal),G=y/24,te=i.tilePixelRatio*G,ie=i.tilePixelRatio*z/24,ze=i.tilePixelRatio*w,ge=i.tilePixelRatio*O.get("symbol-spacing"),Pe=O.get("text-padding")*i.tilePixelRatio,je=function(Ze,Vt,jt,ar=1){const Qr=Ze.get("icon-padding").evaluate(Vt,{},jt),Xr=Qr&&Qr.values;return[Xr[0]*ar,Xr[1]*ar,Xr[2]*ar,Xr[3]*ar]}(O,t,A,i.tilePixelRatio),nt=O.get("text-max-angle")/180*Math.PI,Pt=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point",Xt=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",kt=O.get("symbol-placement"),vt=ge/2,Ut=O.get("icon-text-fit");let Lt;l&&Ut!=="none"&&(i.allowVerticalPlacement&&a.vertical&&(Lt=hv(l,a.vertical,Ut,O.get("icon-text-fit-padding"),U,G)),K&&(l=hv(l,K,Ut,O.get("icon-text-fit-padding"),U,G)));const At=(Ze,Vt)=>{Vt.x<0||Vt.x>=jn||Vt.y<0||Vt.y>=jn||function(jt,ar,Qr,Xr,Wn,cs,gi,Xn,Vi,$i,qi,Pn,Yn,Ii,yi,Ki,_i,ja,ia,Fr,tn,hn,ba,xn,mc){const to=jt.addToLineVertexArray(ar,Qr);let ro,hs,Ua,oi,Mo=0,zh=0,Gv=0,Hv=0,zm=-1,Lm=-1;const Do={};let Zv=tc("");if(jt.allowVerticalPlacement&&Xr.vertical){const Pi=Xn.layout.get("text-rotate").evaluate(tn,{},xn)+90;Ua=new ef(Vi,ar,$i,qi,Pn,Xr.vertical,Yn,Ii,yi,Pi),gi&&(oi=new ef(Vi,ar,$i,qi,Pn,gi,_i,ja,yi,Pi))}if(Wn){const Pi=Xn.layout.get("icon-rotate").evaluate(tn,{}),Va=Xn.layout.get("icon-text-fit")!=="none",fu=Fv(Wn,Pi,ba,Va),Ps=gi?Fv(gi,Pi,ba,Va):void 0;hs=new ef(Vi,ar,$i,qi,Pn,Wn,_i,ja,!1,Pi),Mo=4*fu.length;const pu=jt.iconSizeData;let no=null;pu.kind==="source"?(no=[eo*Xn.layout.get("icon-size").evaluate(tn,{})],no[0]>gl&&Ot(`${jt.layerIds[0]}: Value for "icon-size" is >= ${Ph}. Reduce your "icon-size".`)):pu.kind==="composite"&&(no=[eo*hn.compositeIconSizes[0].evaluate(tn,{},xn),eo*hn.compositeIconSizes[1].evaluate(tn,{},xn)],(no[0]>gl||no[1]>gl)&&Ot(`${jt.layerIds[0]}: Value for "icon-size" is >= ${Ph}. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,fu,no,Fr,ia,tn,x.ah.none,ar,to.lineStartIndex,to.lineLength,-1,xn),zm=jt.icon.placedSymbolArray.length-1,Ps&&(zh=4*Ps.length,jt.addSymbols(jt.icon,Ps,no,Fr,ia,tn,x.ah.vertical,ar,to.lineStartIndex,to.lineLength,-1,xn),Lm=jt.icon.placedSymbolArray.length-1)}const Wv=Object.keys(Xr.horizontal);for(const Pi of Wv){const Va=Xr.horizontal[Pi];if(!ro){Zv=tc(Va.text);const Ps=Xn.layout.get("text-rotate").evaluate(tn,{},xn);ro=new ef(Vi,ar,$i,qi,Pn,Va,Yn,Ii,yi,Ps)}const fu=Va.positionedLines.length===1;if(Gv+=Uv(jt,ar,Va,cs,Xn,yi,tn,Ki,to,Xr.vertical?x.ah.horizontal:x.ah.horizontalOnly,fu?Wv:[Pi],Do,zm,hn,xn),fu)break}Xr.vertical&&(Hv+=Uv(jt,ar,Xr.vertical,cs,Xn,yi,tn,Ki,to,x.ah.vertical,["vertical"],Do,Lm,hn,xn));const q2=ro?ro.boxStartIndex:jt.collisionBoxArray.length,K2=ro?ro.boxEndIndex:jt.collisionBoxArray.length,G2=Ua?Ua.boxStartIndex:jt.collisionBoxArray.length,H2=Ua?Ua.boxEndIndex:jt.collisionBoxArray.length,Z2=hs?hs.boxStartIndex:jt.collisionBoxArray.length,W2=hs?hs.boxEndIndex:jt.collisionBoxArray.length,X2=oi?oi.boxStartIndex:jt.collisionBoxArray.length,Y2=oi?oi.boxEndIndex:jt.collisionBoxArray.length;let Is=-1;const rf=(Pi,Va)=>Pi&&Pi.circleDiameter?Math.max(Pi.circleDiameter,Va):Va;Is=rf(ro,Is),Is=rf(Ua,Is),Is=rf(hs,Is),Is=rf(oi,Is);const Xv=Is>-1?1:0;Xv&&(Is*=mc/qn),jt.glyphOffsetArray.length>=dc.MAX_GLYPHS&&Ot("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tn.sortKey!==void 0&&jt.addToSortKeyRanges(jt.symbolInstances.length,tn.sortKey);const J2=jv(Xn,tn,xn),[Q2,eS]=function(Pi,Va){const fu=Pi.length,Ps=Va?.values;if(Ps?.length>0)for(let pu=0;pu<Ps.length;pu+=2){const no=Ps[pu+1];Pi.emplaceBack(x.aq[Ps[pu]],no[0],no[1])}return[fu,Pi.length]}(jt.textAnchorOffsets,J2);jt.symbolInstances.emplaceBack(ar.x,ar.y,Do.right>=0?Do.right:-1,Do.center>=0?Do.center:-1,Do.left>=0?Do.left:-1,Do.vertical||-1,zm,Lm,Zv,q2,K2,G2,H2,Z2,W2,X2,Y2,$i,Gv,Hv,Mo,zh,Xv,0,Yn,Is,Q2,eS)}(i,Vt,Ze,a,l,f,Lt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,te,[Pe,Pe,Pe,Pe],Pt,C,ze,je,Xt,U,t,g,P,A,y)};if(kt==="line")for(const Ze of Mv(t.geometry,0,0,jn,jn)){const Vt=F2(Ze,ge,nt,a.vertical||K,l,24,ie,i.overscaling,jn);for(const jt of Vt)K&&V2(i,K.text,vt,jt)||At(Ze,jt)}else if(kt==="line-center"){for(const Ze of t.geometry)if(Ze.length>1){const Vt=O2(Ze,nt,a.vertical||K,l,24,ie);Vt&&At(Ze,Vt)}}else if(t.type==="Polygon")for(const Ze of vo(t.geometry,0)){const Vt=N2(Ze,16);At(Ze[0],new _l(Vt.x,Vt.y,0))}else if(t.type==="LineString")for(const Ze of t.geometry)At(Ze,new _l(Ze[0].x,Ze[0].y,0));else if(t.type==="Point")for(const Ze of t.geometry)for(const Vt of Ze)At([Vt],new _l(Vt.x,Vt.y,0))}function Uv(i,t,a,l,f,g,y,w,C,P,A,z,O,U,K){const G=function(ze,ge,Pe,je,nt,Pt,Xt,kt){const vt=je.layout.get("text-rotate").evaluate(Pt,{})*Math.PI/180,Ut=[];for(const Lt of ge.positionedLines)for(const At of Lt.positionedGlyphs){if(!At.rect)continue;const Ze=At.rect||{};let Vt=nv+1,jt=!0,ar=1,Qr=0;const Xr=(nt||kt)&&At.vertical,Wn=At.metrics.advance*At.scale/2;if(kt&&ge.verticalizable&&(Qr=Lt.lineOffset/2-(At.imageName?-(qn-At.metrics.width*At.scale)/2:(At.scale-1)*qn)),At.imageName){const Fr=Xt[At.imageName];jt=Fr.sdf,ar=Fr.pixelRatio,Vt=na/ar}const cs=nt?[At.x+Wn,At.y]:[0,0];let gi=nt?[0,0]:[At.x+Wn+Pe[0],At.y+Pe[1]-Qr],Xn=[0,0];Xr&&(Xn=gi,gi=[0,0]);const Vi=At.metrics.isDoubleResolution?2:1,$i=(At.metrics.left-Vt)*At.scale-Wn+gi[0],qi=(-At.metrics.top-Vt)*At.scale+gi[1],Pn=$i+Ze.w/Vi*At.scale/ar,Yn=qi+Ze.h/Vi*At.scale/ar,Ii=new Y($i,qi),yi=new Y(Pn,qi),Ki=new Y($i,Yn),_i=new Y(Pn,Yn);if(Xr){const Fr=new Y(-Wn,Wn-Th),tn=-Math.PI/2,hn=qn/2-Wn,ba=new Y(5-Th-hn,-(At.imageName?hn:0)),xn=new Y(...Xn);Ii._rotateAround(tn,Fr)._add(ba)._add(xn),yi._rotateAround(tn,Fr)._add(ba)._add(xn),Ki._rotateAround(tn,Fr)._add(ba)._add(xn),_i._rotateAround(tn,Fr)._add(ba)._add(xn)}if(vt){const Fr=Math.sin(vt),tn=Math.cos(vt),hn=[tn,-Fr,Fr,tn];Ii._matMult(hn),yi._matMult(hn),Ki._matMult(hn),_i._matMult(hn)}const ja=new Y(0,0),ia=new Y(0,0);Ut.push({tl:Ii,tr:yi,bl:Ki,br:_i,tex:Ze,writingMode:ge.writingMode,glyphOffset:cs,sectionIndex:At.sectionIndex,isSDF:jt,pixelOffsetTL:ja,pixelOffsetBR:ia,minFontScaleX:0,minFontScaleY:0})}return Ut}(0,a,w,f,g,y,l,i.allowVerticalPlacement),te=i.textSizeData;let ie=null;te.kind==="source"?(ie=[eo*f.layout.get("text-size").evaluate(y,{})],ie[0]>gl&&Ot(`${i.layerIds[0]}: Value for "text-size" is >= ${Ph}. Reduce your "text-size".`)):te.kind==="composite"&&(ie=[eo*U.compositeTextSizes[0].evaluate(y,{},K),eo*U.compositeTextSizes[1].evaluate(y,{},K)],(ie[0]>gl||ie[1]>gl)&&Ot(`${i.layerIds[0]}: Value for "text-size" is >= ${Ph}. Reduce your "text-size".`)),i.addSymbols(i.text,G,ie,w,g,y,P,t,C.lineStartIndex,C.lineLength,O,K);for(const ze of A)z[ze]=i.text.placedSymbolArray.length-1;return 4*G.length}function Vv(i){for(const t in i)return i[t];return null}function V2(i,t,a,l){const f=i.compareText;if(t in f){const g=f[t];for(let y=g.length-1;y>=0;y--)if(l.dist(g[y])<a)return!0}else f[t]=[];return f[t].push(l),!1}const $v=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Tm{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,l]=new Uint8Array(t,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=l>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const g=$v[15&l];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new Tm(w,y,g,t)}constructor(t,a=64,l=Float64Array,f){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=$v.indexOf(this.ArrayType),y=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-w%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${l}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+C,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+y+w+C),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+C,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=t)}add(t,a){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=a,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Im(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,a,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:w}=this,C=[0,g.length-1,0],P=[];for(;C.length;){const A=C.pop()||0,z=C.pop()||0,O=C.pop()||0;if(z-O<=w){for(let te=O;te<=z;te++){const ie=y[2*te],ze=y[2*te+1];ie>=t&&ie<=l&&ze>=a&&ze<=f&&P.push(g[te])}continue}const U=O+z>>1,K=y[2*U],G=y[2*U+1];K>=t&&K<=l&&G>=a&&G<=f&&P.push(g[U]),(A===0?t<=K:a<=G)&&(C.push(O),C.push(U-1),C.push(1-A)),(A===0?l>=K:f>=G)&&(C.push(U+1),C.push(z),C.push(1-A))}return P}within(t,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:g,nodeSize:y}=this,w=[0,f.length-1,0],C=[],P=l*l;for(;w.length;){const A=w.pop()||0,z=w.pop()||0,O=w.pop()||0;if(z-O<=y){for(let te=O;te<=z;te++)Kv(g[2*te],g[2*te+1],t,a)<=P&&C.push(f[te]);continue}const U=O+z>>1,K=g[2*U],G=g[2*U+1];Kv(K,G,t,a)<=P&&C.push(f[U]),(A===0?t-l<=K:a-l<=G)&&(w.push(O),w.push(U-1),w.push(1-A)),(A===0?t+l>=K:a+l>=G)&&(w.push(U+1),w.push(z),w.push(1-A))}return C}}function Im(i,t,a,l,f,g){if(f-l<=a)return;const y=l+f>>1;qv(i,t,y,l,f,g),Im(i,t,a,l,y-1,1-g),Im(i,t,a,y+1,f,1-g)}function qv(i,t,a,l,f,g){for(;f>l;){if(f-l>600){const P=f-l+1,A=a-l+1,z=Math.log(P),O=.5*Math.exp(2*z/3),U=.5*Math.sqrt(z*O*(P-O)/P)*(A-P/2<0?-1:1);qv(i,t,a,Math.max(l,Math.floor(a-A*O/P+U)),Math.min(f,Math.floor(a+(P-A)*O/P+U)),g)}const y=t[2*a+g];let w=l,C=f;for(Mh(i,t,l,a),t[2*f+g]>y&&Mh(i,t,l,f);w<C;){for(Mh(i,t,w,C),w++,C--;t[2*w+g]<y;)w++;for(;t[2*C+g]>y;)C--}t[2*l+g]===y?Mh(i,t,l,C):(C++,Mh(i,t,C,f)),C<=a&&(l=C+1),a<=C&&(f=C-1)}}function Mh(i,t,a,l){Pm(i,a,l),Pm(t,2*a,2*l),Pm(t,2*a+1,2*l+1)}function Pm(i,t,a){const l=i[t];i[t]=i[a],i[a]=l}function Kv(i,t,a,l){const f=i-a,g=t-l;return f*f+g*g}var Em;x.bg=void 0,(Em=x.bg||(x.bg={})).create="create",Em.load="load",Em.fullLoad="fullLoad";let tf=null,Dh=[];const Am=1e3/60,Mm="loadTime",Dm="fullLoadTime",$2={mark(i){performance.mark(i)},frame(i){const t=i;tf!=null&&Dh.push(t-tf),tf=t},clearMetrics(){tf=null,Dh=[],performance.clearMeasures(Mm),performance.clearMeasures(Dm);for(const i in x.bg)performance.clearMarks(x.bg[i])},getPerformanceMetrics(){performance.measure(Mm,x.bg.create,x.bg.load),performance.measure(Dm,x.bg.create,x.bg.fullLoad);const i=performance.getEntriesByName(Mm)[0].duration,t=performance.getEntriesByName(Dm)[0].duration,a=Dh.length,l=1/(Dh.reduce((g,y)=>g+y,0)/a/1e3),f=Dh.filter(g=>g>Am).reduce((g,y)=>g+(y-Am)/Am,0);return{loadTime:i,fullLoadTime:t,fps:l,percentDroppedFrames:f/(a+f)*100,totalFrames:a}}};x.$=class extends L{},x.A=sc,x.B=jp,x.C=function(i){if(Hr==null){const t=i.navigator?i.navigator.userAgent:null;Hr=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Hr},x.D=Bt,x.E=gr,x.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new L2(()=>this.process()),this.subscription=function(a,l,f,g){return a.addEventListener(l,f,!1),{unsubscribe:()=>{a.removeEventListener(l,f,!1)}}}(this.target,"message",a=>this.receive(a)),this.globalScope=Kr(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((a,l)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[f]={resolve:a,reject:l},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[f];const w={id:f,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)},{once:!0});const g=[],y=Object.assign(Object.assign({},i),{id:f,sourceMapId:this.mapId,origin:location.origin,data:il(i.data,g)});this.target.postMessage(y,{transfer:g})})}receive(i){const t=i.data,a=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[a];const l=this.abortControllers[a];return delete this.abortControllers[a],void(l&&l.abort())}if(Kr(self)||t.mustQueue)return this.tasks[a]=t,this.taskQueue.push(a),void this.invoker.trigger();this.processTask(a,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return h(this,void 0,void 0,function*(){if(t.type==="<response>"){const f=this.resolveRejects[i];return delete this.resolveRejects[i],f?void(t.error?f.reject(al(t.error)):f.resolve(al(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const a=al(t.data),l=new AbortController;this.abortControllers[i]=l;try{const f=yield this.messageHandlers[t.type](t.sourceMapId,a,l);this.completeTask(i,null,f)}catch(f){this.completeTask(i,f)}})}completeTask(i,t,a){const l=[];delete this.abortControllers[i];const f={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?il(t):null,data:il(a,l)};this.target.postMessage(f,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},x.G=kr,x.H=function(){var i=new sc(16);return sc!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},x.I=fm,x.J=function(i,t,a){var l,f,g,y,w,C,P,A,z,O,U,K,G=a[0],te=a[1],ie=a[2];return t===i?(i[12]=t[0]*G+t[4]*te+t[8]*ie+t[12],i[13]=t[1]*G+t[5]*te+t[9]*ie+t[13],i[14]=t[2]*G+t[6]*te+t[10]*ie+t[14],i[15]=t[3]*G+t[7]*te+t[11]*ie+t[15]):(f=t[1],g=t[2],y=t[3],w=t[4],C=t[5],P=t[6],A=t[7],z=t[8],O=t[9],U=t[10],K=t[11],i[0]=l=t[0],i[1]=f,i[2]=g,i[3]=y,i[4]=w,i[5]=C,i[6]=P,i[7]=A,i[8]=z,i[9]=O,i[10]=U,i[11]=K,i[12]=l*G+w*te+z*ie+t[12],i[13]=f*G+C*te+O*ie+t[13],i[14]=g*G+P*te+U*ie+t[14],i[15]=y*G+A*te+K*ie+t[15]),i},x.K=function(i,t,a){var l=a[0],f=a[1],g=a[2];return i[0]=t[0]*l,i[1]=t[1]*l,i[2]=t[2]*l,i[3]=t[3]*l,i[4]=t[4]*f,i[5]=t[5]*f,i[6]=t[6]*f,i[7]=t[7]*f,i[8]=t[8]*g,i[9]=t[9]*g,i[10]=t[10]*g,i[11]=t[11]*g,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},x.L=C_,x.M=function(i,t){const a={};for(let l=0;l<t.length;l++){const f=t[l];f in i&&(a[f]=i[f])}return a},x.N=yl,x.O=xv,x.P=Y,x.Q=wv,x.R=Ba,x.S=Na,x.T=Xu,x.U=be,x.V=pe,x.W=We,x.X=jn,x.Y=S,x.Z=Eh,x._=h,x.a=Sr,x.a$=function(i,t){var a=i[0],l=i[1],f=i[2],g=i[3],y=i[4],w=i[5],C=i[6],P=i[7],A=i[8],z=i[9],O=i[10],U=i[11],K=i[12],G=i[13],te=i[14],ie=i[15],ze=t[0],ge=t[1],Pe=t[2],je=t[3],nt=t[4],Pt=t[5],Xt=t[6],kt=t[7],vt=t[8],Ut=t[9],Lt=t[10],At=t[11],Ze=t[12],Vt=t[13],jt=t[14],ar=t[15];return Math.abs(a-ze)<=Ui*Math.max(1,Math.abs(a),Math.abs(ze))&&Math.abs(l-ge)<=Ui*Math.max(1,Math.abs(l),Math.abs(ge))&&Math.abs(f-Pe)<=Ui*Math.max(1,Math.abs(f),Math.abs(Pe))&&Math.abs(g-je)<=Ui*Math.max(1,Math.abs(g),Math.abs(je))&&Math.abs(y-nt)<=Ui*Math.max(1,Math.abs(y),Math.abs(nt))&&Math.abs(w-Pt)<=Ui*Math.max(1,Math.abs(w),Math.abs(Pt))&&Math.abs(C-Xt)<=Ui*Math.max(1,Math.abs(C),Math.abs(Xt))&&Math.abs(P-kt)<=Ui*Math.max(1,Math.abs(P),Math.abs(kt))&&Math.abs(A-vt)<=Ui*Math.max(1,Math.abs(A),Math.abs(vt))&&Math.abs(z-Ut)<=Ui*Math.max(1,Math.abs(z),Math.abs(Ut))&&Math.abs(O-Lt)<=Ui*Math.max(1,Math.abs(O),Math.abs(Lt))&&Math.abs(U-At)<=Ui*Math.max(1,Math.abs(U),Math.abs(At))&&Math.abs(K-Ze)<=Ui*Math.max(1,Math.abs(K),Math.abs(Ze))&&Math.abs(G-Vt)<=Ui*Math.max(1,Math.abs(G),Math.abs(Vt))&&Math.abs(te-jt)<=Ui*Math.max(1,Math.abs(te),Math.abs(jt))&&Math.abs(ie-ar)<=Ui*Math.max(1,Math.abs(ie),Math.abs(ar))},x.a0=Pr,x.a1=Sm,x.a2=rt,x.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(a=>{t.onloadstart=()=>{a(t)};for(const l of i){const f=window.document.createElement("source");Br(l)||(t.crossOrigin="Anonymous"),f.src=l,t.appendChild(f)}})},x.a4=function(){return ce++},x.a5=Ct,x.a6=dc,x.a7=Ge,x.a8=hu,x.a9=Iv,x.aA=function(i){if(i.type==="custom")return new z2(i);switch(i.type){case"background":return new A2(i);case"circle":return new yb(i);case"fill":return new Lb(i);case"fill-extrusion":return new Wb(i);case"heatmap":return new vb(i);case"hillshade":return new wb(i);case"line":return new n2(i);case"raster":return new D2(i);case"symbol":return new Xd(i)}},x.aB=Ye,x.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let a=[];try{if(!Wt(i.version,t.version))return[{command:"setStyle",args:[t]}];Wt(i.center,t.center)||a.push({command:"setCenter",args:[t.center]}),Wt(i.zoom,t.zoom)||a.push({command:"setZoom",args:[t.zoom]}),Wt(i.bearing,t.bearing)||a.push({command:"setBearing",args:[t.bearing]}),Wt(i.pitch,t.pitch)||a.push({command:"setPitch",args:[t.pitch]}),Wt(i.sprite,t.sprite)||a.push({command:"setSprite",args:[t.sprite]}),Wt(i.glyphs,t.glyphs)||a.push({command:"setGlyphs",args:[t.glyphs]}),Wt(i.transition,t.transition)||a.push({command:"setTransition",args:[t.transition]}),Wt(i.light,t.light)||a.push({command:"setLight",args:[t.light]}),Wt(i.terrain,t.terrain)||a.push({command:"setTerrain",args:[t.terrain]}),Wt(i.sky,t.sky)||a.push({command:"setSky",args:[t.sky]}),Wt(i.projection,t.projection)||a.push({command:"setProjection",args:[t.projection]});const l={},f=[];(function(y,w,C,P){let A;for(A in w=w||{},y=y||{})Object.prototype.hasOwnProperty.call(y,A)&&(Object.prototype.hasOwnProperty.call(w,A)||Sn(A,C,P));for(A in w)Object.prototype.hasOwnProperty.call(w,A)&&(Object.prototype.hasOwnProperty.call(y,A)?Wt(y[A],w[A])||(y[A].type==="geojson"&&w[A].type==="geojson"&&an(y,w,A)?dr(C,{command:"setGeoJSONSourceData",args:[A,w[A].data]}):An(A,w,C,P)):_n(A,w,C))})(i.sources,t.sources,f,l);const g=[];i.layers&&i.layers.forEach(y=>{"source"in y&&l[y.source]?a.push({command:"removeLayer",args:[y.id]}):g.push(y)}),a=a.concat(f),function(y,w,C){w=w||[];const P=(y=y||[]).map(Vr),A=w.map(Vr),z=y.reduce(Yr,{}),O=w.reduce(Yr,{}),U=P.slice(),K=Object.create(null);let G,te,ie,ze,ge;for(let Pe=0,je=0;Pe<P.length;Pe++)G=P[Pe],Object.prototype.hasOwnProperty.call(O,G)?je++:(dr(C,{command:"removeLayer",args:[G]}),U.splice(U.indexOf(G,je),1));for(let Pe=0,je=0;Pe<A.length;Pe++)G=A[A.length-1-Pe],U[U.length-1-Pe]!==G&&(Object.prototype.hasOwnProperty.call(z,G)?(dr(C,{command:"removeLayer",args:[G]}),U.splice(U.lastIndexOf(G,U.length-je),1)):je++,ze=U[U.length-Pe],dr(C,{command:"addLayer",args:[O[G],ze]}),U.splice(U.length-Pe,0,G),K[G]=!0);for(let Pe=0;Pe<A.length;Pe++)if(G=A[Pe],te=z[G],ie=O[G],!K[G]&&!Wt(te,ie))if(Wt(te.source,ie.source)&&Wt(te["source-layer"],ie["source-layer"])&&Wt(te.type,ie.type)){for(ge in Zr(te.layout,ie.layout,C,G,null,"setLayoutProperty"),Zr(te.paint,ie.paint,C,G,null,"setPaintProperty"),Wt(te.filter,ie.filter)||dr(C,{command:"setFilter",args:[G,ie.filter]}),Wt(te.minzoom,ie.minzoom)&&Wt(te.maxzoom,ie.maxzoom)||dr(C,{command:"setLayerZoomRange",args:[G,ie.minzoom,ie.maxzoom]}),te)Object.prototype.hasOwnProperty.call(te,ge)&&ge!=="layout"&&ge!=="paint"&&ge!=="filter"&&ge!=="metadata"&&ge!=="minzoom"&&ge!=="maxzoom"&&(ge.indexOf("paint.")===0?Zr(te[ge],ie[ge],C,G,ge.slice(6),"setPaintProperty"):Wt(te[ge],ie[ge])||dr(C,{command:"setLayerProperty",args:[G,ge,ie[ge]]}));for(ge in ie)Object.prototype.hasOwnProperty.call(ie,ge)&&!Object.prototype.hasOwnProperty.call(te,ge)&&ge!=="layout"&&ge!=="paint"&&ge!=="filter"&&ge!=="metadata"&&ge!=="minzoom"&&ge!=="maxzoom"&&(ge.indexOf("paint.")===0?Zr(te[ge],ie[ge],C,G,ge.slice(6),"setPaintProperty"):Wt(te[ge],ie[ge])||dr(C,{command:"setLayerProperty",args:[G,ge,ie[ge]]}))}else dr(C,{command:"removeLayer",args:[G]}),ze=U[U.lastIndexOf(G)+1],dr(C,{command:"addLayer",args:[ie,ze]})}(g,t.layers,a)}catch(l){console.warn("Unable to compute style diff:",l),a=[{command:"setStyle",args:[t]}]}return a},x.aD=function(i){const t=[],a=i.id;return a===void 0&&t.push({message:`layers.${a}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${a}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),t},x.aE=function i(t,a){if(Array.isArray(t)){if(!Array.isArray(a)||t.length!==a.length)return!1;for(let l=0;l<t.length;l++)if(!i(t[l],a[l]))return!1;return!0}if(typeof t=="object"&&t!==null&&a!==null){if(typeof a!="object"||Object.keys(t).length!==Object.keys(a).length)return!1;for(const l in t)if(!i(t[l],a[l]))return!1;return!0}return t===a},x.aF=me,x.aG=Le,x.aH=class extends lu{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},x.aI=Fd,x.aJ=class extends lu{constructor(i,t){super(i,t),this.current=ub}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},x.aK=p_,x.aL=m_,x.aM=br,x.aN=class extends lu{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},x.aO=class extends lu{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},x.aP=function(i,t,a,l,f,g,y){var w=1/(t-a),C=1/(l-f),P=1/(g-y);return i[0]=-2*w,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*C,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*P,i[11]=0,i[12]=(t+a)*w,i[13]=(f+l)*C,i[14]=(y+g)*P,i[15]=1,i},x.aQ=gb,x.aR=class extends we{},x.aS=o2,x.aT=class extends Re{},x.aU=tm,x.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},x.aW=A_,x.aX=fi,x.aY=Fa,x.aZ=class extends Nt{},x.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},x.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,l,f,g)=>{const y=f||g;return t[l]=!y||y.toLowerCase(),""}),t["max-age"]){const a=parseInt(t["max-age"],10);isNaN(a)?delete t["max-age"]:t["max-age"]=a}return t},x.ab=function(i,t){const a=[];for(const l in i)l in t||a.push(l);return a},x.ac=et,x.ad=function(i,t,a){var l=Math.sin(a),f=Math.cos(a),g=t[0],y=t[1],w=t[2],C=t[3],P=t[4],A=t[5],z=t[6],O=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=g*f+P*l,i[1]=y*f+A*l,i[2]=w*f+z*l,i[3]=C*f+O*l,i[4]=P*f-g*l,i[5]=A*f-y*l,i[6]=z*f-w*l,i[7]=O*f-C*l,i},x.ae=function(i){var t=new sc(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},x.af=Ud,x.ag=function(i,t){let a=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:f,minZoom:g,maxZoom:y}=i,w=f?et(ii.interpolationFactor(f,t,g,y),0,1):0;i.kind==="camera"?l=ni.number(i.minSize,i.maxSize,w):a=w}return{uSizeT:a,uSize:l}},x.ai=function(i,{uSize:t,uSizeT:a},{lowerSize:l,upperSize:f}){return i.kind==="source"?l/eo:i.kind==="composite"?ni.number(l/eo,f/eo,a):t},x.aj=ym,x.ak=function(i,t,a,l){const f=t.y-i.y,g=t.x-i.x,y=l.y-a.y,w=l.x-a.x,C=y*g-w*f;if(C===0)return null;const P=(w*(i.y-a.y)-y*(i.x-a.x))/C;return new Y(i.x+P*g,i.y+P*f)},x.al=Mv,x.am=v_,x.an=Jp,x.ao=function(i){let t=1/0,a=1/0,l=-1/0,f=-1/0;for(const g of i)t=Math.min(t,g.x),a=Math.min(a,g.y),l=Math.max(l,g.x),f=Math.max(f,g.y);return[t,a,l,f]},x.ap=qn,x.ar=gm,x.as=function(i,t){var a=t[0],l=t[1],f=t[2],g=t[3],y=t[4],w=t[5],C=t[6],P=t[7],A=t[8],z=t[9],O=t[10],U=t[11],K=t[12],G=t[13],te=t[14],ie=t[15],ze=a*w-l*y,ge=a*C-f*y,Pe=a*P-g*y,je=l*C-f*w,nt=l*P-g*w,Pt=f*P-g*C,Xt=A*G-z*K,kt=A*te-O*K,vt=A*ie-U*K,Ut=z*te-O*G,Lt=z*ie-U*G,At=O*ie-U*te,Ze=ze*At-ge*Lt+Pe*Ut+je*vt-nt*kt+Pt*Xt;return Ze?(i[0]=(w*At-C*Lt+P*Ut)*(Ze=1/Ze),i[1]=(f*Lt-l*At-g*Ut)*Ze,i[2]=(G*Pt-te*nt+ie*je)*Ze,i[3]=(O*nt-z*Pt-U*je)*Ze,i[4]=(C*vt-y*At-P*kt)*Ze,i[5]=(a*At-f*vt+g*kt)*Ze,i[6]=(te*Pe-K*Pt-ie*ge)*Ze,i[7]=(A*Pt-O*Pe+U*ge)*Ze,i[8]=(y*Lt-w*vt+P*Xt)*Ze,i[9]=(l*vt-a*Lt-g*Xt)*Ze,i[10]=(K*nt-G*Pe+ie*ze)*Ze,i[11]=(z*Pe-A*nt-U*ze)*Ze,i[12]=(w*kt-y*Ut-C*Xt)*Ze,i[13]=(a*Ut-l*kt+f*Xt)*Ze,i[14]=(G*ge-K*je-te*ze)*Ze,i[15]=(A*je-z*ge+O*ze)*Ze,i):null},x.at=Cm,x.au=mm,x.av=Tm,x.aw=function(){const i={},t=Te.$version;for(const a in Te.$root){const l=Te.$root[a];if(l.required){let f=null;f=a==="version"?t:l.type==="array"?[]:{},f!=null&&(i[a]=f)}}return i},x.ax=uh,x.ay=ur,x.az=function(i){i=i.slice();const t=Object.create(null);for(let a=0;a<i.length;a++)t[i[a].id]=i[a];for(let a=0;a<i.length;a++)"ref"in i[a]&&(i[a]=Tr(i[a],t[i[a].ref]));return i},x.b=nr,x.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},x.b1=function(i,t,a){return i[0]=t[0]*a[0],i[1]=t[1]*a[1],i[2]=t[2]*a[2],i[3]=t[3]*a[3],i},x.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},x.b3=ut,x.b4=kv,x.b5=bv,x.b6=function(i,t,a,l,f){var g,y=1/Math.tan(t/2);return i[0]=y/a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,f!=null&&f!==1/0?(i[10]=(f+l)*(g=1/(l-f)),i[14]=2*f*l*g):(i[10]=-1,i[14]=-2*l),i},x.b7=function(i,t,a){var l=Math.sin(a),f=Math.cos(a),g=t[4],y=t[5],w=t[6],C=t[7],P=t[8],A=t[9],z=t[10],O=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=g*f+P*l,i[5]=y*f+A*l,i[6]=w*f+z*l,i[7]=C*f+O*l,i[8]=P*f-g*l,i[9]=A*f-y*l,i[10]=z*f-w*l,i[11]=O*f-C*l,i},x.b8=ke,x.b9=Ve,x.bA=X_,x.bB=function(i){return i.message===Rt},x.bC=he,x.bD=ta,x.ba=function(i){return i*Math.PI/180},x.bb=function(i,t){const{x:a,y:l}=Eh.fromLngLat(t);return!(i<0||i>25||l<0||l>=1||a<0||a>=1)},x.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},x.bd=class extends M{},x.be=wm,x.bf=$2,x.bh=zr,x.bi=function(i,t){Sr.REGISTERED_PROTOCOLS[i]=t},x.bj=function(i){delete Sr.REGISTERED_PROTOCOLS[i]},x.bk=function(i,t){const a={};for(let f=0;f<i.length;f++){const g=t&&t[i[f].id]||pr(i[f]);t&&(t[i[f].id]=g);let y=a[g];y||(y=a[g]=[]),y.push(i[f])}const l=[];for(const f in a)l.push(a[f]);return l},x.bl=Dt,x.bm=Tv,x.bn=Pv,x.bo=av,x.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=jn/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],a=t.layout,l=t._unevaluatedLayout._values,f={layoutIconSize:l["icon-size"].possiblyEvaluate(new on(i.bucket.zoom+1),i.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new on(i.bucket.zoom+1),i.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new on(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:A}=i.bucket.textSizeData;f.compositeTextSizes=[l["text-size"].possiblyEvaluate(new on(P),i.canonical),l["text-size"].possiblyEvaluate(new on(A),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:A}=i.bucket.iconSizeData;f.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new on(P),i.canonical),l["icon-size"].possiblyEvaluate(new on(A),i.canonical)]}const g=a.get("text-line-height")*qn,y=a.get("text-rotation-alignment")!=="viewport"&&a.get("symbol-placement")!=="point",w=a.get("text-keep-upright"),C=a.get("text-size");for(const P of i.bucket.features){const A=a.get("text-font").evaluate(P,{},i.canonical).join(","),z=C.evaluate(P,{},i.canonical),O=f.layoutTextSize.evaluate(P,{},i.canonical),U=f.layoutIconSize.evaluate(P,{},i.canonical),K={horizontal:{},vertical:void 0},G=P.text;let te,ie=[0,0];if(G){const Pe=G.toString(),je=a.get("text-letter-spacing").evaluate(P,{},i.canonical)*qn,nt=Up(Pe)?je:0,Pt=a.get("text-anchor").evaluate(P,{},i.canonical),Xt=jv(t,P,i.canonical);if(!Xt){const Lt=a.get("text-radial-offset").evaluate(P,{},i.canonical);ie=Lt?Nv(Pt,[Lt*qn,km]):a.get("text-offset").evaluate(P,{},i.canonical).map(At=>At*qn)}let kt=y?"center":a.get("text-justify").evaluate(P,{},i.canonical);const vt=a.get("symbol-placement")==="point"?a.get("text-max-width").evaluate(P,{},i.canonical)*qn:1/0,Ut=()=>{i.bucket.allowVerticalPlacement&&ch(Pe)&&(K.vertical=Hd(G,i.glyphMap,i.glyphPositions,i.imagePositions,A,vt,g,Pt,"left",nt,ie,x.ah.vertical,!0,O,z))};if(!y&&Xt){const Lt=new Set;if(kt==="auto")for(let Ze=0;Ze<Xt.values.length;Ze+=2)Lt.add(Cm(Xt.values[Ze]));else Lt.add(kt);let At=!1;for(const Ze of Lt)if(!K.horizontal[Ze])if(At)K.horizontal[Ze]=K.horizontal[0];else{const Vt=Hd(G,i.glyphMap,i.glyphPositions,i.imagePositions,A,vt,g,"center",Ze,nt,ie,x.ah.horizontal,!1,O,z);Vt&&(K.horizontal[Ze]=Vt,At=Vt.positionedLines.length===1)}Ut()}else{kt==="auto"&&(kt=Cm(Pt));const Lt=Hd(G,i.glyphMap,i.glyphPositions,i.imagePositions,A,vt,g,Pt,kt,nt,ie,x.ah.horizontal,!1,O,z);Lt&&(K.horizontal[kt]=Lt),Ut(),ch(Pe)&&y&&w&&(K.vertical=Hd(G,i.glyphMap,i.glyphPositions,i.imagePositions,A,vt,g,Pt,kt,nt,ie,x.ah.vertical,!1,O,z))}}let ze=!1;if(P.icon&&P.icon.name){const Pe=i.imageMap[P.icon.name];Pe&&(te=C2(i.imagePositions[P.icon.name],a.get("icon-offset").evaluate(P,{},i.canonical),a.get("icon-anchor").evaluate(P,{},i.canonical)),ze=!!Pe.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ze:i.bucket.sdfIcons!==ze&&Ot("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Pe.pixelRatio!==i.bucket.pixelRatio||a.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ge=Vv(K.horizontal)||K.vertical;i.bucket.iconsInText=!!ge&&ge.iconsInText,(ge||te)&&U2(i.bucket,P,K,te,i.imageMap,f,O,U,ie,ze,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},x.bq=um,x.br=sm,x.bs=lm,x.bt=pl,x.bu=hm,x.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},x.bw=function(i,t,a,l,f){return h(this,void 0,void 0,function*(){if(pe())try{return yield We(i,t,a,l,f)}catch{}return function(g,y,w,C,P){const A=g.width,z=g.height;gt&&yt||(gt=new OffscreenCanvas(A,z),yt=gt.getContext("2d",{willReadFrequently:!0})),gt.width=A,gt.height=z,yt.drawImage(g,0,0,A,z);const O=yt.getImageData(y,w,C,P);return yt.clearRect(0,0,A,z),O.data}(i,t,a,l,f)})},x.bx=Cv,x.by=j,x.bz=q,x.c=It,x.d=i=>h(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(a){throw new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),x.e=Qe,x.f=i=>new Promise((t,a)=>{const l=new Image;l.onload=()=>{t(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame(()=>{l.src=Ke})},l.onerror=()=>a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(i)],{type:"image/png"});l.src=i.byteLength?URL.createObjectURL(f):Ke}),x.g=wr,x.h=(i,t)=>ct(Qe(i,{type:"json"}),t),x.i=Kr,x.j=Lr,x.k=Nr,x.l=(i,t)=>ct(Qe(i,{type:"arrayBuffer"}),t),x.m=ct,x.n=function(i){return new hm(i).readFields(_2,[])},x.o=vh,x.p=iv,x.q=m,x.r=Np,x.s=Br,x.t=oh,x.u=Io,x.v=Te,x.w=Ot,x.x=function([i,t,a]){return t+=90,t*=Math.PI/180,a*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(a),y:i*Math.sin(t)*Math.sin(a),z:i*Math.cos(a)}},x.y=ni,x.z=on}),_("worker",["./shared"],function(x){class h{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,B){for(const ee of N){this._layerConfigs[ee.id]=ee;const fe=this._layers[ee.id]=x.aA(ee);fe._featureFilter=x.a7(fe.filter),this.keyCache[ee.id]&&delete this.keyCache[ee.id]}for(const ee of B)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};const H=x.bk(Object.values(this._layerConfigs),this.keyCache);for(const ee of H){const fe=ee.map(Be=>this._layers[Be.id]),_e=fe[0];if(_e.visibility==="none")continue;const Ae=_e.source||"";let ue=this.familiesBySource[Ae];ue||(ue=this.familiesBySource[Ae]={});const Oe=_e.sourceLayer||"_geojsonTileLayer";let qe=ue[Oe];qe||(qe=ue[Oe]=[]),qe.push(fe)}}}class j{constructor(N){const B={},H=[];for(const Ae in N){const ue=N[Ae],Oe=B[Ae]={};for(const qe in ue){const Be=ue[+qe];if(!Be||Be.bitmap.width===0||Be.bitmap.height===0)continue;const ot={x:0,y:0,w:Be.bitmap.width+2,h:Be.bitmap.height+2};H.push(ot),Oe[qe]={rect:ot,metrics:Be.metrics}}}const{w:ee,h:fe}=x.p(H),_e=new x.o({width:ee||1,height:fe||1});for(const Ae in N){const ue=N[Ae];for(const Oe in ue){const qe=ue[+Oe];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const Be=B[Ae][Oe].rect;x.o.copy(qe.bitmap,_e,{x:0,y:0},{x:Be.x+1,y:Be.y+1},qe.bitmap)}}this.image=_e,this.positions=B}}x.bl("GlyphAtlas",j);class q{constructor(N){this.tileID=new x.S(N.tileID.overscaledZ,N.tileID.wrap,N.tileID.canonical.z,N.tileID.canonical.x,N.tileID.canonical.y),this.uid=N.uid,this.zoom=N.zoom,this.pixelRatio=N.pixelRatio,this.tileSize=N.tileSize,this.source=N.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=N.showCollisionBoxes,this.collectResourceTiming=!!N.collectResourceTiming,this.returnDependencies=!!N.returnDependencies,this.promoteId=N.promoteId,this.inFlightDependencies=[]}parse(N,B,H,ee){return x._(this,void 0,void 0,function*(){this.status="parsing",this.data=N,this.collisionBoxArray=new x.a5;const fe=new x.bm(Object.keys(N.layers).sort()),_e=new x.bn(this.tileID,this.promoteId);_e.bucketLayerIDs=[];const Ae={},ue={featureIndex:_e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H},Oe=B.familiesBySource[this.source];for(const sr in Oe){const jr=N.layers[sr];if(!jr)continue;jr.version===1&&x.w(`Vector tile source "${this.source}" layer "${sr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ur=fe.encode(sr),Mn=[];for(let Dn=0;Dn<jr.length;Dn++){const Ar=jr.feature(Dn),zi=_e.getId(Ar,sr);Mn.push({feature:Ar,id:zi,index:Dn,sourceLayerIndex:Ur})}for(const Dn of Oe[sr]){const Ar=Dn[0];Ar.source!==this.source&&x.w(`layer.source = ${Ar.source} does not equal this.source = ${this.source}`),Ar.minzoom&&this.zoom<Math.floor(Ar.minzoom)||Ar.maxzoom&&this.zoom>=Ar.maxzoom||Ar.visibility!=="none"&&(le(Dn,this.zoom,H),(Ae[Ar.id]=Ar.createBucket({index:_e.bucketLayerIDs.length,layers:Dn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ur,sourceID:this.source})).populate(Mn,ue,this.tileID.canonical),_e.bucketLayerIDs.push(Dn.map(zi=>zi.id)))}}const qe=x.aF(ue.glyphDependencies,sr=>Object.keys(sr).map(Number));this.inFlightDependencies.forEach(sr=>sr?.abort()),this.inFlightDependencies=[];let Be=Promise.resolve({});if(Object.keys(qe).length){const sr=new AbortController;this.inFlightDependencies.push(sr),Be=ee.sendAsync({type:"GG",data:{stacks:qe,source:this.source,tileID:this.tileID,type:"glyphs"}},sr)}const ot=Object.keys(ue.iconDependencies);let Ft=Promise.resolve({});if(ot.length){const sr=new AbortController;this.inFlightDependencies.push(sr),Ft=ee.sendAsync({type:"GI",data:{icons:ot,source:this.source,tileID:this.tileID,type:"icons"}},sr)}const $t=Object.keys(ue.patternDependencies);let Er=Promise.resolve({});if($t.length){const sr=new AbortController;this.inFlightDependencies.push(sr),Er=ee.sendAsync({type:"GI",data:{icons:$t,source:this.source,tileID:this.tileID,type:"patterns"}},sr)}const[tr,xr,hr]=yield Promise.all([Be,Ft,Er]),dn=new j(tr),fn=new x.bo(xr,hr);for(const sr in Ae){const jr=Ae[sr];jr instanceof x.a6?(le(jr.layers,this.zoom,H),x.bp({bucket:jr,glyphMap:tr,glyphPositions:dn.positions,imageMap:xr,imagePositions:fn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):jr.hasPattern&&(jr instanceof x.bq||jr instanceof x.br||jr instanceof x.bs)&&(le(jr.layers,this.zoom,H),jr.addFeatures(ue,this.tileID.canonical,fn.patternPositions))}return this.status="done",{buckets:Object.values(Ae).filter(sr=>!sr.isEmpty()),featureIndex:_e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:dn.image,imageAtlas:fn,glyphMap:this.returnDependencies?tr:null,iconMap:this.returnDependencies?xr:null,glyphPositions:this.returnDependencies?dn.positions:null}})}}function le(ne,N,B){const H=new x.z(N);for(const ee of ne)ee.recalculate(H,B)}class Y{constructor(N,B,H){this.actor=N,this.layerIndex=B,this.availableImages=H,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(N,B){return x._(this,void 0,void 0,function*(){const H=yield x.l(N.request,B);try{return{vectorTile:new x.bt.VectorTile(new x.bu(H.data)),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(ee){const fe=new Uint8Array(H.data);let _e=`Unable to parse the tile at ${N.request.url}, `;throw _e+=fe[0]===31&&fe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ee.message}`,new Error(_e)}})}loadTile(N){return x._(this,void 0,void 0,function*(){const B=N.uid,H=!!(N&&N.request&&N.request.collectResourceTiming)&&new x.bv(N.request),ee=new q(N);this.loading[B]=ee;const fe=new AbortController;ee.abort=fe;try{const _e=yield this.loadVectorTile(N,fe);if(delete this.loading[B],!_e)return null;const Ae=_e.rawData,ue={};_e.expires&&(ue.expires=_e.expires),_e.cacheControl&&(ue.cacheControl=_e.cacheControl);const Oe={};if(H){const Be=H.finish();Be&&(Oe.resourceTiming=JSON.parse(JSON.stringify(Be)))}ee.vectorTile=_e.vectorTile;const qe=ee.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[B]=ee,this.fetching[B]={rawTileData:Ae,cacheControl:ue,resourceTiming:Oe};try{const Be=yield qe;return x.e({rawTileData:Ae.slice(0)},Be,ue,Oe)}finally{delete this.fetching[B]}}catch(_e){throw delete this.loading[B],ee.status="done",this.loaded[B]=ee,_e}})}reloadTile(N){return x._(this,void 0,void 0,function*(){const B=N.uid;if(!this.loaded||!this.loaded[B])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[B];if(H.showCollisionBoxes=N.showCollisionBoxes,H.status==="parsing"){const ee=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor);let fe;if(this.fetching[B]){const{rawTileData:_e,cacheControl:Ae,resourceTiming:ue}=this.fetching[B];delete this.fetching[B],fe=x.e({rawTileData:_e.slice(0)},ee,Ae,ue)}else fe=ee;return fe}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(N){return x._(this,void 0,void 0,function*(){const B=this.loading,H=N.uid;B&&B[H]&&B[H].abort&&(B[H].abort.abort(),delete B[H])})}removeTile(N){return x._(this,void 0,void 0,function*(){this.loaded&&this.loaded[N.uid]&&delete this.loaded[N.uid]})}}class W{constructor(){this.loaded={}}loadTile(N){return x._(this,void 0,void 0,function*(){const{uid:B,encoding:H,rawImageData:ee,redFactor:fe,greenFactor:_e,blueFactor:Ae,baseShift:ue}=N,Oe=ee.width+2,qe=ee.height+2,Be=x.b(ee)?new x.R({width:Oe,height:qe},yield x.bw(ee,-1,-1,Oe,qe)):ee,ot=new x.bx(B,Be,H,fe,_e,Ae,ue);return this.loaded=this.loaded||{},this.loaded[B]=ot,ot})}removeTile(N){const B=this.loaded,H=N.uid;B&&B[H]&&delete B[H]}}function $e(ne,N){if(ne.length!==0){He(ne[0],N);for(var B=1;B<ne.length;B++)He(ne[B],!N)}}function He(ne,N){for(var B=0,H=0,ee=0,fe=ne.length,_e=fe-1;ee<fe;_e=ee++){var Ae=(ne[ee][0]-ne[_e][0])*(ne[_e][1]+ne[ee][1]),ue=B+Ae;H+=Math.abs(B)>=Math.abs(Ae)?B-ue+Ae:Ae-ue+B,B=ue}B+H>=0!=!!N&&ne.reverse()}var Je=x.by(function ne(N,B){var H,ee=N&&N.type;if(ee==="FeatureCollection")for(H=0;H<N.features.length;H++)ne(N.features[H],B);else if(ee==="GeometryCollection")for(H=0;H<N.geometries.length;H++)ne(N.geometries[H],B);else if(ee==="Feature")ne(N.geometry,B);else if(ee==="Polygon")$e(N.coordinates,B);else if(ee==="MultiPolygon")for(H=0;H<N.coordinates.length;H++)$e(N.coordinates[H],B);return N});const Qt=x.bt.VectorTileFeature.prototype.toGeoJSON;var be={exports:{}},pe=x.bz,ke=x.bt.VectorTileFeature,Ve=et;function et(ne,N){this.options=N||{},this.features=ne,this.length=ne.length}function ut(ne,N){this.id=typeof ne.id=="number"?ne.id:void 0,this.type=ne.type,this.rawGeometry=ne.type===1?[ne.geometry]:ne.geometry,this.properties=ne.tags,this.extent=N||4096}et.prototype.feature=function(ne){return new ut(this.features[ne],this.options.extent)},ut.prototype.loadGeometry=function(){var ne=this.rawGeometry;this.geometry=[];for(var N=0;N<ne.length;N++){for(var B=ne[N],H=[],ee=0;ee<B.length;ee++)H.push(new pe(B[ee][0],B[ee][1]));this.geometry.push(H)}return this.geometry},ut.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ne=this.geometry,N=1/0,B=-1/0,H=1/0,ee=-1/0,fe=0;fe<ne.length;fe++)for(var _e=ne[fe],Ae=0;Ae<_e.length;Ae++){var ue=_e[Ae];N=Math.min(N,ue.x),B=Math.max(B,ue.x),H=Math.min(H,ue.y),ee=Math.max(ee,ue.y)}return[N,H,B,ee]},ut.prototype.toGeoJSON=ke.prototype.toGeoJSON;var Qe=x.bA,ce=Ve;function me(ne){var N=new Qe;return function(B,H){for(var ee in B.layers)H.writeMessage(3,Le,B.layers[ee])}(ne,N),N.finish()}function Le(ne,N){var B;N.writeVarintField(15,ne.version||1),N.writeStringField(1,ne.name||""),N.writeVarintField(5,ne.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<ne.length;B++)H.feature=ne.feature(B),N.writeMessage(2,Ye,H);var ee=H.keys;for(B=0;B<ee.length;B++)N.writeStringField(3,ee[B]);var fe=H.values;for(B=0;B<fe.length;B++)N.writeMessage(4,Hr,fe[B])}function Ye(ne,N){var B=ne.feature;B.id!==void 0&&N.writeVarintField(1,B.id),N.writeMessage(2,Tt,ne),N.writeVarintField(3,B.type),N.writeMessage(4,Kr,B)}function Tt(ne,N){var B=ne.feature,H=ne.keys,ee=ne.values,fe=ne.keycache,_e=ne.valuecache;for(var Ae in B.properties){var ue=B.properties[Ae],Oe=fe[Ae];if(ue!==null){Oe===void 0&&(H.push(Ae),fe[Ae]=Oe=H.length-1),N.writeVarint(Oe);var qe=typeof ue;qe!=="string"&&qe!=="boolean"&&qe!=="number"&&(ue=JSON.stringify(ue));var Be=qe+":"+ue,ot=_e[Be];ot===void 0&&(ee.push(ue),_e[Be]=ot=ee.length-1),N.writeVarint(ot)}}}function Ot(ne,N){return(N<<3)+(7&ne)}function vr(ne){return ne<<1^ne>>31}function Kr(ne,N){for(var B=ne.loadGeometry(),H=ne.type,ee=0,fe=0,_e=B.length,Ae=0;Ae<_e;Ae++){var ue=B[Ae],Oe=1;H===1&&(Oe=ue.length),N.writeVarint(Ot(1,Oe));for(var qe=H===3?ue.length-1:ue.length,Be=0;Be<qe;Be++){Be===1&&H!==1&&N.writeVarint(Ot(2,qe-1));var ot=ue[Be].x-ee,Ft=ue[Be].y-fe;N.writeVarint(vr(ot)),N.writeVarint(vr(Ft)),ee+=ot,fe+=Ft}H===3&&N.writeVarint(Ot(7,1))}}function Hr(ne,N){var B=typeof ne;B==="string"?N.writeStringField(1,ne):B==="boolean"?N.writeBooleanField(7,ne):B==="number"&&(ne%1!=0?N.writeDoubleField(3,ne):ne<0?N.writeSVarintField(6,ne):N.writeVarintField(5,ne))}be.exports=me,be.exports.fromVectorTileJs=me,be.exports.fromGeojsonVt=function(ne,N){N=N||{};var B={};for(var H in ne)B[H]=new ce(ne[H].features,N),B[H].name=H,B[H].version=N.version,B[H].extent=N.extent;return me({layers:B})},be.exports.GeoJSONWrapper=ce;var nr=x.by(be.exports);const Ke={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},We=Math.fround||(gt=new Float32Array(1),ne=>(gt[0]=+ne,gt[0]));var gt;const yt=3,Rt=5,It=6;class Sr{constructor(N){this.options=Object.assign(Object.create(Ke),N),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(N){const{log:B,minZoom:H,maxZoom:ee}=this.options;B&&console.time("total time");const fe=`prepare ${N.length} points`;B&&console.time(fe),this.points=N;const _e=[];for(let ue=0;ue<N.length;ue++){const Oe=N[ue];if(!Oe.geometry)continue;const[qe,Be]=Oe.geometry.coordinates,ot=We(zr(qe)),Ft=We(ur(Be));_e.push(ot,Ft,1/0,ue,-1,1),this.options.reduce&&_e.push(0)}let Ae=this.trees[ee+1]=this._createTree(_e);B&&console.timeEnd(fe);for(let ue=ee;ue>=H;ue--){const Oe=+Date.now();Ae=this.trees[ue]=this._createTree(this._cluster(Ae,ue)),B&&console.log("z%d: %d clusters in %dms",ue,Ae.numItems,+Date.now()-Oe)}return B&&console.timeEnd("total time"),this}getClusters(N,B){let H=((N[0]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,N[1]));let fe=N[2]===180?180:((N[2]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)H=-180,fe=180;else if(H>fe){const Be=this.getClusters([H,ee,180,_e],B),ot=this.getClusters([-180,ee,fe,_e],B);return Be.concat(ot)}const Ae=this.trees[this._limitZoom(B)],ue=Ae.range(zr(H),ur(_e),zr(fe),ur(ee)),Oe=Ae.data,qe=[];for(const Be of ue){const ot=this.stride*Be;qe.push(Oe[ot+Rt]>1?wr(Oe,ot,this.clusterProps):this.points[Oe[ot+yt]])}return qe}getChildren(N){const B=this._getOriginId(N),H=this._getOriginZoom(N),ee="No cluster with the specified id.",fe=this.trees[H];if(!fe)throw new Error(ee);const _e=fe.data;if(B*this.stride>=_e.length)throw new Error(ee);const Ae=this.options.radius/(this.options.extent*Math.pow(2,H-1)),ue=fe.within(_e[B*this.stride],_e[B*this.stride+1],Ae),Oe=[];for(const qe of ue){const Be=qe*this.stride;_e[Be+4]===N&&Oe.push(_e[Be+Rt]>1?wr(_e,Be,this.clusterProps):this.points[_e[Be+yt]])}if(Oe.length===0)throw new Error(ee);return Oe}getLeaves(N,B,H){const ee=[];return this._appendLeaves(ee,N,B=B||10,H=H||0,0),ee}getTile(N,B,H){const ee=this.trees[this._limitZoom(N)],fe=Math.pow(2,N),{extent:_e,radius:Ae}=this.options,ue=Ae/_e,Oe=(H-ue)/fe,qe=(H+1+ue)/fe,Be={features:[]};return this._addTileFeatures(ee.range((B-ue)/fe,Oe,(B+1+ue)/fe,qe),ee.data,B,H,fe,Be),B===0&&this._addTileFeatures(ee.range(1-ue/fe,Oe,1,qe),ee.data,fe,H,fe,Be),B===fe-1&&this._addTileFeatures(ee.range(0,Oe,ue/fe,qe),ee.data,-1,H,fe,Be),Be.features.length?Be:null}getClusterExpansionZoom(N){let B=this._getOriginZoom(N)-1;for(;B<=this.options.maxZoom;){const H=this.getChildren(N);if(B++,H.length!==1)break;N=H[0].properties.cluster_id}return B}_appendLeaves(N,B,H,ee,fe){const _e=this.getChildren(B);for(const Ae of _e){const ue=Ae.properties;if(ue&&ue.cluster?fe+ue.point_count<=ee?fe+=ue.point_count:fe=this._appendLeaves(N,ue.cluster_id,H,ee,fe):fe<ee?fe++:N.push(Ae),N.length===H)break}return fe}_createTree(N){const B=new x.av(N.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<N.length;H+=this.stride)B.add(N[H],N[H+1]);return B.finish(),B.data=N,B}_addTileFeatures(N,B,H,ee,fe,_e){for(const Ae of N){const ue=Ae*this.stride,Oe=B[ue+Rt]>1;let qe,Be,ot;if(Oe)qe=kr(B,ue,this.clusterProps),Be=B[ue],ot=B[ue+1];else{const Er=this.points[B[ue+yt]];qe=Er.properties;const[tr,xr]=Er.geometry.coordinates;Be=zr(tr),ot=ur(xr)}const Ft={type:1,geometry:[[Math.round(this.options.extent*(Be*fe-H)),Math.round(this.options.extent*(ot*fe-ee))]],tags:qe};let $t;$t=Oe||this.options.generateId?B[ue+yt]:this.points[B[ue+yt]].id,$t!==void 0&&(Ft.id=$t),_e.features.push(Ft)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(Math.floor(+N),this.options.maxZoom+1))}_cluster(N,B){const{radius:H,extent:ee,reduce:fe,minPoints:_e}=this.options,Ae=H/(ee*Math.pow(2,B)),ue=N.data,Oe=[],qe=this.stride;for(let Be=0;Be<ue.length;Be+=qe){if(ue[Be+2]<=B)continue;ue[Be+2]=B;const ot=ue[Be],Ft=ue[Be+1],$t=N.within(ue[Be],ue[Be+1],Ae),Er=ue[Be+Rt];let tr=Er;for(const xr of $t){const hr=xr*qe;ue[hr+2]>B&&(tr+=ue[hr+Rt])}if(tr>Er&&tr>=_e){let xr,hr=ot*Er,dn=Ft*Er,fn=-1;const sr=((Be/qe|0)<<5)+(B+1)+this.points.length;for(const jr of $t){const Ur=jr*qe;if(ue[Ur+2]<=B)continue;ue[Ur+2]=B;const Mn=ue[Ur+Rt];hr+=ue[Ur]*Mn,dn+=ue[Ur+1]*Mn,ue[Ur+4]=sr,fe&&(xr||(xr=this._map(ue,Be,!0),fn=this.clusterProps.length,this.clusterProps.push(xr)),fe(xr,this._map(ue,Ur)))}ue[Be+4]=sr,Oe.push(hr/tr,dn/tr,1/0,sr,-1,tr),fe&&Oe.push(fn)}else{for(let xr=0;xr<qe;xr++)Oe.push(ue[Be+xr]);if(tr>1)for(const xr of $t){const hr=xr*qe;if(!(ue[hr+2]<=B)){ue[hr+2]=B;for(let dn=0;dn<qe;dn++)Oe.push(ue[hr+dn])}}}}return Oe}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,B,H){if(N[B+Rt]>1){const _e=this.clusterProps[N[B+It]];return H?Object.assign({},_e):_e}const ee=this.points[N[B+yt]].properties,fe=this.options.map(ee);return H&&fe===ee?Object.assign({},fe):fe}}function wr(ne,N,B){return{type:"Feature",id:ne[N+yt],properties:kr(ne,N,B),geometry:{type:"Point",coordinates:[(H=ne[N],360*(H-.5)),ct(ne[N+1])]}};var H}function kr(ne,N,B){const H=ne[N+Rt],ee=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,fe=ne[N+It],_e=fe===-1?{}:Object.assign({},B[fe]);return Object.assign(_e,{cluster:!0,cluster_id:ne[N+yt],point_count:H,point_count_abbreviated:ee})}function zr(ne){return ne/360+.5}function ur(ne){const N=Math.sin(ne*Math.PI/180),B=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return B<0?0:B>1?1:B}function ct(ne){const N=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function Br(ne,N,B,H){let ee=H;const fe=N+(B-N>>1);let _e,Ae=B-N;const ue=ne[N],Oe=ne[N+1],qe=ne[B],Be=ne[B+1];for(let ot=N+3;ot<B;ot+=3){const Ft=cr(ne[ot],ne[ot+1],ue,Oe,qe,Be);if(Ft>ee)_e=ot,ee=Ft;else if(Ft===ee){const $t=Math.abs(ot-fe);$t<Ae&&(_e=ot,Ae=$t)}}ee>H&&(_e-N>3&&Br(ne,N,_e,H),ne[_e+2]=ee,B-_e>3&&Br(ne,_e,B,H))}function cr(ne,N,B,H,ee,fe){let _e=ee-B,Ae=fe-H;if(_e!==0||Ae!==0){const ue=((ne-B)*_e+(N-H)*Ae)/(_e*_e+Ae*Ae);ue>1?(B=ee,H=fe):ue>0&&(B+=_e*ue,H+=Ae*ue)}return _e=ne-B,Ae=N-H,_e*_e+Ae*Ae}function Gt(ne,N,B,H){const ee={id:ne??null,type:N,geometry:B,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(N==="Point"||N==="MultiPoint"||N==="LineString")Nr(ee,B);else if(N==="Polygon")Nr(ee,B[0]);else if(N==="MultiLineString")for(const fe of B)Nr(ee,fe);else if(N==="MultiPolygon")for(const fe of B)Nr(ee,fe[0]);return ee}function Nr(ne,N){for(let B=0;B<N.length;B+=3)ne.minX=Math.min(ne.minX,N[B]),ne.minY=Math.min(ne.minY,N[B+1]),ne.maxX=Math.max(ne.maxX,N[B]),ne.maxY=Math.max(ne.maxY,N[B+1])}function Lr(ne,N,B,H){if(!N.geometry)return;const ee=N.geometry.coordinates;if(ee&&ee.length===0)return;const fe=N.geometry.type,_e=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2);let Ae=[],ue=N.id;if(B.promoteId?ue=N.properties[B.promoteId]:B.generateId&&(ue=H||0),fe==="Point")gr(ee,Ae);else if(fe==="MultiPoint")for(const Oe of ee)gr(Oe,Ae);else if(fe==="LineString")Te(ee,Ae,_e,!1);else if(fe==="MultiLineString"){if(B.lineMetrics){for(const Oe of ee)Ae=[],Te(Oe,Ae,_e,!1),ne.push(Gt(ue,"LineString",Ae,N.properties));return}nn(ee,Ae,_e,!1)}else if(fe==="Polygon")nn(ee,Ae,_e,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(const Oe of N.geometry.geometries)Lr(ne,{id:ue,geometry:Oe,properties:N.properties},B,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Oe of ee){const qe=[];nn(Oe,qe,_e,!0),Ae.push(qe)}}ne.push(Gt(ue,fe,Ae,N.properties))}function gr(ne,N){N.push(Tr(ne[0]),Wt(ne[1]),0)}function Te(ne,N,B,H){let ee,fe,_e=0;for(let ue=0;ue<ne.length;ue++){const Oe=Tr(ne[ue][0]),qe=Wt(ne[ue][1]);N.push(Oe,qe,0),ue>0&&(_e+=H?(ee*qe-Oe*fe)/2:Math.sqrt(Math.pow(Oe-ee,2)+Math.pow(qe-fe,2))),ee=Oe,fe=qe}const Ae=N.length-3;N[2]=1,Br(N,0,Ae,B),N[Ae+2]=1,N.size=Math.abs(_e),N.start=0,N.end=N.size}function nn(ne,N,B,H){for(let ee=0;ee<ne.length;ee++){const fe=[];Te(ne[ee],fe,B,H),N.push(fe)}}function Tr(ne){return ne/360+.5}function Wt(ne){const N=Math.sin(ne*Math.PI/180),B=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return B<0?0:B>1?1:B}function dr(ne,N,B,H,ee,fe,_e,Ae){if(H/=N,fe>=(B/=N)&&_e<H)return ne;if(_e<B||fe>=H)return null;const ue=[];for(const Oe of ne){const qe=Oe.geometry;let Be=Oe.type;const ot=ee===0?Oe.minX:Oe.minY,Ft=ee===0?Oe.maxX:Oe.maxY;if(ot>=B&&Ft<H){ue.push(Oe);continue}if(Ft<B||ot>=H)continue;let $t=[];if(Be==="Point"||Be==="MultiPoint")_n(qe,$t,B,H,ee);else if(Be==="LineString")Sn(qe,$t,B,H,ee,!1,Ae.lineMetrics);else if(Be==="MultiLineString")an(qe,$t,B,H,ee,!1);else if(Be==="Polygon")an(qe,$t,B,H,ee,!0);else if(Be==="MultiPolygon")for(const Er of qe){const tr=[];an(Er,tr,B,H,ee,!0),tr.length&&$t.push(tr)}if($t.length){if(Ae.lineMetrics&&Be==="LineString"){for(const Er of $t)ue.push(Gt(Oe.id,Be,Er,Oe.tags));continue}Be!=="LineString"&&Be!=="MultiLineString"||($t.length===1?(Be="LineString",$t=$t[0]):Be="MultiLineString"),Be!=="Point"&&Be!=="MultiPoint"||(Be=$t.length===3?"Point":"MultiPoint"),ue.push(Gt(Oe.id,Be,$t,Oe.tags))}}return ue.length?ue:null}function _n(ne,N,B,H,ee){for(let fe=0;fe<ne.length;fe+=3){const _e=ne[fe+ee];_e>=B&&_e<=H&&Zr(N,ne[fe],ne[fe+1],ne[fe+2])}}function Sn(ne,N,B,H,ee,fe,_e){let Ae=An(ne);const ue=ee===0?Vr:Yr;let Oe,qe,Be=ne.start;for(let tr=0;tr<ne.length-3;tr+=3){const xr=ne[tr],hr=ne[tr+1],dn=ne[tr+2],fn=ne[tr+3],sr=ne[tr+4],jr=ee===0?xr:hr,Ur=ee===0?fn:sr;let Mn=!1;_e&&(Oe=Math.sqrt(Math.pow(xr-fn,2)+Math.pow(hr-sr,2))),jr<B?Ur>B&&(qe=ue(Ae,xr,hr,fn,sr,B),_e&&(Ae.start=Be+Oe*qe)):jr>H?Ur<H&&(qe=ue(Ae,xr,hr,fn,sr,H),_e&&(Ae.start=Be+Oe*qe)):Zr(Ae,xr,hr,dn),Ur<B&&jr>=B&&(qe=ue(Ae,xr,hr,fn,sr,B),Mn=!0),Ur>H&&jr<=H&&(qe=ue(Ae,xr,hr,fn,sr,H),Mn=!0),!fe&&Mn&&(_e&&(Ae.end=Be+Oe*qe),N.push(Ae),Ae=An(ne)),_e&&(Be+=Oe)}let ot=ne.length-3;const Ft=ne[ot],$t=ne[ot+1],Er=ee===0?Ft:$t;Er>=B&&Er<=H&&Zr(Ae,Ft,$t,ne[ot+2]),ot=Ae.length-3,fe&&ot>=3&&(Ae[ot]!==Ae[0]||Ae[ot+1]!==Ae[1])&&Zr(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&N.push(Ae)}function An(ne){const N=[];return N.size=ne.size,N.start=ne.start,N.end=ne.end,N}function an(ne,N,B,H,ee,fe){for(const _e of ne)Sn(_e,N,B,H,ee,fe,!1)}function Zr(ne,N,B,H){ne.push(N,B,H)}function Vr(ne,N,B,H,ee,fe){const _e=(fe-N)/(H-N);return Zr(ne,fe,B+(ee-B)*_e,1),_e}function Yr(ne,N,B,H,ee,fe){const _e=(fe-B)/(ee-B);return Zr(ne,N+(H-N)*_e,fe,1),_e}function rt(ne,N){const B=[];for(let H=0;H<ne.length;H++){const ee=ne[H],fe=ee.type;let _e;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")_e=Fn(ee.geometry,N);else if(fe==="MultiLineString"||fe==="Polygon"){_e=[];for(const Ae of ee.geometry)_e.push(Fn(Ae,N))}else if(fe==="MultiPolygon"){_e=[];for(const Ae of ee.geometry){const ue=[];for(const Oe of Ae)ue.push(Fn(Oe,N));_e.push(ue)}}B.push(Gt(ee.id,fe,_e,ee.tags))}return B}function Fn(ne,N){const B=[];B.size=ne.size,ne.start!==void 0&&(B.start=ne.start,B.end=ne.end);for(let H=0;H<ne.length;H+=3)B.push(ne[H]+N,ne[H+1],ne[H+2]);return B}function kn(ne,N){if(ne.transformed)return ne;const B=1<<ne.z,H=ne.x,ee=ne.y;for(const fe of ne.features){const _e=fe.geometry,Ae=fe.type;if(fe.geometry=[],Ae===1)for(let ue=0;ue<_e.length;ue+=2)fe.geometry.push(Cn(_e[ue],_e[ue+1],N,B,H,ee));else for(let ue=0;ue<_e.length;ue++){const Oe=[];for(let qe=0;qe<_e[ue].length;qe+=2)Oe.push(Cn(_e[ue][qe],_e[ue][qe+1],N,B,H,ee));fe.geometry.push(Oe)}}return ne.transformed=!0,ne}function Cn(ne,N,B,H,ee,fe){return[Math.round(B*(ne*H-ee)),Math.round(B*(N*H-fe))]}function en(ne,N,B,H,ee){const fe=N===ee.maxZoom?0:ee.tolerance/((1<<N)*ee.extent),_e={features:[],numPoints:0,numSimplified:0,numFeatures:ne.length,source:null,x:B,y:H,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ae of ne)at(_e,Ae,fe,ee);return _e}function at(ne,N,B,H){const ee=N.geometry,fe=N.type,_e=[];if(ne.minX=Math.min(ne.minX,N.minX),ne.minY=Math.min(ne.minY,N.minY),ne.maxX=Math.max(ne.maxX,N.maxX),ne.maxY=Math.max(ne.maxY,N.maxY),fe==="Point"||fe==="MultiPoint")for(let Ae=0;Ae<ee.length;Ae+=3)_e.push(ee[Ae],ee[Ae+1]),ne.numPoints++,ne.numSimplified++;else if(fe==="LineString")lr(_e,ee,ne,B,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(let Ae=0;Ae<ee.length;Ae++)lr(_e,ee[Ae],ne,B,fe==="Polygon",Ae===0);else if(fe==="MultiPolygon")for(let Ae=0;Ae<ee.length;Ae++){const ue=ee[Ae];for(let Oe=0;Oe<ue.length;Oe++)lr(_e,ue[Oe],ne,B,!0,Oe===0)}if(_e.length){let Ae=N.tags||null;if(fe==="LineString"&&H.lineMetrics){Ae={};for(const Oe in N.tags)Ae[Oe]=N.tags[Oe];Ae.mapbox_clip_start=ee.start/ee.size,Ae.mapbox_clip_end=ee.end/ee.size}const ue={geometry:_e,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:Ae};N.id!==null&&(ue.id=N.id),ne.features.push(ue)}}function lr(ne,N,B,H,ee,fe){const _e=H*H;if(H>0&&N.size<(ee?_e:H))return void(B.numPoints+=N.length/3);const Ae=[];for(let ue=0;ue<N.length;ue+=3)(H===0||N[ue+2]>_e)&&(B.numSimplified++,Ae.push(N[ue],N[ue+1])),B.numPoints++;ee&&function(ue,Oe){let qe=0;for(let Be=0,ot=ue.length,Ft=ot-2;Be<ot;Ft=Be,Be+=2)qe+=(ue[Be]-ue[Ft])*(ue[Be+1]+ue[Ft+1]);if(qe>0===Oe)for(let Be=0,ot=ue.length;Be<ot/2;Be+=2){const Ft=ue[Be],$t=ue[Be+1];ue[Be]=ue[ot-2-Be],ue[Be+1]=ue[ot-1-Be],ue[ot-2-Be]=Ft,ue[ot-1-Be]=$t}}(Ae,fe),ne.push(Ae)}const Ht={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class zt{constructor(N,B){const H=(B=this.options=function(fe,_e){for(const Ae in _e)fe[Ae]=_e[Ae];return fe}(Object.create(Ht),B)).debug;if(H&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");let ee=function(fe,_e){const Ae=[];if(fe.type==="FeatureCollection")for(let ue=0;ue<fe.features.length;ue++)Lr(Ae,fe.features[ue],_e,ue);else Lr(Ae,fe.type==="Feature"?fe:{geometry:fe},_e);return Ae}(N,B);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=function(fe,_e){const Ae=_e.buffer/_e.extent;let ue=fe;const Oe=dr(fe,1,-1-Ae,Ae,0,-1,2,_e),qe=dr(fe,1,1-Ae,2+Ae,0,-1,2,_e);return(Oe||qe)&&(ue=dr(fe,1,-Ae,1+Ae,0,-1,2,_e)||[],Oe&&(ue=rt(Oe,1).concat(ue)),qe&&(ue=ue.concat(rt(qe,-1)))),ue}(ee,B),ee.length&&this.splitTile(ee,0,0,0),H&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(N,B,H,ee,fe,_e,Ae){const ue=[N,B,H,ee],Oe=this.options,qe=Oe.debug;for(;ue.length;){ee=ue.pop(),H=ue.pop(),B=ue.pop(),N=ue.pop();const Be=1<<B,ot=ti(B,H,ee);let Ft=this.tiles[ot];if(!Ft&&(qe>1&&console.time("creation"),Ft=this.tiles[ot]=en(N,B,H,ee,Oe),this.tileCoords.push({z:B,x:H,y:ee}),qe)){qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,H,ee,Ft.numFeatures,Ft.numPoints,Ft.numSimplified),console.timeEnd("creation"));const Mn=`z${B}`;this.stats[Mn]=(this.stats[Mn]||0)+1,this.total++}if(Ft.source=N,fe==null){if(B===Oe.indexMaxZoom||Ft.numPoints<=Oe.indexMaxPoints)continue}else{if(B===Oe.maxZoom||B===fe)continue;if(fe!=null){const Mn=fe-B;if(H!==_e>>Mn||ee!==Ae>>Mn)continue}}if(Ft.source=null,N.length===0)continue;qe>1&&console.time("clipping");const $t=.5*Oe.buffer/Oe.extent,Er=.5-$t,tr=.5+$t,xr=1+$t;let hr=null,dn=null,fn=null,sr=null,jr=dr(N,Be,H-$t,H+tr,0,Ft.minX,Ft.maxX,Oe),Ur=dr(N,Be,H+Er,H+xr,0,Ft.minX,Ft.maxX,Oe);N=null,jr&&(hr=dr(jr,Be,ee-$t,ee+tr,1,Ft.minY,Ft.maxY,Oe),dn=dr(jr,Be,ee+Er,ee+xr,1,Ft.minY,Ft.maxY,Oe),jr=null),Ur&&(fn=dr(Ur,Be,ee-$t,ee+tr,1,Ft.minY,Ft.maxY,Oe),sr=dr(Ur,Be,ee+Er,ee+xr,1,Ft.minY,Ft.maxY,Oe),Ur=null),qe>1&&console.timeEnd("clipping"),ue.push(hr||[],B+1,2*H,2*ee),ue.push(dn||[],B+1,2*H,2*ee+1),ue.push(fn||[],B+1,2*H+1,2*ee),ue.push(sr||[],B+1,2*H+1,2*ee+1)}}getTile(N,B,H){N=+N,B=+B,H=+H;const ee=this.options,{extent:fe,debug:_e}=ee;if(N<0||N>24)return null;const Ae=1<<N,ue=ti(N,B=B+Ae&Ae-1,H);if(this.tiles[ue])return kn(this.tiles[ue],fe);_e>1&&console.log("drilling down to z%d-%d-%d",N,B,H);let Oe,qe=N,Be=B,ot=H;for(;!Oe&&qe>0;)qe--,Be>>=1,ot>>=1,Oe=this.tiles[ti(qe,Be,ot)];return Oe&&Oe.source?(_e>1&&(console.log("found parent tile z%d-%d-%d",qe,Be,ot),console.time("drilling down")),this.splitTile(Oe.source,qe,Be,ot,N,B,H),_e>1&&console.timeEnd("drilling down"),this.tiles[ue]?kn(this.tiles[ue],fe):null):null}}function ti(ne,N,B){return 32*((1<<ne)*B+N)+ne}function er(ne,N){return N?ne.properties[N]:ne.id}function bi(ne,N){if(ne==null)return!0;if(ne.type==="Feature")return er(ne,N)!=null;if(ne.type==="FeatureCollection"){const B=new Set;for(const H of ne.features){const ee=er(H,N);if(ee==null||B.has(ee))return!1;B.add(ee)}return!0}return!1}function wt(ne,N){const B=new Map;if(ne!=null)if(ne.type==="Feature")B.set(er(ne,N),ne);else for(const H of ne.features)B.set(er(H,N),H);return B}class ca extends Y{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(N,B){return x._(this,void 0,void 0,function*(){const H=N.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ee=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!ee)return null;const fe=new class{constructor(Ae){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=x.X,this.length=Ae.length,this._features=Ae}feature(Ae){return new class{constructor(ue){this._feature=ue,this.extent=x.X,this.type=ue.type,this.properties=ue.tags,"id"in ue&&!isNaN(ue.id)&&(this.id=parseInt(ue.id,10))}loadGeometry(){if(this._feature.type===1){const ue=[];for(const Oe of this._feature.geometry)ue.push([new x.P(Oe[0],Oe[1])]);return ue}{const ue=[];for(const Oe of this._feature.geometry){const qe=[];for(const Be of Oe)qe.push(new x.P(Be[0],Be[1]));ue.push(qe)}return ue}}toGeoJSON(ue,Oe,qe){return Qt.call(this,ue,Oe,qe)}}(this._features[Ae])}}(ee.features);let _e=nr(fe);return _e.byteOffset===0&&_e.byteLength===_e.buffer.byteLength||(_e=new Uint8Array(_e)),{vectorTile:fe,rawData:_e.buffer}})}loadData(N){return x._(this,void 0,void 0,function*(){var B;(B=this._pendingRequest)===null||B===void 0||B.abort();const H=!!(N&&N.request&&N.request.collectResourceTiming)&&new x.bv(N.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(N,this._pendingRequest),this._geoJSONIndex=N.cluster?new Sr(function({superclusterOptions:_e,clusterProperties:Ae}){if(!Ae||!_e)return _e;const ue={},Oe={},qe={accumulated:null,zoom:0},Be={properties:null},ot=Object.keys(Ae);for(const Ft of ot){const[$t,Er]=Ae[Ft],tr=x.bC(Er),xr=x.bC(typeof $t=="string"?[$t,["accumulated"],["get",Ft]]:$t);ue[Ft]=tr.value,Oe[Ft]=xr.value}return _e.map=Ft=>{Be.properties=Ft;const $t={};for(const Er of ot)$t[Er]=ue[Er].evaluate(qe,Be);return $t},_e.reduce=(Ft,$t)=>{Be.properties=$t;for(const Er of ot)qe.accumulated=Ft[Er],Ft[Er]=Oe[Er].evaluate(qe,Be)},_e}(N)).load((yield this._pendingData).features):(ee=yield this._pendingData,new zt(ee,N.geojsonVtOptions)),this.loaded={};const fe={};if(H){const _e=H.finish();_e&&(fe.resourceTiming={},fe.resourceTiming[N.source]=JSON.parse(JSON.stringify(_e)))}return fe}catch(fe){if(delete this._pendingRequest,x.bB(fe))return{abandoned:!0};throw fe}var ee})}getData(){return x._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(N){const B=this.loaded;return B&&B[N.uid]?super.reloadTile(N):this.loadTile(N)}loadAndProcessGeoJSON(N,B){return x._(this,void 0,void 0,function*(){let H=yield this.loadGeoJSON(N,B);if(delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(Je(H,!0),N.filter){const ee=x.bC(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ee.result==="error")throw new Error(ee.value.map(_e=>`${_e.key}: ${_e.message}`).join(", "));H={type:"FeatureCollection",features:H.features.filter(_e=>ee.value.evaluate({zoom:0},_e))}}return H})}loadGeoJSON(N,B){return x._(this,void 0,void 0,function*(){const{promoteId:H}=N;if(N.request){const ee=yield x.h(N.request,B);return this._dataUpdateable=bi(ee.data,H)?wt(ee.data,H):void 0,ee.data}if(typeof N.data=="string")try{const ee=JSON.parse(N.data);return this._dataUpdateable=bi(ee,H)?wt(ee,H):void 0,ee}catch{throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`)}if(!N.dataDiff)throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${N.source}`);return function(ee,fe,_e){var Ae,ue,Oe,qe;if(fe.removeAll&&ee.clear(),fe.remove)for(const Be of fe.remove)ee.delete(Be);if(fe.add)for(const Be of fe.add){const ot=er(Be,_e);ot!=null&&ee.set(ot,Be)}if(fe.update)for(const Be of fe.update){let ot=ee.get(Be.id);if(ot==null)continue;const Ft=!Be.removeAllProperties&&(((Ae=Be.removeProperties)===null||Ae===void 0?void 0:Ae.length)>0||((ue=Be.addOrUpdateProperties)===null||ue===void 0?void 0:ue.length)>0);if((Be.newGeometry||Be.removeAllProperties||Ft)&&(ot=Object.assign({},ot),ee.set(Be.id,ot),Ft&&(ot.properties=Object.assign({},ot.properties))),Be.newGeometry&&(ot.geometry=Be.newGeometry),Be.removeAllProperties)ot.properties={};else if(((Oe=Be.removeProperties)===null||Oe===void 0?void 0:Oe.length)>0)for(const $t of Be.removeProperties)Object.prototype.hasOwnProperty.call(ot.properties,$t)&&delete ot.properties[$t];if(((qe=Be.addOrUpdateProperties)===null||qe===void 0?void 0:qe.length)>0)for(const{key:$t,value:Er}of Be.addOrUpdateProperties)ot.properties[$t]=Er}}(this._dataUpdateable,N.dataDiff,H),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(N){return x._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(N){return this._geoJSONIndex.getClusterExpansionZoom(N.clusterId)}getClusterChildren(N){return this._geoJSONIndex.getChildren(N.clusterId)}getClusterLeaves(N){return this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset)}}class Xi{constructor(N){this.self=N,this.actor=new x.F(N),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(B,H)=>{if(this.externalWorkerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.externalWorkerSourceTypes[B]=H},this.self.addProtocol=x.bi,this.self.removeProtocol=x.bj,this.self.registerRTLTextPlugin=B=>{if(x.bD.isParsed())throw new Error("RTL text plugin already registered.");x.bD.setMethods(B)},this.actor.registerMessageHandler("LDT",(B,H)=>this._getDEMWorkerSource(B,H.source).loadTile(H)),this.actor.registerMessageHandler("RDT",(B,H)=>x._(this,void 0,void 0,function*(){this._getDEMWorkerSource(B,H.source).removeTile(H)})),this.actor.registerMessageHandler("GCEZ",(B,H)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(B,H.type,H.source).getClusterExpansionZoom(H)})),this.actor.registerMessageHandler("GCC",(B,H)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(B,H.type,H.source).getClusterChildren(H)})),this.actor.registerMessageHandler("GCL",(B,H)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(B,H.type,H.source).getClusterLeaves(H)})),this.actor.registerMessageHandler("LD",(B,H)=>this._getWorkerSource(B,H.type,H.source).loadData(H)),this.actor.registerMessageHandler("GD",(B,H)=>this._getWorkerSource(B,H.type,H.source).getData()),this.actor.registerMessageHandler("LT",(B,H)=>this._getWorkerSource(B,H.type,H.source).loadTile(H)),this.actor.registerMessageHandler("RT",(B,H)=>this._getWorkerSource(B,H.type,H.source).reloadTile(H)),this.actor.registerMessageHandler("AT",(B,H)=>this._getWorkerSource(B,H.type,H.source).abortTile(H)),this.actor.registerMessageHandler("RMT",(B,H)=>this._getWorkerSource(B,H.type,H.source).removeTile(H)),this.actor.registerMessageHandler("RS",(B,H)=>x._(this,void 0,void 0,function*(){if(!this.workerSources[B]||!this.workerSources[B][H.type]||!this.workerSources[B][H.type][H.source])return;const ee=this.workerSources[B][H.type][H.source];delete this.workerSources[B][H.type][H.source],ee.removeSource!==void 0&&ee.removeSource(H)})),this.actor.registerMessageHandler("RM",B=>x._(this,void 0,void 0,function*(){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B]})),this.actor.registerMessageHandler("SR",(B,H)=>x._(this,void 0,void 0,function*(){this.referrer=H})),this.actor.registerMessageHandler("SRPS",(B,H)=>this._syncRTLPluginState(B,H)),this.actor.registerMessageHandler("IS",(B,H)=>x._(this,void 0,void 0,function*(){this.self.importScripts(H)})),this.actor.registerMessageHandler("SI",(B,H)=>this._setImages(B,H)),this.actor.registerMessageHandler("UL",(B,H)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(B).update(H.layers,H.removedIds)})),this.actor.registerMessageHandler("SL",(B,H)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(B).replace(H)}))}_setImages(N,B){return x._(this,void 0,void 0,function*(){this.availableImages[N]=B;for(const H in this.workerSources[N]){const ee=this.workerSources[N][H];for(const fe in ee)ee[fe].availableImages=B}})}_syncRTLPluginState(N,B){return x._(this,void 0,void 0,function*(){if(x.bD.isParsed())return x.bD.getState();if(B.pluginStatus!=="loading")return x.bD.setState(B),B;const H=B.pluginURL;if(this.self.importScripts(H),x.bD.isParsed()){const ee={pluginStatus:"loaded",pluginURL:H};return x.bD.setState(ee),ee}throw x.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${H}`)})}_getAvailableImages(N){let B=this.availableImages[N];return B||(B=[]),B}_getLayerIndex(N){let B=this.layerIndexes[N];return B||(B=this.layerIndexes[N]=new h),B}_getWorkerSource(N,B,H){if(this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][B]||(this.workerSources[N][B]={}),!this.workerSources[N][B][H]){const ee={sendAsync:(fe,_e)=>(fe.targetMapId=N,this.actor.sendAsync(fe,_e))};switch(B){case"vector":this.workerSources[N][B][H]=new Y(ee,this._getLayerIndex(N),this._getAvailableImages(N));break;case"geojson":this.workerSources[N][B][H]=new ca(ee,this._getLayerIndex(N),this._getAvailableImages(N));break;default:this.workerSources[N][B][H]=new this.externalWorkerSourceTypes[B](ee,this._getLayerIndex(N),this._getAvailableImages(N))}}return this.workerSources[N][B][H]}_getDEMWorkerSource(N,B){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][B]||(this.demWorkerSources[N][B]=new W),this.demWorkerSources[N][B]}}return x.i(self)&&(self.worker=new Xi(self)),Xi}),_("index",["exports","./shared"],function(x,h){var j="4.7.1";let q,le;const Y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:m=>new Promise((e,s)=>{const u=requestAnimationFrame(e);m.signal.addEventListener("abort",()=>{cancelAnimationFrame(u),s(h.c())})}),getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,s.drawImage(m,0,0,m.width,m.height),s},resolveURL:m=>(q||(q=document.createElement("a")),q.href=m,q.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(le==null&&(le=matchMedia("(prefers-reduced-motion: reduce)")),le.matches)}};class W{static testProp(e){if(!W.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in W.docStyle)return e[s];return e[0]}static create(e,s,u){const d=window.document.createElement(e);return s!==void 0&&(d.className=s),u&&u.appendChild(d),d}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){W.docStyle&&W.selectProp&&(W.userSelect=W.docStyle[W.selectProp],W.docStyle[W.selectProp]="none")}static enableDrag(){W.docStyle&&W.selectProp&&(W.docStyle[W.selectProp]=W.userSelect)}static setTransform(e,s){e.style[W.transformProp]=s}static addEventListener(e,s,u,d={}){e.addEventListener(s,u,"passive"in d?d:d.capture)}static removeEventListener(e,s,u,d={}){e.removeEventListener(s,u,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",W.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",W.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",W.suppressClickInternal,!0)},0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,u){const d=s.boundingClientRect;return new h.P((u.clientX-d.left)/s.x-e.clientLeft,(u.clientY-d.top)/s.y-e.clientTop)}static mousePos(e,s){const u=W.getScale(e);return W.getPoint(e,u,s)}static touchPos(e,s){const u=[],d=W.getScale(e);for(let p=0;p<s.length;p++)u.push(W.getPoint(e,d,s[p]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}W.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,W.selectProp=W.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),W.transformProp=W.testProp(["transform","WebkitTransform"]);const $e={supported:!1,testSupport:function(m){!Qt&&Je&&(be?pe(m):He=m)}};let He,Je,Qt=!1,be=!1;function pe(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Je),m.isContextLost())return;$e.supported=!0}catch{}m.deleteTexture(e),Qt=!0}var ke;typeof document<"u"&&(Je=document.createElement("img"),Je.onload=()=>{He&&pe(He),He=null,be=!0},Je.onerror=()=>{Qt=!0,He=null},Je.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let e,s,u,d;m.resetRequestQueue=()=>{e=[],s=0,u=0,d={}},m.addThrottleControl=I=>{const M=u++;return d[M]=I,M},m.removeThrottleControl=I=>{delete d[I],S()},m.getImage=(I,M,L=!0)=>new Promise((R,V)=>{$e.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),h.e(I,{type:"image"}),e.push({abortController:M,requestParameters:I,supportImageRefresh:L,state:"queued",onError:Z=>{V(Z)},onSuccess:Z=>{R(Z)}}),S()});const p=I=>h._(this,void 0,void 0,function*(){I.state="running";const{requestParameters:M,supportImageRefresh:L,onError:R,onSuccess:V,abortController:Z}=I,X=L===!1&&!h.i(self)&&!h.g(M.url)&&(!M.headers||Object.keys(M.headers).reduce((oe,de)=>oe&&de==="accept",!0));s++;const re=X?T(M,Z):h.m(M,Z);try{const oe=yield re;delete I.abortController,I.state="completed",oe.data instanceof HTMLImageElement||h.b(oe.data)?V(oe):oe.data&&V({data:yield(ae=oe.data,typeof createImageBitmap=="function"?h.d(ae):h.f(ae)),cacheControl:oe.cacheControl,expires:oe.expires})}catch(oe){delete I.abortController,R(oe)}finally{s--,S()}var ae}),S=()=>{const I=(()=>{for(const M of Object.keys(d))if(d[M]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=s;M<I&&e.length>0;M++){const L=e.shift();L.abortController.signal.aborted?M--:p(L)}},T=(I,M)=>new Promise((L,R)=>{const V=new Image,Z=I.url,X=I.credentials;X&&X==="include"?V.crossOrigin="use-credentials":(X&&X==="same-origin"||!h.s(Z))&&(V.crossOrigin="anonymous"),M.signal.addEventListener("abort",()=>{V.src="",R(h.c())}),V.fetchPriority="high",V.onload=()=>{V.onerror=V.onload=null,L({data:V})},V.onerror=()=>{V.onerror=V.onload=null,M.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},V.src=Z})}(ke||(ke={})),ke.resetRequestQueue();class Ve{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function et(m){var e=new h.A(3);return e[0]=m[0],e[1]=m[1],e[2]=m[2],e}var ut,Qe=function(m,e,s){return m[0]=e[0]-s[0],m[1]=e[1]-s[1],m[2]=e[2]-s[2],m};ut=new h.A(3),h.A!=Float32Array&&(ut[0]=0,ut[1]=0,ut[2]=0);var ce=function(m){var e=m[0],s=m[1];return e*e+s*s};function me(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const s=[];for(const{id:u,url:d}of m){const p=`${u}${d}`;s.indexOf(p)===-1&&(s.push(p),e.push({id:u,url:d}))}}return e}function Le(m,e,s){const u=m.split("?");return u[0]+=`${e}${s}`,u.join("?")}(function(){var m=new h.A(2);h.A!=Float32Array&&(m[0]=0,m[1]=0)})();class Ye{constructor(e,s,u,d){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(s,d)}update(e,s,u){const{width:d,height:p}=e,S=!(this.size&&this.size[0]===d&&this.size[1]===p||u),{context:T}=this,{gl:I}=T;if(this.useMipmap=!!(s&&s.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!s||s.premultiply!==!1)),S)this.size=[d,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.b(e)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,e):I.texImage2D(I.TEXTURE_2D,0,this.format,d,p,0,this.format,I.UNSIGNED_BYTE,e.data);else{const{x:M,y:L}=u||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.b(e)?I.texSubImage2D(I.TEXTURE_2D,0,M,L,I.RGBA,I.UNSIGNED_BYTE,e):I.texSubImage2D(I.TEXTURE_2D,0,M,L,d,p,I.RGBA,I.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(e,s,u){const{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||e),this.filter=e),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Tt(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class Ot extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:u}of this.requestors)u(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const u=s.spriteData;s.data=new h.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let u=!0;const d=s.data||s.spriteData;return this._validateStretch(s.stretchX,d&&d.width)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,d&&d.height)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,s){if(!e)return!0;let u=0;for(const d of e){if(d[0]<u||d[1]<d[0]||s<d[1])return!1;u=d[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const u=s.spriteData,d=u&&u.width||s.data.width,p=u&&u.height||s.data.height;return!(e[0]<0||d<e[0]||e[1]<0||p<e[1]||e[2]<0||d<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,u=!0){const d=this.getImage(e);if(u&&(d.data.width!==s.data.width||d.data.height!==s.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=d.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((s,u)=>{let d=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(d=!1);this.isLoaded()||d?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})})}_getImagesForIds(e){const s={};for(const u of e){let d=this.getImage(u);d||(this.fire(new h.k("styleimagemissing",{id:u})),d=this.getImage(u)),d?s[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:h.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],u=this.getImage(e);if(!u)return null;if(s&&s.position.version===u.version)return s.position;if(s)s.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},p=new h.I(d,u);this.patterns[e]={bin:d,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ye(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:s,h:u}=h.p(e),d=this.atlasImage;d.resize({width:s||1,height:u||1});for(const p in this.patterns){const{bin:S}=this.patterns[p],T=S.x+1,I=S.y+1,M=this.getImage(p).data,L=M.width,R=M.height;h.R.copy(M,d,{x:0,y:0},{x:T,y:I},{width:L,height:R}),h.R.copy(M,d,{x:0,y:R-1},{x:T,y:I-1},{width:L,height:1}),h.R.copy(M,d,{x:0,y:0},{x:T,y:I+R},{width:L,height:1}),h.R.copy(M,d,{x:L-1,y:0},{x:T-1,y:I},{width:1,height:R}),h.R.copy(M,d,{x:0,y:0},{x:T+L,y:I},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const u=this.getImage(s);u||h.w(`Image with ID: "${s}" was not found`),Tt(u)&&this.updateImage(s,u)}}}const vr=1e20;function Kr(m,e,s,u,d,p,S,T,I){for(let M=e;M<e+u;M++)Hr(m,s*p+M,p,d,S,T,I);for(let M=s;M<s+d;M++)Hr(m,M*p+e,1,u,S,T,I)}function Hr(m,e,s,u,d,p,S){p[0]=0,S[0]=-vr,S[1]=vr,d[0]=m[e];for(let T=1,I=0,M=0;T<u;T++){d[T]=m[e+T*s];const L=T*T;do{const R=p[I];M=(d[T]-d[R]+L-R*R)/(T-R)/2}while(M<=S[I]&&--I>-1);I++,p[I]=T,S[I]=M,S[I+1]=vr}for(let T=0,I=0;T<u;T++){for(;S[I+1]<T;)I++;const M=p[I],L=T-M;m[e+T*s]=d[M]+L*L}}class nr{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return h._(this,void 0,void 0,function*(){const s=[];for(const p in e)for(const S of e[p])s.push(this._getAndCacheGlyphsPromise(p,S));const u=yield Promise.all(s),d={};for(const{stack:p,id:S,glyph:T}of u)d[p]||(d[p]={}),d[p][S]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return d})}_getAndCacheGlyphsPromise(e,s){return h._(this,void 0,void 0,function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=u.glyphs[s];if(d!==void 0)return{stack:e,id:s,glyph:d};if(d=this._tinySDF(u,e,s),d)return u.glyphs[s]=d,{stack:e,id:s,glyph:d};const p=Math.floor(s/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[p])return{stack:e,id:s,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[p]){const T=nr.loadGlyphRange(e,p,this.url,this.requestManager);u.requests[p]=T}const S=yield u.requests[p];for(const T in S)this._doesCharSupportLocalGlyph(+T)||(u.glyphs[+T]=S[+T]);return u.ranges[p]=!0,{stack:e,id:s,glyph:S[s]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(e))}_tinySDF(e,s,u){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let p=e.tinySDF;if(!p){let T="400";/bold/i.test(s)?T="900":/medium/i.test(s)?T="500":/light/i.test(s)&&(T="200"),p=e.tinySDF=new nr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:T})}const S=p.draw(String.fromCharCode(u));return{id:u,bitmap:new h.o({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}nr.loadGlyphRange=function(m,e,s,u){return h._(this,void 0,void 0,function*(){const d=256*e,p=d+255,S=u.transformRequest(s.replace("{fontstack}",m).replace("{range}",`${d}-${p}`),"Glyphs"),T=yield h.l(S,new AbortController);if(!T||!T.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${p}`);const I={};for(const M of h.n(T.data))I[M.id]=M;return I})},nr.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:s=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:p="normal",fontStyle:S="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=s;const T=this.size=m+4*e,I=this._createCanvas(T),M=this.ctx=I.getContext("2d",{willReadFrequently:!0});M.font=`${S} ${p} ${m}px ${d}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:p}=this.ctx.measureText(m),S=Math.ceil(s),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-d))),I=Math.min(this.size-this.buffer,S+Math.ceil(u)),M=T+2*this.buffer,L=I+2*this.buffer,R=Math.max(M*L,0),V=new Uint8ClampedArray(R),Z={data:V,width:M,height:L,glyphWidth:T,glyphHeight:I,glyphTop:S,glyphLeft:0,glyphAdvance:e};if(T===0||I===0)return Z;const{ctx:X,buffer:re,gridInner:ae,gridOuter:oe}=this;X.clearRect(re,re,T,I),X.fillText(m,re,re+S);const de=X.getImageData(re,re,T,I);oe.fill(vr,0,R),ae.fill(0,0,R);for(let Q=0;Q<I;Q++)for(let we=0;we<T;we++){const Ie=de.data[4*(Q*T+we)+3]/255;if(Ie===0)continue;const Re=(Q+re)*M+we+re;if(Ie===1)oe[Re]=0,ae[Re]=vr;else{const Xe=.5-Ie;oe[Re]=Xe>0?Xe*Xe:0,ae[Re]=Xe<0?Xe*Xe:0}}Kr(oe,0,0,M,L,M,this.f,this.v,this.z),Kr(ae,re,re,T,I,M,this.f,this.v,this.z);for(let Q=0;Q<R;Q++){const we=Math.sqrt(oe[Q])-Math.sqrt(ae[Q]);V[Q]=Math.round(255-255*(we/this.radius+this.cutoff))}return Z}};class Ke{constructor(){this.specification=h.v.light.position}possiblyEvaluate(e,s){return h.x(e.expression.evaluate(s))}interpolate(e,s,u){return{x:h.y.number(e.x,s.x,u),y:h.y.number(e.y,s.y,u),z:h.y.number(e.z,s.z,u)}}}let We;class gt extends h.E{constructor(e){super(),We=We||new h.q({anchor:new h.D(h.v.light.anchor),position:new Ke,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.T(We),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(h.r,e,s))for(const u in e){const d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,u){return(!u||u.validate!==!1)&&h.t(this,e.call(h.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.v}))}}const yt=new h.q({"sky-color":new h.D(h.v.sky["sky-color"]),"horizon-color":new h.D(h.v.sky["horizon-color"]),"fog-color":new h.D(h.v.sky["fog-color"]),"fog-ground-blend":new h.D(h.v.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.v.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.v.sky["atmosphere-blend"])});class Rt extends h.E{constructor(e){super(),this._transitionable=new h.T(yt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.z(0))}setSky(e,s={}){if(!this._validate(h.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,u={}){return u?.validate!==!1&&h.t(this,e.call(h.u,h.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class It{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const u=e.join(",")+String(s);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,s)),this.dashEntry[u]}getDashRanges(e,s,u){const d=[];let p=e.length%2==1?-e[e.length-1]*u:0,S=e[0]*u,T=!0;d.push({left:p,right:S,isDash:T,zeroLength:e[0]===0});let I=e[0];for(let M=1;M<e.length;M++){T=!T;const L=e[M];p=I*u,I+=L,S=I*u,d.push({left:p,right:S,isDash:T,zeroLength:L===0})}return d}addRoundDash(e,s,u){const d=s/2;for(let p=-u;p<=u;p++){const S=this.width*(this.nextRow+u+p);let T=0,I=e[T];for(let M=0;M<this.width;M++){M/I.right>1&&(I=e[++T]);const L=Math.abs(M-I.left),R=Math.abs(M-I.right),V=Math.min(L,R);let Z;const X=p/u*(d+1);if(I.isDash){const re=d-Math.abs(X);Z=Math.sqrt(V*V+re*re)}else Z=d-Math.sqrt(V*V+X*X);this.data[S+M]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(e){for(let T=e.length-1;T>=0;--T){const I=e[T],M=e[T+1];I.zeroLength?e.splice(T,1):M&&M.isDash===I.isDash&&(M.left=I.left,e.splice(T,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const d=this.width*this.nextRow;let p=0,S=e[p];for(let T=0;T<this.width;T++){T/S.right>1&&(S=e[++p]);const I=Math.abs(T-S.left),M=Math.abs(T-S.right),L=Math.min(I,M);this.data[d+T]=Math.max(0,Math.min(255,(S.isDash?L:-L)+128))}}addDash(e,s){const u=s?7:0,d=2*u+1;if(this.nextRow+d>this.height)return h.w("LineAtlas out of space"),null;let p=0;for(let T=0;T<e.length;T++)p+=e[T];if(p!==0){const T=this.width/p,I=this.getDashRanges(e,this.width,T);s?this.addRoundDash(I,T,u):this.addRegularDash(I)}const S={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:p};return this.nextRow+=d,this.dirty=!0,S}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Sr="maplibre_preloaded_worker_pool";class wr{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<wr.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Sr]}numActive(){return Object.keys(this.active).length}}const kr=Math.floor(Y.hardwareConcurrency/2);let zr,ur;function ct(){return zr||(zr=new wr),zr}wr.workerCount=h.C(globalThis)?Math.max(Math.min(kr,3),1):1;class Br{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const u=this.workerPool.acquire(s);for(let d=0;d<u.length;d++){const p=new h.F(u[d],s);p.name=`Worker ${d}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const u=[];for(const d of this.actors)u.push(d.sendAsync({type:e,data:s}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const u of this.actors)u.registerMessageHandler(e,s)}}function cr(){return ur||(ur=new Br(ct(),h.G),ur.registerMessageHandler("GR",(m,e,s)=>h.m(e,s))),ur}function Gt(m,e){const s=h.H();return h.J(s,s,[1,1,0]),h.K(s,s,[.5*m.width,.5*m.height,1]),h.L(s,s,m.calculatePosMatrix(e.toUnwrapped()))}function Nr(m,e,s,u,d,p){const S=function(R,V,Z){if(R)for(const X of R){const re=V[X];if(re&&re.source===Z&&re.type==="fill-extrusion")return!0}else for(const X in V){const re=V[X];if(re.source===Z&&re.type==="fill-extrusion")return!0}return!1}(d&&d.layers,e,m.id),T=p.maxPitchScaleFactor(),I=m.tilesIn(u,T,S);I.sort(Lr);const M=[];for(const R of I)M.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(e,s,m._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,d,p,T,Gt(m.transform,R.tileID))});const L=function(R){const V={},Z={};for(const X of R){const re=X.queryResults,ae=X.wrappedTileID,oe=Z[ae]=Z[ae]||{};for(const de in re){const Q=re[de],we=oe[de]=oe[de]||{},Ie=V[de]=V[de]||[];for(const Re of Q)we[Re.featureIndex]||(we[Re.featureIndex]=!0,Ie.push(Re))}}return V}(M);for(const R in L)L[R].forEach(V=>{const Z=V.feature,X=m.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=X});return L}function Lr(m,e){const s=m.tileID,u=e.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}function gr(m,e,s){return h._(this,void 0,void 0,function*(){let u=m;if(m.url?u=(yield h.h(e.transformRequest(m.url,"Source"),s)).data:yield Y.frameAsync(s),!u)return null;const d=h.M(h.e(u,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(d.vectorLayerIds=u.vector_layers.map(p=>p.id)),d})}class Te{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof h.N?new h.N(e.lng,e.lat):h.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof h.N?new h.N(e.lng,e.lat):h.N.convert(e),this}extend(e){const s=this._sw,u=this._ne;let d,p;if(e instanceof h.N)d=e,p=e;else{if(!(e instanceof Te))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Te.convert(e)):this.extend(h.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(h.N.convert(e)):this;if(d=e._sw,p=e._ne,!d||!p)return this}return s||u?(s.lng=Math.min(d.lng,s.lng),s.lat=Math.min(d.lat,s.lat),u.lng=Math.max(p.lng,u.lng),u.lat=Math.max(p.lat,u.lat)):(this._sw=new h.N(d.lng,d.lat),this._ne=new h.N(p.lng,p.lat)),this}getCenter(){return new h.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.N(this.getWest(),this.getNorth())}getSouthEast(){return new h.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:u}=h.N.convert(e);let d=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(e){return e instanceof Te?e:e&&new Te(e)}static fromLngLat(e,s=0){const u=360*s/40075017,d=u/Math.cos(Math.PI/180*e.lat);return new Te(new h.N(e.lng-d,e.lat-u),new h.N(e.lng+d,e.lat+u))}adjustAntiMeridian(){const e=new h.N(this._sw.lng,this._sw.lat),s=new h.N(this._ne.lng,this._ne.lat);return new Te(e,e.lng>s.lng?new h.N(s.lng+360,s.lat):s)}}class nn{constructor(e,s,u){this.bounds=Te.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),u=Math.floor(h.O(this.bounds.getWest())*s),d=Math.floor(h.Q(this.bounds.getNorth())*s),p=Math.ceil(h.O(this.bounds.getEast())*s),S=Math.ceil(h.Q(this.bounds.getSouth())*s);return e.x>=u&&e.x<p&&e.y>=d&&e.y<S}}class Tr extends h.E{constructor(e,s,u,d){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.M(s,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield gr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(h.e(this,e),e.bounds&&(this.tileBounds=new nn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new h.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(e){return h._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((p,S)=>{e.reloadPromise={resolve:p,reject:S}})}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:d,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return h._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return h._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Wt extends h.E{constructor(e,s,u,d){super(),this.id=e,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},s),h.e(this,h.M(s,["url","scheme","tileSize"]))}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield gr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(h.e(this,e),e.bounds&&(this.tileBounds=new nn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new h.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return h.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return h._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield ke.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const d=this.map.painter.context,p=d.gl,S=u.data;e.texture=this.map.painter.getTileTexture(S.width),e.texture?e.texture.update(S,{useMipmap:!0}):(e.texture=new Ye(d,S,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}abortTile(e){return h._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return h._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class dr extends Wt{constructor(e,s,u,d){super(e,s,u,d),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return h._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const d=yield ke.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){const p=d.data;this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const S=h.b(p)&&h.U()?p:yield this.readImageNow(p),T={type:this.type,uid:e.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const I=yield e.actor.sendAsync({type:"LDT",data:T});e.dem=I,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}})}readImageNow(e){return h._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&h.V()){const s=e.width+2,u=e.height+2;try{return new h.R({width:s,height:u},yield h.W(e,-1,-1,s,u))}catch{}}return Y.getImageData(e,1)})}_getNeighboringTiles(e){const s=e.canonical,u=Math.pow(2,s.z),d=(s.x-1+u)%u,p=s.x===0?e.wrap-1:e.wrap,S=(s.x+1+u)%u,T=s.x+1===u?e.wrap+1:e.wrap,I={};return I[new h.S(e.overscaledZ,p,s.z,d,s.y).key]={backfilled:!1},I[new h.S(e.overscaledZ,T,s.z,S,s.y).key]={backfilled:!1},s.y>0&&(I[new h.S(e.overscaledZ,p,s.z,d,s.y-1).key]={backfilled:!1},I[new h.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},I[new h.S(e.overscaledZ,T,s.z,S,s.y-1).key]={backfilled:!1}),s.y+1<u&&(I[new h.S(e.overscaledZ,p,s.z,d,s.y+1).key]={backfilled:!1},I[new h.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},I[new h.S(e.overscaledZ,T,s.z,S,s.y+1).key]={backfilled:!1}),I}unloadTile(e){return h._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class _n extends h.E{constructor(e,s,u,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(d),this._data=s.data,this._options=h.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const p=h.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*p,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*p,extent:h.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:h.X,radius:(s.clusterRadius||50)*p,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return h._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return h._(this,void 0,void 0,function*(){const e=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:u}})}_updateWorkerData(e){return h._(this,void 0,void 0,function*(){const s=h.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(Y.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new h.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new h.k("dataabort",{dataType:"source"}));let d=null;u.resourceTiming&&u.resourceTiming[this.id]&&(d=u.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&h.e(p,{resourceTiming:d}),this.fire(new h.k("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new h.k("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new h.k("dataabort",{dataType:"source"}));this.fire(new h.j(u))}})}loaded(){return this._pendingLoads===0}loadTile(e){return h._(this,void 0,void 0,function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const d=yield this.actor.sendAsync({type:s,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,s==="RT")})}abortTile(e){return h._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return h._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Sn=h.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class An extends h.E{constructor(e,s,u,d){super(),this.id=e,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=s}load(e){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield ke.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new h.j(s))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(h.Z.fromLngLat);this.tileID=function(d){let p=1/0,S=1/0,T=-1/0,I=-1/0;for(const V of d)p=Math.min(p,V.x),S=Math.min(S,V.y),T=Math.max(T,V.x),I=Math.max(I,V.y);const M=Math.max(T-p,I-S),L=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),R=Math.pow(2,L);return new h.a1(L,Math.floor((p+T)/2*R),Math.floor((S+I)/2*R))}(s),this.minzoom=this.maxzoom=this.tileID.z;const u=s.map(d=>this.tileID.getTilePoint(d)._round());return this._boundsArray=new h.$,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,h.X,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,h.X),this._boundsArray.emplaceBack(u[2].x,u[2].y,h.X,h.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Sn.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ye(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const p=this.tiles[d];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,u=!0)}u&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return h._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class an extends An{constructor(e,s,u,d){super(e,s,u,d),this.roundZoom=!0,this.type="video",this.options=s}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield h.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new h.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new h.j(new h.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Sn.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new Ye(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const p=this.tiles[d];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,u=!0)}u&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Zr extends An{constructor(e,s,u,d){super(e,s,u,d),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(S=>typeof S!="number"))||this.fire(new h.j(new h.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.j(new h.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new h.j(new h.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new h.j(new h.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.j(new h.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return h._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,u=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Sn.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ye(s,this.canvas,u.RGBA,{premultiply:!0});let d=!1;for(const p in this.tiles){const S=this.tiles[p];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,d=!0)}d&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Vr={},Yr=m=>{switch(m){case"geojson":return _n;case"image":return An;case"raster":return Wt;case"raster-dem":return dr;case"vector":return Tr;case"video":return an;case"canvas":return Zr}return Vr[m]},rt="RTLPluginLoaded";class Fn extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=cr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return h._(this,arguments,void 0,function*(s,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Y.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return h._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.k(rt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let kn=null;function Cn(){return kn||(kn=new Fn),kn}class en{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=h.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(d,p){const S={};if(!p)return S;for(const T of d){const I=T.layerIds.map(M=>p.getLayer(M)).filter(Boolean);if(I.length!==0){T.layers=I,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(M=>I.filter(L=>L.id===M)[0]));for(const M of I)S[M.id]=T}}return S}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const p=this.buckets[d];if(p instanceof h.a6){if(this.hasSymbolBuckets=!0,!u)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const p=this.buckets[d];if(p instanceof h.a6&&p.hasRTLText){this.hasRTLText=!0,Cn().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const p=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(d).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new h.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ye(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ye(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,u,d,p,S,T,I,M,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:p,scale:S,tileSize:this.tileSize,pixelPosMatrix:L,transform:I,params:T,queryPadding:this.queryPadding*M},e,s,u):{}}querySourceFeatures(e,s){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),p=s&&s.sourceLayer?s.sourceLayer:"",S=d._geojsonTileLayer||d[p];if(!S)return;const T=h.a7(s&&s.filter),{z:I,x:M,y:L}=this.tileID.canonical,R={z:I,x:M,y:L};for(let V=0;V<S.length;V++){const Z=S.feature(V);if(T.needGeometry){const ae=h.a8(Z,!0);if(!T.filter(new h.z(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!T.filter(new h.z(this.tileID.overscaledZ),Z))continue;const X=u.getId(Z,p),re=new h.a9(Z,I,M,L,X);re.tile=R,e.push(re)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const u=h.aa(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(s)if(this.expirationTime<s)d=!0;else{const p=this.expirationTime-s;p?this.expirationTime=u+Math.max(p,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!s.style.hasLayer(d))continue;const p=this.buckets[d],S=p.layers[0].sourceLayer||"_geojsonTileLayer",T=u[S],I=e[S];if(!T||!I||Object.keys(I).length===0)continue;p.update(I,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=s&&s.style&&s.style.getLayer(d);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Y.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Y.now()+e}setDependencies(e,s){const u={};for(const d of s)u[d]=!0;this.dependencies[e]=u}hasDependency(e,s){for(const u of e){const d=this.dependencies[u];if(d){for(const p of s)if(d[p])return!0}}return!1}}class at{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,u){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const p={value:s,timeout:void 0};if(u!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},u)),this.data[d].push(p),this.order.push(d),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const u=e.wrapped().key,d=s===void 0?0:this.data[u].indexOf(s),p=this.data[u][d];return this.data[u].splice(d,1),p.timeout&&clearTimeout(p.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(p.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const u in this.data)for(const d of this.data[u])e(d.value)||s.push(d);for(const u of s)this.remove(u.value.tileID,u)}}class lr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,u){const d=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},h.e(this.stateChanges[e][d],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==d&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const p in this.state[e][d])u[p]||(this.deletedStates[e][d][p]=null)}else for(const p in u)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][p]===null&&delete this.deletedStates[e][d][p]}removeFeatureState(e,s,u){if(this.deletedStates[e]===null)return;const d=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&s!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][u]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(u in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][u]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,s){const u=String(s),d=h.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][s];if(p===null)return{};for(const S in p)delete d[S]}return d}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const p={};for(const S in this.stateChanges[d])this.state[d][S]||(this.state[d][S]={}),h.e(this.state[d][S],this.stateChanges[d][S]),p[S]=this.state[d][S];u[d]=p}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const p={};if(this.deletedStates[d]===null)for(const S in this.state[d])p[S]={},this.state[d][S]={};else for(const S in this.deletedStates[d]){if(this.deletedStates[d][S]===null)this.state[d][S]={};else for(const T of Object.keys(this.deletedStates[d][S]))delete this.state[d][S][T];p[S]=this.state[d][S]}u[d]=u[d]||{},h.e(u[d],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const d in e)e[d].setFeatureState(u,s)}}class Ht extends h.E{constructor(e,s,u){super(),this.id=e,this.dispatcher=u,this.on("data",d=>this._dataHandler(d)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,p,S,T)=>{const I=new(Yr(p.type))(d,p,S,T);if(I.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${I.id}`);return I})(e,s,u,this),this._tiles={},this._cache=new at(0,d=>this._unloadTile(d)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new lr,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,u){return h._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,u)}catch(d){e.state="errored",d.status!==404?this._source.fire(new h.j(d,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new h.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const u=this._tiles[s];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(zt).map(e=>e.key)}getRenderableIds(e){const s=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&s.push(this._tiles[u]);return e?s.sort((u,d)=>{const p=u.tileID,S=d.tileID,T=new h.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),I=new h.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-S.overscaledZ||I.y-T.y||I.x-T.x}).map(u=>u.tileID.key):s.map(u=>u.tileID).sort(zt).map(u=>u.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return h._(this,void 0,void 0,function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=s),yield this._loadTile(u,e,s))})}_tileLoaded(e,s,u){e.timeAdded=Y.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new h.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let d=0;d<s.length;d++){const p=s[d];if(e.neighboringTiles&&e.neighboringTiles[p]){const S=this.getTileByID(p);u(e,S),u(S,e)}}function u(d,p){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let S=p.tileID.canonical.x-d.tileID.canonical.x;const T=p.tileID.canonical.y-d.tileID.canonical.y,I=Math.pow(2,d.tileID.canonical.z),M=p.tileID.key;S===0&&T===0||Math.abs(T)>1||(Math.abs(S)>1&&(Math.abs(S+I)===1?S+=I:Math.abs(S-I)===1&&(S-=I)),p.dem&&d.dem&&(d.dem.backfillBorder(p.dem,S,T),d.neighboringTiles&&d.neighboringTiles[M]&&(d.neighboringTiles[M].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,u,d){for(const p in this._tiles){let S=this._tiles[p];if(d[p]||!S.hasData()||S.tileID.overscaledZ<=s||S.tileID.overscaledZ>u)continue;let T=S.tileID;for(;S&&S.tileID.overscaledZ>s+1;){const M=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[M.key],S&&S.hasData()&&(T=M)}let I=T;for(;I.overscaledZ>s;)if(I=I.scaledTo(I.overscaledZ-1),e[I.key]){d[T.key]=T;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=s?u:null}for(let u=e.overscaledZ-1;u>=s;u--){const d=e.scaledTo(u),p=this._getLoadedTile(d);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(s*u*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(p)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const u={};for(const d in this._tiles){const p=this._tiles[d];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),u[p.tileID.key]=p}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}_updateCoveredAndRetainedTiles(e,s,u,d,p,S){const T={},I={},M=Object.keys(e),L=Y.now();for(const R of M){const V=e[R],Z=this._tiles[R];if(!Z||Z.fadeEndTime!==0&&Z.fadeEndTime<=L)continue;const X=this.findLoadedParent(V,s),re=this.findLoadedSibling(V),ae=X||re||null;ae&&(this._addTile(ae.tileID),T[ae.tileID.key]=ae.tileID),I[R]=V}this._retainLoadedChildren(I,d,u,e);for(const R in T)e[R]||(this._coveredTiles[R]=!0,e[R]=T[R]);if(S){const R={},V={};for(const Z of p)this._tiles[Z.key].hasData()?R[Z.key]=Z:V[Z.key]=Z;for(const Z in V){const X=V[Z].children(this._source.maxzoom);this._tiles[X[0].key]&&this._tiles[X[1].key]&&this._tiles[X[2].key]&&this._tiles[X[3].key]&&(R[X[0].key]=e[X[0].key]=X[0],R[X[1].key]=e[X[1].key]=X[1],R[X[2].key]=e[X[2].key]=X[2],R[X[3].key]=e[X[3].key]=X[3],delete V[Z])}for(const Z in V){const X=V[Z],re=this.findLoadedParent(X,this._source.minzoom),ae=this.findLoadedSibling(X),oe=re||ae||null;if(oe){R[oe.tileID.key]=e[oe.tileID.key]=oe.tileID;for(const de in R)R[de].isChildOf(oe.tileID)&&delete R[de]}}for(const Z in this._tiles)R[Z]||(this._coveredTiles[Z]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new h.S(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y)):(u=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(u=u.filter(L=>this._source.hasTile(L)))):u=[];const d=e.coveringZoomLevel(this._source),p=Math.max(d-Ht.maxOverzooming,this._source.minzoom),S=Math.max(d+Ht.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const L={};for(const R of u)if(R.canonical.z>this._source.minzoom){const V=R.scaledTo(R.canonical.z-1);L[V.key]=V;const Z=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));L[Z.key]=Z}u=u.concat(Object.values(L))}const T=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,T&&this.fire(new h.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=this._updateRetainedTiles(u,d);ti(this._source.type)&&this._updateCoveredAndRetainedTiles(I,p,S,d,u,s);for(const L in I)this._tiles[L].clearFadeHold();const M=h.ab(this._tiles,I);for(const L of M){const R=this._tiles[L];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(L)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var u;const d={},p={},S=Math.max(s-Ht.maxOverzooming,this._source.minzoom),T=Math.max(s+Ht.maxUnderzooming,this._source.minzoom),I={};for(const M of e){const L=this._addTile(M);d[M.key]=M,L.hasData()||s<this._source.maxzoom&&(I[M.key]=M)}this._retainLoadedChildren(I,s,T,d);for(const M of e){let L=this._tiles[M.key];if(L.hasData())continue;if(s+1>this._source.maxzoom){const V=M.children(this._source.maxzoom)[0],Z=this.getTile(V);if(Z&&Z.hasData()){d[V.key]=V;continue}}else{const V=M.children(this._source.maxzoom);if(d[V[0].key]&&d[V[1].key]&&d[V[2].key]&&d[V[3].key])continue}let R=L.wasRequested();for(let V=M.overscaledZ-1;V>=S;--V){const Z=M.scaledTo(V);if(p[Z.key])break;if(p[Z.key]=!0,L=this.getTile(Z),!L&&R&&(L=this._addTile(Z)),L){const X=L.hasData();if((X||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||R)&&(d[Z.key]=Z),R=L.wasRequested(),X)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let u,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}s.push(d.key);const p=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(p),u)break;d=p}for(const p of s)this._loadedParentTiles[p]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,u=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=u}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const u=s;return s||(s=new en(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,u||this._source.fire(new h.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=s.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,u){const d=[],p=this.transform;if(!p)return d;const S=u?p.getCameraQueryGeometry(e):e,T=e.map(X=>p.pointCoordinate(X,this.terrain)),I=S.map(X=>p.pointCoordinate(X,this.terrain)),M=this.getIds();let L=1/0,R=1/0,V=-1/0,Z=-1/0;for(const X of I)L=Math.min(L,X.x),R=Math.min(R,X.y),V=Math.max(V,X.x),Z=Math.max(Z,X.y);for(let X=0;X<M.length;X++){const re=this._tiles[M[X]];if(re.holdingForFade())continue;const ae=re.tileID,oe=Math.pow(2,p.zoom-re.tileID.overscaledZ),de=s*re.queryPadding*h.X/re.tileSize/oe,Q=[ae.getTilePoint(new h.Z(L,R)),ae.getTilePoint(new h.Z(V,Z))];if(Q[0].x-de<h.X&&Q[0].y-de<h.X&&Q[1].x+de>=0&&Q[1].y+de>=0){const we=T.map(Re=>ae.getTilePoint(Re)),Ie=I.map(Re=>ae.getTilePoint(Re));d.push({tile:re,tileID:ae,queryGeometry:we,cameraQueryGeometry:Ie,scale:oe})}}return d}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(const u of s)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(ti(this._source.type)){const e=Y.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,u){this._state.updateState(e=e||"_geojsonTileLayer",s,u)}removeFeatureState(e,s,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,u)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,u){const d=this._tiles[e];d&&d.setDependencies(s,u)}reloadTilesForDependencies(e,s){for(const u in this._tiles)this._tiles[u].hasDependency(e,s)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,s))}}function zt(m,e){const s=Math.abs(2*m.wrap)-+(m.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||u-s||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function ti(m){return m==="raster"||m==="image"||m==="video"}Ht.maxOverzooming=10,Ht.maxUnderzooming=3;class er{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=h.ac(e,0,1);let s=1,u=this._distances[s];const d=e*this.paddedLength+this.padding;for(;u<d&&s<this._distances.length;)u=this._distances[++s];const p=s-1,S=this._distances[p],T=u-S,I=T>0?(d-S)/T:0;return this.points[p].mult(1-I).add(this.points[s].mult(I))}}function bi(m,e){let s=!0;return m==="always"||m!=="never"&&e!=="never"||(s=!1),s}class wt{constructor(e,s,u){const d=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(s/u);for(let S=0;S<this.xCellCount*this.yCellCount;S++)d.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,u,d,p){this._forEachCell(s,u,d,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(p)}insertCircle(e,s,u,d){this._forEachCell(s-d,u-d,s+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(u),this.circles.push(d)}_insertBoxCell(e,s,u,d,p,S){this.boxCells[p].push(S)}_insertCircleCell(e,s,u,d,p,S){this.circleCells[p].push(S)}_query(e,s,u,d,p,S,T){if(u<0||e>this.width||d<0||s>this.height)return[];const I=[];if(e<=0&&s<=0&&this.width<=u&&this.height<=d){if(p)return[{key:null,x1:e,y1:s,x2:u,y2:d}];for(let M=0;M<this.boxKeys.length;M++)I.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const L=this.circles[3*M],R=this.circles[3*M+1],V=this.circles[3*M+2];I.push({key:this.circleKeys[M],x1:L-V,y1:R-V,x2:L+V,y2:R+V})}}else this._forEachCell(e,s,u,d,this._queryCell,I,{hitTest:p,overlapMode:S,seenUids:{box:{},circle:{}}},T);return I}query(e,s,u,d){return this._query(e,s,u,d,!1,null)}hitTest(e,s,u,d,p,S){return this._query(e,s,u,d,!0,p,S).length>0}hitTestCircle(e,s,u,d,p){const S=e-u,T=e+u,I=s-u,M=s+u;if(T<0||S>this.width||M<0||I>this.height)return!1;const L=[];return this._forEachCell(S,I,T,M,this._queryCellCircle,L,{hitTest:!0,overlapMode:d,circle:{x:e,y:s,radius:u},seenUids:{box:{},circle:{}}},p),L.length>0}_queryCell(e,s,u,d,p,S,T,I){const{seenUids:M,hitTest:L,overlapMode:R}=T,V=this.boxCells[p];if(V!==null){const X=this.bboxes;for(const re of V)if(!M.box[re]){M.box[re]=!0;const ae=4*re,oe=this.boxKeys[re];if(e<=X[ae+2]&&s<=X[ae+3]&&u>=X[ae+0]&&d>=X[ae+1]&&(!I||I(oe))&&(!L||!bi(R,oe.overlapMode))&&(S.push({key:oe,x1:X[ae],y1:X[ae+1],x2:X[ae+2],y2:X[ae+3]}),L))return!0}}const Z=this.circleCells[p];if(Z!==null){const X=this.circles;for(const re of Z)if(!M.circle[re]){M.circle[re]=!0;const ae=3*re,oe=this.circleKeys[re];if(this._circleAndRectCollide(X[ae],X[ae+1],X[ae+2],e,s,u,d)&&(!I||I(oe))&&(!L||!bi(R,oe.overlapMode))){const de=X[ae],Q=X[ae+1],we=X[ae+2];if(S.push({key:oe,x1:de-we,y1:Q-we,x2:de+we,y2:Q+we}),L)return!0}}}return!1}_queryCellCircle(e,s,u,d,p,S,T,I){const{circle:M,seenUids:L,overlapMode:R}=T,V=this.boxCells[p];if(V!==null){const X=this.bboxes;for(const re of V)if(!L.box[re]){L.box[re]=!0;const ae=4*re,oe=this.boxKeys[re];if(this._circleAndRectCollide(M.x,M.y,M.radius,X[ae+0],X[ae+1],X[ae+2],X[ae+3])&&(!I||I(oe))&&!bi(R,oe.overlapMode))return S.push(!0),!0}}const Z=this.circleCells[p];if(Z!==null){const X=this.circles;for(const re of Z)if(!L.circle[re]){L.circle[re]=!0;const ae=3*re,oe=this.circleKeys[re];if(this._circlesCollide(X[ae],X[ae+1],X[ae+2],M.x,M.y,M.radius)&&(!I||I(oe))&&!bi(R,oe.overlapMode))return S.push(!0),!0}}}_forEachCell(e,s,u,d,p,S,T,I){const M=this._convertToXCellCoord(e),L=this._convertToYCellCoord(s),R=this._convertToXCellCoord(u),V=this._convertToYCellCoord(d);for(let Z=M;Z<=R;Z++)for(let X=L;X<=V;X++)if(p.call(this,e,s,u,d,this.xCellCount*X+Z,S,T,I))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,u,d,p,S){const T=d-e,I=p-s,M=u+S;return M*M>T*T+I*I}_circleAndRectCollide(e,s,u,d,p,S,T){const I=(S-d)/2,M=Math.abs(e-(d+I));if(M>I+u)return!1;const L=(T-p)/2,R=Math.abs(s-(p+L));if(R>L+u)return!1;if(M<=I||R<=L)return!0;const V=M-I,Z=R-L;return V*V+Z*Z<=u*u}}function ca(m,e,s,u,d){const p=h.H();return e?(h.K(p,p,[1/d,1/d,1]),s||h.ad(p,p,u.angle)):h.L(p,u.labelPlaneMatrix,m),p}function Xi(m,e,s,u,d){if(e){const p=h.ae(m);return h.K(p,p,[d,d,1]),s||h.ad(p,p,-u.angle),p}return u.glCoordMatrix}function ne(m,e,s,u){let d;u?(d=[m,e,u(m,e),1],h.af(d,d,s)):(d=[m,e,0,1],Er(d,d,s));const p=d[3];return{point:new h.P(d[0]/p,d[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function N(m,e){return .5+m/e*.5}function B(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function H(m,e,s,u,d,p,S,T,I,M,L,R,V,Z,X){const re=u?m.textSizeData:m.iconSizeData,ae=h.ag(re,s.transform.zoom),oe=[256/s.width*2+1,256/s.height*2+1],de=u?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;de.clear();const Q=m.lineVertexArray,we=u?m.text.placedSymbolArray:m.icon.placedSymbolArray,Ie=s.transform.width/s.transform.height;let Re=!1;for(let Xe=0;Xe<we.length;Xe++){const st=we.get(Xe);if(st.hidden||st.writingMode===h.ah.vertical&&!Re){$t(st.numGlyphs,de);continue}Re=!1;const xt=ne(st.anchorX,st.anchorY,e,X);if(!B(xt.point,oe)){$t(st.numGlyphs,de);continue}const Et=N(s.transform.cameraToCenterDistance,xt.signedDistanceFromCamera),mt=h.ai(re,ae,st),pt=S?mt/Et:mt*Et,Nt={getElevation:X,labelPlaneMatrix:d,lineVertexArray:Q,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:M,tileAnchorPoint:new h.P(st.anchorX,st.anchorY),unwrappedTileID:L,width:R,height:V,translation:Z},or=_e(Nt,st,pt,!1,T,e,p,m.glyphOffsetArray,de,Ie,I);Re=or.useVertical,(or.notEnoughRoom||Re||or.needsFlipping&&_e(Nt,st,pt,!0,T,e,p,m.glyphOffsetArray,de,Ie,I).notEnoughRoom)&&$t(st.numGlyphs,de)}u?m.text.dynamicLayoutVertexBuffer.updateData(de):m.icon.dynamicLayoutVertexBuffer.updateData(de)}function ee(m,e,s,u,d,p,S,T){const I=p.glyphStartIndex+p.numGlyphs,M=p.lineStartIndex,L=p.lineStartIndex+p.lineLength,R=e.getoffsetX(p.glyphStartIndex),V=e.getoffsetX(I-1),Z=ot(m*R,s,u,d,p.segment,M,L,T,S);if(!Z)return null;const X=ot(m*V,s,u,d,p.segment,M,L,T,S);return X?T.projectionCache.anyProjectionOccluded?null:{first:Z,last:X}:null}function fe(m,e,s,u){return m===h.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*u?{useVertical:!0}:(m===h.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function _e(m,e,s,u,d,p,S,T,I,M,L){const R=s/24,V=e.lineOffsetX*R,Z=e.lineOffsetY*R;let X;if(e.numGlyphs>1){const re=e.glyphStartIndex+e.numGlyphs,ae=e.lineStartIndex,oe=e.lineStartIndex+e.lineLength,de=ee(R,T,V,Z,u,e,L,m);if(!de)return{notEnoughRoom:!0};const Q=ne(de.first.point.x,de.first.point.y,S,m.getElevation).point,we=ne(de.last.point.x,de.last.point.y,S,m.getElevation).point;if(d&&!u){const Ie=fe(e.writingMode,Q,we,M);if(Ie)return Ie}X=[de.first];for(let Ie=e.glyphStartIndex+1;Ie<re-1;Ie++)X.push(ot(R*T.getoffsetX(Ie),V,Z,u,e.segment,ae,oe,m,L));X.push(de.last)}else{if(d&&!u){const ae=ne(m.tileAnchorPoint.x,m.tileAnchorPoint.y,p,m.getElevation).point,oe=e.lineStartIndex+e.segment+1,de=new h.P(m.lineVertexArray.getx(oe),m.lineVertexArray.gety(oe)),Q=ne(de.x,de.y,p,m.getElevation),we=Q.signedDistanceFromCamera>0?Q.point:function(Re,Xe,st,xt,Et,mt){return Ae(Re,Xe,st,1,Et,mt)}(m.tileAnchorPoint,de,ae,0,p,m),Ie=fe(e.writingMode,ae,we,M);if(Ie)return Ie}const re=ot(R*T.getoffsetX(e.glyphStartIndex),V,Z,u,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,m,L);if(!re||m.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};X=[re]}for(const re of X)h.aj(I,re.point,re.angle);return{}}function Ae(m,e,s,u,d,p){const S=m.add(m.sub(e)._unit()),T=d!==void 0?ne(S.x,S.y,d,p.getElevation).point:Oe(S.x,S.y,p).point,I=s.sub(T);return s.add(I._mult(u/I.mag()))}function ue(m,e,s){const u=e.projectionCache;if(u.projections[m])return u.projections[m];const d=new h.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),p=Oe(d.x,d.y,e);if(p.signedDistanceFromCamera>0)return u.projections[m]=p.point,u.anyProjectionOccluded=u.anyProjectionOccluded||p.isOccluded,p.point;const S=m-s.direction;return function(T,I,M,L,R){return Ae(T,I,M,L,void 0,R)}(s.distanceFromAnchor===0?e.tileAnchorPoint:new h.P(e.lineVertexArray.getx(S),e.lineVertexArray.gety(S)),d,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function Oe(m,e,s){const u=m+s.translation[0],d=e+s.translation[1];let p;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(p=s.projection.projectTileCoordinates(u,d,s.unwrappedTileID,s.getElevation),p.point.x=(.5*p.point.x+.5)*s.width,p.point.y=(.5*-p.point.y+.5)*s.height):(p=ne(u,d,s.labelPlaneMatrix,s.getElevation),p.isOccluded=!1),p}function qe(m,e,s){return m._unit()._perp()._mult(e*s)}function Be(m,e,s,u,d,p,S,T,I){if(T.projectionCache.offsets[m])return T.projectionCache.offsets[m];const M=s.add(e);if(m+I.direction<u||m+I.direction>=d)return T.projectionCache.offsets[m]=M,M;const L=ue(m+I.direction,T,I),R=qe(L.sub(s),S,I.direction),V=s.add(R),Z=L.add(R);return T.projectionCache.offsets[m]=h.ak(p,M,V,Z)||M,T.projectionCache.offsets[m]}function ot(m,e,s,u,d,p,S,T,I){const M=u?m-e:m+e;let L=M>0?1:-1,R=0;u&&(L*=-1,R=Math.PI),L<0&&(R+=Math.PI);let V,Z=L>0?p+d:p+d+1;T.projectionCache.cachedAnchorPoint?V=T.projectionCache.cachedAnchorPoint:(V=Oe(T.tileAnchorPoint.x,T.tileAnchorPoint.y,T).point,T.projectionCache.cachedAnchorPoint=V);let X,re,ae=V,oe=V,de=0,Q=0;const we=Math.abs(M),Ie=[];let Re;for(;de+Q<=we;){if(Z+=L,Z<p||Z>=S)return null;de+=Q,oe=ae,re=X;const xt={absOffsetX:we,direction:L,distanceFromAnchor:de,previousVertex:oe};if(ae=ue(Z,T,xt),s===0)Ie.push(oe),Re=ae.sub(oe);else{let Et;const mt=ae.sub(oe);Et=mt.mag()===0?qe(ue(Z+L,T,xt).sub(ae),s,L):qe(mt,s,L),re||(re=oe.add(Et)),X=Be(Z,Et,ae,p,S,re,s,T,xt),Ie.push(re),Re=X.sub(re)}Q=Re.mag()}const Xe=Re._mult((we-de)/Q)._add(re||oe),st=R+Math.atan2(ae.y-oe.y,ae.x-oe.x);return Ie.push(Xe),{point:Xe,angle:I?st:0,path:Ie}}const Ft=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function $t(m,e){for(let s=0;s<m;s++){const u=e.length;e.resize(u+4),e.float32.set(Ft,3*u)}}function Er(m,e,s){const u=e[0],d=e[1];return m[0]=s[0]*u+s[4]*d+s[12],m[1]=s[1]*u+s[5]*d+s[13],m[3]=s[3]*u+s[7]*d+s[15],m}const tr=100;class xr{constructor(e,s,u=new wt(e.width+200,e.height+200,25),d=new wt(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=u,this.ignoredGrid=d,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+tr,this.screenBottomBoundary=e.height+tr,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,u,d,p,S,T,I,M,L,R){const V=e.anchorPointX+I[0],Z=e.anchorPointY+I[1],X=this.projectAndGetPerspectiveRatio(d,V,Z,p,L),re=u*X.perspectiveRatio;let ae;if(S||T)ae=this._projectCollisionBox(e,re,d,p,S,T,I,X,L,R);else{const Ie=X.point.x+(R?R.x*re:0),Re=X.point.y+(R?R.y*re:0);ae={allPointsOccluded:!1,box:[Ie+e.x1*re,Re+e.y1*re,Ie+e.x2*re,Re+e.y2*re]}}const[oe,de,Q,we]=ae.box;return this.mapProjection.useSpecialProjectionForSymbols&&(S?ae.allPointsOccluded:this.mapProjection.isOccluded(V,Z,p))||X.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(oe,de,Q,we)||s!=="always"&&this.grid.hitTest(oe,de,Q,we,s,M)?{box:[oe,de,Q,we],placeable:!1,offscreen:!1}:{box:[oe,de,Q,we],placeable:!0,offscreen:this.isOffscreen(oe,de,Q,we)}}placeCollisionCircles(e,s,u,d,p,S,T,I,M,L,R,V,Z,X,re,ae){const oe=[],de=new h.P(s.anchorX,s.anchorY),Q=this.getPerspectiveRatio(S,de.x,de.y,T,ae),we=(R?p/Q:p*Q)/h.ap,Ie={getElevation:ae,labelPlaneMatrix:I,lineVertexArray:u,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:de,unwrappedTileID:T,width:this.transform.width,height:this.transform.height,translation:re},Re=ee(we,d,s.lineOffsetX*we,s.lineOffsetY*we,!1,s,!1,Ie);let Xe=!1,st=!1,xt=!0;if(Re){const Et=.5*Z*Q+X,mt=new h.P(-100,-100),pt=new h.P(this.screenRightBoundary,this.screenBottomBoundary),Nt=new er,or=Re.first,_t=Re.last;let Ct=[];for(let mr=or.path.length-1;mr>=1;mr--)Ct.push(or.path[mr]);for(let mr=1;mr<_t.path.length;mr++)Ct.push(_t.path[mr]);const ir=2.5*Et;if(M){const mr=this.projectPathToScreenSpace(Ct,Ie,M);Ct=mr.some(Cr=>Cr.signedDistanceFromCamera<=0)?[]:mr.map(Cr=>Cr.point)}let ln=[];if(Ct.length>0){const mr=Ct[0].clone(),Cr=Ct[0].clone();for(let un=1;un<Ct.length;un++)mr.x=Math.min(mr.x,Ct[un].x),mr.y=Math.min(mr.y,Ct[un].y),Cr.x=Math.max(Cr.x,Ct[un].x),Cr.y=Math.max(Cr.y,Ct[un].y);ln=mr.x>=mt.x&&Cr.x<=pt.x&&mr.y>=mt.y&&Cr.y<=pt.y?[Ct]:Cr.x<mt.x||mr.x>pt.x||Cr.y<mt.y||mr.y>pt.y?[]:h.al([Ct],mt.x,mt.y,pt.x,pt.y)}for(const mr of ln){Nt.reset(mr,.25*Et);let Cr=0;Cr=Nt.length<=.5*Et?1:Math.ceil(Nt.paddedLength/ir)+1;for(let un=0;un<Cr;un++){const di=un/Math.max(Cr-1,1),Oa=Nt.lerp(di),cn=Oa.x+tr,ji=Oa.y+tr;oe.push(cn,ji,Et,0);const Ci=cn-Et,fi=ji-Et,Ti=cn+Et,us=ji+Et;if(xt=xt&&this.isOffscreen(Ci,fi,Ti,us),st=st||this.isInsideGrid(Ci,fi,Ti,us),e!=="always"&&this.grid.hitTestCircle(cn,ji,Et,e,V)&&(Xe=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Xe}}}}return{circles:!L&&Xe||!st||Q<this.perspectiveRatioCutoff?[]:oe,offscreen:xt,collisionDetected:Xe}}projectPathToScreenSpace(e,s,u){return e.map(d=>ne(d.x,d.y,u,s.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let u=1/0,d=1/0,p=-1/0,S=-1/0;for(const L of e){const R=new h.P(L.x+tr,L.y+tr);u=Math.min(u,R.x),d=Math.min(d,R.y),p=Math.max(p,R.x),S=Math.max(S,R.y),s.push(R)}const T=this.grid.query(u,d,p,S).concat(this.ignoredGrid.query(u,d,p,S)),I={},M={};for(const L of T){const R=L.key;if(I[R.bucketInstanceId]===void 0&&(I[R.bucketInstanceId]={}),I[R.bucketInstanceId][R.featureIndex])continue;const V=[new h.P(L.x1,L.y1),new h.P(L.x2,L.y1),new h.P(L.x2,L.y2),new h.P(L.x1,L.y2)];h.am(s,V)&&(I[R.bucketInstanceId][R.featureIndex]=!0,M[R.bucketInstanceId]===void 0&&(M[R.bucketInstanceId]=[]),M[R.bucketInstanceId].push(R.featureIndex))}return M}insertCollisionBox(e,s,u,d,p,S){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:p,collisionGroupID:S,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,u,d,p,S){const T=u?this.ignoredGrid:this.grid,I={bucketInstanceId:d,featureIndex:p,collisionGroupID:S,overlapMode:s};for(let M=0;M<e.length;M+=4)T.insertCircle(I,e[M],e[M+1],e[M+2])}projectAndGetPerspectiveRatio(e,s,u,d,p){let S;p?(S=[s,u,p(s,u),1],h.af(S,S,e)):(S=[s,u,0,1],Er(S,S,e));const T=S[3];return{point:new h.P((S[0]/T+1)/2*this.transform.width+tr,(-S[1]/T+1)/2*this.transform.height+tr),perspectiveRatio:.5+this.transform.cameraToCenterDistance/T*.5,isOccluded:!1,signedDistanceFromCamera:T}}getPerspectiveRatio(e,s,u,d,p){const S=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,u,d,p):ne(s,u,e,p);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(e,s,u,d){return u<tr||e>=this.screenRightBoundary||d<tr||s>this.screenBottomBoundary}isInsideGrid(e,s,u,d){return u>=0&&e<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=h.an([]);return h.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,u,d,p,S,T,I,M,L){let R=new h.P(1,0),V=new h.P(0,1);const Z=new h.P(e.anchorPointX+T[0],e.anchorPointY+T[1]);if(S&&!p){const xt=this.projectAndGetPerspectiveRatio(u,Z.x+1,Z.y,d,M).point.sub(I.point).unit(),Et=Math.atan(xt.y/xt.x)+(xt.x<0?Math.PI:0),mt=Math.sin(Et),pt=Math.cos(Et);R=new h.P(pt,mt),V=new h.P(-mt,pt)}else if(!S&&p){const xt=-this.transform.angle,Et=Math.sin(xt),mt=Math.cos(xt);R=new h.P(mt,Et),V=new h.P(-Et,mt)}let X=I.point,re=s;if(p){X=Z;const xt=this.transform.zoom-Math.floor(this.transform.zoom);re=Math.pow(2,-xt),re*=this.mapProjection.getPitchedTextCorrection(this.transform,Z,d),L||(re*=h.ac(.5+I.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}L&&(X=X.add(R.mult(L.x*re)).add(V.mult(L.y*re)));const ae=e.x1*re,oe=e.x2*re,de=(ae+oe)/2,Q=e.y1*re,we=e.y2*re,Ie=(Q+we)/2,Re=[{offsetX:ae,offsetY:Q},{offsetX:de,offsetY:Q},{offsetX:oe,offsetY:Q},{offsetX:oe,offsetY:Ie},{offsetX:oe,offsetY:we},{offsetX:de,offsetY:we},{offsetX:ae,offsetY:we},{offsetX:ae,offsetY:Ie}];let Xe=[];for(const{offsetX:xt,offsetY:Et}of Re)Xe.push(new h.P(X.x+R.x*xt+V.x*Et,X.y+R.y*xt+V.y*Et));let st=!1;if(p){const xt=Xe.map(Et=>this.projectAndGetPerspectiveRatio(u,Et.x,Et.y,d,M));st=xt.some(Et=>!Et.isOccluded),Xe=xt.map(Et=>Et.point)}else st=!0;return{box:h.ao(Xe),allPointsOccluded:!st}}}function hr(m,e,s){return e*(h.X/(m.tileSize*Math.pow(2,s-m.tileID.overscaledZ)))}class dn{constructor(e,s,u,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class fn{constructor(e,s,u,d,p){this.text=new dn(e?e.text:null,s,u,p),this.icon=new dn(e?e.icon:null,s,d,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class sr{constructor(e,s,u){this.text=e,this.icon=s,this.skipFade=u}}class jr{constructor(){this.invProjMatrix=h.H(),this.viewportMatrix=h.H(),this.circles=[]}}class Ur{constructor(e,s,u,d,p){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=p}}class Mn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[e]}}function Dn(m,e,s,u,d){const{horizontalAlign:p,verticalAlign:S}=h.au(m);return new h.P(-(p-.5)*e+u[0]*d,-(S-.5)*s+u[1]*d)}class Ar{constructor(e,s,u,d,p,S){this.transform=e.clone(),this.terrain=u,this.collisionIndex=new xr(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Mn(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(u,d)=>s.getElevation(e,u,d):null}getBucketParts(e,s,u,d){const p=u.getBucket(s),S=u.latestFeatureIndex;if(!p||!S||s.id!==p.layerIds[0])return;const T=u.collisionBoxArray,I=p.layers[0].layout,M=p.layers[0].paint,L=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),R=u.tileSize/h.X,V=u.tileID.toUnwrapped(),Z=this.transform.calculatePosMatrix(V),X=I.get("text-pitch-alignment")==="map",re=I.get("text-rotation-alignment")==="map",ae=hr(u,1,this.transform.zoom),oe=this.collisionIndex.mapProjection.translatePosition(this.transform,u,M.get("text-translate"),M.get("text-translate-anchor")),de=this.collisionIndex.mapProjection.translatePosition(this.transform,u,M.get("icon-translate"),M.get("icon-translate-anchor")),Q=ca(Z,X,re,this.transform,ae);let we=null;if(X){const Re=Xi(Z,X,re,this.transform,ae);we=h.L([],this.transform.labelPlaneMatrix,Re)}this.retainedQueryData[p.bucketInstanceId]=new Ur(p.bucketInstanceId,S,p.sourceLayerIndex,p.index,u.tileID);const Ie={bucket:p,layout:I,translationText:oe,translationIcon:de,posMatrix:Z,unwrappedTileID:V,textLabelPlaneMatrix:Q,labelToScreenMatrix:we,scale:L,textPixelRatio:R,holdingForFade:u.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:h.ag(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(d)for(const Re of p.sortKeyRanges){const{sortKey:Xe,symbolInstanceStart:st,symbolInstanceEnd:xt}=Re;e.push({sortKey:Xe,symbolInstanceStart:st,symbolInstanceEnd:xt,parameters:Ie})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:Ie})}attemptAnchorPlacement(e,s,u,d,p,S,T,I,M,L,R,V,Z,X,re,ae,oe,de,Q){const we=h.aq[e.textAnchor],Ie=[e.textOffset0,e.textOffset1],Re=Dn(we,u,d,Ie,p),Xe=this.collisionIndex.placeCollisionBox(s,V,I,M,L,T,S,ae,R.predicate,Q,Re);if((!de||this.collisionIndex.placeCollisionBox(de,V,I,M,L,T,S,oe,R.predicate,Q,Re).placeable)&&Xe.placeable){let st;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(st=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:Ie,width:u,height:d,anchor:we,textBoxScale:p,prevAnchor:st},this.markUsedJustification(X,we,Z,re),X.allowVerticalPlacement&&(this.markUsedOrientation(X,re,Z),this.placedOrientations[Z.crossTileID]=re),{shift:Re,placedGlyphBoxes:Xe}}}placeLayerBucketPart(e,s,u){const{bucket:d,layout:p,translationText:S,translationIcon:T,posMatrix:I,unwrappedTileID:M,textLabelPlaneMatrix:L,labelToScreenMatrix:R,textPixelRatio:V,holdingForFade:Z,collisionBoxArray:X,partiallyEvaluatedTextSize:re,collisionGroup:ae}=e.parameters,oe=p.get("text-optional"),de=p.get("icon-optional"),Q=h.ar(p,"text-overlap","text-allow-overlap"),we=Q==="always",Ie=h.ar(p,"icon-overlap","icon-allow-overlap"),Re=Ie==="always",Xe=p.get("text-rotation-alignment")==="map",st=p.get("text-pitch-alignment")==="map",xt=p.get("icon-text-fit")!=="none",Et=p.get("symbol-z-order")==="viewport-y",mt=we&&(Re||!d.hasIconData()||de),pt=Re&&(we||!d.hasTextData()||oe);!d.collisionArrays&&X&&d.deserializeCollisionBoxes(X);const Nt=this._getTerrainElevationFunc(this.retainedQueryData[d.bucketInstanceId].tileID),or=(_t,Ct,ir)=>{var ln,mr;if(s[_t.crossTileID])return;if(Z)return void(this.placements[_t.crossTileID]=new sr(!1,!1,!1));let Cr=!1,un=!1,di=!0,Oa=null,cn={box:null,placeable:!1,offscreen:null},ji={placeable:!1},Ci=null,fi=null,Ti=null,us=0,ll=0,Qu=0;Ct.textFeatureIndex?us=Ct.textFeatureIndex:_t.useRuntimeCollisionCircles&&(us=_t.featureIndex),Ct.verticalTextFeatureIndex&&(ll=Ct.verticalTextFeatureIndex);const ul=Ct.textBox;if(ul){const xa=si=>{let pi=h.ah.horizontal;if(d.allowVerticalPlacement&&!si&&this.prevPlacement){const ra=this.prevPlacement.placedOrientations[_t.crossTileID];ra&&(this.placedOrientations[_t.crossTileID]=ra,pi=ra,this.markUsedOrientation(d,pi,_t))}return pi},wa=(si,pi)=>{if(d.allowVerticalPlacement&&_t.numVerticalGlyphVertices>0&&Ct.verticalTextBox){for(const ra of d.writingModes)if(ra===h.ah.vertical?(cn=pi(),ji=cn):cn=si(),cn&&cn.placeable)break}else cn=si()},Js=_t.textAnchorOffsetStartIndex,Fa=_t.textAnchorOffsetEndIndex;if(Fa===Js){const si=(pi,ra)=>{const Pr=this.collisionIndex.placeCollisionBox(pi,Q,V,I,M,st,Xe,S,ae.predicate,Nt);return Pr&&Pr.placeable&&(this.markUsedOrientation(d,ra,_t),this.placedOrientations[_t.crossTileID]=ra),Pr};wa(()=>si(ul,h.ah.horizontal),()=>{const pi=Ct.verticalTextBox;return d.allowVerticalPlacement&&_t.numVerticalGlyphVertices>0&&pi?si(pi,h.ah.vertical):{box:null,offscreen:null}}),xa(cn&&cn.placeable)}else{let si=h.aq[(mr=(ln=this.prevPlacement)===null||ln===void 0?void 0:ln.variableOffsets[_t.crossTileID])===null||mr===void 0?void 0:mr.anchor];const pi=(Pr,Po,cl)=>{const hl=Pr.x2-Pr.x1,Ld=Pr.y2-Pr.y1,Gp=_t.textBoxScale,Rd=xt&&Ie==="never"?Po:null;let Qs=null,Od=Q==="never"?1:2,tc="never";si&&Od++;for(let ou=0;ou<Od;ou++){for(let rc=Js;rc<Fa;rc++){const nc=d.textAnchorOffsets.get(rc);if(si&&nc.textAnchor!==si)continue;const dl=this.attemptAnchorPlacement(nc,Pr,hl,Ld,Gp,Xe,st,V,I,M,ae,tc,_t,d,cl,S,T,Rd,Nt);if(dl&&(Qs=dl.placedGlyphBoxes,Qs&&Qs.placeable))return Cr=!0,Oa=dl.shift,Qs}si?si=null:tc=Q}return u&&!Qs&&(Qs={box:this.collisionIndex.placeCollisionBox(ul,"always",V,I,M,st,Xe,S,ae.predicate,Nt,new h.P(0,0)).box,offscreen:!1,placeable:!1}),Qs};wa(()=>pi(ul,Ct.iconBox,h.ah.horizontal),()=>{const Pr=Ct.verticalTextBox;return d.allowVerticalPlacement&&(!cn||!cn.placeable)&&_t.numVerticalGlyphVertices>0&&Pr?pi(Pr,Ct.verticalIconBox,h.ah.vertical):{box:null,occluded:!0,offscreen:null}}),cn&&(Cr=cn.placeable,di=cn.offscreen);const ra=xa(cn&&cn.placeable);if(!Cr&&this.prevPlacement){const Pr=this.prevPlacement.variableOffsets[_t.crossTileID];Pr&&(this.variableOffsets[_t.crossTileID]=Pr,this.markUsedJustification(d,Pr.anchor,_t,ra))}}}if(Ci=cn,Cr=Ci&&Ci.placeable,di=Ci&&Ci.offscreen,_t.useRuntimeCollisionCircles){const xa=d.text.placedSymbolArray.get(_t.centerJustifiedTextSymbolIndex),wa=h.ai(d.textSizeData,re,xa),Js=p.get("text-padding");fi=this.collisionIndex.placeCollisionCircles(Q,xa,d.lineVertexArray,d.glyphOffsetArray,wa,I,M,L,R,u,st,ae.predicate,_t.collisionCircleDiameter,Js,S,Nt),fi.circles.length&&fi.collisionDetected&&!u&&h.w("Collisions detected, but collision boxes are not shown"),Cr=we||fi.circles.length>0&&!fi.collisionDetected,di=di&&fi.offscreen}if(Ct.iconFeatureIndex&&(Qu=Ct.iconFeatureIndex),Ct.iconBox){const xa=wa=>this.collisionIndex.placeCollisionBox(wa,Ie,V,I,M,st,Xe,T,ae.predicate,Nt,xt&&Oa?Oa:void 0);ji&&ji.placeable&&Ct.verticalIconBox?(Ti=xa(Ct.verticalIconBox),un=Ti.placeable):(Ti=xa(Ct.iconBox),un=Ti.placeable),di=di&&Ti.offscreen}const va=oe||_t.numHorizontalGlyphVertices===0&&_t.numVerticalGlyphVertices===0,ec=de||_t.numIconVertices===0;va||ec?ec?va||(un=un&&Cr):Cr=un&&Cr:un=Cr=un&&Cr;const mh=un&&Ti.placeable;if(Cr&&Ci.placeable&&this.collisionIndex.insertCollisionBox(Ci.box,Q,p.get("text-ignore-placement"),d.bucketInstanceId,ji&&ji.placeable&&ll?ll:us,ae.ID),mh&&this.collisionIndex.insertCollisionBox(Ti.box,Ie,p.get("icon-ignore-placement"),d.bucketInstanceId,Qu,ae.ID),fi&&Cr&&this.collisionIndex.insertCollisionCircles(fi.circles,Q,p.get("text-ignore-placement"),d.bucketInstanceId,us,ae.ID),u&&this.storeCollisionData(d.bucketInstanceId,ir,Ct,Ci,Ti,fi),_t.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[_t.crossTileID]=new sr(Cr||mt,un||pt,di||d.justReloaded),s[_t.crossTileID]=!0};if(Et){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const _t=d.getSortedSymbolIndexes(this.transform.angle);for(let Ct=_t.length-1;Ct>=0;--Ct){const ir=_t[Ct];or(d.symbolInstances.get(ir),d.collisionArrays[ir],ir)}}else for(let _t=e.symbolInstanceStart;_t<e.symbolInstanceEnd;_t++)or(d.symbolInstances.get(_t),d.collisionArrays[_t],_t);if(u&&d.bucketInstanceId in this.collisionCircleArrays){const _t=this.collisionCircleArrays[d.bucketInstanceId];h.as(_t.invProjMatrix,I),_t.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}storeCollisionData(e,s,u,d,p,S){if(u.textBox||u.iconBox){let T,I;this.collisionBoxArrays.has(e)?T=this.collisionBoxArrays.get(e):(T=new Map,this.collisionBoxArrays.set(e,T)),T.has(s)?I=T.get(s):(I={text:null,icon:null},T.set(s,I)),u.textBox&&(I.text=d.box),u.iconBox&&(I.icon=p.box)}if(S){let T=this.collisionCircleArrays[e];T===void 0&&(T=this.collisionCircleArrays[e]=new jr);for(let I=0;I<S.circles.length;I+=4)T.circles.push(S.circles[I+0]),T.circles.push(S.circles[I+1]),T.circles.push(S.circles[I+2]),T.circles.push(S.collisionDetected?1:0)}}markUsedJustification(e,s,u,d){let p;p=d===h.ah.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[h.at(s)];const S=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const T of S)T>=0&&(e.text.placedSymbolArray.get(T).crossTileID=p>=0&&T!==p?0:u.crossTileID)}markUsedOrientation(e,s,u){const d=s===h.ah.horizontal||s===h.ah.horizontalOnly?s:0,p=s===h.ah.vertical?s:0,S=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const T of S)e.text.placedSymbolArray.get(T).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const d=s?s.symbolFadeChange(e):1,p=s?s.opacities:{},S=s?s.variableOffsets:{},T=s?s.placedOrientations:{};for(const I in this.placements){const M=this.placements[I],L=p[I];L?(this.opacities[I]=new fn(L,d,M.text,M.icon),u=u||M.text!==L.text.placed||M.icon!==L.icon.placed):(this.opacities[I]=new fn(null,d,M.text,M.icon,M.skipFade),u=u||M.text||M.icon)}for(const I in p){const M=p[I];if(!this.opacities[I]){const L=new fn(M,d,!1,!1);L.isHidden()||(this.opacities[I]=L,u=u||M.text.placed||M.icon.placed)}}for(const I in S)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=S[I]);for(const I in T)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=T[I]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const u={};for(const d of s){const p=d.getBucket(e);p&&d.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,d.tileID,u,d.collisionBoxArray)}}updateBucketOpacities(e,s,u,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],S=p.layout,T=new fn(null,0,!1,!1,!0),I=S.get("text-allow-overlap"),M=S.get("icon-allow-overlap"),L=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=S.get("text-rotation-alignment")==="map",V=S.get("text-pitch-alignment")==="map",Z=S.get("icon-text-fit")!=="none",X=new fn(null,0,I&&(M||!e.hasIconData()||S.get("icon-optional")),M&&(I||!e.hasTextData()||S.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);const re=(oe,de,Q)=>{for(let we=0;we<de/4;we++)oe.opacityVertexArray.emplaceBack(Q);oe.hasVisibleVertices=oe.hasVisibleVertices||Q!==Ea},ae=this.collisionBoxArrays.get(e.bucketInstanceId);for(let oe=0;oe<e.symbolInstances.length;oe++){const de=e.symbolInstances.get(oe),{numHorizontalGlyphVertices:Q,numVerticalGlyphVertices:we,crossTileID:Ie}=de;let Re=this.opacities[Ie];u[Ie]?Re=T:Re||(Re=X,this.opacities[Ie]=Re),u[Ie]=!0;const Xe=de.numIconVertices>0,st=this.placedOrientations[de.crossTileID],xt=st===h.ah.vertical,Et=st===h.ah.horizontal||st===h.ah.horizontalOnly;if(Q>0||we>0){const pt=ci(Re.text);re(e.text,Q,xt?Ea:pt),re(e.text,we,Et?Ea:pt);const Nt=Re.text.isHidden();[de.rightJustifiedTextSymbolIndex,de.centerJustifiedTextSymbolIndex,de.leftJustifiedTextSymbolIndex].forEach(Ct=>{Ct>=0&&(e.text.placedSymbolArray.get(Ct).hidden=Nt||xt?1:0)}),de.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(de.verticalPlacedTextSymbolIndex).hidden=Nt||Et?1:0);const or=this.variableOffsets[de.crossTileID];or&&this.markUsedJustification(e,or.anchor,de,st);const _t=this.placedOrientations[de.crossTileID];_t&&(this.markUsedJustification(e,"left",de,_t),this.markUsedOrientation(e,_t,de))}if(Xe){const pt=ci(Re.icon),Nt=!(Z&&de.verticalPlacedIconSymbolIndex&&xt);de.placedIconSymbolIndex>=0&&(re(e.icon,de.numIconVertices,Nt?pt:Ea),e.icon.placedSymbolArray.get(de.placedIconSymbolIndex).hidden=Re.icon.isHidden()),de.verticalPlacedIconSymbolIndex>=0&&(re(e.icon,de.numVerticalIconVertices,Nt?Ea:pt),e.icon.placedSymbolArray.get(de.verticalPlacedIconSymbolIndex).hidden=Re.icon.isHidden())}const mt=ae&&ae.has(oe)?ae.get(oe):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const pt=e.collisionArrays[oe];if(pt){let Nt=new h.P(0,0);if(pt.textBox||pt.verticalTextBox){let or=!0;if(L){const _t=this.variableOffsets[Ie];_t?(Nt=Dn(_t.anchor,_t.width,_t.height,_t.textOffset,_t.textBoxScale),R&&Nt._rotate(V?this.transform.angle:-this.transform.angle)):or=!1}if(pt.textBox||pt.verticalTextBox){let _t;pt.textBox&&(_t=xt),pt.verticalTextBox&&(_t=Et),zi(e.textCollisionBox.collisionVertexArray,Re.text.placed,!or||_t,mt.text,Nt.x,Nt.y)}}if(pt.iconBox||pt.verticalIconBox){const or=!!(!Et&&pt.verticalIconBox);let _t;pt.iconBox&&(_t=or),pt.verticalIconBox&&(_t=!or),zi(e.iconCollisionBox.collisionVertexArray,Re.icon.placed,_t,mt.icon,Z?Nt.x:0,Z?Nt.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const oe=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=oe.invProjMatrix,e.placementViewportMatrix=oe.viewportMatrix,e.collisionCircleArray=oe.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function zi(m,e,s,u,d,p){u&&u.length!==0||(u=[0,0,0,0]);const S=u[0]-tr,T=u[1]-tr,I=u[2]-tr,M=u[3]-tr;m.emplaceBack(e?1:0,s?1:0,d||0,p||0,S,T),m.emplaceBack(e?1:0,s?1:0,d||0,p||0,I,T),m.emplaceBack(e?1:0,s?1:0,d||0,p||0,I,M),m.emplaceBack(e?1:0,s?1:0,d||0,p||0,S,M)}const br=Math.pow(2,25),qo=Math.pow(2,24),Xa=Math.pow(2,17),Hn=Math.pow(2,16),ri=Math.pow(2,9),Gl=Math.pow(2,8),Bn=Math.pow(2,1);function ci(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,s=Math.floor(127*m.opacity);return s*br+e*qo+s*Xa+e*Hn+s*ri+e*Gl+s*Bn+e}const Ea=0;function Ya(){return{isOccluded:(m,e,s)=>!1,getPitchedTextCorrection:(m,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(m,e,s,u){throw new Error("Not implemented.")},translatePosition:(m,e,s,u)=>function(d,p,S,T,I=!1){if(!S[0]&&!S[1])return[0,0];const M=I?T==="map"?d.angle:0:T==="viewport"?-d.angle:0;if(M){const L=Math.sin(M),R=Math.cos(M);S=[S[0]*R-S[1]*L,S[0]*L+S[1]*R]}return[I?S[0]:hr(p,S[0],d.zoom),I?S[1]:hr(p,S[1],d.zoom)]}(m,e,s,u),getCircleRadiusCorrection:m=>1}}class rr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,u,d,p){const S=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(S,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((T,I)=>T.sortKey-I.sortKey));this._currentPartIndex<S.length;)if(s.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,p())return!0;return!1}}class Bs{constructor(e,s,u,d,p,S,T,I){this.placement=new Ar(e,Ya(),s,S,T,I),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,s,u){const d=Y.now(),p=()=>!this._forceFullPlacement&&Y.now()-d>2;for(;this._currentPlacementIndex>=0;){const S=s[e[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=T)&&(!S.maxzoom||S.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new rr(S)),this._inProgressLayer.continuePlacement(u[S.source],this.placement,this._showCollisionBoxes,S,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Li=512/h.X/2;class sn{constructor(e,s,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const d=new Map;for(let p=0;p<s.length;p++){const S=s.get(p),T=S.key,I=d.get(T);I?I.push(S):d.set(T,[S])}for(const[p,S]of d){const T={positions:S.map(I=>({x:Math.floor(I.anchorX*Li),y:Math.floor(I.anchorY*Li)})),crossTileIDs:S.map(I=>I.crossTileID)};if(T.positions.length>128){const I=new h.av(T.positions.length,16,Uint16Array);for(const{x:M,y:L}of T.positions)I.add(M,L);I.finish(),delete T.positions,T.index=I}this._symbolsByKey[p]=T}}getScaledCoordinates(e,s){const{x:u,y:d,z:p}=this.tileID.canonical,{x:S,y:T,z:I}=s.canonical,M=Li/Math.pow(2,I-p),L=(T*h.X+e.anchorY)*M,R=d*h.X*Li;return{x:Math.floor((S*h.X+e.anchorX)*M-u*h.X*Li),y:Math.floor(L-R)}}findMatches(e,s,u){const d=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let p=0;p<e.length;p++){const S=e.get(p);if(S.crossTileID)continue;const T=this._symbolsByKey[S.key];if(!T)continue;const I=this.getScaledCoordinates(S,s);if(T.index){const M=T.index.range(I.x-d,I.y-d,I.x+d,I.y+d).sort();for(const L of M){const R=T.crossTileIDs[L];if(!u[R]){u[R]=!0,S.crossTileID=R;break}}}else if(T.positions)for(let M=0;M<T.positions.length;M++){const L=T.positions[M],R=T.crossTileIDs[M];if(Math.abs(L.x-I.x)<=d&&Math.abs(L.y-I.y)<=d&&!u[R]){u[R]=!0,S.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ja{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ri{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const u in this.indexes){const d=this.indexes[u],p={};for(const S in d){const T=d[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+s),p[T.tileID.key]=T}this.indexes[u]=p}this.lng=e}addBucket(e,s,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<s.symbolInstances.length;p++)s.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const S=this.indexes[p];if(Number(p)>e.overscaledZ)for(const T in S){const I=S[T];I.tileID.isChildOf(e)&&I.findMatches(s.symbolInstances,e,d)}else{const T=S[e.scaledTo(Number(p)).key];T&&T.findMatches(s.symbolInstances,e,d)}}for(let p=0;p<s.symbolInstances.length;p++){const S=s.symbolInstances.get(p);S.crossTileID||(S.crossTileID=u.generate(),d[S.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new sn(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const u of s.getCrossTileIDsLists())for(const d of u)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let s=!1;for(const u in this.indexes){const d=this.indexes[u];for(const p in d)e[d[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[p]),delete d[p],s=!0)}return s}}class Ko{constructor(){this.layerIndexes={},this.crossTileIDs=new Ja,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,u){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new Ri);let p=!1;const S={};d.handleWrapJump(u);for(const T of s){const I=T.getBucket(e);I&&e.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(T.tileID,I,this.crossTileIDs)&&(p=!0),S[I.bucketInstanceId]=!0)}return d.removeStaleBuckets(S)&&(p=!0),p}pruneUnusedLayers(e){const s={};e.forEach(u=>{s[u]=!0});for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}const Oi=(m,e)=>h.t(m,e&&e.filter(s=>s.identifier!=="source.canvas")),Jr=h.aw();class Qa extends h.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const d=this.sourceCaches[u].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new Br(ct(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,d)=>this.getGlyphs(u,d)),this.dispatcher.registerMessageHandler("GI",(u,d)=>this.getImages(u,d)),this.imageManager=new Ot,this.imageManager.setEventedParent(this),this.glyphManager=new nr(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new It(256,512),this.crossTileSymbolIndex=new Ko,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",h.ay()),Cn().on(rt,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const d=this.sourceCaches[u.sourceId];if(!d)return;const p=d.getSource();if(p&&p.vectorLayerIds)for(const S in this._layers){const T=this._layers[S];T.source===p.id&&this._validateLayer(T)}})}loadURL(e,s={},u){this.fire(new h.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;h.h(d,this._loadStyleRequest).then(S=>{this._loadStyleRequest=null,this._load(S.data,s,u)}).catch(S=>{this._loadStyleRequest=null,S&&!p.signal.aborted&&this.fire(new h.j(S))})}loadJSON(e,s={},u){this.fire(new h.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Y.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,u)}).catch(()=>{})}loadEmpty(){this.fire(new h.k("dataloading",{dataType:"style"})),this._load(Jr,{validate:!1})}_load(e,s,u){var d;const p=s.transformStyle?s.transformStyle(u,e):e;if(!s.validate||!Oi(this,h.u(p))){this._loaded=!0,this.stylesheet=p;for(const S in p.sources)this.addSource(S,p.sources[S],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new gt(this.stylesheet.light),this.sky=new Rt(this.stylesheet.sky),this.map.setTerrain((d=this.stylesheet.terrain)!==null&&d!==void 0?d:null),this.fire(new h.k("data",{dataType:"style"})),this.fire(new h.k("style.load"))}}_createLayers(){const e=h.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of e){const u=h.aA(s);u.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=u}}_loadSprite(e,s=!1,u=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(p,S,T,I){return h._(this,void 0,void 0,function*(){const M=me(p),L=T>1?"@2x":"",R={},V={};for(const{id:Z,url:X}of M){const re=S.transformRequest(Le(X,L,".json"),"SpriteJSON");R[Z]=h.h(re,I);const ae=S.transformRequest(Le(X,L,".png"),"SpriteImage");V[Z]=ke.getImage(ae,I)}return yield Promise.all([...Object.values(R),...Object.values(V)]),function(Z,X){return h._(this,void 0,void 0,function*(){const re={};for(const ae in Z){re[ae]={};const oe=Y.getImageCanvasContext((yield X[ae]).data),de=(yield Z[ae]).data;for(const Q in de){const{width:we,height:Ie,x:Re,y:Xe,sdf:st,pixelRatio:xt,stretchX:Et,stretchY:mt,content:pt,textFitWidth:Nt,textFitHeight:or}=de[Q];re[ae][Q]={data:null,pixelRatio:xt,sdf:st,stretchX:Et,stretchY:mt,content:pt,textFitWidth:Nt,textFitHeight:or,spriteData:{width:we,height:Ie,x:Re,y:Xe,context:oe}}}}return re})}(R,V)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(p=>{if(this._spriteRequest=null,p)for(const S in p){this._spritesImagesIds[S]=[];const T=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(I=>!(I in p)):[];for(const I of T)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in p[S]){const M=S==="default"?I:`${S}:${I}`;this._spritesImagesIds[S].push(M),M in this.imageManager.images?this.imageManager.updateImage(M,p[S][I],!1):this.imageManager.addImage(M,p[S][I]),s&&(this._changedImages[M]=!0)}}}).catch(p=>{this._spriteRequest=null,d=p,this.fire(new h.j(d))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"})),u&&u(d)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const u=e.sourceLayer;if(!u)return;const d=s.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(u)===-1)&&this.fire(new h.j(new Error(`Source layer "${u}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?h.aB(u):u);const d=[];for(const p of e)if(u[p]){const S=s?h.aB(u[p]):u[p];d.push(S)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const u of s){const d=this._layers[u];d.type!=="custom"&&(e[u]=d.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const d=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(d.length||p.length)&&this._updateWorkerLayers(d,p);for(const S in this._updatedSources){const T=this._updatedSources[S];if(T==="reload")this._reloadSource(S);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const d in this.sourceCaches){const p=this.sourceCaches[d];u[d]=p.used,p.used=!1}for(const d of this._order){const p=this._layers[d];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const d in u){const p=this.sourceCaches[d];!!u[d]!=!!p.used&&p.fire(new h.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new h.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var u;this._checkLoaded();const d=this.serialize();if(e=s.transformStyle?s.transformStyle(d,e):e,((u=s.validate)===null||u===void 0||u)&&Oi(this,h.u(e)))return!1;(e=h.aB(e)).layers=h.az(e.layers);const p=h.aC(d,e),S=this._getOperationsToPerform(p);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const T of S.operations)T();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],u=[];for(const d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,d.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,d.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,d.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,d.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,d.args));break;case"addSource":s.push(()=>this.addSource.apply(this,d.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,d.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,d.args));break;case"setLight":s.push(()=>this.setLight.apply(this,d.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,d.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,d.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,d.args));break;case"setSky":s.push(()=>this.setSky.apply(this,d.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,d.args));break;case"setTransition":s.push(()=>{});break;default:u.push(d.command)}return{operations:s,unimplemented:u}}addImage(e,s){if(this.getImage(e))return this.fire(new h.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new h.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(h.u.source,`sources.${e}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const d=this.sourceCaches[e]=new Ht(e,s,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e})),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new h.j(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new h.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,u={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new h.j(new Error(`Layer "${d}" already exists on this map.`)));let p;if(e.type==="custom"){if(Oi(this,h.aD(e)))return;p=h.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=h.aB(e),e=h.e(e,{source:d})),this._validate(h.u.layer,`layers.${d}`,e,{arrayIndex:-1},u))return;p=h.aA(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:d}})}const S=s?this._order.indexOf(s):this._order.length;if(s&&S===-1)this.fire(new h.j(new Error(`Cannot add layer "${d}" before non-existing layer "${s}".`)));else{if(this._order.splice(S,0,d),this._layerOrderChanged=!0,this._layers[d]=p,this._removedLayers[d]&&p.source&&p.type!=="custom"){const T=this._removedLayers[d];delete this._removedLayers[d],T.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new h.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const u=this._order.indexOf(e);this._order.splice(u,1);const d=s?this._order.indexOf(s):this._order.length;s&&d===-1?this.fire(new h.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new h.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,u){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===s&&d.maxzoom===u||(s!=null&&(d.minzoom=s),u!=null&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new h.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,u={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!h.aE(d.filter,s))return s==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(h.u.filter,`layers.${d.id}.filter`,s,null,u)||(d.filter=h.aB(s),this._updateLayer(d)))}else this.fire(new h.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return h.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,u,d={}){this._checkLoaded();const p=this.getLayer(e);p?h.aE(p.getLayoutProperty(s),u)||(p.setLayoutProperty(s,u,d),this._updateLayer(p)):this.fire(new h.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const u=this.getLayer(e);if(u)return u.getLayoutProperty(s);this.fire(new h.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,u,d={}){this._checkLoaded();const p=this.getLayer(e);p?h.aE(p.getPaintProperty(s),u)||(p.setPaintProperty(s,u,d)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new h.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const u=e.source,d=e.sourceLayer,p=this.sourceCaches[u];if(p===void 0)return void this.fire(new h.j(new Error(`The source '${u}' does not exist in the map's style.`)));const S=p.getSource().type;S==="geojson"&&d?this.fire(new h.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||d?(e.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(d,e.id,s)):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const u=e.source,d=this.sourceCaches[u];if(d===void 0)return void this.fire(new h.j(new Error(`The source '${u}' does not exist in the map's style.`)));const p=d.getSource().type,S=p==="vector"?e.sourceLayer:void 0;p!=="vector"||S?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new h.j(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(S,e.id,s):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,u=e.sourceLayer,d=this.sourceCaches[s];if(d!==void 0)return d.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),d.getFeatureState(u,e.id)):void this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=h.aF(this.sourceCaches,p=>p.serialize()),s=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,d=this.stylesheet;return h.aG({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,sources:e,layers:s,terrain:u},p=>p!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=S=>this._layers[S].type==="fill-extrusion",u={},d=[];for(let S=this._order.length-1;S>=0;S--){const T=this._order[S];if(s(T)){u[T]=S;for(const I of e){const M=I[T];if(M)for(const L of M)d.push(L)}}}d.sort((S,T)=>T.intersectionZ-S.intersectionZ);const p=[];for(let S=this._order.length-1;S>=0;S--){const T=this._order[S];if(s(T))for(let I=d.length-1;I>=0;I--){const M=d[I].feature;if(u[M.layer.id]<S)break;p.push(M),d.pop()}else for(const I of e){const M=I[T];if(M)for(const L of M)p.push(L.feature)}}return p}queryRenderedFeatures(e,s,u){s&&s.filter&&this._validate(h.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const d={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new h.j(new Error("parameters.layers must be an Array."))),[];for(const T of s.layers){const I=this._layers[T];if(!I)return this.fire(new h.j(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];d[I.source]=!0}}const p=[];s.availableImages=this._availableImages;const S=this._serializedAllLayers();for(const T in this.sourceCaches)s.layers&&!d[T]||p.push(Nr(this.sourceCaches[T],this._layers,S,e,s,u));return this.placement&&p.push(function(T,I,M,L,R,V,Z){const X={},re=V.queryRenderedSymbols(L),ae=[];for(const oe of Object.keys(re).map(Number))ae.push(Z[oe]);ae.sort(Lr);for(const oe of ae){const de=oe.featureIndex.lookupSymbolFeatures(re[oe.bucketInstanceId],I,oe.bucketIndex,oe.sourceLayerIndex,R.filter,R.layers,R.availableImages,T);for(const Q in de){const we=X[Q]=X[Q]||[],Ie=de[Q];Ie.sort((Re,Xe)=>{const st=oe.featureSortOrder;if(st){const xt=st.indexOf(Re.featureIndex);return st.indexOf(Xe.featureIndex)-xt}return Xe.featureIndex-Re.featureIndex});for(const Re of Ie)we.push(Re)}}for(const oe in X)X[oe].forEach(de=>{const Q=de.feature,we=M[T[oe].source].getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=we});return X}(this._layers,S,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,s){s&&s.filter&&this._validate(h.u.filter,"querySourceFeatures.filter",s.filter,null,s);const u=this.sourceCaches[e];return u?function(d,p){const S=d.getRenderableIds().map(M=>d.getTileByID(M)),T=[],I={};for(let M=0;M<S.length;M++){const L=S[M],R=L.tileID.canonical.key;I[R]||(I[R]=!0,L.querySourceFeatures(T,p))}return T}(u,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const S in e)if(!h.aE(e[S],u[S])){d=!0;break}if(!d)return;const p={now:Y.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(p)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const u=this.getSky();let d=!1;if(!e&&!u)return;if(e&&!u)d=!0;else if(!e&&u)d=!0;else for(const S in e)if(!h.aE(e[S],u[S])){d=!0;break}if(!d)return;const p={now:Y.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(p)}_validate(e,s,u,d,p={}){return(!p||p.validate!==!1)&&Oi(this,e.call(h.u,h.e({key:s,style:this.serialize(),value:u,styleSpec:h.v},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Cn().off(rt,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const u=this.sourceCaches[s];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,u,d,p=!1){let S=!1,T=!1;const I={};for(const M of this._order){const L=this._layers[M];if(L.type!=="symbol")continue;if(!I[L.source]){const V=this.sourceCaches[L.source];I[L.source]=V.getRenderableIds(!0).map(Z=>V.getTileByID(Z)).sort((Z,X)=>X.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(X.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(L,I[L.source],e.center.lng);S=S||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Y.now(),e.zoom))&&(this.pauseablePlacement=new Bs(e,this.map.terrain,this._order,p,s,u,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Y.now()),T=!0),S&&this.pauseablePlacement.placement.setStale()),T||S)for(const M of this._order){const L=this._layers[M];L.type==="symbol"&&this.placement.updateLayerOpacities(L,I[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Y.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return h._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[s.source];return d&&d.setDependencies(s.tileID.key,s.type,s.icons),u})}getGlyphs(e,s){return h._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(s.stacks),d=this.sourceCaches[s.source];return d&&d.setDependencies(s.tileID.key,s.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(h.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,u={},d){this._checkLoaded();const p=[{id:e,url:s}],S=[...me(this.stylesheet.sprite),...p];this._validate(h.u.sprite,"sprite",S,null,u)||(this.stylesheet.sprite=S,this._loadSprite(p,!0,d))}removeSprite(e){this._checkLoaded();const s=me(this.stylesheet.sprite);if(s.find(u=>u.id===e)){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;s.splice(s.findIndex(u=>u.id===e),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}else this.fire(new h.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return me(this.stylesheet.sprite)}setSprite(e,s={},u){this._checkLoaded(),e&&this._validate(h.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var Yi=h.Y([{name:"a_pos",type:"Int16",components:2}]);const Si={prelude:Mr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Mr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Mr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Mr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Mr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Mr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Mr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Mr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Mr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Mr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Mr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Mr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Mr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Mr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Mr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Mr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Mr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Mr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Mr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Mr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Mr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Mr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Mr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Mr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Mr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Mr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Mr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Mr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Mr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Mr(m,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/attribute ([\w]+) ([\w]+)/g),d=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=p?p.concat(d):d,T={};return{fragmentSource:m=m.replace(s,(I,M,L,R,V)=>(T[V]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${V}
varying ${L} ${R} ${V};
#else
uniform ${L} ${R} u_${V};
#endif
`:`
#ifdef HAS_UNIFORM_u_${V}
    ${L} ${R} ${V} = u_${V};
#endif
`)),vertexSource:e=e.replace(s,(I,M,L,R,V)=>{const Z=R==="float"?"vec2":"vec4",X=V.match(/color/)?"color":Z;return T[V]?M==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${L} ${Z} a_${V};
varying ${L} ${R} ${V};
#else
uniform ${L} ${R} u_${V};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${L} ${R} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${X}(a_${V}, u_${V}_t);
#else
    ${L} ${R} ${V} = u_${V};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${L} ${Z} a_${V};
#else
uniform ${L} ${R} u_${V};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${L} ${R} ${V} = a_${V};
#else
    ${L} ${R} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${L} ${R} ${V} = unpack_mix_${X}(a_${V}, u_${V}_t);
#else
    ${L} ${R} ${V} = u_${V};
#endif
`}),staticAttributes:u,staticUniforms:S}}class ho{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,u,d,p,S,T,I,M){this.context=e;let L=this.boundPaintVertexBuffers.length!==d.length;for(let R=0;!L&&R<d.length;R++)this.boundPaintVertexBuffers[R]!==d[R]&&(L=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==u||L||this.boundIndexBuffer!==p||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==M?this.freshBind(s,u,d,p,S,T,I,M):(e.bindVertexArray.set(this.vao),T&&T.bind(),p&&p.dynamicDraw&&p.bind(),I&&I.bind(),M&&M.bind())}freshBind(e,s,u,d,p,S,T,I){const M=e.numAttributes,L=this.context,R=L.gl;this.vao&&this.destroy(),this.vao=L.createVertexArray(),L.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=I,s.enableAttributes(R,e);for(const V of u)V.enableAttributes(R,e);S&&S.enableAttributes(R,e),T&&T.enableAttributes(R,e),I&&I.enableAttributes(R,e),s.bind(),s.setVertexAttribPointers(R,e,p);for(const V of u)V.bind(),V.setVertexAttribPointers(R,e,p);S&&(S.bind(),S.setVertexAttribPointers(R,e,p)),d&&d.bind(),T&&(T.bind(),T.setVertexAttribPointers(R,e,p)),I&&(I.bind(),I.setVertexAttribPointers(R,e,p)),L.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ns=(m,e,s,u,d)=>({u_matrix:m,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:u?u.properties.get("fog-color"):h.aM.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:u?u.calculateFogBlendOpacity(d):0,u_horizon_color:u?u.properties.get("horizon-color"):h.aM.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1});function _s(m){const e=[];for(let s=0;s<m.length;s++){if(m[s]===null)continue;const u=m[s].split(" ");e.push(u.pop())}return e}class js{constructor(e,s,u,d,p,S){const T=e.gl;this.program=T.createProgram();const I=_s(s.staticAttributes),M=u?u.getBinderAttributes():[],L=I.concat(M),R=Si.prelude.staticUniforms?_s(Si.prelude.staticUniforms):[],V=s.staticUniforms?_s(s.staticUniforms):[],Z=u?u.getBinderUniforms():[],X=R.concat(V).concat(Z),re=[];for(const Re of X)re.indexOf(Re)<0&&re.push(Re);const ae=u?u.defines():[];p&&ae.push("#define OVERDRAW_INSPECTOR;"),S&&ae.push("#define TERRAIN3D;");const oe=ae.concat(Si.prelude.fragmentSource,s.fragmentSource).join(`
`),de=ae.concat(Si.prelude.vertexSource,s.vertexSource).join(`
`),Q=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(Q,oe),T.compileShader(Q),!T.getShaderParameter(Q,T.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${T.getShaderInfoLog(Q)}`);T.attachShader(this.program,Q);const we=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(we,de),T.compileShader(we),!T.getShaderParameter(we,T.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${T.getShaderInfoLog(we)}`);T.attachShader(this.program,we),this.attributes={};const Ie={};this.numAttributes=L.length;for(let Re=0;Re<this.numAttributes;Re++)L[Re]&&(T.bindAttribLocation(this.program,Re,L[Re]),this.attributes[L[Re]]=Re);if(T.linkProgram(this.program),!T.getProgramParameter(this.program,T.LINK_STATUS))throw new Error(`Program failed to link: ${T.getProgramInfoLog(this.program)}`);T.deleteShader(we),T.deleteShader(Q);for(let Re=0;Re<re.length;Re++){const Xe=re[Re];if(Xe&&!Ie[Xe]){const st=T.getUniformLocation(this.program,Xe);st&&(Ie[Xe]=st)}}this.fixedUniforms=d(e,Ie),this.terrainUniforms=((Re,Xe)=>({u_depth:new h.aH(Re,Xe.u_depth),u_terrain:new h.aH(Re,Xe.u_terrain),u_terrain_dim:new h.aI(Re,Xe.u_terrain_dim),u_terrain_matrix:new h.aJ(Re,Xe.u_terrain_matrix),u_terrain_unpack:new h.aK(Re,Xe.u_terrain_unpack),u_terrain_exaggeration:new h.aI(Re,Xe.u_terrain_exaggeration)}))(e,Ie),this.binderUniforms=u?u.getUniforms(e,Ie):[]}draw(e,s,u,d,p,S,T,I,M,L,R,V,Z,X,re,ae,oe,de){const Q=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(d),e.setColorMode(p),e.setCullFace(S),I){e.activeTexture.set(Q.TEXTURE2),Q.bindTexture(Q.TEXTURE_2D,I.depthTexture),e.activeTexture.set(Q.TEXTURE3),Q.bindTexture(Q.TEXTURE_2D,I.texture);for(const Ie in this.terrainUniforms)this.terrainUniforms[Ie].set(I[Ie])}for(const Ie in this.fixedUniforms)this.fixedUniforms[Ie].set(T[Ie]);re&&re.setUniforms(e,this.binderUniforms,Z,{zoom:X});let we=0;switch(s){case Q.LINES:we=2;break;case Q.TRIANGLES:we=3;break;case Q.LINE_STRIP:we=1}for(const Ie of V.get()){const Re=Ie.vaos||(Ie.vaos={});(Re[M]||(Re[M]=new ho)).bind(e,this,L,re?re.getPaintVertexBuffers():[],R,Ie.vertexOffset,ae,oe,de),Q.drawElements(s,Ie.primitiveLength*we,Q.UNSIGNED_SHORT,Ie.primitiveOffset*we*2)}}}function fo(m,e,s){const u=1/hr(s,1,e.transform.tileZoom),d=Math.pow(2,s.tileID.overscaledZ),p=s.tileSize*Math.pow(2,e.transform.tileZoom)/d,S=p*(s.tileID.canonical.x+s.tileID.wrap*d),T=p*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[u,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[S>>16,T>>16],u_pixel_coord_lower:[65535&S,65535&T]}}const po=(m,e,s,u)=>{const d=e.style.light,p=d.properties.get("position"),S=[p.x,p.y,p.z],T=function(){var M=new h.A(9);return h.A!=Float32Array&&(M[1]=0,M[2]=0,M[3]=0,M[5]=0,M[6]=0,M[7]=0),M[0]=1,M[4]=1,M[8]=1,M}();d.properties.get("anchor")==="viewport"&&function(M,L){var R=Math.sin(L),V=Math.cos(L);M[0]=V,M[1]=R,M[2]=0,M[3]=-R,M[4]=V,M[5]=0,M[6]=0,M[7]=0,M[8]=1}(T,-e.transform.angle),function(M,L,R){var V=L[0],Z=L[1],X=L[2];M[0]=V*R[0]+Z*R[3]+X*R[6],M[1]=V*R[1]+Z*R[4]+X*R[7],M[2]=V*R[2]+Z*R[5]+X*R[8]}(S,S,T);const I=d.properties.get("color");return{u_matrix:m,u_lightpos:S,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+s,u_opacity:u}},Dr=(m,e,s,u,d,p,S)=>h.e(po(m,e,s,u),fo(p,e,S),{u_height_factor:-Math.pow(2,d.overscaledZ)/S.tileSize/8}),vs=m=>({u_matrix:m}),Bu=(m,e,s,u)=>h.e(vs(m),fo(s,e,u)),Xc=(m,e)=>({u_matrix:m,u_world:e}),hi=(m,e,s,u,d)=>h.e(Bu(m,e,s,u),{u_world:d}),Us=(m,e,s,u)=>{const d=m.transform;let p,S;if(u.paint.get("circle-pitch-alignment")==="map"){const T=hr(s,1,d.zoom);p=!0,S=[T,T]}else p=!1,S=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(e.posMatrix,s,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:S}},ha=(m,e,s)=>({u_matrix:m,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),Fi=(m,e,s=1)=>({u_matrix:m,u_color:e,u_overlay:0,u_overlay_scale:s}),ni=m=>({u_matrix:m}),ii=(m,e,s,u)=>({u_matrix:m,u_extrude_scale:hr(e,1,s),u_intensity:u}),vn=(m,e,s,u)=>{const d=h.H();h.aP(d,0,m.width,m.height,0,0,1);const p=m.context.gl;return{u_matrix:d,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:s,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}};function ki(m,e){const s=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new h.Z(0,u/s).toLngLat().lat,new h.Z(0,(u+1)/s).toLngLat().lat]}const es=(m,e,s,u)=>{const d=m.transform;return{u_matrix:Ji(m,e,s,u),u_ratio:1/hr(e,1,d.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Vs=(m,e,s,u,d)=>h.e(es(m,e,s,d),{u_image:0,u_image_height:u}),ts=(m,e,s,u,d)=>{const p=m.transform,S=Nu(e,p);return{u_matrix:Ji(m,e,s,d),u_texsize:e.imageAtlasTexture.size,u_ratio:1/hr(e,1,p.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[S,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},rs=(m,e,s,u,d,p)=>{const S=m.lineAtlas,T=Nu(e,m.transform),I=s.layout.get("line-cap")==="round",M=S.getDash(u.from,I),L=S.getDash(u.to,I),R=M.width*d.fromScale,V=L.width*d.toScale;return h.e(es(m,e,s,p),{u_patternscale_a:[T/R,-M.height/2],u_patternscale_b:[T/V,-L.height/2],u_sdfgamma:S.width/(256*Math.min(R,V)*m.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:L.y,u_mix:d.t})};function Nu(m,e){return 1/hr(m,1,e.tileZoom)}function Ji(m,e,s,u){return m.translatePosMatrix(u?u.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Hl=(m,e,s,u,d)=>{return{u_matrix:m,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(S=d.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(p=d.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:ju(d.paint.get("raster-hue-rotate"))};var p,S};function ju(m){m*=Math.PI/180;const e=Math.sin(m),s=Math.cos(m);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const Go=(m,e,s,u,d,p,S,T,I,M,L,R,V,Z)=>{const X=S.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:X.width/X.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:I,u_coord_matrix:M,u_is_text:+R,u_pitch_with_map:+u,u_is_along_line:d,u_is_variable_anchor:p,u_texsize:V,u_texture:0,u_translation:L,u_pitched_scale:Z}},Aa=(m,e,s,u,d,p,S,T,I,M,L,R,V,Z,X)=>{const re=S.transform;return h.e(Go(m,e,s,u,d,p,S,T,I,M,L,R,V,X),{u_gamma_scale:u?Math.cos(re._pitch)*re.cameraToCenterDistance:1,u_device_pixel_ratio:S.pixelRatio,u_is_halo:1})},mo=(m,e,s,u,d,p,S,T,I,M,L,R,V,Z)=>h.e(Aa(m,e,s,u,d,p,S,T,I,M,L,!0,R,!0,Z),{u_texsize_icon:V,u_texture_icon:1}),go=(m,e,s)=>({u_matrix:m,u_opacity:e,u_color:s}),Zl=(m,e,s,u,d,p)=>h.e(function(S,T,I,M){const L=I.imageManager.getPattern(S.from.toString()),R=I.imageManager.getPattern(S.to.toString()),{width:V,height:Z}=I.imageManager.getPixelSize(),X=Math.pow(2,M.tileID.overscaledZ),re=M.tileSize*Math.pow(2,I.transform.tileZoom)/X,ae=re*(M.tileID.canonical.x+M.tileID.wrap*X),oe=re*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[V,Z],u_mix:T.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/hr(M,1,I.transform.tileZoom),u_pixel_coord_upper:[ae>>16,oe>>16],u_pixel_coord_lower:[65535&ae,65535&oe]}}(u,p,s,d),{u_matrix:m,u_opacity:e}),xs={fillExtrusion:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_lightpos:new h.aN(m,e.u_lightpos),u_lightintensity:new h.aI(m,e.u_lightintensity),u_lightcolor:new h.aN(m,e.u_lightcolor),u_vertical_gradient:new h.aI(m,e.u_vertical_gradient),u_opacity:new h.aI(m,e.u_opacity)}),fillExtrusionPattern:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_lightpos:new h.aN(m,e.u_lightpos),u_lightintensity:new h.aI(m,e.u_lightintensity),u_lightcolor:new h.aN(m,e.u_lightcolor),u_vertical_gradient:new h.aI(m,e.u_vertical_gradient),u_height_factor:new h.aI(m,e.u_height_factor),u_image:new h.aH(m,e.u_image),u_texsize:new h.aO(m,e.u_texsize),u_pixel_coord_upper:new h.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(m,e.u_pixel_coord_lower),u_scale:new h.aN(m,e.u_scale),u_fade:new h.aI(m,e.u_fade),u_opacity:new h.aI(m,e.u_opacity)}),fill:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix)}),fillPattern:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_image:new h.aH(m,e.u_image),u_texsize:new h.aO(m,e.u_texsize),u_pixel_coord_upper:new h.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(m,e.u_pixel_coord_lower),u_scale:new h.aN(m,e.u_scale),u_fade:new h.aI(m,e.u_fade)}),fillOutline:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_world:new h.aO(m,e.u_world)}),fillOutlinePattern:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_world:new h.aO(m,e.u_world),u_image:new h.aH(m,e.u_image),u_texsize:new h.aO(m,e.u_texsize),u_pixel_coord_upper:new h.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(m,e.u_pixel_coord_lower),u_scale:new h.aN(m,e.u_scale),u_fade:new h.aI(m,e.u_fade)}),circle:(m,e)=>({u_camera_to_center_distance:new h.aI(m,e.u_camera_to_center_distance),u_scale_with_map:new h.aH(m,e.u_scale_with_map),u_pitch_with_map:new h.aH(m,e.u_pitch_with_map),u_extrude_scale:new h.aO(m,e.u_extrude_scale),u_device_pixel_ratio:new h.aI(m,e.u_device_pixel_ratio),u_matrix:new h.aJ(m,e.u_matrix)}),collisionBox:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_pixel_extrude_scale:new h.aO(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_inv_matrix:new h.aJ(m,e.u_inv_matrix),u_camera_to_center_distance:new h.aI(m,e.u_camera_to_center_distance),u_viewport_size:new h.aO(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new h.aL(m,e.u_color),u_matrix:new h.aJ(m,e.u_matrix),u_overlay:new h.aH(m,e.u_overlay),u_overlay_scale:new h.aI(m,e.u_overlay_scale)}),clippingMask:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix)}),heatmap:(m,e)=>({u_extrude_scale:new h.aI(m,e.u_extrude_scale),u_intensity:new h.aI(m,e.u_intensity),u_matrix:new h.aJ(m,e.u_matrix)}),heatmapTexture:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_world:new h.aO(m,e.u_world),u_image:new h.aH(m,e.u_image),u_color_ramp:new h.aH(m,e.u_color_ramp),u_opacity:new h.aI(m,e.u_opacity)}),hillshade:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_image:new h.aH(m,e.u_image),u_latrange:new h.aO(m,e.u_latrange),u_light:new h.aO(m,e.u_light),u_shadow:new h.aL(m,e.u_shadow),u_highlight:new h.aL(m,e.u_highlight),u_accent:new h.aL(m,e.u_accent)}),hillshadePrepare:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_image:new h.aH(m,e.u_image),u_dimension:new h.aO(m,e.u_dimension),u_zoom:new h.aI(m,e.u_zoom),u_unpack:new h.aK(m,e.u_unpack)}),line:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_ratio:new h.aI(m,e.u_ratio),u_device_pixel_ratio:new h.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_ratio:new h.aI(m,e.u_ratio),u_device_pixel_ratio:new h.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(m,e.u_units_to_pixels),u_image:new h.aH(m,e.u_image),u_image_height:new h.aI(m,e.u_image_height)}),linePattern:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_texsize:new h.aO(m,e.u_texsize),u_ratio:new h.aI(m,e.u_ratio),u_device_pixel_ratio:new h.aI(m,e.u_device_pixel_ratio),u_image:new h.aH(m,e.u_image),u_units_to_pixels:new h.aO(m,e.u_units_to_pixels),u_scale:new h.aN(m,e.u_scale),u_fade:new h.aI(m,e.u_fade)}),lineSDF:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_ratio:new h.aI(m,e.u_ratio),u_device_pixel_ratio:new h.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(m,e.u_units_to_pixels),u_patternscale_a:new h.aO(m,e.u_patternscale_a),u_patternscale_b:new h.aO(m,e.u_patternscale_b),u_sdfgamma:new h.aI(m,e.u_sdfgamma),u_image:new h.aH(m,e.u_image),u_tex_y_a:new h.aI(m,e.u_tex_y_a),u_tex_y_b:new h.aI(m,e.u_tex_y_b),u_mix:new h.aI(m,e.u_mix)}),raster:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_tl_parent:new h.aO(m,e.u_tl_parent),u_scale_parent:new h.aI(m,e.u_scale_parent),u_buffer_scale:new h.aI(m,e.u_buffer_scale),u_fade_t:new h.aI(m,e.u_fade_t),u_opacity:new h.aI(m,e.u_opacity),u_image0:new h.aH(m,e.u_image0),u_image1:new h.aH(m,e.u_image1),u_brightness_low:new h.aI(m,e.u_brightness_low),u_brightness_high:new h.aI(m,e.u_brightness_high),u_saturation_factor:new h.aI(m,e.u_saturation_factor),u_contrast_factor:new h.aI(m,e.u_contrast_factor),u_spin_weights:new h.aN(m,e.u_spin_weights)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new h.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(m,e.u_is_size_feature_constant),u_size_t:new h.aI(m,e.u_size_t),u_size:new h.aI(m,e.u_size),u_camera_to_center_distance:new h.aI(m,e.u_camera_to_center_distance),u_pitch:new h.aI(m,e.u_pitch),u_rotate_symbol:new h.aH(m,e.u_rotate_symbol),u_aspect_ratio:new h.aI(m,e.u_aspect_ratio),u_fade_change:new h.aI(m,e.u_fade_change),u_matrix:new h.aJ(m,e.u_matrix),u_label_plane_matrix:new h.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(m,e.u_coord_matrix),u_is_text:new h.aH(m,e.u_is_text),u_pitch_with_map:new h.aH(m,e.u_pitch_with_map),u_is_along_line:new h.aH(m,e.u_is_along_line),u_is_variable_anchor:new h.aH(m,e.u_is_variable_anchor),u_texsize:new h.aO(m,e.u_texsize),u_texture:new h.aH(m,e.u_texture),u_translation:new h.aO(m,e.u_translation),u_pitched_scale:new h.aI(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new h.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(m,e.u_is_size_feature_constant),u_size_t:new h.aI(m,e.u_size_t),u_size:new h.aI(m,e.u_size),u_camera_to_center_distance:new h.aI(m,e.u_camera_to_center_distance),u_pitch:new h.aI(m,e.u_pitch),u_rotate_symbol:new h.aH(m,e.u_rotate_symbol),u_aspect_ratio:new h.aI(m,e.u_aspect_ratio),u_fade_change:new h.aI(m,e.u_fade_change),u_matrix:new h.aJ(m,e.u_matrix),u_label_plane_matrix:new h.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(m,e.u_coord_matrix),u_is_text:new h.aH(m,e.u_is_text),u_pitch_with_map:new h.aH(m,e.u_pitch_with_map),u_is_along_line:new h.aH(m,e.u_is_along_line),u_is_variable_anchor:new h.aH(m,e.u_is_variable_anchor),u_texsize:new h.aO(m,e.u_texsize),u_texture:new h.aH(m,e.u_texture),u_gamma_scale:new h.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new h.aI(m,e.u_device_pixel_ratio),u_is_halo:new h.aH(m,e.u_is_halo),u_translation:new h.aO(m,e.u_translation),u_pitched_scale:new h.aI(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new h.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(m,e.u_is_size_feature_constant),u_size_t:new h.aI(m,e.u_size_t),u_size:new h.aI(m,e.u_size),u_camera_to_center_distance:new h.aI(m,e.u_camera_to_center_distance),u_pitch:new h.aI(m,e.u_pitch),u_rotate_symbol:new h.aH(m,e.u_rotate_symbol),u_aspect_ratio:new h.aI(m,e.u_aspect_ratio),u_fade_change:new h.aI(m,e.u_fade_change),u_matrix:new h.aJ(m,e.u_matrix),u_label_plane_matrix:new h.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(m,e.u_coord_matrix),u_is_text:new h.aH(m,e.u_is_text),u_pitch_with_map:new h.aH(m,e.u_pitch_with_map),u_is_along_line:new h.aH(m,e.u_is_along_line),u_is_variable_anchor:new h.aH(m,e.u_is_variable_anchor),u_texsize:new h.aO(m,e.u_texsize),u_texsize_icon:new h.aO(m,e.u_texsize_icon),u_texture:new h.aH(m,e.u_texture),u_texture_icon:new h.aH(m,e.u_texture_icon),u_gamma_scale:new h.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new h.aI(m,e.u_device_pixel_ratio),u_is_halo:new h.aH(m,e.u_is_halo),u_translation:new h.aO(m,e.u_translation),u_pitched_scale:new h.aI(m,e.u_pitched_scale)}),background:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_opacity:new h.aI(m,e.u_opacity),u_color:new h.aL(m,e.u_color)}),backgroundPattern:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_opacity:new h.aI(m,e.u_opacity),u_image:new h.aH(m,e.u_image),u_pattern_tl_a:new h.aO(m,e.u_pattern_tl_a),u_pattern_br_a:new h.aO(m,e.u_pattern_br_a),u_pattern_tl_b:new h.aO(m,e.u_pattern_tl_b),u_pattern_br_b:new h.aO(m,e.u_pattern_br_b),u_texsize:new h.aO(m,e.u_texsize),u_mix:new h.aI(m,e.u_mix),u_pattern_size_a:new h.aO(m,e.u_pattern_size_a),u_pattern_size_b:new h.aO(m,e.u_pattern_size_b),u_scale_a:new h.aI(m,e.u_scale_a),u_scale_b:new h.aI(m,e.u_scale_b),u_pixel_coord_upper:new h.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new h.aI(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_texture:new h.aH(m,e.u_texture),u_ele_delta:new h.aI(m,e.u_ele_delta),u_fog_matrix:new h.aJ(m,e.u_fog_matrix),u_fog_color:new h.aL(m,e.u_fog_color),u_fog_ground_blend:new h.aI(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.aI(m,e.u_fog_ground_blend_opacity),u_horizon_color:new h.aL(m,e.u_horizon_color),u_horizon_fog_blend:new h.aI(m,e.u_horizon_fog_blend)}),terrainDepth:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_ele_delta:new h.aI(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_matrix:new h.aJ(m,e.u_matrix),u_texture:new h.aH(m,e.u_texture),u_terrain_coords_id:new h.aI(m,e.u_terrain_coords_id),u_ele_delta:new h.aI(m,e.u_ele_delta)}),sky:(m,e)=>({u_sky_color:new h.aL(m,e.u_sky_color),u_horizon_color:new h.aL(m,e.u_horizon_color),u_horizon:new h.aI(m,e.u_horizon),u_sky_horizon_blend:new h.aI(m,e.u_sky_horizon_blend)})};class da{constructor(e,s,u){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $s{constructor(e,s,u,d){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=d,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let u=0;u<this.attributes.length;u++){const d=s.attributes[this.attributes[u].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,s,u){for(let d=0;d<this.attributes.length;d++){const p=this.attributes[d],S=s.attributes[p.name];S!==void 0&&e.vertexAttribPointer(S,p.components,e[Yc[p.type]],!1,this.itemSize,p.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fa=new WeakMap;function pa(m){var e;if(fa.has(m))return fa.get(m);{const s=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return fa.set(m,s),s}}class Or{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ho extends Or{getDefault(){return h.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Jc extends Or{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ns extends Or{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Wl extends Or{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Xl extends Or{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Zo extends Or{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class yo extends Or{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class qs extends Or{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Yl extends Or{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class Uu extends Or{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ws extends Or{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class Wo extends Or{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ma extends Or{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class Xo extends Or{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Jl extends Or{getDefault(){return h.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class $n extends Or{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Da extends Or{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class _o extends Or{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class vo extends Or{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Yo extends Or{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Vu extends Or{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Ql extends Or{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class xo extends Or{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Jo extends Or{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class za extends Or{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Qo extends Or{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ks extends Or{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Bi extends Or{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const u=this.gl;pa(u)?u.bindVertexArray(e):(s=u.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class wo extends Or{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class el extends Or{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class eu extends Or{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Gs extends Or{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class Hs extends Gs{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class bs extends Gs{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class bo extends Gs{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class tu{constructor(e,s,u,d,p){this.context=e,this.width=s,this.height=u;const S=e.gl,T=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new Hs(e,T),d)this.depthAttachment=p?new bo(e,T):new bs(e,T);else if(p)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class gn{constructor(e,s,u){this.blendFunction=e,this.blendColor=s,this.mask=u}}gn.Replace=[1,0],gn.disabled=new gn(gn.Replace,h.aM.transparent,[!1,!1,!1,!1]),gn.unblended=new gn(gn.Replace,h.aM.transparent,[!0,!0,!0,!0]),gn.alphaBlended=new gn([1,771],h.aM.transparent,[!0,!0,!0,!0]);class $u{constructor(e){var s,u;if(this.gl=e,this.clearColor=new Ho(this),this.clearDepth=new Jc(this),this.clearStencil=new ns(this),this.colorMask=new Wl(this),this.depthMask=new Xl(this),this.stencilMask=new Zo(this),this.stencilFunc=new yo(this),this.stencilOp=new qs(this),this.stencilTest=new Yl(this),this.depthRange=new Uu(this),this.depthTest=new ws(this),this.depthFunc=new Wo(this),this.blend=new Ma(this),this.blendFunc=new Xo(this),this.blendColor=new Jl(this),this.blendEquation=new $n(this),this.cullFace=new Da(this),this.cullFaceSide=new _o(this),this.frontFace=new vo(this),this.program=new Yo(this),this.activeTexture=new Vu(this),this.viewport=new Ql(this),this.bindFramebuffer=new xo(this),this.bindRenderbuffer=new Jo(this),this.bindTexture=new za(this),this.bindVertexBuffer=new Qo(this),this.bindElementBuffer=new Ks(this),this.bindVertexArray=new Bi(this),this.pixelStoreUnpack=new wo(this),this.pixelStoreUnpackPremultiplyAlpha=new el(this),this.pixelStoreUnpackFlipY=new eu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),pa(e)){this.HALF_FLOAT=e.HALF_FLOAT;const d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:d?.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:d?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new da(this,e,s)}createVertexBuffer(e,s,u){return new $s(this,e,s,u)}createRenderbuffer(e,s,u){const d=this.gl,p=d.createRenderbuffer();return this.bindRenderbuffer.set(p),d.renderbufferStorage(d.RENDERBUFFER,e,s,u),this.bindRenderbuffer.set(null),p}createFramebuffer(e,s,u,d){return new tu(this,e,s,u,d)}clear({color:e,depth:s,stencil:u}){const d=this.gl;let p=0;e&&(p|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u!==void 0&&(p|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){h.aE(e.blendFunction,gn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return pa(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return pa(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class yr{constructor(e,s,u){this.func=e,this.mask=s,this.range=u}}yr.ReadOnly=!1,yr.ReadWrite=!0,yr.disabled=new yr(519,yr.ReadOnly,[0,1]);const So=7680;class Gr{constructor(e,s,u,d,p,S){this.test=e,this.ref=s,this.mask=u,this.fail=d,this.depthFail=p,this.pass=S}}Gr.disabled=new Gr({func:519,mask:0},0,0,So,So,So);class $r{constructor(e,s,u){this.enable=e,this.mode=s,this.frontFace=u}}let is;function Ss(m,e,s,u,d){const p=m.context,S=p.gl,T=m.useProgram("collisionBox"),I=[];let M=0,L=0;for(let oe=0;oe<u.length;oe++){const de=u[oe],Q=e.getTile(de).getBucket(s);if(!Q)continue;const we=d?Q.textCollisionBox:Q.iconCollisionBox,Ie=Q.collisionCircleArray;if(Ie.length>0){const Re=h.H();h.aQ(Re,Q.placementInvProjMatrix,m.transform.glCoordMatrix),h.aQ(Re,Re,Q.placementViewportMatrix),I.push({circleArray:Ie,circleOffset:L,transform:de.posMatrix,invTransform:Re,coord:de}),M+=Ie.length/4,L=M}we&&T.draw(p,S.LINES,yr.disabled,Gr.disabled,m.colorModeForRenderPass(),$r.disabled,{u_matrix:de.posMatrix,u_pixel_extrude_scale:[1/(R=m.transform).width,1/R.height]},m.style.map.terrain&&m.style.map.terrain.getTerrainData(de),s.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,m.transform.zoom,null,null,we.collisionVertexBuffer)}var R;if(!d||!I.length)return;const V=m.useProgram("collisionCircle"),Z=new h.aR;Z.resize(4*M),Z._trim();let X=0;for(const oe of I)for(let de=0;de<oe.circleArray.length/4;de++){const Q=4*de,we=oe.circleArray[Q+0],Ie=oe.circleArray[Q+1],Re=oe.circleArray[Q+2],Xe=oe.circleArray[Q+3];Z.emplace(X++,we,Ie,Re,Xe,0),Z.emplace(X++,we,Ie,Re,Xe,1),Z.emplace(X++,we,Ie,Re,Xe,2),Z.emplace(X++,we,Ie,Re,Xe,3)}(!is||is.length<2*M)&&(is=function(oe){const de=2*oe,Q=new h.aT;Q.resize(de),Q._trim();for(let we=0;we<de;we++){const Ie=6*we;Q.uint16[Ie+0]=4*we+0,Q.uint16[Ie+1]=4*we+1,Q.uint16[Ie+2]=4*we+2,Q.uint16[Ie+3]=4*we+2,Q.uint16[Ie+4]=4*we+3,Q.uint16[Ie+5]=4*we+0}return Q}(M));const re=p.createIndexBuffer(is,!0),ae=p.createVertexBuffer(Z,h.aS.members,!0);for(const oe of I){const de=ha(oe.transform,oe.invTransform,m.transform);V.draw(p,S.TRIANGLES,yr.disabled,Gr.disabled,m.colorModeForRenderPass(),$r.disabled,de,m.style.map.terrain&&m.style.map.terrain.getTerrainData(oe.coord),s.id,ae,re,h.a0.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,m.transform.zoom,null,null,null)}ae.destroy(),re.destroy()}$r.disabled=new $r(!1,1029,2305),$r.backCCW=new $r(!0,1029,2305);const Zs=h.an(new Float32Array(16));function tl(m,e,s,u,d,p){const{horizontalAlign:S,verticalAlign:T}=h.au(m);return new h.P((-(S-.5)*e/d+u[0])*p,(-(T-.5)*s/d+u[1])*p)}function ks(m,e,s,u,d,p){const S=e.tileAnchorPoint.add(new h.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let T=u.mult(p);s||(T=T.rotate(-d));const I=S.add(T);return ne(I.x,I.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const T=Oe(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),I=Math.atan(T.y/T.x)+(T.x<0?Math.PI:0);return m.add(u.rotate(I))}return m.add(u)}function Ws(m,e,s,u,d,p,S,T,I,M,L,R,V,Z){const X=m.text.placedSymbolArray,re=m.text.dynamicLayoutVertexArray,ae=m.icon.dynamicLayoutVertexArray,oe={};re.clear();for(let de=0;de<X.length;de++){const Q=X.get(de),we=Q.hidden||!Q.crossTileID||m.allowVerticalPlacement&&!Q.placedOrientation?null:u[Q.crossTileID];if(we){const Ie=new h.P(Q.anchorX,Q.anchorY),Re={getElevation:Z,width:d.width,height:d.height,labelPlaneMatrix:p,pitchWithMap:s,projection:L,tileAnchorPoint:Ie,translation:R,unwrappedTileID:V},Xe=s?ne(Ie.x,Ie.y,S,Z):Oe(Ie.x,Ie.y,Re),st=N(d.cameraToCenterDistance,Xe.signedDistanceFromCamera);let xt=h.ai(m.textSizeData,I,Q)*st/h.ap;s&&(xt*=m.tilePixelRatio/T);const{width:Et,height:mt,anchor:pt,textOffset:Nt,textBoxScale:or}=we,_t=tl(pt,Et,mt,Nt,or,xt),Ct=L.getPitchedTextCorrection(d,Ie.add(new h.P(R[0],R[1])),V),ir=ks(Xe.point,Re,e,_t,d.angle,Ct),ln=m.allowVerticalPlacement&&Q.placedOrientation===h.ah.vertical?Math.PI/2:0;for(let mr=0;mr<Q.numGlyphs;mr++)h.aj(re,ir,ln);M&&Q.associatedIconIndex>=0&&(oe[Q.associatedIconIndex]={shiftedAnchor:ir,angle:ln})}else $t(Q.numGlyphs,re)}if(M){ae.clear();const de=m.icon.placedSymbolArray;for(let Q=0;Q<de.length;Q++){const we=de.get(Q);if(we.hidden)$t(we.numGlyphs,ae);else{const Ie=oe[Q];if(Ie)for(let Re=0;Re<we.numGlyphs;Re++)h.aj(ae,Ie.shiftedAnchor,Ie.angle);else $t(we.numGlyphs,ae)}}m.icon.dynamicLayoutVertexBuffer.updateData(ae)}m.text.dynamicLayoutVertexBuffer.updateData(re)}function Ni(m,e,s){return s.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Xs(m,e,s,u,d,p,S,T,I,M,L,R){const V=m.context,Z=V.gl,X=m.transform,re=Ya(),ae=T==="map",oe=I==="map",de=T!=="viewport"&&s.layout.get("symbol-placement")!=="point",Q=ae&&!oe&&!de,we=!oe&&de,Ie=!s.layout.get("symbol-sort-key").isConstant();let Re=!1;const Xe=m.depthModeForSublayer(0,yr.ReadOnly),st=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),xt=[],Et=re.getCircleRadiusCorrection(X);for(const mt of u){const pt=e.getTile(mt),Nt=pt.getBucket(s);if(!Nt)continue;const or=d?Nt.text:Nt.icon;if(!or||!or.segments.get().length||!or.hasVisibleVertices)continue;const _t=or.programConfigurations.get(s.id),Ct=d||Nt.sdfIcons,ir=d?Nt.textSizeData:Nt.iconSizeData,ln=oe||X.pitch!==0,mr=m.useProgram(Ni(Ct,d,Nt),_t),Cr=h.ag(ir,X.zoom),un=m.style.map.terrain&&m.style.map.terrain.getTerrainData(mt);let di,Oa,cn,ji,Ci=[0,0],fi=null;if(d)Oa=pt.glyphAtlasTexture,cn=Z.LINEAR,di=pt.glyphAtlasTexture.size,Nt.iconsInText&&(Ci=pt.imageAtlasTexture.size,fi=pt.imageAtlasTexture,ji=ln||m.options.rotating||m.options.zooming||ir.kind==="composite"||ir.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const Pr=s.layout.get("icon-size").constantOr(0)!==1||Nt.iconsNeedLinear;Oa=pt.imageAtlasTexture,cn=Ct||m.options.rotating||m.options.zooming||Pr||ln?Z.LINEAR:Z.NEAREST,di=pt.imageAtlasTexture.size}const Ti=hr(pt,1,m.transform.zoom),us=we?mt.posMatrix:Zs,ll=ca(us,oe,ae,m.transform,Ti),Qu=Xi(us,oe,ae,m.transform,Ti),ul=Xi(mt.posMatrix,oe,ae,m.transform,Ti),va=re.translatePosition(m.transform,pt,p,S),ec=st&&Nt.hasTextData(),mh=s.layout.get("icon-text-fit")!=="none"&&ec&&Nt.hasIconData();if(de){const Pr=m.style.map.terrain?(cl,hl)=>m.style.map.terrain.getElevation(mt,cl,hl):null,Po=s.layout.get("text-rotation-alignment")==="map";H(Nt,mt.posMatrix,m,d,ll,ul,oe,M,Po,re,mt.toUnwrapped(),X.width,X.height,va,Pr)}const xa=mt.posMatrix,wa=d&&st||mh,Js=de||wa?Zs:ll,Fa=Qu,si=Ct&&s.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let pi;pi=Ct?Nt.iconsInText?mo(ir.kind,Cr,Q,oe,de,wa,m,xa,Js,Fa,va,di,Ci,Et):Aa(ir.kind,Cr,Q,oe,de,wa,m,xa,Js,Fa,va,d,di,!0,Et):Go(ir.kind,Cr,Q,oe,de,wa,m,xa,Js,Fa,va,d,di,Et);const ra={program:mr,buffers:or,uniformValues:pi,atlasTexture:Oa,atlasTextureIcon:fi,atlasInterpolation:cn,atlasInterpolationIcon:ji,isSDF:Ct,hasHalo:si};if(Ie&&Nt.canOverlap){Re=!0;const Pr=or.segments.get();for(const Po of Pr)xt.push({segments:new h.a0([Po]),sortKey:Po.sortKey,state:ra,terrainData:un})}else xt.push({segments:or.segments,sortKey:0,state:ra,terrainData:un})}Re&&xt.sort((mt,pt)=>mt.sortKey-pt.sortKey);for(const mt of xt){const pt=mt.state;if(V.activeTexture.set(Z.TEXTURE0),pt.atlasTexture.bind(pt.atlasInterpolation,Z.CLAMP_TO_EDGE),pt.atlasTextureIcon&&(V.activeTexture.set(Z.TEXTURE1),pt.atlasTextureIcon&&pt.atlasTextureIcon.bind(pt.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),pt.isSDF){const Nt=pt.uniformValues;pt.hasHalo&&(Nt.u_is_halo=1,Qi(pt.buffers,mt.segments,s,m,pt.program,Xe,L,R,Nt,mt.terrainData)),Nt.u_is_halo=0}Qi(pt.buffers,mt.segments,s,m,pt.program,Xe,L,R,pt.uniformValues,mt.terrainData)}}function Qi(m,e,s,u,d,p,S,T,I,M){const L=u.context;d.draw(L,L.gl.TRIANGLES,p,S,T,$r.disabled,I,M,s.id,m.layoutVertexBuffer,m.indexBuffer,e,s.paint,u.transform.zoom,m.programConfigurations.get(s.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function pn(m,e,s,u){const d=m.context,p=d.gl,S=Gr.disabled,T=new gn([p.ONE,p.ONE],h.aM.transparent,[!0,!0,!0,!0]),I=e.getBucket(s);if(!I)return;const M=u.key;let L=s.heatmapFbos.get(M);L||(L=Zn(d,e.tileSize,e.tileSize),s.heatmapFbos.set(M,L)),d.bindFramebuffer.set(L.framebuffer),d.viewport.set([0,0,e.tileSize,e.tileSize]),d.clear({color:h.aM.transparent});const R=I.programConfigurations.get(s.id),V=m.useProgram("heatmap",R),Z=m.style.map.terrain.getTerrainData(u);V.draw(d,p.TRIANGLES,yr.disabled,S,T,$r.disabled,ii(u.posMatrix,e,m.transform.zoom,s.paint.get("heatmap-intensity")),Z,s.id,I.layoutVertexBuffer,I.indexBuffer,I.segments,s.paint,m.transform.zoom,R)}function ma(m,e,s){const u=m.context,d=u.gl;u.setColorMode(m.colorModeForRenderPass());const p=ko(u,e),S=s.key,T=e.heatmapFbos.get(S);T&&(u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,T.colorAttachment.get()),u.activeTexture.set(d.TEXTURE1),p.bind(d.LINEAR,d.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(u,d.TRIANGLES,yr.disabled,Gr.disabled,m.colorModeForRenderPass(),$r.disabled,vn(m,e,0,1),null,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,m.transform.zoom),T.destroy(),e.heatmapFbos.delete(S))}function Zn(m,e,s){var u,d;const p=m.gl,S=p.createTexture();p.bindTexture(p.TEXTURE_2D,S),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const T=(u=m.HALF_FLOAT)!==null&&u!==void 0?u:p.UNSIGNED_BYTE,I=(d=m.RGBA16F)!==null&&d!==void 0?d:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,I,e,s,0,p.RGBA,T,null);const M=m.createFramebuffer(e,s,!1,!1);return M.colorAttachment.set(S),M}function ko(m,e){return e.colorRampTexture||(e.colorRampTexture=new Ye(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function as(m,e,s,u,d){if(!s||!u||!u.imageAtlas)return;const p=u.imageAtlas.patternPositions;let S=p[s.to.toString()],T=p[s.from.toString()];if(!S&&T&&(S=T),!T&&S&&(T=S),!S||!T){const I=d.getPaintProperty(e);S=p[I],T=p[I]}S&&T&&m.setConstantPatternPositions(S,T)}function Ys(m,e,s,u,d,p,S){const T=m.context.gl,I="fill-pattern",M=s.paint.get(I),L=M&&M.constantOr(1),R=s.getCrossfadeParameters();let V,Z,X,re,ae;S?(Z=L&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=T.LINES):(Z=L?"fillPattern":"fill",V=T.TRIANGLES);const oe=M.constantOr(null);for(const de of u){const Q=e.getTile(de);if(L&&!Q.patternsLoaded())continue;const we=Q.getBucket(s);if(!we)continue;const Ie=we.programConfigurations.get(s.id),Re=m.useProgram(Z,Ie),Xe=m.style.map.terrain&&m.style.map.terrain.getTerrainData(de);L&&(m.context.activeTexture.set(T.TEXTURE0),Q.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Ie.updatePaintBuffers(R)),as(Ie,I,oe,Q,s);const st=Xe?de:null,xt=m.translatePosMatrix(st?st.posMatrix:de.posMatrix,Q,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(S){re=we.indexBuffer2,ae=we.segments2;const Et=[T.drawingBufferWidth,T.drawingBufferHeight];X=Z==="fillOutlinePattern"&&L?hi(xt,m,R,Q,Et):Xc(xt,Et)}else re=we.indexBuffer,ae=we.segments,X=L?Bu(xt,m,R,Q):vs(xt);Re.draw(m.context,V,d,m.stencilModeForClipping(de),p,$r.disabled,X,Xe,s.id,we.layoutVertexBuffer,re,ae,s.paint,m.transform.zoom,Ie)}}function ga(m,e,s,u,d,p,S){const T=m.context,I=T.gl,M="fill-extrusion-pattern",L=s.paint.get(M),R=L.constantOr(1),V=s.getCrossfadeParameters(),Z=s.paint.get("fill-extrusion-opacity"),X=L.constantOr(null);for(const re of u){const ae=e.getTile(re),oe=ae.getBucket(s);if(!oe)continue;const de=m.style.map.terrain&&m.style.map.terrain.getTerrainData(re),Q=oe.programConfigurations.get(s.id),we=m.useProgram(R?"fillExtrusionPattern":"fillExtrusion",Q);R&&(m.context.activeTexture.set(I.TEXTURE0),ae.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Q.updatePaintBuffers(V)),as(Q,M,X,ae,s);const Ie=m.translatePosMatrix(re.posMatrix,ae,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Re=s.paint.get("fill-extrusion-vertical-gradient"),Xe=R?Dr(Ie,m,Re,Z,re,V,ae):po(Ie,m,Re,Z);we.draw(T,T.gl.TRIANGLES,d,p,S,$r.backCCW,Xe,de,s.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,s.paint,m.transform.zoom,Q,m.style.map.terrain&&oe.centroidVertexBuffer)}}function ss(m,e,s,u,d,p,S){const T=m.context,I=T.gl,M=s.fbo;if(!M)return;const L=m.useProgram("hillshade"),R=m.style.map.terrain&&m.style.map.terrain.getTerrainData(e);T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,M.colorAttachment.get()),L.draw(T,I.TRIANGLES,d,p,S,$r.disabled,((V,Z,X,re)=>{const ae=X.paint.get("hillshade-shadow-color"),oe=X.paint.get("hillshade-highlight-color"),de=X.paint.get("hillshade-accent-color");let Q=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);X.paint.get("hillshade-illumination-anchor")==="viewport"&&(Q-=V.transform.angle);const we=!V.options.moving;return{u_matrix:re?re.posMatrix:V.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),we),u_image:0,u_latrange:ki(0,Z.tileID),u_light:[X.paint.get("hillshade-exaggeration"),Q],u_shadow:ae,u_highlight:oe,u_accent:de}})(m,s,u,R?e:null),R,u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function ea(m,e,s,u,d,p){const S=m.context,T=S.gl,I=e.dem;if(I&&I.data){const M=I.dim,L=I.stride,R=I.getPixels();if(S.activeTexture.set(T.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||m.getTileTexture(L),e.demTexture){const Z=e.demTexture;Z.update(R,{premultiply:!1}),Z.bind(T.NEAREST,T.CLAMP_TO_EDGE)}else e.demTexture=new Ye(S,R,T.RGBA,{premultiply:!1}),e.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);S.activeTexture.set(T.TEXTURE0);let V=e.fbo;if(!V){const Z=new Ye(S,{width:M,height:M,data:null},T.RGBA);Z.bind(T.LINEAR,T.CLAMP_TO_EDGE),V=e.fbo=S.createFramebuffer(M,M,!0,!1),V.colorAttachment.set(Z.texture)}S.bindFramebuffer.set(V.framebuffer),S.viewport.set([0,0,M,M]),m.useProgram("hillshadePrepare").draw(S,T.TRIANGLES,u,d,p,$r.disabled,((Z,X)=>{const re=X.stride,ae=h.H();return h.aP(ae,0,h.X,-h.X,0,0,1),h.J(ae,ae,[0,-h.X,0]),{u_matrix:ae,u_image:1,u_dimension:[re,re],u_zoom:Z.overscaledZ,u_unpack:X.getUnpackVector()}})(e.tileID,I),null,s.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function La(m,e,s,u,d,p){const S=u.paint.get("raster-fade-duration");if(!p&&S>0){const T=Y.now(),I=(T-m.timeAdded)/S,M=e?(T-e.timeAdded)/S:-1,L=s.getSource(),R=d.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),V=!e||Math.abs(e.tileID.overscaledZ-R)>Math.abs(m.tileID.overscaledZ-R),Z=V&&m.refreshedUponExpiration?1:h.ac(V?I:1-M,0,1);return m.refreshedUponExpiration&&I>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const rl=new h.aM(1,0,0,1),v=new h.aM(0,1,0,1),k=new h.aM(0,0,1,1),E=new h.aM(1,0,1,1),D=new h.aM(0,1,1,1);function F(m,e,s,u){J(m,0,e+s/2,m.transform.width,s,u)}function $(m,e,s,u){J(m,e-s/2,0,s,m.transform.height,u)}function J(m,e,s,u,d,p){const S=m.context,T=S.gl;T.enable(T.SCISSOR_TEST),T.scissor(e*m.pixelRatio,s*m.pixelRatio,u*m.pixelRatio,d*m.pixelRatio),S.clear({color:p}),T.disable(T.SCISSOR_TEST)}function se(m,e,s){const u=m.context,d=u.gl,p=s.posMatrix,S=m.useProgram("debug"),T=yr.disabled,I=Gr.disabled,M=m.colorModeForRenderPass(),L="$debug",R=m.style.map.terrain&&m.style.map.terrain.getTerrainData(s);u.activeTexture.set(d.TEXTURE0);const V=e.getTileByID(s.key).latestRawTileData,Z=Math.floor((V&&V.byteLength||0)/1024),X=e.getTile(s).tileSize,re=512/Math.min(X,512)*(s.overscaledZ/m.transform.zoom)*.5;let ae=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(ae+=` => ${s.overscaledZ}`),function(oe,de){oe.initDebugOverlayCanvas();const Q=oe.debugOverlayCanvas,we=oe.context.gl,Ie=oe.debugOverlayCanvas.getContext("2d");Ie.clearRect(0,0,Q.width,Q.height),Ie.shadowColor="white",Ie.shadowBlur=2,Ie.lineWidth=1.5,Ie.strokeStyle="white",Ie.textBaseline="top",Ie.font="bold 36px Open Sans, sans-serif",Ie.fillText(de,5,5),Ie.strokeText(de,5,5),oe.debugOverlayTexture.update(Q),oe.debugOverlayTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE)}(m,`${ae} ${Z}kB`),S.draw(u,d.TRIANGLES,T,I,gn.alphaBlended,$r.disabled,Fi(p,h.aM.transparent,re),null,L,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),S.draw(u,d.LINE_STRIP,T,I,M,$r.disabled,Fi(p,h.aM.red),R,L,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function ye(m,e,s){const u=m.context,d=u.gl,p=m.colorModeForRenderPass(),S=new yr(d.LEQUAL,yr.ReadWrite,m.depthRangeFor3D),T=m.useProgram("terrain"),I=e.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,m.width,m.height]);for(const M of s){const L=m.renderToTexture.getTexture(M),R=e.getTerrainData(M.tileID);u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,L.texture);const V=m.transform.calculatePosMatrix(M.tileID.toUnwrapped()),Z=e.getMeshFrameDelta(m.transform.zoom),X=m.transform.calculateFogMatrix(M.tileID.toUnwrapped()),re=Ns(V,Z,X,m.style.sky,m.transform.pitch);T.draw(u,d.TRIANGLES,S,Gr.disabled,p,$r.backCCW,re,R,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}class xe{constructor(e,s,u){this.vertexBuffer=e,this.indexBuffer=s,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Ee{constructor(e,s){this.context=new $u(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ht.maxUnderzooming+Ht.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ko}resize(e,s,u){if(this.width=Math.floor(e*u),this.height=Math.floor(s*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,s=new h.aX;s.emplaceBack(0,0),s.emplaceBack(h.X,0),s.emplaceBack(0,h.X),s.emplaceBack(h.X,h.X),this.tileExtentBuffer=e.createVertexBuffer(s,Yi.members),this.tileExtentSegments=h.a0.simpleSegment(0,0,4,2);const u=new h.aX;u.emplaceBack(0,0),u.emplaceBack(h.X,0),u.emplaceBack(0,h.X),u.emplaceBack(h.X,h.X),this.debugBuffer=e.createVertexBuffer(u,Yi.members),this.debugSegments=h.a0.simpleSegment(0,0,4,5);const d=new h.$;d.emplaceBack(0,0,0,0),d.emplaceBack(h.X,0,h.X,0),d.emplaceBack(0,h.X,0,h.X),d.emplaceBack(h.X,h.X,h.X,h.X),this.rasterBoundsBuffer=e.createVertexBuffer(d,Sn.members),this.rasterBoundsSegments=h.a0.simpleSegment(0,0,4,2);const p=new h.aX;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(p,Yi.members),this.viewportSegments=h.a0.simpleSegment(0,0,4,2);const S=new h.aZ;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(S);const T=new h.aY;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);const I=this.context.gl;this.stencilClearMode=new Gr({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=h.H();h.aP(u,0,this.width,this.height,0,0,1),h.K(u,u,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,yr.disabled,this.stencilClearMode,gn.disabled,$r.disabled,ni(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const u=this.context,d=u.gl;this.nextStencilID+s.length>256&&this.clearStencil(),u.setColorMode(gn.disabled),u.setDepthMode(yr.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of s){const T=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S);p.draw(u,d.TRIANGLES,yr.disabled,new Gr({func:d.ALWAYS,mask:0},T,255,d.KEEP,d.KEEP,d.REPLACE),gn.disabled,$r.disabled,ni(S.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Gr({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Gr({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,u=e.sort((S,T)=>T.overscaledZ-S.overscaledZ),d=u[u.length-1].overscaledZ,p=u[0].overscaledZ-d+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const S={};for(let T=0;T<p;T++)S[T+d]=new Gr({func:s.GEQUAL,mask:255},T+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=p,[S,u]}return[{[d]:Gr.disabled},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new gn([e.CONSTANT_COLOR,e.ONE],new h.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?gn.unblended:gn.alphaBlended}depthModeForSublayer(e,s,u){if(!this.opaquePassEnabledForLayer())return yr.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new yr(u||this.context.gl.LEQUAL,s,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Y.now()),this.imageManager.beginFrame();const u=this.style._order,d=this.style.sourceCaches,p={},S={},T={};for(const I in d){const M=d[I];M.used&&M.prepare(this.context),p[I]=M.getVisibleCoordinates(),S[I]=p[I].slice().reverse(),T[I]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<u.length;I++)if(this.style._layers[u[I]].is3D()){this.opaquePassCutoff=I;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const I of u){const M=this.style._layers[I];if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const L=S[M.source];(M.type==="custom"||L.length)&&this.renderLayer(this,d[M.source],M,L)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?h.aM.black:h.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(I,M){const L=I.context,R=L.gl,V=((oe,de,Q)=>({u_sky_color:oe.properties.get("sky-color"),u_horizon_color:oe.properties.get("horizon-color"),u_horizon:(de.height/2+de.getHorizon())*Q,u_sky_horizon_blend:oe.properties.get("sky-horizon-blend")*de.height/2*Q}))(M,I.style.map.transform,I.pixelRatio),Z=new yr(R.LEQUAL,yr.ReadWrite,[0,1]),X=Gr.disabled,re=I.colorModeForRenderPass(),ae=I.useProgram("sky");if(!M.mesh){const oe=new h.aX;oe.emplaceBack(-1,-1),oe.emplaceBack(1,-1),oe.emplaceBack(1,1),oe.emplaceBack(-1,1);const de=new h.aY;de.emplaceBack(0,1,2),de.emplaceBack(0,2,3),M.mesh=new xe(L.createVertexBuffer(oe,Yi.members),L.createIndexBuffer(de),h.a0.simpleSegment(0,0,oe.length,de.length))}ae.draw(L,R.TRIANGLES,Z,X,re,$r.disabled,V,void 0,"sky",M.mesh.vertexBuffer,M.mesh.indexBuffer,M.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[u[this.currentLayer]],M=d[I.source],L=p[I.source];this._renderTileClippingMasks(I,L),this.renderLayer(this,M,I,L)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const I=this.style._layers[u[this.currentLayer]],M=d[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I))continue;const L=(I.type==="symbol"?T:S)[I.source];this._renderTileClippingMasks(I,p[I.source]),this.renderLayer(this,M,I,L)}if(this.options.showTileBoundaries){const I=function(M,L){let R=null;const V=Object.values(M._layers).flatMap(ae=>ae.source&&!ae.isHidden(L)?[M.sourceCaches[ae.source]]:[]),Z=V.filter(ae=>ae.getSource().type==="vector"),X=V.filter(ae=>ae.getSource().type!=="vector"),re=ae=>{(!R||R.getSource().maxzoom<ae.getSource().maxzoom)&&(R=ae)};return Z.forEach(ae=>re(ae)),R||X.forEach(ae=>re(ae)),R}(this.style,this.transform.zoom);I&&function(M,L,R){for(let V=0;V<R.length;V++)se(M,L,R[V])}(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const M=I.transform.padding;F(I,I.transform.height-(M.top||0),3,rl),F(I,M.bottom||0,3,v),$(I,M.left||0,3,k),$(I,I.transform.width-(M.right||0),3,E);const L=I.transform.centerPoint;(function(R,V,Z,X){J(R,V-1,Z-10,2,20,X),J(R,V-10,Z-1,20,2,X)})(I,L.x,I.transform.height-L.y,D)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=e?!h.a_(s,u):!h.a$(s,u)),d||(d=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),d&&(h.b0(s,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(p,S){const T=p.context,I=T.gl,M=gn.unblended,L=new yr(I.LEQUAL,yr.ReadWrite,[0,1]),R=S.getTerrainMesh(),V=S.sourceCache.getRenderableTiles(),Z=p.useProgram("terrainDepth");T.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),T.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),T.clear({color:h.aM.transparent,depth:1});for(const X of V){const re=S.getTerrainData(X.tileID),ae={u_matrix:p.transform.calculatePosMatrix(X.tileID.toUnwrapped()),u_ele_delta:S.getMeshFrameDelta(p.transform.zoom)};Z.draw(T,I.TRIANGLES,L,Gr.disabled,M,$r.backCCW,ae,re,"terrain",R.vertexBuffer,R.indexBuffer,R.segments)}T.bindFramebuffer.set(null),T.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain),function(p,S){const T=p.context,I=T.gl,M=gn.unblended,L=new yr(I.LEQUAL,yr.ReadWrite,[0,1]),R=S.getTerrainMesh(),V=S.getCoordsTexture(),Z=S.sourceCache.getRenderableTiles(),X=p.useProgram("terrainCoords");T.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),T.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),T.clear({color:h.aM.transparent,depth:1}),S.coordsIndex=[];for(const re of Z){const ae=S.getTerrainData(re.tileID);T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,V.texture);const oe={u_matrix:p.transform.calculatePosMatrix(re.tileID.toUnwrapped()),u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(p.transform.zoom)};X.draw(T,I.TRIANGLES,L,Gr.disabled,M,$r.backCCW,oe,ae,"terrain",R.vertexBuffer,R.indexBuffer,R.segments),S.coordsIndex.push(re.tileID.key)}T.bindFramebuffer.set(null),T.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain))}renderLayer(e,s,u,d){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(d||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(p,S,T,I,M){if(p.renderPass!=="translucent")return;const L=Gr.disabled,R=p.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(V,Z,X,re,ae,oe,de,Q,we){const Ie=Z.transform,Re=Ya(),Xe=ae==="map",st=oe==="map";for(const xt of V){const Et=re.getTile(xt),mt=Et.getBucket(X);if(!mt||!mt.text||!mt.text.segments.get().length)continue;const pt=h.ag(mt.textSizeData,Ie.zoom),Nt=hr(Et,1,Z.transform.zoom),or=ca(xt.posMatrix,st,Xe,Z.transform,Nt),_t=X.layout.get("icon-text-fit")!=="none"&&mt.hasIconData();if(pt){const Ct=Math.pow(2,Ie.zoom-Et.tileID.overscaledZ),ir=Z.style.map.terrain?(mr,Cr)=>Z.style.map.terrain.getElevation(xt,mr,Cr):null,ln=Re.translatePosition(Ie,Et,de,Q);Ws(mt,Xe,st,we,Ie,or,xt.posMatrix,Ct,pt,_t,Re,ln,xt.toUnwrapped(),ir)}}}(I,p,T,S,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),M),T.paint.get("icon-opacity").constantOr(1)!==0&&Xs(p,S,T,I,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),L,R),T.paint.get("text-opacity").constantOr(1)!==0&&Xs(p,S,T,I,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),L,R),S.map.showCollisionBoxes&&(Ss(p,S,T,I,!0),Ss(p,S,T,I,!1))})(e,s,u,d,this.style.placement.variableOffsets);break;case"circle":(function(p,S,T,I){if(p.renderPass!=="translucent")return;const M=T.paint.get("circle-opacity"),L=T.paint.get("circle-stroke-width"),R=T.paint.get("circle-stroke-opacity"),V=!T.layout.get("circle-sort-key").isConstant();if(M.constantOr(1)===0&&(L.constantOr(1)===0||R.constantOr(1)===0))return;const Z=p.context,X=Z.gl,re=p.depthModeForSublayer(0,yr.ReadOnly),ae=Gr.disabled,oe=p.colorModeForRenderPass(),de=[];for(let Q=0;Q<I.length;Q++){const we=I[Q],Ie=S.getTile(we),Re=Ie.getBucket(T);if(!Re)continue;const Xe=Re.programConfigurations.get(T.id),st=p.useProgram("circle",Xe),xt=Re.layoutVertexBuffer,Et=Re.indexBuffer,mt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(we),pt={programConfiguration:Xe,program:st,layoutVertexBuffer:xt,indexBuffer:Et,uniformValues:Us(p,we,Ie,T),terrainData:mt};if(V){const Nt=Re.segments.get();for(const or of Nt)de.push({segments:new h.a0([or]),sortKey:or.sortKey,state:pt})}else de.push({segments:Re.segments,sortKey:0,state:pt})}V&&de.sort((Q,we)=>Q.sortKey-we.sortKey);for(const Q of de){const{programConfiguration:we,program:Ie,layoutVertexBuffer:Re,indexBuffer:Xe,uniformValues:st,terrainData:xt}=Q.state;Ie.draw(Z,X.TRIANGLES,re,ae,oe,$r.disabled,st,xt,T.id,Re,Xe,Q.segments,T.paint,p.transform.zoom,we)}})(e,s,u,d);break;case"heatmap":(function(p,S,T,I){if(T.paint.get("heatmap-opacity")===0)return;const M=p.context;if(p.style.map.terrain){for(const L of I){const R=S.getTile(L);S.hasRenderableParent(L)||(p.renderPass==="offscreen"?pn(p,R,T,L):p.renderPass==="translucent"&&ma(p,T,L))}M.viewport.set([0,0,p.width,p.height])}else p.renderPass==="offscreen"?function(L,R,V,Z){const X=L.context,re=X.gl,ae=Gr.disabled,oe=new gn([re.ONE,re.ONE],h.aM.transparent,[!0,!0,!0,!0]);(function(de,Q,we){const Ie=de.gl;de.activeTexture.set(Ie.TEXTURE1),de.viewport.set([0,0,Q.width/4,Q.height/4]);let Re=we.heatmapFbos.get(h.aU);Re?(Ie.bindTexture(Ie.TEXTURE_2D,Re.colorAttachment.get()),de.bindFramebuffer.set(Re.framebuffer)):(Re=Zn(de,Q.width/4,Q.height/4),we.heatmapFbos.set(h.aU,Re))})(X,L,V),X.clear({color:h.aM.transparent});for(let de=0;de<Z.length;de++){const Q=Z[de];if(R.hasRenderableParent(Q))continue;const we=R.getTile(Q),Ie=we.getBucket(V);if(!Ie)continue;const Re=Ie.programConfigurations.get(V.id),Xe=L.useProgram("heatmap",Re),{zoom:st}=L.transform;Xe.draw(X,re.TRIANGLES,yr.disabled,ae,oe,$r.disabled,ii(Q.posMatrix,we,st,V.paint.get("heatmap-intensity")),null,V.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,V.paint,L.transform.zoom,Re)}X.viewport.set([0,0,L.width,L.height])}(p,S,T,I):p.renderPass==="translucent"&&function(L,R){const V=L.context,Z=V.gl;V.setColorMode(L.colorModeForRenderPass());const X=R.heatmapFbos.get(h.aU);X&&(V.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,X.colorAttachment.get()),V.activeTexture.set(Z.TEXTURE1),ko(V,R).bind(Z.LINEAR,Z.CLAMP_TO_EDGE),L.useProgram("heatmapTexture").draw(V,Z.TRIANGLES,yr.disabled,Gr.disabled,L.colorModeForRenderPass(),$r.disabled,vn(L,R,0,1),null,R.id,L.viewportBuffer,L.quadTriangleIndexBuffer,L.viewportSegments,R.paint,L.transform.zoom))}(p,T)})(e,s,u,d);break;case"line":(function(p,S,T,I){if(p.renderPass!=="translucent")return;const M=T.paint.get("line-opacity"),L=T.paint.get("line-width");if(M.constantOr(1)===0||L.constantOr(1)===0)return;const R=p.depthModeForSublayer(0,yr.ReadOnly),V=p.colorModeForRenderPass(),Z=T.paint.get("line-dasharray"),X=T.paint.get("line-pattern"),re=X.constantOr(1),ae=T.paint.get("line-gradient"),oe=T.getCrossfadeParameters(),de=re?"linePattern":Z?"lineSDF":ae?"lineGradient":"line",Q=p.context,we=Q.gl;let Ie=!0;for(const Re of I){const Xe=S.getTile(Re);if(re&&!Xe.patternsLoaded())continue;const st=Xe.getBucket(T);if(!st)continue;const xt=st.programConfigurations.get(T.id),Et=p.context.program.get(),mt=p.useProgram(de,xt),pt=Ie||mt.program!==Et,Nt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Re),or=X.constantOr(null);if(or&&Xe.imageAtlas){const ir=Xe.imageAtlas,ln=ir.patternPositions[or.to.toString()],mr=ir.patternPositions[or.from.toString()];ln&&mr&&xt.setConstantPatternPositions(ln,mr)}const _t=Nt?Re:null,Ct=re?ts(p,Xe,T,oe,_t):Z?rs(p,Xe,T,Z,oe,_t):ae?Vs(p,Xe,T,st.lineClipsArray.length,_t):es(p,Xe,T,_t);if(re)Q.activeTexture.set(we.TEXTURE0),Xe.imageAtlasTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE),xt.updatePaintBuffers(oe);else if(Z&&(pt||p.lineAtlas.dirty))Q.activeTexture.set(we.TEXTURE0),p.lineAtlas.bind(Q);else if(ae){const ir=st.gradients[T.id];let ln=ir.texture;if(T.gradientVersion!==ir.version){let mr=256;if(T.stepInterpolant){const Cr=S.getSource().maxzoom,un=Re.canonical.z===Cr?Math.ceil(1<<p.transform.maxZoom-Re.canonical.z):1;mr=h.ac(h.aV(st.maxLineLength/h.X*1024*un),256,Q.maxTextureSize)}ir.gradient=h.aW({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:mr,image:ir.gradient||void 0,clips:st.lineClipsArray}),ir.texture?ir.texture.update(ir.gradient):ir.texture=new Ye(Q,ir.gradient,we.RGBA),ir.version=T.gradientVersion,ln=ir.texture}Q.activeTexture.set(we.TEXTURE0),ln.bind(T.stepInterpolant?we.NEAREST:we.LINEAR,we.CLAMP_TO_EDGE)}mt.draw(Q,we.TRIANGLES,R,p.stencilModeForClipping(Re),V,$r.disabled,Ct,Nt,T.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,T.paint,p.transform.zoom,xt,st.layoutVertexBuffer2),Ie=!1}})(e,s,u,d);break;case"fill":(function(p,S,T,I){const M=T.paint.get("fill-color"),L=T.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const R=p.colorModeForRenderPass(),V=T.paint.get("fill-pattern"),Z=p.opaquePassEnabledForLayer()&&!V.constantOr(1)&&M.constantOr(h.aM.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===Z){const X=p.depthModeForSublayer(1,p.renderPass==="opaque"?yr.ReadWrite:yr.ReadOnly);Ys(p,S,T,I,X,R,!1)}if(p.renderPass==="translucent"&&T.paint.get("fill-antialias")){const X=p.depthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,yr.ReadOnly);Ys(p,S,T,I,X,R,!0)}})(e,s,u,d);break;case"fill-extrusion":(function(p,S,T,I){const M=T.paint.get("fill-extrusion-opacity");if(M!==0&&p.renderPass==="translucent"){const L=new yr(p.context.gl.LEQUAL,yr.ReadWrite,p.depthRangeFor3D);if(M!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))ga(p,S,T,I,L,Gr.disabled,gn.disabled),ga(p,S,T,I,L,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const R=p.colorModeForRenderPass();ga(p,S,T,I,L,Gr.disabled,R)}}})(e,s,u,d);break;case"hillshade":(function(p,S,T,I){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const M=p.context,L=p.depthModeForSublayer(0,yr.ReadOnly),R=p.colorModeForRenderPass(),[V,Z]=p.renderPass==="translucent"?p.stencilConfigForOverlap(I):[{},I];for(const X of Z){const re=S.getTile(X);re.needsHillshadePrepare!==void 0&&re.needsHillshadePrepare&&p.renderPass==="offscreen"?ea(p,re,T,L,Gr.disabled,R):p.renderPass==="translucent"&&ss(p,X,re,T,L,V[X.overscaledZ],R)}M.viewport.set([0,0,p.width,p.height])})(e,s,u,d);break;case"raster":(function(p,S,T,I){if(p.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!I.length)return;const M=p.context,L=M.gl,R=S.getSource(),V=p.useProgram("raster"),Z=p.colorModeForRenderPass(),[X,re]=R instanceof An?[{},I]:p.stencilConfigForOverlap(I),ae=re[re.length-1].overscaledZ,oe=!p.options.moving;for(const de of re){const Q=p.depthModeForSublayer(de.overscaledZ-ae,T.paint.get("raster-opacity")===1?yr.ReadWrite:yr.ReadOnly,L.LESS),we=S.getTile(de);we.registerFadeDuration(T.paint.get("raster-fade-duration"));const Ie=S.findLoadedParent(de,0),Re=S.findLoadedSibling(de),Xe=La(we,Ie||Re||null,S,T,p.transform,p.style.map.terrain);let st,xt;const Et=T.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;M.activeTexture.set(L.TEXTURE0),we.texture.bind(Et,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),M.activeTexture.set(L.TEXTURE1),Ie?(Ie.texture.bind(Et,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),st=Math.pow(2,Ie.tileID.overscaledZ-we.tileID.overscaledZ),xt=[we.tileID.canonical.x*st%1,we.tileID.canonical.y*st%1]):we.texture.bind(Et,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),we.texture.useMipmap&&M.extTextureFilterAnisotropic&&p.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const mt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(de),pt=mt?de:null,Nt=pt?pt.posMatrix:p.transform.calculatePosMatrix(de.toUnwrapped(),oe),or=Hl(Nt,xt||[0,0],st||1,Xe,T);R instanceof An?V.draw(M,L.TRIANGLES,Q,Gr.disabled,Z,$r.disabled,or,mt,T.id,R.boundsBuffer,p.quadTriangleIndexBuffer,R.boundsSegments):V.draw(M,L.TRIANGLES,Q,X[de.overscaledZ],Z,$r.disabled,or,mt,T.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(e,s,u,d);break;case"background":(function(p,S,T,I){const M=T.paint.get("background-color"),L=T.paint.get("background-opacity");if(L===0)return;const R=p.context,V=R.gl,Z=p.transform,X=Z.tileSize,re=T.paint.get("background-pattern");if(p.isPatternMissing(re))return;const ae=!re&&M.a===1&&L===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==ae)return;const oe=Gr.disabled,de=p.depthModeForSublayer(0,ae==="opaque"?yr.ReadWrite:yr.ReadOnly),Q=p.colorModeForRenderPass(),we=p.useProgram(re?"backgroundPattern":"background"),Ie=I||Z.coveringTiles({tileSize:X,terrain:p.style.map.terrain});re&&(R.activeTexture.set(V.TEXTURE0),p.imageManager.bind(p.context));const Re=T.getCrossfadeParameters();for(const Xe of Ie){const st=I?Xe.posMatrix:p.transform.calculatePosMatrix(Xe.toUnwrapped()),xt=re?Zl(st,L,p,re,{tileID:Xe,tileSize:X},Re):go(st,L,M),Et=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Xe);we.draw(R,V.TRIANGLES,de,oe,Q,$r.disabled,xt,Et,T.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(e,0,u,d);break;case"custom":(function(p,S,T){const I=p.context,M=T.implementation;if(p.renderPass==="offscreen"){const L=M.prerender;L&&(p.setCustomLayerDefaults(),I.setColorMode(p.colorModeForRenderPass()),L.call(M,I.gl,p.transform.customLayerMatrix()),I.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),I.setColorMode(p.colorModeForRenderPass()),I.setStencilMode(Gr.disabled);const L=M.renderingMode==="3d"?new yr(p.context.gl.LEQUAL,yr.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,yr.ReadOnly);I.setDepthMode(L),M.render(I.gl,p.transform.customLayerMatrix(),{farZ:p.transform.farZ,nearZ:p.transform.nearZ,fov:p.transform._fov,modelViewProjectionMatrix:p.transform.modelViewProjectionMatrix,projectionMatrix:p.transform.projectionMatrix}),I.setDirty(),p.setBaseState(),I.bindFramebuffer.set(null)}})(e,0,u)}}translatePosMatrix(e,s,u,d,p){if(!u[0]&&!u[1])return e;const S=p?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(S){const M=Math.sin(S),L=Math.cos(S);u=[u[0]*L-u[1]*M,u[0]*M+u[1]*L]}const T=[p?u[0]:hr(s,u[0],this.transform.zoom),p?u[1]:hr(s,u[1],this.transform.zoom),0],I=new Float32Array(16);return h.J(I,e,T),I}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!s||!u}useProgram(e,s){this.cache=this.cache||{};const u=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new js(this.context,Si[e],s,xs[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ye(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class he{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,u){const d=Math.pow(2,u),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const I=1/(T=h.af([],T,e))[3]/s*d;return h.b1(T,T,[I,I,1/T[3],I])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const I=function(V,Z){var X=Z[0],re=Z[1],ae=Z[2],oe=X*X+re*re+ae*ae;return oe>0&&(oe=1/Math.sqrt(oe)),V[0]=Z[0]*oe,V[1]=Z[1]*oe,V[2]=Z[2]*oe,V}([],function(V,Z,X){var re=Z[0],ae=Z[1],oe=Z[2],de=X[0],Q=X[1],we=X[2];return V[0]=ae*we-oe*Q,V[1]=oe*de-re*we,V[2]=re*Q-ae*de,V}([],Qe([],p[T[0]],p[T[1]]),Qe([],p[T[2]],p[T[1]]))),M=-((L=I)[0]*(R=p[T[1]])[0]+L[1]*R[1]+L[2]*R[2]);var L,R;return I.concat(M)});return new he(p,S)}}class De{constructor(e,s){this.min=e,this.max=s,this.center=function(u,d,p){return u[0]=.5*d[0],u[1]=.5*d[1],u[2]=.5*d[2],u}([],function(u,d,p){return u[0]=d[0]+p[0],u[1]=d[1]+p[1],u[2]=d[2]+p[2],u}([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],u=et(this.min),d=et(this.max);for(let p=0;p<s.length;p++)u[p]=s[p]?this.min[p]:this.center[p],d[p]=s[p]?this.center[p]:this.max[p];return d[2]=this.max[2],new De(u,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let d=0;d<e.planes.length;d++){const p=e.planes[d];let S=0;for(let T=0;T<s.length;T++)h.b2(p,s[T])>=0&&S++;if(S===0)return 0;S!==s.length&&(u=!1)}if(u)return 2;for(let d=0;d<3;d++){let p=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let T=0;T<e.points.length;T++){const I=e.points[T][d]-this.min[d];p=Math.min(p,I),S=Math.max(S,I)}if(S<0||p>this.max[d]-this.min[d])return 0}return 1}}class ve{constructor(e=0,s=0,u=0,d=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=u,this.right=d}interpolate(e,s,u){return s.top!=null&&e.top!=null&&(this.top=h.y.number(e.top,s.top,u)),s.bottom!=null&&e.bottom!=null&&(this.bottom=h.y.number(e.bottom,s.bottom,u)),s.left!=null&&e.left!=null&&(this.left=h.y.number(e.left,s.left,u)),s.right!=null&&e.right!=null&&(this.right=h.y.number(e.right,s.right,u)),this}getCenter(e,s){const u=h.ac((this.left+e-this.right)/2,0,e),d=h.ac((this.top+s-this.bottom)/2,0,s);return new h.P(u,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ve(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ce=85.051129;class Se{constructor(e,s,u,d,p){this.tileSize=512,this._renderWorldCopies=p===void 0||!!p,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=u??0,this._maxPitch=d??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ve,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new Se(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-h.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var u=new h.A(4);return h.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,d,p){var S=d[0],T=d[1],I=d[2],M=d[3],L=Math.sin(p),R=Math.cos(p);u[0]=S*R+I*L,u[1]=T*R+M*L,u[2]=S*-L+I*R,u[3]=T*-L+M*R}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=h.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,u){this._unmodified=!1,this._edgeInsets.interpolate(e,s,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new h.b4(0,e)];if(this._renderWorldCopies){const u=this.pointCoordinate(new h.P(0,0)),d=this.pointCoordinate(new h.P(this.width,0)),p=this.pointCoordinate(new h.P(this.width,this.height)),S=this.pointCoordinate(new h.P(0,this.height)),T=Math.floor(Math.min(u.x,d.x,p.x,S.x)),I=Math.floor(Math.max(u.x,d.x,p.x,S.x)),M=1;for(let L=T-M;L<=I+M;L++)L!==0&&s.push(new h.b4(L,e))}return s}coveringTiles(e){var s,u;let d=this.coveringZoomLevel(e);const p=d;if(e.minzoom!==void 0&&d<e.minzoom)return[];e.maxzoom!==void 0&&d>e.maxzoom&&(d=e.maxzoom);const S=this.pointCoordinate(this.getCameraPoint()),T=h.Z.fromLngLat(this.center),I=Math.pow(2,d),M=[I*S.x,I*S.y,0],L=[I*T.x,I*T.y,0],R=he.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,d);let V=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(V=d);const Z=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,X=Q=>({aabb:new De([Q*I,0,0],[(Q+1)*I,I,0]),zoom:0,x:0,y:0,wrap:Q,fullyVisible:!1}),re=[],ae=[],oe=d,de=e.reparseOverscaled?p:d;if(this._renderWorldCopies)for(let Q=1;Q<=3;Q++)re.push(X(-Q)),re.push(X(Q));for(re.push(X(0));re.length>0;){const Q=re.pop(),we=Q.x,Ie=Q.y;let Re=Q.fullyVisible;if(!Re){const mt=Q.aabb.intersects(R);if(mt===0)continue;Re=mt===2}const Xe=e.terrain?M:L,st=Q.aabb.distanceX(Xe),xt=Q.aabb.distanceY(Xe),Et=Math.max(Math.abs(st),Math.abs(xt));if(Q.zoom===oe||Et>Z+(1<<oe-Q.zoom)-2&&Q.zoom>=V){const mt=oe-Q.zoom,pt=M[0]-.5-(we<<mt),Nt=M[1]-.5-(Ie<<mt);ae.push({tileID:new h.S(Q.zoom===oe?de:Q.zoom,Q.wrap,Q.zoom,we,Ie),distanceSq:ce([L[0]-.5-we,L[1]-.5-Ie]),tileDistanceToCamera:Math.sqrt(pt*pt+Nt*Nt)})}else for(let mt=0;mt<4;mt++){const pt=(we<<1)+mt%2,Nt=(Ie<<1)+(mt>>1),or=Q.zoom+1;let _t=Q.aabb.quadrant(mt);if(e.terrain){const Ct=new h.S(or,Q.wrap,or,pt,Nt),ir=e.terrain.getMinMaxElevation(Ct),ln=(s=ir.minElevation)!==null&&s!==void 0?s:this.elevation,mr=(u=ir.maxElevation)!==null&&u!==void 0?u:this.elevation;_t=new De([_t.min[0],_t.min[1],ln],[_t.max[0],_t.max[1],mr])}re.push({aabb:_t,zoom:or,x:pt,y:Nt,wrap:Q.wrap,fullyVisible:Re})}}return ae.sort((Q,we)=>Q.distanceSq-we.distanceSq).map(Q=>Q.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=h.ac(e.lat,-85.051129,Ce);return new h.P(h.O(e.lng)*this.worldSize,h.Q(s)*this.worldSize)}unproject(e){return new h.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,u=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,d=this.pointLocation(this.centerPoint,e),p=e.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-p))return;const S=u+s-p,T=Math.cos(this._pitch)*this.cameraToCenterDistance/S/h.b5(1,d.lat),I=this.scaleZoom(T/this.tileSize);this._elevation=p,this._center=d,this.zoom=I}setLocationAtPoint(e,s){const u=this.pointCoordinate(s),d=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(e),S=new h.Z(p.x-(u.x-d.x),p.y-(u.y-d.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return h.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const V=s.pointCoordinate(e);if(V!=null)return V}const u=[e.x,e.y,0,1],d=[e.x,e.y,1,1];h.af(u,u,this.pixelMatrixInverse),h.af(d,d,this.pixelMatrixInverse);const p=u[3],S=d[3],T=u[1]/p,I=d[1]/S,M=u[2]/p,L=d[2]/S,R=M===L?0:(0-M)/(L-M);return new h.Z(h.y.number(u[0]/p,d[0]/S,R)/this.worldSize,h.y.number(T,I,R)/this.worldSize)}coordinatePoint(e,s=0,u=this.pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,s,1];return h.af(d,d,u),new h.P(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new Te().extend(this.pointLocation(new h.P(0,e))).extend(this.pointLocation(new h.P(this.width,e))).extend(this.pointLocation(new h.P(this.width,this.height))).extend(this.pointLocation(new h.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Te([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Ce])}calculateTileMatrix(e){const s=e.canonical,u=this.worldSize/this.zoomScale(s.z),d=s.x+Math.pow(2,s.z)*e.wrap,p=h.an(new Float64Array(16));return h.J(p,p,[d*u,s.y*u,0]),h.K(p,p,[u/h.X,u/h.X,1]),p}calculatePosMatrix(e,s=!1){const u=e.key,d=s?this._alignedPosMatrixCache:this._posMatrixCache;if(d[u])return d[u];const p=this.calculateTileMatrix(e);return h.L(p,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,p),d[u]=new Float32Array(p),d[u]}calculateFogMatrix(e){const s=e.key,u=this._fogMatrixCache;if(u[s])return u[s];const d=this.calculateTileMatrix(e);return h.L(d,this.fogMatrix,d),u[s]=new Float32Array(d),u[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=h.ac(+s,this.minZoom,this.maxZoom);const u={center:new h.N(e.lng,e.lat),zoom:s};let d=this.lngRange;if(!this._renderWorldCopies&&d===null){const Q=179.9999999999;d=[-Q,Q]}const p=this.tileSize*this.zoomScale(u.zoom);let S=0,T=p,I=0,M=p,L=0,R=0;const{x:V,y:Z}=this.size;if(this.latRange){const Q=this.latRange;S=h.Q(Q[1])*p,T=h.Q(Q[0])*p,T-S<Z&&(L=Z/(T-S))}d&&(I=h.b3(h.O(d[0])*p,0,p),M=h.b3(h.O(d[1])*p,0,p),M<I&&(M+=p),M-I<V&&(R=V/(M-I)));const{x:X,y:re}=this.project.call({worldSize:p},e);let ae,oe;const de=Math.max(R||0,L||0);if(de){const Q=new h.P(R?(M+I)/2:X,L?(T+S)/2:re);return u.center=this.unproject.call({worldSize:p},Q).wrap(),u.zoom+=this.scaleZoom(de),u}if(this.latRange){const Q=Z/2;re-Q<S&&(oe=S+Q),re+Q>T&&(oe=T-Q)}if(d){const Q=(I+M)/2;let we=X;this._renderWorldCopies&&(we=h.b3(X,Q-p/2,Q+p/2));const Ie=V/2;we-Ie<I&&(ae=I+Ie),we+Ie>M&&(ae=M-Ie)}if(ae!==void 0||oe!==void 0){const Q=new h.P(ae??X,oe??re);u.center=this.unproject.call({worldSize:p},Q).wrap()}return u}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:u}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=u,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=h.b5(1,this.center.lat)*this.worldSize;let d=h.an(new Float64Array(16));h.K(d,d,[this.width/2,-this.height/2,1]),h.J(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=h.an(new Float64Array(16)),h.K(d,d,[1,-1,1]),h.J(d,d,[-1,-1,0]),h.K(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),S=Math.min(this.elevation,this.minElevationForCurrentTile),T=p-S*this._pixelPerMeter/Math.cos(this._pitch),I=S<0?T:p,M=Math.PI/2+this._pitch,L=this._fov*(.5+e.y/this.height),R=Math.sin(L)*I/Math.sin(h.ac(Math.PI-M-L,.01,Math.PI-.01)),V=this.getHorizon(),Z=2*Math.atan(V/this.cameraToCenterDistance)*(.5+e.y/(2*V)),X=Math.sin(Z)*I/Math.sin(h.ac(Math.PI-M-Z,.01,Math.PI-.01)),re=Math.min(R,X);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*re+I),this.nearZ=this.height/50,d=new Float64Array(16),h.b6(d,this._fov,this.width/this.height,this.nearZ,this.farZ),d[8]=2*-e.x/this.width,d[9]=2*e.y/this.height,this.projectionMatrix=h.ae(d),h.K(d,d,[1,-1,1]),h.J(d,d,[0,0,-this.cameraToCenterDistance]),h.b7(d,d,this._pitch),h.ad(d,d,this.angle),h.J(d,d,[-s,-u,0]),this.mercatorMatrix=h.K([],d,[this.worldSize,this.worldSize,this.worldSize]),h.K(d,d,[1,1,this._pixelPerMeter]),this.pixelMatrix=h.L(new Float64Array(16),this.labelPlaneMatrix,d),h.J(d,d,[0,0,-this.elevation]),this.modelViewProjectionMatrix=d,this.invModelViewProjectionMatrix=h.as([],d),this.fogMatrix=new Float64Array(16),h.b6(this.fogMatrix,this._fov,this.width/this.height,p,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,h.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),h.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),h.b7(this.fogMatrix,this.fogMatrix,this._pitch),h.ad(this.fogMatrix,this.fogMatrix,this.angle),h.J(this.fogMatrix,this.fogMatrix,[-s,-u,0]),h.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),h.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=h.L(new Float64Array(16),this.labelPlaneMatrix,d);const ae=this.width%2/2,oe=this.height%2/2,de=Math.cos(this.angle),Q=Math.sin(this.angle),we=s-Math.round(s)+de*ae+Q*oe,Ie=u-Math.round(u)+de*oe+Q*ae,Re=new Float64Array(d);if(h.J(Re,Re,[we>.5?we-1:we,Ie>.5?Ie-1:Ie,0]),this.alignedModelViewProjectionMatrix=Re,d=h.as(new Float64Array(16),this.pixelMatrix),!d)throw new Error("failed to invert matrix");this.pixelMatrixInverse=d,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new h.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return h.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let u=s.x,d=s.y,p=s.x,S=s.y;for(const T of e)u=Math.min(u,T.x),d=Math.min(d,T.y),p=Math.max(p,T.x),S=Math.max(S,T.y);return[new h.P(u,d),new h.P(p,d),new h.P(p,S),new h.P(u,S),new h.P(u,d)]}}lngLatToCameraDepth(e,s){const u=this.locationCoordinate(e),d=[u.x*this.worldSize,u.y*this.worldSize,s,1];return h.af(d,d,this.modelViewProjectionMatrix),d[2]/d[3]}}function Me(m,e){let s,u=!1,d=null,p=null;const S=()=>{d=null,u&&(m.apply(p,s),d=setTimeout(S,e),u=!1)};return(...T)=>(u=!0,p=this,s=T,d||S(),d)}class Fe{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let u;return s.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(u=d)}),(u&&u[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const u=s.join("/");let d=u;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${u}`);let p=window.location.hash.replace(d,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let S=window.location.href.replace(/(#.+)?$/,p);S=S.replace("&&","&"),window.history.replaceState(window.history.state,null,S)},this._updateHash=Me(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,d),S=Math.round(s.lng*p)/p,T=Math.round(s.lat*p)/p,I=this._map.getBearing(),M=this._map.getPitch();let L="";if(L+=e?`/${S}/${T}/${u}`:`${u}/${T}/${S}`,(I||M)&&(L+="/"+Math.round(10*I)/10),M&&(L+=`/${Math.round(M)}`),this._hashName){const R=this._hashName;let V=!1;const Z=window.location.hash.slice(1).split("&").map(X=>{const re=X.split("=")[0];return re===R?(V=!0,`${re}=${L}`):X}).filter(X=>X);return V||Z.push(`${R}=${L}`),`#${Z.join("&")}`}return`#${L}`}}const Ne={linearity:.3,easing:h.b8(0,0,.3,1)},Ge=h.e({deceleration:2500,maxSpeed:1400},Ne),tt=h.e({deceleration:20,maxSpeed:1400},Ne),dt=h.e({deceleration:1e3,maxSpeed:360},Ne),bt=h.e({deceleration:1e3,maxSpeed:90},Ne);class lt{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Y.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=Y.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)s.zoom+=p.zoomDelta||0,s.bearing+=p.bearingDelta||0,s.pitch+=p.pitchDelta||0,p.panDelta&&s.pan._add(p.panDelta),p.around&&(s.around=p.around),p.pinchAround&&(s.pinchAround=p.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(s.pan.mag()){const p=St(s.pan.mag(),u,h.e({},Ge,e||{}));d.offset=s.pan.mult(p.amount/s.pan.mag()),d.center=this._map.transform.center,ft(d,p)}if(s.zoom){const p=St(s.zoom,u,tt);d.zoom=this._map.transform.zoom+p.amount,ft(d,p)}if(s.bearing){const p=St(s.bearing,u,dt);d.bearing=this._map.transform.bearing+h.ac(p.amount,-179,179),ft(d,p)}if(s.pitch){const p=St(s.pitch,u,bt);d.pitch=this._map.transform.pitch+p.amount,ft(d,p)}if(d.zoom||d.bearing){const p=s.pinchAround===void 0?s.around:s.pinchAround;d.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),h.e(d,{noMoveStart:!0})}}function ft(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function St(m,e,s){const{maxSpeed:u,linearity:d,deceleration:p}=s,S=h.ac(m*d/(e/1e3),-u,u),T=Math.abs(S)/(p*d);return{easing:s.easing,duration:1e3*T,amount:S*(T/2)}}class it extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,u,d={}){const p=W.mousePos(s.getCanvas(),u),S=s.unproject(p);super(e,h.e({point:p,lngLat:S,originalEvent:u},d)),this._defaultPrevented=!1,this.target=s}}class Mt extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,u){const d=e==="touchend"?u.changedTouches:u.touches,p=W.touchPos(s.getCanvasContainer(),d),S=p.map(I=>s.unproject(I)),T=p.reduce((I,M,L,R)=>I.add(M.div(R.length)),new h.P(0,0));super(e,{points:p,point:T,lngLats:S,lngLat:s.unproject(T),originalEvent:u}),this._defaultPrevented=!1}}class pr extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class _r{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new pr(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new it(e.type,this._map,e))}mouseup(e){this._map.fire(new it(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new it(e.type,this._map,e))}dblclick(e){return this._firePreventable(new it(e.type,this._map,e))}mouseover(e){this._map.fire(new it(e.type,this._map,e))}mouseout(e){this._map.fire(new it(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Mt(e.type,this._map,e))}touchmove(e){this._map.fire(new Mt(e.type,this._map,e))}touchend(e){this._map.fire(new Mt(e.type,this._map,e))}touchcancel(e){this._map.fire(new Mt(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zt{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new it(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new it("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new it(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(h.P.convert(e),this._map.terrain)}}class Yt{constructor(e,s){this._map=e,this._tr=new mn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(W.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const u=s;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=u,this._box||(this._box=W.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(d.x,u.x),S=Math.max(d.x,u.x),T=Math.min(d.y,u.y),I=Math.max(d.y,u.y);W.setTransform(this._box,`translate(${p}px,${T}px)`),this._box.style.width=S-p+"px",this._box.style.height=I-T+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const u=this._startPos,d=s;if(this.reset(),W.suppressClick(),u.x!==d.x||u.y!==d.y)return this._map.fire(new h.k("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(u,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new h.k(e,{originalEvent:s}))}}function Tn(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const s={};for(let u=0;u<m.length;u++)s[m[u].identifier]=e[u];return s}class Nn{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(d){const p=new h.P(0,0);for(const S of d)p._add(S);return p.div(d.length)}(s),this.touches=Tn(u,s)))}touchmove(e,s,u){if(this.aborted||!this.centroid)return;const d=Tn(u,s);for(const p in this.touches){const S=d[p];(!S||S.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,s,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Cs{constructor(e){this.singleTap=new Nn(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,u){this.singleTap.touchstart(e,s,u)}touchmove(e,s,u){this.singleTap.touchmove(e,s,u)}touchend(e,s,u){const d=this.singleTap.touchend(e,s,u);if(d){const p=e.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(d)<30;if(p&&S||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class In{constructor(e){this._tr=new mn(e),this._zoomIn=new Cs({numTouches:1,numTaps:2}),this._zoomOut=new Cs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,u){this._zoomIn.touchstart(e,s,u),this._zoomOut.touchstart(e,s,u)}touchmove(e,s,u){this._zoomIn.touchmove(e,s,u),this._zoomOut.touchmove(e,s,u)}touchend(e,s,u){const d=this._zoomIn.touchend(e,s,u),p=this._zoomOut.touchend(e,s,u),S=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(d)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ai{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const d=s.length?s[0]:s;return!this._moved&&d.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(u,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&W.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Co={0:1,2:2};class qu{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=W.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(s,u){const d=Co[u];return s.buttons===void 0||(s.buttons&d)!==d}(e,this._eventButton)}isValidEndEvent(e){return W.mouseButton(e)===this._eventButton}}class Qc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const Ku=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}},eh=({enable:m,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const u=new qu({checkCorrectEvent:d=>W.mouseButton(d)===0&&d.ctrlKey||W.mouseButton(d)===2});return new ai({clickTolerance:e,move:(d,p)=>({bearingDelta:(p.x-d.x)*s}),moveStateManager:u,enable:m,assignEvents:Ku})},th=({enable:m,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const u=new qu({checkCorrectEvent:d=>W.mouseButton(d)===0&&d.ctrlKey||W.mouseButton(d)===2});return new ai({clickTolerance:e,move:(d,p)=>({pitchDelta:(p.y-d.y)*s}),moveStateManager:u,enable:m,assignEvents:Ku})};class To{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,u){return this._calculateTransform(e,s,u)}touchmove(e,s,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,s,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,u){this._calculateTransform(e,s,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,u){u.length>0&&(this._active=!0);const d=Tn(u,s),p=new h.P(0,0),S=new h.P(0,0);let T=0;for(const M in d){const L=d[M],R=this._touches[M];R&&(p._add(L),S._add(L.sub(R)),T++,d[M]=L)}if(this._touches=d,this._shouldBePrevented(T)||!S.mag())return;const I=S.div(T);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(T),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,u){if(!this._firstTwoTouches)return;e.preventDefault();const[d,p]=this._firstTwoTouches,S=ru(u,s,d),T=ru(u,s,p);if(!S||!T)return;const I=this._aroundCenter?null:S.add(T).div(2);return this._move([S,T],I,e)}touchend(e,s,u){if(!this._firstTwoTouches)return;const[d,p]=this._firstTwoTouches,S=ru(u,s,d),T=ru(u,s,p);S&&T||(this._active&&W.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ru(m,e,s){for(let u=0;u<m.length;u++)if(m[u].identifier===s)return e[u]}function rh(m,e){return Math.log(m/e)/Math.LN2}class nh extends Gu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(rh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:rh(this._distance,u),pinchAround:s}}}function ih(m,e){return 180*m.angleWith(e)/Math.PI}class ah extends Gu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,u){const d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ih(this._vector,d),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,u=ih(e,this._startVector);return Math.abs(u)<s}}function Hu(m){return Math.abs(m.y)>Math.abs(m.x)}class nu extends Gu{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,u){super.touchstart(e,s,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,Hu(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,p,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,u){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,p=s.mag()>=2;if(!d&&!p)return;if(!d||!p)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const S=e.y>0==s.y>0;return Hu(e)&&Hu(s)&&S}}const Id={panStep:100,bearingStep:15,pitchStep:10};class ya{constructor(e){this._tr=new mn(e);const s=Id;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,u=0,d=0,p=0,S=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),S=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:T=>{const I=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:os,zoom:s?Math.round(I.zoom)+s*(e.shiftKey?2:1):I.zoom,bearing:I.bearing+u*this._bearingStep,pitch:I.pitch+d*this._pitchStep,offset:[-p*this._panStep,-S*this._panStep],center:I.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function os(m){return m*(2-m)}const sh=4.000244140625;class Ra{constructor(e,s){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new mn(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=Y.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%sh==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=W.mousePos(this._map.getCanvas(),e),u=this._tr;this._around=s.y>u.transform.height/2-u.transform.getHorizon()?h.N.convert(this._aroundCenter?u.center:u.unproject(s)):h.N.convert(u.center),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>sh?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&M!==0&&(M=1/M);const L=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(L*M))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,u=this._startZoom,d=this._easing;let p,S=!1;const T=Y.now()-this._lastWheelEventTime;if(this._type==="wheel"&&u&&d&&T){const I=Math.min(T/200,1),M=d(I);p=h.y.number(u,s,M),I<1?this._frameId||(this._frameId=!0):S=!0}else p=s,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=h.b9;if(this._prevEase){const u=this._prevEase,d=(Y.now()-u.start)/u.duration,p=u.easing(d+.01)-u.easing(d),S=.27/Math.sqrt(p*p+1e-4)*.01,T=Math.sqrt(.0729-S*S);s=h.b8(S,T,.25,1)}return this._prevEase={start:Y.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Io{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Np{constructor(e){this._tr=new mn(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jp{constructor(){this._tap=new Cs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,u){if(!this._swipePoint)if(this._tapTime){const d=s[0],p=e.timeStamp-this._tapTime<500,S=this._tapPoint.dist(d)<30;p&&S?u.length>0&&(this._swipePoint=d,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,s,u)}touchmove(e,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=s[0],p=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,s,u)}touchend(e,s,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const d=this._tap.touchend(e,s,u);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pd{constructor(e,s,u){this._el=e,this._mousePan=s,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ed{constructor(e,s,u){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class oh{constructor(e,s,u,d){this._el=e,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class nl{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=W.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=s,this._container.appendChild(d);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=u,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(W.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new h.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const _a=m=>m.zoom||m.drag||m.pitch||m.rotate;class Dt extends h.k{}function Zu(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class lh{constructor(e,s){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,p)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=d.type==="renderFrame"?void 0:d,T={needsRenderFrame:!1},I={},M={},L=d.touches,R=L?this._getMapTouches(L):void 0,V=R?W.touchPos(this._map.getCanvas(),R):W.mousePos(this._map.getCanvas(),d);for(const{handlerName:re,handler:ae,allowed:oe}of this._handlers){if(!ae.isEnabled())continue;let de;this._blockedByActive(M,oe,re)?ae.reset():ae[p||d.type]&&(de=ae[p||d.type](d,V,R),this.mergeHandlerResult(T,I,de,re,S),de&&de.needsRenderFrame&&this._triggerRenderFrame()),(de||ae.isActive())&&(M[re]=ae)}const Z={};for(const re in this._previousActiveHandlers)M[re]||(Z[re]=S);this._previousActiveHandlers=M,(Object.keys(Z).length||Zu(T))&&(this._changes.push([T,I,Z]),this._triggerRenderFrame()),(Object.keys(M).length||Zu(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=T;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new lt(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,p,S]of this._listeners)W.addEventListener(d,p,d===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[e,s,u]of this._listeners)W.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new _r(s,e));const d=s.boxZoom=new Yt(s,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();const p=s.cooperativeGestures=new nl(s,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const S=new In(s),T=new Np(s);s.doubleClickZoom=new Io(T,S),this._add("tapZoom",S),this._add("clickZoom",T),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const I=new jp;this._add("tapDragZoom",I);const M=s.touchPitch=new nu(s);this._add("touchPitch",M),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const L=eh(e),R=th(e);s.dragRotate=new Ed(e,L,R),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const V=(({enable:de,clickTolerance:Q})=>{const we=new qu({checkCorrectEvent:Ie=>W.mouseButton(Ie)===0&&!Ie.ctrlKey});return new ai({clickTolerance:Q,move:(Ie,Re)=>({around:Re,panDelta:Re.sub(Ie)}),activateOnStart:!0,moveStateManager:we,enable:de,assignEvents:Ku})})(e),Z=new To(e,s);s.dragPan=new Pd(u,V,Z),this._add("mousePan",V),this._add("touchPan",Z,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const X=new ah,re=new nh;s.touchZoomRotate=new oh(u,re,X,I),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const ae=s.scrollZoom=new Ra(s,()=>this._triggerRenderFrame());this._add("scrollZoom",ae,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const oe=s.keyboard=new ya(s);this._add("keyboard",oe),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new Zt(s))}_add(e,s,u){this._handlers.push({handlerName:e,handler:s,allowed:u}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_a(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,u){for(const d in e)if(d!==u&&(!s||s.indexOf(d)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const u of e)this._el.contains(u.target)&&s.push(u);return s}mergeHandlerResult(e,s,u,d,p){if(!u)return;h.e(e,u);const S={handlerName:d,originalEvent:u.originalEvent||p};u.zoomDelta!==void 0&&(s.zoom=S),u.panDelta!==void 0&&(s.drag=S),u.pitchDelta!==void 0&&(s.pitch=S),u.bearingDelta!==void 0&&(s.rotate=S)}_applyChanges(){const e={},s={},u={};for(const[d,p,S]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new h.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),h.e(s,p),h.e(u,S);this._updateMapTransform(e,s,u),this._changes=[]}_updateMapTransform(e,s,u){const d=this._map,p=d._getTransformForUpdate(),S=d.terrain;if(!(Zu(e)||S&&this._terrainMovement))return this._fireEvents(s,u,!0);let{panDelta:T,zoomDelta:I,bearingDelta:M,pitchDelta:L,around:R,pinchAround:V}=e;V!==void 0&&(R=V),d._stop(!0),R=R||d.transform.centerPoint;const Z=p.pointLocation(T?R.sub(T):R);M&&(p.bearing+=M),L&&(p.pitch+=L),I&&(p.zoom+=I),S?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(T)):p.setLocationAtPoint(Z,R):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(Z,R)):p.setLocationAtPoint(Z,R),d._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,u,!0)}_fireEvents(e,s,u){const d=_a(this._eventsInProgress),p=_a(e),S={};for(const R in e){const{originalEvent:V}=e[R];this._eventsInProgress[R]||(S[`${R}start`]=V),this._eventsInProgress[R]=e[R]}!d&&p&&this._fireEvent("movestart",p.originalEvent);for(const R in S)this._fireEvent(R,S[R]);p&&this._fireEvent("move",p.originalEvent);for(const R in e){const{originalEvent:V}=e[R];this._fireEvent(R,V)}const T={};let I;for(const R in this._eventsInProgress){const{handlerName:V,originalEvent:Z}=this._eventsInProgress[R];this._handlersById[V].isActive()||(delete this._eventsInProgress[R],I=s[V]||Z,T[`${R}end`]=I)}for(const R in T)this._fireEvent(R,T[R]);const M=_a(this._eventsInProgress),L=(d||p)&&!M;if(L&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const R=this._map._getTransformForUpdate();R.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(R)}if(u&&L){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!R||!R.essential&&Y.prefersReducedMotion?(this._map.fire(new h.k("moveend",{originalEvent:I})),V(this._map.getBearing())&&this._map.resetNorth()):(V(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new h.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Dt("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ad extends h.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const u=Math.min((Y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new h.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,u){return e=h.P.convert(e).mult(-1),this.panTo(this.transform.center,h.e({offset:e},s),u)}panTo(e,s,u){return this.easeTo(h.e({center:e},s),u)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,u){return this.easeTo(h.e({zoom:e},s),u)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,u){return this.easeTo(h.e({bearing:e},s),u)}resetNorth(e,s){return this.rotateTo(0,h.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(h.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=Te.convert(e).adjustAntiMeridian();const u=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,s)}_cameraForBoxAndBearing(e,s,u,d){const p={top:0,bottom:0,right:0,left:0};if(typeof(d=h.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const mt=d.padding;d.padding={top:mt,bottom:mt,right:mt,left:mt}}d.padding=h.e(p,d.padding);const S=this.transform,T=S.padding,I=new Te(e,s),M=S.project(I.getNorthWest()),L=S.project(I.getNorthEast()),R=S.project(I.getSouthEast()),V=S.project(I.getSouthWest()),Z=h.ba(-u),X=M.rotate(Z),re=L.rotate(Z),ae=R.rotate(Z),oe=V.rotate(Z),de=new h.P(Math.max(X.x,re.x,oe.x,ae.x),Math.max(X.y,re.y,oe.y,ae.y)),Q=new h.P(Math.min(X.x,re.x,oe.x,ae.x),Math.min(X.y,re.y,oe.y,ae.y)),we=de.sub(Q),Ie=(S.width-(T.left+T.right+d.padding.left+d.padding.right))/we.x,Re=(S.height-(T.top+T.bottom+d.padding.top+d.padding.bottom))/we.y;if(Re<0||Ie<0)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Xe=Math.min(S.scaleZoom(S.scale*Math.min(Ie,Re)),d.maxZoom),st=h.P.convert(d.offset),xt=new h.P((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(h.ba(u)),Et=st.add(xt).mult(S.scale/S.zoomScale(Xe));return{center:S.unproject(M.add(R).div(2).sub(Et)),zoom:Xe,bearing:u}}fitBounds(e,s,u){return this._fitInternal(this.cameraForBounds(e,s),s,u)}fitScreenCoordinates(e,s,u,d,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(h.P.convert(e)),this.transform.pointLocation(h.P.convert(s)),u,d),d,p)}_fitInternal(e,s,u){return e?(delete(s=h.e(e,s)).padding,s.linear?this.easeTo(s,u):this.flyTo(s,u)):this}jumpTo(e,s){this.stop();const u=this._getTransformForUpdate();let d=!1,p=!1,S=!1;return"zoom"in e&&u.zoom!==+e.zoom&&(d=!0,u.zoom=+e.zoom),e.center!==void 0&&(u.center=h.N.convert(e.center)),"bearing"in e&&u.bearing!==+e.bearing&&(p=!0,u.bearing=+e.bearing),"pitch"in e&&u.pitch!==+e.pitch&&(S=!0,u.pitch=+e.pitch),e.padding==null||u.isPaddingEqual(e.padding)||(u.padding=e.padding),this._applyUpdatedTransform(u),this.fire(new h.k("movestart",s)).fire(new h.k("move",s)),d&&this.fire(new h.k("zoomstart",s)).fire(new h.k("zoom",s)).fire(new h.k("zoomend",s)),p&&this.fire(new h.k("rotatestart",s)).fire(new h.k("rotate",s)).fire(new h.k("rotateend",s)),S&&this.fire(new h.k("pitchstart",s)).fire(new h.k("pitch",s)).fire(new h.k("pitchend",s)),this.fire(new h.k("moveend",s))}calculateCameraOptionsFromTo(e,s,u,d=0){const p=h.Z.fromLngLat(e,s),S=h.Z.fromLngLat(u,d),T=S.x-p.x,I=S.y-p.y,M=S.z-p.z,L=Math.hypot(T,I,M);if(L===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(T,I),V=this.transform.scaleZoom(this.transform.cameraToCenterDistance/L/this.transform.tileSize),Z=180*Math.atan2(T,-I)/Math.PI;let X=180*Math.acos(R/L)/Math.PI;return X=M<0?90-X:90+X,{center:S.toLngLat(),zoom:V,pitch:X,bearing:Z}}easeTo(e,s){var u;this._stop(!1,e.easeId),((e=h.e({offset:[0,0],duration:500,easing:h.b9},e)).animate===!1||!e.essential&&Y.prefersReducedMotion)&&(e.duration=0);const d=this._getTransformForUpdate(),p=d.zoom,S=d.bearing,T=d.pitch,I=d.padding,M="bearing"in e?this._normalizeBearing(e.bearing,S):S,L="pitch"in e?+e.pitch:T,R="padding"in e?e.padding:d.padding,V=h.P.convert(e.offset);let Z=d.centerPoint.add(V);const X=d.pointLocation(Z),{center:re,zoom:ae}=d.getConstrained(h.N.convert(e.center||X),(u=e.zoom)!==null&&u!==void 0?u:p);this._normalizeCenter(re,d);const oe=d.project(X),de=d.project(re).sub(oe),Q=d.zoomScale(ae-p);let we,Ie;e.around&&(we=h.N.convert(e.around),Ie=d.locationPoint(we));const Re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ae!==p,this._rotating=this._rotating||S!==M,this._pitching=this._pitching||L!==T,this._padding=!d.isPaddingEqual(R),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,Re),this.terrain&&this._prepareElevation(re),this._ease(Xe=>{if(this._zooming&&(d.zoom=h.y.number(p,ae,Xe)),this._rotating&&(d.bearing=h.y.number(S,M,Xe)),this._pitching&&(d.pitch=h.y.number(T,L,Xe)),this._padding&&(d.interpolatePadding(I,R,Xe),Z=d.centerPoint.add(V)),this.terrain&&!e.freezeElevation&&this._updateElevation(Xe),we)d.setLocationAtPoint(we,Ie);else{const st=d.zoomScale(d.zoom-p),xt=ae>p?Math.min(2,Q):Math.max(.5,Q),Et=Math.pow(xt,1-Xe),mt=d.unproject(oe.add(de.mult(Xe*Et)).mult(st));d.setLocationAtPoint(d.renderWorldCopies?mt.wrap():mt,Z)}this._applyUpdatedTransform(d),this._fireMoveEvents(s)},Xe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,Xe)},e),this}_prepareEase(e,s,u={}){this._moving=!0,s||u.moving||this.fire(new h.k("movestart",e)),this._zooming&&!u.zooming&&this.fire(new h.k("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new h.k("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new h.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(s-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=h.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),u=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<u){const d=this.calculateCameraOptionsFromTo(s.lngLat,u,e.center,e.elevation);return{pitch:d.pitch,zoom:d.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push(d=>this._elevateCameraIfInsideTerrain(d)),this.transformCameraUpdate&&s.push(d=>this.transformCameraUpdate(d)),!s.length)return;const u=e.clone();for(const d of s){const p=u.clone(),{center:S,zoom:T,pitch:I,bearing:M,elevation:L}=d(p);S&&(p.center=S),T!==void 0&&(p.zoom=T),I!==void 0&&(p.pitch=I),M!==void 0&&(p.bearing=M),L!==void 0&&(p.elevation=L),u.apply(p)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new h.k("move",e)),this._zooming&&this.fire(new h.k("zoom",e)),this._rotating&&this.fire(new h.k("rotate",e)),this._pitching&&this.fire(new h.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const u=this._zooming,d=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new h.k("zoomend",e)),d&&this.fire(new h.k("rotateend",e)),p&&this.fire(new h.k("pitchend",e)),this.fire(new h.k("moveend",e))}flyTo(e,s){var u;if(!e.essential&&Y.prefersReducedMotion){const Ct=h.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ct,s)}this.stop(),e=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.b9},e);const d=this._getTransformForUpdate(),p=d.zoom,S=d.bearing,T=d.pitch,I=d.padding,M="bearing"in e?this._normalizeBearing(e.bearing,S):S,L="pitch"in e?+e.pitch:T,R="padding"in e?e.padding:d.padding,V=h.P.convert(e.offset);let Z=d.centerPoint.add(V);const X=d.pointLocation(Z),{center:re,zoom:ae}=d.getConstrained(h.N.convert(e.center||X),(u=e.zoom)!==null&&u!==void 0?u:p);this._normalizeCenter(re,d);const oe=d.zoomScale(ae-p),de=d.project(X),Q=d.project(re).sub(de);let we=e.curve;const Ie=Math.max(d.width,d.height),Re=Ie/oe,Xe=Q.mag();if("minZoom"in e){const Ct=h.ac(Math.min(e.minZoom,p,ae),d.minZoom,d.maxZoom),ir=Ie/d.zoomScale(Ct-p);we=Math.sqrt(ir/Xe*2)}const st=we*we;function xt(Ct){const ir=(Re*Re-Ie*Ie+(Ct?-1:1)*st*st*Xe*Xe)/(2*(Ct?Re:Ie)*st*Xe);return Math.log(Math.sqrt(ir*ir+1)-ir)}function Et(Ct){return(Math.exp(Ct)-Math.exp(-Ct))/2}function mt(Ct){return(Math.exp(Ct)+Math.exp(-Ct))/2}const pt=xt(!1);let Nt=function(Ct){return mt(pt)/mt(pt+we*Ct)},or=function(Ct){return Ie*((mt(pt)*(Et(ir=pt+we*Ct)/mt(ir))-Et(pt))/st)/Xe;var ir},_t=(xt(!0)-pt)/we;if(Math.abs(Xe)<1e-6||!isFinite(_t)){if(Math.abs(Ie-Re)<1e-6)return this.easeTo(e,s);const Ct=Re<Ie?-1:1;_t=Math.abs(Math.log(Re/Ie))/we,or=()=>0,Nt=ir=>Math.exp(Ct*we*ir)}return e.duration="duration"in e?+e.duration:1e3*_t/("screenSpeed"in e?+e.screenSpeed/we:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=S!==M,this._pitching=L!==T,this._padding=!d.isPaddingEqual(R),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(re),this._ease(Ct=>{const ir=Ct*_t,ln=1/Nt(ir);d.zoom=Ct===1?ae:p+d.scaleZoom(ln),this._rotating&&(d.bearing=h.y.number(S,M,Ct)),this._pitching&&(d.pitch=h.y.number(T,L,Ct)),this._padding&&(d.interpolatePadding(I,R,Ct),Z=d.centerPoint.add(V)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ct);const mr=Ct===1?re:d.unproject(de.add(Q.mult(or(ir))).mult(ln));d.setLocationAtPoint(d.renderWorldCopies?mr.wrap():mr,Z),this._applyUpdatedTransform(d),this._fireMoveEvents(s)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,s)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,s,u){u.animate===!1||u.duration===0?(e(1),s()):(this._easeStart=Y.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=h.b3(e,-180,180);const u=Math.abs(e-s);return Math.abs(e-360-s)<u&&(e-=360),Math.abs(e+360-s)<u&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const u=e.lng-s.center.lng;e.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(h.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const il={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class al{constructor(e=il){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=W.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=W.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){W.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const u=this._map._getUIString(`AttributionControl.${s}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const s=this._map.style.sourceCaches;for(const d in s){const p=s[d];if(p.used||p.usedForTerrain){const S=p.getSource();S.attribution&&e.indexOf(S.attribution)<0&&e.push(S.attribution)}}e=e.filter(d=>String(d).trim()),e.sort((d,p)=>d.length-p.length),e=e.filter((d,p)=>{for(let S=p+1;S<e.length;S++)if(e[S].indexOf(d)>=0)return!1;return!0});const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class uh{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const u=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=W.create("div","maplibregl-ctrl");const s=W.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){W.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ir{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const d of u)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ch=h.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Up extends h.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const u={};for(const d of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))u[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.posMatrix=new Float64Array(16),h.aP(d.posMatrix,0,h.X,0,h.X,0,1),this._tiles[d.key]=new en(d,this.tileSize));for(const d in this._tiles)u[d]||delete this._tiles[d]}freeRtt(e){for(const s in this._tiles){const u=this._tiles[s];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const u of this._renderableTilesKeys){const d=this._tiles[u].tileID;if(d.canonical.equals(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16),h.aP(p.posMatrix,0,h.X,0,h.X,0,1),s[u]=p}else if(d.canonical.isChildOf(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const S=d.canonical.z-e.canonical.z,T=d.canonical.x-(d.canonical.x>>S<<S),I=d.canonical.y-(d.canonical.y>>S<<S),M=h.X>>S;h.aP(p.posMatrix,0,M,0,M,0,1),h.J(p.posMatrix,p.posMatrix,[-T*M,-I*M,0]),s[u]=p}else if(e.canonical.isChildOf(d.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const S=e.canonical.z-d.canonical.z,T=e.canonical.x-(e.canonical.x>>S<<S),I=e.canonical.y-(e.canonical.y>>S<<S),M=h.X>>S;h.aP(p.posMatrix,0,h.X,0,h.X,0,1),h.J(p.posMatrix,p.posMatrix,[T*M,I*M,0]),h.K(p.posMatrix,p.posMatrix,[1/2**S,1/2**S,0]),s[u]=p}}return s}getSourceTile(e,s){const u=this.sourceCache._source;let d=e.overscaledZ-this.deltaZoom;if(d>u.maxzoom&&(d=u.maxzoom),d<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&s)for(;d>=u.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(d--).key);return p}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=e)}}class hh{constructor(e,s,u){this.painter=e,this.sourceCache=new Up(s),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,u,d=h.X){var p;if(!(s>=0&&s<d&&u>=0&&u<d))return 0;const S=this.getTerrainData(e),T=(p=S.tile)===null||p===void 0?void 0:p.dem;if(!T)return 0;const I=function(X,re,ae){var oe=re[0],de=re[1];return X[0]=ae[0]*oe+ae[4]*de+ae[12],X[1]=ae[1]*oe+ae[5]*de+ae[13],X}([],[s/d*h.X,u/d*h.X],S.u_terrain_matrix),M=[I[0]*T.dim,I[1]*T.dim],L=Math.floor(M[0]),R=Math.floor(M[1]),V=M[0]-L,Z=M[1]-R;return T.get(L,R)*(1-V)*(1-Z)+T.get(L+1,R)*V*(1-Z)+T.get(L,R+1)*(1-V)*Z+T.get(L+1,R+1)*V*Z}getElevationForLngLatZoom(e,s){if(!h.bb(s,e.wrap()))return 0;const{tileID:u,mercatorX:d,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(u,d%h.X,p%h.X,h.X)}getElevation(e,s,u,d=h.X){return this.getDEMElevation(e,s,u,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.painter.context,p=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ye(d,p,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ye(d,new h.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const d=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new Ye(d,s.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),s.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const u=s&&s+s.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const d=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?p=e.canonical.z-d:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=e.canonical.x-(e.canonical.x>>p<<p),T=e.canonical.y-(e.canonical.y>>p<<p),I=h.bc(new Float64Array(16),[1/(h.X<<p),1/(h.X<<p),0]);h.J(I,I,[S*h.X,T*h.X,0]),this._demMatrixCache[e.key]={matrix:I,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,u=s.width/devicePixelRatio,d=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ye(s.context,{width:u,height:d,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ye(s.context,{width:u,height:d,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(u,d,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,u,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,S=0;p<this._coordsTextureSize;p++)for(let T=0;T<this._coordsTextureSize;T++,S+=4)s[S+0]=255&T,s[S+1]=255&p,s[S+2]=T>>8<<4|p>>8,s[S+3]=0;const u=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),d=new Ye(e,u,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),u=this.painter.context,d=u.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),T=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(p,T-S-1,1,1,d.RGBA,d.UNSIGNED_BYTE,s),u.bindFramebuffer.set(null);const I=s[0]+(s[2]>>4<<8),M=s[1]+((15&s[2])<<8),L=this.coordsIndex[255-s[3]],R=L&&this.sourceCache.getTileByID(L);if(!R)return null;const V=this._coordsTextureSize,Z=(1<<R.tileID.canonical.z)*V;return new h.Z((R.tileID.canonical.x*V+I)/Z+R.tileID.wrap,(R.tileID.canonical.y*V+M)/Z,this.getElevation(R.tileID,I,M,V))}depthAtPoint(e){const s=new Uint8Array(4),u=this.painter.context,d=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,s),u.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new h.bd,u=new h.aY,d=this.meshSize,p=h.X/d,S=d*d;for(let R=0;R<=d;R++)for(let V=0;V<=d;V++)s.emplaceBack(V*p,R*p,0);for(let R=0;R<S;R+=d+1)for(let V=0;V<d;V++)u.emplaceBack(V+R,d+V+R+1,d+V+R+2),u.emplaceBack(V+R,d+V+R+2,V+R+1);const T=s.length,I=T+2*(d+1);for(const R of[0,1])for(let V=0;V<=d;V++)for(const Z of[0,1])s.emplaceBack(V*p,R*h.X,Z);for(let R=0;R<2*d;R+=2)u.emplaceBack(I+R,I+R+1,I+R+3),u.emplaceBack(I+R,I+R+3,I+R+2),u.emplaceBack(T+R,T+R+3,T+R+1),u.emplaceBack(T+R,T+R+2,T+R+3);const M=s.length,L=M+2*(d+1);for(const R of[0,1])for(let V=0;V<=d;V++)for(const Z of[0,1])s.emplaceBack(R*h.X,V*p,Z);for(let R=0;R<2*d;R+=2)u.emplaceBack(M+R,M+R+1,M+R+3),u.emplaceBack(M+R,M+R+3,M+R+2),u.emplaceBack(L+R,L+R+3,L+R+1),u.emplaceBack(L+R,L+R+2,L+R+3);return this._mesh=new xe(e.createVertexBuffer(s,ch.members),e.createIndexBuffer(u),h.a0.simpleSegment(0,0,s.length,u.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*h.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var u;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(u=this.getMinMaxElevation(d).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return s&&s.dem&&(u.minElevation=s.dem.min*this.exaggeration,u.maxElevation=s.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,s){const u=h.Z.fromLngLat(e.wrap()),d=(1<<s)*h.X,p=u.x*d,S=u.y*d,T=Math.floor(p/h.X),I=Math.floor(S/h.X);return{tileID:new h.S(s,0,s,T,I),mercatorX:p,mercatorY:S}}}class Vp{constructor(e,s,u){this._context=e,this._size=s,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new Ye(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(u.texture),{id:e,fbo:s,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>e.id!==s),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const sl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Md{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new Vp(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(u=>!e._layers[u].isHidden(s)),this._coordsDescendingInv={};for(const u in e.sourceCaches){this._coordsDescendingInv[u]={};const d=e.sourceCaches[u].getVisibleCoordinates();for(const p of d){const S=this.terrain.sourceCache.getTerrainCoords(p);for(const T in S)this._coordsDescendingInv[u][T]||(this._coordsDescendingInv[u][T]=[]),this._coordsDescendingInv[u][T].push(S[T])}}this._coordsDescendingInvStr={};for(const u of e._order){const d=e._layers[u],p=d.source;if(sl[d.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const S in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][S]=this._coordsDescendingInv[p][S].map(T=>T.key).sort().join()}}for(const u of this._renderableTiles)for(const d in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[d][u.tileID.key];p&&p!==u.rttCoords[d]&&(u.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,u=this.painter,d=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(sl[s]&&(this._prevType&&sl[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!d))return!0;if(sl[this._prevType]||sl[s]&&d){this._prevType=s;const p=this._stacks.length-1,S=this._stacks[p]||[];for(const T of this._renderableTiles){if(this.pool.isFull()&&(ye(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(T),T.rtt[p]){const M=this.pool.getObjectForId(T.rtt[p].id);if(M.stamp===T.rtt[p].stamp){this.pool.useObject(M);continue}}const I=this.pool.getOrCreateFreeObject();this.pool.useObject(I),this.pool.stampObject(I),T.rtt[p]={id:I.id,stamp:I.stamp},u.context.bindFramebuffer.set(I.fbo.framebuffer),u.context.clear({color:h.aM.transparent,stencil:0}),u.currentStencilSource=void 0;for(let M=0;M<S.length;M++){const L=u.style._layers[S[M]],R=L.source?this._coordsDescendingInv[L.source][T.tileID.key]:[T.tileID];u.context.viewport.set([0,0,I.fbo.width,I.fbo.height]),u._renderTileClippingMasks(L,R),u.renderLayer(u,u.style.sourceCaches[L.source],L,R),L.source&&(T.rttCoords[L.source]=this._coordsDescendingInvStr[L.source][T.tileID.key])}}return ye(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),sl[s]}return!1}}const dh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Dd=j,$p={hash:!1,interactive:!0,bearingSnap:7,attributionControl:il,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},fh=m=>{m.touchstart=m.dragStart,m.touchmoveWindow=m.dragMove,m.touchend=m.dragEnd},qp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Kp{constructor(e,s,u=!1){this.mousedown=S=>{this.startMouse(h.e({},S,{ctrlKey:!0,preventDefault:()=>S.preventDefault()}),W.mousePos(this.element,S)),W.addEventListener(window,"mousemove",this.mousemove),W.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.moveMouse(S,W.mousePos(this.element,S))},this.mouseup=S=>{this.mouseRotate.dragEnd(S),this.mousePitch&&this.mousePitch.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,S.targetTouches)[0],this.startTouch(S,this._startPos),W.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=W.touchPos(this.element,S.targetTouches)[0],this.moveTouch(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const d=e.dragRotate._mouseRotate.getClickTolerance(),p=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=eh({clickTolerance:d,enable:!0}),this.touchRotate=(({enable:S,clickTolerance:T,bearingDegreesPerPixelMoved:I=.8})=>{const M=new Qc;return new ai({clickTolerance:T,move:(L,R)=>({bearingDelta:(R.x-L.x)*I}),moveStateManager:M,enable:S,assignEvents:fh})})({clickTolerance:d,enable:!0}),this.map=e,u&&(this.mousePitch=th({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:S,clickTolerance:T,pitchDegreesPerPixelMoved:I=-.5})=>{const M=new Qc;return new ai({clickTolerance:T,move:(L,R)=>({pitchDelta:(R.y-L.y)*I}),moveStateManager:M,enable:S,assignEvents:fh})})({clickTolerance:p,enable:!0})),W.addEventListener(s,"mousedown",this.mousedown),W.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),W.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),W.disableDrag()}moveMouse(e,s){const u=this.map,{bearingDelta:d}=this.mouseRotate.dragMove(e,s)||{};if(d&&u.setBearing(u.getBearing()+d),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(e,s)||{};p&&u.setPitch(u.getPitch()+p)}}moveTouch(e,s){const u=this.map,{bearingDelta:d}=this.touchRotate.dragMove(e,s)||{};if(d&&u.setBearing(u.getBearing()+d),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(e,s)||{};p&&u.setPitch(u.getPitch()+p)}}off(){const e=this.element;W.removeEventListener(e,"mousedown",this.mousedown),W.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.removeEventListener(window,"touchend",this.touchend),W.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){W.enableDrag(),W.removeEventListener(window,"mousemove",this.mousemove),W.removeEventListener(window,"mouseup",this.mouseup),W.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.removeEventListener(window,"touchend",this.touchend)}}let ta;function on(m,e,s){const u=new h.N(m.lng,m.lat);if(m=new h.N(m.lng,m.lat),e){const d=new h.N(m.lng-360,m.lat),p=new h.N(m.lng+360,m.lat),S=s.locationPoint(m).distSqr(e);s.locationPoint(d).distSqr(e)<S?m=d:s.locationPoint(p).distSqr(e)<S&&(m=p)}for(;Math.abs(m.lng-s.center.lng)>180;){const d=s.locationPoint(m);if(d.x>=0&&d.y>=0&&d.x<=s.width&&d.y<=s.height)break;m.lng>s.center.lng?m.lng-=360:m.lng+=360}return m.lng!==u.lng&&s.locationPoint(m).y>s.height/2-s.getHorizon()?m:u}const ol={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Wu(m,e,s){const u=m.classList;for(const d in ol)u.remove(`maplibregl-${s}-anchor-${d}`);u.add(`maplibregl-${s}-anchor-${e}`)}class Xu extends h.E{constructor(e){if(super(),this._onKeyPress=s=>{const u=s.code,d=s.charCode||s.keyCode;u!=="Space"&&u!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=s=>{const u=s.originalEvent.target,d=this._element;this._popup&&(u===d||d.contains(u))&&this.togglePopup()},this._update=s=>{var u;if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();(s?.type==="terrain"||s?.type==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?on(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),W.setTransform(this._element,`${ol[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${p}`),Y.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.k("dragstart"))),this.fire(new h.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=h.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=W.create("div");const s=W.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${u}px`),s.setAttributeNS(null,"width",`${d}px`),s.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);const p=W.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const S=W.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const T=W.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of I){const de=W.createNS("http://www.w3.org/2000/svg","ellipse");de.setAttributeNS(null,"opacity","0.04"),de.setAttributeNS(null,"cx","10.5"),de.setAttributeNS(null,"cy","5.80029008"),de.setAttributeNS(null,"rx",oe.rx),de.setAttributeNS(null,"ry",oe.ry),T.appendChild(de)}const M=W.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const L=W.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(L);const R=W.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const V=W.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(V);const Z=W.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const X=W.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const re=W.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#000000"),re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962");const ae=W.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#FFFFFF"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962"),X.appendChild(re),X.appendChild(ae),S.appendChild(T),S.appendChild(M),S.appendChild(R),S.appendChild(Z),S.appendChild(X),s.appendChild(S),s.setAttributeNS(null,"height",u*this._scale+"px"),s.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(s),this._offset=h.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Wu(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),W.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=h.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,u;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const d=this._map,p=d.terrain.depthAtPoint(this._pos),S=d.terrain.getElevationForLngLatZoom(this._lngLat,d.transform.tileZoom);if(d.transform.lngLatToCameraDepth(this._lngLat,S)-p<.006)return void(this._element.style.opacity=this._opacity);const T=-this._offset.y/d.transform._pixelPerMeter,I=Math.sin(d.getPitch()*Math.PI/180)*T,M=d.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),L=d.transform.lngLatToCameraDepth(this._lngLat,S+I)-M>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&L&&this._popup.remove(),this._element.style.opacity=L?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=h.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const zd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let iu=0,au=!1;const ls={maxWidth:100,unit:"metric"};function su(m,e,s){const u=s&&s.maxWidth||100,d=m._container.clientHeight/2,p=m.unproject([0,d]),S=m.unproject([u,d]),T=p.distanceTo(S);if(s&&s.unit==="imperial"){const I=3.2808*T;I>5280?Bt(e,u,I/5280,m._getUIString("ScaleControl.Miles")):Bt(e,u,I,m._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Bt(e,u,T/1852,m._getUIString("ScaleControl.NauticalMiles")):T>=1e3?Bt(e,u,T/1e3,m._getUIString("ScaleControl.Kilometers")):Bt(e,u,T,m._getUIString("ScaleControl.Meters"))}function Bt(m,e,s,u){const d=function(p){const S=Math.pow(10,`${Math.floor(p)}`.length-1);let T=p/S;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(I){const M=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*M)/M}(T),S*T}(s);m.style.width=e*(d/s)+"px",m.innerHTML=`${d}&nbsp;${u}`}const Jt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Yu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ju(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,m),"top-left":new h.P(e,e),"top-right":new h.P(-e,e),bottom:new h.P(0,-m),"bottom-left":new h.P(e,-e),"bottom-right":new h.P(-e,-e),left:new h.P(m,0),right:new h.P(-m,0)}}if(m instanceof h.P||Array.isArray(m)){const e=h.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:h.P.convert(m.center||[0,0]),top:h.P.convert(m.top||[0,0]),"top-left":h.P.convert(m["top-left"]||[0,0]),"top-right":h.P.convert(m["top-right"]||[0,0]),bottom:h.P.convert(m.bottom||[0,0]),"bottom-left":h.P.convert(m["bottom-left"]||[0,0]),"bottom-right":h.P.convert(m["bottom-right"]||[0,0]),left:h.P.convert(m.left||[0,0]),right:h.P.convert(m.right||[0,0])}}return Ju(new h.P(0,0))}const ph=j;x.AJAXError=h.bh,x.Evented=h.E,x.LngLat=h.N,x.MercatorCoordinate=h.Z,x.Point=h.P,x.addProtocol=h.bi,x.config=h.a,x.removeProtocol=h.bj,x.AttributionControl=al,x.BoxZoomHandler=Yt,x.CanvasSource=Zr,x.CooperativeGesturesHandler=nl,x.DoubleClickZoomHandler=Io,x.DragPanHandler=Pd,x.DragRotateHandler=Ed,x.EdgeInsets=ve,x.FullscreenControl=class extends h.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){W.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=W.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);W.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},x.GeoJSONSource=_n,x.GeolocateControl=class extends h.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new h.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new h.N(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,d=this._map.getBearing(),p=h.e({bearing:d},this.options.fitBoundsOptions),S=Te.fromLngLat(s,u);this._map.fitBounds(S,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new h.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&au)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=W.create("button","maplibregl-ctrl-geolocate",this._container),W.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Xu({element:this._dotElement}),this._circleElement=W.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.k("trackuserlocationend")),this.fire(new h.k("userlocationlostfocus")))})}},this.options=h.e({},zd,m)}onAdd(m){return this._map=m,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return h._(this,arguments,void 0,function*(e=!1){if(ta!==void 0&&!e)return ta;if(window.navigator.permissions===void 0)return ta=!!window.navigator.geolocation,ta;try{ta=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ta=!!window.navigator.geolocation}return ta})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),W.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,iu=0,au=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),s=m.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),e=m.getSouthEast(),s=m.getNorthEast(),u=e.distanceTo(s),d=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":iu--,au=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.k("trackuserlocationstart")),this.fire(new h.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),iu++,iu>1?(m={maximumAge:6e5,timeout:0},au=!0):(m=this.options.positionOptions,au=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},x.Hash=Fe,x.ImageSource=An,x.KeyboardHandler=ya,x.LngLatBounds=Te,x.LogoControl=uh,x.Map=class extends Ad{constructor(m){h.bf.mark(h.bg.create);const e=Object.assign(Object.assign({},$p),m);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Se(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ir,this._controls=[],this._mapId=h.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new h.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},dh),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ke.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ve(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const u=Me(d=>{this._trackResize&&!this._removed&&(this.resize(d),this.redraw())},50);this._resizeObserver=new ResizeObserver(d=>{s?u(d):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new lh(this,e),this._hash=e.hash&&new Fe(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,h.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new al(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new uh,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new h.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new h.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new h.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new h.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=m.onAdd(this);this._controls.push(m);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new h.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,e,s,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,s,u)}resize(m){var e;const s=this._containerDimensions(),u=s[0],d=s[1],p=this._getClampedPixelRatio(u,d);if(this._resizeCanvas(u,d,p),this.painter.resize(u,d,p),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const I=this._getClampedPixelRatio(u,d);this._resizeCanvas(u,d,I),this.painter.resize(u,d,I)}this.transform.resize(u,d),(e=this._requestedCameraState)===null||e===void 0||e.resize(u,d);const S=!this._moving;return S&&(this.stop(),this.fire(new h.k("movestart",m)).fire(new h.k("move",m))),this.fire(new h.k("resize",m)),S&&this.fire(new h.k("moveend",m)),this}_getClampedPixelRatio(m,e){const{0:s,1:u}=this._maxCanvasSize,d=this.getPixelRatio(),p=m*d,S=e*d;return Math.min(p>s?s/p:1,S>u?u/S:1)*d}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(Te.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(h.N.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.pointLocation(h.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,s){if(m==="mouseenter"||m==="mouseover"){let u=!1;return{layers:e,listener:s,delegates:{mousemove:p=>{const S=e.filter(I=>this.getLayer(I)),T=S.length!==0?this.queryRenderedFeatures(p.point,{layers:S}):[];T.length?u||(u=!0,s.call(this,new it(m,this,p.originalEvent,{features:T}))):u=!1},mouseout:()=>{u=!1}}}}if(m==="mouseleave"||m==="mouseout"){let u=!1;return{layers:e,listener:s,delegates:{mousemove:S=>{const T=e.filter(I=>this.getLayer(I));(T.length!==0?this.queryRenderedFeatures(S.point,{layers:T}):[]).length?u=!0:u&&(u=!1,s.call(this,new it(m,this,S.originalEvent)))},mouseout:S=>{u&&(u=!1,s.call(this,new it(m,this,S.originalEvent)))}}}}{const u=d=>{const p=e.filter(T=>this.getLayer(T)),S=p.length!==0?this.queryRenderedFeatures(d.point,{layers:p}):[];S.length&&(d.features=S,s.call(this,d),delete d.features)};return{layers:e,listener:s,delegates:{[m]:u}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,s){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const u=this._delegatedListeners[m];for(let d=0;d<u.length;d++){const p=u[d];if(p.listener===s&&p.layers.length===e.length&&p.layers.every(S=>e.includes(S))){for(const S in p.delegates)this.off(S,p.delegates[S]);return void u.splice(d,1)}}}on(m,e,s){if(s===void 0)return super.on(m,e);const u=this._createDelegatedListener(m,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(m,u);for(const d in u.delegates)this.on(d,u.delegates[d]);return this}once(m,e,s){if(s===void 0)return super.once(m,e);const u=typeof e=="string"?[e]:e,d=this._createDelegatedListener(m,u,s);for(const p in d.delegates){const S=d.delegates[p];d.delegates[p]=(...T)=>{this._removeDelegatedListener(m,u,s),S(...T)}}this._saveDelegatedListener(m,d);for(const p in d.delegates)this.once(p,d.delegates[p]);return this}off(m,e,s){return s===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let s;const u=m instanceof h.P||Array.isArray(m),d=u?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:m)||{},d instanceof h.P||typeof d[0]=="number")s=[h.P.convert(d)];else{const p=h.P.convert(d[0]),S=h.P.convert(d[1]);s=[p,new h.P(S.x,p.y),S,new h.P(p.x,S.y),p]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,e));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Qa(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,s):this.style.loadJSON(m,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Qa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const s=this._requestManager.transformRequest(m,"Style");h.h(s,new AbortController).then(u=>{this._updateDiff(u.data,e)}).catch(u=>{u&&this.fire(new h.j(u))})}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(s){h.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new h.j(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const u=this.style._layers[s];u.type==="hillshade"&&u.source===m.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new hh(this.painter,e,m),this.painter.renderToTexture=new Md(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==m.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new h.k("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const e in m){const s=m[e]._tiles;for(const u in s){const d=s[u];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,e,s={}){const{pixelRatio:u=1,sdf:d=!1,stretchX:p,stretchY:S,content:T,textFitWidth:I,textFitHeight:M}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||h.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:R,data:V}=e,Z=e;return this.style.addImage(m,{data:new h.R({width:L,height:R},new Uint8Array(V)),pixelRatio:u,stretchX:p,stretchY:S,content:T,textFitWidth:I,textFitHeight:M,sdf:d,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,m),this}}{const{width:L,height:R,data:V}=Y.getImageData(e);this.style.addImage(m,{data:new h.R({width:L,height:R},V),pixelRatio:u,stretchX:p,stretchY:S,content:T,textFitWidth:I,textFitHeight:M,sdf:d,version:0})}}updateImage(m,e){const s=this.style.getImage(m);if(!s)return this.fire(new h.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||h.b(e)?Y.getImageData(e):e,{width:d,height:p,data:S}=u;if(d===void 0||p===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==s.data.width||p!==s.data.height)return this.fire(new h.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(e instanceof HTMLImageElement||h.b(e));return s.data.replace(S,T),this.style.updateImage(m,s),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new h.j(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return ke.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,s){return this.style.setLayerZoomRange(m,e,s),this._update(!0)}setFilter(m,e,s={}){return this.style.setFilter(m,e,s),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,s,u={}){return this.style.setPaintProperty(m,e,s,u),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,s,u={}){return this.style.setLayoutProperty(m,e,s,u),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,s,u=>{u||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,s=>{s||this._update(!0)}),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m){return this._lazyInitEmptyStyle(),this.style.setSky(m),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=W.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=W.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),u=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],u);const d=this._controlContainer=W.create("div","maplibregl-control-container",m),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{p[S]=W.create("div",`maplibregl-ctrl-${S} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,s){this._canvas.width=Math.floor(s*m),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{e={requestedAttributes:m},u&&(e.statusMessage=u.statusMessage,e.type=u.type)},{once:!0});const s=this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m);if(!s){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new Ee(s,this.transform),$e.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const d=this.transform.zoom,p=Y.now();this.style.zoomHistory.update(d,p);const S=new h.z(d,{now:p,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),T=S.crossFadingFactor();T===1&&T===this._crossFadingFactor||(s=!0,this._crossFadingFactor=T),this.style.update(S)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new h.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.bf.mark(h.bg.load),this.fire(new h.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,h.bf.mark(h.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ke.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),W.remove(this._canvasContainer),W.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),h.bf.clearMetrics(),this._removed=!0,this.fire(new h.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Y.frameAsync(this._frameRequest).then(m=>{h.bf.frame(m),this._frameRequest=null,this._render(m)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Dd}getCameraTargetElevation(){return this.transform.elevation}},x.MapMouseEvent=it,x.MapTouchEvent=Mt,x.MapWheelEvent=pr,x.Marker=Xu,x.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const u=this._map._getUIString(`NavigationControl.${s}`);e.title=u,e.setAttribute("aria-label",u)},this.options=h.e({},qp,m),this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),W.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),W.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=W.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Kp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){W.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const s=W.create("button",m,this._container);return s.type="button",s.addEventListener("click",e),s}},x.Popup=class extends h.E{constructor(m){super(),this.remove=()=>(this._content&&W.remove(this._content),this._container&&(W.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=W.create("div","maplibregl-popup",this._map.getContainer()),this._tip=W.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?on(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const u=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let d=this.options.anchor;const p=Ju(this.options.offset);if(!d){const T=this._container.offsetWidth,I=this._container.offsetHeight;let M;M=u.y+p.bottom.y<I?["top"]:u.y>this._map.transform.height-I?["bottom"]:[],u.x<T/2?M.push("left"):u.x>this._map.transform.width-T/2&&M.push("right"),d=M.length===0?"bottom":M.join("-")}let S=u.add(p[d]);this.options.subpixelPositioning||(S=S.round()),W.setTransform(this._container,`${ol[d]} translate(${S.x}px,${S.y}px)`),Wu(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(Jt),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=h.N.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),s=document.createElement("body");let u;for(s.innerHTML=m;u=s.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=W.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Yu);m&&m.focus()}},x.RasterDEMTileSource=dr,x.RasterTileSource=Wt,x.ScaleControl=class{constructor(m){this._onMove=()=>{su(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,su(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ls),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},x.ScrollZoomHandler=Ra,x.Style=Qa,x.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=W.create("button","maplibregl-ctrl-terrain",this._container),W.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){W.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},x.TwoFingersTouchPitchHandler=nu,x.TwoFingersTouchRotateHandler=ah,x.TwoFingersTouchZoomHandler=nh,x.TwoFingersTouchZoomRotateHandler=oh,x.VectorTileSource=Tr,x.VideoSource=an,x.addSourceType=(m,e)=>h._(void 0,void 0,void 0,function*(){if(Yr(m))throw new Error(`A source type called "${m}" already exists.`);((s,u)=>{Vr[s]=u})(m,e)}),x.clearPrewarmedResources=function(){const m=zr;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Sr),zr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},x.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},x.getRTLTextPluginStatus=function(){return Cn().getRTLTextPluginStatus()},x.getVersion=function(){return ph},x.getWorkerCount=function(){return wr.workerCount},x.getWorkerUrl=function(){return h.a.WORKER_URL},x.importScriptInWorkers=function(m){return cr().broadcast("IS",m)},x.prewarm=function(){ct().acquire(Sr)},x.setMaxParallelImageRequests=function(m){h.a.MAX_PARALLEL_IMAGE_REQUESTS=m},x.setRTLTextPlugin=function(m,e){return Cn().setRTLTextPlugin(m,e)},x.setWorkerCount=function(m){wr.workerCount=m},x.setWorkerUrl=function(m){h.a.WORKER_URL=m}});var b=o;return b})})(qw);var IC=qw.exports;const wf=gp(IC),sx={version:8,name:"Dark",sources:{"carto-dark":{type:"raster",tiles:["https://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png","https://b.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png","https://c.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png"],tileSize:256,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}},layers:[{id:"carto-dark-layer",type:"raster",source:"carto-dark",minzoom:0,maxzoom:22}]},ox={version:8,name:"Satellite",sources:{"esri-satellite":{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"Tiles &copy; Esri"}},layers:[{id:"esri-satellite-layer",type:"raster",source:"esri-satellite",minzoom:0,maxzoom:19}]},PC=({center:n,zoom:r,basemap:o,layers:c,activeLayers:_,currentLocation:b,onMapMove:x})=>{const h=Kt.useRef(null),j=Kt.useRef(null),q=Kt.useRef(null),le=Kt.useRef(null);Kt.useEffect(()=>{if(!(!h.current||j.current))return j.current=new wf.Map({container:h.current,style:o==="dark"?sx:ox,center:n,zoom:r,attributionControl:{compact:!0},maxZoom:18,minZoom:4}),j.current.addControl(new wf.NavigationControl({showCompass:!0}),"bottom-right"),j.current.addControl(new wf.ScaleControl({maxWidth:100}),"bottom-left"),j.current.on("moveend",()=>{if(j.current){const W=j.current.getCenter();x([W.lng,W.lat],j.current.getZoom())}}),()=>{j.current?.remove(),j.current=null}},[]),Kt.useEffect(()=>{j.current&&j.current.setStyle(o==="dark"?sx:ox)},[o]),Kt.useEffect(()=>{j.current&&j.current.flyTo({center:n,zoom:r,duration:500})},[n,r]),Kt.useEffect(()=>{if(!j.current||!b)return;if(q.current)q.current.setLngLat([b.lon,b.lat]);else{const $e=document.createElement("div");$e.className="user-marker",q.current=new wf.Marker({element:$e}).setLngLat([b.lon,b.lat]).addTo(j.current)}const W=()=>{if(!j.current)return;const $e="accuracy-source",He="accuracy-layer",Je=EC(b.lon,b.lat,b.accuracy);j.current.getSource($e)?j.current.getSource($e).setData(Je):(j.current.addSource($e,{type:"geojson",data:Je}),j.current.addLayer({id:He,type:"fill",source:$e,paint:{"fill-color":"#4a9eff","fill-opacity":.15}}),j.current.addLayer({id:`${He}-outline`,type:"line",source:$e,paint:{"line-color":"#4a9eff","line-width":2}}),le.current=$e)};j.current.isStyleLoaded()?W():j.current.once("styledata",W)},[b]);const Y=Kt.useCallback(async()=>{if(j.current){if(!j.current.isStyleLoaded()){j.current.once("styledata",Y);return}for(const W of c){if(W.source.format!=="geojson")continue;const $e=`source-${W.id}`,He=_.has(W.id);try{if(j.current.getSource($e)){const Je=`layer-${W.id}`;j.current.getLayer(Je)&&j.current.setLayoutProperty(Je,"visibility",He?"visible":"none"),j.current.getLayer(`${Je}-outline`)&&j.current.setLayoutProperty(`${Je}-outline`,"visibility",He?"visible":"none")}else{const Je=await fetch(W.source.path);if(Je.ok){const Qt=await Je.json();j.current.addSource($e,{type:"geojson",data:Qt});const be=`layer-${W.id}`;W.style?.kind==="polygon"||W.style?.kind==="choropleth"?(j.current.addLayer({id:be,type:"fill",source:$e,paint:{"fill-color":W.style?.colors?.default||"#4a9eff","fill-opacity":.3},layout:{visibility:He?"visible":"none"}}),j.current.addLayer({id:`${be}-outline`,type:"line",source:$e,paint:{"line-color":W.style?.colors?.default?.replace("33","ff")||"#4a9eff","line-width":2},layout:{visibility:He?"visible":"none"}})):W.style?.kind==="point"&&j.current.addLayer({id:be,type:"circle",source:$e,paint:{"circle-radius":6,"circle-color":"#ff9800","circle-stroke-width":2,"circle-stroke-color":"#fff"},layout:{visibility:He?"visible":"none"}})}}}catch(Je){console.warn(`Failed to load layer ${W.id}:`,Je)}}}},[c,_]);return Kt.useEffect(()=>{Y()},[Y]),Ue.jsx("div",{ref:h,className:"map-container"})};function EC(n,r,o){const _=[];for(let b=0;b<64;b++){const x=b/64*2*Math.PI,h=o*Math.cos(x),q=o*Math.sin(x)/111320,le=h/(111320*Math.cos(r*Math.PI/180));_.push([n+le,r+q])}return _.push(_[0]),{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[_]}}}const AC=({title:n,children:r,onClose:o})=>Ue.jsxs("div",{className:"bottom-sheet",children:[Ue.jsxs("div",{className:"bottom-sheet-header",children:[Ue.jsx("h3",{children:n}),Ue.jsx("button",{className:"bottom-sheet-close",onClick:o,children:""})]}),Ue.jsx("div",{className:"bottom-sheet-content",children:r})]}),MC=({layers:n,activeLayers:r,onToggle:o,onClose:c})=>{const _=n.reduce((h,j)=>{const q=j.category||"other";return h[q]||(h[q]=[]),h[q].push(j),h},{}),b={boundary:" Boundaries",lulc:" LULC Layers",forest:" Forest Data",corestack:" CoreStack Data",other:" Other"},x=["boundary","lulc","forest","corestack","other"];return Ue.jsxs("div",{className:"side-panel",children:[Ue.jsxs("div",{className:"side-panel-header",children:[Ue.jsx("h3",{children:"Layers"}),Ue.jsx("button",{className:"bottom-sheet-close",onClick:c,children:""})]}),Ue.jsx("div",{className:"side-panel-content",children:x.map(h=>{const j=_[h];return!j||j.length===0?null:Ue.jsxs("div",{children:[Ue.jsx("div",{style:{padding:"8px 14px",fontSize:"11px",color:"#666",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",borderBottom:"1px solid #333355"},children:b[h]}),Ue.jsx("div",{className:"layer-list",children:j.map(q=>Ue.jsxs("div",{className:"layer-item",onClick:()=>o(q.id),children:[Ue.jsx("div",{className:`layer-checkbox ${r.has(q.id)?"active":""}`}),Ue.jsxs("div",{className:"layer-info",children:[Ue.jsx("div",{className:"layer-title",children:q.title}),Ue.jsxs("div",{className:"layer-source",children:[q.source.format.toUpperCase(),"  ",q.type]})]})]},q.id))})]},h)})})]})},DC=[{id:"dk",name:"Dakshina Kannada",displayName:"Dakshina Kannada, Karnataka",type:"district",lat:12.8438,lon:75.2479,state:"Karnataka",importance:.9},{id:"uk",name:"Uttara Kannada",displayName:"Uttara Kannada, Karnataka",type:"district",lat:14.6819,lon:74.6899,state:"Karnataka",importance:.9},{id:"udupi",name:"Udupi",displayName:"Udupi, Karnataka",type:"district",lat:13.3409,lon:74.7421,state:"Karnataka",importance:.9},{id:"shimoga",name:"Shimoga",displayName:"Shimoga, Karnataka",type:"district",lat:13.9299,lon:75.5681,state:"Karnataka",importance:.9},{id:"chikmagalur",name:"Chikmagalur",displayName:"Chikmagalur, Karnataka",type:"district",lat:13.3161,lon:75.772,state:"Karnataka",importance:.9},{id:"hassan",name:"Hassan",displayName:"Hassan, Karnataka",type:"district",lat:13.0068,lon:76.1003,state:"Karnataka",importance:.9},{id:"kodagu",name:"Kodagu",displayName:"Kodagu (Coorg), Karnataka",type:"district",lat:12.4244,lon:75.7382,state:"Karnataka",importance:.9},{id:"mysore",name:"Mysore",displayName:"Mysore, Karnataka",type:"district",lat:12.2958,lon:76.6394,state:"Karnataka",importance:.95},{id:"bangalore",name:"Bangalore",displayName:"Bangalore, Karnataka",type:"district",lat:12.9716,lon:77.5946,state:"Karnataka",importance:1},{id:"belgaum",name:"Belgaum",displayName:"Belgaum, Karnataka",type:"district",lat:15.8497,lon:74.4977,state:"Karnataka",importance:.9},{id:"dharwad",name:"Dharwad",displayName:"Dharwad, Karnataka",type:"district",lat:15.4589,lon:75.0078,state:"Karnataka",importance:.9},{id:"haveri",name:"Haveri",displayName:"Haveri, Karnataka",type:"district",lat:14.7951,lon:75.3991,state:"Karnataka",importance:.85},{id:"chamrajnagar",name:"Chamarajanagar",displayName:"Chamarajanagar, Karnataka",type:"district",lat:11.9261,lon:76.9437,state:"Karnataka",importance:.85},{id:"mandya",name:"Mandya",displayName:"Mandya, Karnataka",type:"district",lat:12.5218,lon:76.8951,state:"Karnataka",importance:.85},{id:"ramanagara",name:"Ramanagara",displayName:"Ramanagara, Karnataka",type:"district",lat:12.7159,lon:77.2819,state:"Karnataka",importance:.8}],zC=[{id:"mangalore",name:"Mangalore",displayName:"Mangalore, Dakshina Kannada",type:"city",lat:12.9141,lon:74.856,district:"Dakshina Kannada",state:"Karnataka",importance:.95},{id:"puttur",name:"Puttur",displayName:"Puttur, Dakshina Kannada",type:"town",lat:12.7596,lon:75.2025,district:"Dakshina Kannada",state:"Karnataka",importance:.7},{id:"sullia",name:"Sullia",displayName:"Sullia, Dakshina Kannada",type:"town",lat:12.561,lon:75.3871,district:"Dakshina Kannada",state:"Karnataka",importance:.65},{id:"bantwal",name:"Bantwal",displayName:"Bantwal, Dakshina Kannada",type:"town",lat:12.8914,lon:75.0345,district:"Dakshina Kannada",state:"Karnataka",importance:.7},{id:"belthangady",name:"Belthangady",displayName:"Belthangady, Dakshina Kannada",type:"town",lat:12.9833,lon:75.3,district:"Dakshina Kannada",state:"Karnataka",importance:.65},{id:"udupi_city",name:"Udupi",displayName:"Udupi City, Udupi",type:"city",lat:13.3409,lon:74.7421,district:"Udupi",state:"Karnataka",importance:.85},{id:"kundapura",name:"Kundapura",displayName:"Kundapura, Udupi",type:"town",lat:13.6316,lon:74.6916,district:"Udupi",state:"Karnataka",importance:.7},{id:"karkala",name:"Karkala",displayName:"Karkala, Udupi",type:"town",lat:13.2167,lon:74.9833,district:"Udupi",state:"Karnataka",importance:.7},{id:"karwar",name:"Karwar",displayName:"Karwar, Uttara Kannada",type:"city",lat:14.8182,lon:74.1351,district:"Uttara Kannada",state:"Karnataka",importance:.8},{id:"sirsi",name:"Sirsi",displayName:"Sirsi, Uttara Kannada",type:"town",lat:14.6214,lon:74.8354,district:"Uttara Kannada",state:"Karnataka",importance:.75},{id:"kumta",name:"Kumta",displayName:"Kumta, Uttara Kannada",type:"town",lat:14.4284,lon:74.4141,district:"Uttara Kannada",state:"Karnataka",importance:.7},{id:"honavar",name:"Honavar",displayName:"Honavar, Uttara Kannada",type:"town",lat:14.2805,lon:74.4438,district:"Uttara Kannada",state:"Karnataka",importance:.7},{id:"bhatkal",name:"Bhatkal",displayName:"Bhatkal, Uttara Kannada",type:"town",lat:13.985,lon:74.5553,district:"Uttara Kannada",state:"Karnataka",importance:.7},{id:"dandeli",name:"Dandeli",displayName:"Dandeli, Uttara Kannada",type:"town",lat:15.2667,lon:74.6167,district:"Uttara Kannada",state:"Karnataka",importance:.75},{id:"ankola",name:"Ankola",displayName:"Ankola, Uttara Kannada",type:"town",lat:14.66,lon:74.3,district:"Uttara Kannada",state:"Karnataka",importance:.65},{id:"gokarna",name:"Gokarna",displayName:"Gokarna, Uttara Kannada",type:"town",lat:14.55,lon:74.3167,district:"Uttara Kannada",state:"Karnataka",importance:.75},{id:"murudeshwar",name:"Murudeshwar",displayName:"Murudeshwar, Uttara Kannada",type:"town",lat:14.0944,lon:74.4844,district:"Uttara Kannada",state:"Karnataka",importance:.7},{id:"shimoga_city",name:"Shimoga",displayName:"Shimoga City, Shimoga",type:"city",lat:13.9299,lon:75.5681,district:"Shimoga",state:"Karnataka",importance:.85},{id:"bhadravati",name:"Bhadravati",displayName:"Bhadravati, Shimoga",type:"town",lat:13.8489,lon:75.705,district:"Shimoga",state:"Karnataka",importance:.75},{id:"sagar",name:"Sagar",displayName:"Sagar, Shimoga",type:"town",lat:14.1667,lon:75.0333,district:"Shimoga",state:"Karnataka",importance:.7},{id:"hosanagara",name:"Hosanagara",displayName:"Hosanagara, Shimoga",type:"town",lat:13.9167,lon:75.0667,district:"Shimoga",state:"Karnataka",importance:.6},{id:"thirthahalli",name:"Thirthahalli",displayName:"Thirthahalli, Shimoga",type:"town",lat:13.6833,lon:75.2333,district:"Shimoga",state:"Karnataka",importance:.65},{id:"jog_falls",name:"Jog Falls",displayName:"Jog Falls, Shimoga",type:"landmark",lat:14.2294,lon:74.8124,district:"Shimoga",state:"Karnataka",importance:.8},{id:"chikmagalur_city",name:"Chikmagalur",displayName:"Chikmagalur City",type:"city",lat:13.3161,lon:75.772,district:"Chikmagalur",state:"Karnataka",importance:.8},{id:"kadur",name:"Kadur",displayName:"Kadur, Chikmagalur",type:"town",lat:13.55,lon:76.0167,district:"Chikmagalur",state:"Karnataka",importance:.65},{id:"mudigere",name:"Mudigere",displayName:"Mudigere, Chikmagalur",type:"town",lat:13.1333,lon:75.6333,district:"Chikmagalur",state:"Karnataka",importance:.65},{id:"sringeri",name:"Sringeri",displayName:"Sringeri, Chikmagalur",type:"town",lat:13.4167,lon:75.25,district:"Chikmagalur",state:"Karnataka",importance:.7},{id:"mullayanagiri",name:"Mullayanagiri",displayName:"Mullayanagiri Peak, Chikmagalur",type:"natural",lat:13.3875,lon:75.7229,district:"Chikmagalur",state:"Karnataka",importance:.75},{id:"bababudangiri",name:"Baba Budangiri",displayName:"Baba Budangiri, Chikmagalur",type:"natural",lat:13.4333,lon:75.75,district:"Chikmagalur",state:"Karnataka",importance:.7},{id:"madikeri",name:"Madikeri",displayName:"Madikeri (Mercara), Kodagu",type:"city",lat:12.4244,lon:75.7382,district:"Kodagu",state:"Karnataka",importance:.8},{id:"virajpet",name:"Virajpet",displayName:"Virajpet, Kodagu",type:"town",lat:12.1972,lon:75.8019,district:"Kodagu",state:"Karnataka",importance:.7},{id:"somwarpet",name:"Somwarpet",displayName:"Somwarpet, Kodagu",type:"town",lat:12.5961,lon:75.85,district:"Kodagu",state:"Karnataka",importance:.65},{id:"kushalnagar",name:"Kushalnagar",displayName:"Kushalnagar, Kodagu",type:"town",lat:12.4582,lon:75.9586,district:"Kodagu",state:"Karnataka",importance:.65},{id:"talakaveri",name:"Talakaveri",displayName:"Talakaveri, Kodagu",type:"landmark",lat:12.3833,lon:75.4833,district:"Kodagu",state:"Karnataka",importance:.7},{id:"hassan_city",name:"Hassan",displayName:"Hassan City",type:"city",lat:13.0068,lon:76.1003,district:"Hassan",state:"Karnataka",importance:.8},{id:"belur",name:"Belur",displayName:"Belur, Hassan",type:"town",lat:13.1667,lon:75.8667,district:"Hassan",state:"Karnataka",importance:.75},{id:"halebidu",name:"Halebidu",displayName:"Halebidu, Hassan",type:"landmark",lat:13.2117,lon:75.9944,district:"Hassan",state:"Karnataka",importance:.75},{id:"sakleshpur",name:"Sakleshpur",displayName:"Sakleshpur, Hassan",type:"town",lat:12.9429,lon:75.7847,district:"Hassan",state:"Karnataka",importance:.7},{id:"hubli",name:"Hubli",displayName:"Hubli-Dharwad, Karnataka",type:"city",lat:15.3647,lon:75.124,state:"Karnataka",importance:.9},{id:"belgaum_city",name:"Belgaum",displayName:"Belgaum City",type:"city",lat:15.8497,lon:74.4977,district:"Belgaum",state:"Karnataka",importance:.85}],LC=[{id:"kudremukh",name:"Kudremukh",displayName:"Kudremukh National Park",type:"natural",lat:13.25,lon:75.25,district:"Chikmagalur",state:"Karnataka",importance:.85},{id:"bhadra",name:"Bhadra Wildlife Sanctuary",displayName:"Bhadra Wildlife Sanctuary",type:"natural",lat:13.6833,lon:75.5167,district:"Chikmagalur",state:"Karnataka",importance:.8},{id:"sharavathi",name:"Sharavathi Valley",displayName:"Sharavathi Valley Wildlife Sanctuary",type:"natural",lat:14.1333,lon:74.9167,district:"Shimoga",state:"Karnataka",importance:.75},{id:"agumbe",name:"Agumbe",displayName:"Agumbe Rainforest",type:"natural",lat:13.5019,lon:75.0933,district:"Shimoga",state:"Karnataka",importance:.8},{id:"nagarhole",name:"Nagarhole",displayName:"Nagarhole National Park",type:"natural",lat:12.0167,lon:76.0167,district:"Kodagu",state:"Karnataka",importance:.85},{id:"bandipur",name:"Bandipur",displayName:"Bandipur National Park",type:"natural",lat:11.6667,lon:76.6333,district:"Chamarajanagar",state:"Karnataka",importance:.85},{id:"pushpagiri",name:"Pushpagiri",displayName:"Pushpagiri Wildlife Sanctuary",type:"natural",lat:12.5833,lon:75.7,district:"Kodagu",state:"Karnataka",importance:.7},{id:"brahmagiri",name:"Brahmagiri",displayName:"Brahmagiri Wildlife Sanctuary",type:"natural",lat:11.9333,lon:75.9833,district:"Kodagu",state:"Karnataka",importance:.7},{id:"anshi",name:"Anshi National Park",displayName:"Anshi National Park",type:"natural",lat:15.0667,lon:74.4,district:"Uttara Kannada",state:"Karnataka",importance:.75},{id:"kali_tiger",name:"Kali Tiger Reserve",displayName:"Kali Tiger Reserve",type:"natural",lat:15.3,lon:74.5,district:"Uttara Kannada",state:"Karnataka",importance:.8}],RC=[{id:"wayanad",name:"Wayanad",displayName:"Wayanad, Kerala",type:"district",lat:11.6854,lon:76.132,state:"Kerala",importance:.85},{id:"palakkad",name:"Palakkad",displayName:"Palakkad, Kerala",type:"district",lat:10.7867,lon:76.6548,state:"Kerala",importance:.85},{id:"idukki",name:"Idukki",displayName:"Idukki, Kerala",type:"district",lat:9.9189,lon:77.1025,state:"Kerala",importance:.85},{id:"munnar",name:"Munnar",displayName:"Munnar, Kerala",type:"town",lat:10.0889,lon:77.0595,state:"Kerala",importance:.85},{id:"nilgiris",name:"Nilgiris",displayName:"Nilgiris (Ooty), Tamil Nadu",type:"district",lat:11.4102,lon:76.695,state:"Tamil Nadu",importance:.9},{id:"ooty",name:"Ooty",displayName:"Ooty, Nilgiris",type:"city",lat:11.4102,lon:76.695,state:"Tamil Nadu",importance:.9},{id:"coimbatore",name:"Coimbatore",displayName:"Coimbatore, Tamil Nadu",type:"city",lat:11.0168,lon:76.9558,state:"Tamil Nadu",importance:.9},{id:"north_goa",name:"North Goa",displayName:"North Goa",type:"district",lat:15.5333,lon:73.95,state:"Goa",importance:.85},{id:"south_goa",name:"South Goa",displayName:"South Goa",type:"district",lat:15.2833,lon:74.1667,state:"Goa",importance:.85},{id:"kolhapur",name:"Kolhapur",displayName:"Kolhapur, Maharashtra",type:"district",lat:16.6913,lon:74.2446,state:"Maharashtra",importance:.85},{id:"satara",name:"Satara",displayName:"Satara, Maharashtra",type:"district",lat:17.6805,lon:74.0183,state:"Maharashtra",importance:.8},{id:"ratnagiri",name:"Ratnagiri",displayName:"Ratnagiri, Maharashtra",type:"district",lat:16.9944,lon:73.3,state:"Maharashtra",importance:.8},{id:"sindhudurg",name:"Sindhudurg",displayName:"Sindhudurg, Maharashtra",type:"district",lat:16.05,lon:73.4667,state:"Maharashtra",importance:.8},{id:"mahabaleshwar",name:"Mahabaleshwar",displayName:"Mahabaleshwar, Maharashtra",type:"town",lat:17.9307,lon:73.6477,state:"Maharashtra",importance:.85}],OC=[...DC,...zC,...LC,...RC];class FC{places=OC;isOnline=navigator.onLine;constructor(){window.addEventListener("online",()=>this.isOnline=!0),window.addEventListener("offline",()=>this.isOnline=!1)}async search(r,o=10){const c=r.toLowerCase().trim();if(!c)return[];const _=c.match(/^(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)$/);if(_){const x=parseFloat(_[1]),h=parseFloat(_[2]);return[{id:`coord_${x}_${h}`,name:`${x.toFixed(4)}, ${h.toFixed(4)}`,displayName:`Coordinates: ${x.toFixed(4)}, ${h.toFixed(4)}`,type:"landmark",lat:x,lon:h,importance:1}]}const b=this.searchLocal(c,o);if(b.length>=o||!this.isOnline)return b;try{const x=await this.searchOnline(r,o-b.length);return this.mergeResults(b,x).slice(0,o)}catch{return b}}searchLocal(r,o){const c=[];for(const _ of this.places){const b=_.name.toLowerCase(),x=_.displayName.toLowerCase();let h=0;b===r?h=100:b.startsWith(r)?h=80+r.length/b.length*10:x.startsWith(r)?h=70+r.length/x.length*10:b.includes(r)?h=50+r.length/b.length*20:x.includes(r)?h=40+r.length/x.length*20:this.fuzzyMatch(r,b)&&(h=30),h>0&&(h+=_.importance*10,c.push({place:_,score:h}))}return c.sort((_,b)=>b.score-_.score).slice(0,o).map(_=>_.place)}fuzzyMatch(r,o){let c=0;for(let _=0;_<o.length&&c<r.length;_++)r[c]===o[_]&&c++;return c===r.length}async searchOnline(r,o){const c=new URL("https://nominatim.openstreetmap.org/search");c.searchParams.set("q",`${r}, Karnataka, India`),c.searchParams.set("format","json"),c.searchParams.set("limit",String(o)),c.searchParams.set("addressdetails","1");const _=await fetch(c.toString(),{headers:{Accept:"application/json","User-Agent":"WGFieldValidator/1.0"}});if(!_.ok)throw new Error("Search failed");return(await _.json()).map(x=>({id:`osm_${x.place_id}`,name:x.display_name.split(",")[0],displayName:x.display_name,type:this.mapOsmType(x.type),lat:parseFloat(x.lat),lon:parseFloat(x.lon),state:x.address?.state,district:x.address?.county||x.address?.state_district,importance:x.importance}))}mapOsmType(r){return{city:"city",town:"town",village:"village",administrative:"district",hamlet:"village",suburb:"town",peak:"natural",water:"natural",forest:"natural"}[r]||"landmark"}mergeResults(r,o){const c=new Set(r.map(b=>`${b.lat.toFixed(3)}_${b.lon.toFixed(3)}`)),_=[...r];for(const b of o){const x=`${b.lat.toFixed(3)}_${b.lon.toFixed(3)}`;c.has(x)||(c.add(x),_.push(b))}return _}async reverseGeocode(r,o){const c=this.findNearby(r,o,5e3);if(c)return c;if(this.isOnline)try{const _=`https://nominatim.openstreetmap.org/reverse?lat=${r}&lon=${o}&format=json&addressdetails=1`,b=await fetch(_,{headers:{Accept:"application/json","User-Agent":"WGFieldValidator/1.0"}});if(b.ok){const x=await b.json();return{id:`osm_${x.place_id}`,name:x.name||x.display_name.split(",")[0],displayName:x.display_name,type:"landmark",lat:r,lon:o,state:x.address?.state,district:x.address?.county||x.address?.state_district,importance:.5}}}catch{}return null}findNearby(r,o,c){let _=null,b=1/0;for(const x of this.places){const h=this.haversineDistance(r,o,x.lat,x.lon);h<c&&h<b&&(b=h,_=x)}return _}haversineDistance(r,o,c,_){const x=r*Math.PI/180,h=c*Math.PI/180,j=(c-r)*Math.PI/180,q=(_-o)*Math.PI/180,le=Math.sin(j/2)**2+Math.cos(x)*Math.cos(h)*Math.sin(q/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(le),Math.sqrt(1-le)))}getPlacesByDistrict(r){const o=r.toLowerCase();return this.places.filter(c=>c.district?.toLowerCase()===o||c.name.toLowerCase()===o)}}const BC=new FC,NC=({onSearch:n,isOnline:r=!0})=>{const[o,c]=Kt.useState(""),[_,b]=Kt.useState([]),[x,h]=Kt.useState(!1),[j,q]=Kt.useState(!1),[le,Y]=Kt.useState(-1),W=Kt.useRef(null),$e=Kt.useRef(null),He=Kt.useRef(),Je=Kt.useCallback(async Ve=>{if(!Ve.trim()){b([]),h(!1);return}q(!0);try{const et=await BC.search(Ve,8);b(et),h(et.length>0),Y(-1)}catch(et){console.error("Search failed:",et),b([])}finally{q(!1)}},[]),Qt=Ve=>{const et=Ve.target.value;c(et),He.current&&clearTimeout(He.current),He.current=setTimeout(()=>{Je(et)},300)},be=Ve=>{switch(Ve.key){case"ArrowDown":Ve.preventDefault(),Y(et=>et<_.length-1?et+1:et);break;case"ArrowUp":Ve.preventDefault(),Y(et=>et>0?et-1:-1);break;case"Enter":if(Ve.preventDefault(),le>=0&&_[le])pe(_[le]);else if(_.length>0)pe(_[0]);else{const et=o.match(/^(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)$/);if(et){const ut=parseFloat(et[1]),Qe=parseFloat(et[2]);n(ut,Qe),h(!1),c("")}}break;case"Escape":h(!1),Y(-1);break}},pe=Ve=>{n(Ve.lat,Ve.lon,Ve.displayName),c(Ve.name),h(!1),Y(-1)};Kt.useEffect(()=>{const Ve=et=>{W.current&&!W.current.contains(et.target)&&$e.current&&!$e.current.contains(et.target)&&h(!1)};return document.addEventListener("mousedown",Ve),()=>document.removeEventListener("mousedown",Ve)},[]);const ke=Ve=>{switch(Ve){case"city":return"";case"town":return"";case"village":return"";case"district":return"";case"taluk":return"";case"landmark":return"";case"natural":return"";default:return""}};return Ue.jsxs("div",{className:"search-bar",children:[Ue.jsxs("div",{className:"search-input-wrapper",children:[Ue.jsx("span",{className:"search-icon",children:""}),Ue.jsx("input",{ref:W,type:"text",value:o,onChange:Qt,onKeyDown:be,onFocus:()=>_.length>0&&h(!0),placeholder:"Search places, districts, or coordinates...","aria-label":"Search location","aria-expanded":x,"aria-autocomplete":"list",autoComplete:"off"}),j&&Ue.jsx("span",{className:"search-spinner",children:""}),!r&&Ue.jsx("span",{className:"offline-badge",title:"Offline mode",children:""})]}),x&&_.length>0&&Ue.jsx("div",{ref:$e,className:"search-results",role:"listbox",children:_.map((Ve,et)=>Ue.jsxs("div",{className:`search-result-item ${et===le?"selected":""}`,onClick:()=>pe(Ve),onMouseEnter:()=>Y(et),role:"option","aria-selected":et===le,children:[Ue.jsx("span",{className:"result-icon",children:ke(Ve.type)}),Ue.jsxs("div",{className:"result-text",children:[Ue.jsx("div",{className:"result-name",children:Ve.name}),Ue.jsxs("div",{className:"result-detail",children:[Ve.district&&`${Ve.district}, `,Ve.state||"Karnataka"]})]}),Ue.jsx("span",{className:"result-type",children:Ve.type})]},Ve.id))})]})},jC=({summary:n,location:r,onClose:o})=>{const c=n.layers||{};return Ue.jsxs("div",{className:"location-summary",children:[Ue.jsxs("div",{className:"location-summary-header",children:[Ue.jsxs("h4",{children:[" ",r?`${r.lat.toFixed(5)}, ${r.lon.toFixed(5)}`:"Location Summary"]}),Ue.jsx("button",{className:"bottom-sheet-close",onClick:o,style:{padding:0},children:""})]}),r&&r.accuracy>0&&Ue.jsxs("div",{style:{fontSize:"11px",color:"#666",marginBottom:"8px"},children:["Accuracy: ",Math.round(r.accuracy),"m"]}),Ue.jsxs("div",{className:"summary-grid",children:[Object.entries(c).map(([_,b])=>{const x=UC(b.values);return x?Ue.jsxs("div",{className:"summary-item",children:[Ue.jsx("div",{className:"summary-label",children:b.title}),Ue.jsx("div",{className:"summary-value",children:x})]},_):null}),Object.keys(c).length===0&&Ue.jsx("div",{style:{gridColumn:"1 / -1",textAlign:"center",color:"#666",padding:"12px"},children:"No data available at this location"})]})]})};function UC(n){if(!n||Object.keys(n).length===0)return"";if(n._source==="csv_summary"){const c=n._year,_=n._recordCount;return c?`Year: ${c} (${_} records)`:`${_} records`}const r=Object.entries(n).filter(([c])=>!c.startsWith("_"));return r.length===0?"":r.filter(([,c])=>c!=null&&c!=="").slice(0,2).map(([c,_])=>`${c}: ${_}`).join(", ")}const VC=({onClick:n})=>Ue.jsx("button",{className:"capture-button",onClick:n,"aria-label":"Capture observation",title:"Capture Observation",children:""});var Gw={exports:{}};(function(n,r){(function(o,c){n.exports=c()})(Nf,function(){var o=function(v,k){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,D){E.__proto__=D}||function(E,D){for(var F in D)Object.prototype.hasOwnProperty.call(D,F)&&(E[F]=D[F])})(v,k)},c=function(){return(c=Object.assign||function(v){for(var k,E=1,D=arguments.length;E<D;E++)for(var F in k=arguments[E])Object.prototype.hasOwnProperty.call(k,F)&&(v[F]=k[F]);return v}).apply(this,arguments)};function _(v,k,E){for(var D,F=0,$=k.length;F<$;F++)!D&&F in k||((D=D||Array.prototype.slice.call(k,0,F))[F]=k[F]);return v.concat(D||Array.prototype.slice.call(k))}var b=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Nf,x=Object.keys,h=Array.isArray;function j(v,k){return typeof k!="object"||x(k).forEach(function(E){v[E]=k[E]}),v}typeof Promise>"u"||b.Promise||(b.Promise=Promise);var q=Object.getPrototypeOf,le={}.hasOwnProperty;function Y(v,k){return le.call(v,k)}function W(v,k){typeof k=="function"&&(k=k(q(v))),(typeof Reflect>"u"?x:Reflect.ownKeys)(k).forEach(function(E){He(v,E,k[E])})}var $e=Object.defineProperty;function He(v,k,E,D){$e(v,k,j(E&&Y(E,"get")&&typeof E.get=="function"?{get:E.get,set:E.set,configurable:!0}:{value:E,configurable:!0,writable:!0},D))}function Je(v){return{from:function(k){return v.prototype=Object.create(k.prototype),He(v.prototype,"constructor",v),{extend:W.bind(null,v.prototype)}}}}var Qt=Object.getOwnPropertyDescriptor,be=[].slice;function pe(v,k,E){return be.call(v,k,E)}function ke(v,k){return k(v)}function Ve(v){if(!v)throw new Error("Assertion Failed")}function et(v){b.setImmediate?setImmediate(v):setTimeout(v,0)}function ut(v,k){if(typeof k=="string"&&Y(v,k))return v[k];if(!k)return v;if(typeof k!="string"){for(var E=[],D=0,F=k.length;D<F;++D){var $=ut(v,k[D]);E.push($)}return E}var J=k.indexOf(".");if(J!==-1){var se=v[k.substr(0,J)];return se==null?void 0:ut(se,k.substr(J+1))}}function Qe(v,k,E){if(v&&k!==void 0&&!("isFrozen"in Object&&Object.isFrozen(v)))if(typeof k!="string"&&"length"in k){Ve(typeof E!="string"&&"length"in E);for(var D=0,F=k.length;D<F;++D)Qe(v,k[D],E[D])}else{var $,J,se=k.indexOf(".");se!==-1?($=k.substr(0,se),(J=k.substr(se+1))===""?E===void 0?h(v)&&!isNaN(parseInt($))?v.splice($,1):delete v[$]:v[$]=E:Qe(se=!(se=v[$])||!Y(v,$)?v[$]={}:se,J,E)):E===void 0?h(v)&&!isNaN(parseInt(k))?v.splice(k,1):delete v[k]:v[k]=E}}function ce(v){var k,E={};for(k in v)Y(v,k)&&(E[k]=v[k]);return E}var me=[].concat;function Le(v){return me.apply([],v)}var Vr="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Le([8,16,32,64].map(function(v){return["Int","Uint","Float"].map(function(k){return k+v+"Array"})}))).filter(function(v){return b[v]}),Ye=new Set(Vr.map(function(v){return b[v]})),Tt=null;function Ot(v){return Tt=new WeakMap,v=function k(E){if(!E||typeof E!="object")return E;var D=Tt.get(E);if(D)return D;if(h(E)){D=[],Tt.set(E,D);for(var F=0,$=E.length;F<$;++F)D.push(k(E[F]))}else if(Ye.has(E.constructor))D=E;else{var J,se=q(E);for(J in D=se===Object.prototype?{}:Object.create(se),Tt.set(E,D),E)Y(E,J)&&(D[J]=k(E[J]))}return D}(v),Tt=null,v}var vr={}.toString;function Kr(v){return vr.call(v).slice(8,-1)}var Hr=typeof Symbol<"u"?Symbol.iterator:"@@iterator",nr=typeof Hr=="symbol"?function(v){var k;return v!=null&&(k=v[Hr])&&k.apply(v)}:function(){return null};function Ke(v,k){return k=v.indexOf(k),0<=k&&v.splice(k,1),0<=k}var We={};function gt(v){var k,E,D,F;if(arguments.length===1){if(h(v))return v.slice();if(this===We&&typeof v=="string")return[v];if(F=nr(v)){for(E=[];!(D=F.next()).done;)E.push(D.value);return E}if(v==null)return[v];if(typeof(k=v.length)!="number")return[v];for(E=new Array(k);k--;)E[k]=v[k];return E}for(k=arguments.length,E=new Array(k);k--;)E[k]=arguments[k];return E}var yt=typeof Symbol<"u"?function(v){return v[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Zr=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Zn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Zr),Rt={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function It(v,k){this.name=v,this.message=k}function Sr(v,k){return v+". Errors: "+Object.keys(k).map(function(E){return k[E].toString()}).filter(function(E,D,F){return F.indexOf(E)===D}).join(`
`)}function wr(v,k,E,D){this.failures=k,this.failedKeys=D,this.successCount=E,this.message=Sr(v,k)}function kr(v,k){this.name="BulkError",this.failures=Object.keys(k).map(function(E){return k[E]}),this.failuresByPos=k,this.message=Sr(v,this.failures)}Je(It).from(Error).extend({toString:function(){return this.name+": "+this.message}}),Je(wr).from(It),Je(kr).from(It);var zr=Zn.reduce(function(v,k){return v[k]=k+"Error",v},{}),ur=It,ct=Zn.reduce(function(v,k){var E=k+"Error";function D(F,$){this.name=E,F?typeof F=="string"?(this.message="".concat(F).concat($?`
 `+$:""),this.inner=$||null):typeof F=="object"&&(this.message="".concat(F.name," ").concat(F.message),this.inner=F):(this.message=Rt[k]||E,this.inner=null)}return Je(D).from(ur),v[k]=D,v},{});ct.Syntax=SyntaxError,ct.Type=TypeError,ct.Range=RangeError;var Br=Zr.reduce(function(v,k){return v[k+"Error"]=ct[k],v},{}),cr=Zn.reduce(function(v,k){return["Syntax","Type","Range"].indexOf(k)===-1&&(v[k+"Error"]=ct[k]),v},{});function Gt(){}function Nr(v){return v}function Lr(v,k){return v==null||v===Nr?k:function(E){return k(v(E))}}function gr(v,k){return function(){v.apply(this,arguments),k.apply(this,arguments)}}function Te(v,k){return v===Gt?k:function(){var E=v.apply(this,arguments);E!==void 0&&(arguments[0]=E);var D=this.onsuccess,F=this.onerror;this.onsuccess=null,this.onerror=null;var $=k.apply(this,arguments);return D&&(this.onsuccess=this.onsuccess?gr(D,this.onsuccess):D),F&&(this.onerror=this.onerror?gr(F,this.onerror):F),$!==void 0?$:E}}function nn(v,k){return v===Gt?k:function(){v.apply(this,arguments);var E=this.onsuccess,D=this.onerror;this.onsuccess=this.onerror=null,k.apply(this,arguments),E&&(this.onsuccess=this.onsuccess?gr(E,this.onsuccess):E),D&&(this.onerror=this.onerror?gr(D,this.onerror):D)}}function Tr(v,k){return v===Gt?k:function(E){var D=v.apply(this,arguments);j(E,D);var F=this.onsuccess,$=this.onerror;return this.onsuccess=null,this.onerror=null,E=k.apply(this,arguments),F&&(this.onsuccess=this.onsuccess?gr(F,this.onsuccess):F),$&&(this.onerror=this.onerror?gr($,this.onerror):$),D===void 0?E===void 0?void 0:E:j(D,E)}}function Wt(v,k){return v===Gt?k:function(){return k.apply(this,arguments)!==!1&&v.apply(this,arguments)}}function dr(v,k){return v===Gt?k:function(){var E=v.apply(this,arguments);if(E&&typeof E.then=="function"){for(var D=this,F=arguments.length,$=new Array(F);F--;)$[F]=arguments[F];return E.then(function(){return k.apply(D,$)})}return k.apply(this,arguments)}}cr.ModifyError=wr,cr.DexieError=It,cr.BulkError=kr;var _n=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Sn(v){_n=v}var An={},an=100,Vr=typeof Promise>"u"?[]:function(){var v=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[v,q(v),v];var k=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[k,q(k),v]}(),Zr=Vr[0],Zn=Vr[1],Vr=Vr[2],Zn=Zn&&Zn.then,Yr=Zr&&Zr.constructor,rt=!!Vr,Fn=function(v,k){ti.push([v,k]),Cn&&(queueMicrotask(ee),Cn=!1)},kn=!0,Cn=!0,en=[],at=[],lr=Nr,Ht={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Gt,pgp:!1,env:{},finalize:Gt},zt=Ht,ti=[],er=0,bi=[];function wt(v){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var k=this._PSD=zt;if(typeof v!="function"){if(v!==An)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&ne(this,this._value))}this._state=null,this._value=null,++k.ref,function E(D,F){try{F(function($){if(D._state===null){if($===D)throw new TypeError("A promise cannot be resolved with itself.");var J=D._lib&&fe();$&&typeof $.then=="function"?E(D,function(se,ye){$ instanceof wt?$._then(se,ye):$.then(se,ye)}):(D._state=!0,D._value=$,N(D)),J&&_e()}},ne.bind(null,D))}catch($){ne(D,$)}}(this,v)}var ca={get:function(){var v=zt,k=$t;function E(D,F){var $=this,J=!v.global&&(v!==zt||k!==$t),se=J&&!hr(),ye=new wt(function(xe,Ee){B($,new Xi(Mn(D,v,J,se),Mn(F,v,J,se),xe,Ee,v))});return this._consoleTask&&(ye._consoleTask=this._consoleTask),ye}return E.prototype=An,E},set:function(v){He(this,"then",v&&v.prototype===An?ca:{get:function(){return v},set:ca.set})}};function Xi(v,k,E,D,F){this.onFulfilled=typeof v=="function"?v:null,this.onRejected=typeof k=="function"?k:null,this.resolve=E,this.reject=D,this.psd=F}function ne(v,k){var E,D;at.push(k),v._state===null&&(E=v._lib&&fe(),k=lr(k),v._state=!1,v._value=k,D=v,en.some(function(F){return F._value===D._value})||en.push(D),N(v),E&&_e())}function N(v){var k=v._listeners;v._listeners=[];for(var E=0,D=k.length;E<D;++E)B(v,k[E]);var F=v._PSD;--F.ref||F.finalize(),er===0&&(++er,Fn(function(){--er==0&&Ae()},[]))}function B(v,k){if(v._state!==null){var E=v._state?k.onFulfilled:k.onRejected;if(E===null)return(v._state?k.resolve:k.reject)(v._value);++k.psd.ref,++er,Fn(H,[E,v,k])}else v._listeners.push(k)}function H(v,k,E){try{var D,F=k._value;!k._state&&at.length&&(at=[]),D=_n&&k._consoleTask?k._consoleTask.run(function(){return v(F)}):v(F),k._state||at.indexOf(F)!==-1||function($){for(var J=en.length;J;)if(en[--J]._value===$._value)return en.splice(J,1)}(k),E.resolve(D)}catch($){E.reject($)}finally{--er==0&&Ae(),--E.psd.ref||E.psd.finalize()}}function ee(){Ur(Ht,function(){fe()&&_e()})}function fe(){var v=kn;return Cn=kn=!1,v}function _e(){var v,k,E;do for(;0<ti.length;)for(v=ti,ti=[],E=v.length,k=0;k<E;++k){var D=v[k];D[0].apply(null,D[1])}while(0<ti.length);Cn=kn=!0}function Ae(){var v=en;en=[],v.forEach(function(D){D._PSD.onunhandled.call(null,D._value,D)});for(var k=bi.slice(0),E=k.length;E;)k[--E]()}function ue(v){return new wt(An,!1,v)}function Oe(v,k){var E=zt;return function(){var D=fe(),F=zt;try{return sr(E,!0),v.apply(this,arguments)}catch($){k&&k($)}finally{sr(F,!1),D&&_e()}}}W(wt.prototype,{then:ca,_then:function(v,k){B(this,new Xi(null,null,v,k,zt))},catch:function(v){if(arguments.length===1)return this.then(null,v);var k=v,E=arguments[1];return typeof k=="function"?this.then(null,function(D){return(D instanceof k?E:ue)(D)}):this.then(null,function(D){return(D&&D.name===k?E:ue)(D)})},finally:function(v){return this.then(function(k){return wt.resolve(v()).then(function(){return k})},function(k){return wt.resolve(v()).then(function(){return ue(k)})})},timeout:function(v,k){var E=this;return v<1/0?new wt(function(D,F){var $=setTimeout(function(){return F(new ct.Timeout(k))},v);E.then(D,F).finally(clearTimeout.bind(null,$))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&He(wt.prototype,Symbol.toStringTag,"Dexie.Promise"),Ht.env=jr(),W(wt,{all:function(){var v=gt.apply(null,arguments).map(dn);return new wt(function(k,E){v.length===0&&k([]);var D=v.length;v.forEach(function(F,$){return wt.resolve(F).then(function(J){v[$]=J,--D||k(v)},E)})})},resolve:function(v){return v instanceof wt?v:v&&typeof v.then=="function"?new wt(function(k,E){v.then(k,E)}):new wt(An,!0,v)},reject:ue,race:function(){var v=gt.apply(null,arguments).map(dn);return new wt(function(k,E){v.map(function(D){return wt.resolve(D).then(k,E)})})},PSD:{get:function(){return zt},set:function(v){return zt=v}},totalEchoes:{get:function(){return $t}},newPSD:tr,usePSD:Ur,scheduler:{get:function(){return Fn},set:function(v){Fn=v}},rejectionMapper:{get:function(){return lr},set:function(v){lr=v}},follow:function(v,k){return new wt(function(E,D){return tr(function(F,$){var J=zt;J.unhandleds=[],J.onunhandled=$,J.finalize=gr(function(){var se,ye=this;se=function(){ye.unhandleds.length===0?F():$(ye.unhandleds[0])},bi.push(function xe(){se(),bi.splice(bi.indexOf(xe),1)}),++er,Fn(function(){--er==0&&Ae()},[])},J.finalize),v()},k,E,D)})}}),Yr&&(Yr.allSettled&&He(wt,"allSettled",function(){var v=gt.apply(null,arguments).map(dn);return new wt(function(k){v.length===0&&k([]);var E=v.length,D=new Array(E);v.forEach(function(F,$){return wt.resolve(F).then(function(J){return D[$]={status:"fulfilled",value:J}},function(J){return D[$]={status:"rejected",reason:J}}).then(function(){return--E||k(D)})})})}),Yr.any&&typeof AggregateError<"u"&&He(wt,"any",function(){var v=gt.apply(null,arguments).map(dn);return new wt(function(k,E){v.length===0&&E(new AggregateError([]));var D=v.length,F=new Array(D);v.forEach(function($,J){return wt.resolve($).then(function(se){return k(se)},function(se){F[J]=se,--D||E(new AggregateError(F))})})})}),Yr.withResolvers&&(wt.withResolvers=Yr.withResolvers));var qe={awaits:0,echoes:0,id:0},Be=0,ot=[],Ft=0,$t=0,Er=0;function tr(v,k,E,D){var F=zt,$=Object.create(F);return $.parent=F,$.ref=0,$.global=!1,$.id=++Er,Ht.env,$.env=rt?{Promise:wt,PromiseProp:{value:wt,configurable:!0,writable:!0},all:wt.all,race:wt.race,allSettled:wt.allSettled,any:wt.any,resolve:wt.resolve,reject:wt.reject}:{},k&&j($,k),++F.ref,$.finalize=function(){--this.parent.ref||this.parent.finalize()},D=Ur($,v,E,D),$.ref===0&&$.finalize(),D}function xr(){return qe.id||(qe.id=++Be),++qe.awaits,qe.echoes+=an,qe.id}function hr(){return!!qe.awaits&&(--qe.awaits==0&&(qe.id=0),qe.echoes=qe.awaits*an,!0)}function dn(v){return qe.echoes&&v&&v.constructor===Yr?(xr(),v.then(function(k){return hr(),k},function(k){return hr(),Ar(k)})):v}function fn(){var v=ot[ot.length-1];ot.pop(),sr(v,!1)}function sr(v,k){var E,D=zt;(k?!qe.echoes||Ft++&&v===zt:!Ft||--Ft&&v===zt)||queueMicrotask(k?function(F){++$t,qe.echoes&&--qe.echoes!=0||(qe.echoes=qe.awaits=qe.id=0),ot.push(zt),sr(F,!0)}.bind(null,v):fn),v!==zt&&(zt=v,D===Ht&&(Ht.env=jr()),rt&&(E=Ht.env.Promise,k=v.env,(D.global||v.global)&&(Object.defineProperty(b,"Promise",k.PromiseProp),E.all=k.all,E.race=k.race,E.resolve=k.resolve,E.reject=k.reject,k.allSettled&&(E.allSettled=k.allSettled),k.any&&(E.any=k.any))))}function jr(){var v=b.Promise;return rt?{Promise:v,PromiseProp:Object.getOwnPropertyDescriptor(b,"Promise"),all:v.all,race:v.race,allSettled:v.allSettled,any:v.any,resolve:v.resolve,reject:v.reject}:{}}function Ur(v,k,E,D,F){var $=zt;try{return sr(v,!0),k(E,D,F)}finally{sr($,!1)}}function Mn(v,k,E,D){return typeof v!="function"?v:function(){var F=zt;E&&xr(),sr(k,!0);try{return v.apply(this,arguments)}finally{sr(F,!1),D&&queueMicrotask(hr)}}}function Dn(v){Promise===Yr&&qe.echoes===0?Ft===0?v():enqueueNativeMicroTask(v):setTimeout(v,0)}(""+Zn).indexOf("[native code]")===-1&&(xr=hr=Gt);var Ar=wt.reject,zi="",br="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",qo="String expected.",Xa=[],Hn="__dbnames",ri="readonly",Gl="readwrite";function Bn(v,k){return v?k?function(){return v.apply(this,arguments)&&k.apply(this,arguments)}:v:k}var ci={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ea(v){return typeof v!="string"||/\./.test(v)?function(k){return k}:function(k){return k[v]===void 0&&v in k&&delete(k=Ot(k))[v],k}}function Ya(){throw ct.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function rr(v,k){try{var E=Bs(v),D=Bs(k);if(E!==D)return E==="Array"?1:D==="Array"?-1:E==="binary"?1:D==="binary"?-1:E==="string"?1:D==="string"?-1:E==="Date"?1:D!=="Date"?NaN:-1;switch(E){case"number":case"Date":case"string":return k<v?1:v<k?-1:0;case"binary":return function(F,$){for(var J=F.length,se=$.length,ye=J<se?J:se,xe=0;xe<ye;++xe)if(F[xe]!==$[xe])return F[xe]<$[xe]?-1:1;return J===se?0:J<se?-1:1}(Li(v),Li(k));case"Array":return function(F,$){for(var J=F.length,se=$.length,ye=J<se?J:se,xe=0;xe<ye;++xe){var Ee=rr(F[xe],$[xe]);if(Ee!==0)return Ee}return J===se?0:J<se?-1:1}(v,k)}}catch{}return NaN}function Bs(v){var k=typeof v;return k!="object"?k:ArrayBuffer.isView(v)?"binary":(v=Kr(v),v==="ArrayBuffer"?"binary":v)}function Li(v){return v instanceof Uint8Array?v:ArrayBuffer.isView(v)?new Uint8Array(v.buffer,v.byteOffset,v.byteLength):new Uint8Array(v)}function sn(v,k,E){var D=v.schema.yProps;return D?(k&&0<E.numFailures&&(k=k.filter(function(F,$){return!E.failures[$]})),Promise.all(D.map(function(F){return F=F.updatesTable,k?v.db.table(F).where("k").anyOf(k).delete():v.db.table(F).clear()})).then(function(){return E})):E}var Ja=(Ri.prototype.execute=function(v){var k=this["@@propmod"];if(k.add!==void 0){var E=k.add;if(h(E))return _(_([],h(v)?v:[],!0),E).sort();if(typeof E=="number")return(Number(v)||0)+E;if(typeof E=="bigint")try{return BigInt(v)+E}catch{return BigInt(0)+E}throw new TypeError("Invalid term ".concat(E))}if(k.remove!==void 0){var D=k.remove;if(h(D))return h(v)?v.filter(function(F){return!D.includes(F)}).sort():[];if(typeof D=="number")return Number(v)-D;if(typeof D=="bigint")try{return BigInt(v)-D}catch{return BigInt(0)-D}throw new TypeError("Invalid subtrahend ".concat(D))}return E=(E=k.replacePrefix)===null||E===void 0?void 0:E[0],E&&typeof v=="string"&&v.startsWith(E)?k.replacePrefix[1]+v.substring(E.length):v},Ri);function Ri(v){this["@@propmod"]=v}function Ko(v,k){for(var E=x(k),D=E.length,F=!1,$=0;$<D;++$){var J=E[$],se=k[J],ye=ut(v,J);se instanceof Ja?(Qe(v,J,se.execute(ye)),F=!0):ye!==se&&(Qe(v,J,se),F=!0)}return F}var Oi=(Jr.prototype._trans=function(v,k,E){var D=this._tx||zt.trans,F=this.name,$=_n&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(v==="readonly"?"read":"write"," ").concat(this.name));function J(xe,Ee,he){if(!he.schema[F])throw new ct.NotFound("Table "+F+" not part of transaction");return k(he.idbtrans,he)}var se=fe();try{var ye=D&&D.db._novip===this.db._novip?D===zt.trans?D._promise(v,J,E):tr(function(){return D._promise(v,J,E)},{trans:D,transless:zt.transless||zt}):function xe(Ee,he,De,ve){if(Ee.idbdb&&(Ee._state.openComplete||zt.letThrough||Ee._vip)){var Ce=Ee._createTransaction(he,De,Ee._dbSchema);try{Ce.create(),Ee._state.PR1398_maxLoop=3}catch(Se){return Se.name===zr.InvalidState&&Ee.isOpen()&&0<--Ee._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),Ee.close({disableAutoOpen:!1}),Ee.open().then(function(){return xe(Ee,he,De,ve)})):Ar(Se)}return Ce._promise(he,function(Se,Me){return tr(function(){return zt.trans=Ce,ve(Se,Me,Ce)})}).then(function(Se){if(he==="readwrite")try{Ce.idbtrans.commit()}catch{}return he==="readonly"?Se:Ce._completion.then(function(){return Se})})}if(Ee._state.openComplete)return Ar(new ct.DatabaseClosed(Ee._state.dbOpenError));if(!Ee._state.isBeingOpened){if(!Ee._state.autoOpen)return Ar(new ct.DatabaseClosed);Ee.open().catch(Gt)}return Ee._state.dbReadyPromise.then(function(){return xe(Ee,he,De,ve)})}(this.db,v,[this.name],J);return $&&(ye._consoleTask=$,ye=ye.catch(function(xe){return console.trace(xe),Ar(xe)})),ye}finally{se&&_e()}},Jr.prototype.get=function(v,k){var E=this;return v&&v.constructor===Object?this.where(v).first(k):v==null?Ar(new ct.Type("Invalid argument to Table.get()")):this._trans("readonly",function(D){return E.core.get({trans:D,key:v}).then(function(F){return E.hook.reading.fire(F)})}).then(k)},Jr.prototype.where=function(v){if(typeof v=="string")return new this.db.WhereClause(this,v);if(h(v))return new this.db.WhereClause(this,"[".concat(v.join("+"),"]"));var k=x(v);if(k.length===1)return this.where(k[0]).equals(v[k[0]]);var E=this.schema.indexes.concat(this.schema.primKey).filter(function(se){if(se.compound&&k.every(function(xe){return 0<=se.keyPath.indexOf(xe)})){for(var ye=0;ye<k.length;++ye)if(k.indexOf(se.keyPath[ye])===-1)return!1;return!0}return!1}).sort(function(se,ye){return se.keyPath.length-ye.keyPath.length})[0];if(E&&this.db._maxKey!==zi){var $=E.keyPath.slice(0,k.length);return this.where($).equals($.map(function(ye){return v[ye]}))}!E&&_n&&console.warn("The query ".concat(JSON.stringify(v)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(k.join("+"),"]"));var D=this.schema.idxByName;function F(se,ye){return rr(se,ye)===0}var J=k.reduce(function(he,ye){var xe=he[0],Ee=he[1],he=D[ye],De=v[ye];return[xe||he,xe||!he?Bn(Ee,he&&he.multi?function(ve){return ve=ut(ve,ye),h(ve)&&ve.some(function(Ce){return F(De,Ce)})}:function(ve){return F(De,ut(ve,ye))}):Ee]},[null,null]),$=J[0],J=J[1];return $?this.where($.name).equals(v[$.keyPath]).filter(J):E?this.filter(J):this.where(k).equals("")},Jr.prototype.filter=function(v){return this.toCollection().and(v)},Jr.prototype.count=function(v){return this.toCollection().count(v)},Jr.prototype.offset=function(v){return this.toCollection().offset(v)},Jr.prototype.limit=function(v){return this.toCollection().limit(v)},Jr.prototype.each=function(v){return this.toCollection().each(v)},Jr.prototype.toArray=function(v){return this.toCollection().toArray(v)},Jr.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Jr.prototype.orderBy=function(v){return new this.db.Collection(new this.db.WhereClause(this,h(v)?"[".concat(v.join("+"),"]"):v))},Jr.prototype.reverse=function(){return this.toCollection().reverse()},Jr.prototype.mapToClass=function(v){var k,E=this.db,D=this.name;function F(){return k!==null&&k.apply(this,arguments)||this}(this.schema.mappedClass=v).prototype instanceof Ya&&(function(ye,xe){if(typeof xe!="function"&&xe!==null)throw new TypeError("Class extends value "+String(xe)+" is not a constructor or null");function Ee(){this.constructor=ye}o(ye,xe),ye.prototype=xe===null?Object.create(xe):(Ee.prototype=xe.prototype,new Ee)}(F,k=v),Object.defineProperty(F.prototype,"db",{get:function(){return E},enumerable:!1,configurable:!0}),F.prototype.table=function(){return D},v=F);for(var $=new Set,J=v.prototype;J;J=q(J))Object.getOwnPropertyNames(J).forEach(function(ye){return $.add(ye)});function se(ye){if(!ye)return ye;var xe,Ee=Object.create(v.prototype);for(xe in ye)if(!$.has(xe))try{Ee[xe]=ye[xe]}catch{}return Ee}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=se,this.hook("reading",se),v},Jr.prototype.defineClass=function(){return this.mapToClass(function(v){j(this,v)})},Jr.prototype.add=function(v,k){var E=this,D=this.schema.primKey,F=D.auto,$=D.keyPath,J=v;return $&&F&&(J=Ea($)(v)),this._trans("readwrite",function(se){return E.core.mutate({trans:se,type:"add",keys:k!=null?[k]:null,values:[J]})}).then(function(se){return se.numFailures?wt.reject(se.failures[0]):se.lastResult}).then(function(se){if($)try{Qe(v,$,se)}catch{}return se})},Jr.prototype.upsert=function(v,k){var E=this,D=this.schema.primKey.keyPath;return this._trans("readwrite",function(F){return E.core.get({trans:F,key:v}).then(function($){var J=$??{};return Ko(J,k),D&&Qe(J,D,v),E.core.mutate({trans:F,type:"put",values:[J],keys:[v],upsert:!0,updates:{keys:[v],changeSpecs:[k]}}).then(function(se){return se.numFailures?wt.reject(se.failures[0]):!!$})})})},Jr.prototype.update=function(v,k){return typeof v!="object"||h(v)?this.where(":id").equals(v).modify(k):(v=ut(v,this.schema.primKey.keyPath),v===void 0?Ar(new ct.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(v).modify(k))},Jr.prototype.put=function(v,k){var E=this,D=this.schema.primKey,F=D.auto,$=D.keyPath,J=v;return $&&F&&(J=Ea($)(v)),this._trans("readwrite",function(se){return E.core.mutate({trans:se,type:"put",values:[J],keys:k!=null?[k]:null})}).then(function(se){return se.numFailures?wt.reject(se.failures[0]):se.lastResult}).then(function(se){if($)try{Qe(v,$,se)}catch{}return se})},Jr.prototype.delete=function(v){var k=this;return this._trans("readwrite",function(E){return k.core.mutate({trans:E,type:"delete",keys:[v]}).then(function(D){return sn(k,[v],D)}).then(function(D){return D.numFailures?wt.reject(D.failures[0]):void 0})})},Jr.prototype.clear=function(){var v=this;return this._trans("readwrite",function(k){return v.core.mutate({trans:k,type:"deleteRange",range:ci}).then(function(E){return sn(v,null,E)})}).then(function(k){return k.numFailures?wt.reject(k.failures[0]):void 0})},Jr.prototype.bulkGet=function(v){var k=this;return this._trans("readonly",function(E){return k.core.getMany({keys:v,trans:E}).then(function(D){return D.map(function(F){return k.hook.reading.fire(F)})})})},Jr.prototype.bulkAdd=function(v,k,E){var D=this,F=Array.isArray(k)?k:void 0,$=(E=E||(F?void 0:k))?E.allKeys:void 0;return this._trans("readwrite",function(J){var xe=D.schema.primKey,se=xe.auto,xe=xe.keyPath;if(xe&&F)throw new ct.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(F&&F.length!==v.length)throw new ct.InvalidArgument("Arguments objects and keys must have the same length");var ye=v.length,xe=xe&&se?v.map(Ea(xe)):v;return D.core.mutate({trans:J,type:"add",keys:F,values:xe,wantResults:$}).then(function(Ce){var he=Ce.numFailures,De=Ce.results,ve=Ce.lastResult,Ce=Ce.failures;if(he===0)return $?De:ve;throw new kr("".concat(D.name,".bulkAdd(): ").concat(he," of ").concat(ye," operations failed"),Ce)})})},Jr.prototype.bulkPut=function(v,k,E){var D=this,F=Array.isArray(k)?k:void 0,$=(E=E||(F?void 0:k))?E.allKeys:void 0;return this._trans("readwrite",function(J){var xe=D.schema.primKey,se=xe.auto,xe=xe.keyPath;if(xe&&F)throw new ct.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(F&&F.length!==v.length)throw new ct.InvalidArgument("Arguments objects and keys must have the same length");var ye=v.length,xe=xe&&se?v.map(Ea(xe)):v;return D.core.mutate({trans:J,type:"put",keys:F,values:xe,wantResults:$}).then(function(Ce){var he=Ce.numFailures,De=Ce.results,ve=Ce.lastResult,Ce=Ce.failures;if(he===0)return $?De:ve;throw new kr("".concat(D.name,".bulkPut(): ").concat(he," of ").concat(ye," operations failed"),Ce)})})},Jr.prototype.bulkUpdate=function(v){var k=this,E=this.core,D=v.map(function(J){return J.key}),F=v.map(function(J){return J.changes}),$=[];return this._trans("readwrite",function(J){return E.getMany({trans:J,keys:D,cache:"clone"}).then(function(se){var ye=[],xe=[];v.forEach(function(he,De){var ve=he.key,Ce=he.changes,Se=se[De];if(Se){for(var Me=0,Fe=Object.keys(Ce);Me<Fe.length;Me++){var Ne=Fe[Me],Ge=Ce[Ne];if(Ne===k.schema.primKey.keyPath){if(rr(Ge,ve)!==0)throw new ct.Constraint("Cannot update primary key in bulkUpdate()")}else Qe(Se,Ne,Ge)}$.push(De),ye.push(ve),xe.push(Se)}});var Ee=ye.length;return E.mutate({trans:J,type:"put",keys:ye,values:xe,updates:{keys:D,changeSpecs:F}}).then(function(he){var De=he.numFailures,ve=he.failures;if(De===0)return Ee;for(var Ce=0,Se=Object.keys(ve);Ce<Se.length;Ce++){var Me,Fe=Se[Ce],Ne=$[Number(Fe)];Ne!=null&&(Me=ve[Fe],delete ve[Fe],ve[Ne]=Me)}throw new kr("".concat(k.name,".bulkUpdate(): ").concat(De," of ").concat(Ee," operations failed"),ve)})})})},Jr.prototype.bulkDelete=function(v){var k=this,E=v.length;return this._trans("readwrite",function(D){return k.core.mutate({trans:D,type:"delete",keys:v}).then(function(F){return sn(k,v,F)})}).then(function(J){var F=J.numFailures,$=J.lastResult,J=J.failures;if(F===0)return $;throw new kr("".concat(k.name,".bulkDelete(): ").concat(F," of ").concat(E," operations failed"),J)})},Jr);function Jr(){}function Qa(v){function k(J,se){if(se){for(var ye=arguments.length,xe=new Array(ye-1);--ye;)xe[ye-1]=arguments[ye];return E[J].subscribe.apply(null,xe),v}if(typeof J=="string")return E[J]}var E={};k.addEventType=$;for(var D=1,F=arguments.length;D<F;++D)$(arguments[D]);return k;function $(J,se,ye){if(typeof J!="object"){var xe;se=se||Wt;var Ee={subscribers:[],fire:ye=ye||Gt,subscribe:function(he){Ee.subscribers.indexOf(he)===-1&&(Ee.subscribers.push(he),Ee.fire=se(Ee.fire,he))},unsubscribe:function(he){Ee.subscribers=Ee.subscribers.filter(function(De){return De!==he}),Ee.fire=Ee.subscribers.reduce(se,ye)}};return E[J]=k[J]=Ee}x(xe=J).forEach(function(he){var De=xe[he];if(h(De))$(he,xe[he][0],xe[he][1]);else{if(De!=="asap")throw new ct.InvalidArgument("Invalid event config");var ve=$(he,Nr,function(){for(var Ce=arguments.length,Se=new Array(Ce);Ce--;)Se[Ce]=arguments[Ce];ve.subscribers.forEach(function(Me){et(function(){Me.apply(null,Se)})})})}})}}function Yi(v,k){return Je(k).from({prototype:v}),k}function Si(v,k){return!(v.filter||v.algorithm||v.or)&&(k?v.justLimit:!v.replayFilter)}function Mr(v,k){v.filter=Bn(v.filter,k)}function ho(v,k,E){var D=v.replayFilter;v.replayFilter=D?function(){return Bn(D(),k())}:k,v.justLimit=E&&!D}function Ns(v,k){if(v.isPrimKey)return k.primaryKey;var E=k.getIndexByKeyPath(v.index);if(!E)throw new ct.Schema("KeyPath "+v.index+" on object store "+k.name+" is not indexed");return E}function _s(v,k,E){var D=Ns(v,k.schema);return k.openCursor({trans:E,values:!v.keysOnly,reverse:v.dir==="prev",unique:!!v.unique,query:{index:D,range:v.range}})}function js(v,k,E,D){var F=v.replayFilter?Bn(v.filter,v.replayFilter()):v.filter;if(v.or){var $={},J=function(se,ye,xe){var Ee,he;F&&!F(ye,xe,function(De){return ye.stop(De)},function(De){return ye.fail(De)})||((he=""+(Ee=ye.primaryKey))=="[object ArrayBuffer]"&&(he=""+new Uint8Array(Ee)),Y($,he)||($[he]=!0,k(se,ye,xe)))};return Promise.all([v.or._iterate(J,E),fo(_s(v,D,E),v.algorithm,J,!v.keysOnly&&v.valueMapper)])}return fo(_s(v,D,E),Bn(v.algorithm,F),k,!v.keysOnly&&v.valueMapper)}function fo(v,k,E,D){var F=Oe(D?function($,J,se){return E(D($),J,se)}:E);return v.then(function($){if($)return $.start(function(){var J=function(){return $.continue()};k&&!k($,function(se){return J=se},function(se){$.stop(se),J=Gt},function(se){$.fail(se),J=Gt})||F($.value,$,function(se){return J=se}),J()})})}var po=(Dr.prototype._read=function(v,k){var E=this._ctx;return E.error?E.table._trans(null,Ar.bind(null,E.error)):E.table._trans("readonly",v).then(k)},Dr.prototype._write=function(v){var k=this._ctx;return k.error?k.table._trans(null,Ar.bind(null,k.error)):k.table._trans("readwrite",v,"locked")},Dr.prototype._addAlgorithm=function(v){var k=this._ctx;k.algorithm=Bn(k.algorithm,v)},Dr.prototype._iterate=function(v,k){return js(this._ctx,v,k,this._ctx.table.core)},Dr.prototype.clone=function(v){var k=Object.create(this.constructor.prototype),E=Object.create(this._ctx);return v&&j(E,v),k._ctx=E,k},Dr.prototype.raw=function(){return this._ctx.valueMapper=null,this},Dr.prototype.each=function(v){var k=this._ctx;return this._read(function(E){return js(k,v,E,k.table.core)})},Dr.prototype.count=function(v){var k=this;return this._read(function(E){var D=k._ctx,F=D.table.core;if(Si(D,!0))return F.count({trans:E,query:{index:Ns(D,F.schema),range:D.range}}).then(function(J){return Math.min(J,D.limit)});var $=0;return js(D,function(){return++$,!1},E,F).then(function(){return $})}).then(v)},Dr.prototype.sortBy=function(v,k){var E=v.split(".").reverse(),D=E[0],F=E.length-1;function $(ye,xe){return xe?$(ye[E[xe]],xe-1):ye[D]}var J=this._ctx.dir==="next"?1:-1;function se(ye,xe){return rr($(ye,F),$(xe,F))*J}return this.toArray(function(ye){return ye.sort(se)}).then(k)},Dr.prototype.toArray=function(v){var k=this;return this._read(function(E){var D=k._ctx;if(D.dir==="next"&&Si(D,!0)&&0<D.limit){var F=D.valueMapper,$=Ns(D,D.table.core.schema);return D.table.core.query({trans:E,limit:D.limit,values:!0,query:{index:$,range:D.range}}).then(function(se){return se=se.result,F?se.map(F):se})}var J=[];return js(D,function(se){return J.push(se)},E,D.table.core).then(function(){return J})},v)},Dr.prototype.offset=function(v){var k=this._ctx;return v<=0||(k.offset+=v,Si(k)?ho(k,function(){var E=v;return function(D,F){return E===0||(E===1?--E:F(function(){D.advance(E),E=0}),!1)}}):ho(k,function(){var E=v;return function(){return--E<0}})),this},Dr.prototype.limit=function(v){return this._ctx.limit=Math.min(this._ctx.limit,v),ho(this._ctx,function(){var k=v;return function(E,D,F){return--k<=0&&D(F),0<=k}},!0),this},Dr.prototype.until=function(v,k){return Mr(this._ctx,function(E,D,F){return!v(E.value)||(D(F),k)}),this},Dr.prototype.first=function(v){return this.limit(1).toArray(function(k){return k[0]}).then(v)},Dr.prototype.last=function(v){return this.reverse().first(v)},Dr.prototype.filter=function(v){var k;return Mr(this._ctx,function(E){return v(E.value)}),(k=this._ctx).isMatch=Bn(k.isMatch,v),this},Dr.prototype.and=function(v){return this.filter(v)},Dr.prototype.or=function(v){return new this.db.WhereClause(this._ctx.table,v,this)},Dr.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Dr.prototype.desc=function(){return this.reverse()},Dr.prototype.eachKey=function(v){var k=this._ctx;return k.keysOnly=!k.isMatch,this.each(function(E,D){v(D.key,D)})},Dr.prototype.eachUniqueKey=function(v){return this._ctx.unique="unique",this.eachKey(v)},Dr.prototype.eachPrimaryKey=function(v){var k=this._ctx;return k.keysOnly=!k.isMatch,this.each(function(E,D){v(D.primaryKey,D)})},Dr.prototype.keys=function(v){var k=this._ctx;k.keysOnly=!k.isMatch;var E=[];return this.each(function(D,F){E.push(F.key)}).then(function(){return E}).then(v)},Dr.prototype.primaryKeys=function(v){var k=this._ctx;if(k.dir==="next"&&Si(k,!0)&&0<k.limit)return this._read(function(D){var F=Ns(k,k.table.core.schema);return k.table.core.query({trans:D,values:!1,limit:k.limit,query:{index:F,range:k.range}})}).then(function(D){return D.result}).then(v);k.keysOnly=!k.isMatch;var E=[];return this.each(function(D,F){E.push(F.primaryKey)}).then(function(){return E}).then(v)},Dr.prototype.uniqueKeys=function(v){return this._ctx.unique="unique",this.keys(v)},Dr.prototype.firstKey=function(v){return this.limit(1).keys(function(k){return k[0]}).then(v)},Dr.prototype.lastKey=function(v){return this.reverse().firstKey(v)},Dr.prototype.distinct=function(){var v=this._ctx,v=v.index&&v.table.schema.idxByName[v.index];if(!v||!v.multi)return this;var k={};return Mr(this._ctx,function(F){var D=F.primaryKey.toString(),F=Y(k,D);return k[D]=!0,!F}),this},Dr.prototype.modify=function(v){var k=this,E=this._ctx;return this._write(function(D){var F=typeof v=="function"?v:function(Se){return Ko(Se,v)},$=E.table.core,xe=$.schema.primaryKey,J=xe.outbound,se=xe.extractKey,ye=200,xe=k.db._options.modifyChunkSize;xe&&(ye=typeof xe=="object"?xe[$.name]||xe["*"]||200:xe);function Ee(Se,Ne){var Fe=Ne.failures,Ne=Ne.numFailures;De+=Se-Ne;for(var Ge=0,tt=x(Fe);Ge<tt.length;Ge++){var dt=tt[Ge];he.push(Fe[dt])}}var he=[],De=0,ve=[],Ce=v===vs;return k.clone().primaryKeys().then(function(Se){function Me(Ne){var Ge=Math.min(ye,Se.length-Ne),tt=Se.slice(Ne,Ne+Ge);return(Ce?Promise.resolve([]):$.getMany({trans:D,keys:tt,cache:"immutable"})).then(function(dt){var bt=[],lt=[],ft=J?[]:null,St=Ce?tt:[];if(!Ce)for(var it=0;it<Ge;++it){var Mt=dt[it],pr={value:Ot(Mt),primKey:Se[Ne+it]};F.call(pr,pr.value,pr)!==!1&&(pr.value==null?St.push(Se[Ne+it]):J||rr(se(Mt),se(pr.value))===0?(lt.push(pr.value),J&&ft.push(Se[Ne+it])):(St.push(Se[Ne+it]),bt.push(pr.value)))}return Promise.resolve(0<bt.length&&$.mutate({trans:D,type:"add",values:bt}).then(function(_r){for(var Zt in _r.failures)St.splice(parseInt(Zt),1);Ee(bt.length,_r)})).then(function(){return(0<lt.length||Fe&&typeof v=="object")&&$.mutate({trans:D,type:"put",keys:ft,values:lt,criteria:Fe,changeSpec:typeof v!="function"&&v,isAdditionalChunk:0<Ne}).then(function(_r){return Ee(lt.length,_r)})}).then(function(){return(0<St.length||Fe&&Ce)&&$.mutate({trans:D,type:"delete",keys:St,criteria:Fe,isAdditionalChunk:0<Ne}).then(function(_r){return sn(E.table,St,_r)}).then(function(_r){return Ee(St.length,_r)})}).then(function(){return Se.length>Ne+Ge&&Me(Ne+ye)})})}var Fe=Si(E)&&E.limit===1/0&&(typeof v!="function"||Ce)&&{index:E.index,range:E.range};return Me(0).then(function(){if(0<he.length)throw new wr("Error modifying one or more objects",he,De,ve);return Se.length})})})},Dr.prototype.delete=function(){var v=this._ctx,k=v.range;return!Si(v)||v.table.schema.yProps||!v.isPrimKey&&k.type!==3?this.modify(vs):this._write(function(E){var D=v.table.core.schema.primaryKey,F=k;return v.table.core.count({trans:E,query:{index:D,range:F}}).then(function($){return v.table.core.mutate({trans:E,type:"deleteRange",range:F}).then(function(ye){var se=ye.failures,ye=ye.numFailures;if(ye)throw new wr("Could not delete some values",Object.keys(se).map(function(xe){return se[xe]}),$-ye);return $-ye})})})},Dr);function Dr(){}var vs=function(v,k){return k.value=null};function Bu(v,k){return v<k?-1:v===k?0:1}function Xc(v,k){return k<v?-1:v===k?0:1}function hi(v,k,E){return v=v instanceof ii?new v.Collection(v):v,v._ctx.error=new(E||TypeError)(k),v}function Us(v){return new v.Collection(v,function(){return ni("")}).limit(0)}function ha(v,k,E,D){var F,$,J,se,ye,xe,Ee,he=E.length;if(!E.every(function(Ce){return typeof Ce=="string"}))return hi(v,qo);function De(Ce){F=Ce==="next"?function(Me){return Me.toUpperCase()}:function(Me){return Me.toLowerCase()},$=Ce==="next"?function(Me){return Me.toLowerCase()}:function(Me){return Me.toUpperCase()},J=Ce==="next"?Bu:Xc;var Se=E.map(function(Me){return{lower:$(Me),upper:F(Me)}}).sort(function(Me,Fe){return J(Me.lower,Fe.lower)});se=Se.map(function(Me){return Me.upper}),ye=Se.map(function(Me){return Me.lower}),Ee=(xe=Ce)==="next"?"":D}De("next"),v=new v.Collection(v,function(){return Fi(se[0],ye[he-1]+D)}),v._ondirectionchange=function(Ce){De(Ce)};var ve=0;return v._addAlgorithm(function(Ce,Se,Me){var Fe=Ce.key;if(typeof Fe!="string")return!1;var Ne=$(Fe);if(k(Ne,ye,ve))return!0;for(var Ge=null,tt=ve;tt<he;++tt){var dt=function(bt,lt,ft,St,it,Mt){for(var pr=Math.min(bt.length,St.length),_r=-1,Zt=0;Zt<pr;++Zt){var mn=lt[Zt];if(mn!==St[Zt])return it(bt[Zt],ft[Zt])<0?bt.substr(0,Zt)+ft[Zt]+ft.substr(Zt+1):it(bt[Zt],St[Zt])<0?bt.substr(0,Zt)+St[Zt]+ft.substr(Zt+1):0<=_r?bt.substr(0,_r)+lt[_r]+ft.substr(_r+1):null;it(bt[Zt],mn)<0&&(_r=Zt)}return pr<St.length&&Mt==="next"?bt+ft.substr(bt.length):pr<bt.length&&Mt==="prev"?bt.substr(0,ft.length):_r<0?null:bt.substr(0,_r)+St[_r]+ft.substr(_r+1)}(Fe,Ne,se[tt],ye[tt],J,xe);dt===null&&Ge===null?ve=tt+1:(Ge===null||0<J(Ge,dt))&&(Ge=dt)}return Se(Ge!==null?function(){Ce.continue(Ge+Ee)}:Me),!1}),v}function Fi(v,k,E,D){return{type:2,lower:v,upper:k,lowerOpen:E,upperOpen:D}}function ni(v){return{type:1,lower:v,upper:v}}var ii=(Object.defineProperty(vn.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),vn.prototype.between=function(v,k,E,D){E=E!==!1,D=D===!0;try{return 0<this._cmp(v,k)||this._cmp(v,k)===0&&(E||D)&&(!E||!D)?Us(this):new this.Collection(this,function(){return Fi(v,k,!E,!D)})}catch{return hi(this,br)}},vn.prototype.equals=function(v){return v==null?hi(this,br):new this.Collection(this,function(){return ni(v)})},vn.prototype.above=function(v){return v==null?hi(this,br):new this.Collection(this,function(){return Fi(v,void 0,!0)})},vn.prototype.aboveOrEqual=function(v){return v==null?hi(this,br):new this.Collection(this,function(){return Fi(v,void 0,!1)})},vn.prototype.below=function(v){return v==null?hi(this,br):new this.Collection(this,function(){return Fi(void 0,v,!1,!0)})},vn.prototype.belowOrEqual=function(v){return v==null?hi(this,br):new this.Collection(this,function(){return Fi(void 0,v)})},vn.prototype.startsWith=function(v){return typeof v!="string"?hi(this,qo):this.between(v,v+zi,!0,!0)},vn.prototype.startsWithIgnoreCase=function(v){return v===""?this.startsWith(v):ha(this,function(k,E){return k.indexOf(E[0])===0},[v],zi)},vn.prototype.equalsIgnoreCase=function(v){return ha(this,function(k,E){return k===E[0]},[v],"")},vn.prototype.anyOfIgnoreCase=function(){var v=gt.apply(We,arguments);return v.length===0?Us(this):ha(this,function(k,E){return E.indexOf(k)!==-1},v,"")},vn.prototype.startsWithAnyOfIgnoreCase=function(){var v=gt.apply(We,arguments);return v.length===0?Us(this):ha(this,function(k,E){return E.some(function(D){return k.indexOf(D)===0})},v,zi)},vn.prototype.anyOf=function(){var v=this,k=gt.apply(We,arguments),E=this._cmp;try{k.sort(E)}catch{return hi(this,br)}if(k.length===0)return Us(this);var D=new this.Collection(this,function(){return Fi(k[0],k[k.length-1])});D._ondirectionchange=function($){E=$==="next"?v._ascending:v._descending,k.sort(E)};var F=0;return D._addAlgorithm(function($,J,se){for(var ye=$.key;0<E(ye,k[F]);)if(++F===k.length)return J(se),!1;return E(ye,k[F])===0||(J(function(){$.continue(k[F])}),!1)}),D},vn.prototype.notEqual=function(v){return this.inAnyRange([[-1/0,v],[v,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},vn.prototype.noneOf=function(){var v=gt.apply(We,arguments);if(v.length===0)return new this.Collection(this);try{v.sort(this._ascending)}catch{return hi(this,br)}var k=v.reduce(function(E,D){return E?E.concat([[E[E.length-1][1],D]]):[[-1/0,D]]},null);return k.push([v[v.length-1],this.db._maxKey]),this.inAnyRange(k,{includeLowers:!1,includeUppers:!1})},vn.prototype.inAnyRange=function(Fe,k){var E=this,D=this._cmp,F=this._ascending,$=this._descending,J=this._min,se=this._max;if(Fe.length===0)return Us(this);if(!Fe.every(function(Ne){return Ne[0]!==void 0&&Ne[1]!==void 0&&F(Ne[0],Ne[1])<=0}))return hi(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ct.InvalidArgument);var ye=!k||k.includeLowers!==!1,xe=k&&k.includeUppers===!0,Ee,he=F;function De(Ne,Ge){return he(Ne[0],Ge[0])}try{(Ee=Fe.reduce(function(Ne,Ge){for(var tt=0,dt=Ne.length;tt<dt;++tt){var bt=Ne[tt];if(D(Ge[0],bt[1])<0&&0<D(Ge[1],bt[0])){bt[0]=J(bt[0],Ge[0]),bt[1]=se(bt[1],Ge[1]);break}}return tt===dt&&Ne.push(Ge),Ne},[])).sort(De)}catch{return hi(this,br)}var ve=0,Ce=xe?function(Ne){return 0<F(Ne,Ee[ve][1])}:function(Ne){return 0<=F(Ne,Ee[ve][1])},Se=ye?function(Ne){return 0<$(Ne,Ee[ve][0])}:function(Ne){return 0<=$(Ne,Ee[ve][0])},Me=Ce,Fe=new this.Collection(this,function(){return Fi(Ee[0][0],Ee[Ee.length-1][1],!ye,!xe)});return Fe._ondirectionchange=function(Ne){he=Ne==="next"?(Me=Ce,F):(Me=Se,$),Ee.sort(De)},Fe._addAlgorithm(function(Ne,Ge,tt){for(var dt,bt=Ne.key;Me(bt);)if(++ve===Ee.length)return Ge(tt),!1;return!Ce(dt=bt)&&!Se(dt)||(E._cmp(bt,Ee[ve][1])===0||E._cmp(bt,Ee[ve][0])===0||Ge(function(){he===F?Ne.continue(Ee[ve][0]):Ne.continue(Ee[ve][1])}),!1)}),Fe},vn.prototype.startsWithAnyOf=function(){var v=gt.apply(We,arguments);return v.every(function(k){return typeof k=="string"})?v.length===0?Us(this):this.inAnyRange(v.map(function(k){return[k,k+zi]})):hi(this,"startsWithAnyOf() only works with strings")},vn);function vn(){}function ki(v){return Oe(function(k){return es(k),v(k.target.error),!1})}function es(v){v.stopPropagation&&v.stopPropagation(),v.preventDefault&&v.preventDefault()}var Vs="storagemutated",ts="x-storagemutated-1",rs=Qa(null,Vs),Nu=(Ji.prototype._lock=function(){return Ve(!zt.global),++this._reculock,this._reculock!==1||zt.global||(zt.lockOwnerFor=this),this},Ji.prototype._unlock=function(){if(Ve(!zt.global),--this._reculock==0)for(zt.global||(zt.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var v=this._blockedFuncs.shift();try{Ur(v[1],v[0])}catch{}}return this},Ji.prototype._locked=function(){return this._reculock&&zt.lockOwnerFor!==this},Ji.prototype.create=function(v){var k=this;if(!this.mode)return this;var E=this.db.idbdb,D=this.db._state.dbOpenError;if(Ve(!this.idbtrans),!v&&!E)switch(D&&D.name){case"DatabaseClosedError":throw new ct.DatabaseClosed(D);case"MissingAPIError":throw new ct.MissingAPI(D.message,D);default:throw new ct.OpenFailed(D)}if(!this.active)throw new ct.TransactionInactive;return Ve(this._completion._state===null),(v=this.idbtrans=v||(this.db.core||E).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Oe(function(F){es(F),k._reject(v.error)}),v.onabort=Oe(function(F){es(F),k.active&&k._reject(new ct.Abort(v.error)),k.active=!1,k.on("abort").fire(F)}),v.oncomplete=Oe(function(){k.active=!1,k._resolve(),"mutatedParts"in v&&rs.storagemutated.fire(v.mutatedParts)}),this},Ji.prototype._promise=function(v,k,E){var D=this;if(v==="readwrite"&&this.mode!=="readwrite")return Ar(new ct.ReadOnly("Transaction is readonly"));if(!this.active)return Ar(new ct.TransactionInactive);if(this._locked())return new wt(function($,J){D._blockedFuncs.push([function(){D._promise(v,k,E).then($,J)},zt])});if(E)return tr(function(){var $=new wt(function(J,se){D._lock();var ye=k(J,se,D);ye&&ye.then&&ye.then(J,se)});return $.finally(function(){return D._unlock()}),$._lib=!0,$});var F=new wt(function($,J){var se=k($,J,D);se&&se.then&&se.then($,J)});return F._lib=!0,F},Ji.prototype._root=function(){return this.parent?this.parent._root():this},Ji.prototype.waitFor=function(v){var k,E=this._root(),D=wt.resolve(v);E._waitingFor?E._waitingFor=E._waitingFor.then(function(){return D}):(E._waitingFor=D,E._waitingQueue=[],k=E.idbtrans.objectStore(E.storeNames[0]),function $(){for(++E._spinCount;E._waitingQueue.length;)E._waitingQueue.shift()();E._waitingFor&&(k.get(-1/0).onsuccess=$)}());var F=E._waitingFor;return new wt(function($,J){D.then(function(se){return E._waitingQueue.push(Oe($.bind(null,se)))},function(se){return E._waitingQueue.push(Oe(J.bind(null,se)))}).finally(function(){E._waitingFor===F&&(E._waitingFor=null)})})},Ji.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ct.Abort))},Ji.prototype.table=function(v){var k=this._memoizedTables||(this._memoizedTables={});if(Y(k,v))return k[v];var E=this.schema[v];if(!E)throw new ct.NotFound("Table "+v+" not part of transaction");return E=new this.db.Table(v,E,this),E.core=this.db.core.table(v),k[v]=E},Ji);function Ji(){}function Hl(v,k,E,D,F,$,J,se){return{name:v,keyPath:k,unique:E,multi:D,auto:F,compound:$,src:(E&&!J?"&":"")+(D?"*":"")+(F?"++":"")+ju(k),type:se}}function ju(v){return typeof v=="string"?v:v?"["+[].join.call(v,"+")+"]":""}function Go(v,k,E){return{name:v,primKey:k,indexes:E,mappedClass:null,idxByName:(D=function(F){return[F.name,F]},E.reduce(function(F,$,J){return J=D($,J),J&&(F[J[0]]=J[1]),F},{}))};var D}var Aa=function(v){try{return v.only([[]]),Aa=function(){return[[]]},[[]]}catch{return Aa=function(){return zi},zi}};function mo(v){return v==null?function(){}:typeof v=="string"?(k=v).split(".").length===1?function(E){return E[k]}:function(E){return ut(E,k)}:function(E){return ut(E,v)};var k}function go(v){return[].slice.call(v)}var Zl=0;function xs(v){return v==null?":id":typeof v=="string"?v:"[".concat(v.join("+"),"]")}function da(v,k,ye){function D(Me){if(Me.type===3)return null;if(Me.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var ve=Me.lower,Ce=Me.upper,Se=Me.lowerOpen,Me=Me.upperOpen;return ve===void 0?Ce===void 0?null:k.upperBound(Ce,!!Me):Ce===void 0?k.lowerBound(ve,!!Se):k.bound(ve,Ce,!!Se,!!Me)}function F(De){var ve,Ce=De.name;return{name:Ce,schema:De,mutate:function(Se){var Me=Se.trans,Fe=Se.type,Ne=Se.keys,Ge=Se.values,tt=Se.range;return new Promise(function(dt,bt){dt=Oe(dt);var lt=Me.objectStore(Ce),ft=lt.keyPath==null,St=Fe==="put"||Fe==="add";if(!St&&Fe!=="delete"&&Fe!=="deleteRange")throw new Error("Invalid operation type: "+Fe);var it,Mt=(Ne||Ge||{length:1}).length;if(Ne&&Ge&&Ne.length!==Ge.length)throw new Error("Given keys array must have same length as given values array.");if(Mt===0)return dt({numFailures:0,failures:{},results:[],lastResult:void 0});function pr(In){++mn,es(In)}var _r=[],Zt=[],mn=0;if(Fe==="deleteRange"){if(tt.type===4)return dt({numFailures:mn,failures:Zt,results:[],lastResult:void 0});tt.type===3?_r.push(it=lt.clear()):_r.push(it=lt.delete(D(tt)))}else{var ft=St?ft?[Ge,Ne]:[Ge,null]:[Ne,null],Yt=ft[0],Tn=ft[1];if(St)for(var Nn=0;Nn<Mt;++Nn)_r.push(it=Tn&&Tn[Nn]!==void 0?lt[Fe](Yt[Nn],Tn[Nn]):lt[Fe](Yt[Nn])),it.onerror=pr;else for(Nn=0;Nn<Mt;++Nn)_r.push(it=lt[Fe](Yt[Nn])),it.onerror=pr}function Cs(In){In=In.target.result,_r.forEach(function(ai,Co){return ai.error!=null&&(Zt[Co]=ai.error)}),dt({numFailures:mn,failures:Zt,results:Fe==="delete"?Ne:_r.map(function(ai){return ai.result}),lastResult:In})}it.onerror=function(In){pr(In),Cs(In)},it.onsuccess=Cs})},getMany:function(Se){var Me=Se.trans,Fe=Se.keys;return new Promise(function(Ne,Ge){Ne=Oe(Ne);for(var tt,dt=Me.objectStore(Ce),bt=Fe.length,lt=new Array(bt),ft=0,St=0,it=function(_r){_r=_r.target,lt[_r._pos]=_r.result,++St===ft&&Ne(lt)},Mt=ki(Ge),pr=0;pr<bt;++pr)Fe[pr]!=null&&((tt=dt.get(Fe[pr]))._pos=pr,tt.onsuccess=it,tt.onerror=Mt,++ft);ft===0&&Ne(lt)})},get:function(Se){var Me=Se.trans,Fe=Se.key;return new Promise(function(Ne,Ge){Ne=Oe(Ne);var tt=Me.objectStore(Ce).get(Fe);tt.onsuccess=function(dt){return Ne(dt.target.result)},tt.onerror=ki(Ge)})},query:(ve=xe,function(Se){return new Promise(function(Me,Fe){Me=Oe(Me);var Ne,Ge,tt,ft=Se.trans,dt=Se.values,bt=Se.limit,it=Se.query,lt=bt===1/0?void 0:bt,St=it.index,it=it.range,ft=ft.objectStore(Ce),St=St.isPrimaryKey?ft:ft.index(St.name),it=D(it);if(bt===0)return Me({result:[]});ve?((lt=dt?St.getAll(it,lt):St.getAllKeys(it,lt)).onsuccess=function(Mt){return Me({result:Mt.target.result})},lt.onerror=ki(Fe)):(Ne=0,Ge=!dt&&"openKeyCursor"in St?St.openKeyCursor(it):St.openCursor(it),tt=[],Ge.onsuccess=function(Mt){var pr=Ge.result;return pr?(tt.push(dt?pr.value:pr.primaryKey),++Ne===bt?Me({result:tt}):void pr.continue()):Me({result:tt})},Ge.onerror=ki(Fe))})}),openCursor:function(Se){var Me=Se.trans,Fe=Se.values,Ne=Se.query,Ge=Se.reverse,tt=Se.unique;return new Promise(function(dt,bt){dt=Oe(dt);var St=Ne.index,lt=Ne.range,ft=Me.objectStore(Ce),ft=St.isPrimaryKey?ft:ft.index(St.name),St=Ge?tt?"prevunique":"prev":tt?"nextunique":"next",it=!Fe&&"openKeyCursor"in ft?ft.openKeyCursor(D(lt),St):ft.openCursor(D(lt),St);it.onerror=ki(bt),it.onsuccess=Oe(function(Mt){var pr,_r,Zt,mn,Yt=it.result;Yt?(Yt.___id=++Zl,Yt.done=!1,pr=Yt.continue.bind(Yt),_r=(_r=Yt.continuePrimaryKey)&&_r.bind(Yt),Zt=Yt.advance.bind(Yt),mn=function(){throw new Error("Cursor not stopped")},Yt.trans=Me,Yt.stop=Yt.continue=Yt.continuePrimaryKey=Yt.advance=function(){throw new Error("Cursor not started")},Yt.fail=Oe(bt),Yt.next=function(){var Tn=this,Nn=1;return this.start(function(){return Nn--?Tn.continue():Tn.stop()}).then(function(){return Tn})},Yt.start=function(Tn){function Nn(){if(it.result)try{Tn()}catch(In){Yt.fail(In)}else Yt.done=!0,Yt.start=function(){throw new Error("Cursor behind last entry")},Yt.stop()}var Cs=new Promise(function(In,ai){In=Oe(In),it.onerror=ki(ai),Yt.fail=ai,Yt.stop=function(Co){Yt.stop=Yt.continue=Yt.continuePrimaryKey=Yt.advance=mn,In(Co)}});return it.onsuccess=Oe(function(In){it.onsuccess=Nn,Nn()}),Yt.continue=pr,Yt.continuePrimaryKey=_r,Yt.advance=Zt,Nn(),Cs},dt(Yt)):dt(null)},bt)})},count:function(Se){var Me=Se.query,Fe=Se.trans,Ne=Me.index,Ge=Me.range;return new Promise(function(tt,dt){var bt=Fe.objectStore(Ce),lt=Ne.isPrimaryKey?bt:bt.index(Ne.name),bt=D(Ge),lt=bt?lt.count(bt):lt.count();lt.onsuccess=Oe(function(ft){return tt(ft.target.result)}),lt.onerror=ki(dt)})}}}var $,J,se,Ee=(J=ye,se=go(($=v).objectStoreNames),{schema:{name:$.name,tables:se.map(function(De){return J.objectStore(De)}).map(function(De){var ve=De.keyPath,Me=De.autoIncrement,Ce=h(ve),Se={},Me={name:De.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:ve==null,compound:Ce,keyPath:ve,autoIncrement:Me,unique:!0,extractKey:mo(ve)},indexes:go(De.indexNames).map(function(Fe){return De.index(Fe)}).map(function(tt){var Ne=tt.name,Ge=tt.unique,dt=tt.multiEntry,tt=tt.keyPath,dt={name:Ne,compound:h(tt),keyPath:tt,unique:Ge,multiEntry:dt,extractKey:mo(tt)};return Se[xs(tt)]=dt}),getIndexByKeyPath:function(Fe){return Se[xs(Fe)]}};return Se[":id"]=Me.primaryKey,ve!=null&&(Se[xs(ve)]=Me.primaryKey),Me})},hasGetAll:0<se.length&&"getAll"in J.objectStore(se[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),ye=Ee.schema,xe=Ee.hasGetAll,Ee=ye.tables.map(F),he={};return Ee.forEach(function(De){return he[De.name]=De}),{stack:"dbcore",transaction:v.transaction.bind(v),table:function(De){if(!he[De])throw new Error("Table '".concat(De,"' not found"));return he[De]},MIN_KEY:-1/0,MAX_KEY:Aa(k),schema:ye}}function Yc(v,k,E,D){var F=E.IDBKeyRange;return E.indexedDB,{dbcore:(D=da(k,F,D),v.dbcore.reduce(function($,J){return J=J.create,c(c({},$),J($))},D))}}function $s(v,D){var E=D.db,D=Yc(v._middlewares,E,v._deps,D);v.core=D.dbcore,v.tables.forEach(function(F){var $=F.name;v.core.schema.tables.some(function(J){return J.name===$})&&(F.core=v.core.table($),v[$]instanceof v.Table&&(v[$].core=F.core))})}function fa(v,k,E,D){E.forEach(function(F){var $=D[F];k.forEach(function(J){var se=function ye(xe,Ee){return Qt(xe,Ee)||(xe=q(xe))&&ye(xe,Ee)}(J,F);(!se||"value"in se&&se.value===void 0)&&(J===v.Transaction.prototype||J instanceof v.Transaction?He(J,F,{get:function(){return this.table(F)},set:function(ye){$e(this,F,{value:ye,writable:!0,configurable:!0,enumerable:!0})}}):J[F]=new v.Table(F,$))})})}function pa(v,k){k.forEach(function(E){for(var D in E)E[D]instanceof v.Table&&delete E[D]})}function Or(v,k){return v._cfg.version-k._cfg.version}function Ho(v,k,E,D){var F=v._dbSchema;E.objectStoreNames.contains("$meta")&&!F.$meta&&(F.$meta=Go("$meta",Yl("")[0],[]),v._storeNames.push("$meta"));var $=v._createTransaction("readwrite",v._storeNames,F);$.create(E),$._completion.catch(D);var J=$._reject.bind($),se=zt.transless||zt;tr(function(){return zt.trans=$,zt.transless=se,k!==0?($s(v,E),xe=k,((ye=$).storeNames.includes("$meta")?ye.table("$meta").get("version").then(function(Ee){return Ee??xe}):wt.resolve(xe)).then(function(Ee){return De=Ee,ve=$,Ce=E,Se=[],Ee=(he=v)._versions,Me=he._dbSchema=yo(0,he.idbdb,Ce),(Ee=Ee.filter(function(Fe){return Fe._cfg.version>=De})).length!==0?(Ee.forEach(function(Fe){Se.push(function(){var Ne=Me,Ge=Fe._cfg.dbschema;qs(he,Ne,Ce),qs(he,Ge,Ce),Me=he._dbSchema=Ge;var tt=ns(Ne,Ge);tt.add.forEach(function(St){Wl(Ce,St[0],St[1].primKey,St[1].indexes)}),tt.change.forEach(function(St){if(St.recreate)throw new ct.Upgrade("Not yet support for changing primary key");var it=Ce.objectStore(St.name);St.add.forEach(function(Mt){return Zo(it,Mt)}),St.change.forEach(function(Mt){it.deleteIndex(Mt.name),Zo(it,Mt)}),St.del.forEach(function(Mt){return it.deleteIndex(Mt)})});var dt=Fe._cfg.contentUpgrade;if(dt&&Fe._cfg.version>De){$s(he,Ce),ve._memoizedTables={};var bt=ce(Ge);tt.del.forEach(function(St){bt[St]=Ne[St]}),pa(he,[he.Transaction.prototype]),fa(he,[he.Transaction.prototype],x(bt),bt),ve.schema=bt;var lt,ft=yt(dt);return ft&&xr(),tt=wt.follow(function(){var St;(lt=dt(ve))&&ft&&(St=hr.bind(null,null),lt.then(St,St))}),lt&&typeof lt.then=="function"?wt.resolve(lt):tt.then(function(){return lt})}}),Se.push(function(Ne){var Ge,tt,dt=Fe._cfg.dbschema;Ge=dt,tt=Ne,[].slice.call(tt.db.objectStoreNames).forEach(function(bt){return Ge[bt]==null&&tt.db.deleteObjectStore(bt)}),pa(he,[he.Transaction.prototype]),fa(he,[he.Transaction.prototype],he._storeNames,he._dbSchema),ve.schema=he._dbSchema}),Se.push(function(Ne){he.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(he.idbdb.version/10)===Fe._cfg.version?(he.idbdb.deleteObjectStore("$meta"),delete he._dbSchema.$meta,he._storeNames=he._storeNames.filter(function(Ge){return Ge!=="$meta"})):Ne.objectStore("$meta").put(Fe._cfg.version,"version"))})}),function Fe(){return Se.length?wt.resolve(Se.shift()(ve.idbtrans)).then(Fe):wt.resolve()}().then(function(){Xl(Me,Ce)})):wt.resolve();var he,De,ve,Ce,Se,Me}).catch(J)):(x(F).forEach(function(Ee){Wl(E,Ee,F[Ee].primKey,F[Ee].indexes)}),$s(v,E),void wt.follow(function(){return v.on.populate.fire($)}).catch(J));var ye,xe})}function Jc(v,k){Xl(v._dbSchema,k),k.db.version%10!=0||k.objectStoreNames.contains("$meta")||k.db.createObjectStore("$meta").add(Math.ceil(k.db.version/10-1),"version");var E=yo(0,v.idbdb,k);qs(v,v._dbSchema,k);for(var D=0,F=ns(E,v._dbSchema).change;D<F.length;D++){var $=function(J){if(J.change.length||J.recreate)return console.warn("Unable to patch indexes of table ".concat(J.name," because it has changes on the type of index or primary key.")),{value:void 0};var se=k.objectStore(J.name);J.add.forEach(function(ye){_n&&console.debug("Dexie upgrade patch: Creating missing index ".concat(J.name,".").concat(ye.src)),Zo(se,ye)})}(F[D]);if(typeof $=="object")return $.value}}function ns(v,k){var E,D={del:[],add:[],change:[]};for(E in v)k[E]||D.del.push(E);for(E in k){var F=v[E],$=k[E];if(F){var J={name:E,def:$,recreate:!1,del:[],add:[],change:[]};if(""+(F.primKey.keyPath||"")!=""+($.primKey.keyPath||"")||F.primKey.auto!==$.primKey.auto)J.recreate=!0,D.change.push(J);else{var se=F.idxByName,ye=$.idxByName,xe=void 0;for(xe in se)ye[xe]||J.del.push(xe);for(xe in ye){var Ee=se[xe],he=ye[xe];Ee?Ee.src!==he.src&&J.change.push(he):J.add.push(he)}(0<J.del.length||0<J.add.length||0<J.change.length)&&D.change.push(J)}}else D.add.push([E,$])}return D}function Wl(v,k,E,D){var F=v.db.createObjectStore(k,E.keyPath?{keyPath:E.keyPath,autoIncrement:E.auto}:{autoIncrement:E.auto});return D.forEach(function($){return Zo(F,$)}),F}function Xl(v,k){x(v).forEach(function(E){k.db.objectStoreNames.contains(E)||(_n&&console.debug("Dexie: Creating missing table",E),Wl(k,E,v[E].primKey,v[E].indexes))})}function Zo(v,k){v.createIndex(k.name,k.keyPath,{unique:k.unique,multiEntry:k.multi})}function yo(v,k,E){var D={};return pe(k.objectStoreNames,0).forEach(function(F){for(var $=E.objectStore(F),J=Hl(ju(xe=$.keyPath),xe||"",!0,!1,!!$.autoIncrement,xe&&typeof xe!="string",!0),se=[],ye=0;ye<$.indexNames.length;++ye){var Ee=$.index($.indexNames[ye]),xe=Ee.keyPath,Ee=Hl(Ee.name,xe,!!Ee.unique,!!Ee.multiEntry,!1,xe&&typeof xe!="string",!1);se.push(Ee)}D[F]=Go(F,J,se)}),D}function qs(v,k,E){for(var D=E.db.objectStoreNames,F=0;F<D.length;++F){var $=D[F],J=E.objectStore($);v._hasGetAll="getAll"in J;for(var se=0;se<J.indexNames.length;++se){var ye=J.indexNames[se],xe=J.index(ye).keyPath,Ee=typeof xe=="string"?xe:"["+pe(xe).join("+")+"]";!k[$]||(xe=k[$].idxByName[Ee])&&(xe.name=ye,delete k[$].idxByName[Ee],k[$].idxByName[ye]=xe)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&b.WorkerGlobalScope&&b instanceof b.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(v._hasGetAll=!1)}function Yl(v){return v.split(",").map(function(k,E){var $=k.split(":"),D=(F=$[1])===null||F===void 0?void 0:F.trim(),F=(k=$[0].trim()).replace(/([&*]|\+\+)/g,""),$=/^\[/.test(F)?F.match(/^\[(.*)\]$/)[1].split("+"):F;return Hl(F,$||null,/\&/.test(k),/\*/.test(k),/\+\+/.test(k),h($),E===0,D)})}var Uu=(ws.prototype._createTableSchema=Go,ws.prototype._parseIndexSyntax=Yl,ws.prototype._parseStoresSpec=function(v,k){var E=this;x(v).forEach(function(D){if(v[D]!==null){var F=E._parseIndexSyntax(v[D]),$=F.shift();if(!$)throw new ct.Schema("Invalid schema for table "+D+": "+v[D]);if($.unique=!0,$.multi)throw new ct.Schema("Primary key cannot be multiEntry*");F.forEach(function(J){if(J.auto)throw new ct.Schema("Only primary key can be marked as autoIncrement (++)");if(!J.keyPath)throw new ct.Schema("Index must have a name and cannot be an empty string")}),F=E._createTableSchema(D,$,F),k[D]=F}})},ws.prototype.stores=function(E){var k=this.db;this._cfg.storesSource=this._cfg.storesSource?j(this._cfg.storesSource,E):E;var E=k._versions,D={},F={};return E.forEach(function($){j(D,$._cfg.storesSource),F=$._cfg.dbschema={},$._parseStoresSpec(D,F)}),k._dbSchema=F,pa(k,[k._allTables,k,k.Transaction.prototype]),fa(k,[k._allTables,k,k.Transaction.prototype,this._cfg.tables],x(F),F),k._storeNames=x(F),this},ws.prototype.upgrade=function(v){return this._cfg.contentUpgrade=dr(this._cfg.contentUpgrade||Gt,v),this},ws);function ws(){}function Wo(v,k){var E=v._dbNamesDB;return E||(E=v._dbNamesDB=new Qi(Hn,{addons:[],indexedDB:v,IDBKeyRange:k})).version(1).stores({dbnames:"name"}),E.table("dbnames")}function Ma(v){return v&&typeof v.databases=="function"}function Xo(v){return tr(function(){return zt.letThrough=!0,v()})}function Jl(v){return!("from"in v)}var $n=function(v,k){if(!this){var E=new $n;return v&&"d"in v&&j(E,v),E}j(this,arguments.length?{d:1,from:v,to:1<arguments.length?k:v}:{d:0})};function Da(v,k,E){var D=rr(k,E);if(!isNaN(D)){if(0<D)throw RangeError();if(Jl(v))return j(v,{from:k,to:E,d:1});var F=v.l,D=v.r;if(rr(E,v.from)<0)return F?Da(F,k,E):v.l={from:k,to:E,d:1,l:null,r:null},Vu(v);if(0<rr(k,v.to))return D?Da(D,k,E):v.r={from:k,to:E,d:1,l:null,r:null},Vu(v);rr(k,v.from)<0&&(v.from=k,v.l=null,v.d=D?D.d+1:1),0<rr(E,v.to)&&(v.to=E,v.r=null,v.d=v.l?v.l.d+1:1),E=!v.r,F&&!v.l&&_o(v,F),D&&E&&_o(v,D)}}function _o(v,k){Jl(k)||function E(D,ye){var $=ye.from,J=ye.to,se=ye.l,ye=ye.r;Da(D,$,J),se&&E(D,se),ye&&E(D,ye)}(v,k)}function vo(v,k){var E=Yo(k),D=E.next();if(D.done)return!1;for(var F=D.value,$=Yo(v),J=$.next(F.from),se=J.value;!D.done&&!J.done;){if(rr(se.from,F.to)<=0&&0<=rr(se.to,F.from))return!0;rr(F.from,se.from)<0?F=(D=E.next(se.from)).value:se=(J=$.next(F.from)).value}return!1}function Yo(v){var k=Jl(v)?null:{s:0,n:v};return{next:function(E){for(var D=0<arguments.length;k;)switch(k.s){case 0:if(k.s=1,D)for(;k.n.l&&rr(E,k.n.from)<0;)k={up:k,n:k.n.l,s:1};else for(;k.n.l;)k={up:k,n:k.n.l,s:1};case 1:if(k.s=2,!D||rr(E,k.n.to)<=0)return{value:k.n,done:!1};case 2:if(k.n.r){k.s=3,k={up:k,n:k.n.r,s:0};continue}case 3:k=k.up}return{done:!0}}}}function Vu(v){var k,E,D=(((k=v.r)===null||k===void 0?void 0:k.d)||0)-(((E=v.l)===null||E===void 0?void 0:E.d)||0),F=1<D?"r":D<-1?"l":"";F&&(k=F=="r"?"l":"r",E=c({},v),D=v[F],v.from=D.from,v.to=D.to,v[F]=D[F],E[F]=D[k],(v[k]=E).d=Ql(E)),v.d=Ql(v)}function Ql(E){var k=E.r,E=E.l;return(k?E?Math.max(k.d,E.d):k.d:E?E.d:0)+1}function xo(v,k){return x(k).forEach(function(E){v[E]?_o(v[E],k[E]):v[E]=function D(F){var $,J,se={};for($ in F)Y(F,$)&&(J=F[$],se[$]=!J||typeof J!="object"||Ye.has(J.constructor)?J:D(J));return se}(k[E])}),v}function Jo(v,k){return v.all||k.all||Object.keys(v).some(function(E){return k[E]&&vo(k[E],v[E])})}W($n.prototype,((Zn={add:function(v){return _o(this,v),this},addKey:function(v){return Da(this,v,v),this},addKeys:function(v){var k=this;return v.forEach(function(E){return Da(k,E,E)}),this},hasKey:function(v){var k=Yo(this).next(v).value;return k&&rr(k.from,v)<=0&&0<=rr(k.to,v)}})[Hr]=function(){return Yo(this)},Zn));var za={},Qo={},Ks=!1;function Bi(v){xo(Qo,v),Ks||(Ks=!0,setTimeout(function(){Ks=!1,wo(Qo,!(Qo={}))},0))}function wo(v,k){k===void 0&&(k=!1);var E=new Set;if(v.all)for(var D=0,F=Object.values(za);D<F.length;D++)el(J=F[D],v,E,k);else for(var $ in v){var J,se=/^idb\:\/\/(.*)\/(.*)\//.exec($);se&&($=se[1],se=se[2],(J=za["idb://".concat($,"/").concat(se)])&&el(J,v,E,k))}E.forEach(function(ye){return ye()})}function el(v,k,E,D){for(var F=[],$=0,J=Object.entries(v.queries.query);$<J.length;$++){for(var se=J[$],ye=se[0],xe=[],Ee=0,he=se[1];Ee<he.length;Ee++){var De=he[Ee];Jo(k,De.obsSet)?De.subscribers.forEach(function(Me){return E.add(Me)}):D&&xe.push(De)}D&&F.push([ye,xe])}if(D)for(var ve=0,Ce=F;ve<Ce.length;ve++){var Se=Ce[ve],ye=Se[0],xe=Se[1];v.queries.query[ye]=xe}}function eu(v){var k=v._state,E=v._deps.indexedDB;if(k.isBeingOpened||v.idbdb)return k.dbReadyPromise.then(function(){return k.dbOpenError?Ar(k.dbOpenError):v});k.isBeingOpened=!0,k.dbOpenError=null,k.openComplete=!1;var D=k.openCanceller,F=Math.round(10*v.verno),$=!1;function J(){if(k.openCanceller!==D)throw new ct.DatabaseClosed("db.open() was cancelled")}function se(){return new wt(function(De,ve){if(J(),!E)throw new ct.MissingAPI;var Ce=v.name,Se=k.autoSchema||!F?E.open(Ce):E.open(Ce,F);if(!Se)throw new ct.MissingAPI;Se.onerror=ki(ve),Se.onblocked=Oe(v._fireOnBlocked),Se.onupgradeneeded=Oe(function(Me){var Fe;Ee=Se.transaction,k.autoSchema&&!v._options.allowEmptyDB?(Se.onerror=es,Ee.abort(),Se.result.close(),(Fe=E.deleteDatabase(Ce)).onsuccess=Fe.onerror=Oe(function(){ve(new ct.NoSuchDatabase("Database ".concat(Ce," doesnt exist")))})):(Ee.onerror=ki(ve),Me=Me.oldVersion>Math.pow(2,62)?0:Me.oldVersion,he=Me<1,v.idbdb=Se.result,$&&Jc(v,Ee),Ho(v,Me/10,Ee,ve))},ve),Se.onsuccess=Oe(function(){Ee=null;var Me,Fe,Ne,Ge,tt,dt=v.idbdb=Se.result,bt=pe(dt.objectStoreNames);if(0<bt.length)try{var lt=dt.transaction((Ge=bt).length===1?Ge[0]:Ge,"readonly");if(k.autoSchema)Fe=dt,Ne=lt,(Me=v).verno=Fe.version/10,Ne=Me._dbSchema=yo(0,Fe,Ne),Me._storeNames=pe(Fe.objectStoreNames,0),fa(Me,[Me._allTables],x(Ne),Ne);else if(qs(v,v._dbSchema,lt),((tt=ns(yo(0,(tt=v).idbdb,lt),tt._dbSchema)).add.length||tt.change.some(function(ft){return ft.add.length||ft.change.length}))&&!$)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),dt.close(),F=dt.version+1,$=!0,De(se());$s(v,lt)}catch{}Xa.push(v),dt.onversionchange=Oe(function(ft){k.vcFired=!0,v.on("versionchange").fire(ft)}),dt.onclose=Oe(function(){v.close({disableAutoOpen:!1})}),he&&(tt=v._deps,lt=Ce,dt=tt.indexedDB,tt=tt.IDBKeyRange,Ma(dt)||lt===Hn||Wo(dt,tt).put({name:lt}).catch(Gt)),De()},ve)}).catch(function(De){switch(De?.name){case"UnknownError":if(0<k.PR1398_maxLoop)return k.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),se();break;case"VersionError":if(0<F)return F=0,se()}return wt.reject(De)})}var ye,xe=k.dbReadyResolve,Ee=null,he=!1;return wt.race([D,(typeof navigator>"u"?wt.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(De){function ve(){return indexedDB.databases().finally(De)}ye=setInterval(ve,100),ve()}).finally(function(){return clearInterval(ye)}):Promise.resolve()).then(se)]).then(function(){return J(),k.onReadyBeingFired=[],wt.resolve(Xo(function(){return v.on.ready.fire(v.vip)})).then(function De(){if(0<k.onReadyBeingFired.length){var ve=k.onReadyBeingFired.reduce(dr,Gt);return k.onReadyBeingFired=[],wt.resolve(Xo(function(){return ve(v.vip)})).then(De)}})}).finally(function(){k.openCanceller===D&&(k.onReadyBeingFired=null,k.isBeingOpened=!1)}).catch(function(De){k.dbOpenError=De;try{Ee&&Ee.abort()}catch{}return D===k.openCanceller&&v._close(),Ar(De)}).finally(function(){k.openComplete=!0,xe()}).then(function(){var De;return he&&(De={},v.tables.forEach(function(ve){ve.schema.indexes.forEach(function(Ce){Ce.name&&(De["idb://".concat(v.name,"/").concat(ve.name,"/").concat(Ce.name)]=new $n(-1/0,[[[]]]))}),De["idb://".concat(v.name,"/").concat(ve.name,"/")]=De["idb://".concat(v.name,"/").concat(ve.name,"/:dels")]=new $n(-1/0,[[[]]])}),rs(Vs).fire(De),wo(De,!0)),v})}function Gs(v){function k($){return v.next($)}var E=F(k),D=F(function($){return v.throw($)});function F($){return function(ye){var se=$(ye),ye=se.value;return se.done?ye:ye&&typeof ye.then=="function"?ye.then(E,D):h(ye)?Promise.all(ye).then(E,D):E(ye)}}return F(k)()}function Hs(v,k,E){for(var D=h(v)?v.slice():[v],F=0;F<E;++F)D.push(k);return D}var bs={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(v){return c(c({},v),{table:function(k){var E=v.table(k),D=E.schema,F={},$=[];function J(he,De,ve){var Ce=xs(he),Se=F[Ce]=F[Ce]||[],Me=he==null?0:typeof he=="string"?1:he.length,Fe=0<De,Fe=c(c({},ve),{name:Fe?"".concat(Ce,"(virtual-from:").concat(ve.name,")"):ve.name,lowLevelIndex:ve,isVirtual:Fe,keyTail:De,keyLength:Me,extractKey:mo(he),unique:!Fe&&ve.unique});return Se.push(Fe),Fe.isPrimaryKey||$.push(Fe),1<Me&&J(Me===2?he[0]:he.slice(0,Me-1),De+1,ve),Se.sort(function(Ne,Ge){return Ne.keyTail-Ge.keyTail}),Fe}k=J(D.primaryKey.keyPath,0,D.primaryKey),F[":id"]=[k];for(var se=0,ye=D.indexes;se<ye.length;se++){var xe=ye[se];J(xe.keyPath,0,xe)}function Ee(he){var De,ve=he.query.index;return ve.isVirtual?c(c({},he),{query:{index:ve.lowLevelIndex,range:(De=he.query.range,ve=ve.keyTail,{type:De.type===1?2:De.type,lower:Hs(De.lower,De.lowerOpen?v.MAX_KEY:v.MIN_KEY,ve),lowerOpen:!0,upper:Hs(De.upper,De.upperOpen?v.MIN_KEY:v.MAX_KEY,ve),upperOpen:!0})}}):he}return c(c({},E),{schema:c(c({},D),{primaryKey:k,indexes:$,getIndexByKeyPath:function(he){return(he=F[xs(he)])&&he[0]}}),count:function(he){return E.count(Ee(he))},query:function(he){return E.query(Ee(he))},openCursor:function(he){var De=he.query.index,ve=De.keyTail,Ce=De.isVirtual,Se=De.keyLength;return Ce?E.openCursor(Ee(he)).then(function(Fe){return Fe&&Me(Fe)}):E.openCursor(he);function Me(Fe){return Object.create(Fe,{continue:{value:function(Ne){Ne!=null?Fe.continue(Hs(Ne,he.reverse?v.MAX_KEY:v.MIN_KEY,ve)):he.unique?Fe.continue(Fe.key.slice(0,Se).concat(he.reverse?v.MIN_KEY:v.MAX_KEY,ve)):Fe.continue()}},continuePrimaryKey:{value:function(Ne,Ge){Fe.continuePrimaryKey(Hs(Ne,v.MAX_KEY,ve),Ge)}},primaryKey:{get:function(){return Fe.primaryKey}},key:{get:function(){var Ne=Fe.key;return Se===1?Ne[0]:Ne.slice(0,Se)}},value:{get:function(){return Fe.value}}})}}})}})}};function bo(v,k,E,D){return E=E||{},D=D||"",x(v).forEach(function(F){var $,J,se;Y(k,F)?($=v[F],J=k[F],typeof $=="object"&&typeof J=="object"&&$&&J?(se=Kr($))!==Kr(J)?E[D+F]=k[F]:se==="Object"?bo($,J,E,D+F+"."):$!==J&&(E[D+F]=k[F]):$!==J&&(E[D+F]=k[F])):E[D+F]=void 0}),x(k).forEach(function(F){Y(v,F)||(E[D+F]=k[F])}),E}function tu(v,k){return k.type==="delete"?k.keys:k.keys||k.values.map(v.extractKey)}var gn={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(v){return c(c({},v),{table:function(k){var E=v.table(k),D=E.schema.primaryKey;return c(c({},E),{mutate:function(F){var $=zt.trans,J=$.table(k).hook,se=J.deleting,ye=J.creating,xe=J.updating;switch(F.type){case"add":if(ye.fire===Gt)break;return $._promise("readwrite",function(){return Ee(F)},!0);case"put":if(ye.fire===Gt&&xe.fire===Gt)break;return $._promise("readwrite",function(){return Ee(F)},!0);case"delete":if(se.fire===Gt)break;return $._promise("readwrite",function(){return Ee(F)},!0);case"deleteRange":if(se.fire===Gt)break;return $._promise("readwrite",function(){return function he(De,ve,Ce){return E.query({trans:De,values:!1,query:{index:D,range:ve},limit:Ce}).then(function(Se){var Me=Se.result;return Ee({type:"delete",keys:Me,trans:De}).then(function(Fe){return 0<Fe.numFailures?Promise.reject(Fe.failures[0]):Me.length<Ce?{failures:[],numFailures:0,lastResult:void 0}:he(De,c(c({},ve),{lower:Me[Me.length-1],lowerOpen:!0}),Ce)})})}(F.trans,F.range,1e4)},!0)}return E.mutate(F);function Ee(he){var De,ve,Ce,Se=zt.trans,Me=he.keys||tu(D,he);if(!Me)throw new Error("Keys missing");return(he=he.type==="add"||he.type==="put"?c(c({},he),{keys:Me}):c({},he)).type!=="delete"&&(he.values=_([],he.values)),he.keys&&(he.keys=_([],he.keys)),De=E,Ce=Me,((ve=he).type==="add"?Promise.resolve([]):De.getMany({trans:ve.trans,keys:Ce,cache:"immutable"})).then(function(Fe){var Ne=Me.map(function(Ge,tt){var dt,bt,lt,ft=Fe[tt],St={onerror:null,onsuccess:null};return he.type==="delete"?se.fire.call(St,Ge,ft,Se):he.type==="add"||ft===void 0?(dt=ye.fire.call(St,Ge,he.values[tt],Se),Ge==null&&dt!=null&&(he.keys[tt]=Ge=dt,D.outbound||Qe(he.values[tt],D.keyPath,Ge))):(dt=bo(ft,he.values[tt]),(bt=xe.fire.call(St,dt,Ge,ft,Se))&&(lt=he.values[tt],Object.keys(bt).forEach(function(it){Y(lt,it)?lt[it]=bt[it]:Qe(lt,it,bt[it])}))),St});return E.mutate(he).then(function(Ge){for(var tt=Ge.failures,dt=Ge.results,bt=Ge.numFailures,Ge=Ge.lastResult,lt=0;lt<Me.length;++lt){var ft=(dt||Me)[lt],St=Ne[lt];ft==null?St.onerror&&St.onerror(tt[lt]):St.onsuccess&&St.onsuccess(he.type==="put"&&Fe[lt]?he.values[lt]:ft)}return{failures:tt,results:dt,numFailures:bt,lastResult:Ge}}).catch(function(Ge){return Ne.forEach(function(tt){return tt.onerror&&tt.onerror(Ge)}),Promise.reject(Ge)})})}}})}})}};function $u(v,k,E){try{if(!k||k.keys.length<v.length)return null;for(var D=[],F=0,$=0;F<k.keys.length&&$<v.length;++F)rr(k.keys[F],v[$])===0&&(D.push(E?Ot(k.values[F]):k.values[F]),++$);return D.length===v.length?D:null}catch{return null}}var yr={stack:"dbcore",level:-1,create:function(v){return{table:function(k){var E=v.table(k);return c(c({},E),{getMany:function(D){if(!D.cache)return E.getMany(D);var F=$u(D.keys,D.trans._cache,D.cache==="clone");return F?wt.resolve(F):E.getMany(D).then(function($){return D.trans._cache={keys:D.keys,values:D.cache==="clone"?Ot($):$},$})},mutate:function(D){return D.type!=="add"&&(D.trans._cache=null),E.mutate(D)}})}}}};function So(v,k){return v.trans.mode==="readonly"&&!!v.subscr&&!v.trans.explicit&&v.trans.db._options.cache!=="disabled"&&!k.schema.primaryKey.outbound}function Gr(v,k){switch(v){case"query":return k.values&&!k.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var $r={stack:"dbcore",level:0,name:"Observability",create:function(v){var k=v.schema.name,E=new $n(v.MIN_KEY,v.MAX_KEY);return c(c({},v),{transaction:function(D,F,$){if(zt.subscr&&F!=="readonly")throw new ct.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(zt.querier));return v.transaction(D,F,$)},table:function(D){var F=v.table(D),$=F.schema,J=$.primaryKey,he=$.indexes,se=J.extractKey,ye=J.outbound,xe=J.autoIncrement&&he.filter(function(ve){return ve.compound&&ve.keyPath.includes(J.keyPath)}),Ee=c(c({},F),{mutate:function(ve){function Ce(it){return it="idb://".concat(k,"/").concat(D,"/").concat(it),Ge[it]||(Ge[it]=new $n)}var Se,Me,Fe,Ne=ve.trans,Ge=ve.mutatedParts||(ve.mutatedParts={}),tt=Ce(""),dt=Ce(":dels"),bt=ve.type,St=ve.type==="deleteRange"?[ve.range]:ve.type==="delete"?[ve.keys]:ve.values.length<50?[tu(J,ve).filter(function(it){return it}),ve.values]:[],lt=St[0],ft=St[1],St=ve.trans._cache;return h(lt)?(tt.addKeys(lt),(St=bt==="delete"||lt.length===ft.length?$u(lt,St):null)||dt.addKeys(lt),(St||ft)&&(Se=Ce,Me=St,Fe=ft,$.indexes.forEach(function(it){var Mt=Se(it.name||"");function pr(Zt){return Zt!=null?it.extractKey(Zt):null}function _r(Zt){return it.multiEntry&&h(Zt)?Zt.forEach(function(mn){return Mt.addKey(mn)}):Mt.addKey(Zt)}(Me||Fe).forEach(function(Zt,Tn){var Yt=Me&&pr(Me[Tn]),Tn=Fe&&pr(Fe[Tn]);rr(Yt,Tn)!==0&&(Yt!=null&&_r(Yt),Tn!=null&&_r(Tn))})}))):lt?(ft={from:(ft=lt.lower)!==null&&ft!==void 0?ft:v.MIN_KEY,to:(ft=lt.upper)!==null&&ft!==void 0?ft:v.MAX_KEY},dt.add(ft),tt.add(ft)):(tt.add(E),dt.add(E),$.indexes.forEach(function(it){return Ce(it.name).add(E)})),F.mutate(ve).then(function(it){return!lt||ve.type!=="add"&&ve.type!=="put"||(tt.addKeys(it.results),xe&&xe.forEach(function(Mt){for(var pr=ve.values.map(function(Yt){return Mt.extractKey(Yt)}),_r=Mt.keyPath.findIndex(function(Yt){return Yt===J.keyPath}),Zt=0,mn=it.results.length;Zt<mn;++Zt)pr[Zt][_r]=it.results[Zt];Ce(Mt.name).addKeys(pr)})),Ne.mutatedParts=xo(Ne.mutatedParts||{},Ge),it})}}),he=function(Ce){var Se=Ce.query,Ce=Se.index,Se=Se.range;return[Ce,new $n((Ce=Se.lower)!==null&&Ce!==void 0?Ce:v.MIN_KEY,(Se=Se.upper)!==null&&Se!==void 0?Se:v.MAX_KEY)]},De={get:function(ve){return[J,new $n(ve.key)]},getMany:function(ve){return[J,new $n().addKeys(ve.keys)]},count:he,query:he,openCursor:he};return x(De).forEach(function(ve){Ee[ve]=function(Ce){var Se=zt.subscr,Me=!!Se,Fe=So(zt,F)&&Gr(ve,Ce)?Ce.obsSet={}:Se;if(Me){var Ne=function(ft){return ft="idb://".concat(k,"/").concat(D,"/").concat(ft),Fe[ft]||(Fe[ft]=new $n)},Ge=Ne(""),tt=Ne(":dels"),Se=De[ve](Ce),Me=Se[0],Se=Se[1];if((ve==="query"&&Me.isPrimaryKey&&!Ce.values?tt:Ne(Me.name||"")).add(Se),!Me.isPrimaryKey){if(ve!=="count"){var dt=ve==="query"&&ye&&Ce.values&&F.query(c(c({},Ce),{values:!1}));return F[ve].apply(this,arguments).then(function(ft){if(ve==="query"){if(ye&&Ce.values)return dt.then(function(pr){return pr=pr.result,Ge.addKeys(pr),ft});var St=Ce.values?ft.result.map(se):ft.result;(Ce.values?Ge:tt).addKeys(St)}else if(ve==="openCursor"){var it=ft,Mt=Ce.values;return it&&Object.create(it,{key:{get:function(){return tt.addKey(it.primaryKey),it.key}},primaryKey:{get:function(){var pr=it.primaryKey;return tt.addKey(pr),pr}},value:{get:function(){return Mt&&Ge.addKey(it.primaryKey),it.value}}})}return ft})}tt.add(E)}}return F[ve].apply(this,arguments)}}),Ee}})}};function is(v,k,E){if(E.numFailures===0)return k;if(k.type==="deleteRange")return null;var D=k.keys?k.keys.length:"values"in k&&k.values?k.values.length:1;return E.numFailures===D?null:(k=c({},k),h(k.keys)&&(k.keys=k.keys.filter(function(F,$){return!($ in E.failures)})),"values"in k&&h(k.values)&&(k.values=k.values.filter(function(F,$){return!($ in E.failures)})),k)}function Ss(v,k){return E=v,((D=k).lower===void 0||(D.lowerOpen?0<rr(E,D.lower):0<=rr(E,D.lower)))&&(v=v,(k=k).upper===void 0||(k.upperOpen?rr(v,k.upper)<0:rr(v,k.upper)<=0));var E,D}function Zs(v,k,De,D,F,$){if(!De||De.length===0)return v;var J=k.query.index,se=J.multiEntry,ye=k.query.range,xe=D.schema.primaryKey.extractKey,Ee=J.extractKey,he=(J.lowLevelIndex||J).extractKey,De=De.reduce(function(ve,Ce){var Se=ve,Me=[];if(Ce.type==="add"||Ce.type==="put")for(var Fe=new $n,Ne=Ce.values.length-1;0<=Ne;--Ne){var Ge,tt=Ce.values[Ne],dt=xe(tt);Fe.hasKey(dt)||(Ge=Ee(tt),(se&&h(Ge)?Ge.some(function(it){return Ss(it,ye)}):Ss(Ge,ye))&&(Fe.addKey(dt),Me.push(tt)))}switch(Ce.type){case"add":var bt=new $n().addKeys(k.values?ve.map(function(Mt){return xe(Mt)}):ve),Se=ve.concat(k.values?Me.filter(function(Mt){return Mt=xe(Mt),!bt.hasKey(Mt)&&(bt.addKey(Mt),!0)}):Me.map(function(Mt){return xe(Mt)}).filter(function(Mt){return!bt.hasKey(Mt)&&(bt.addKey(Mt),!0)}));break;case"put":var lt=new $n().addKeys(Ce.values.map(function(Mt){return xe(Mt)}));Se=ve.filter(function(Mt){return!lt.hasKey(k.values?xe(Mt):Mt)}).concat(k.values?Me:Me.map(function(Mt){return xe(Mt)}));break;case"delete":var ft=new $n().addKeys(Ce.keys);Se=ve.filter(function(Mt){return!ft.hasKey(k.values?xe(Mt):Mt)});break;case"deleteRange":var St=Ce.range;Se=ve.filter(function(Mt){return!Ss(xe(Mt),St)})}return Se},v);return De===v?v:(De.sort(function(ve,Ce){return rr(he(ve),he(Ce))||rr(xe(ve),xe(Ce))}),k.limit&&k.limit<1/0&&(De.length>k.limit?De.length=k.limit:v.length===k.limit&&De.length<k.limit&&(F.dirty=!0)),$?Object.freeze(De):De)}function tl(v,k){return rr(v.lower,k.lower)===0&&rr(v.upper,k.upper)===0&&!!v.lowerOpen==!!k.lowerOpen&&!!v.upperOpen==!!k.upperOpen}function ks(v,k){return function(E,D,F,$){if(E===void 0)return D!==void 0?-1:0;if(D===void 0)return 1;if((D=rr(E,D))===0){if(F&&$)return 0;if(F)return 1;if($)return-1}return D}(v.lower,k.lower,v.lowerOpen,k.lowerOpen)<=0&&0<=function(E,D,F,$){if(E===void 0)return D!==void 0?1:0;if(D===void 0)return-1;if((D=rr(E,D))===0){if(F&&$)return 0;if(F)return-1;if($)return 1}return D}(v.upper,k.upper,v.upperOpen,k.upperOpen)}function Ws(v,k,E,D){v.subscribers.add(E),D.addEventListener("abort",function(){var F,$;v.subscribers.delete(E),v.subscribers.size===0&&(F=v,$=k,setTimeout(function(){F.subscribers.size===0&&Ke($,F)},3e3))})}var Ni={stack:"dbcore",level:0,name:"Cache",create:function(v){var k=v.schema.name;return c(c({},v),{transaction:function(E,D,F){var $,J,se=v.transaction(E,D,F);return D==="readwrite"&&(J=($=new AbortController).signal,F=function(ye){return function(){if($.abort(),D==="readwrite"){for(var xe=new Set,Ee=0,he=E;Ee<he.length;Ee++){var De=he[Ee],ve=za["idb://".concat(k,"/").concat(De)];if(ve){var Ce=v.table(De),Se=ve.optimisticOps.filter(function(Mt){return Mt.trans===se});if(se._explicit&&ye&&se.mutatedParts)for(var Me=0,Fe=Object.values(ve.queries.query);Me<Fe.length;Me++)for(var Ne=0,Ge=(bt=Fe[Me]).slice();Ne<Ge.length;Ne++)Jo((lt=Ge[Ne]).obsSet,se.mutatedParts)&&(Ke(bt,lt),lt.subscribers.forEach(function(Mt){return xe.add(Mt)}));else if(0<Se.length){ve.optimisticOps=ve.optimisticOps.filter(function(Mt){return Mt.trans!==se});for(var tt=0,dt=Object.values(ve.queries.query);tt<dt.length;tt++)for(var bt,lt,ft,St=0,it=(bt=dt[tt]).slice();St<it.length;St++)(lt=it[St]).res!=null&&se.mutatedParts&&(ye&&!lt.dirty?(ft=Object.isFrozen(lt.res),ft=Zs(lt.res,lt.req,Se,Ce,lt,ft),lt.dirty?(Ke(bt,lt),lt.subscribers.forEach(function(Mt){return xe.add(Mt)})):ft!==lt.res&&(lt.res=ft,lt.promise=wt.resolve({result:ft}))):(lt.dirty&&Ke(bt,lt),lt.subscribers.forEach(function(Mt){return xe.add(Mt)})))}}}xe.forEach(function(Mt){return Mt()})}}},se.addEventListener("abort",F(!1),{signal:J}),se.addEventListener("error",F(!1),{signal:J}),se.addEventListener("complete",F(!0),{signal:J})),se},table:function(E){var D=v.table(E),F=D.schema.primaryKey;return c(c({},D),{mutate:function($){var J=zt.trans;if(F.outbound||J.db._options.cache==="disabled"||J.explicit||J.idbtrans.mode!=="readwrite")return D.mutate($);var se=za["idb://".concat(k,"/").concat(E)];return se?(J=D.mutate($),$.type!=="add"&&$.type!=="put"||!(50<=$.values.length||tu(F,$).some(function(ye){return ye==null}))?(se.optimisticOps.push($),$.mutatedParts&&Bi($.mutatedParts),J.then(function(ye){0<ye.numFailures&&(Ke(se.optimisticOps,$),(ye=is(0,$,ye))&&se.optimisticOps.push(ye),$.mutatedParts&&Bi($.mutatedParts))}),J.catch(function(){Ke(se.optimisticOps,$),$.mutatedParts&&Bi($.mutatedParts)})):J.then(function(ye){var xe=is(0,c(c({},$),{values:$.values.map(function(Ee,he){var De;return ye.failures[he]?Ee:(Ee=(De=F.keyPath)!==null&&De!==void 0&&De.includes(".")?Ot(Ee):c({},Ee),Qe(Ee,F.keyPath,ye.results[he]),Ee)})}),ye);se.optimisticOps.push(xe),queueMicrotask(function(){return $.mutatedParts&&Bi($.mutatedParts)})}),J):D.mutate($)},query:function($){if(!So(zt,D)||!Gr("query",$))return D.query($);var J=((xe=zt.trans)===null||xe===void 0?void 0:xe.db._options.cache)==="immutable",he=zt,se=he.requery,ye=he.signal,xe=function(Ce,Se,Me,Fe){var Ne=za["idb://".concat(Ce,"/").concat(Se)];if(!Ne)return[];if(!(Se=Ne.queries[Me]))return[null,!1,Ne,null];var Ge=Se[(Fe.query?Fe.query.index.name:null)||""];if(!Ge)return[null,!1,Ne,null];switch(Me){case"query":var tt=Ge.find(function(dt){return dt.req.limit===Fe.limit&&dt.req.values===Fe.values&&tl(dt.req.query.range,Fe.query.range)});return tt?[tt,!0,Ne,Ge]:[Ge.find(function(dt){return("limit"in dt.req?dt.req.limit:1/0)>=Fe.limit&&(!Fe.values||dt.req.values)&&ks(dt.req.query.range,Fe.query.range)}),!1,Ne,Ge];case"count":return tt=Ge.find(function(dt){return tl(dt.req.query.range,Fe.query.range)}),[tt,!!tt,Ne,Ge]}}(k,E,"query",$),Ee=xe[0],he=xe[1],De=xe[2],ve=xe[3];return Ee&&he?Ee.obsSet=$.obsSet:(he=D.query($).then(function(Ce){var Se=Ce.result;if(Ee&&(Ee.res=Se),J){for(var Me=0,Fe=Se.length;Me<Fe;++Me)Object.freeze(Se[Me]);Object.freeze(Se)}else Ce.result=Ot(Se);return Ce}).catch(function(Ce){return ve&&Ee&&Ke(ve,Ee),Promise.reject(Ce)}),Ee={obsSet:$.obsSet,promise:he,subscribers:new Set,type:"query",req:$,dirty:!1},ve?ve.push(Ee):(ve=[Ee],(De=De||(za["idb://".concat(k,"/").concat(E)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[$.query.index.name||""]=ve)),Ws(Ee,ve,se,ye),Ee.promise.then(function(Ce){return{result:Zs(Ce.result,$,De?.optimisticOps,D,Ee,J)}})}})}})}};function Xs(v,k){return new Proxy(v,{get:function(E,D,F){return D==="db"?k:Reflect.get(E,D,F)}})}var Qi=(pn.prototype.version=function(v){if(isNaN(v)||v<.1)throw new ct.Type("Given version is not a positive number");if(v=Math.round(10*v)/10,this.idbdb||this._state.isBeingOpened)throw new ct.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,v);var k=this._versions,E=k.filter(function(D){return D._cfg.version===v})[0];return E||(E=new this.Version(v),k.push(E),k.sort(Or),E.stores({}),this._state.autoSchema=!1,E)},pn.prototype._whenReady=function(v){var k=this;return this.idbdb&&(this._state.openComplete||zt.letThrough||this._vip)?v():new wt(function(E,D){if(k._state.openComplete)return D(new ct.DatabaseClosed(k._state.dbOpenError));if(!k._state.isBeingOpened){if(!k._state.autoOpen)return void D(new ct.DatabaseClosed);k.open().catch(Gt)}k._state.dbReadyPromise.then(E,D)}).then(v)},pn.prototype.use=function(v){var k=v.stack,E=v.create,D=v.level,F=v.name;return F&&this.unuse({stack:k,name:F}),v=this._middlewares[k]||(this._middlewares[k]=[]),v.push({stack:k,create:E,level:D??10,name:F}),v.sort(function($,J){return $.level-J.level}),this},pn.prototype.unuse=function(v){var k=v.stack,E=v.name,D=v.create;return k&&this._middlewares[k]&&(this._middlewares[k]=this._middlewares[k].filter(function(F){return D?F.create!==D:!!E&&F.name!==E})),this},pn.prototype.open=function(){var v=this;return Ur(Ht,function(){return eu(v)})},pn.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var v=this._state,k=Xa.indexOf(this);if(0<=k&&Xa.splice(k,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}v.isBeingOpened||(v.dbReadyPromise=new wt(function(E){v.dbReadyResolve=E}),v.openCanceller=new wt(function(E,D){v.cancelOpen=D}))},pn.prototype.close=function(E){var k=(E===void 0?{disableAutoOpen:!0}:E).disableAutoOpen,E=this._state;k?(E.isBeingOpened&&E.cancelOpen(new ct.DatabaseClosed),this._close(),E.autoOpen=!1,E.dbOpenError=new ct.DatabaseClosed):(this._close(),E.autoOpen=this._options.autoOpen||E.isBeingOpened,E.openComplete=!1,E.dbOpenError=null)},pn.prototype.delete=function(v){var k=this;v===void 0&&(v={disableAutoOpen:!0});var E=0<arguments.length&&typeof arguments[0]!="object",D=this._state;return new wt(function(F,$){function J(){k.close(v);var se=k._deps.indexedDB.deleteDatabase(k.name);se.onsuccess=Oe(function(){var ye,xe,Ee;ye=k._deps,xe=k.name,Ee=ye.indexedDB,ye=ye.IDBKeyRange,Ma(Ee)||xe===Hn||Wo(Ee,ye).delete(xe).catch(Gt),F()}),se.onerror=ki($),se.onblocked=k._fireOnBlocked}if(E)throw new ct.InvalidArgument("Invalid closeOptions argument to db.delete()");D.isBeingOpened?D.dbReadyPromise.then(J):J()})},pn.prototype.backendDB=function(){return this.idbdb},pn.prototype.isOpen=function(){return this.idbdb!==null},pn.prototype.hasBeenClosed=function(){var v=this._state.dbOpenError;return v&&v.name==="DatabaseClosed"},pn.prototype.hasFailed=function(){return this._state.dbOpenError!==null},pn.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(pn.prototype,"tables",{get:function(){var v=this;return x(this._allTables).map(function(k){return v._allTables[k]})},enumerable:!1,configurable:!0}),pn.prototype.transaction=function(){var v=function(k,E,D){var F=arguments.length;if(F<2)throw new ct.InvalidArgument("Too few arguments");for(var $=new Array(F-1);--F;)$[F-1]=arguments[F];return D=$.pop(),[k,Le($),D]}.apply(this,arguments);return this._transaction.apply(this,v)},pn.prototype._transaction=function(v,k,E){var D=this,F=zt.trans;F&&F.db===this&&v.indexOf("!")===-1||(F=null);var $,J,se=v.indexOf("?")!==-1;v=v.replace("!","").replace("?","");try{if(J=k.map(function(xe){if(xe=xe instanceof D.Table?xe.name:xe,typeof xe!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return xe}),v=="r"||v===ri)$=ri;else{if(v!="rw"&&v!=Gl)throw new ct.InvalidArgument("Invalid transaction mode: "+v);$=Gl}if(F){if(F.mode===ri&&$===Gl){if(!se)throw new ct.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");F=null}F&&J.forEach(function(xe){if(F&&F.storeNames.indexOf(xe)===-1){if(!se)throw new ct.SubTransaction("Table "+xe+" not included in parent transaction.");F=null}}),se&&F&&!F.active&&(F=null)}}catch(xe){return F?F._promise(null,function(Ee,he){he(xe)}):Ar(xe)}var ye=function xe(Ee,he,De,ve,Ce){return wt.resolve().then(function(){var Se=zt.transless||zt,Me=Ee._createTransaction(he,De,Ee._dbSchema,ve);if(Me.explicit=!0,Se={trans:Me,transless:Se},ve)Me.idbtrans=ve.idbtrans;else try{Me.create(),Me.idbtrans._explicit=!0,Ee._state.PR1398_maxLoop=3}catch(Ge){return Ge.name===zr.InvalidState&&Ee.isOpen()&&0<--Ee._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),Ee.close({disableAutoOpen:!1}),Ee.open().then(function(){return xe(Ee,he,De,null,Ce)})):Ar(Ge)}var Fe,Ne=yt(Ce);return Ne&&xr(),Se=wt.follow(function(){var Ge;(Fe=Ce.call(Me,Me))&&(Ne?(Ge=hr.bind(null,null),Fe.then(Ge,Ge)):typeof Fe.next=="function"&&typeof Fe.throw=="function"&&(Fe=Gs(Fe)))},Se),(Fe&&typeof Fe.then=="function"?wt.resolve(Fe).then(function(Ge){return Me.active?Ge:Ar(new ct.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):Se.then(function(){return Fe})).then(function(Ge){return ve&&Me._resolve(),Me._completion.then(function(){return Ge})}).catch(function(Ge){return Me._reject(Ge),Ar(Ge)})})}.bind(null,this,$,J,F,E);return F?F._promise($,ye,"lock"):zt.trans?Ur(zt.transless,function(){return D._whenReady(ye)}):this._whenReady(ye)},pn.prototype.table=function(v){if(!Y(this._allTables,v))throw new ct.InvalidTable("Table ".concat(v," does not exist"));return this._allTables[v]},pn);function pn(v,k){var E=this;this._middlewares={},this.verno=0;var D=pn.dependencies;this._options=k=c({addons:pn.addons,autoOpen:!0,indexedDB:D.indexedDB,IDBKeyRange:D.IDBKeyRange,cache:"cloned"},k),this._deps={indexedDB:k.indexedDB,IDBKeyRange:k.IDBKeyRange},D=k.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var F,$,J,se,ye,xe={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Gt,dbReadyPromise:null,cancelOpen:Gt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:k.autoOpen};xe.dbReadyPromise=new wt(function(he){xe.dbReadyResolve=he}),xe.openCanceller=new wt(function(he,De){xe.cancelOpen=De}),this._state=xe,this.name=v,this.on=Qa(this,"populate","blocked","versionchange","close",{ready:[dr,Gt]}),this.once=function(he,De){var ve=function(){for(var Ce=[],Se=0;Se<arguments.length;Se++)Ce[Se]=arguments[Se];E.on(he).unsubscribe(ve),De.apply(E,Ce)};return E.on(he,ve)},this.on.ready.subscribe=ke(this.on.ready.subscribe,function(he){return function(De,ve){pn.vip(function(){var Ce,Se=E._state;Se.openComplete?(Se.dbOpenError||wt.resolve().then(De),ve&&he(De)):Se.onReadyBeingFired?(Se.onReadyBeingFired.push(De),ve&&he(De)):(he(De),Ce=E,ve||he(function Me(){Ce.on.ready.unsubscribe(De),Ce.on.ready.unsubscribe(Me)}))})}}),this.Collection=(F=this,Yi(po.prototype,function(Fe,Me){this.db=F;var ve=ci,Ce=null;if(Me)try{ve=Me()}catch(Ne){Ce=Ne}var Se=Fe._ctx,Me=Se.table,Fe=Me.hook.reading.fire;this._ctx={table:Me,index:Se.index,isPrimKey:!Se.index||Me.schema.primKey.keyPath&&Se.index===Me.schema.primKey.name,range:ve,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:Ce,or:Se.or,valueMapper:Fe!==Nr?Fe:null}})),this.Table=($=this,Yi(Oi.prototype,function(he,De,ve){this.db=$,this._tx=ve,this.name=he,this.schema=De,this.hook=$._allTables[he]?$._allTables[he].hook:Qa(null,{creating:[Te,Gt],reading:[Lr,Nr],updating:[Tr,Gt],deleting:[nn,Gt]})})),this.Transaction=(J=this,Yi(Nu.prototype,function(he,De,ve,Ce,Se){var Me=this;he!=="readonly"&&De.forEach(function(Fe){Fe=(Fe=ve[Fe])===null||Fe===void 0?void 0:Fe.yProps,Fe&&(De=De.concat(Fe.map(function(Ne){return Ne.updatesTable})))}),this.db=J,this.mode=he,this.storeNames=De,this.schema=ve,this.chromeTransactionDurability=Ce,this.idbtrans=null,this.on=Qa(this,"complete","error","abort"),this.parent=Se||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new wt(function(Fe,Ne){Me._resolve=Fe,Me._reject=Ne}),this._completion.then(function(){Me.active=!1,Me.on.complete.fire()},function(Fe){var Ne=Me.active;return Me.active=!1,Me.on.error.fire(Fe),Me.parent?Me.parent._reject(Fe):Ne&&Me.idbtrans&&Me.idbtrans.abort(),Ar(Fe)})})),this.Version=(se=this,Yi(Uu.prototype,function(he){this.db=se,this._cfg={version:he,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(ye=this,Yi(ii.prototype,function(he,De,ve){if(this.db=ye,this._ctx={table:he,index:De===":id"?null:De,or:ve},this._cmp=this._ascending=rr,this._descending=function(Ce,Se){return rr(Se,Ce)},this._max=function(Ce,Se){return 0<rr(Ce,Se)?Ce:Se},this._min=function(Ce,Se){return rr(Ce,Se)<0?Ce:Se},this._IDBKeyRange=ye._deps.IDBKeyRange,!this._IDBKeyRange)throw new ct.MissingAPI})),this.on("versionchange",function(he){0<he.newVersion?console.warn("Another connection wants to upgrade database '".concat(E.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(E.name,"'. Closing db now to resume the delete request.")),E.close({disableAutoOpen:!1})}),this.on("blocked",function(he){!he.newVersion||he.newVersion<he.oldVersion?console.warn("Dexie.delete('".concat(E.name,"') was blocked")):console.warn("Upgrade '".concat(E.name,"' blocked by other connection holding version ").concat(he.oldVersion/10))}),this._maxKey=Aa(k.IDBKeyRange),this._createTransaction=function(he,De,ve,Ce){return new E.Transaction(he,De,ve,E._options.chromeTransactionDurability,Ce)},this._fireOnBlocked=function(he){E.on("blocked").fire(he),Xa.filter(function(De){return De.name===E.name&&De!==E&&!De._state.vcFired}).map(function(De){return De.on("versionchange").fire(he)})},this.use(yr),this.use(Ni),this.use($r),this.use(bs),this.use(gn);var Ee=new Proxy(this,{get:function(he,De,ve){if(De==="_vip")return!0;if(De==="table")return function(Se){return Xs(E.table(Se),Ee)};var Ce=Reflect.get(he,De,ve);return Ce instanceof Oi?Xs(Ce,Ee):De==="tables"?Ce.map(function(Se){return Xs(Se,Ee)}):De==="_createTransaction"?function(){return Xs(Ce.apply(this,arguments),Ee)}:Ce}});this.vip=Ee,D.forEach(function(he){return he(E)})}var ma,Zn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",ko=(as.prototype.subscribe=function(v,k,E){return this._subscribe(v&&typeof v!="function"?v:{next:v,error:k,complete:E})},as.prototype[Zn]=function(){return this},as);function as(v){this._subscribe=v}try{ma={indexedDB:b.indexedDB||b.mozIndexedDB||b.webkitIndexedDB||b.msIndexedDB,IDBKeyRange:b.IDBKeyRange||b.webkitIDBKeyRange}}catch{ma={indexedDB:null,IDBKeyRange:null}}function Ys(v){var k,E=!1,D=new ko(function(F){var $=yt(v),J,se=!1,ye={},xe={},Ee={get closed(){return se},unsubscribe:function(){se||(se=!0,J&&J.abort(),he&&rs.storagemutated.unsubscribe(ve))}};F.start&&F.start(Ee);var he=!1,De=function(){return Dn(Ce)},ve=function(Se){xo(ye,Se),Jo(xe,ye)&&De()},Ce=function(){var Se,Me,Fe;!se&&ma.indexedDB&&(ye={},Se={},J&&J.abort(),J=new AbortController,Fe=function(Ne){var Ge=fe();try{$&&xr();var tt=tr(v,Ne);return tt=$?tt.finally(hr):tt}finally{Ge&&_e()}}(Me={subscr:Se,signal:J.signal,requery:De,querier:v,trans:null}),Promise.resolve(Fe).then(function(Ne){E=!0,k=Ne,se||Me.signal.aborted||(ye={},function(Ge){for(var tt in Ge)if(Y(Ge,tt))return;return 1}(xe=Se)||he||(rs(Vs,ve),he=!0),Dn(function(){return!se&&F.next&&F.next(Ne)}))},function(Ne){E=!1,["DatabaseClosedError","AbortError"].includes(Ne?.name)||se||Dn(function(){se||F.error&&F.error(Ne)})}))};return setTimeout(De,0),Ee});return D.hasValue=function(){return E},D.getValue=function(){return k},D}var ga=Qi;function ss(v){var k=La;try{La=!0,rs.storagemutated.fire(v),wo(v,!0)}finally{La=k}}W(ga,c(c({},cr),{delete:function(v){return new ga(v,{addons:[]}).delete()},exists:function(v){return new ga(v,{addons:[]}).open().then(function(k){return k.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(v){try{return k=ga.dependencies,E=k.indexedDB,k=k.IDBKeyRange,(Ma(E)?Promise.resolve(E.databases()).then(function(D){return D.map(function(F){return F.name}).filter(function(F){return F!==Hn})}):Wo(E,k).toCollection().primaryKeys()).then(v)}catch{return Ar(new ct.MissingAPI)}var k,E},defineClass:function(){return function(v){j(this,v)}},ignoreTransaction:function(v){return zt.trans?Ur(zt.transless,v):v()},vip:Xo,async:function(v){return function(){try{var k=Gs(v.apply(this,arguments));return k&&typeof k.then=="function"?k:wt.resolve(k)}catch(E){return Ar(E)}}},spawn:function(v,k,E){try{var D=Gs(v.apply(E,k||[]));return D&&typeof D.then=="function"?D:wt.resolve(D)}catch(F){return Ar(F)}},currentTransaction:{get:function(){return zt.trans||null}},waitFor:function(v,k){return k=wt.resolve(typeof v=="function"?ga.ignoreTransaction(v):v).timeout(k||6e4),zt.trans?zt.trans.waitFor(k):k},Promise:wt,debug:{get:function(){return _n},set:function(v){Sn(v)}},derive:Je,extend:j,props:W,override:ke,Events:Qa,on:rs,liveQuery:Ys,extendObservabilitySet:xo,getByKeyPath:ut,setByKeyPath:Qe,delByKeyPath:function(v,k){typeof k=="string"?Qe(v,k,void 0):"length"in k&&[].map.call(k,function(E){Qe(v,E,void 0)})},shallowClone:ce,deepClone:Ot,getObjectDiff:bo,cmp:rr,asap:et,minKey:-1/0,addons:[],connections:Xa,errnames:zr,dependencies:ma,cache:za,semVer:"4.2.1",version:"4.2.1".split(".").map(function(v){return parseInt(v)}).reduce(function(v,k,E){return v+k/Math.pow(10,2*E)})})),ga.maxKey=Aa(ga.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(rs(Vs,function(v){La||(v=new CustomEvent(ts,{detail:v}),La=!0,dispatchEvent(v),La=!1)}),addEventListener(ts,function(v){v=v.detail,La||ss(v)}));var ea,La=!1,rl=function(){};return typeof BroadcastChannel<"u"&&((rl=function(){(ea=new BroadcastChannel(ts)).onmessage=function(v){return v.data&&ss(v.data)}})(),typeof ea.unref=="function"&&ea.unref(),rs(Vs,function(v){La||ea.postMessage(v)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(v){if(!Qi.disableBfCache&&v.persisted){_n&&console.debug("Dexie: handling persisted pagehide"),ea?.close();for(var k=0,E=Xa;k<E.length;k++)E[k].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(v){!Qi.disableBfCache&&v.persisted&&(_n&&console.debug("Dexie: handling persisted pageshow"),rl(),ss({all:new $n(-1/0,[[]])}))})),wt.rejectionMapper=function(v,k){return!v||v instanceof It||v instanceof TypeError||v instanceof SyntaxError||!v.name||!Br[v.name]?v:(k=new Br[v.name](k||v.message,v),"stack"in v&&He(k,"stack",{get:function(){return this.inner.stack}}),k)},Sn(_n),c(Qi,Object.freeze({__proto__:null,Dexie:Qi,liveQuery:Ys,Entity:Ya,cmp:rr,PropModification:Ja,replacePrefix:function(v,k){return new Ja({replacePrefix:[v,k]})},add:function(v){return new Ja({add:v})},remove:function(v){return new Ja({remove:v})},default:Qi,RangeSet:$n,mergeRanges:_o,rangesOverlap:vo}),{default:Qi}),Qi})})(Gw);var $C=Gw.exports;const sy=gp($C),lx=Symbol.for("Dexie"),cp=globalThis[lx]||(globalThis[lx]=sy);if(sy.semVer!==cp.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${sy.semVer} and ${cp.semVer}`);const{liveQuery:qC,mergeRanges:WT,rangesOverlap:XT,RangeSet:YT,cmp:JT,Entity:QT,PropModification:eI,replacePrefix:tI,add:rI,remove:nI,DexieYProvider:iI}=cp;function KC(n,r,o){var c,_;typeof n=="function"?(c=r||[],_=o):(c=[],_=r);var b=yc.useRef({hasResult:!1,result:_,error:null}),x=yc.useReducer(function(q){return q+1},0);x[0];var h=x[1],j=yc.useMemo(function(){var q=typeof n=="function"?n():n;if(!q||typeof q.subscribe!="function")throw n===q?new TypeError("Given argument to useObservable() was neither a valid observable nor a function."):new TypeError("Observable factory given to useObservable() did not return a valid observable.");if(!b.current.hasResult&&typeof window<"u"&&(typeof q.hasValue!="function"||q.hasValue()))if(typeof q.getValue=="function")b.current.result=q.getValue(),b.current.hasResult=!0;else{var le=q.subscribe(function(Y){b.current.result=Y,b.current.hasResult=!0});typeof le=="function"?le():le.unsubscribe()}return q},c);if(yc.useDebugValue(b.current.result),yc.useEffect(function(){var q=j.subscribe(function(le){var Y=b.current;(Y.error!==null||Y.result!==le)&&(Y.error=null,Y.result=le,Y.hasResult=!0,h())},function(le){var Y=b.current;Y.error!==le&&(Y.error=le,h())});return typeof q=="function"?q:q.unsubscribe.bind(q)},c),b.current.error)throw b.current.error;return b.current.result}function GC(n,r,o){return KC(function(){return qC(n)},r||[],o)}class HC extends cp{observations;images;datasets;constructor(){super("WGFieldValidator"),this.version(1).stores({observations:"id, timestamp, userValidation, [location.lat+location.lon]",images:"id, createdAt",datasets:"id, layerId, updatedAt"})}}const qa=new HC;async function ZC(n,r){await qa.datasets.put({id:n,layerId:n,data:r,updatedAt:new Date().toISOString()})}async function WC(n){return(await qa.datasets.get(n))?.data}async function XC(n){const r=n.map(o=>({type:"Feature",geometry:{type:"Point",coordinates:[o.location.lon,o.location.lat]},properties:{id:o.id,timestamp:o.timestamp,validation:o.userValidation,notes:o.notes,accuracy_m:o.location.accuracy,...Object.entries(o.datasetValues).reduce((c,[_,b])=>(Object.entries(b).forEach(([x,h])=>{c[`${_}_${x}`]=h}),c),{})}}));return JSON.stringify({type:"FeatureCollection",features:r},null,2)}async function YC(n){if(n.length===0)return"";const r=new Set;n.forEach(_=>{Object.entries(_.datasetValues).forEach(([b,x])=>{Object.keys(x).forEach(h=>{r.add(`${b}_${h}`)})})});const o=["id","timestamp","lat","lon","accuracy_m","validation","notes",...Array.from(r)],c=n.map(_=>{const b={};return Object.entries(_.datasetValues).forEach(([x,h])=>{Object.entries(h).forEach(([j,q])=>{b[`${x}_${j}`]=String(q??"")})}),[_.id,_.timestamp,_.location.lat,_.location.lon,_.location.accuracy,_.userValidation,`"${_.notes.replace(/"/g,'""')}"`,...Array.from(r).map(x=>b[x]??"")].join(",")});return[o.join(","),...c].join(`
`)}var zp=typeof self<"u"?self:global;const wd=typeof navigator<"u",JC=wd&&typeof HTMLImageElement>"u",hp=!(typeof global>"u"||typeof process>"u"||!process.versions||!process.versions.node),Lp=zp.Buffer,bf=zp.BigInt,Rp=!!Lp,QC=n=>n;function dp(n,r=QC){if(hp)try{return typeof require=="function"?Promise.resolve(r(require(n))):import(n).then(r)}catch{console.warn(`Couldn't load ${n}`)}}let s_=zp.fetch;const eT=n=>s_=n;if(!zp.fetch){const n=dp("http",c=>c),r=dp("https",c=>c),o=(c,{headers:_}={})=>new Promise(async(b,x)=>{let{port:h,hostname:j,pathname:q,protocol:le,search:Y}=new URL(c);const W={method:"GET",hostname:j,path:encodeURI(q)+Y,headers:_};h!==""&&(W.port=Number(h));const $e=(le==="https:"?await r:await n).request(W,He=>{if(He.statusCode===301||He.statusCode===302){let Je=new URL(He.headers.location,c).toString();return o(Je,{headers:_}).then(b).catch(x)}b({status:He.statusCode,arrayBuffer:()=>new Promise(Je=>{let Qt=[];He.on("data",be=>Qt.push(be)),He.on("end",()=>Je(Buffer.concat(Qt)))})})});$e.on("error",x),$e.end()});eT(o)}function fr(n,r,o){return r in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,n}const fp=n=>Hw(n)?void 0:n,tT=n=>n!==void 0;function Hw(n){return n===void 0||(n instanceof Map?n.size===0:Object.values(n).filter(tT).length===0)}function ei(n){let r=new Error(n);throw delete r.stack,r}function wu(n){return(n=function(r){for(;r.endsWith("\0");)r=r.slice(0,-1);return r}(n).trim())===""?void 0:n}function oy(n){let r=function(o){let c=0;return o.ifd0.enabled&&(c+=1024),o.exif.enabled&&(c+=2048),o.makerNote&&(c+=2048),o.userComment&&(c+=1024),o.gps.enabled&&(c+=512),o.interop.enabled&&(c+=100),o.ifd1.enabled&&(c+=1024),c+2048}(n);return n.jfif.enabled&&(r+=50),n.xmp.enabled&&(r+=2e4),n.iptc.enabled&&(r+=14e3),n.icc.enabled&&(r+=6e3),r}const ly=n=>String.fromCharCode.apply(null,n),ux=typeof TextDecoder<"u"?new TextDecoder("utf-8"):void 0;function Zw(n){return ux?ux.decode(n):Rp?Buffer.from(n).toString("utf8"):decodeURIComponent(escape(ly(n)))}class ka{static from(r,o){return r instanceof this&&r.le===o?r:new ka(r,void 0,void 0,o)}constructor(r,o=0,c,_){if(typeof _=="boolean"&&(this.le=_),Array.isArray(r)&&(r=new Uint8Array(r)),r===0)this.byteOffset=0,this.byteLength=0;else if(r instanceof ArrayBuffer){c===void 0&&(c=r.byteLength-o);let b=new DataView(r,o,c);this._swapDataView(b)}else if(r instanceof Uint8Array||r instanceof DataView||r instanceof ka){c===void 0&&(c=r.byteLength-o),(o+=r.byteOffset)+c>r.byteOffset+r.byteLength&&ei("Creating view outside of available memory in ArrayBuffer");let b=new DataView(r.buffer,o,c);this._swapDataView(b)}else if(typeof r=="number"){let b=new DataView(new ArrayBuffer(r));this._swapDataView(b)}else ei("Invalid input argument for BufferView: "+r)}_swapArrayBuffer(r){this._swapDataView(new DataView(r))}_swapBuffer(r){this._swapDataView(new DataView(r.buffer,r.byteOffset,r.byteLength))}_swapDataView(r){this.dataView=r,this.buffer=r.buffer,this.byteOffset=r.byteOffset,this.byteLength=r.byteLength}_lengthToEnd(r){return this.byteLength-r}set(r,o,c=ka){return r instanceof DataView||r instanceof ka?r=new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer&&(r=new Uint8Array(r)),r instanceof Uint8Array||ei("BufferView.set(): Invalid data argument."),this.toUint8().set(r,o),new c(this,o,r.byteLength)}subarray(r,o){return o=o||this._lengthToEnd(r),new ka(this,r,o)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(r,o){return new Uint8Array(this.buffer,this.byteOffset+r,o)}getString(r=0,o=this.byteLength){return Zw(this.getUint8Array(r,o))}getLatin1String(r=0,o=this.byteLength){let c=this.getUint8Array(r,o);return ly(c)}getUnicodeString(r=0,o=this.byteLength){const c=[];for(let _=0;_<o&&r+_<this.byteLength;_+=2)c.push(this.getUint16(r+_));return ly(c)}getInt8(r){return this.dataView.getInt8(r)}getUint8(r){return this.dataView.getUint8(r)}getInt16(r,o=this.le){return this.dataView.getInt16(r,o)}getInt32(r,o=this.le){return this.dataView.getInt32(r,o)}getUint16(r,o=this.le){return this.dataView.getUint16(r,o)}getUint32(r,o=this.le){return this.dataView.getUint32(r,o)}getFloat32(r,o=this.le){return this.dataView.getFloat32(r,o)}getFloat64(r,o=this.le){return this.dataView.getFloat64(r,o)}getFloat(r,o=this.le){return this.dataView.getFloat32(r,o)}getDouble(r,o=this.le){return this.dataView.getFloat64(r,o)}getUintBytes(r,o,c){switch(o){case 1:return this.getUint8(r,c);case 2:return this.getUint16(r,c);case 4:return this.getUint32(r,c);case 8:return this.getUint64&&this.getUint64(r,c)}}getUint(r,o,c){switch(o){case 8:return this.getUint8(r,c);case 16:return this.getUint16(r,c);case 32:return this.getUint32(r,c);case 64:return this.getUint64&&this.getUint64(r,c)}}toString(r){return this.dataView.toString(r,this.constructor.name)}ensureChunk(){}}function uy(n,r){ei(`${n} '${r}' was not loaded, try using full build of exifr.`)}class o_ extends Map{constructor(r){super(),this.kind=r}get(r,o){return this.has(r)||uy(this.kind,r),o&&(r in o||function(c,_){ei(`Unknown ${c} '${_}'.`)}(this.kind,r),o[r].enabled||uy(this.kind,r)),super.get(r)}keyList(){return Array.from(this.keys())}}var uo=new o_("file parser"),Jn=new o_("segment parser"),co=new o_("file reader");function rT(n,r){return typeof n=="string"?cx(n,r):wd&&!JC&&n instanceof HTMLImageElement?cx(n.src,r):n instanceof Uint8Array||n instanceof ArrayBuffer||n instanceof DataView?new ka(n):wd&&n instanceof Blob?cy(n,r,"blob",Du):void ei("Invalid input argument")}function cx(n,r){return(o=n).startsWith("data:")||o.length>1e4?hy(n,r,"base64"):hp&&n.includes("://")?cy(n,r,"url",Mu):hp?hy(n,r,"fs"):wd?cy(n,r,"url",Mu):void ei("Invalid input argument");var o}async function cy(n,r,o,c){return co.has(o)?hy(n,r,o):c?async function(_,b){let x=await b(_);return new ka(x)}(n,c):void ei(`Parser ${o} is not loaded`)}async function hy(n,r,o){let c=new(co.get(o))(n,r);return await c.read(),c}const Mu=n=>s_(n).then(r=>r.arrayBuffer()),Du=n=>new Promise((r,o)=>{let c=new FileReader;c.onloadend=()=>r(c.result||new ArrayBuffer),c.onerror=o,c.readAsArrayBuffer(n)});class nT extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}}function Gn(n,r,o){let c=new nT;for(let[_,b]of o)c.set(_,b);if(Array.isArray(r))for(let _ of r)n.set(_,c);else n.set(r,c);return c}function zu(n,r,o){let c,_=n.get(r);for(c of o)_.set(c[0],c[1])}const wi=new Map,Fs=new Map,Nl=new Map,Il=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],Zc=["jfif","xmp","icc","iptc","ihdr"],Lu=["tiff",...Zc],Un=["ifd0","ifd1","exif","gps","interop"],Pl=[...Lu,...Un],El=["makerNote","userComment"],Wc=["translateKeys","translateValues","reviveValues","multiSegment"],Al=[...Wc,"sanitize","mergeOutput","silentErrors"];class Ww{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class Vh extends Ww{get needed(){return this.enabled||this.deps.size>0}constructor(r,o,c,_){if(super(),fr(this,"enabled",!1),fr(this,"skip",new Set),fr(this,"pick",new Set),fr(this,"deps",new Set),fr(this,"translateKeys",!1),fr(this,"translateValues",!1),fr(this,"reviveValues",!1),this.key=r,this.enabled=o,this.parse=this.enabled,this.applyInheritables(_),this.canBeFiltered=Un.includes(r),this.canBeFiltered&&(this.dict=wi.get(r)),c!==void 0)if(Array.isArray(c))this.parse=this.enabled=!0,this.canBeFiltered&&c.length>0&&this.translateTagSet(c,this.pick);else if(typeof c=="object"){if(this.enabled=!0,this.parse=c.parse!==!1,this.canBeFiltered){let{pick:b,skip:x}=c;b&&b.length>0&&this.translateTagSet(b,this.pick),x&&x.length>0&&this.translateTagSet(x,this.skip)}this.applyInheritables(c)}else c===!0||c===!1?this.parse=this.enabled=c:ei(`Invalid options argument: ${c}`)}applyInheritables(r){let o,c;for(o of Wc)c=r[o],c!==void 0&&(this[o]=c)}translateTagSet(r,o){if(this.dict){let c,_,{tagKeys:b,tagValues:x}=this.dict;for(c of r)typeof c=="string"?(_=x.indexOf(c),_===-1&&(_=b.indexOf(Number(c))),_!==-1&&o.add(Number(b[_]))):o.add(c)}else for(let c of r)o.add(c)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,pp(this.pick,this.deps)):this.enabled&&this.pick.size>0&&pp(this.pick,this.deps)}}var aa={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},hx=new Map;class Fu extends Ww{static useCached(r){let o=hx.get(r);return o!==void 0||(o=new this(r),hx.set(r,o)),o}constructor(r){super(),r===!0?this.setupFromTrue():r===void 0?this.setupFromUndefined():Array.isArray(r)?this.setupFromArray(r):typeof r=="object"?this.setupFromObject(r):ei(`Invalid options argument ${r}`),this.firstChunkSize===void 0&&(this.firstChunkSize=wd?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let r;for(r of Il)this[r]=aa[r];for(r of Al)this[r]=aa[r];for(r of El)this[r]=aa[r];for(r of Pl)this[r]=new Vh(r,aa[r],void 0,this)}setupFromTrue(){let r;for(r of Il)this[r]=aa[r];for(r of Al)this[r]=aa[r];for(r of El)this[r]=!0;for(r of Pl)this[r]=new Vh(r,!0,void 0,this)}setupFromArray(r){let o;for(o of Il)this[o]=aa[o];for(o of Al)this[o]=aa[o];for(o of El)this[o]=aa[o];for(o of Pl)this[o]=new Vh(o,!1,void 0,this);this.setupGlobalFilters(r,void 0,Un)}setupFromObject(r){let o;for(o of(Un.ifd0=Un.ifd0||Un.image,Un.ifd1=Un.ifd1||Un.thumbnail,Object.assign(this,r),Il))this[o]=og(r[o],aa[o]);for(o of Al)this[o]=og(r[o],aa[o]);for(o of El)this[o]=og(r[o],aa[o]);for(o of Lu)this[o]=new Vh(o,aa[o],r[o],this);for(o of Un)this[o]=new Vh(o,aa[o],r[o],this.tiff);this.setupGlobalFilters(r.pick,r.skip,Un,Pl),r.tiff===!0?this.batchEnableWithBool(Un,!0):r.tiff===!1?this.batchEnableWithUserValue(Un,r):Array.isArray(r.tiff)?this.setupGlobalFilters(r.tiff,void 0,Un):typeof r.tiff=="object"&&this.setupGlobalFilters(r.tiff.pick,r.tiff.skip,Un)}batchEnableWithBool(r,o){for(let c of r)this[c].enabled=o}batchEnableWithUserValue(r,o){for(let c of r){let _=o[c];this[c].enabled=_!==!1&&_!==void 0}}setupGlobalFilters(r,o,c,_=c){if(r&&r.length){for(let x of _)this[x].enabled=!1;let b=dx(r,c);for(let[x,h]of b)pp(this[x].pick,h),this[x].enabled=!0}else if(o&&o.length){let b=dx(o,c);for(let[x,h]of b)pp(this[x].skip,h)}}filterNestedSegmentTags(){let{ifd0:r,exif:o,xmp:c,iptc:_,icc:b}=this;this.makerNote?o.deps.add(37500):o.skip.add(37500),this.userComment?o.deps.add(37510):o.skip.add(37510),c.enabled||r.skip.add(700),_.enabled||r.skip.add(33723),b.enabled||r.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:r,exif:o,gps:c,interop:_}=this;_.needed&&(o.deps.add(40965),r.deps.add(40965)),o.needed&&r.deps.add(34665),c.needed&&r.deps.add(34853),this.tiff.enabled=Un.some(b=>this[b].enabled===!0)||this.makerNote||this.userComment;for(let b of Un)this[b].finalizeFilters()}get onlyTiff(){return!Zc.map(r=>this[r].enabled).some(r=>r===!0)&&this.tiff.enabled}checkLoadedPlugins(){for(let r of Lu)this[r].enabled&&!Jn.has(r)&&uy("segment parser",r)}}function dx(n,r){let o,c,_,b,x=[];for(_ of r){for(b of(o=wi.get(_),c=[],o))(n.includes(b[0])||n.includes(b[1]))&&c.push(b[0]);c.length&&x.push([_,c])}return x}function og(n,r){return n!==void 0?n:r!==void 0?r:void 0}function pp(n,r){for(let o of r)n.add(o)}fr(Fu,"default",aa);class Kl{constructor(r){fr(this,"parsers",{}),fr(this,"output",{}),fr(this,"errors",[]),fr(this,"pushToErrors",o=>this.errors.push(o)),this.options=Fu.useCached(r)}async read(r){this.file=await rT(r,this.options)}setup(){if(this.fileParser)return;let{file:r}=this,o=r.getUint16(0);for(let[c,_]of uo)if(_.canHandle(r,o))return this.fileParser=new _(this.options,this.file,this.parsers),r[c]=!0;this.file.close&&this.file.close(),ei("Unknown file format")}async parse(){let{output:r,errors:o}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),o.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&o.length>0&&(r.errors=o),fp(r)}async executeParsers(){let{output:r}=this;await this.fileParser.parse();let o=Object.values(this.parsers).map(async c=>{let _=await c.parse();c.assignToOutput(r,_)});this.options.silentErrors&&(o=o.map(c=>c.catch(this.pushToErrors))),await Promise.all(o)}async extractThumbnail(){this.setup();let{options:r,file:o}=this,c=Jn.get("tiff",r);var _;if(o.tiff?_={start:0,type:"tiff"}:o.jpeg&&(_=await this.fileParser.getOrFindSegment("tiff")),_===void 0)return;let b=await this.fileParser.ensureSegmentChunk(_),x=this.parsers.tiff=new c(b,r,o),h=await x.extractThumbnail();return o.close&&o.close(),h}}async function Op(n,r){let o=new Kl(r);return await o.read(n),o.parse()}var iT=Object.freeze({__proto__:null,parse:Op,Exifr:Kl,fileParsers:uo,segmentParsers:Jn,fileReaders:co,tagKeys:wi,tagValues:Fs,tagRevivers:Nl,createDictionary:Gn,extendDictionary:zu,fetchUrlAsArrayBuffer:Mu,readBlobAsArrayBuffer:Du,chunkedProps:Il,otherSegments:Zc,segments:Lu,tiffBlocks:Un,segmentsAndBlocks:Pl,tiffExtractables:El,inheritables:Wc,allFormatters:Al,Options:Fu});class Fp{constructor(r,o,c){fr(this,"errors",[]),fr(this,"ensureSegmentChunk",async _=>{let b=_.start,x=_.size||65536;if(this.file.chunked)if(this.file.available(b,x))_.chunk=this.file.subarray(b,x);else try{_.chunk=await this.file.readChunk(b,x)}catch(h){ei(`Couldn't read segment: ${JSON.stringify(_)}. ${h.message}`)}else this.file.byteLength>b+x?_.chunk=this.file.subarray(b,x):_.size===void 0?_.chunk=this.file.subarray(b):ei("Segment unreachable: "+JSON.stringify(_));return _.chunk}),this.extendOptions&&this.extendOptions(r),this.options=r,this.file=o,this.parsers=c}injectSegment(r,o){this.options[r].enabled&&this.createParser(r,o)}createParser(r,o){let c=new(Jn.get(r))(o,this.options,this.file);return this.parsers[r]=c}createParsers(r){for(let o of r){let{type:c,chunk:_}=o,b=this.options[c];if(b&&b.enabled){let x=this.parsers[c];x&&x.append||x||this.createParser(c,_)}}}async readSegments(r){let o=r.map(this.ensureSegmentChunk);await Promise.all(o)}}class zs{static findPosition(r,o){let c=r.getUint16(o+2)+2,_=typeof this.headerLength=="function"?this.headerLength(r,o,c):this.headerLength,b=o+_,x=c-_;return{offset:o,length:c,headerLength:_,start:b,size:x,end:b+x}}static parse(r,o={}){return new this(r,new Fu({[this.type]:o}),r).parse()}normalizeInput(r){return r instanceof ka?r:new ka(r)}constructor(r,o={},c){fr(this,"errors",[]),fr(this,"raw",new Map),fr(this,"handleError",_=>{if(!this.options.silentErrors)throw _;this.errors.push(_.message)}),this.chunk=this.normalizeInput(r),this.file=c,this.type=this.constructor.type,this.globalOptions=this.options=o,this.localOptions=o[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(r,o){let c=Nl.get(o),_=Fs.get(o),b=wi.get(o),x=this.options[o],h=x.reviveValues&&!!c,j=x.translateValues&&!!_,q=x.translateKeys&&!!b,le={};for(let[Y,W]of r)h&&c.has(Y)?W=c.get(Y)(W):j&&_.has(Y)&&(W=this.translateValue(W,_.get(Y))),q&&b.has(Y)&&(Y=b.get(Y)||Y),le[Y]=W;return le}translateValue(r,o){return o[r]||o.DEFAULT||r}assignToOutput(r,o){this.assignObjectToOutput(r,this.constructor.type,o)}assignObjectToOutput(r,o,c){if(this.globalOptions.mergeOutput)return Object.assign(r,c);r[o]?Object.assign(r[o],c):r[o]=c}}fr(zs,"headerLength",4),fr(zs,"type",void 0),fr(zs,"multiSegment",!1),fr(zs,"canHandle",()=>!1);function aT(n){return n===192||n===194||n===196||n===219||n===221||n===218||n===254}function sT(n){return n>=224&&n<=239}function oT(n,r,o){for(let[c,_]of Jn)if(_.canHandle(n,r,o))return c}class fx extends Fp{constructor(...r){super(...r),fr(this,"appSegments",[]),fr(this,"jpegSegments",[]),fr(this,"unknownSegments",[])}static canHandle(r,o){return o===65496}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(r){r===!0?(this.findAll=!0,this.wanted=new Set(Jn.keyList())):(r=r===void 0?Jn.keyList().filter(o=>this.options[o].enabled):r.filter(o=>this.options[o].enabled&&Jn.has(o)),this.findAll=!1,this.remaining=new Set(r),this.wanted=new Set(r)),this.unfinishedMultiSegment=!1}async findAppSegments(r=0,o){this.setupSegmentFinderArgs(o);let{file:c,findAll:_,wanted:b,remaining:x}=this;if(!_&&this.file.chunked&&(_=Array.from(b).some(h=>{let j=Jn.get(h),q=this.options[h];return j.multiSegment&&q.multiSegment}),_&&await this.file.readWhole()),r=this.findAppSegmentsInRange(r,c.byteLength),!this.options.onlyTiff&&c.chunked){let h=!1;for(;x.size>0&&!h&&(c.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:j}=c,q=this.appSegments.some(le=>!this.file.available(le.offset||le.start,le.length||le.size));if(h=r>j&&!q?!await c.readNextChunk(r):!await c.readNextChunk(j),(r=this.findAppSegmentsInRange(r,c.byteLength))===void 0)return}}}findAppSegmentsInRange(r,o){o-=2;let c,_,b,x,h,j,{file:q,findAll:le,wanted:Y,remaining:W,options:$e}=this;for(;r<o;r++)if(q.getUint8(r)===255){if(c=q.getUint8(r+1),sT(c)){if(_=q.getUint16(r+2),b=oT(q,r,_),b&&Y.has(b)&&(x=Jn.get(b),h=x.findPosition(q,r),j=$e[b],h.type=b,this.appSegments.push(h),!le&&(x.multiSegment&&j.multiSegment?(this.unfinishedMultiSegment=h.chunkNumber<h.chunkCount,this.unfinishedMultiSegment||W.delete(b)):W.delete(b),W.size===0)))break;$e.recordUnknownSegments&&(h=zs.findPosition(q,r),h.marker=c,this.unknownSegments.push(h)),r+=_+1}else if(aT(c)){if(_=q.getUint16(r+2),c===218&&$e.stopAfterSos!==!1)return;$e.recordJpegSegments&&this.jpegSegments.push({offset:r,length:_,marker:c}),r+=_+1}}return r}mergeMultiSegments(){if(!this.appSegments.some(o=>o.multiSegment))return;let r=function(o,c){let _,b,x,h=new Map;for(let j=0;j<o.length;j++)_=o[j],b=_[c],h.has(b)?x=h.get(b):h.set(b,x=[]),x.push(_);return Array.from(h)}(this.appSegments,"type");this.mergedAppSegments=r.map(([o,c])=>{let _=Jn.get(o,this.options);return _.handleMultiSegments?{type:o,chunk:_.handleMultiSegments(c)}:c[0]})}getSegment(r){return this.appSegments.find(o=>o.type===r)}async getOrFindSegment(r){let o=this.getSegment(r);return o===void 0&&(await this.findAppSegments(0,[r]),o=this.getSegment(r)),o}}fr(fx,"type","jpeg"),uo.set("jpeg",fx);const lT=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class uT extends zs{parseHeader(){var r=this.chunk.getUint16();r===18761?this.le=!0:r===19789&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(r,o,c=new Map){let{pick:_,skip:b}=this.options[o];_=new Set(_);let x=_.size>0,h=b.size===0,j=this.chunk.getUint16(r);r+=2;for(let q=0;q<j;q++){let le=this.chunk.getUint16(r);if(x){if(_.has(le)&&(c.set(le,this.parseTag(r,le,o)),_.delete(le),_.size===0))break}else!h&&b.has(le)||c.set(le,this.parseTag(r,le,o));r+=12}return c}parseTag(r,o,c){let{chunk:_}=this,b=_.getUint16(r+2),x=_.getUint32(r+4),h=lT[b];if(h*x<=4?r+=8:r=_.getUint32(r+8),(b<1||b>13)&&ei(`Invalid TIFF value type. block: ${c.toUpperCase()}, tag: ${o.toString(16)}, type: ${b}, offset ${r}`),r>_.byteLength&&ei(`Invalid TIFF value offset. block: ${c.toUpperCase()}, tag: ${o.toString(16)}, type: ${b}, offset ${r} is outside of chunk size ${_.byteLength}`),b===1)return _.getUint8Array(r,x);if(b===2)return wu(_.getString(r,x));if(b===7)return _.getUint8Array(r,x);if(x===1)return this.parseTagValue(b,r);{let j=new(function(le){switch(le){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 10:return Array;case 11:return Float32Array;case 12:return Float64Array;default:return Array}}(b))(x),q=h;for(let le=0;le<x;le++)j[le]=this.parseTagValue(b,r),r+=q;return j}}parseTagValue(r,o){let{chunk:c}=this;switch(r){case 1:return c.getUint8(o);case 3:return c.getUint16(o);case 4:return c.getUint32(o);case 5:return c.getUint32(o)/c.getUint32(o+4);case 6:return c.getInt8(o);case 8:return c.getInt16(o);case 9:return c.getInt32(o);case 10:return c.getInt32(o)/c.getInt32(o+4);case 11:return c.getFloat(o);case 12:return c.getDouble(o);case 13:return c.getUint32(o);default:ei(`Invalid tiff type ${r}`)}}}class lg extends uT{static canHandle(r,o){return r.getUint8(o+1)===225&&r.getUint32(o+4)===1165519206&&r.getUint16(o+8)===0}async parse(){this.parseHeader();let{options:r}=this;return r.ifd0.enabled&&await this.parseIfd0Block(),r.exif.enabled&&await this.safeParse("parseExifBlock"),r.gps.enabled&&await this.safeParse("parseGpsBlock"),r.interop.enabled&&await this.safeParse("parseInteropBlock"),r.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(r){let o=this[r]();return o.catch!==void 0&&(o=o.catch(this.handleError)),o}findIfd0Offset(){this.ifd0Offset===void 0&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(this.ifd1Offset===void 0){this.findIfd0Offset();let r=this.chunk.getUint16(this.ifd0Offset),o=this.ifd0Offset+2+12*r;this.ifd1Offset=this.chunk.getUint32(o)}}parseBlock(r,o){let c=new Map;return this[o]=c,this.parseTags(r,o,c),c}async parseIfd0Block(){if(this.ifd0)return;let{file:r}=this;this.findIfd0Offset(),this.ifd0Offset<8&&ei("Malformed EXIF data"),!r.chunked&&this.ifd0Offset>r.byteLength&&ei(`IFD0 offset points to outside of file.
this.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${r.byteLength}`),r.tiff&&await r.ensureChunk(this.ifd0Offset,oy(this.options));let o=this.parseBlock(this.ifd0Offset,"ifd0");return o.size!==0?(this.exifOffset=o.get(34665),this.interopOffset=o.get(40965),this.gpsOffset=o.get(34853),this.xmp=o.get(700),this.iptc=o.get(33723),this.icc=o.get(34675),this.options.sanitize&&(o.delete(34665),o.delete(40965),o.delete(34853),o.delete(700),o.delete(33723),o.delete(34675)),o):void 0}async parseExifBlock(){if(this.exif||(this.ifd0||await this.parseIfd0Block(),this.exifOffset===void 0))return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,oy(this.options));let r=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=r.get(40965)),this.makerNote=r.get(37500),this.userComment=r.get(37510),this.options.sanitize&&(r.delete(40965),r.delete(37500),r.delete(37510)),this.unpack(r,41728),this.unpack(r,41729),r}unpack(r,o){let c=r.get(o);c&&c.length===1&&r.set(o,c[0])}async parseGpsBlock(){if(this.gps||(this.ifd0||await this.parseIfd0Block(),this.gpsOffset===void 0))return;let r=this.parseBlock(this.gpsOffset,"gps");return r&&r.has(2)&&r.has(4)&&(r.set("latitude",px(...r.get(2),r.get(1))),r.set("longitude",px(...r.get(4),r.get(3)))),r}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),this.interopOffset!==void 0||this.exif||await this.parseExifBlock(),this.interopOffset!==void 0))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(r=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||r))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),this.ifd1===void 0)return;let r=this.ifd1.get(513),o=this.ifd1.get(514);return this.chunk.getUint8Array(r,o)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let r,o,c,_={};for(o of Un)if(r=this[o],!Hw(r))if(c=this.canTranslate?this.translateBlock(r,o):Object.fromEntries(r),this.options.mergeOutput){if(o==="ifd1")continue;Object.assign(_,c)}else _[o]=c;return this.makerNote&&(_.makerNote=this.makerNote),this.userComment&&(_.userComment=this.userComment),_}assignToOutput(r,o){if(this.globalOptions.mergeOutput)Object.assign(r,o);else for(let[c,_]of Object.entries(o))this.assignObjectToOutput(r,c,_)}}function px(n,r,o,c){var _=n+r/60+o/3600;return c!=="S"&&c!=="W"||(_*=-1),_}fr(lg,"type","tiff"),fr(lg,"headerLength",10),Jn.set("tiff",lg);var cT=Object.freeze({__proto__:null,default:iT,Exifr:Kl,fileParsers:uo,segmentParsers:Jn,fileReaders:co,tagKeys:wi,tagValues:Fs,tagRevivers:Nl,createDictionary:Gn,extendDictionary:zu,fetchUrlAsArrayBuffer:Mu,readBlobAsArrayBuffer:Du,chunkedProps:Il,otherSegments:Zc,segments:Lu,tiffBlocks:Un,segmentsAndBlocks:Pl,tiffExtractables:El,inheritables:Wc,allFormatters:Al,Options:Fu,parse:Op});const l_={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},u_=Object.assign({},l_,{firstChunkSize:4e4,gps:[1,2,3,4]});async function Xw(n){let r=new Kl(u_);await r.read(n);let o=await r.parse();if(o&&o.gps){let{latitude:c,longitude:_}=o.gps;return{latitude:c,longitude:_}}}const c_=Object.assign({},l_,{tiff:!1,ifd1:!0,mergeOutput:!1});async function Yw(n){let r=new Kl(c_);await r.read(n);let o=await r.extractThumbnail();return o&&Rp?Lp.from(o):o}async function Jw(n){let r=await this.thumbnail(n);if(r!==void 0){let o=new Blob([r]);return URL.createObjectURL(o)}}const h_=Object.assign({},l_,{firstChunkSize:4e4,ifd0:[274]});async function d_(n){let r=new Kl(h_);await r.read(n);let o=await r.parse();if(o&&o.ifd0)return o.ifd0[274]}const f_=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let bu=!0,Su=!0;if(typeof navigator=="object"){let n=navigator.userAgent;if(n.includes("iPad")||n.includes("iPhone")){let r=n.match(/OS (\d+)_(\d+)/);if(r){let[,o,c]=r;bu=Number(o)+.1*Number(c)<13.4,Su=!1}}else if(n.includes("OS X 10")){let[,r]=n.match(/OS X 10[_.](\d+)/);bu=Su=Number(r)<15}if(n.includes("Chrome/")){let[,r]=n.match(/Chrome\/(\d+)/);bu=Su=Number(r)<81}else if(n.includes("Firefox/")){let[,r]=n.match(/Firefox\/(\d+)/);bu=Su=Number(r)<77}}async function Qw(n){let r=await d_(n);return Object.assign({canvas:bu,css:Su},f_[r])}class hT extends ka{constructor(...r){super(...r),fr(this,"ranges",new dT),this.byteLength!==0&&this.ranges.add(0,this.byteLength)}_tryExtend(r,o,c){if(r===0&&this.byteLength===0&&c){let _=new DataView(c.buffer||c,c.byteOffset,c.byteLength);this._swapDataView(_)}else{let _=r+o;if(_>this.byteLength){let{dataView:b}=this._extend(_);this._swapDataView(b)}}}_extend(r){let o;o=Rp?Lp.allocUnsafe(r):new Uint8Array(r);let c=new DataView(o.buffer,o.byteOffset,o.byteLength);return o.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:o,dataView:c}}subarray(r,o,c=!1){return o=o||this._lengthToEnd(r),c&&this._tryExtend(r,o),this.ranges.add(r,o),super.subarray(r,o)}set(r,o,c=!1){c&&this._tryExtend(o,r.byteLength,r);let _=super.set(r,o);return this.ranges.add(o,_.byteLength),_}async ensureChunk(r,o){this.chunked&&(this.ranges.available(r,o)||await this.readChunk(r,o))}available(r,o){return this.ranges.available(r,o)}}class dT{constructor(){fr(this,"list",[])}get length(){return this.list.length}add(r,o,c=0){let _=r+o,b=this.list.filter(x=>mx(r,x.offset,_)||mx(r,x.end,_));if(b.length>0){r=Math.min(r,...b.map(h=>h.offset)),_=Math.max(_,...b.map(h=>h.end)),o=_-r;let x=b.shift();x.offset=r,x.length=o,x.end=_,this.list=this.list.filter(h=>!b.includes(h))}else this.list.push({offset:r,length:o,end:_})}available(r,o){let c=r+o;return this.list.some(_=>_.offset<=r&&c<=_.end)}}function mx(n,r,o){return n<=r&&r<=o}class Bp extends hT{constructor(r,o){super(0),fr(this,"chunksRead",0),this.input=r,this.options=o}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(r=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let o=this.options.chunkSize,c=await this.readChunk(r,o);return!!c&&c.byteLength===o}async readChunk(r,o){if(this.chunksRead++,(o=this.safeWrapAddress(r,o))!==0)return this._readChunk(r,o)}safeWrapAddress(r,o){return this.size!==void 0&&r+o>this.size?Math.max(0,this.size-r):o}get nextChunkOffset(){if(this.ranges.list.length!==0)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return this.size!==void 0&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}co.set("blob",class extends Bp{async readWhole(){this.chunked=!1;let n=await Du(this.input);this._swapArrayBuffer(n)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(n,r){let o=r?n+r:void 0,c=this.input.slice(n,o),_=await Du(c);return this.set(_,n,!0)}});var fT=Object.freeze({__proto__:null,default:cT,Exifr:Kl,fileParsers:uo,segmentParsers:Jn,fileReaders:co,tagKeys:wi,tagValues:Fs,tagRevivers:Nl,createDictionary:Gn,extendDictionary:zu,fetchUrlAsArrayBuffer:Mu,readBlobAsArrayBuffer:Du,chunkedProps:Il,otherSegments:Zc,segments:Lu,tiffBlocks:Un,segmentsAndBlocks:Pl,tiffExtractables:El,inheritables:Wc,allFormatters:Al,Options:Fu,parse:Op,gpsOnlyOptions:u_,gps:Xw,thumbnailOnlyOptions:c_,thumbnail:Yw,thumbnailUrl:Jw,orientationOnlyOptions:h_,orientation:d_,rotations:f_,get rotateCanvas(){return bu},get rotateCss(){return Su},rotation:Qw});co.set("url",class extends Bp{async readWhole(){this.chunked=!1;let n=await Mu(this.input);n instanceof ArrayBuffer?this._swapArrayBuffer(n):n instanceof Uint8Array&&this._swapBuffer(n)}async _readChunk(n,r){let o=r?n+r-1:void 0,c=this.options.httpHeaders||{};(n||o)&&(c.range=`bytes=${[n,o].join("-")}`);let _=await s_(this.input,{headers:c}),b=await _.arrayBuffer(),x=b.byteLength;if(_.status!==416)return x!==r&&(this.size=n+x),this.set(b,n,!0)}});ka.prototype.getUint64=function(n){let r=this.getUint32(n),o=this.getUint32(n+4);return r<1048575?r<<32|o:typeof bf!==void 0?(console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),bf(r)<<bf(32)|bf(o)):void ei("Trying to read 64b value but JS can only handle 53b numbers.")};class pT extends Fp{parseBoxes(r=0){let o=[];for(;r<this.file.byteLength-4;){let c=this.parseBoxHead(r);if(o.push(c),c.length===0)break;r+=c.length}return o}parseSubBoxes(r){r.boxes=this.parseBoxes(r.start)}findBox(r,o){return r.boxes===void 0&&this.parseSubBoxes(r),r.boxes.find(c=>c.kind===o)}parseBoxHead(r){let o=this.file.getUint32(r),c=this.file.getString(r+4,4),_=r+8;return o===1&&(o=this.file.getUint64(r+8),_+=8),{offset:r,length:o,kind:c,start:_}}parseBoxFullHead(r){if(r.version!==void 0)return;let o=this.file.getUint32(r.start);r.version=o>>24,r.start+=4}}class eb extends pT{static canHandle(r,o){if(o!==0)return!1;let c=r.getUint16(2);if(c>50)return!1;let _=16,b=[];for(;_<c;)b.push(r.getString(_,4)),_+=4;return b.includes(this.type)}async parse(){let r=this.file.getUint32(0),o=this.parseBoxHead(r);for(;o.kind!=="meta";)r+=o.length,await this.file.ensureChunk(r,16),o=this.parseBoxHead(r);await this.file.ensureChunk(o.offset,o.length),this.parseBoxFullHead(o),this.parseSubBoxes(o),this.options.icc.enabled&&await this.findIcc(o),this.options.tiff.enabled&&await this.findExif(o)}async registerSegment(r,o,c){await this.file.ensureChunk(o,c);let _=this.file.subarray(o,c);this.createParser(r,_)}async findIcc(r){let o=this.findBox(r,"iprp");if(o===void 0)return;let c=this.findBox(o,"ipco");if(c===void 0)return;let _=this.findBox(c,"colr");_!==void 0&&await this.registerSegment("icc",_.offset+12,_.length)}async findExif(r){let o=this.findBox(r,"iinf");if(o===void 0)return;let c=this.findBox(r,"iloc");if(c===void 0)return;let _=this.findExifLocIdInIinf(o),b=this.findExtentInIloc(c,_);if(b===void 0)return;let[x,h]=b;await this.file.ensureChunk(x,h);let j=4+this.file.getUint32(x);x+=j,h-=j,await this.registerSegment("tiff",x,h)}findExifLocIdInIinf(r){this.parseBoxFullHead(r);let o,c,_,b,x=r.start,h=this.file.getUint16(x);for(x+=2;h--;){if(o=this.parseBoxHead(x),this.parseBoxFullHead(o),c=o.start,o.version>=2&&(_=o.version===3?4:2,b=this.file.getString(c+_+2,4),b==="Exif"))return this.file.getUintBytes(c,_);x+=o.length}}get8bits(r){let o=this.file.getUint8(r);return[o>>4,15&o]}findExtentInIloc(r,o){this.parseBoxFullHead(r);let c=r.start,[_,b]=this.get8bits(c++),[x,h]=this.get8bits(c++),j=r.version===2?4:2,q=r.version===1||r.version===2?2:0,le=h+_+b,Y=r.version===2?4:2,W=this.file.getUintBytes(c,Y);for(c+=Y;W--;){let $e=this.file.getUintBytes(c,j);c+=j+q+2+x;let He=this.file.getUint16(c);if(c+=2,$e===o)return He>1&&console.warn(`ILOC box has more than one extent but we're only processing one
Please create an issue at https://github.com/MikeKovarik/exifr with this file`),[this.file.getUintBytes(c+h,_),this.file.getUintBytes(c+h+_,b)];c+=He*le}}}class tb extends eb{}fr(tb,"type","heic");class gx extends eb{}fr(gx,"type","avif"),uo.set("heic",tb),uo.set("avif",gx),Gn(wi,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),Gn(wi,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),Gn(wi,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),Gn(Fs,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);let nd=Gn(Fs,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]);const yx={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};nd.set(37392,yx),nd.set(41488,yx);const ug={0:"Normal",1:"Low",2:"High"};function _x(n){return typeof n=="object"&&n.length!==void 0?n[0]:n}function vx(n){let r=Array.from(n).slice(1);return r[1]>15&&(r=r.map(o=>String.fromCharCode(o))),r[2]!=="0"&&r[2]!==0||r.pop(),r.join(".")}function cg(n){if(typeof n=="string"){var[r,o,c,_,b,x]=n.trim().split(/[-: ]/g).map(Number),h=new Date(r,o-1,c);return Number.isNaN(_)||Number.isNaN(b)||Number.isNaN(x)||(h.setHours(_),h.setMinutes(b),h.setSeconds(x)),Number.isNaN(+h)?n:h}}function $h(n){if(typeof n=="string")return n;let r=[];if(n[1]===0&&n[n.length-1]===0)for(let o=0;o<n.length;o+=2)r.push(xx(n[o+1],n[o]));else for(let o=0;o<n.length;o+=2)r.push(xx(n[o],n[o+1]));return wu(String.fromCodePoint(...r))}function xx(n,r){return n<<8|r}nd.set(41992,ug),nd.set(41993,ug),nd.set(41994,ug),Gn(Nl,["ifd0","ifd1"],[[50827,function(n){return typeof n!="string"?Zw(n):n}],[306,cg],[40091,$h],[40092,$h],[40093,$h],[40094,$h],[40095,$h]]),Gn(Nl,"exif",[[40960,vx],[36864,vx],[36867,cg],[36868,cg],[40962,_x],[40963,_x]]),Gn(Nl,"gps",[[0,n=>Array.from(n).join(".")],[7,n=>Array.from(n).join(":")]]);class hg extends zs{static canHandle(r,o){return r.getUint8(o+1)===225&&r.getUint32(o+4)===1752462448&&r.getString(o+4,20)==="http://ns.adobe.com/"}static headerLength(r,o){return r.getString(o+4,34)==="http://ns.adobe.com/xmp/extension/"?79:33}static findPosition(r,o){let c=super.findPosition(r,o);return c.multiSegment=c.extended=c.headerLength===79,c.multiSegment?(c.chunkCount=r.getUint8(o+72),c.chunkNumber=r.getUint8(o+76),r.getUint8(o+77)!==0&&c.chunkNumber++):(c.chunkCount=1/0,c.chunkNumber=-1),c}static handleMultiSegments(r){return r.map(o=>o.chunk.getString()).join("")}normalizeInput(r){return typeof r=="string"?r:ka.from(r).getString()}parse(r=this.chunk){if(!this.localOptions.parse)return r;r=function(b){let x={},h={};for(let j of ab)x[j]=[],h[j]=0;return b.replace(_T,(j,q,le)=>{if(q==="<"){let Y=++h[le];return x[le].push(Y),`${j}#${Y}`}return`${j}#${x[le].pop()}`})}(r);let o=Fc.findAll(r,"rdf","Description");o.length===0&&o.push(new Fc("rdf","Description",void 0,r));let c,_={};for(let b of o)for(let x of b.properties)c=yT(x.ns,_),rb(x,c);return function(b){let x;for(let h in b)x=b[h]=fp(b[h]),x===void 0&&delete b[h];return fp(b)}(_)}assignToOutput(r,o){if(this.localOptions.parse)for(let[c,_]of Object.entries(o))switch(c){case"tiff":this.assignObjectToOutput(r,"ifd0",_);break;case"exif":this.assignObjectToOutput(r,"exif",_);break;case"xmlns":break;default:this.assignObjectToOutput(r,c,_)}else r.xmp=o}}fr(hg,"type","xmp"),fr(hg,"multiSegment",!0),Jn.set("xmp",hg);class mp{static findAll(r){return nb(r,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(mp.unpackMatch)}static unpackMatch(r){let o=r[1],c=r[2],_=r[3].slice(1,-1);return _=ib(_),new mp(o,c,_)}constructor(r,o,c){this.ns=r,this.name=o,this.value=c}serialize(){return this.value}}class Fc{static findAll(r,o,c){if(o!==void 0||c!==void 0){o=o||"[\\w\\d-]+",c=c||"[\\w\\d-]+";var _=new RegExp(`<(${o}):(${c})(#\\d+)?((\\s+?[\\w\\d-:]+=("[^"]*"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)`,"gm")}else _=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return nb(r,_).map(Fc.unpackMatch)}static unpackMatch(r){let o=r[1],c=r[2],_=r[4],b=r[8];return new Fc(o,c,_,b)}constructor(r,o,c,_){this.ns=r,this.name=o,this.attrString=c,this.innerXml=_,this.attrs=mp.findAll(c),this.children=Fc.findAll(_),this.value=this.children.length===0?ib(_):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return this.value!==void 0&&this.attrs.length===0&&this.children.length===0}get isListContainer(){return this.children.length===1&&this.children[0].isList}get isList(){let{ns:r,name:o}=this;return r==="rdf"&&(o==="Seq"||o==="Bag"||o==="Alt")}get isListItem(){return this.ns==="rdf"&&this.name==="li"}serialize(){if(this.properties.length===0&&this.value===void 0)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return gT(this.children.map(mT));if(this.isListItem&&this.children.length===1&&this.attrs.length===0)return this.children[0].serialize();let r={};for(let o of this.properties)rb(o,r);return this.value!==void 0&&(r.value=this.value),fp(r)}}function rb(n,r){let o=n.serialize();o!==void 0&&(r[n.name]=o)}var mT=n=>n.serialize(),gT=n=>n.length===1?n[0]:n,yT=(n,r)=>r[n]?r[n]:r[n]={};function nb(n,r){let o,c=[];if(!n)return c;for(;(o=r.exec(n))!==null;)c.push(o);return c}function ib(n){if(function(c){return c==null||c==="null"||c==="undefined"||c===""||c.trim()===""}(n))return;let r=Number(n);if(!Number.isNaN(r))return r;let o=n.toLowerCase();return o==="true"||o!=="false"&&n.trim()}const ab=["rdf:li","rdf:Seq","rdf:Bag","rdf:Alt","rdf:Description"],_T=new RegExp(`(<|\\/)(${ab.join("|")})`,"g");var vT=Object.freeze({__proto__:null,default:fT,Exifr:Kl,fileParsers:uo,segmentParsers:Jn,fileReaders:co,tagKeys:wi,tagValues:Fs,tagRevivers:Nl,createDictionary:Gn,extendDictionary:zu,fetchUrlAsArrayBuffer:Mu,readBlobAsArrayBuffer:Du,chunkedProps:Il,otherSegments:Zc,segments:Lu,tiffBlocks:Un,segmentsAndBlocks:Pl,tiffExtractables:El,inheritables:Wc,allFormatters:Al,Options:Fu,parse:Op,gpsOnlyOptions:u_,gps:Xw,thumbnailOnlyOptions:c_,thumbnail:Yw,thumbnailUrl:Jw,orientationOnlyOptions:h_,orientation:d_,rotations:f_,get rotateCanvas(){return bu},get rotateCss(){return Su},rotation:Qw});let wx=dp("fs",n=>n.promises);co.set("fs",class extends Bp{async readWhole(){this.chunked=!1,this.fs=await wx;let n=await this.fs.readFile(this.input);this._swapBuffer(n)}async readChunked(){this.chunked=!0,this.fs=await wx,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){this.fh===void 0&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(n,r){this.fh===void 0&&await this.open(),n+r>this.size&&(r=this.size-n);var o=this.subarray(n,r,!0);return await this.fh.read(o.dataView,0,r,n),o}async close(){if(this.fh){let n=this.fh;this.fh=void 0,await n.close()}}});co.set("base64",class extends Bp{constructor(...n){super(...n),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(n,r){let o,c,_=this.input;n===void 0?(n=0,o=0,c=0):(o=4*Math.floor(n/3),c=n-o/4*3),r===void 0&&(r=this.size);let b=n+r,x=o+4*Math.ceil(b/3);_=_.slice(o,x);let h=Math.min(r,this.size-n);if(Rp){let j=Lp.from(_,"base64").slice(c,c+h);return this.set(j,n,!0)}{let j=this.subarray(n,h,!0),q=atob(_),le=j.toUint8();for(let Y=0;Y<h;Y++)le[Y]=q.charCodeAt(c+Y);return j}}});class bx extends Fp{static canHandle(r,o){return o===18761||o===19789}extendOptions(r){let{ifd0:o,xmp:c,iptc:_,icc:b}=r;c.enabled&&o.deps.add(700),_.enabled&&o.deps.add(33723),b.enabled&&o.deps.add(34675),o.finalizeFilters()}async parse(){let{tiff:r,xmp:o,iptc:c,icc:_}=this.options;if(r.enabled||o.enabled||c.enabled||_.enabled){let b=Math.max(oy(this.options),this.options.chunkSize);await this.file.ensureChunk(0,b),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(r){if(this.parsers.tiff[r]){let o=this.parsers.tiff[r];this.injectSegment(r,o)}}}fr(bx,"type","tiff"),uo.set("tiff",bx);let xT=dp("zlib");const wT=["ihdr","iccp","text","itxt","exif"];class Sx extends Fp{constructor(...r){super(...r),fr(this,"catchError",o=>this.errors.push(o)),fr(this,"metaChunks",[]),fr(this,"unknownChunks",[])}static canHandle(r,o){return o===35152&&r.getUint32(0)===2303741511&&r.getUint32(4)===218765834}async parse(){let{file:r}=this;await this.findPngChunksInRange(8,r.byteLength),await this.readSegments(this.metaChunks),this.findIhdr(),this.parseTextChunks(),await this.findExif().catch(this.catchError),await this.findXmp().catch(this.catchError),await this.findIcc().catch(this.catchError)}async findPngChunksInRange(r,o){let{file:c}=this;for(;r<o;){let _=c.getUint32(r),b=c.getUint32(r+4),x=c.getString(r+4,4).toLowerCase(),h=_+4+4+4,j={type:x,offset:r,length:h,start:r+4+4,size:_,marker:b};wT.includes(x)?this.metaChunks.push(j):this.unknownChunks.push(j),r+=h}}parseTextChunks(){let r=this.metaChunks.filter(o=>o.type==="text");for(let o of r){let[c,_]=this.file.getString(o.start,o.size).split("\0");this.injectKeyValToIhdr(c,_)}}injectKeyValToIhdr(r,o){let c=this.parsers.ihdr;c&&c.raw.set(r,o)}findIhdr(){let r=this.metaChunks.find(o=>o.type==="ihdr");r&&this.options.ihdr.enabled!==!1&&this.createParser("ihdr",r.chunk)}async findExif(){let r=this.metaChunks.find(o=>o.type==="exif");r&&this.injectSegment("tiff",r.chunk)}async findXmp(){let r=this.metaChunks.filter(o=>o.type==="itxt");for(let o of r)o.chunk.getString(0,17)==="XML:com.adobe.xmp"&&this.injectSegment("xmp",o.chunk)}async findIcc(){let r=this.metaChunks.find(h=>h.type==="iccp");if(!r)return;let{chunk:o}=r,c=o.getUint8Array(0,81),_=0;for(;_<80&&c[_]!==0;)_++;let b=_+2,x=o.getString(0,_);if(this.injectKeyValToIhdr("ProfileName",x),hp){let h=await xT,j=o.getUint8Array(b);j=h.inflateSync(j),this.injectSegment("icc",j)}}}fr(Sx,"type","png"),uo.set("png",Sx),Gn(wi,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),zu(wi,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);let kx=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];zu(wi,"ifd0",kx),zu(wi,"exif",kx),Gn(Fs,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);class dg extends zs{static canHandle(r,o){return r.getUint8(o+1)===224&&r.getUint32(o+4)===1246120262&&r.getUint8(o+8)===0}parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint16(0)],[2,this.chunk.getUint8(2)],[3,this.chunk.getUint16(3)],[5,this.chunk.getUint16(5)],[7,this.chunk.getUint8(7)],[8,this.chunk.getUint8(8)]])}}fr(dg,"type","jfif"),fr(dg,"headerLength",9),Jn.set("jfif",dg),Gn(wi,"jfif",[[0,"JFIFVersion"],[2,"ResolutionUnit"],[3,"XResolution"],[5,"YResolution"],[7,"ThumbnailWidth"],[8,"ThumbnailHeight"]]);class Cx extends zs{parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint32(0)],[4,this.chunk.getUint32(4)],[8,this.chunk.getUint8(8)],[9,this.chunk.getUint8(9)],[10,this.chunk.getUint8(10)],[11,this.chunk.getUint8(11)],[12,this.chunk.getUint8(12)],...Array.from(this.raw)])}}fr(Cx,"type","ihdr"),Jn.set("ihdr",Cx),Gn(wi,"ihdr",[[0,"ImageWidth"],[4,"ImageHeight"],[8,"BitDepth"],[9,"ColorType"],[10,"Compression"],[11,"Filter"],[12,"Interlace"]]),Gn(Fs,"ihdr",[[9,{0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha",DEFAULT:"Unknown"}],[10,{0:"Deflate/Inflate",DEFAULT:"Unknown"}],[11,{0:"Adaptive",DEFAULT:"Unknown"}],[12,{0:"Noninterlaced",1:"Adam7 Interlace",DEFAULT:"Unknown"}]]);class Bf extends zs{static canHandle(r,o){return r.getUint8(o+1)===226&&r.getUint32(o+4)===1229144927}static findPosition(r,o){let c=super.findPosition(r,o);return c.chunkNumber=r.getUint8(o+16),c.chunkCount=r.getUint8(o+17),c.multiSegment=c.chunkCount>1,c}static handleMultiSegments(r){return function(o){let c=function(_){let b=_[0].constructor,x=0;for(let q of _)x+=q.length;let h=new b(x),j=0;for(let q of _)h.set(q,j),j+=q.length;return h}(o.map(_=>_.chunk.toUint8()));return new ka(c)}(r)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:r}=this;this.chunk.byteLength<84&&ei("ICC header is too short");for(let[o,c]of Object.entries(bT)){o=parseInt(o,10);let _=c(this.chunk,o);_!=="\0\0\0\0"&&r.set(o,_)}}parseTags(){let r,o,c,_,b,{raw:x}=this,h=this.chunk.getUint32(128),j=132,q=this.chunk.byteLength;for(;h--;){if(r=this.chunk.getString(j,4),o=this.chunk.getUint32(j+4),c=this.chunk.getUint32(j+8),_=this.chunk.getString(o,4),o+c>q)return void console.warn("reached the end of the first ICC chunk. Enable options.tiff.multiSegment to read all ICC segments.");b=this.parseTag(_,o,c),b!==void 0&&b!=="\0\0\0\0"&&x.set(r,b),j+=12}}parseTag(r,o,c){switch(r){case"desc":return this.parseDesc(o);case"mluc":return this.parseMluc(o);case"text":return this.parseText(o,c);case"sig ":return this.parseSig(o)}if(!(o+c>this.chunk.byteLength))return this.chunk.getUint8Array(o,c)}parseDesc(r){let o=this.chunk.getUint32(r+8)-1;return wu(this.chunk.getString(r+12,o))}parseText(r,o){return wu(this.chunk.getString(r+8,o-8))}parseSig(r){return wu(this.chunk.getString(r+8,4))}parseMluc(r){let{chunk:o}=this,c=o.getUint32(r+8),_=o.getUint32(r+12),b=r+16,x=[];for(let h=0;h<c;h++){let j=o.getString(b+0,2),q=o.getString(b+2,2),le=o.getUint32(b+4),Y=o.getUint32(b+8)+r,W=wu(o.getUnicodeString(Y,le));x.push({lang:j,country:q,text:W}),b+=_}return c===1?x[0].text:x}translateValue(r,o){return typeof r=="string"?o[r]||o[r.toLowerCase()]||r:o[r]||r}}fr(Bf,"type","icc"),fr(Bf,"multiSegment",!0),fr(Bf,"headerLength",18);const bT={4:zo,8:function(n,r){return[n.getUint8(r),n.getUint8(r+1)>>4,n.getUint8(r+1)%16].map(o=>o.toString(10)).join(".")},12:zo,16:zo,20:zo,24:function(n,r){const o=n.getUint16(r),c=n.getUint16(r+2)-1,_=n.getUint16(r+4),b=n.getUint16(r+6),x=n.getUint16(r+8),h=n.getUint16(r+10);return new Date(Date.UTC(o,c,_,b,x,h))},36:zo,40:zo,48:zo,52:zo,64:(n,r)=>n.getUint32(r),80:zo};function zo(n,r){return wu(n.getString(r,4))}Jn.set("icc",Bf),Gn(wi,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);const Sf={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},Tx={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};Gn(Fs,"icc",[[4,Sf],[12,Tx],[40,Object.assign({},Sf,Tx)],[48,Sf],[80,Sf],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);class kf extends zs{static canHandle(r,o,c){return r.getUint8(o+1)===237&&r.getString(o+4,9)==="Photoshop"&&this.containsIptc8bim(r,o,c)!==void 0}static headerLength(r,o,c){let _,b=this.containsIptc8bim(r,o,c);if(b!==void 0)return _=r.getUint8(o+b+7),_%2!=0&&(_+=1),_===0&&(_=4),b+8+_}static containsIptc8bim(r,o,c){for(let _=0;_<c;_++)if(this.isIptcSegmentHead(r,o+_))return _}static isIptcSegmentHead(r,o){return r.getUint8(o)===56&&r.getUint32(o)===943868237&&r.getUint16(o+4)===1028}parse(){let{raw:r}=this,o=this.chunk.byteLength-1,c=!1;for(let _=0;_<o;_++)if(this.chunk.getUint8(_)===28&&this.chunk.getUint8(_+1)===2){c=!0;let b=this.chunk.getUint16(_+3),x=this.chunk.getUint8(_+2),h=this.chunk.getLatin1String(_+5,b);r.set(x,this.pluralizeValue(r.get(x),h)),_+=4+b}else if(c)break;return this.translate(),this.output}pluralizeValue(r,o){return r!==void 0?r instanceof Array?(r.push(o),r):[r,o]:o}}fr(kf,"type","iptc"),fr(kf,"translateValues",!1),fr(kf,"reviveValues",!1),Jn.set("iptc",kf),Gn(wi,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),Gn(Fs,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);let Cf;const ST=new Uint8Array(16);function kT(){if(!Cf&&(Cf=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Cf))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Cf(ST)}const Ei=[];for(let n=0;n<256;++n)Ei.push((n+256).toString(16).slice(1));function CT(n,r=0){return Ei[n[r+0]]+Ei[n[r+1]]+Ei[n[r+2]]+Ei[n[r+3]]+"-"+Ei[n[r+4]]+Ei[n[r+5]]+"-"+Ei[n[r+6]]+Ei[n[r+7]]+"-"+Ei[n[r+8]]+Ei[n[r+9]]+"-"+Ei[n[r+10]]+Ei[n[r+11]]+Ei[n[r+12]]+Ei[n[r+13]]+Ei[n[r+14]]+Ei[n[r+15]]}const TT=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ix={randomUUID:TT};function sb(n,r,o){if(Ix.randomUUID&&!n)return Ix.randomUUID();n=n||{};const c=n.random||(n.rng||kT)();return c[6]=c[6]&15|64,c[8]=c[8]&63|128,CT(c)}class IT{async processImage(r){const o=sb(),c=await this.extractExif(r);await qa.images.add({id:o,blob:r,createdAt:new Date().toISOString()});const _=await this.generateThumbnail(r);return{blobId:o,exif:c,thumbnail:_}}async extractExif(r){try{const o=await vT.parse(r,{gps:!0,xmp:!1,icc:!1,iptc:!1,jfif:!1,ihdr:!1,pick:["DateTimeOriginal","CreateDate","ModifyDate","GPSLatitude","GPSLongitude","GPSAltitude","Orientation","Make","Model"]});if(!o)return{};const c={},_=o.DateTimeOriginal||o.CreateDate||o.ModifyDate;return _&&(c.timestamp=_ instanceof Date?_.toISOString():String(_)),o.latitude!==void 0&&o.longitude!==void 0?(c.lat=o.latitude,c.lon=o.longitude):o.GPSLatitude!==void 0&&o.GPSLongitude!==void 0&&(c.lat=o.GPSLatitude,c.lon=o.GPSLongitude),o.Orientation&&(c.orientation=o.Orientation),(o.Make||o.Model)&&(c.make=o.Make,c.camera=o.Model),c}catch(o){return console.warn("EXIF extraction failed:",o),{}}}async generateThumbnail(r,o=200){return new Promise((c,_)=>{const b=new Image,x=URL.createObjectURL(r);b.onload=()=>{URL.revokeObjectURL(x);const h=document.createElement("canvas"),j=h.getContext("2d");if(!j){_(new Error("Could not get canvas context"));return}let q=b.width,le=b.height;q>le?q>o&&(le=le*o/q,q=o):le>o&&(q=q*o/le,le=o),h.width=q,h.height=le,j.drawImage(b,0,0,q,le),c(h.toDataURL("image/jpeg",.7))},b.onerror=()=>{URL.revokeObjectURL(x),_(new Error("Failed to load image"))},b.src=x})}async getImageUrl(r){const o=await qa.images.get(r);return o?URL.createObjectURL(o.blob):null}async captureFromCamera(){return new Promise(r=>{const o=document.createElement("input");o.type="file",o.accept="image/*",o.capture="environment",o.onchange=c=>{const b=c.target.files?.[0];r(b||null)},o.click()})}async selectFromGallery(){return new Promise(r=>{const o=document.createElement("input");o.type="file",o.accept="image/*",o.onchange=c=>{const b=c.target.files?.[0];r(b||null)},o.click()})}}const yu=new IT,PT=({onGoToLocation:n})=>{const[r,o]=Kt.useState("all"),[c,_]=Kt.useState({}),b=GC(async()=>{let q=qa.observations.orderBy("timestamp").reverse();return r!=="all"&&(q=qa.observations.where("userValidation").equals(r).reverse()),await q.limit(50).toArray()},[r]);Kt.useEffect(()=>{b&&b.forEach(async q=>{if(q.image?.blobId&&!c[q.image.blobId]){const le=q.image.thumbnail||await yu.getImageUrl(q.image.blobId);le&&_(Y=>({...Y,[q.image.blobId]:le}))}})},[b,c]);const x=Kt.useCallback(async q=>{if(!b||b.length===0){alert("No observations to export");return}let le,Y,W;q==="geojson"?(le=await XC(b),Y=`wg_observations_${new Date().toISOString().split("T")[0]}.geojson`,W="application/json"):(le=await YC(b),Y=`wg_observations_${new Date().toISOString().split("T")[0]}.csv`,W="text/csv");const $e=new Blob([le],{type:W}),He=URL.createObjectURL($e),Je=document.createElement("a");Je.href=He,Je.download=Y,Je.click(),URL.revokeObjectURL(He)},[b]),h=q=>new Date(q).toLocaleString("en-IN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),j=q=>{switch(q){case"match":return" Match";case"mismatch":return" Mismatch";case"unclear":return" Unclear"}};return Ue.jsxs("div",{className:"field-log",children:[Ue.jsxs("div",{className:"field-log-filters",children:[Ue.jsx("button",{className:`filter-chip ${r==="all"?"active":""}`,onClick:()=>o("all"),children:"All"}),Ue.jsx("button",{className:`filter-chip ${r==="match"?"active":""}`,onClick:()=>o("match"),children:" Match"}),Ue.jsx("button",{className:`filter-chip ${r==="mismatch"?"active":""}`,onClick:()=>o("mismatch"),children:" Mismatch"}),Ue.jsx("button",{className:`filter-chip ${r==="unclear"?"active":""}`,onClick:()=>o("unclear"),children:" Unclear"})]}),b?b.length===0?Ue.jsxs("div",{className:"empty-state",children:[Ue.jsx("div",{className:"empty-state-icon",children:""}),Ue.jsx("p",{className:"empty-state-text",children:"No observations yet. Use the capture button to add field observations."})]}):Ue.jsxs(Ue.Fragment,{children:[b.map(q=>Ue.jsxs("div",{className:"log-entry",onClick:()=>n(q.location.lat,q.location.lon),children:[Ue.jsx("div",{className:"log-entry-thumb",children:q.image?.blobId&&c[q.image.blobId]?Ue.jsx("img",{src:c[q.image.blobId],alt:"Observation"}):Ue.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",fontSize:"24px",color:"var(--text-muted)"},children:""})}),Ue.jsxs("div",{className:"log-entry-info",children:[Ue.jsxs("div",{className:"log-entry-time",children:[h(q.timestamp),Ue.jsx("span",{className:`log-entry-validation ${q.userValidation}`,children:j(q.userValidation)})]}),Ue.jsxs("div",{className:"log-entry-location",children:[" ",q.location.lat.toFixed(5),", ",q.location.lon.toFixed(5)]}),Ue.jsxs("div",{className:"log-entry-datasets",children:[Object.keys(q.datasetValues).length," layers queried",q.notes&&`  ${q.notes.substring(0,30)}${q.notes.length>30?"...":""}`]})]})]},q.id)),Ue.jsxs("div",{className:"export-buttons",children:[Ue.jsx("button",{className:"export-btn",onClick:()=>x("geojson"),children:" Export GeoJSON"}),Ue.jsx("button",{className:"export-btn",onClick:()=>x("csv"),children:" Export CSV"})]})]}):Ue.jsx("div",{className:"loading",children:Ue.jsx("div",{className:"loading-spinner"})})]})};class ob{watchId=null;lastPosition=null;async getCurrentPosition(){return new Promise((r,o)=>{if(!navigator.geolocation){o(new Error("Geolocation not supported"));return}navigator.geolocation.getCurrentPosition(c=>{const _={lat:c.coords.latitude,lon:c.coords.longitude,accuracy:c.coords.accuracy,timestamp:c.timestamp};this.lastPosition=_,r(_)},c=>{o(this.handleError(c))},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})})}watchPosition(r){if(!navigator.geolocation){console.error("Geolocation not supported");return}this.watchId=navigator.geolocation.watchPosition(o=>{const c={lat:o.coords.latitude,lon:o.coords.longitude,accuracy:o.coords.accuracy,timestamp:o.timestamp};this.lastPosition=c,r(c)},o=>{console.error("Watch position error:",this.handleError(o))},{enableHighAccuracy:!0,timeout:15e3,maximumAge:5e3})}stopWatching(){this.watchId!==null&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null)}getLastPosition(){return this.lastPosition}handleError(r){switch(r.code){case r.PERMISSION_DENIED:return new Error("Location permission denied. Please enable GPS access.");case r.POSITION_UNAVAILABLE:return new Error("Location unavailable. Please check GPS settings.");case r.TIMEOUT:return new Error("Location request timed out. Please try again.");default:return new Error("Unknown location error")}}static calculateDistance(r,o,c,_){const x=r*Math.PI/180,h=c*Math.PI/180,j=(c-r)*Math.PI/180,q=(_-o)*Math.PI/180,le=Math.sin(j/2)*Math.sin(j/2)+Math.cos(x)*Math.cos(h)*Math.sin(q/2)*Math.sin(q/2);return 6371e3*(2*Math.atan2(Math.sqrt(le),Math.sqrt(1-le)))}static createBoundingBox(r,o,c){const _=c/111320,b=c/(111320*Math.cos(r*Math.PI/180));return{minLat:r-_,maxLat:r+_,minLon:o-b,maxLon:o+b}}}const ET=({currentLocation:n,getDatasetValues:r,onCapture:o,onClose:c})=>{const[_,b]=Kt.useState(n),[x,h]=Kt.useState(null),[j,q]=Kt.useState(null),[le,Y]=Kt.useState({}),[W,$e]=Kt.useState(null),[He,Je]=Kt.useState(""),[Qt,be]=Kt.useState(!1),[pe,ke]=Kt.useState(!1),[Ve,et]=Kt.useState(!1);Kt.useEffect(()=>{_||(et(!0),new ob().getCurrentPosition().then(Le=>b(Le)).catch(console.error).finally(()=>et(!1)))},[_]),Kt.useEffect(()=>{_&&r(_.lat,_.lon).then(Y).catch(console.error)},[_,r]);const ut=Kt.useCallback(async()=>{ke(!0);try{const me=await yu.captureFromCamera();if(me){const Le=await yu.processImage(me);if(h(Le),Le.exif.lat&&Le.exif.lon&&b({lat:Le.exif.lat,lon:Le.exif.lon,accuracy:0,timestamp:Date.now()}),Le.thumbnail)q(Le.thumbnail);else{const Ye=await yu.getImageUrl(Le.blobId);q(Ye)}}}catch(me){console.error("Capture failed:",me)}finally{ke(!1)}},[]),Qe=Kt.useCallback(async()=>{ke(!0);try{const me=await yu.selectFromGallery();if(me){const Le=await yu.processImage(me);if(h(Le),Le.exif.lat&&Le.exif.lon&&b({lat:Le.exif.lat,lon:Le.exif.lon,accuracy:0,timestamp:Date.now()}),Le.thumbnail)q(Le.thumbnail);else{const Ye=await yu.getImageUrl(Le.blobId);q(Ye)}}}catch(me){console.error("Gallery selection failed:",me)}finally{ke(!1)}},[]),ce=Kt.useCallback(()=>{if(!W||!_)return;const me={id:sb(),timestamp:new Date().toISOString(),location:_,context:{region:"Western Ghats",areaMode:"point"},datasetValues:le,image:x||void 0,userValidation:W,notes:He,synced:!1};o(me)},[W,_,le,x,He,o]);return Ue.jsxs("div",{className:"capture-modal",children:[Ue.jsxs("div",{className:"capture-modal-header",children:[Ue.jsx("h3",{children:" Capture Observation"}),Ue.jsx("button",{className:"bottom-sheet-close",onClick:c,children:""})]}),Ue.jsxs("div",{className:"capture-modal-content",children:[Ue.jsx("div",{className:"photo-preview",onClick:j?void 0:ut,children:pe?Ue.jsx("div",{className:"loading",children:Ue.jsx("div",{className:"loading-spinner"})}):j?Ue.jsx("img",{src:j,alt:"Captured"}):Ue.jsxs("div",{className:"photo-preview-placeholder",children:[Ue.jsx("span",{children:""}),Ue.jsx("p",{children:"Tap to capture photo"})]})}),!j&&!pe&&Ue.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"16px"},children:[Ue.jsx("button",{onClick:ut,style:{flex:1,padding:"10px",background:"var(--accent)",border:"none",borderRadius:"8px",color:"white",cursor:"pointer"},children:" Camera"}),Ue.jsx("button",{onClick:Qe,style:{flex:1,padding:"10px",background:"var(--bg-tertiary)",border:"1px solid var(--border)",borderRadius:"8px",color:"var(--text-primary)",cursor:"pointer"},children:" Gallery"})]}),Ue.jsxs("div",{style:{marginBottom:"16px"},children:[Ue.jsx("div",{className:"dataset-values-title",children:"Location"}),Ve?Ue.jsx("div",{style:{color:"var(--text-muted)",fontSize:"13px"},children:"Getting location..."}):_?Ue.jsxs("div",{className:"dataset-value-row",children:[Ue.jsx("span",{className:"dataset-value-layer",children:"Coordinates"}),Ue.jsxs("span",{className:"dataset-value-data",children:[_.lat.toFixed(6),", ",_.lon.toFixed(6),_.accuracy>0&&` (${Math.round(_.accuracy)}m)`]})]}):Ue.jsx("div",{style:{color:"var(--error)",fontSize:"13px"},children:"Location unavailable"})]}),Ue.jsxs("div",{className:"dataset-values",children:[Ue.jsx("div",{className:"dataset-values-title",children:"Dataset Values at Location"}),Object.keys(le).length>0?Object.entries(le).map(([me,Le])=>Ue.jsxs("div",{className:"dataset-value-row",children:[Ue.jsx("span",{className:"dataset-value-layer",children:me}),Ue.jsx("span",{className:"dataset-value-data",children:AT(Le)})]},me)):Ue.jsx("div",{style:{color:"var(--text-muted)",fontSize:"13px",padding:"8px 0"},children:"No active layers or data at this location"})]}),Ue.jsx("div",{className:"dataset-values-title",style:{marginTop:"16px",marginBottom:"8px"},children:"Validation"}),Ue.jsxs("div",{className:"validation-buttons",children:[Ue.jsxs("button",{className:`validation-btn match ${W==="match"?"selected":""}`,onClick:()=>$e("match"),children:[Ue.jsx("span",{children:""}),"Match"]}),Ue.jsxs("button",{className:`validation-btn mismatch ${W==="mismatch"?"selected":""}`,onClick:()=>$e("mismatch"),children:[Ue.jsx("span",{children:""}),"Mismatch"]}),Ue.jsxs("button",{className:`validation-btn unclear ${W==="unclear"?"selected":""}`,onClick:()=>$e("unclear"),children:[Ue.jsx("span",{children:""}),"Unclear"]})]}),Ue.jsxs("div",{className:"notes-section",children:[Ue.jsxs("div",{className:"notes-toggle",onClick:()=>be(!Qt),children:[" ",Qt?"Hide notes":"Add notes (optional)"]}),Qt&&Ue.jsx("textarea",{className:"notes-input",placeholder:"Add observation notes...",value:He,onChange:me=>Je(me.target.value)})]}),Ue.jsx("button",{className:"submit-btn",disabled:!W||!_,onClick:ce,children:"Save Observation"})]})]})};function AT(n){if(!n||Object.keys(n).length===0)return"No data";if(n._source==="csv_summary"){const o=n._year,c=n._recordCount;return o?`${o} (${c} records)`:`${c} records`}const r=Object.entries(n).filter(([o])=>!o.startsWith("_"));return r.length===0?"No data":r.slice(0,2).map(([,o])=>String(o)).join(", ")}function MT(){const n=()=>navigator.connection||navigator.mozConnection||navigator.webkitConnection,r=Kt.useCallback(()=>{const _=n();return{isOnline:navigator.onLine,effectiveType:_?.effectiveType,downlink:_?.downlink,rtt:_?.rtt,saveData:_?.saveData}},[]),[o,c]=Kt.useState(r);return Kt.useEffect(()=>{const _=()=>c(r()),b=()=>c(r()),x=()=>c(r());window.addEventListener("online",_),window.addEventListener("offline",b);const h=n();return h&&h.addEventListener("change",x),()=>{window.removeEventListener("online",_),window.removeEventListener("offline",b),h&&h.removeEventListener("change",x)}},[r]),o}function DT(n){if(!n.isOnline)return"offline";if(!n.effectiveType)return"good";switch(n.effectiveType){case"4g":return"excellent";case"3g":return"good";case"2g":return"fair";case"slow-2g":return"poor";default:return"good"}}const zT=({status:n,pendingSync:r=0})=>{const o=DT(n),c=()=>{switch(o){case"excellent":return"";case"good":return"";case"fair":return"";case"poor":return"";case"offline":return""}},_=()=>n.isOnline?n.effectiveType?n.effectiveType.toUpperCase():"Online":"Offline";return Ue.jsxs("div",{className:`network-indicator ${o}`,title:`${_()} - ${r} pending`,children:[Ue.jsx("span",{className:"network-icon",children:c()}),r>0&&Ue.jsx("span",{className:"sync-badge",children:r})]})};function LT(n,r,o){o===void 0&&(o={});var c={type:"Feature"};return(o.id===0||o.id)&&(c.id=o.id),o.bbox&&(c.bbox=o.bbox),c.properties={},c.geometry=n,c}function RT(n,r,o){if(o===void 0&&(o={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Px(n[0])||!Px(n[1]))throw new Error("coordinates must contain numbers");var c={type:"Point",coordinates:n};return LT(c,r,o)}function Px(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function OT(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function FT(n){return n.type==="Feature"?n.geometry:n}function BT(n,r,o){if(o===void 0&&(o={}),!n)throw new Error("point is required");if(!r)throw new Error("polygon is required");var c=OT(n),_=FT(r),b=_.type,x=r.bbox,h=_.coordinates;if(x&&NT(c,x)===!1)return!1;b==="Polygon"&&(h=[h]);for(var j=!1,q=0;q<h.length&&!j;q++)if(Ex(c,h[q][0],o.ignoreBoundary)){for(var le=!1,Y=1;Y<h[q].length&&!le;)Ex(c,h[q][Y],!o.ignoreBoundary)&&(le=!0),Y++;le||(j=!0)}return j}function Ex(n,r,o){var c=!1;r[0][0]===r[r.length-1][0]&&r[0][1]===r[r.length-1][1]&&(r=r.slice(0,r.length-1));for(var _=0,b=r.length-1;_<r.length;b=_++){var x=r[_][0],h=r[_][1],j=r[b][0],q=r[b][1],le=n[1]*(x-j)+h*(j-n[0])+q*(n[0]-x)===0&&(x-n[0])*(j-n[0])<=0&&(h-n[1])*(q-n[1])<=0;if(le)return!o;var Y=h>n[1]!=q>n[1]&&n[0]<(j-x)*(n[1]-h)/(q-h)+x;Y&&(c=!c)}return c}function NT(n,r){return r[0]<=n[0]&&r[1]<=n[1]&&r[2]>=n[0]&&r[3]>=n[1]}var lb={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(n,r){((o,c)=>{n.exports=c()})(Nf,function o(){var c=typeof self<"u"?self:typeof window<"u"?window:c!==void 0?c:{},_,b=!c.document&&!!c.postMessage,x=c.IS_PAPA_WORKER||!1,h={},j=0,q={};function le(ce){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(me){var Le=et(me);Le.chunkSize=parseInt(Le.chunkSize),me.step||me.chunk||(Le.chunkSize=null),this._handle=new Je(Le),(this._handle.streamer=this)._config=Le}.call(this,ce),this.parseChunk=function(me,Le){var Ye=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<Ye){let Ot=this._config.newline;Ot||(Tt=this._config.quoteChar||'"',Ot=this._handle.guessLineEndings(me,Tt)),me=[...me.split(Ot).slice(Ye)].join(Ot)}this.isFirstChunk&&Qe(this._config.beforeFirstChunk)&&(Tt=this._config.beforeFirstChunk(me))!==void 0&&(me=Tt),this.isFirstChunk=!1,this._halted=!1;var Ye=this._partialLine+me,Tt=(this._partialLine="",this._handle.parse(Ye,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(me=Tt.meta.cursor,Ye=(this._finished||(this._partialLine=Ye.substring(me-this._baseIndex),this._baseIndex=me),Tt&&Tt.data&&(this._rowCount+=Tt.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),x)c.postMessage({results:Tt,workerId:q.WORKER_ID,finished:Ye});else if(Qe(this._config.chunk)&&!Le){if(this._config.chunk(Tt,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=Tt=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(Tt.data),this._completeResults.errors=this._completeResults.errors.concat(Tt.errors),this._completeResults.meta=Tt.meta),this._completed||!Ye||!Qe(this._config.complete)||Tt&&Tt.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),Ye||Tt&&Tt.meta.paused||this._nextChunk(),Tt}this._halted=!0},this._sendError=function(me){Qe(this._config.error)?this._config.error(me):x&&this._config.error&&c.postMessage({workerId:q.WORKER_ID,error:me,finished:!1})}}function Y(ce){var me;(ce=ce||{}).chunkSize||(ce.chunkSize=q.RemoteChunkSize),le.call(this,ce),this._nextChunk=b?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(Le){this._input=Le,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(me=new XMLHttpRequest,this._config.withCredentials&&(me.withCredentials=this._config.withCredentials),b||(me.onload=ut(this._chunkLoaded,this),me.onerror=ut(this._chunkError,this)),me.open(this._config.downloadRequestBody?"POST":"GET",this._input,!b),this._config.downloadRequestHeaders){var Le,Ye=this._config.downloadRequestHeaders;for(Le in Ye)me.setRequestHeader(Le,Ye[Le])}var Tt;this._config.chunkSize&&(Tt=this._start+this._config.chunkSize-1,me.setRequestHeader("Range","bytes="+this._start+"-"+Tt));try{me.send(this._config.downloadRequestBody)}catch(Ot){this._chunkError(Ot.message)}b&&me.status===0&&this._chunkError()}},this._chunkLoaded=function(){me.readyState===4&&(me.status<200||400<=me.status?this._chunkError():(this._start+=this._config.chunkSize||me.responseText.length,this._finished=!this._config.chunkSize||this._start>=(Le=>(Le=Le.getResponseHeader("Content-Range"))!==null?parseInt(Le.substring(Le.lastIndexOf("/")+1)):-1)(me),this.parseChunk(me.responseText)))},this._chunkError=function(Le){Le=me.statusText||Le,this._sendError(new Error(Le))}}function W(ce){(ce=ce||{}).chunkSize||(ce.chunkSize=q.LocalChunkSize),le.call(this,ce);var me,Le,Ye=typeof FileReader<"u";this.stream=function(Tt){this._input=Tt,Le=Tt.slice||Tt.webkitSlice||Tt.mozSlice,Ye?((me=new FileReader).onload=ut(this._chunkLoaded,this),me.onerror=ut(this._chunkError,this)):me=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var Tt=this._input,Ot=(this._config.chunkSize&&(Ot=Math.min(this._start+this._config.chunkSize,this._input.size),Tt=Le.call(Tt,this._start,Ot)),me.readAsText(Tt,this._config.encoding));Ye||this._chunkLoaded({target:{result:Ot}})},this._chunkLoaded=function(Tt){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(Tt.target.result)},this._chunkError=function(){this._sendError(me.error)}}function $e(ce){var me;le.call(this,ce=ce||{}),this.stream=function(Le){return me=Le,this._nextChunk()},this._nextChunk=function(){var Le,Ye;if(!this._finished)return Le=this._config.chunkSize,me=Le?(Ye=me.substring(0,Le),me.substring(Le)):(Ye=me,""),this._finished=!me,this.parseChunk(Ye)}}function He(ce){le.call(this,ce=ce||{});var me=[],Le=!0,Ye=!1;this.pause=function(){le.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){le.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(Tt){this._input=Tt,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){Ye&&me.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),me.length?this.parseChunk(me.shift()):Le=!0},this._streamData=ut(function(Tt){try{me.push(typeof Tt=="string"?Tt:Tt.toString(this._config.encoding)),Le&&(Le=!1,this._checkIsFinished(),this.parseChunk(me.shift()))}catch(Ot){this._streamError(Ot)}},this),this._streamError=ut(function(Tt){this._streamCleanUp(),this._sendError(Tt)},this),this._streamEnd=ut(function(){this._streamCleanUp(),Ye=!0,this._streamData("")},this),this._streamCleanUp=ut(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Je(ce){var me,Le,Ye,Tt,Ot=Math.pow(2,53),vr=-Ot,Kr=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,Hr=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,nr=this,Ke=0,We=0,gt=!1,yt=!1,Rt=[],It={data:[],errors:[],meta:{}};function Sr(ur){return ce.skipEmptyLines==="greedy"?ur.join("").trim()==="":ur.length===1&&ur[0].length===0}function wr(){if(It&&Ye&&(zr("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+q.DefaultDelimiter+"'"),Ye=!1),ce.skipEmptyLines&&(It.data=It.data.filter(function(Gt){return!Sr(Gt)})),kr()){let Gt=function(Nr,Lr){Qe(ce.transformHeader)&&(Nr=ce.transformHeader(Nr,Lr)),Rt.push(Nr)};var cr=Gt;if(It)if(Array.isArray(It.data[0])){for(var ur=0;kr()&&ur<It.data.length;ur++)It.data[ur].forEach(Gt);It.data.splice(0,1)}else It.data.forEach(Gt)}function ct(Gt,Nr){for(var Lr=ce.header?{}:[],gr=0;gr<Gt.length;gr++){var Te=gr,nn=Gt[gr],nn=((Tr,Wt)=>(dr=>(ce.dynamicTypingFunction&&ce.dynamicTyping[dr]===void 0&&(ce.dynamicTyping[dr]=ce.dynamicTypingFunction(dr)),(ce.dynamicTyping[dr]||ce.dynamicTyping)===!0))(Tr)?Wt==="true"||Wt==="TRUE"||Wt!=="false"&&Wt!=="FALSE"&&((dr=>{if(Kr.test(dr)&&(dr=parseFloat(dr),vr<dr&&dr<Ot))return 1})(Wt)?parseFloat(Wt):Hr.test(Wt)?new Date(Wt):Wt===""?null:Wt):Wt)(Te=ce.header?gr>=Rt.length?"__parsed_extra":Rt[gr]:Te,nn=ce.transform?ce.transform(nn,Te):nn);Te==="__parsed_extra"?(Lr[Te]=Lr[Te]||[],Lr[Te].push(nn)):Lr[Te]=nn}return ce.header&&(gr>Rt.length?zr("FieldMismatch","TooManyFields","Too many fields: expected "+Rt.length+" fields but parsed "+gr,We+Nr):gr<Rt.length&&zr("FieldMismatch","TooFewFields","Too few fields: expected "+Rt.length+" fields but parsed "+gr,We+Nr)),Lr}var Br;It&&(ce.header||ce.dynamicTyping||ce.transform)&&(Br=1,!It.data.length||Array.isArray(It.data[0])?(It.data=It.data.map(ct),Br=It.data.length):It.data=ct(It.data,0),ce.header&&It.meta&&(It.meta.fields=Rt),We+=Br)}function kr(){return ce.header&&Rt.length===0}function zr(ur,ct,Br,cr){ur={type:ur,code:ct,message:Br},cr!==void 0&&(ur.row=cr),It.errors.push(ur)}Qe(ce.step)&&(Tt=ce.step,ce.step=function(ur){It=ur,kr()?wr():(wr(),It.data.length!==0&&(Ke+=ur.data.length,ce.preview&&Ke>ce.preview?Le.abort():(It.data=It.data[0],Tt(It,nr))))}),this.parse=function(ur,ct,Br){var cr=ce.quoteChar||'"',cr=(ce.newline||(ce.newline=this.guessLineEndings(ur,cr)),Ye=!1,ce.delimiter?Qe(ce.delimiter)&&(ce.delimiter=ce.delimiter(ur),It.meta.delimiter=ce.delimiter):((cr=((Gt,Nr,Lr,gr,Te)=>{var nn,Tr,Wt,dr;Te=Te||[",","	","|",";",q.RECORD_SEP,q.UNIT_SEP];for(var _n=0;_n<Te.length;_n++){for(var Sn,An=Te[_n],an=0,Zr=0,Vr=0,Yr=(Wt=void 0,new be({comments:gr,delimiter:An,newline:Nr,preview:10}).parse(Gt)),rt=0;rt<Yr.data.length;rt++)Lr&&Sr(Yr.data[rt])?Vr++:(Sn=Yr.data[rt].length,Zr+=Sn,Wt===void 0?Wt=Sn:0<Sn&&(an+=Math.abs(Sn-Wt),Wt=Sn));0<Yr.data.length&&(Zr/=Yr.data.length-Vr),(Tr===void 0||an<=Tr)&&(dr===void 0||dr<Zr)&&1.99<Zr&&(Tr=an,nn=An,dr=Zr)}return{successful:!!(ce.delimiter=nn),bestDelimiter:nn}})(ur,ce.newline,ce.skipEmptyLines,ce.comments,ce.delimitersToGuess)).successful?ce.delimiter=cr.bestDelimiter:(Ye=!0,ce.delimiter=q.DefaultDelimiter),It.meta.delimiter=ce.delimiter),et(ce));return ce.preview&&ce.header&&cr.preview++,me=ur,Le=new be(cr),It=Le.parse(me,ct,Br),wr(),gt?{meta:{paused:!0}}:It||{meta:{paused:!1}}},this.paused=function(){return gt},this.pause=function(){gt=!0,Le.abort(),me=Qe(ce.chunk)?"":me.substring(Le.getCharIndex())},this.resume=function(){nr.streamer._halted?(gt=!1,nr.streamer.parseChunk(me,!0)):setTimeout(nr.resume,3)},this.aborted=function(){return yt},this.abort=function(){yt=!0,Le.abort(),It.meta.aborted=!0,Qe(ce.complete)&&ce.complete(It),me=""},this.guessLineEndings=function(Gt,cr){Gt=Gt.substring(0,1048576);var cr=new RegExp(Qt(cr)+"([^]*?)"+Qt(cr),"gm"),Br=(Gt=Gt.replace(cr,"")).split("\r"),cr=Gt.split(`
`),Gt=1<cr.length&&cr[0].length<Br[0].length;if(Br.length===1||Gt)return`
`;for(var Nr=0,Lr=0;Lr<Br.length;Lr++)Br[Lr][0]===`
`&&Nr++;return Nr>=Br.length/2?`\r
`:"\r"}}function Qt(ce){return ce.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function be(ce){var me=(ce=ce||{}).delimiter,Le=ce.newline,Ye=ce.comments,Tt=ce.step,Ot=ce.preview,vr=ce.fastMode,Kr=null,Hr=!1,nr=ce.quoteChar==null?'"':ce.quoteChar,Ke=nr;if(ce.escapeChar!==void 0&&(Ke=ce.escapeChar),(typeof me!="string"||-1<q.BAD_DELIMITERS.indexOf(me))&&(me=","),Ye===me)throw new Error("Comment character same as delimiter");Ye===!0?Ye="#":(typeof Ye!="string"||-1<q.BAD_DELIMITERS.indexOf(Ye))&&(Ye=!1),Le!==`
`&&Le!=="\r"&&Le!==`\r
`&&(Le=`
`);var We=0,gt=!1;this.parse=function(yt,Rt,It){if(typeof yt!="string")throw new Error("Input must be a string");var Sr=yt.length,wr=me.length,kr=Le.length,zr=Ye.length,ur=Qe(Tt),ct=[],Br=[],cr=[],Gt=We=0;if(!yt)return an();if(vr||vr!==!1&&yt.indexOf(nr)===-1){for(var Nr=yt.split(Le),Lr=0;Lr<Nr.length;Lr++){if(cr=Nr[Lr],We+=cr.length,Lr!==Nr.length-1)We+=Le.length;else if(It)return an();if(!Ye||cr.substring(0,zr)!==Ye){if(ur){if(ct=[],dr(cr.split(me)),Zr(),gt)return an()}else dr(cr.split(me));if(Ot&&Ot<=Lr)return ct=ct.slice(0,Ot),an(!0)}}return an()}for(var gr=yt.indexOf(me,We),Te=yt.indexOf(Le,We),nn=new RegExp(Qt(Ke)+Qt(nr),"g"),Tr=yt.indexOf(nr,We);;)if(yt[We]===nr)for(Tr=We,We++;;){if((Tr=yt.indexOf(nr,Tr+1))===-1)return It||Br.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ct.length,index:We}),Sn();if(Tr===Sr-1)return Sn(yt.substring(We,Tr).replace(nn,nr));if(nr===Ke&&yt[Tr+1]===Ke)Tr++;else if(nr===Ke||Tr===0||yt[Tr-1]!==Ke){gr!==-1&&gr<Tr+1&&(gr=yt.indexOf(me,Tr+1));var Wt=_n((Te=Te!==-1&&Te<Tr+1?yt.indexOf(Le,Tr+1):Te)===-1?gr:Math.min(gr,Te));if(yt.substr(Tr+1+Wt,wr)===me){cr.push(yt.substring(We,Tr).replace(nn,nr)),yt[We=Tr+1+Wt+wr]!==nr&&(Tr=yt.indexOf(nr,We)),gr=yt.indexOf(me,We),Te=yt.indexOf(Le,We);break}if(Wt=_n(Te),yt.substring(Tr+1+Wt,Tr+1+Wt+kr)===Le){if(cr.push(yt.substring(We,Tr).replace(nn,nr)),An(Tr+1+Wt+kr),gr=yt.indexOf(me,We),Tr=yt.indexOf(nr,We),ur&&(Zr(),gt))return an();if(Ot&&ct.length>=Ot)return an(!0);break}Br.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ct.length,index:We}),Tr++}}else if(Ye&&cr.length===0&&yt.substring(We,We+zr)===Ye){if(Te===-1)return an();We=Te+kr,Te=yt.indexOf(Le,We),gr=yt.indexOf(me,We)}else if(gr!==-1&&(gr<Te||Te===-1))cr.push(yt.substring(We,gr)),We=gr+wr,gr=yt.indexOf(me,We);else{if(Te===-1)break;if(cr.push(yt.substring(We,Te)),An(Te+kr),ur&&(Zr(),gt))return an();if(Ot&&ct.length>=Ot)return an(!0)}return Sn();function dr(Vr){ct.push(Vr),Gt=We}function _n(Vr){var Yr=0;return Yr=Vr!==-1&&(Vr=yt.substring(Tr+1,Vr))&&Vr.trim()===""?Vr.length:Yr}function Sn(Vr){return It||(Vr===void 0&&(Vr=yt.substring(We)),cr.push(Vr),We=Sr,dr(cr),ur&&Zr()),an()}function An(Vr){We=Vr,dr(cr),cr=[],Te=yt.indexOf(Le,We)}function an(Vr){if(ce.header&&!Rt&&ct.length&&!Hr){var Yr=ct[0],rt=Object.create(null),Fn=new Set(Yr);let kn=!1;for(let Cn=0;Cn<Yr.length;Cn++){let en=Yr[Cn];if(rt[en=Qe(ce.transformHeader)?ce.transformHeader(en,Cn):en]){let at,lr=rt[en];for(;at=en+"_"+lr,lr++,Fn.has(at););Fn.add(at),Yr[Cn]=at,rt[en]++,kn=!0,(Kr=Kr===null?{}:Kr)[at]=en}else rt[en]=1,Yr[Cn]=en;Fn.add(en)}kn&&console.warn("Duplicate headers found and renamed."),Hr=!0}return{data:ct,errors:Br,meta:{delimiter:me,linebreak:Le,aborted:gt,truncated:!!Vr,cursor:Gt+(Rt||0),renamedHeaders:Kr}}}function Zr(){Tt(an()),ct=[],Br=[]}},this.abort=function(){gt=!0},this.getCharIndex=function(){return We}}function pe(ce){var me=ce.data,Le=h[me.workerId],Ye=!1;if(me.error)Le.userError(me.error,me.file);else if(me.results&&me.results.data){var Tt={abort:function(){Ye=!0,ke(me.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:Ve,resume:Ve};if(Qe(Le.userStep)){for(var Ot=0;Ot<me.results.data.length&&(Le.userStep({data:me.results.data[Ot],errors:me.results.errors,meta:me.results.meta},Tt),!Ye);Ot++);delete me.results}else Qe(Le.userChunk)&&(Le.userChunk(me.results,Tt,me.file),delete me.results)}me.finished&&!Ye&&ke(me.workerId,me.results)}function ke(ce,me){var Le=h[ce];Qe(Le.userComplete)&&Le.userComplete(me),Le.terminate(),delete h[ce]}function Ve(){throw new Error("Not implemented.")}function et(ce){if(typeof ce!="object"||ce===null)return ce;var me,Le=Array.isArray(ce)?[]:{};for(me in ce)Le[me]=et(ce[me]);return Le}function ut(ce,me){return function(){ce.apply(me,arguments)}}function Qe(ce){return typeof ce=="function"}return q.parse=function(ce,me){var Le=(me=me||{}).dynamicTyping||!1;if(Qe(Le)&&(me.dynamicTypingFunction=Le,Le={}),me.dynamicTyping=Le,me.transform=!!Qe(me.transform)&&me.transform,!me.worker||!q.WORKERS_SUPPORTED)return Le=null,q.NODE_STREAM_INPUT,typeof ce=="string"?(ce=(Ye=>Ye.charCodeAt(0)!==65279?Ye:Ye.slice(1))(ce),Le=new(me.download?Y:$e)(me)):ce.readable===!0&&Qe(ce.read)&&Qe(ce.on)?Le=new He(me):(c.File&&ce instanceof File||ce instanceof Object)&&(Le=new W(me)),Le.stream(ce);(Le=(()=>{var Ye;return!!q.WORKERS_SUPPORTED&&(Ye=(()=>{var Tt=c.URL||c.webkitURL||null,Ot=o.toString();return q.BLOB_URL||(q.BLOB_URL=Tt.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",Ot,")();"],{type:"text/javascript"})))})(),(Ye=new c.Worker(Ye)).onmessage=pe,Ye.id=j++,h[Ye.id]=Ye)})()).userStep=me.step,Le.userChunk=me.chunk,Le.userComplete=me.complete,Le.userError=me.error,me.step=Qe(me.step),me.chunk=Qe(me.chunk),me.complete=Qe(me.complete),me.error=Qe(me.error),delete me.worker,Le.postMessage({input:ce,config:me,workerId:Le.id})},q.unparse=function(ce,me){var Le=!1,Ye=!0,Tt=",",Ot=`\r
`,vr='"',Kr=vr+vr,Hr=!1,nr=null,Ke=!1,We=((()=>{if(typeof me=="object"){if(typeof me.delimiter!="string"||q.BAD_DELIMITERS.filter(function(Rt){return me.delimiter.indexOf(Rt)!==-1}).length||(Tt=me.delimiter),typeof me.quotes!="boolean"&&typeof me.quotes!="function"&&!Array.isArray(me.quotes)||(Le=me.quotes),typeof me.skipEmptyLines!="boolean"&&typeof me.skipEmptyLines!="string"||(Hr=me.skipEmptyLines),typeof me.newline=="string"&&(Ot=me.newline),typeof me.quoteChar=="string"&&(vr=me.quoteChar),typeof me.header=="boolean"&&(Ye=me.header),Array.isArray(me.columns)){if(me.columns.length===0)throw new Error("Option columns is empty");nr=me.columns}me.escapeChar!==void 0&&(Kr=me.escapeChar+vr),me.escapeFormulae instanceof RegExp?Ke=me.escapeFormulae:typeof me.escapeFormulae=="boolean"&&me.escapeFormulae&&(Ke=/^[=+\-@\t\r].*$/)}})(),new RegExp(Qt(vr),"g"));if(typeof ce=="string"&&(ce=JSON.parse(ce)),Array.isArray(ce)){if(!ce.length||Array.isArray(ce[0]))return gt(null,ce,Hr);if(typeof ce[0]=="object")return gt(nr||Object.keys(ce[0]),ce,Hr)}else if(typeof ce=="object")return typeof ce.data=="string"&&(ce.data=JSON.parse(ce.data)),Array.isArray(ce.data)&&(ce.fields||(ce.fields=ce.meta&&ce.meta.fields||nr),ce.fields||(ce.fields=Array.isArray(ce.data[0])?ce.fields:typeof ce.data[0]=="object"?Object.keys(ce.data[0]):[]),Array.isArray(ce.data[0])||typeof ce.data[0]=="object"||(ce.data=[ce.data])),gt(ce.fields||[],ce.data||[],Hr);throw new Error("Unable to serialize unrecognized input");function gt(Rt,It,Sr){var wr="",kr=(typeof Rt=="string"&&(Rt=JSON.parse(Rt)),typeof It=="string"&&(It=JSON.parse(It)),Array.isArray(Rt)&&0<Rt.length),zr=!Array.isArray(It[0]);if(kr&&Ye){for(var ur=0;ur<Rt.length;ur++)0<ur&&(wr+=Tt),wr+=yt(Rt[ur],ur);0<It.length&&(wr+=Ot)}for(var ct=0;ct<It.length;ct++){var Br=(kr?Rt:It[ct]).length,cr=!1,Gt=kr?Object.keys(It[ct]).length===0:It[ct].length===0;if(Sr&&!kr&&(cr=Sr==="greedy"?It[ct].join("").trim()==="":It[ct].length===1&&It[ct][0].length===0),Sr==="greedy"&&kr){for(var Nr=[],Lr=0;Lr<Br;Lr++){var gr=zr?Rt[Lr]:Lr;Nr.push(It[ct][gr])}cr=Nr.join("").trim()===""}if(!cr){for(var Te=0;Te<Br;Te++){0<Te&&!Gt&&(wr+=Tt);var nn=kr&&zr?Rt[Te]:Te;wr+=yt(It[ct][nn],Te)}ct<It.length-1&&(!Sr||0<Br&&!Gt)&&(wr+=Ot)}}return wr}function yt(Rt,It){var Sr,wr;return Rt==null?"":Rt.constructor===Date?JSON.stringify(Rt).slice(1,25):(wr=!1,Ke&&typeof Rt=="string"&&Ke.test(Rt)&&(Rt="'"+Rt,wr=!0),Sr=Rt.toString().replace(We,Kr),(wr=wr||Le===!0||typeof Le=="function"&&Le(Rt,It)||Array.isArray(Le)&&Le[It]||((kr,zr)=>{for(var ur=0;ur<zr.length;ur++)if(-1<kr.indexOf(zr[ur]))return!0;return!1})(Sr,q.BAD_DELIMITERS)||-1<Sr.indexOf(Tt)||Sr.charAt(0)===" "||Sr.charAt(Sr.length-1)===" ")?vr+Sr+vr:Sr)}},q.RECORD_SEP="",q.UNIT_SEP="",q.BYTE_ORDER_MARK="\uFEFF",q.BAD_DELIMITERS=["\r",`
`,'"',q.BYTE_ORDER_MARK],q.WORKERS_SUPPORTED=!b&&!!c.Worker,q.NODE_STREAM_INPUT=1,q.LocalChunkSize=10485760,q.RemoteChunkSize=5242880,q.DefaultDelimiter=",",q.Parser=be,q.ParserHandle=Je,q.NetworkStreamer=Y,q.FileStreamer=W,q.StringStreamer=$e,q.ReadableStreamStreamer=He,c.jQuery&&((_=c.jQuery).fn.parse=function(ce){var me=ce.config||{},Le=[];return this.each(function(Ot){if(!(_(this).prop("tagName").toUpperCase()==="INPUT"&&_(this).attr("type").toLowerCase()==="file"&&c.FileReader)||!this.files||this.files.length===0)return!0;for(var vr=0;vr<this.files.length;vr++)Le.push({file:this.files[vr],inputElem:this,instanceConfig:_.extend({},me)})}),Ye(),this;function Ye(){if(Le.length===0)Qe(ce.complete)&&ce.complete();else{var Ot,vr,Kr,Hr,nr=Le[0];if(Qe(ce.before)){var Ke=ce.before(nr.file,nr.inputElem);if(typeof Ke=="object"){if(Ke.action==="abort")return Ot="AbortError",vr=nr.file,Kr=nr.inputElem,Hr=Ke.reason,void(Qe(ce.error)&&ce.error({name:Ot},vr,Kr,Hr));if(Ke.action==="skip")return void Tt();typeof Ke.config=="object"&&(nr.instanceConfig=_.extend(nr.instanceConfig,Ke.config))}else if(Ke==="skip")return void Tt()}var We=nr.instanceConfig.complete;nr.instanceConfig.complete=function(gt){Qe(We)&&We(gt,nr.file,nr.inputElem),Tt()},q.parse(nr.file,nr.instanceConfig)}}function Tt(){Le.splice(0,1),Ye()}}),x&&(c.onmessage=function(ce){ce=ce.data,q.WORKER_ID===void 0&&ce&&(q.WORKER_ID=ce.workerId),typeof ce.input=="string"?c.postMessage({workerId:q.WORKER_ID,results:q.parse(ce.input,ce.config),finished:!0}):(c.File&&ce.input instanceof File||ce.input instanceof Object)&&(ce=q.parse(ce.input,ce.config))&&c.postMessage({workerId:q.WORKER_ID,results:ce,finished:!0})}),(Y.prototype=Object.create(le.prototype)).constructor=Y,(W.prototype=Object.create(le.prototype)).constructor=W,($e.prototype=Object.create($e.prototype)).constructor=$e,(He.prototype=Object.create(le.prototype)).constructor=He,q})})(lb);var jT=lb.exports;const UT=gp(jT),VT={region:"Western Ghats",generated:new Date().toISOString(),version:"1.0.0",layers:[{id:"western_ghats_boundary",title:"Western Ghats Boundary",type:"vector",source:{format:"geojson",path:"/data/boundaries/western_ghats_boundary.geojson"},style:{kind:"polygon",colors:{default:"#4a9eff33"}},query:{mode:"feature_at_point",fields:["REC_NUM","DATA_VALUE"]},category:"boundary",enabled:!0},{id:"dakshina_kannada_boundary",title:"Dakshina Kannada District",type:"vector",source:{format:"geojson",path:"/data/boundaries/dakshina_kannada_boundary.geojson"},style:{kind:"polygon",colors:{default:"#ff9800aa"}},query:{mode:"feature_at_point",fields:[]},category:"boundary",enabled:!0},{id:"lulc_glc_composition",title:"LULC Composition (GLC 1987-2010)",type:"csv",source:{format:"csv",path:"/data/lulc/dakshina_kannada_lulc_glc_composition.csv"},style:{kind:"categorical",field:"class_name"},query:{mode:"summary",fields:["year","class_code","class_name","area_km2","percent"]},category:"lulc",enabled:!0},{id:"tree_cover_glc",title:"Tree Cover (GLC)",type:"csv",source:{format:"csv",path:"/data/lulc/dakshina_kannada_tree_cover_glc.csv"},style:{kind:"choropleth",field:"tree_cover_pct"},query:{mode:"summary",fields:["year","tree_cover_km2","tree_cover_pct"]},category:"lulc",enabled:!0},{id:"built_area_glc",title:"Built Area (GLC)",type:"csv",source:{format:"csv",path:"/data/lulc/dakshina_kannada_built_glc.csv"},style:{kind:"choropleth",field:"built_pct"},query:{mode:"summary",fields:["year","built_km2","built_pct"]},category:"lulc",enabled:!0},{id:"built_area_dw",title:"Built Area (Dynamic World 2018-2025)",type:"csv",source:{format:"csv",path:"/data/lulc/dakshina_kannada_built_dynamic_world.csv"},style:{kind:"choropleth",field:"built_pct"},query:{mode:"summary",fields:["year","built_km2","built_pct"]},category:"lulc",enabled:!0},{id:"forest_typology",title:"Forest Typology",type:"csv",source:{format:"csv",path:"/data/forest/dakshina_kannada_forest_typology.csv"},style:{kind:"categorical",field:"forest_type"},query:{mode:"summary",fields:["forest_type","area_km2","percent"]},category:"forest",enabled:!0},{id:"corestack_blocks",title:"CoreStack Blocks",type:"csv",source:{format:"csv",path:"/data/corestack/dakshina_kannada_corestack_blocks.csv"},style:{kind:"point"},query:{mode:"feature_at_point",fields:["block_id","block_name","district"]},category:"corestack",enabled:!0},{id:"cropping_intensity",title:"Cropping Intensity Analysis",type:"csv",source:{format:"csv",path:"/data/corestack/cropping_intensity_analysis.csv"},style:{kind:"choropleth",field:"cropping_intensity_avg"},query:{mode:"summary",fields:["grid_id","mws_id","district","cropping_intensity_avg","cropping_intensity_trend"]},category:"corestack",enabled:!0},{id:"water_balance",title:"Water Balance Summary",type:"csv",source:{format:"csv",path:"/data/corestack/water_balance_summary.csv"},style:{kind:"choropleth",field:"balance"},query:{mode:"summary",fields:["watershed_id","precipitation","runoff","balance"]},category:"corestack",enabled:!0},{id:"district_coverage",title:"WG District Coverage (CoreStack)",type:"csv",source:{format:"csv",path:"/data/coverage/wg_district_coverage.csv"},style:{kind:"categorical",field:"corestack_covered"},query:{mode:"summary",fields:["state","district","corestack_covered"]},category:"corestack",enabled:!0},{id:"district_urbanization",title:"District Urbanization Analysis",type:"csv",source:{format:"csv",path:"/data/analysis/district_urbanization_analysis.csv"},style:{kind:"choropleth",field:"urbanization_rate"},query:{mode:"summary",fields:["district","state","urbanization_rate","change_pct"]},category:"other",enabled:!0},{id:"regional_forest_comparison",title:"Regional Forest Comparison",type:"csv",source:{format:"csv",path:"/data/forest/regional_forest_comparison.csv"},style:{kind:"choropleth",field:"forest_cover_pct"},query:{mode:"summary",fields:["region","forest_cover_pct","change_pct"]},category:"forest",enabled:!0}],basemaps:[{id:"dark",type:"vector",title:"Dark Map",offline:!0,source:"dark_style"},{id:"satellite",type:"raster",title:"Satellite",offline:!1,source:"satellite_style"}]};class $T{manifest;loadedData=new Map;geojsonLayers=new Map;constructor(){this.manifest=VT}async initialize(){try{const r=await fetch("/data/dataset-manifest.json");r.ok&&(this.manifest=await r.json())}catch{console.log("Using default manifest")}await this.preloadLayers()}async preloadLayers(){const r=this.manifest.layers.filter(o=>o.enabled);await Promise.all(r.map(async o=>{try{const c=await WC(o.id);if(c){this.loadedData.set(o.id,c),o.source.format==="geojson"&&this.geojsonLayers.set(o.id,c);return}const _=await this.loadLayer(o);_&&(this.loadedData.set(o.id,_),await ZC(o.id,_),o.source.format==="geojson"&&this.geojsonLayers.set(o.id,_))}catch(c){console.warn(`Failed to load layer ${o.id}:`,c)}}))}async loadLayer(r){const o=await fetch(r.source.path);if(!o.ok)throw new Error(`Failed to fetch ${r.source.path}`);switch(r.source.format){case"geojson":return await o.json();case"csv":const c=await o.text();return UT.parse(c,{header:!0,dynamicTyping:!0,skipEmptyLines:!0}).data;default:return await o.json()}}getLayers(){return this.manifest.layers}getEnabledLayers(){return this.manifest.layers.filter(r=>r.enabled)}getLayerById(r){return this.manifest.layers.find(o=>o.id===r)}getLayerData(r){return this.loadedData.get(r)}getGeoJSONLayer(r){return this.geojsonLayers.get(r)}async getValuesAtPoint(r,o,c){const _={},b=RT([o,r]);for(const x of c){const h=this.getLayerById(x);if(!h)continue;const j=this.loadedData.get(x);if(j){if(_[x]={},h.source.format==="geojson"&&this.geojsonLayers.has(x)){const q=this.geojsonLayers.get(x);for(const le of q.features)if((le.geometry.type==="Polygon"||le.geometry.type==="MultiPolygon")&&BT(b,le)){if(h.query?.fields)for(const Y of h.query.fields)_[x][Y]=le.properties?.[Y];else _[x]={...le.properties};break}}if(h.source.format==="csv"&&Array.isArray(j)){const q=j;if(q.length>0){const le=new Set(q.map(W=>W.year).filter(W=>W!==void 0)),Y=Array.from(le).sort((W,$e)=>$e-W);if(Y.length>0){const W=Y[0],$e=q.filter(He=>He.year===W);_[x]={_source:"csv_summary",_year:W,_recordCount:$e.length,_sample:$e.slice(0,3)}}else _[x]={_source:"csv_summary",_recordCount:q.length,_sample:q.slice(0,3)}}}}}return _}async getSummaryAtPoint(r,o,c){const _={coordinates:{lat:r,lon:o},layers:{}},b=await this.getValuesAtPoint(r,o,c);for(const[x,h]of Object.entries(b)){const j=this.getLayerById(x);j&&(_.layers[x]={title:j.title,values:h})}return _.context={region:this.manifest.region,queriedAt:new Date().toISOString()},_}getLayerStats(r){const o=this.loadedData.get(r);if(!o||!Array.isArray(o))return null;const c=o;if(c.length===0)return null;const _=Object.keys(c[0]),b={recordCount:c.length,columns:_};if("year"in c[0]){const x=[...new Set(c.map(h=>h.year))].sort();b.years=x,b.yearRange={min:x[0],max:x[x.length-1]}}return b}}const qT="https://api-doc.core-stack.org/api/v1";class KT{apiKey=null;isOnline=navigator.onLine;constructor(){this.apiKey=localStorage.getItem("corestack_api_key"),window.addEventListener("online",()=>this.isOnline=!0),window.addEventListener("offline",()=>this.isOnline=!1)}setApiKey(r){this.apiKey=r,localStorage.setItem("corestack_api_key",r)}hasApiKey(){return!!this.apiKey}isAvailable(){return this.isOnline&&this.hasApiKey()}async request(r,o={}){if(!this.isOnline)throw new Error("Offline - cannot access CoreStack API");if(!this.apiKey)throw new Error("API key not configured");const c=new URL(`${qT}${r}`);Object.entries(o).forEach(([b,x])=>{c.searchParams.set(b,x)});const _=await fetch(c.toString(),{method:"GET",headers:{Accept:"application/json","X-API-Key":this.apiKey}});if(!_.ok){const b=await _.json().catch(()=>({message:_.statusText}));throw new Error(b.message||`API error: ${_.status}`)}return _.json()}async getAdminDetailsByLatLon(r,o){return this.request("/get_admin_details_by_latlon/",{lat:r.toString(),lon:o.toString()})}async getMWSIdByLatLon(r,o){return this.request("/get_mwsid_by_latlon/",{lat:r.toString(),lon:o.toString()})}async getMWSData(r,o,c){const _={mws_id:r};return o&&(_.start_date=o),c&&(_.end_date=c),this.request("/get_mws_data/",_)}async getMWSKYLIndicators(r){return this.request("/get_mws_kyl_indicators/",{mws_id:r})}async getMWSReportUrl(r){return this.request("/get_mws_report/",{mws_id:r})}async getLayerUrls(r,o,c){const _={};return r&&(_.state_code=r),o&&(_.district_code=o),c&&(_.tehsil_code=c),this.request("/get_generated_layer_urls/",_)}async getTehsilData(r){return this.request("/get_tehsil_data/",{tehsil_code:r})}async getWaterbodiesByAdmin(r,o,c){const _={};return r&&(_.state_code=r),o&&(_.district_code=o),c&&(_.tehsil_code=c),this.request("/get_waterbodies_data_by_admin/",_)}async getWaterbodyData(r){return this.request("/get_waterbody_data/",{uid:r})}async getActiveLocations(){return this.request("/get_active_locations/")}async enrichLocation(r,o){if(!this.isAvailable())return{error:"CoreStack API not available"};try{const c=await this.getAdminDetailsByLatLon(r,o);let _,b;try{_=(await this.getMWSIdByLatLon(r,o)).mws_id,_&&(b=await this.getMWSKYLIndicators(_))}catch{}let x;if(c.state_code&&c.district_code)try{x=await this.getLayerUrls(c.state_code,c.district_code)}catch{}let h;if(c.district_code)try{h=await this.getWaterbodiesByAdmin(c.state_code,c.district_code,c.tehsil_code)}catch{}return{admin:c,mwsId:_,indicators:b,layerUrls:x,waterbodies:h}}catch(c){return{error:c instanceof Error?c.message:"Unknown error"}}}}const Ac=new KT;class GT{syncStatus={pendingObservations:0,pendingImages:0,lastSync:null,isSyncing:!1,errors:[]};listeners=new Set;subscribe(r){return this.listeners.add(r),r(this.syncStatus),()=>this.listeners.delete(r)}notifyListeners(){for(const r of this.listeners)r(this.syncStatus)}getStatus(){return{...this.syncStatus}}async updatePendingCounts(){const r=await qa.observations.filter(c=>!c.synced).count(),o=await qa.images.count();this.syncStatus.pendingObservations=r,this.syncStatus.pendingImages=o,this.notifyListeners()}async enrichObservation(r){const o=await qa.observations.get(r);if(!o)return{observationId:r,success:!1,error:"Observation not found"};if(!Ac.isAvailable())return{observationId:r,success:!1,error:"CoreStack API not available"};try{const c=await Ac.enrichLocation(o.location.lat,o.location.lon);if(c.error)return{observationId:r,success:!1,error:c.error};const _={...o.datasetValues,corestack:{admin:c.admin,mwsId:c.mwsId,indicators:c.indicators,enrichedAt:new Date().toISOString()}};return await qa.observations.update(r,{datasetValues:_,synced:!0}),{observationId:r,success:!0,data:_}}catch(c){return{observationId:r,success:!1,error:c instanceof Error?c.message:"Unknown error"}}}async enrichPendingObservations(){if(this.syncStatus.isSyncing)return[];this.syncStatus.isSyncing=!0,this.syncStatus.errors=[],this.notifyListeners();const r=[];try{const o=await qa.observations.filter(c=>!c.synced).toArray();for(const c of o){const _=await this.enrichObservation(c.id);r.push(_),!_.success&&_.error&&this.syncStatus.errors.push(`Observation ${c.id}: ${_.error}`)}this.syncStatus.lastSync=new Date}finally{this.syncStatus.isSyncing=!1,await this.updatePendingCounts()}return r}startAutoSync(r=6e4){const o=async()=>{navigator.onLine&&!this.syncStatus.isSyncing&&await this.enrichPendingObservations()};o();const c=setInterval(o,r),_=()=>o();return window.addEventListener("online",_),()=>{clearInterval(c),window.removeEventListener("online",_)}}async exportEnrichedGeoJSON(){return{type:"FeatureCollection",features:(await qa.observations.toArray()).map(c=>({type:"Feature",geometry:{type:"Point",coordinates:[c.location.lon,c.location.lat]},properties:{id:c.id,timestamp:c.timestamp,userValidation:c.userValidation,notes:c.notes,synced:c.synced,...c.datasetValues}}))}}}const Ax=new GT;class HT{cachedData=[];isOnline=navigator.onLine;dataLoaded=!1;constructor(){window.addEventListener("online",()=>this.isOnline=!0),window.addEventListener("offline",()=>this.isOnline=!1)}async loadCachedData(){if(!this.dataLoaded)try{const r=await fetch("/data/dynamicworld/wg_dynamic_world_2018_2025.csv");if(!r.ok){console.warn("Dynamic World data not found locally");return}const c=(await r.text()).trim().split(`
`);this.cachedData=c.slice(1).map(_=>{const b=_.split(",");return{year:parseInt(b[0]),month:b[2],water:parseFloat(b[3]),trees:parseFloat(b[4]),grass:parseFloat(b[5]),floodedVegetation:parseFloat(b[6]),crops:parseFloat(b[7]),shrubAndScrub:parseFloat(b[8]),built:parseFloat(b[9]),bare:parseFloat(b[10]),snowAndIce:parseFloat(b[11])}}),this.dataLoaded=!0,console.log(`Loaded ${this.cachedData.length} Dynamic World records`)}catch(r){console.error("Failed to load Dynamic World data:",r)}}getRegionalStats(r){return!this.dataLoaded||this.cachedData.length===0?null:r?this.cachedData.find(o=>o.year===r)||null:this.cachedData[this.cachedData.length-1]}getAvailableYears(){return this.cachedData.map(r=>r.year)}getTimeSeries(r){return this.cachedData.map(o=>({year:o.year,value:o[r]}))}getChangeStats(r,o){const c=this.cachedData.find(h=>h.year===r),_=this.cachedData.find(h=>h.year===o);if(!c||!_)return null;const b=["water","trees","grass","floodedVegetation","crops","shrubAndScrub","built","bare","snowAndIce"],x={};for(const h of b){const j=c[h],q=_[h];x[h]={start:j,end:q,change:q-j,percentChange:(q-j)/j*100}}return x}async fetchPointData(r,o,c){if(!this.isOnline)return console.warn("Cannot fetch Dynamic World point data: offline"),null;const _=this.getRegionalStats();if(!_)return null;const b={Water:_.water,Trees:_.trees,Grass:_.grass,"Flooded Vegetation":_.floodedVegetation,Crops:_.crops,"Shrub and Scrub":_.shrubAndScrub,Built:_.built,Bare:_.bare,"Snow and Ice":_.snowAndIce},x=Object.values(b).reduce((le,Y)=>le+Y,0),h={};let j="Trees",q=0;for(const[le,Y]of Object.entries(b)){const W=Y/x;h[le]=W,W>q&&(q=W,j=le)}return{lat:r,lon:o,timestamp:c||new Date().toISOString(),landCoverClass:j,confidence:q,probabilities:h}}getSummaryForLocation(){const r=this.getRegionalStats();if(!r)return{status:"No Dynamic World data available"};const o=this.getChangeStats(2018,r.year);return{source:"Dynamic World (Google)",year:r.year,month:r.month,landCover:{trees:`${r.trees.toFixed(1)} km`,crops:`${r.crops.toFixed(1)} km`,built:`${r.built.toFixed(1)} km`,shrubAndScrub:`${r.shrubAndScrub.toFixed(1)} km`},changesSince2018:o?{trees:`${o.trees.percentChange>0?"+":""}${o.trees.percentChange.toFixed(1)}%`,built:`${o.built.percentChange>0?"+":""}${o.built.percentChange.toFixed(1)}%`,crops:`${o.crops.percentChange>0?"+":""}${o.crops.percentChange.toFixed(1)}%`}:null}}}const Mx=new HT,ZT=()=>{const[n,r]=Kt.useState([]),[o,c]=Kt.useState(new Set),[_,b]=Kt.useState(!1),[x,h]=Kt.useState(!1),[j,q]=Kt.useState(!1),[le,Y]=Kt.useState(null),[W,$e]=Kt.useState(null),[He,Je]=Kt.useState(!1),[Qt,be]=Kt.useState("dark"),[pe,ke]=Kt.useState([75.5,13]),[Ve,et]=Kt.useState(8),[ut,Qe]=Kt.useState(null),[ce,me]=Kt.useState(!1),Le=MT(),Ye=Kt.useRef(null),Tt=Kt.useRef(new ob);Kt.useEffect(()=>{(async()=>{try{Ye.current=new $T,await Ye.current.initialize();const We=Ye.current.getLayers();r(We),await Mx.loadCachedData();const gt=new Set(We.slice(0,2).map(yt=>yt.id));c(gt)}catch(We){console.error("Failed to initialize datasets:",We)}})()},[]),Kt.useEffect(()=>{const Ke=Ax.subscribe(Qe),We=Ax.startAutoSync(6e4);return()=>{Ke(),We()}},[]);const Ot=Kt.useCallback(Ke=>{c(We=>{const gt=new Set(We);return gt.has(Ke)?gt.delete(Ke):gt.add(Ke),gt})},[]),vr=Kt.useCallback(async()=>{try{const Ke=await Tt.current.getCurrentPosition();if(Y(Ke),ke([Ke.lon,Ke.lat]),et(14),Ye.current){const We=await Ye.current.getSummaryAtPoint(Ke.lat,Ke.lon,Array.from(o));$e(We),Je(!0)}}catch(Ke){console.error("Location error:",Ke),alert("Could not get location. Please enable GPS.")}},[o]),Kr=Kt.useCallback(async(Ke,We,gt)=>{if(ke([We,Ke]),et(14),Y({lat:Ke,lon:We,accuracy:0}),Ye.current){const yt=await Ye.current.getSummaryAtPoint(Ke,We,Array.from(o));if(Le.isOnline&&Ac.hasApiKey())try{const It=await Ac.enrichLocation(Ke,We);It.error||Object.assign(yt,{admin:It.admin,mwsId:It.mwsId,indicators:It.indicators})}catch(It){console.warn("CoreStack enrichment failed:",It)}const Rt=Mx.getSummaryForLocation();Rt&&Object.assign(yt,{dynamicWorld:Rt}),gt&&(yt.placeName=gt),$e(yt),Je(!0)}},[o,Le.isOnline]),Hr=Kt.useCallback(async Ke=>{await qa.observations.add(Ke),q(!1)},[]),nr=Kt.useCallback(async(Ke,We)=>Ye.current?await Ye.current.getValuesAtPoint(Ke,We,Array.from(o)):{},[o]);return Ue.jsxs("div",{className:"app-container",children:[Ue.jsx(PC,{center:pe,zoom:Ve,basemap:Qt,layers:n,activeLayers:o,currentLocation:le,onMapMove:(Ke,We)=>{ke(Ke),et(We)}}),Ue.jsxs("div",{className:"top-controls",children:[Ue.jsx(NC,{onSearch:Kr,isOnline:Le.isOnline}),Ue.jsx(zT,{status:Le,pendingSync:ut?.pendingObservations||0}),Ue.jsxs("div",{className:"basemap-toggle",children:[Ue.jsx("button",{className:Qt==="dark"?"active":"",onClick:()=>be("dark"),title:"Map View",children:""}),Ue.jsx("button",{className:Qt==="satellite"?"active":"",onClick:()=>be("satellite"),title:"Satellite View",children:""})]})]}),Ue.jsxs("div",{className:"side-controls",children:[Ue.jsx("button",{className:"control-btn",onClick:vr,title:"Locate Me",children:""}),Ue.jsx("button",{className:`control-btn ${_?"active":""}`,onClick:()=>b(!_),title:"Layers",children:""}),Ue.jsx("button",{className:`control-btn ${x?"active":""}`,onClick:()=>h(!x),title:"Field Log",children:""}),Ue.jsx("button",{className:"control-btn",onClick:()=>me(!0),title:"API Settings",children:""})]}),_&&Ue.jsx(MC,{layers:n,activeLayers:o,onToggle:Ot,onClose:()=>b(!1)}),He&&W&&Ue.jsx(jC,{summary:W,location:le,onClose:()=>Je(!1)}),x&&Ue.jsx(AC,{title:"Field Log",onClose:()=>h(!1),children:Ue.jsx(PT,{onGoToLocation:(Ke,We)=>{ke([We,Ke]),et(16),h(!1)}})}),Ue.jsx(VC,{onClick:()=>q(!0)}),j&&Ue.jsx(ET,{currentLocation:le,getDatasetValues:nr,onCapture:Hr,onClose:()=>q(!1)}),ce&&Ue.jsx("div",{className:"modal-overlay",onClick:()=>me(!1),children:Ue.jsxs("div",{className:"modal-content api-key-modal",onClick:Ke=>Ke.stopPropagation(),children:[Ue.jsx("h3",{children:"CoreStack API Settings"}),Ue.jsx("p",{className:"modal-description",children:"Enter your CoreStack API key to enable online data enrichment. This allows fetching watershed data, admin details, and more when online."}),Ue.jsxs("form",{onSubmit:Ke=>{Ke.preventDefault();const gt=Ke.target.elements.namedItem("apiKey");gt.value.trim()&&(Ac.setApiKey(gt.value.trim()),me(!1))},children:[Ue.jsx("input",{type:"password",name:"apiKey",placeholder:"Enter API Key...",defaultValue:localStorage.getItem("corestack_api_key")||"",autoComplete:"off"}),Ue.jsxs("div",{className:"modal-actions",children:[Ue.jsx("button",{type:"button",onClick:()=>me(!1),children:"Cancel"}),Ue.jsx("button",{type:"submit",className:"primary",children:"Save"})]})]}),Ue.jsx("p",{className:"modal-hint",children:Ac.hasApiKey()?" API key is configured":" No API key set - online enrichment disabled"})]})})]})};fg.createRoot(document.getElementById("root")).render(Ue.jsx(yc.StrictMode,{children:Ue.jsx(ZT,{})}));
//# sourceMappingURL=index-C9Te9bM7.js.map
