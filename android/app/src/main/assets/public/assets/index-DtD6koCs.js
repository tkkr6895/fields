(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))h(y);new MutationObserver(y=>{for(const w of y)if(w.type==="childList")for(const x of w.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&h(x)}).observe(document,{childList:!0,subtree:!0});function o(y){const w={};return y.integrity&&(w.integrity=y.integrity),y.referrerPolicy&&(w.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?w.credentials="include":y.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function h(y){if(y.ep)return;y.ep=!0;const w=o(y);fetch(y.href,w)}})();var Up=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vf(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Gx={exports:{}},xf={},Kx={exports:{}},Fr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kd=Symbol.for("react.element"),gS=Symbol.for("react.portal"),yS=Symbol.for("react.fragment"),_S=Symbol.for("react.strict_mode"),vS=Symbol.for("react.profiler"),xS=Symbol.for("react.provider"),bS=Symbol.for("react.context"),wS=Symbol.for("react.forward_ref"),SS=Symbol.for("react.suspense"),kS=Symbol.for("react.memo"),CS=Symbol.for("react.lazy"),a0=Symbol.iterator;function TS(n){return n===null||typeof n!="object"?null:(n=a0&&n[a0]||n["@@iterator"],typeof n=="function"?n:null)}var Hx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Wx=Object.assign,Zx={};function Gc(n,r,o){this.props=n,this.context=r,this.refs=Zx,this.updater=o||Hx}Gc.prototype.isReactComponent={};Gc.prototype.setState=function(n,r){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,r,"setState")};Gc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Xx(){}Xx.prototype=Gc.prototype;function vy(n,r,o){this.props=n,this.context=r,this.refs=Zx,this.updater=o||Hx}var xy=vy.prototype=new Xx;xy.constructor=vy;Wx(xy,Gc.prototype);xy.isPureReactComponent=!0;var s0=Array.isArray,Yx=Object.prototype.hasOwnProperty,by={current:null},Jx={key:!0,ref:!0,__self:!0,__source:!0};function Qx(n,r,o){var h,y={},w=null,x=null;if(r!=null)for(h in r.ref!==void 0&&(x=r.ref),r.key!==void 0&&(w=""+r.key),r)Yx.call(r,h)&&!Jx.hasOwnProperty(h)&&(y[h]=r[h]);var c=arguments.length-2;if(c===1)y.children=o;else if(1<c){for(var V=Array(c),G=0;G<c;G++)V[G]=arguments[G+2];y.children=V}if(n&&n.defaultProps)for(h in c=n.defaultProps,c)y[h]===void 0&&(y[h]=c[h]);return{$$typeof:kd,type:n,key:w,ref:x,props:y,_owner:by.current}}function IS(n,r){return{$$typeof:kd,type:n.type,key:r,ref:n.ref,props:n.props,_owner:n._owner}}function wy(n){return typeof n=="object"&&n!==null&&n.$$typeof===kd}function PS(n){var r={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(o){return r[o]})}var o0=/\/+/g;function Bm(n,r){return typeof n=="object"&&n!==null&&n.key!=null?PS(""+n.key):r.toString(36)}function Tp(n,r,o,h,y){var w=typeof n;(w==="undefined"||w==="boolean")&&(n=null);var x=!1;if(n===null)x=!0;else switch(w){case"string":case"number":x=!0;break;case"object":switch(n.$$typeof){case kd:case gS:x=!0}}if(x)return x=n,y=y(x),n=h===""?"."+Bm(x,0):h,s0(y)?(o="",n!=null&&(o=n.replace(o0,"$&/")+"/"),Tp(y,r,o,"",function(G){return G})):y!=null&&(wy(y)&&(y=IS(y,o+(!y.key||x&&x.key===y.key?"":(""+y.key).replace(o0,"$&/")+"/")+n)),r.push(y)),1;if(x=0,h=h===""?".":h+":",s0(n))for(var c=0;c<n.length;c++){w=n[c];var V=h+Bm(w,c);x+=Tp(w,r,o,V,y)}else if(V=TS(n),typeof V=="function")for(n=V.call(n),c=0;!(w=n.next()).done;)w=w.value,V=h+Bm(w,c++),x+=Tp(w,r,o,V,y);else if(w==="object")throw r=String(n),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return x}function ap(n,r,o){if(n==null)return n;var h=[],y=0;return Tp(n,h,"","",function(w){return r.call(o,w,y++)}),h}function ES(n){if(n._status===-1){var r=n._result;r=r(),r.then(function(o){(n._status===0||n._status===-1)&&(n._status=1,n._result=o)},function(o){(n._status===0||n._status===-1)&&(n._status=2,n._result=o)}),n._status===-1&&(n._status=0,n._result=r)}if(n._status===1)return n._result.default;throw n._result}var la={current:null},Ip={transition:null},AS={ReactCurrentDispatcher:la,ReactCurrentBatchConfig:Ip,ReactCurrentOwner:by};function e1(){throw Error("act(...) is not supported in production builds of React.")}Fr.Children={map:ap,forEach:function(n,r,o){ap(n,function(){r.apply(this,arguments)},o)},count:function(n){var r=0;return ap(n,function(){r++}),r},toArray:function(n){return ap(n,function(r){return r})||[]},only:function(n){if(!wy(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Fr.Component=Gc;Fr.Fragment=yS;Fr.Profiler=vS;Fr.PureComponent=vy;Fr.StrictMode=_S;Fr.Suspense=SS;Fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=AS;Fr.act=e1;Fr.cloneElement=function(n,r,o){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var h=Wx({},n.props),y=n.key,w=n.ref,x=n._owner;if(r!=null){if(r.ref!==void 0&&(w=r.ref,x=by.current),r.key!==void 0&&(y=""+r.key),n.type&&n.type.defaultProps)var c=n.type.defaultProps;for(V in r)Yx.call(r,V)&&!Jx.hasOwnProperty(V)&&(h[V]=r[V]===void 0&&c!==void 0?c[V]:r[V])}var V=arguments.length-2;if(V===1)h.children=o;else if(1<V){c=Array(V);for(var G=0;G<V;G++)c[G]=arguments[G+2];h.children=c}return{$$typeof:kd,type:n.type,key:y,ref:w,props:h,_owner:x}};Fr.createContext=function(n){return n={$$typeof:bS,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:xS,_context:n},n.Consumer=n};Fr.createElement=Qx;Fr.createFactory=function(n){var r=Qx.bind(null,n);return r.type=n,r};Fr.createRef=function(){return{current:null}};Fr.forwardRef=function(n){return{$$typeof:wS,render:n}};Fr.isValidElement=wy;Fr.lazy=function(n){return{$$typeof:CS,_payload:{_status:-1,_result:n},_init:ES}};Fr.memo=function(n,r){return{$$typeof:kS,type:n,compare:r===void 0?null:r}};Fr.startTransition=function(n){var r=Ip.transition;Ip.transition={};try{n()}finally{Ip.transition=r}};Fr.unstable_act=e1;Fr.useCallback=function(n,r){return la.current.useCallback(n,r)};Fr.useContext=function(n){return la.current.useContext(n)};Fr.useDebugValue=function(){};Fr.useDeferredValue=function(n){return la.current.useDeferredValue(n)};Fr.useEffect=function(n,r){return la.current.useEffect(n,r)};Fr.useId=function(){return la.current.useId()};Fr.useImperativeHandle=function(n,r,o){return la.current.useImperativeHandle(n,r,o)};Fr.useInsertionEffect=function(n,r){return la.current.useInsertionEffect(n,r)};Fr.useLayoutEffect=function(n,r){return la.current.useLayoutEffect(n,r)};Fr.useMemo=function(n,r){return la.current.useMemo(n,r)};Fr.useReducer=function(n,r,o){return la.current.useReducer(n,r,o)};Fr.useRef=function(n){return la.current.useRef(n)};Fr.useState=function(n){return la.current.useState(n)};Fr.useSyncExternalStore=function(n,r,o){return la.current.useSyncExternalStore(n,r,o)};Fr.useTransition=function(){return la.current.useTransition()};Fr.version="18.3.1";Kx.exports=Fr;var st=Kx.exports;const _c=vf(st);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MS=st,DS=Symbol.for("react.element"),zS=Symbol.for("react.fragment"),LS=Object.prototype.hasOwnProperty,RS=MS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,OS={key:!0,ref:!0,__self:!0,__source:!0};function t1(n,r,o){var h,y={},w=null,x=null;o!==void 0&&(w=""+o),r.key!==void 0&&(w=""+r.key),r.ref!==void 0&&(x=r.ref);for(h in r)LS.call(r,h)&&!OS.hasOwnProperty(h)&&(y[h]=r[h]);if(n&&n.defaultProps)for(h in r=n.defaultProps,r)y[h]===void 0&&(y[h]=r[h]);return{$$typeof:DS,type:n,key:w,ref:x,props:y,_owner:RS.current}}xf.Fragment=zS;xf.jsx=t1;xf.jsxs=t1;Gx.exports=xf;var O=Gx.exports,xg={},r1={exports:{}},Ha={},n1={exports:{}},i1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function r(at,it){var Mt=at.length;at.push(it);e:for(;0<Mt;){var Tt=Mt-1>>>1,jt=at[Tt];if(0<y(jt,it))at[Tt]=it,at[Mt]=jt,Mt=Tt;else break e}}function o(at){return at.length===0?null:at[0]}function h(at){if(at.length===0)return null;var it=at[0],Mt=at.pop();if(Mt!==it){at[0]=Mt;e:for(var Tt=0,jt=at.length,zt=jt>>>1;Tt<zt;){var Sr=2*(Tt+1)-1,br=at[Sr],kr=Sr+1,Mr=at[kr];if(0>y(br,Mt))kr<jt&&0>y(Mr,br)?(at[Tt]=Mr,at[kr]=Mt,Tt=kr):(at[Tt]=br,at[Sr]=Mt,Tt=Sr);else if(kr<jt&&0>y(Mr,Mt))at[Tt]=Mr,at[kr]=Mt,Tt=kr;else break e}}return it}function y(at,it){var Mt=at.sortIndex-it.sortIndex;return Mt!==0?Mt:at.id-it.id}if(typeof performance=="object"&&typeof performance.now=="function"){var w=performance;n.unstable_now=function(){return w.now()}}else{var x=Date,c=x.now();n.unstable_now=function(){return x.now()-c}}var V=[],G=[],Y=1,Q=null,H=3,Le=!1,Be=!1,be=!1,$e=typeof setTimeout=="function"?setTimeout:null,re=typeof clearTimeout=="function"?clearTimeout:null,J=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function le(at){for(var it=o(G);it!==null;){if(it.callback===null)h(G);else if(it.startTime<=at)h(G),it.sortIndex=it.expirationTime,r(V,it);else break;it=o(G)}}function we(at){if(be=!1,le(at),!Be)if(o(V)!==null)Be=!0,Hr(Ze);else{var it=o(G);it!==null&&ar(we,it.startTime-at)}}function Ze(at,it){Be=!1,be&&(be=!1,re(fe),fe=-1),Le=!0;var Mt=H;try{for(le(it),Q=o(V);Q!==null&&(!(Q.expirationTime>it)||at&&!tt());){var Tt=Q.callback;if(typeof Tt=="function"){Q.callback=null,H=Q.priorityLevel;var jt=Tt(Q.expirationTime<=it);it=n.unstable_now(),typeof jt=="function"?Q.callback=jt:Q===o(V)&&h(V),le(it)}else h(V);Q=o(V)}if(Q!==null)var zt=!0;else{var Sr=o(G);Sr!==null&&ar(we,Sr.startTime-it),zt=!1}return zt}finally{Q=null,H=Mt,Le=!1}}var He=!1,Xe=null,fe=-1,ve=5,je=-1;function tt(){return!(n.unstable_now()-je<ve)}function _t(){if(Xe!==null){var at=n.unstable_now();je=at;var it=!0;try{it=Xe(!0,at)}finally{it?Bt():(He=!1,Xe=null)}}else He=!1}var Bt;if(typeof J=="function")Bt=function(){J(_t)};else if(typeof MessageChannel<"u"){var gr=new MessageChannel,Gr=gr.port2;gr.port1.onmessage=_t,Bt=function(){Gr.postMessage(null)}}else Bt=function(){$e(_t,0)};function Hr(at){Xe=at,He||(He=!0,Bt())}function ar(at,it){fe=$e(function(){at(n.unstable_now())},it)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(at){at.callback=null},n.unstable_continueExecution=function(){Be||Le||(Be=!0,Hr(Ze))},n.unstable_forceFrameRate=function(at){0>at||125<at?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ve=0<at?Math.floor(1e3/at):5},n.unstable_getCurrentPriorityLevel=function(){return H},n.unstable_getFirstCallbackNode=function(){return o(V)},n.unstable_next=function(at){switch(H){case 1:case 2:case 3:var it=3;break;default:it=H}var Mt=H;H=it;try{return at()}finally{H=Mt}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(at,it){switch(at){case 1:case 2:case 3:case 4:case 5:break;default:at=3}var Mt=H;H=at;try{return it()}finally{H=Mt}},n.unstable_scheduleCallback=function(at,it,Mt){var Tt=n.unstable_now();switch(typeof Mt=="object"&&Mt!==null?(Mt=Mt.delay,Mt=typeof Mt=="number"&&0<Mt?Tt+Mt:Tt):Mt=Tt,at){case 1:var jt=-1;break;case 2:jt=250;break;case 5:jt=1073741823;break;case 4:jt=1e4;break;default:jt=5e3}return jt=Mt+jt,at={id:Y++,callback:it,priorityLevel:at,startTime:Mt,expirationTime:jt,sortIndex:-1},Mt>Tt?(at.sortIndex=Mt,r(G,at),o(V)===null&&at===o(G)&&(be?(re(fe),fe=-1):be=!0,ar(we,Mt-Tt))):(at.sortIndex=jt,r(V,at),Be||Le||(Be=!0,Hr(Ze))),at},n.unstable_shouldYield=tt,n.unstable_wrapCallback=function(at){var it=H;return function(){var Mt=H;H=it;try{return at.apply(this,arguments)}finally{H=Mt}}}})(i1);n1.exports=i1;var FS=n1.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BS=st,Ka=FS;function pt(n){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+n,o=1;o<arguments.length;o++)r+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+n+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a1=new Set,sd={};function Ru(n,r){Bc(n,r),Bc(n+"Capture",r)}function Bc(n,r){for(sd[n]=r,n=0;n<r.length;n++)a1.add(r[n])}var No=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bg=Object.prototype.hasOwnProperty,NS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,l0={},u0={};function jS(n){return bg.call(u0,n)?!0:bg.call(l0,n)?!1:NS.test(n)?u0[n]=!0:(l0[n]=!0,!1)}function US(n,r,o,h){if(o!==null&&o.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return h?!1:o!==null?!o.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function VS(n,r,o,h){if(r===null||typeof r>"u"||US(n,r,o,h))return!0;if(h)return!1;if(o!==null)switch(o.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function ua(n,r,o,h,y,w,x){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=h,this.attributeNamespace=y,this.mustUseProperty=o,this.propertyName=n,this.type=r,this.sanitizeURL=w,this.removeEmptyString=x}var Di={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Di[n]=new ua(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var r=n[0];Di[r]=new ua(r,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Di[n]=new ua(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Di[n]=new ua(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Di[n]=new ua(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Di[n]=new ua(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Di[n]=new ua(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Di[n]=new ua(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Di[n]=new ua(n,5,!1,n.toLowerCase(),null,!1,!1)});var Sy=/[\-:]([a-z])/g;function ky(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var r=n.replace(Sy,ky);Di[r]=new ua(r,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var r=n.replace(Sy,ky);Di[r]=new ua(r,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var r=n.replace(Sy,ky);Di[r]=new ua(r,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Di[n]=new ua(n,1,!1,n.toLowerCase(),null,!1,!1)});Di.xlinkHref=new ua("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Di[n]=new ua(n,1,!1,n.toLowerCase(),null,!0,!0)});function Cy(n,r,o,h){var y=Di.hasOwnProperty(r)?Di[r]:null;(y!==null?y.type!==0:h||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(VS(r,o,y,h)&&(o=null),h||y===null?jS(r)&&(o===null?n.removeAttribute(r):n.setAttribute(r,""+o)):y.mustUseProperty?n[y.propertyName]=o===null?y.type===3?!1:"":o:(r=y.attributeName,h=y.attributeNamespace,o===null?n.removeAttribute(r):(y=y.type,o=y===3||y===4&&o===!0?"":""+o,h?n.setAttributeNS(h,r,o):n.setAttribute(r,o))))}var $o=BS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,sp=Symbol.for("react.element"),vc=Symbol.for("react.portal"),xc=Symbol.for("react.fragment"),Ty=Symbol.for("react.strict_mode"),wg=Symbol.for("react.profiler"),s1=Symbol.for("react.provider"),o1=Symbol.for("react.context"),Iy=Symbol.for("react.forward_ref"),Sg=Symbol.for("react.suspense"),kg=Symbol.for("react.suspense_list"),Py=Symbol.for("react.memo"),bl=Symbol.for("react.lazy"),l1=Symbol.for("react.offscreen"),c0=Symbol.iterator;function Lh(n){return n===null||typeof n!="object"?null:(n=c0&&n[c0]||n["@@iterator"],typeof n=="function"?n:null)}var On=Object.assign,Nm;function Gh(n){if(Nm===void 0)try{throw Error()}catch(o){var r=o.stack.trim().match(/\n( *(at )?)/);Nm=r&&r[1]||""}return`
`+Nm+n}var jm=!1;function Um(n,r){if(!n||jm)return"";jm=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(G){var h=G}Reflect.construct(n,[],r)}else{try{r.call()}catch(G){h=G}n.call(r.prototype)}else{try{throw Error()}catch(G){h=G}n()}}catch(G){if(G&&h&&typeof G.stack=="string"){for(var y=G.stack.split(`
`),w=h.stack.split(`
`),x=y.length-1,c=w.length-1;1<=x&&0<=c&&y[x]!==w[c];)c--;for(;1<=x&&0<=c;x--,c--)if(y[x]!==w[c]){if(x!==1||c!==1)do if(x--,c--,0>c||y[x]!==w[c]){var V=`
`+y[x].replace(" at new "," at ");return n.displayName&&V.includes("<anonymous>")&&(V=V.replace("<anonymous>",n.displayName)),V}while(1<=x&&0<=c);break}}}finally{jm=!1,Error.prepareStackTrace=o}return(n=n?n.displayName||n.name:"")?Gh(n):""}function $S(n){switch(n.tag){case 5:return Gh(n.type);case 16:return Gh("Lazy");case 13:return Gh("Suspense");case 19:return Gh("SuspenseList");case 0:case 2:case 15:return n=Um(n.type,!1),n;case 11:return n=Um(n.type.render,!1),n;case 1:return n=Um(n.type,!0),n;default:return""}}function Cg(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case xc:return"Fragment";case vc:return"Portal";case wg:return"Profiler";case Ty:return"StrictMode";case Sg:return"Suspense";case kg:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case o1:return(n.displayName||"Context")+".Consumer";case s1:return(n._context.displayName||"Context")+".Provider";case Iy:var r=n.render;return n=n.displayName,n||(n=r.displayName||r.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Py:return r=n.displayName||null,r!==null?r:Cg(n.type)||"Memo";case bl:r=n._payload,n=n._init;try{return Cg(n(r))}catch{}}return null}function qS(n){var r=n.type;switch(n.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=r.render,n=n.displayName||n.name||"",r.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Cg(r);case 8:return r===Ty?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function jl(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function u1(n){var r=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function GS(n){var r=u1(n)?"checked":"value",o=Object.getOwnPropertyDescriptor(n.constructor.prototype,r),h=""+n[r];if(!n.hasOwnProperty(r)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var y=o.get,w=o.set;return Object.defineProperty(n,r,{configurable:!0,get:function(){return y.call(this)},set:function(x){h=""+x,w.call(this,x)}}),Object.defineProperty(n,r,{enumerable:o.enumerable}),{getValue:function(){return h},setValue:function(x){h=""+x},stopTracking:function(){n._valueTracker=null,delete n[r]}}}}function op(n){n._valueTracker||(n._valueTracker=GS(n))}function c1(n){if(!n)return!1;var r=n._valueTracker;if(!r)return!0;var o=r.getValue(),h="";return n&&(h=u1(n)?n.checked?"true":"false":n.value),n=h,n!==o?(r.setValue(n),!0):!1}function Vp(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Tg(n,r){var o=r.checked;return On({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??n._wrapperState.initialChecked})}function h0(n,r){var o=r.defaultValue==null?"":r.defaultValue,h=r.checked!=null?r.checked:r.defaultChecked;o=jl(r.value!=null?r.value:o),n._wrapperState={initialChecked:h,initialValue:o,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function h1(n,r){r=r.checked,r!=null&&Cy(n,"checked",r,!1)}function Ig(n,r){h1(n,r);var o=jl(r.value),h=r.type;if(o!=null)h==="number"?(o===0&&n.value===""||n.value!=o)&&(n.value=""+o):n.value!==""+o&&(n.value=""+o);else if(h==="submit"||h==="reset"){n.removeAttribute("value");return}r.hasOwnProperty("value")?Pg(n,r.type,o):r.hasOwnProperty("defaultValue")&&Pg(n,r.type,jl(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(n.defaultChecked=!!r.defaultChecked)}function d0(n,r,o){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var h=r.type;if(!(h!=="submit"&&h!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+n._wrapperState.initialValue,o||r===n.value||(n.value=r),n.defaultValue=r}o=n.name,o!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,o!==""&&(n.name=o)}function Pg(n,r,o){(r!=="number"||Vp(n.ownerDocument)!==n)&&(o==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+o&&(n.defaultValue=""+o))}var Kh=Array.isArray;function Mc(n,r,o,h){if(n=n.options,r){r={};for(var y=0;y<o.length;y++)r["$"+o[y]]=!0;for(o=0;o<n.length;o++)y=r.hasOwnProperty("$"+n[o].value),n[o].selected!==y&&(n[o].selected=y),y&&h&&(n[o].defaultSelected=!0)}else{for(o=""+jl(o),r=null,y=0;y<n.length;y++){if(n[y].value===o){n[y].selected=!0,h&&(n[y].defaultSelected=!0);return}r!==null||n[y].disabled||(r=n[y])}r!==null&&(r.selected=!0)}}function Eg(n,r){if(r.dangerouslySetInnerHTML!=null)throw Error(pt(91));return On({},r,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function p0(n,r){var o=r.value;if(o==null){if(o=r.children,r=r.defaultValue,o!=null){if(r!=null)throw Error(pt(92));if(Kh(o)){if(1<o.length)throw Error(pt(93));o=o[0]}r=o}r==null&&(r=""),o=r}n._wrapperState={initialValue:jl(o)}}function d1(n,r){var o=jl(r.value),h=jl(r.defaultValue);o!=null&&(o=""+o,o!==n.value&&(n.value=o),r.defaultValue==null&&n.defaultValue!==o&&(n.defaultValue=o)),h!=null&&(n.defaultValue=""+h)}function f0(n){var r=n.textContent;r===n._wrapperState.initialValue&&r!==""&&r!==null&&(n.value=r)}function p1(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ag(n,r){return n==null||n==="http://www.w3.org/1999/xhtml"?p1(r):n==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var lp,f1=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,o,h,y){MSApp.execUnsafeLocalFunction(function(){return n(r,o,h,y)})}:n}(function(n,r){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=r;else{for(lp=lp||document.createElement("div"),lp.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=lp.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;r.firstChild;)n.appendChild(r.firstChild)}});function od(n,r){if(r){var o=n.firstChild;if(o&&o===n.lastChild&&o.nodeType===3){o.nodeValue=r;return}}n.textContent=r}var Zh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},KS=["Webkit","ms","Moz","O"];Object.keys(Zh).forEach(function(n){KS.forEach(function(r){r=r+n.charAt(0).toUpperCase()+n.substring(1),Zh[r]=Zh[n]})});function m1(n,r,o){return r==null||typeof r=="boolean"||r===""?"":o||typeof r!="number"||r===0||Zh.hasOwnProperty(n)&&Zh[n]?(""+r).trim():r+"px"}function g1(n,r){n=n.style;for(var o in r)if(r.hasOwnProperty(o)){var h=o.indexOf("--")===0,y=m1(o,r[o],h);o==="float"&&(o="cssFloat"),h?n.setProperty(o,y):n[o]=y}}var HS=On({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Mg(n,r){if(r){if(HS[n]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(pt(137,n));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(pt(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(pt(61))}if(r.style!=null&&typeof r.style!="object")throw Error(pt(62))}}function Dg(n,r){if(n.indexOf("-")===-1)return typeof r.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zg=null;function Ey(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Lg=null,Dc=null,zc=null;function m0(n){if(n=Id(n)){if(typeof Lg!="function")throw Error(pt(280));var r=n.stateNode;r&&(r=Cf(r),Lg(n.stateNode,n.type,r))}}function y1(n){Dc?zc?zc.push(n):zc=[n]:Dc=n}function _1(){if(Dc){var n=Dc,r=zc;if(zc=Dc=null,m0(n),r)for(n=0;n<r.length;n++)m0(r[n])}}function v1(n,r){return n(r)}function x1(){}var Vm=!1;function b1(n,r,o){if(Vm)return n(r,o);Vm=!0;try{return v1(n,r,o)}finally{Vm=!1,(Dc!==null||zc!==null)&&(x1(),_1())}}function ld(n,r){var o=n.stateNode;if(o===null)return null;var h=Cf(o);if(h===null)return null;o=h[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(n=n.type,h=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!h;break e;default:n=!1}if(n)return null;if(o&&typeof o!="function")throw Error(pt(231,r,typeof o));return o}var Rg=!1;if(No)try{var Rh={};Object.defineProperty(Rh,"passive",{get:function(){Rg=!0}}),window.addEventListener("test",Rh,Rh),window.removeEventListener("test",Rh,Rh)}catch{Rg=!1}function WS(n,r,o,h,y,w,x,c,V){var G=Array.prototype.slice.call(arguments,3);try{r.apply(o,G)}catch(Y){this.onError(Y)}}var Xh=!1,$p=null,qp=!1,Og=null,ZS={onError:function(n){Xh=!0,$p=n}};function XS(n,r,o,h,y,w,x,c,V){Xh=!1,$p=null,WS.apply(ZS,arguments)}function YS(n,r,o,h,y,w,x,c,V){if(XS.apply(this,arguments),Xh){if(Xh){var G=$p;Xh=!1,$p=null}else throw Error(pt(198));qp||(qp=!0,Og=G)}}function Ou(n){var r=n,o=n;if(n.alternate)for(;r.return;)r=r.return;else{n=r;do r=n,r.flags&4098&&(o=r.return),n=r.return;while(n)}return r.tag===3?o:null}function w1(n){if(n.tag===13){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function g0(n){if(Ou(n)!==n)throw Error(pt(188))}function JS(n){var r=n.alternate;if(!r){if(r=Ou(n),r===null)throw Error(pt(188));return r!==n?null:n}for(var o=n,h=r;;){var y=o.return;if(y===null)break;var w=y.alternate;if(w===null){if(h=y.return,h!==null){o=h;continue}break}if(y.child===w.child){for(w=y.child;w;){if(w===o)return g0(y),n;if(w===h)return g0(y),r;w=w.sibling}throw Error(pt(188))}if(o.return!==h.return)o=y,h=w;else{for(var x=!1,c=y.child;c;){if(c===o){x=!0,o=y,h=w;break}if(c===h){x=!0,h=y,o=w;break}c=c.sibling}if(!x){for(c=w.child;c;){if(c===o){x=!0,o=w,h=y;break}if(c===h){x=!0,h=w,o=y;break}c=c.sibling}if(!x)throw Error(pt(189))}}if(o.alternate!==h)throw Error(pt(190))}if(o.tag!==3)throw Error(pt(188));return o.stateNode.current===o?n:r}function S1(n){return n=JS(n),n!==null?k1(n):null}function k1(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var r=k1(n);if(r!==null)return r;n=n.sibling}return null}var C1=Ka.unstable_scheduleCallback,y0=Ka.unstable_cancelCallback,QS=Ka.unstable_shouldYield,ek=Ka.unstable_requestPaint,Gn=Ka.unstable_now,tk=Ka.unstable_getCurrentPriorityLevel,Ay=Ka.unstable_ImmediatePriority,T1=Ka.unstable_UserBlockingPriority,Gp=Ka.unstable_NormalPriority,rk=Ka.unstable_LowPriority,I1=Ka.unstable_IdlePriority,bf=null,oo=null;function nk(n){if(oo&&typeof oo.onCommitFiberRoot=="function")try{oo.onCommitFiberRoot(bf,n,void 0,(n.current.flags&128)===128)}catch{}}var Ls=Math.clz32?Math.clz32:sk,ik=Math.log,ak=Math.LN2;function sk(n){return n>>>=0,n===0?32:31-(ik(n)/ak|0)|0}var up=64,cp=4194304;function Hh(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Kp(n,r){var o=n.pendingLanes;if(o===0)return 0;var h=0,y=n.suspendedLanes,w=n.pingedLanes,x=o&268435455;if(x!==0){var c=x&~y;c!==0?h=Hh(c):(w&=x,w!==0&&(h=Hh(w)))}else x=o&~y,x!==0?h=Hh(x):w!==0&&(h=Hh(w));if(h===0)return 0;if(r!==0&&r!==h&&!(r&y)&&(y=h&-h,w=r&-r,y>=w||y===16&&(w&4194240)!==0))return r;if(h&4&&(h|=o&16),r=n.entangledLanes,r!==0)for(n=n.entanglements,r&=h;0<r;)o=31-Ls(r),y=1<<o,h|=n[o],r&=~y;return h}function ok(n,r){switch(n){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lk(n,r){for(var o=n.suspendedLanes,h=n.pingedLanes,y=n.expirationTimes,w=n.pendingLanes;0<w;){var x=31-Ls(w),c=1<<x,V=y[x];V===-1?(!(c&o)||c&h)&&(y[x]=ok(c,r)):V<=r&&(n.expiredLanes|=c),w&=~c}}function Fg(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function P1(){var n=up;return up<<=1,!(up&4194240)&&(up=64),n}function $m(n){for(var r=[],o=0;31>o;o++)r.push(n);return r}function Cd(n,r,o){n.pendingLanes|=r,r!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,r=31-Ls(r),n[r]=o}function uk(n,r){var o=n.pendingLanes&~r;n.pendingLanes=r,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=r,n.mutableReadLanes&=r,n.entangledLanes&=r,r=n.entanglements;var h=n.eventTimes;for(n=n.expirationTimes;0<o;){var y=31-Ls(o),w=1<<y;r[y]=0,h[y]=-1,n[y]=-1,o&=~w}}function My(n,r){var o=n.entangledLanes|=r;for(n=n.entanglements;o;){var h=31-Ls(o),y=1<<h;y&r|n[h]&r&&(n[h]|=r),o&=~y}}var rn=0;function E1(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var A1,Dy,M1,D1,z1,Bg=!1,hp=[],Ml=null,Dl=null,zl=null,ud=new Map,cd=new Map,Sl=[],ck="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function _0(n,r){switch(n){case"focusin":case"focusout":Ml=null;break;case"dragenter":case"dragleave":Dl=null;break;case"mouseover":case"mouseout":zl=null;break;case"pointerover":case"pointerout":ud.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":cd.delete(r.pointerId)}}function Oh(n,r,o,h,y,w){return n===null||n.nativeEvent!==w?(n={blockedOn:r,domEventName:o,eventSystemFlags:h,nativeEvent:w,targetContainers:[y]},r!==null&&(r=Id(r),r!==null&&Dy(r)),n):(n.eventSystemFlags|=h,r=n.targetContainers,y!==null&&r.indexOf(y)===-1&&r.push(y),n)}function hk(n,r,o,h,y){switch(r){case"focusin":return Ml=Oh(Ml,n,r,o,h,y),!0;case"dragenter":return Dl=Oh(Dl,n,r,o,h,y),!0;case"mouseover":return zl=Oh(zl,n,r,o,h,y),!0;case"pointerover":var w=y.pointerId;return ud.set(w,Oh(ud.get(w)||null,n,r,o,h,y)),!0;case"gotpointercapture":return w=y.pointerId,cd.set(w,Oh(cd.get(w)||null,n,r,o,h,y)),!0}return!1}function L1(n){var r=_u(n.target);if(r!==null){var o=Ou(r);if(o!==null){if(r=o.tag,r===13){if(r=w1(o),r!==null){n.blockedOn=r,z1(n.priority,function(){M1(o)});return}}else if(r===3&&o.stateNode.current.memoizedState.isDehydrated){n.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Pp(n){if(n.blockedOn!==null)return!1;for(var r=n.targetContainers;0<r.length;){var o=Ng(n.domEventName,n.eventSystemFlags,r[0],n.nativeEvent);if(o===null){o=n.nativeEvent;var h=new o.constructor(o.type,o);zg=h,o.target.dispatchEvent(h),zg=null}else return r=Id(o),r!==null&&Dy(r),n.blockedOn=o,!1;r.shift()}return!0}function v0(n,r,o){Pp(n)&&o.delete(r)}function dk(){Bg=!1,Ml!==null&&Pp(Ml)&&(Ml=null),Dl!==null&&Pp(Dl)&&(Dl=null),zl!==null&&Pp(zl)&&(zl=null),ud.forEach(v0),cd.forEach(v0)}function Fh(n,r){n.blockedOn===r&&(n.blockedOn=null,Bg||(Bg=!0,Ka.unstable_scheduleCallback(Ka.unstable_NormalPriority,dk)))}function hd(n){function r(y){return Fh(y,n)}if(0<hp.length){Fh(hp[0],n);for(var o=1;o<hp.length;o++){var h=hp[o];h.blockedOn===n&&(h.blockedOn=null)}}for(Ml!==null&&Fh(Ml,n),Dl!==null&&Fh(Dl,n),zl!==null&&Fh(zl,n),ud.forEach(r),cd.forEach(r),o=0;o<Sl.length;o++)h=Sl[o],h.blockedOn===n&&(h.blockedOn=null);for(;0<Sl.length&&(o=Sl[0],o.blockedOn===null);)L1(o),o.blockedOn===null&&Sl.shift()}var Lc=$o.ReactCurrentBatchConfig,Hp=!0;function pk(n,r,o,h){var y=rn,w=Lc.transition;Lc.transition=null;try{rn=1,zy(n,r,o,h)}finally{rn=y,Lc.transition=w}}function fk(n,r,o,h){var y=rn,w=Lc.transition;Lc.transition=null;try{rn=4,zy(n,r,o,h)}finally{rn=y,Lc.transition=w}}function zy(n,r,o,h){if(Hp){var y=Ng(n,r,o,h);if(y===null)Qm(n,r,h,Wp,o),_0(n,h);else if(hk(y,n,r,o,h))h.stopPropagation();else if(_0(n,h),r&4&&-1<ck.indexOf(n)){for(;y!==null;){var w=Id(y);if(w!==null&&A1(w),w=Ng(n,r,o,h),w===null&&Qm(n,r,h,Wp,o),w===y)break;y=w}y!==null&&h.stopPropagation()}else Qm(n,r,h,null,o)}}var Wp=null;function Ng(n,r,o,h){if(Wp=null,n=Ey(h),n=_u(n),n!==null)if(r=Ou(n),r===null)n=null;else if(o=r.tag,o===13){if(n=w1(r),n!==null)return n;n=null}else if(o===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null);return Wp=n,null}function R1(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tk()){case Ay:return 1;case T1:return 4;case Gp:case rk:return 16;case I1:return 536870912;default:return 16}default:return 16}}var Cl=null,Ly=null,Ep=null;function O1(){if(Ep)return Ep;var n,r=Ly,o=r.length,h,y="value"in Cl?Cl.value:Cl.textContent,w=y.length;for(n=0;n<o&&r[n]===y[n];n++);var x=o-n;for(h=1;h<=x&&r[o-h]===y[w-h];h++);return Ep=y.slice(n,1<h?1-h:void 0)}function Ap(n){var r=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&r===13&&(n=13)):n=r,n===10&&(n=13),32<=n||n===13?n:0}function dp(){return!0}function x0(){return!1}function Wa(n){function r(o,h,y,w,x){this._reactName=o,this._targetInst=y,this.type=h,this.nativeEvent=w,this.target=x,this.currentTarget=null;for(var c in n)n.hasOwnProperty(c)&&(o=n[c],this[c]=o?o(w):w[c]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?dp:x0,this.isPropagationStopped=x0,this}return On(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=dp)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=dp)},persist:function(){},isPersistent:dp}),r}var Kc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ry=Wa(Kc),Td=On({},Kc,{view:0,detail:0}),mk=Wa(Td),qm,Gm,Bh,wf=On({},Td,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Oy,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Bh&&(Bh&&n.type==="mousemove"?(qm=n.screenX-Bh.screenX,Gm=n.screenY-Bh.screenY):Gm=qm=0,Bh=n),qm)},movementY:function(n){return"movementY"in n?n.movementY:Gm}}),b0=Wa(wf),gk=On({},wf,{dataTransfer:0}),yk=Wa(gk),_k=On({},Td,{relatedTarget:0}),Km=Wa(_k),vk=On({},Kc,{animationName:0,elapsedTime:0,pseudoElement:0}),xk=Wa(vk),bk=On({},Kc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),wk=Wa(bk),Sk=On({},Kc,{data:0}),w0=Wa(Sk),kk={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ck={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tk={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ik(n){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(n):(n=Tk[n])?!!r[n]:!1}function Oy(){return Ik}var Pk=On({},Td,{key:function(n){if(n.key){var r=kk[n.key]||n.key;if(r!=="Unidentified")return r}return n.type==="keypress"?(n=Ap(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Ck[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Oy,charCode:function(n){return n.type==="keypress"?Ap(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Ap(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Ek=Wa(Pk),Ak=On({},wf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),S0=Wa(Ak),Mk=On({},Td,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Oy}),Dk=Wa(Mk),zk=On({},Kc,{propertyName:0,elapsedTime:0,pseudoElement:0}),Lk=Wa(zk),Rk=On({},wf,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Ok=Wa(Rk),Fk=[9,13,27,32],Fy=No&&"CompositionEvent"in window,Yh=null;No&&"documentMode"in document&&(Yh=document.documentMode);var Bk=No&&"TextEvent"in window&&!Yh,F1=No&&(!Fy||Yh&&8<Yh&&11>=Yh),k0=" ",C0=!1;function B1(n,r){switch(n){case"keyup":return Fk.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function N1(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var bc=!1;function Nk(n,r){switch(n){case"compositionend":return N1(r);case"keypress":return r.which!==32?null:(C0=!0,k0);case"textInput":return n=r.data,n===k0&&C0?null:n;default:return null}}function jk(n,r){if(bc)return n==="compositionend"||!Fy&&B1(n,r)?(n=O1(),Ep=Ly=Cl=null,bc=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return F1&&r.locale!=="ko"?null:r.data;default:return null}}var Uk={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function T0(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r==="input"?!!Uk[n.type]:r==="textarea"}function j1(n,r,o,h){y1(h),r=Zp(r,"onChange"),0<r.length&&(o=new Ry("onChange","change",null,o,h),n.push({event:o,listeners:r}))}var Jh=null,dd=null;function Vk(n){Y1(n,0)}function Sf(n){var r=kc(n);if(c1(r))return n}function $k(n,r){if(n==="change")return r}var U1=!1;if(No){var Hm;if(No){var Wm="oninput"in document;if(!Wm){var I0=document.createElement("div");I0.setAttribute("oninput","return;"),Wm=typeof I0.oninput=="function"}Hm=Wm}else Hm=!1;U1=Hm&&(!document.documentMode||9<document.documentMode)}function P0(){Jh&&(Jh.detachEvent("onpropertychange",V1),dd=Jh=null)}function V1(n){if(n.propertyName==="value"&&Sf(dd)){var r=[];j1(r,dd,n,Ey(n)),b1(Vk,r)}}function qk(n,r,o){n==="focusin"?(P0(),Jh=r,dd=o,Jh.attachEvent("onpropertychange",V1)):n==="focusout"&&P0()}function Gk(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Sf(dd)}function Kk(n,r){if(n==="click")return Sf(r)}function Hk(n,r){if(n==="input"||n==="change")return Sf(r)}function Wk(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var Os=typeof Object.is=="function"?Object.is:Wk;function pd(n,r){if(Os(n,r))return!0;if(typeof n!="object"||n===null||typeof r!="object"||r===null)return!1;var o=Object.keys(n),h=Object.keys(r);if(o.length!==h.length)return!1;for(h=0;h<o.length;h++){var y=o[h];if(!bg.call(r,y)||!Os(n[y],r[y]))return!1}return!0}function E0(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function A0(n,r){var o=E0(n);n=0;for(var h;o;){if(o.nodeType===3){if(h=n+o.textContent.length,n<=r&&h>=r)return{node:o,offset:r-n};n=h}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=E0(o)}}function $1(n,r){return n&&r?n===r?!0:n&&n.nodeType===3?!1:r&&r.nodeType===3?$1(n,r.parentNode):"contains"in n?n.contains(r):n.compareDocumentPosition?!!(n.compareDocumentPosition(r)&16):!1:!1}function q1(){for(var n=window,r=Vp();r instanceof n.HTMLIFrameElement;){try{var o=typeof r.contentWindow.location.href=="string"}catch{o=!1}if(o)n=r.contentWindow;else break;r=Vp(n.document)}return r}function By(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r&&(r==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||r==="textarea"||n.contentEditable==="true")}function Zk(n){var r=q1(),o=n.focusedElem,h=n.selectionRange;if(r!==o&&o&&o.ownerDocument&&$1(o.ownerDocument.documentElement,o)){if(h!==null&&By(o)){if(r=h.start,n=h.end,n===void 0&&(n=r),"selectionStart"in o)o.selectionStart=r,o.selectionEnd=Math.min(n,o.value.length);else if(n=(r=o.ownerDocument||document)&&r.defaultView||window,n.getSelection){n=n.getSelection();var y=o.textContent.length,w=Math.min(h.start,y);h=h.end===void 0?w:Math.min(h.end,y),!n.extend&&w>h&&(y=h,h=w,w=y),y=A0(o,w);var x=A0(o,h);y&&x&&(n.rangeCount!==1||n.anchorNode!==y.node||n.anchorOffset!==y.offset||n.focusNode!==x.node||n.focusOffset!==x.offset)&&(r=r.createRange(),r.setStart(y.node,y.offset),n.removeAllRanges(),w>h?(n.addRange(r),n.extend(x.node,x.offset)):(r.setEnd(x.node,x.offset),n.addRange(r)))}}for(r=[],n=o;n=n.parentNode;)n.nodeType===1&&r.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<r.length;o++)n=r[o],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Xk=No&&"documentMode"in document&&11>=document.documentMode,wc=null,jg=null,Qh=null,Ug=!1;function M0(n,r,o){var h=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Ug||wc==null||wc!==Vp(h)||(h=wc,"selectionStart"in h&&By(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Qh&&pd(Qh,h)||(Qh=h,h=Zp(jg,"onSelect"),0<h.length&&(r=new Ry("onSelect","select",null,r,o),n.push({event:r,listeners:h}),r.target=wc)))}function pp(n,r){var o={};return o[n.toLowerCase()]=r.toLowerCase(),o["Webkit"+n]="webkit"+r,o["Moz"+n]="moz"+r,o}var Sc={animationend:pp("Animation","AnimationEnd"),animationiteration:pp("Animation","AnimationIteration"),animationstart:pp("Animation","AnimationStart"),transitionend:pp("Transition","TransitionEnd")},Zm={},G1={};No&&(G1=document.createElement("div").style,"AnimationEvent"in window||(delete Sc.animationend.animation,delete Sc.animationiteration.animation,delete Sc.animationstart.animation),"TransitionEvent"in window||delete Sc.transitionend.transition);function kf(n){if(Zm[n])return Zm[n];if(!Sc[n])return n;var r=Sc[n],o;for(o in r)if(r.hasOwnProperty(o)&&o in G1)return Zm[n]=r[o];return n}var K1=kf("animationend"),H1=kf("animationiteration"),W1=kf("animationstart"),Z1=kf("transitionend"),X1=new Map,D0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Vl(n,r){X1.set(n,r),Ru(r,[n])}for(var Xm=0;Xm<D0.length;Xm++){var Ym=D0[Xm],Yk=Ym.toLowerCase(),Jk=Ym[0].toUpperCase()+Ym.slice(1);Vl(Yk,"on"+Jk)}Vl(K1,"onAnimationEnd");Vl(H1,"onAnimationIteration");Vl(W1,"onAnimationStart");Vl("dblclick","onDoubleClick");Vl("focusin","onFocus");Vl("focusout","onBlur");Vl(Z1,"onTransitionEnd");Bc("onMouseEnter",["mouseout","mouseover"]);Bc("onMouseLeave",["mouseout","mouseover"]);Bc("onPointerEnter",["pointerout","pointerover"]);Bc("onPointerLeave",["pointerout","pointerover"]);Ru("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ru("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ru("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ru("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ru("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ru("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qk=new Set("cancel close invalid load scroll toggle".split(" ").concat(Wh));function z0(n,r,o){var h=n.type||"unknown-event";n.currentTarget=o,YS(h,r,void 0,n),n.currentTarget=null}function Y1(n,r){r=(r&4)!==0;for(var o=0;o<n.length;o++){var h=n[o],y=h.event;h=h.listeners;e:{var w=void 0;if(r)for(var x=h.length-1;0<=x;x--){var c=h[x],V=c.instance,G=c.currentTarget;if(c=c.listener,V!==w&&y.isPropagationStopped())break e;z0(y,c,G),w=V}else for(x=0;x<h.length;x++){if(c=h[x],V=c.instance,G=c.currentTarget,c=c.listener,V!==w&&y.isPropagationStopped())break e;z0(y,c,G),w=V}}}if(qp)throw n=Og,qp=!1,Og=null,n}function bn(n,r){var o=r[Kg];o===void 0&&(o=r[Kg]=new Set);var h=n+"__bubble";o.has(h)||(J1(r,n,2,!1),o.add(h))}function Jm(n,r,o){var h=0;r&&(h|=4),J1(o,n,h,r)}var fp="_reactListening"+Math.random().toString(36).slice(2);function fd(n){if(!n[fp]){n[fp]=!0,a1.forEach(function(o){o!=="selectionchange"&&(Qk.has(o)||Jm(o,!1,n),Jm(o,!0,n))});var r=n.nodeType===9?n:n.ownerDocument;r===null||r[fp]||(r[fp]=!0,Jm("selectionchange",!1,r))}}function J1(n,r,o,h){switch(R1(r)){case 1:var y=pk;break;case 4:y=fk;break;default:y=zy}o=y.bind(null,r,o,n),y=void 0,!Rg||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(y=!0),h?y!==void 0?n.addEventListener(r,o,{capture:!0,passive:y}):n.addEventListener(r,o,!0):y!==void 0?n.addEventListener(r,o,{passive:y}):n.addEventListener(r,o,!1)}function Qm(n,r,o,h,y){var w=h;if(!(r&1)&&!(r&2)&&h!==null)e:for(;;){if(h===null)return;var x=h.tag;if(x===3||x===4){var c=h.stateNode.containerInfo;if(c===y||c.nodeType===8&&c.parentNode===y)break;if(x===4)for(x=h.return;x!==null;){var V=x.tag;if((V===3||V===4)&&(V=x.stateNode.containerInfo,V===y||V.nodeType===8&&V.parentNode===y))return;x=x.return}for(;c!==null;){if(x=_u(c),x===null)return;if(V=x.tag,V===5||V===6){h=w=x;continue e}c=c.parentNode}}h=h.return}b1(function(){var G=w,Y=Ey(o),Q=[];e:{var H=X1.get(n);if(H!==void 0){var Le=Ry,Be=n;switch(n){case"keypress":if(Ap(o)===0)break e;case"keydown":case"keyup":Le=Ek;break;case"focusin":Be="focus",Le=Km;break;case"focusout":Be="blur",Le=Km;break;case"beforeblur":case"afterblur":Le=Km;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Le=b0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Le=yk;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Le=Dk;break;case K1:case H1:case W1:Le=xk;break;case Z1:Le=Lk;break;case"scroll":Le=mk;break;case"wheel":Le=Ok;break;case"copy":case"cut":case"paste":Le=wk;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Le=S0}var be=(r&4)!==0,$e=!be&&n==="scroll",re=be?H!==null?H+"Capture":null:H;be=[];for(var J=G,le;J!==null;){le=J;var we=le.stateNode;if(le.tag===5&&we!==null&&(le=we,re!==null&&(we=ld(J,re),we!=null&&be.push(md(J,we,le)))),$e)break;J=J.return}0<be.length&&(H=new Le(H,Be,null,o,Y),Q.push({event:H,listeners:be}))}}if(!(r&7)){e:{if(H=n==="mouseover"||n==="pointerover",Le=n==="mouseout"||n==="pointerout",H&&o!==zg&&(Be=o.relatedTarget||o.fromElement)&&(_u(Be)||Be[jo]))break e;if((Le||H)&&(H=Y.window===Y?Y:(H=Y.ownerDocument)?H.defaultView||H.parentWindow:window,Le?(Be=o.relatedTarget||o.toElement,Le=G,Be=Be?_u(Be):null,Be!==null&&($e=Ou(Be),Be!==$e||Be.tag!==5&&Be.tag!==6)&&(Be=null)):(Le=null,Be=G),Le!==Be)){if(be=b0,we="onMouseLeave",re="onMouseEnter",J="mouse",(n==="pointerout"||n==="pointerover")&&(be=S0,we="onPointerLeave",re="onPointerEnter",J="pointer"),$e=Le==null?H:kc(Le),le=Be==null?H:kc(Be),H=new be(we,J+"leave",Le,o,Y),H.target=$e,H.relatedTarget=le,we=null,_u(Y)===G&&(be=new be(re,J+"enter",Be,o,Y),be.target=le,be.relatedTarget=$e,we=be),$e=we,Le&&Be)t:{for(be=Le,re=Be,J=0,le=be;le;le=gc(le))J++;for(le=0,we=re;we;we=gc(we))le++;for(;0<J-le;)be=gc(be),J--;for(;0<le-J;)re=gc(re),le--;for(;J--;){if(be===re||re!==null&&be===re.alternate)break t;be=gc(be),re=gc(re)}be=null}else be=null;Le!==null&&L0(Q,H,Le,be,!1),Be!==null&&$e!==null&&L0(Q,$e,Be,be,!0)}}e:{if(H=G?kc(G):window,Le=H.nodeName&&H.nodeName.toLowerCase(),Le==="select"||Le==="input"&&H.type==="file")var Ze=$k;else if(T0(H))if(U1)Ze=Hk;else{Ze=Gk;var He=qk}else(Le=H.nodeName)&&Le.toLowerCase()==="input"&&(H.type==="checkbox"||H.type==="radio")&&(Ze=Kk);if(Ze&&(Ze=Ze(n,G))){j1(Q,Ze,o,Y);break e}He&&He(n,H,G),n==="focusout"&&(He=H._wrapperState)&&He.controlled&&H.type==="number"&&Pg(H,"number",H.value)}switch(He=G?kc(G):window,n){case"focusin":(T0(He)||He.contentEditable==="true")&&(wc=He,jg=G,Qh=null);break;case"focusout":Qh=jg=wc=null;break;case"mousedown":Ug=!0;break;case"contextmenu":case"mouseup":case"dragend":Ug=!1,M0(Q,o,Y);break;case"selectionchange":if(Xk)break;case"keydown":case"keyup":M0(Q,o,Y)}var Xe;if(Fy)e:{switch(n){case"compositionstart":var fe="onCompositionStart";break e;case"compositionend":fe="onCompositionEnd";break e;case"compositionupdate":fe="onCompositionUpdate";break e}fe=void 0}else bc?B1(n,o)&&(fe="onCompositionEnd"):n==="keydown"&&o.keyCode===229&&(fe="onCompositionStart");fe&&(F1&&o.locale!=="ko"&&(bc||fe!=="onCompositionStart"?fe==="onCompositionEnd"&&bc&&(Xe=O1()):(Cl=Y,Ly="value"in Cl?Cl.value:Cl.textContent,bc=!0)),He=Zp(G,fe),0<He.length&&(fe=new w0(fe,n,null,o,Y),Q.push({event:fe,listeners:He}),Xe?fe.data=Xe:(Xe=N1(o),Xe!==null&&(fe.data=Xe)))),(Xe=Bk?Nk(n,o):jk(n,o))&&(G=Zp(G,"onBeforeInput"),0<G.length&&(Y=new w0("onBeforeInput","beforeinput",null,o,Y),Q.push({event:Y,listeners:G}),Y.data=Xe))}Y1(Q,r)})}function md(n,r,o){return{instance:n,listener:r,currentTarget:o}}function Zp(n,r){for(var o=r+"Capture",h=[];n!==null;){var y=n,w=y.stateNode;y.tag===5&&w!==null&&(y=w,w=ld(n,o),w!=null&&h.unshift(md(n,w,y)),w=ld(n,r),w!=null&&h.push(md(n,w,y))),n=n.return}return h}function gc(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function L0(n,r,o,h,y){for(var w=r._reactName,x=[];o!==null&&o!==h;){var c=o,V=c.alternate,G=c.stateNode;if(V!==null&&V===h)break;c.tag===5&&G!==null&&(c=G,y?(V=ld(o,w),V!=null&&x.unshift(md(o,V,c))):y||(V=ld(o,w),V!=null&&x.push(md(o,V,c)))),o=o.return}x.length!==0&&n.push({event:r,listeners:x})}var eC=/\r\n?/g,tC=/\u0000|\uFFFD/g;function R0(n){return(typeof n=="string"?n:""+n).replace(eC,`
`).replace(tC,"")}function mp(n,r,o){if(r=R0(r),R0(n)!==r&&o)throw Error(pt(425))}function Xp(){}var Vg=null,$g=null;function qg(n,r){return n==="textarea"||n==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Gg=typeof setTimeout=="function"?setTimeout:void 0,rC=typeof clearTimeout=="function"?clearTimeout:void 0,O0=typeof Promise=="function"?Promise:void 0,nC=typeof queueMicrotask=="function"?queueMicrotask:typeof O0<"u"?function(n){return O0.resolve(null).then(n).catch(iC)}:Gg;function iC(n){setTimeout(function(){throw n})}function eg(n,r){var o=r,h=0;do{var y=o.nextSibling;if(n.removeChild(o),y&&y.nodeType===8)if(o=y.data,o==="/$"){if(h===0){n.removeChild(y),hd(r);return}h--}else o!=="$"&&o!=="$?"&&o!=="$!"||h++;o=y}while(o);hd(r)}function Ll(n){for(;n!=null;n=n.nextSibling){var r=n.nodeType;if(r===1||r===3)break;if(r===8){if(r=n.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return n}function F0(n){n=n.previousSibling;for(var r=0;n;){if(n.nodeType===8){var o=n.data;if(o==="$"||o==="$!"||o==="$?"){if(r===0)return n;r--}else o==="/$"&&r++}n=n.previousSibling}return null}var Hc=Math.random().toString(36).slice(2),so="__reactFiber$"+Hc,gd="__reactProps$"+Hc,jo="__reactContainer$"+Hc,Kg="__reactEvents$"+Hc,aC="__reactListeners$"+Hc,sC="__reactHandles$"+Hc;function _u(n){var r=n[so];if(r)return r;for(var o=n.parentNode;o;){if(r=o[jo]||o[so]){if(o=r.alternate,r.child!==null||o!==null&&o.child!==null)for(n=F0(n);n!==null;){if(o=n[so])return o;n=F0(n)}return r}n=o,o=n.parentNode}return null}function Id(n){return n=n[so]||n[jo],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function kc(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(pt(33))}function Cf(n){return n[gd]||null}var Hg=[],Cc=-1;function $l(n){return{current:n}}function wn(n){0>Cc||(n.current=Hg[Cc],Hg[Cc]=null,Cc--)}function yn(n,r){Cc++,Hg[Cc]=n.current,n.current=r}var Ul={},Zi=$l(Ul),Ta=$l(!1),Tu=Ul;function Nc(n,r){var o=n.type.contextTypes;if(!o)return Ul;var h=n.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===r)return h.__reactInternalMemoizedMaskedChildContext;var y={},w;for(w in o)y[w]=r[w];return h&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=y),y}function Ia(n){return n=n.childContextTypes,n!=null}function Yp(){wn(Ta),wn(Zi)}function B0(n,r,o){if(Zi.current!==Ul)throw Error(pt(168));yn(Zi,r),yn(Ta,o)}function Q1(n,r,o){var h=n.stateNode;if(r=r.childContextTypes,typeof h.getChildContext!="function")return o;h=h.getChildContext();for(var y in h)if(!(y in r))throw Error(pt(108,qS(n)||"Unknown",y));return On({},o,h)}function Jp(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Ul,Tu=Zi.current,yn(Zi,n),yn(Ta,Ta.current),!0}function N0(n,r,o){var h=n.stateNode;if(!h)throw Error(pt(169));o?(n=Q1(n,r,Tu),h.__reactInternalMemoizedMergedChildContext=n,wn(Ta),wn(Zi),yn(Zi,n)):wn(Ta),yn(Ta,o)}var Ro=null,Tf=!1,tg=!1;function eb(n){Ro===null?Ro=[n]:Ro.push(n)}function oC(n){Tf=!0,eb(n)}function ql(){if(!tg&&Ro!==null){tg=!0;var n=0,r=rn;try{var o=Ro;for(rn=1;n<o.length;n++){var h=o[n];do h=h(!0);while(h!==null)}Ro=null,Tf=!1}catch(y){throw Ro!==null&&(Ro=Ro.slice(n+1)),C1(Ay,ql),y}finally{rn=r,tg=!1}}return null}var Tc=[],Ic=0,Qp=null,ef=0,hs=[],ds=0,Iu=null,Oo=1,Fo="";function mu(n,r){Tc[Ic++]=ef,Tc[Ic++]=Qp,Qp=n,ef=r}function tb(n,r,o){hs[ds++]=Oo,hs[ds++]=Fo,hs[ds++]=Iu,Iu=n;var h=Oo;n=Fo;var y=32-Ls(h)-1;h&=~(1<<y),o+=1;var w=32-Ls(r)+y;if(30<w){var x=y-y%5;w=(h&(1<<x)-1).toString(32),h>>=x,y-=x,Oo=1<<32-Ls(r)+y|o<<y|h,Fo=w+n}else Oo=1<<w|o<<y|h,Fo=n}function Ny(n){n.return!==null&&(mu(n,1),tb(n,1,0))}function jy(n){for(;n===Qp;)Qp=Tc[--Ic],Tc[Ic]=null,ef=Tc[--Ic],Tc[Ic]=null;for(;n===Iu;)Iu=hs[--ds],hs[ds]=null,Fo=hs[--ds],hs[ds]=null,Oo=hs[--ds],hs[ds]=null}var Ga=null,qa=null,En=!1,Ds=null;function rb(n,r){var o=ps(5,null,null,0);o.elementType="DELETED",o.stateNode=r,o.return=n,r=n.deletions,r===null?(n.deletions=[o],n.flags|=16):r.push(o)}function j0(n,r){switch(n.tag){case 5:var o=n.type;return r=r.nodeType!==1||o.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(n.stateNode=r,Ga=n,qa=Ll(r.firstChild),!0):!1;case 6:return r=n.pendingProps===""||r.nodeType!==3?null:r,r!==null?(n.stateNode=r,Ga=n,qa=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(o=Iu!==null?{id:Oo,overflow:Fo}:null,n.memoizedState={dehydrated:r,treeContext:o,retryLane:1073741824},o=ps(18,null,null,0),o.stateNode=r,o.return=n,n.child=o,Ga=n,qa=null,!0):!1;default:return!1}}function Wg(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Zg(n){if(En){var r=qa;if(r){var o=r;if(!j0(n,r)){if(Wg(n))throw Error(pt(418));r=Ll(o.nextSibling);var h=Ga;r&&j0(n,r)?rb(h,o):(n.flags=n.flags&-4097|2,En=!1,Ga=n)}}else{if(Wg(n))throw Error(pt(418));n.flags=n.flags&-4097|2,En=!1,Ga=n}}}function U0(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Ga=n}function gp(n){if(n!==Ga)return!1;if(!En)return U0(n),En=!0,!1;var r;if((r=n.tag!==3)&&!(r=n.tag!==5)&&(r=n.type,r=r!=="head"&&r!=="body"&&!qg(n.type,n.memoizedProps)),r&&(r=qa)){if(Wg(n))throw nb(),Error(pt(418));for(;r;)rb(n,r),r=Ll(r.nextSibling)}if(U0(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(pt(317));e:{for(n=n.nextSibling,r=0;n;){if(n.nodeType===8){var o=n.data;if(o==="/$"){if(r===0){qa=Ll(n.nextSibling);break e}r--}else o!=="$"&&o!=="$!"&&o!=="$?"||r++}n=n.nextSibling}qa=null}}else qa=Ga?Ll(n.stateNode.nextSibling):null;return!0}function nb(){for(var n=qa;n;)n=Ll(n.nextSibling)}function jc(){qa=Ga=null,En=!1}function Uy(n){Ds===null?Ds=[n]:Ds.push(n)}var lC=$o.ReactCurrentBatchConfig;function Nh(n,r,o){if(n=o.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(pt(309));var h=o.stateNode}if(!h)throw Error(pt(147,n));var y=h,w=""+n;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===w?r.ref:(r=function(x){var c=y.refs;x===null?delete c[w]:c[w]=x},r._stringRef=w,r)}if(typeof n!="string")throw Error(pt(284));if(!o._owner)throw Error(pt(290,n))}return n}function yp(n,r){throw n=Object.prototype.toString.call(r),Error(pt(31,n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n))}function V0(n){var r=n._init;return r(n._payload)}function ib(n){function r(re,J){if(n){var le=re.deletions;le===null?(re.deletions=[J],re.flags|=16):le.push(J)}}function o(re,J){if(!n)return null;for(;J!==null;)r(re,J),J=J.sibling;return null}function h(re,J){for(re=new Map;J!==null;)J.key!==null?re.set(J.key,J):re.set(J.index,J),J=J.sibling;return re}function y(re,J){return re=Bl(re,J),re.index=0,re.sibling=null,re}function w(re,J,le){return re.index=le,n?(le=re.alternate,le!==null?(le=le.index,le<J?(re.flags|=2,J):le):(re.flags|=2,J)):(re.flags|=1048576,J)}function x(re){return n&&re.alternate===null&&(re.flags|=2),re}function c(re,J,le,we){return J===null||J.tag!==6?(J=lg(le,re.mode,we),J.return=re,J):(J=y(J,le),J.return=re,J)}function V(re,J,le,we){var Ze=le.type;return Ze===xc?Y(re,J,le.props.children,we,le.key):J!==null&&(J.elementType===Ze||typeof Ze=="object"&&Ze!==null&&Ze.$$typeof===bl&&V0(Ze)===J.type)?(we=y(J,le.props),we.ref=Nh(re,J,le),we.return=re,we):(we=Fp(le.type,le.key,le.props,null,re.mode,we),we.ref=Nh(re,J,le),we.return=re,we)}function G(re,J,le,we){return J===null||J.tag!==4||J.stateNode.containerInfo!==le.containerInfo||J.stateNode.implementation!==le.implementation?(J=ug(le,re.mode,we),J.return=re,J):(J=y(J,le.children||[]),J.return=re,J)}function Y(re,J,le,we,Ze){return J===null||J.tag!==7?(J=Cu(le,re.mode,we,Ze),J.return=re,J):(J=y(J,le),J.return=re,J)}function Q(re,J,le){if(typeof J=="string"&&J!==""||typeof J=="number")return J=lg(""+J,re.mode,le),J.return=re,J;if(typeof J=="object"&&J!==null){switch(J.$$typeof){case sp:return le=Fp(J.type,J.key,J.props,null,re.mode,le),le.ref=Nh(re,null,J),le.return=re,le;case vc:return J=ug(J,re.mode,le),J.return=re,J;case bl:var we=J._init;return Q(re,we(J._payload),le)}if(Kh(J)||Lh(J))return J=Cu(J,re.mode,le,null),J.return=re,J;yp(re,J)}return null}function H(re,J,le,we){var Ze=J!==null?J.key:null;if(typeof le=="string"&&le!==""||typeof le=="number")return Ze!==null?null:c(re,J,""+le,we);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case sp:return le.key===Ze?V(re,J,le,we):null;case vc:return le.key===Ze?G(re,J,le,we):null;case bl:return Ze=le._init,H(re,J,Ze(le._payload),we)}if(Kh(le)||Lh(le))return Ze!==null?null:Y(re,J,le,we,null);yp(re,le)}return null}function Le(re,J,le,we,Ze){if(typeof we=="string"&&we!==""||typeof we=="number")return re=re.get(le)||null,c(J,re,""+we,Ze);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case sp:return re=re.get(we.key===null?le:we.key)||null,V(J,re,we,Ze);case vc:return re=re.get(we.key===null?le:we.key)||null,G(J,re,we,Ze);case bl:var He=we._init;return Le(re,J,le,He(we._payload),Ze)}if(Kh(we)||Lh(we))return re=re.get(le)||null,Y(J,re,we,Ze,null);yp(J,we)}return null}function Be(re,J,le,we){for(var Ze=null,He=null,Xe=J,fe=J=0,ve=null;Xe!==null&&fe<le.length;fe++){Xe.index>fe?(ve=Xe,Xe=null):ve=Xe.sibling;var je=H(re,Xe,le[fe],we);if(je===null){Xe===null&&(Xe=ve);break}n&&Xe&&je.alternate===null&&r(re,Xe),J=w(je,J,fe),He===null?Ze=je:He.sibling=je,He=je,Xe=ve}if(fe===le.length)return o(re,Xe),En&&mu(re,fe),Ze;if(Xe===null){for(;fe<le.length;fe++)Xe=Q(re,le[fe],we),Xe!==null&&(J=w(Xe,J,fe),He===null?Ze=Xe:He.sibling=Xe,He=Xe);return En&&mu(re,fe),Ze}for(Xe=h(re,Xe);fe<le.length;fe++)ve=Le(Xe,re,fe,le[fe],we),ve!==null&&(n&&ve.alternate!==null&&Xe.delete(ve.key===null?fe:ve.key),J=w(ve,J,fe),He===null?Ze=ve:He.sibling=ve,He=ve);return n&&Xe.forEach(function(tt){return r(re,tt)}),En&&mu(re,fe),Ze}function be(re,J,le,we){var Ze=Lh(le);if(typeof Ze!="function")throw Error(pt(150));if(le=Ze.call(le),le==null)throw Error(pt(151));for(var He=Ze=null,Xe=J,fe=J=0,ve=null,je=le.next();Xe!==null&&!je.done;fe++,je=le.next()){Xe.index>fe?(ve=Xe,Xe=null):ve=Xe.sibling;var tt=H(re,Xe,je.value,we);if(tt===null){Xe===null&&(Xe=ve);break}n&&Xe&&tt.alternate===null&&r(re,Xe),J=w(tt,J,fe),He===null?Ze=tt:He.sibling=tt,He=tt,Xe=ve}if(je.done)return o(re,Xe),En&&mu(re,fe),Ze;if(Xe===null){for(;!je.done;fe++,je=le.next())je=Q(re,je.value,we),je!==null&&(J=w(je,J,fe),He===null?Ze=je:He.sibling=je,He=je);return En&&mu(re,fe),Ze}for(Xe=h(re,Xe);!je.done;fe++,je=le.next())je=Le(Xe,re,fe,je.value,we),je!==null&&(n&&je.alternate!==null&&Xe.delete(je.key===null?fe:je.key),J=w(je,J,fe),He===null?Ze=je:He.sibling=je,He=je);return n&&Xe.forEach(function(_t){return r(re,_t)}),En&&mu(re,fe),Ze}function $e(re,J,le,we){if(typeof le=="object"&&le!==null&&le.type===xc&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case sp:e:{for(var Ze=le.key,He=J;He!==null;){if(He.key===Ze){if(Ze=le.type,Ze===xc){if(He.tag===7){o(re,He.sibling),J=y(He,le.props.children),J.return=re,re=J;break e}}else if(He.elementType===Ze||typeof Ze=="object"&&Ze!==null&&Ze.$$typeof===bl&&V0(Ze)===He.type){o(re,He.sibling),J=y(He,le.props),J.ref=Nh(re,He,le),J.return=re,re=J;break e}o(re,He);break}else r(re,He);He=He.sibling}le.type===xc?(J=Cu(le.props.children,re.mode,we,le.key),J.return=re,re=J):(we=Fp(le.type,le.key,le.props,null,re.mode,we),we.ref=Nh(re,J,le),we.return=re,re=we)}return x(re);case vc:e:{for(He=le.key;J!==null;){if(J.key===He)if(J.tag===4&&J.stateNode.containerInfo===le.containerInfo&&J.stateNode.implementation===le.implementation){o(re,J.sibling),J=y(J,le.children||[]),J.return=re,re=J;break e}else{o(re,J);break}else r(re,J);J=J.sibling}J=ug(le,re.mode,we),J.return=re,re=J}return x(re);case bl:return He=le._init,$e(re,J,He(le._payload),we)}if(Kh(le))return Be(re,J,le,we);if(Lh(le))return be(re,J,le,we);yp(re,le)}return typeof le=="string"&&le!==""||typeof le=="number"?(le=""+le,J!==null&&J.tag===6?(o(re,J.sibling),J=y(J,le),J.return=re,re=J):(o(re,J),J=lg(le,re.mode,we),J.return=re,re=J),x(re)):o(re,J)}return $e}var Uc=ib(!0),ab=ib(!1),tf=$l(null),rf=null,Pc=null,Vy=null;function $y(){Vy=Pc=rf=null}function qy(n){var r=tf.current;wn(tf),n._currentValue=r}function Xg(n,r,o){for(;n!==null;){var h=n.alternate;if((n.childLanes&r)!==r?(n.childLanes|=r,h!==null&&(h.childLanes|=r)):h!==null&&(h.childLanes&r)!==r&&(h.childLanes|=r),n===o)break;n=n.return}}function Rc(n,r){rf=n,Vy=Pc=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&r&&(Ca=!0),n.firstContext=null)}function gs(n){var r=n._currentValue;if(Vy!==n)if(n={context:n,memoizedValue:r,next:null},Pc===null){if(rf===null)throw Error(pt(308));Pc=n,rf.dependencies={lanes:0,firstContext:n}}else Pc=Pc.next=n;return r}var vu=null;function Gy(n){vu===null?vu=[n]:vu.push(n)}function sb(n,r,o,h){var y=r.interleaved;return y===null?(o.next=o,Gy(r)):(o.next=y.next,y.next=o),r.interleaved=o,Uo(n,h)}function Uo(n,r){n.lanes|=r;var o=n.alternate;for(o!==null&&(o.lanes|=r),o=n,n=n.return;n!==null;)n.childLanes|=r,o=n.alternate,o!==null&&(o.childLanes|=r),o=n,n=n.return;return o.tag===3?o.stateNode:null}var wl=!1;function Ky(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ob(n,r){n=n.updateQueue,r.updateQueue===n&&(r.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Bo(n,r){return{eventTime:n,lane:r,tag:0,payload:null,callback:null,next:null}}function Rl(n,r,o){var h=n.updateQueue;if(h===null)return null;if(h=h.shared,qr&2){var y=h.pending;return y===null?r.next=r:(r.next=y.next,y.next=r),h.pending=r,Uo(n,o)}return y=h.interleaved,y===null?(r.next=r,Gy(h)):(r.next=y.next,y.next=r),h.interleaved=r,Uo(n,o)}function Mp(n,r,o){if(r=r.updateQueue,r!==null&&(r=r.shared,(o&4194240)!==0)){var h=r.lanes;h&=n.pendingLanes,o|=h,r.lanes=o,My(n,o)}}function $0(n,r){var o=n.updateQueue,h=n.alternate;if(h!==null&&(h=h.updateQueue,o===h)){var y=null,w=null;if(o=o.firstBaseUpdate,o!==null){do{var x={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};w===null?y=w=x:w=w.next=x,o=o.next}while(o!==null);w===null?y=w=r:w=w.next=r}else y=w=r;o={baseState:h.baseState,firstBaseUpdate:y,lastBaseUpdate:w,shared:h.shared,effects:h.effects},n.updateQueue=o;return}n=o.lastBaseUpdate,n===null?o.firstBaseUpdate=r:n.next=r,o.lastBaseUpdate=r}function nf(n,r,o,h){var y=n.updateQueue;wl=!1;var w=y.firstBaseUpdate,x=y.lastBaseUpdate,c=y.shared.pending;if(c!==null){y.shared.pending=null;var V=c,G=V.next;V.next=null,x===null?w=G:x.next=G,x=V;var Y=n.alternate;Y!==null&&(Y=Y.updateQueue,c=Y.lastBaseUpdate,c!==x&&(c===null?Y.firstBaseUpdate=G:c.next=G,Y.lastBaseUpdate=V))}if(w!==null){var Q=y.baseState;x=0,Y=G=V=null,c=w;do{var H=c.lane,Le=c.eventTime;if((h&H)===H){Y!==null&&(Y=Y.next={eventTime:Le,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var Be=n,be=c;switch(H=r,Le=o,be.tag){case 1:if(Be=be.payload,typeof Be=="function"){Q=Be.call(Le,Q,H);break e}Q=Be;break e;case 3:Be.flags=Be.flags&-65537|128;case 0:if(Be=be.payload,H=typeof Be=="function"?Be.call(Le,Q,H):Be,H==null)break e;Q=On({},Q,H);break e;case 2:wl=!0}}c.callback!==null&&c.lane!==0&&(n.flags|=64,H=y.effects,H===null?y.effects=[c]:H.push(c))}else Le={eventTime:Le,lane:H,tag:c.tag,payload:c.payload,callback:c.callback,next:null},Y===null?(G=Y=Le,V=Q):Y=Y.next=Le,x|=H;if(c=c.next,c===null){if(c=y.shared.pending,c===null)break;H=c,c=H.next,H.next=null,y.lastBaseUpdate=H,y.shared.pending=null}}while(!0);if(Y===null&&(V=Q),y.baseState=V,y.firstBaseUpdate=G,y.lastBaseUpdate=Y,r=y.shared.interleaved,r!==null){y=r;do x|=y.lane,y=y.next;while(y!==r)}else w===null&&(y.shared.lanes=0);Eu|=x,n.lanes=x,n.memoizedState=Q}}function q0(n,r,o){if(n=r.effects,r.effects=null,n!==null)for(r=0;r<n.length;r++){var h=n[r],y=h.callback;if(y!==null){if(h.callback=null,h=o,typeof y!="function")throw Error(pt(191,y));y.call(h)}}}var Pd={},lo=$l(Pd),yd=$l(Pd),_d=$l(Pd);function xu(n){if(n===Pd)throw Error(pt(174));return n}function Hy(n,r){switch(yn(_d,r),yn(yd,n),yn(lo,Pd),n=r.nodeType,n){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:Ag(null,"");break;default:n=n===8?r.parentNode:r,r=n.namespaceURI||null,n=n.tagName,r=Ag(r,n)}wn(lo),yn(lo,r)}function Vc(){wn(lo),wn(yd),wn(_d)}function lb(n){xu(_d.current);var r=xu(lo.current),o=Ag(r,n.type);r!==o&&(yn(yd,n),yn(lo,o))}function Wy(n){yd.current===n&&(wn(lo),wn(yd))}var Ln=$l(0);function af(n){for(var r=n;r!==null;){if(r.tag===13){var o=r.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if(r.flags&128)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var rg=[];function Zy(){for(var n=0;n<rg.length;n++)rg[n]._workInProgressVersionPrimary=null;rg.length=0}var Dp=$o.ReactCurrentDispatcher,ng=$o.ReactCurrentBatchConfig,Pu=0,Rn=null,li=null,vi=null,sf=!1,ed=!1,vd=0,uC=0;function Ki(){throw Error(pt(321))}function Xy(n,r){if(r===null)return!1;for(var o=0;o<r.length&&o<n.length;o++)if(!Os(n[o],r[o]))return!1;return!0}function Yy(n,r,o,h,y,w){if(Pu=w,Rn=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,Dp.current=n===null||n.memoizedState===null?pC:fC,n=o(h,y),ed){w=0;do{if(ed=!1,vd=0,25<=w)throw Error(pt(301));w+=1,vi=li=null,r.updateQueue=null,Dp.current=mC,n=o(h,y)}while(ed)}if(Dp.current=of,r=li!==null&&li.next!==null,Pu=0,vi=li=Rn=null,sf=!1,r)throw Error(pt(300));return n}function Jy(){var n=vd!==0;return vd=0,n}function ao(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vi===null?Rn.memoizedState=vi=n:vi=vi.next=n,vi}function ys(){if(li===null){var n=Rn.alternate;n=n!==null?n.memoizedState:null}else n=li.next;var r=vi===null?Rn.memoizedState:vi.next;if(r!==null)vi=r,li=n;else{if(n===null)throw Error(pt(310));li=n,n={memoizedState:li.memoizedState,baseState:li.baseState,baseQueue:li.baseQueue,queue:li.queue,next:null},vi===null?Rn.memoizedState=vi=n:vi=vi.next=n}return vi}function xd(n,r){return typeof r=="function"?r(n):r}function ig(n){var r=ys(),o=r.queue;if(o===null)throw Error(pt(311));o.lastRenderedReducer=n;var h=li,y=h.baseQueue,w=o.pending;if(w!==null){if(y!==null){var x=y.next;y.next=w.next,w.next=x}h.baseQueue=y=w,o.pending=null}if(y!==null){w=y.next,h=h.baseState;var c=x=null,V=null,G=w;do{var Y=G.lane;if((Pu&Y)===Y)V!==null&&(V=V.next={lane:0,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null}),h=G.hasEagerState?G.eagerState:n(h,G.action);else{var Q={lane:Y,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null};V===null?(c=V=Q,x=h):V=V.next=Q,Rn.lanes|=Y,Eu|=Y}G=G.next}while(G!==null&&G!==w);V===null?x=h:V.next=c,Os(h,r.memoizedState)||(Ca=!0),r.memoizedState=h,r.baseState=x,r.baseQueue=V,o.lastRenderedState=h}if(n=o.interleaved,n!==null){y=n;do w=y.lane,Rn.lanes|=w,Eu|=w,y=y.next;while(y!==n)}else y===null&&(o.lanes=0);return[r.memoizedState,o.dispatch]}function ag(n){var r=ys(),o=r.queue;if(o===null)throw Error(pt(311));o.lastRenderedReducer=n;var h=o.dispatch,y=o.pending,w=r.memoizedState;if(y!==null){o.pending=null;var x=y=y.next;do w=n(w,x.action),x=x.next;while(x!==y);Os(w,r.memoizedState)||(Ca=!0),r.memoizedState=w,r.baseQueue===null&&(r.baseState=w),o.lastRenderedState=w}return[w,h]}function ub(){}function cb(n,r){var o=Rn,h=ys(),y=r(),w=!Os(h.memoizedState,y);if(w&&(h.memoizedState=y,Ca=!0),h=h.queue,Qy(pb.bind(null,o,h,n),[n]),h.getSnapshot!==r||w||vi!==null&&vi.memoizedState.tag&1){if(o.flags|=2048,bd(9,db.bind(null,o,h,y,r),void 0,null),xi===null)throw Error(pt(349));Pu&30||hb(o,r,y)}return y}function hb(n,r,o){n.flags|=16384,n={getSnapshot:r,value:o},r=Rn.updateQueue,r===null?(r={lastEffect:null,stores:null},Rn.updateQueue=r,r.stores=[n]):(o=r.stores,o===null?r.stores=[n]:o.push(n))}function db(n,r,o,h){r.value=o,r.getSnapshot=h,fb(r)&&mb(n)}function pb(n,r,o){return o(function(){fb(r)&&mb(n)})}function fb(n){var r=n.getSnapshot;n=n.value;try{var o=r();return!Os(n,o)}catch{return!0}}function mb(n){var r=Uo(n,1);r!==null&&Rs(r,n,1,-1)}function G0(n){var r=ao();return typeof n=="function"&&(n=n()),r.memoizedState=r.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xd,lastRenderedState:n},r.queue=n,n=n.dispatch=dC.bind(null,Rn,n),[r.memoizedState,n]}function bd(n,r,o,h){return n={tag:n,create:r,destroy:o,deps:h,next:null},r=Rn.updateQueue,r===null?(r={lastEffect:null,stores:null},Rn.updateQueue=r,r.lastEffect=n.next=n):(o=r.lastEffect,o===null?r.lastEffect=n.next=n:(h=o.next,o.next=n,n.next=h,r.lastEffect=n)),n}function gb(){return ys().memoizedState}function zp(n,r,o,h){var y=ao();Rn.flags|=n,y.memoizedState=bd(1|r,o,void 0,h===void 0?null:h)}function If(n,r,o,h){var y=ys();h=h===void 0?null:h;var w=void 0;if(li!==null){var x=li.memoizedState;if(w=x.destroy,h!==null&&Xy(h,x.deps)){y.memoizedState=bd(r,o,w,h);return}}Rn.flags|=n,y.memoizedState=bd(1|r,o,w,h)}function K0(n,r){return zp(8390656,8,n,r)}function Qy(n,r){return If(2048,8,n,r)}function yb(n,r){return If(4,2,n,r)}function _b(n,r){return If(4,4,n,r)}function vb(n,r){if(typeof r=="function")return n=n(),r(n),function(){r(null)};if(r!=null)return n=n(),r.current=n,function(){r.current=null}}function xb(n,r,o){return o=o!=null?o.concat([n]):null,If(4,4,vb.bind(null,r,n),o)}function e_(){}function bb(n,r){var o=ys();r=r===void 0?null:r;var h=o.memoizedState;return h!==null&&r!==null&&Xy(r,h[1])?h[0]:(o.memoizedState=[n,r],n)}function wb(n,r){var o=ys();r=r===void 0?null:r;var h=o.memoizedState;return h!==null&&r!==null&&Xy(r,h[1])?h[0]:(n=n(),o.memoizedState=[n,r],n)}function Sb(n,r,o){return Pu&21?(Os(o,r)||(o=P1(),Rn.lanes|=o,Eu|=o,n.baseState=!0),r):(n.baseState&&(n.baseState=!1,Ca=!0),n.memoizedState=o)}function cC(n,r){var o=rn;rn=o!==0&&4>o?o:4,n(!0);var h=ng.transition;ng.transition={};try{n(!1),r()}finally{rn=o,ng.transition=h}}function kb(){return ys().memoizedState}function hC(n,r,o){var h=Fl(n);if(o={lane:h,action:o,hasEagerState:!1,eagerState:null,next:null},Cb(n))Tb(r,o);else if(o=sb(n,r,o,h),o!==null){var y=oa();Rs(o,n,h,y),Ib(o,r,h)}}function dC(n,r,o){var h=Fl(n),y={lane:h,action:o,hasEagerState:!1,eagerState:null,next:null};if(Cb(n))Tb(r,y);else{var w=n.alternate;if(n.lanes===0&&(w===null||w.lanes===0)&&(w=r.lastRenderedReducer,w!==null))try{var x=r.lastRenderedState,c=w(x,o);if(y.hasEagerState=!0,y.eagerState=c,Os(c,x)){var V=r.interleaved;V===null?(y.next=y,Gy(r)):(y.next=V.next,V.next=y),r.interleaved=y;return}}catch{}finally{}o=sb(n,r,y,h),o!==null&&(y=oa(),Rs(o,n,h,y),Ib(o,r,h))}}function Cb(n){var r=n.alternate;return n===Rn||r!==null&&r===Rn}function Tb(n,r){ed=sf=!0;var o=n.pending;o===null?r.next=r:(r.next=o.next,o.next=r),n.pending=r}function Ib(n,r,o){if(o&4194240){var h=r.lanes;h&=n.pendingLanes,o|=h,r.lanes=o,My(n,o)}}var of={readContext:gs,useCallback:Ki,useContext:Ki,useEffect:Ki,useImperativeHandle:Ki,useInsertionEffect:Ki,useLayoutEffect:Ki,useMemo:Ki,useReducer:Ki,useRef:Ki,useState:Ki,useDebugValue:Ki,useDeferredValue:Ki,useTransition:Ki,useMutableSource:Ki,useSyncExternalStore:Ki,useId:Ki,unstable_isNewReconciler:!1},pC={readContext:gs,useCallback:function(n,r){return ao().memoizedState=[n,r===void 0?null:r],n},useContext:gs,useEffect:K0,useImperativeHandle:function(n,r,o){return o=o!=null?o.concat([n]):null,zp(4194308,4,vb.bind(null,r,n),o)},useLayoutEffect:function(n,r){return zp(4194308,4,n,r)},useInsertionEffect:function(n,r){return zp(4,2,n,r)},useMemo:function(n,r){var o=ao();return r=r===void 0?null:r,n=n(),o.memoizedState=[n,r],n},useReducer:function(n,r,o){var h=ao();return r=o!==void 0?o(r):r,h.memoizedState=h.baseState=r,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:r},h.queue=n,n=n.dispatch=hC.bind(null,Rn,n),[h.memoizedState,n]},useRef:function(n){var r=ao();return n={current:n},r.memoizedState=n},useState:G0,useDebugValue:e_,useDeferredValue:function(n){return ao().memoizedState=n},useTransition:function(){var n=G0(!1),r=n[0];return n=cC.bind(null,n[1]),ao().memoizedState=n,[r,n]},useMutableSource:function(){},useSyncExternalStore:function(n,r,o){var h=Rn,y=ao();if(En){if(o===void 0)throw Error(pt(407));o=o()}else{if(o=r(),xi===null)throw Error(pt(349));Pu&30||hb(h,r,o)}y.memoizedState=o;var w={value:o,getSnapshot:r};return y.queue=w,K0(pb.bind(null,h,w,n),[n]),h.flags|=2048,bd(9,db.bind(null,h,w,o,r),void 0,null),o},useId:function(){var n=ao(),r=xi.identifierPrefix;if(En){var o=Fo,h=Oo;o=(h&~(1<<32-Ls(h)-1)).toString(32)+o,r=":"+r+"R"+o,o=vd++,0<o&&(r+="H"+o.toString(32)),r+=":"}else o=uC++,r=":"+r+"r"+o.toString(32)+":";return n.memoizedState=r},unstable_isNewReconciler:!1},fC={readContext:gs,useCallback:bb,useContext:gs,useEffect:Qy,useImperativeHandle:xb,useInsertionEffect:yb,useLayoutEffect:_b,useMemo:wb,useReducer:ig,useRef:gb,useState:function(){return ig(xd)},useDebugValue:e_,useDeferredValue:function(n){var r=ys();return Sb(r,li.memoizedState,n)},useTransition:function(){var n=ig(xd)[0],r=ys().memoizedState;return[n,r]},useMutableSource:ub,useSyncExternalStore:cb,useId:kb,unstable_isNewReconciler:!1},mC={readContext:gs,useCallback:bb,useContext:gs,useEffect:Qy,useImperativeHandle:xb,useInsertionEffect:yb,useLayoutEffect:_b,useMemo:wb,useReducer:ag,useRef:gb,useState:function(){return ag(xd)},useDebugValue:e_,useDeferredValue:function(n){var r=ys();return li===null?r.memoizedState=n:Sb(r,li.memoizedState,n)},useTransition:function(){var n=ag(xd)[0],r=ys().memoizedState;return[n,r]},useMutableSource:ub,useSyncExternalStore:cb,useId:kb,unstable_isNewReconciler:!1};function As(n,r){if(n&&n.defaultProps){r=On({},r),n=n.defaultProps;for(var o in n)r[o]===void 0&&(r[o]=n[o]);return r}return r}function Yg(n,r,o,h){r=n.memoizedState,o=o(h,r),o=o==null?r:On({},r,o),n.memoizedState=o,n.lanes===0&&(n.updateQueue.baseState=o)}var Pf={isMounted:function(n){return(n=n._reactInternals)?Ou(n)===n:!1},enqueueSetState:function(n,r,o){n=n._reactInternals;var h=oa(),y=Fl(n),w=Bo(h,y);w.payload=r,o!=null&&(w.callback=o),r=Rl(n,w,y),r!==null&&(Rs(r,n,y,h),Mp(r,n,y))},enqueueReplaceState:function(n,r,o){n=n._reactInternals;var h=oa(),y=Fl(n),w=Bo(h,y);w.tag=1,w.payload=r,o!=null&&(w.callback=o),r=Rl(n,w,y),r!==null&&(Rs(r,n,y,h),Mp(r,n,y))},enqueueForceUpdate:function(n,r){n=n._reactInternals;var o=oa(),h=Fl(n),y=Bo(o,h);y.tag=2,r!=null&&(y.callback=r),r=Rl(n,y,h),r!==null&&(Rs(r,n,h,o),Mp(r,n,h))}};function H0(n,r,o,h,y,w,x){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(h,w,x):r.prototype&&r.prototype.isPureReactComponent?!pd(o,h)||!pd(y,w):!0}function Pb(n,r,o){var h=!1,y=Ul,w=r.contextType;return typeof w=="object"&&w!==null?w=gs(w):(y=Ia(r)?Tu:Zi.current,h=r.contextTypes,w=(h=h!=null)?Nc(n,y):Ul),r=new r(o,w),n.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=Pf,n.stateNode=r,r._reactInternals=n,h&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=y,n.__reactInternalMemoizedMaskedChildContext=w),r}function W0(n,r,o,h){n=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(o,h),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(o,h),r.state!==n&&Pf.enqueueReplaceState(r,r.state,null)}function Jg(n,r,o,h){var y=n.stateNode;y.props=o,y.state=n.memoizedState,y.refs={},Ky(n);var w=r.contextType;typeof w=="object"&&w!==null?y.context=gs(w):(w=Ia(r)?Tu:Zi.current,y.context=Nc(n,w)),y.state=n.memoizedState,w=r.getDerivedStateFromProps,typeof w=="function"&&(Yg(n,r,w,o),y.state=n.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(r=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),r!==y.state&&Pf.enqueueReplaceState(y,y.state,null),nf(n,o,y,h),y.state=n.memoizedState),typeof y.componentDidMount=="function"&&(n.flags|=4194308)}function $c(n,r){try{var o="",h=r;do o+=$S(h),h=h.return;while(h);var y=o}catch(w){y=`
Error generating stack: `+w.message+`
`+w.stack}return{value:n,source:r,stack:y,digest:null}}function sg(n,r,o){return{value:n,source:null,stack:o??null,digest:r??null}}function Qg(n,r){try{console.error(r.value)}catch(o){setTimeout(function(){throw o})}}var gC=typeof WeakMap=="function"?WeakMap:Map;function Eb(n,r,o){o=Bo(-1,o),o.tag=3,o.payload={element:null};var h=r.value;return o.callback=function(){uf||(uf=!0,uy=h),Qg(n,r)},o}function Ab(n,r,o){o=Bo(-1,o),o.tag=3;var h=n.type.getDerivedStateFromError;if(typeof h=="function"){var y=r.value;o.payload=function(){return h(y)},o.callback=function(){Qg(n,r)}}var w=n.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(o.callback=function(){Qg(n,r),typeof h!="function"&&(Ol===null?Ol=new Set([this]):Ol.add(this));var x=r.stack;this.componentDidCatch(r.value,{componentStack:x!==null?x:""})}),o}function Z0(n,r,o){var h=n.pingCache;if(h===null){h=n.pingCache=new gC;var y=new Set;h.set(r,y)}else y=h.get(r),y===void 0&&(y=new Set,h.set(r,y));y.has(o)||(y.add(o),n=AC.bind(null,n,r,o),r.then(n,n))}function X0(n){do{var r;if((r=n.tag===13)&&(r=n.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return n;n=n.return}while(n!==null);return null}function Y0(n,r,o,h,y){return n.mode&1?(n.flags|=65536,n.lanes=y,n):(n===r?n.flags|=65536:(n.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(r=Bo(-1,1),r.tag=2,Rl(o,r,1))),o.lanes|=1),n)}var yC=$o.ReactCurrentOwner,Ca=!1;function sa(n,r,o,h){r.child=n===null?ab(r,null,o,h):Uc(r,n.child,o,h)}function J0(n,r,o,h,y){o=o.render;var w=r.ref;return Rc(r,y),h=Yy(n,r,o,h,w,y),o=Jy(),n!==null&&!Ca?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~y,Vo(n,r,y)):(En&&o&&Ny(r),r.flags|=1,sa(n,r,h,y),r.child)}function Q0(n,r,o,h,y){if(n===null){var w=o.type;return typeof w=="function"&&!l_(w)&&w.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(r.tag=15,r.type=w,Mb(n,r,w,h,y)):(n=Fp(o.type,null,h,r,r.mode,y),n.ref=r.ref,n.return=r,r.child=n)}if(w=n.child,!(n.lanes&y)){var x=w.memoizedProps;if(o=o.compare,o=o!==null?o:pd,o(x,h)&&n.ref===r.ref)return Vo(n,r,y)}return r.flags|=1,n=Bl(w,h),n.ref=r.ref,n.return=r,r.child=n}function Mb(n,r,o,h,y){if(n!==null){var w=n.memoizedProps;if(pd(w,h)&&n.ref===r.ref)if(Ca=!1,r.pendingProps=h=w,(n.lanes&y)!==0)n.flags&131072&&(Ca=!0);else return r.lanes=n.lanes,Vo(n,r,y)}return ey(n,r,o,h,y)}function Db(n,r,o){var h=r.pendingProps,y=h.children,w=n!==null?n.memoizedState:null;if(h.mode==="hidden")if(!(r.mode&1))r.memoizedState={baseLanes:0,cachePool:null,transitions:null},yn(Ac,$a),$a|=o;else{if(!(o&1073741824))return n=w!==null?w.baseLanes|o:o,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:n,cachePool:null,transitions:null},r.updateQueue=null,yn(Ac,$a),$a|=n,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=w!==null?w.baseLanes:o,yn(Ac,$a),$a|=h}else w!==null?(h=w.baseLanes|o,r.memoizedState=null):h=o,yn(Ac,$a),$a|=h;return sa(n,r,y,o),r.child}function zb(n,r){var o=r.ref;(n===null&&o!==null||n!==null&&n.ref!==o)&&(r.flags|=512,r.flags|=2097152)}function ey(n,r,o,h,y){var w=Ia(o)?Tu:Zi.current;return w=Nc(r,w),Rc(r,y),o=Yy(n,r,o,h,w,y),h=Jy(),n!==null&&!Ca?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~y,Vo(n,r,y)):(En&&h&&Ny(r),r.flags|=1,sa(n,r,o,y),r.child)}function ex(n,r,o,h,y){if(Ia(o)){var w=!0;Jp(r)}else w=!1;if(Rc(r,y),r.stateNode===null)Lp(n,r),Pb(r,o,h),Jg(r,o,h,y),h=!0;else if(n===null){var x=r.stateNode,c=r.memoizedProps;x.props=c;var V=x.context,G=o.contextType;typeof G=="object"&&G!==null?G=gs(G):(G=Ia(o)?Tu:Zi.current,G=Nc(r,G));var Y=o.getDerivedStateFromProps,Q=typeof Y=="function"||typeof x.getSnapshotBeforeUpdate=="function";Q||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(c!==h||V!==G)&&W0(r,x,h,G),wl=!1;var H=r.memoizedState;x.state=H,nf(r,h,x,y),V=r.memoizedState,c!==h||H!==V||Ta.current||wl?(typeof Y=="function"&&(Yg(r,o,Y,h),V=r.memoizedState),(c=wl||H0(r,o,c,h,H,V,G))?(Q||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(r.flags|=4194308)):(typeof x.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=h,r.memoizedState=V),x.props=h,x.state=V,x.context=G,h=c):(typeof x.componentDidMount=="function"&&(r.flags|=4194308),h=!1)}else{x=r.stateNode,ob(n,r),c=r.memoizedProps,G=r.type===r.elementType?c:As(r.type,c),x.props=G,Q=r.pendingProps,H=x.context,V=o.contextType,typeof V=="object"&&V!==null?V=gs(V):(V=Ia(o)?Tu:Zi.current,V=Nc(r,V));var Le=o.getDerivedStateFromProps;(Y=typeof Le=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(c!==Q||H!==V)&&W0(r,x,h,V),wl=!1,H=r.memoizedState,x.state=H,nf(r,h,x,y);var Be=r.memoizedState;c!==Q||H!==Be||Ta.current||wl?(typeof Le=="function"&&(Yg(r,o,Le,h),Be=r.memoizedState),(G=wl||H0(r,o,G,h,H,Be,V)||!1)?(Y||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(h,Be,V),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(h,Be,V)),typeof x.componentDidUpdate=="function"&&(r.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof x.componentDidUpdate!="function"||c===n.memoizedProps&&H===n.memoizedState||(r.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||c===n.memoizedProps&&H===n.memoizedState||(r.flags|=1024),r.memoizedProps=h,r.memoizedState=Be),x.props=h,x.state=Be,x.context=V,h=G):(typeof x.componentDidUpdate!="function"||c===n.memoizedProps&&H===n.memoizedState||(r.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||c===n.memoizedProps&&H===n.memoizedState||(r.flags|=1024),h=!1)}return ty(n,r,o,h,w,y)}function ty(n,r,o,h,y,w){zb(n,r);var x=(r.flags&128)!==0;if(!h&&!x)return y&&N0(r,o,!1),Vo(n,r,w);h=r.stateNode,yC.current=r;var c=x&&typeof o.getDerivedStateFromError!="function"?null:h.render();return r.flags|=1,n!==null&&x?(r.child=Uc(r,n.child,null,w),r.child=Uc(r,null,c,w)):sa(n,r,c,w),r.memoizedState=h.state,y&&N0(r,o,!0),r.child}function Lb(n){var r=n.stateNode;r.pendingContext?B0(n,r.pendingContext,r.pendingContext!==r.context):r.context&&B0(n,r.context,!1),Hy(n,r.containerInfo)}function tx(n,r,o,h,y){return jc(),Uy(y),r.flags|=256,sa(n,r,o,h),r.child}var ry={dehydrated:null,treeContext:null,retryLane:0};function ny(n){return{baseLanes:n,cachePool:null,transitions:null}}function Rb(n,r,o){var h=r.pendingProps,y=Ln.current,w=!1,x=(r.flags&128)!==0,c;if((c=x)||(c=n!==null&&n.memoizedState===null?!1:(y&2)!==0),c?(w=!0,r.flags&=-129):(n===null||n.memoizedState!==null)&&(y|=1),yn(Ln,y&1),n===null)return Zg(r),n=r.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(r.mode&1?n.data==="$!"?r.lanes=8:r.lanes=1073741824:r.lanes=1,null):(x=h.children,n=h.fallback,w?(h=r.mode,w=r.child,x={mode:"hidden",children:x},!(h&1)&&w!==null?(w.childLanes=0,w.pendingProps=x):w=Mf(x,h,0,null),n=Cu(n,h,o,null),w.return=r,n.return=r,w.sibling=n,r.child=w,r.child.memoizedState=ny(o),r.memoizedState=ry,n):t_(r,x));if(y=n.memoizedState,y!==null&&(c=y.dehydrated,c!==null))return _C(n,r,x,h,c,y,o);if(w){w=h.fallback,x=r.mode,y=n.child,c=y.sibling;var V={mode:"hidden",children:h.children};return!(x&1)&&r.child!==y?(h=r.child,h.childLanes=0,h.pendingProps=V,r.deletions=null):(h=Bl(y,V),h.subtreeFlags=y.subtreeFlags&14680064),c!==null?w=Bl(c,w):(w=Cu(w,x,o,null),w.flags|=2),w.return=r,h.return=r,h.sibling=w,r.child=h,h=w,w=r.child,x=n.child.memoizedState,x=x===null?ny(o):{baseLanes:x.baseLanes|o,cachePool:null,transitions:x.transitions},w.memoizedState=x,w.childLanes=n.childLanes&~o,r.memoizedState=ry,h}return w=n.child,n=w.sibling,h=Bl(w,{mode:"visible",children:h.children}),!(r.mode&1)&&(h.lanes=o),h.return=r,h.sibling=null,n!==null&&(o=r.deletions,o===null?(r.deletions=[n],r.flags|=16):o.push(n)),r.child=h,r.memoizedState=null,h}function t_(n,r){return r=Mf({mode:"visible",children:r},n.mode,0,null),r.return=n,n.child=r}function _p(n,r,o,h){return h!==null&&Uy(h),Uc(r,n.child,null,o),n=t_(r,r.pendingProps.children),n.flags|=2,r.memoizedState=null,n}function _C(n,r,o,h,y,w,x){if(o)return r.flags&256?(r.flags&=-257,h=sg(Error(pt(422))),_p(n,r,x,h)):r.memoizedState!==null?(r.child=n.child,r.flags|=128,null):(w=h.fallback,y=r.mode,h=Mf({mode:"visible",children:h.children},y,0,null),w=Cu(w,y,x,null),w.flags|=2,h.return=r,w.return=r,h.sibling=w,r.child=h,r.mode&1&&Uc(r,n.child,null,x),r.child.memoizedState=ny(x),r.memoizedState=ry,w);if(!(r.mode&1))return _p(n,r,x,null);if(y.data==="$!"){if(h=y.nextSibling&&y.nextSibling.dataset,h)var c=h.dgst;return h=c,w=Error(pt(419)),h=sg(w,h,void 0),_p(n,r,x,h)}if(c=(x&n.childLanes)!==0,Ca||c){if(h=xi,h!==null){switch(x&-x){case 4:y=2;break;case 16:y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:y=32;break;case 536870912:y=268435456;break;default:y=0}y=y&(h.suspendedLanes|x)?0:y,y!==0&&y!==w.retryLane&&(w.retryLane=y,Uo(n,y),Rs(h,n,y,-1))}return o_(),h=sg(Error(pt(421))),_p(n,r,x,h)}return y.data==="$?"?(r.flags|=128,r.child=n.child,r=MC.bind(null,n),y._reactRetry=r,null):(n=w.treeContext,qa=Ll(y.nextSibling),Ga=r,En=!0,Ds=null,n!==null&&(hs[ds++]=Oo,hs[ds++]=Fo,hs[ds++]=Iu,Oo=n.id,Fo=n.overflow,Iu=r),r=t_(r,h.children),r.flags|=4096,r)}function rx(n,r,o){n.lanes|=r;var h=n.alternate;h!==null&&(h.lanes|=r),Xg(n.return,r,o)}function og(n,r,o,h,y){var w=n.memoizedState;w===null?n.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:h,tail:o,tailMode:y}:(w.isBackwards=r,w.rendering=null,w.renderingStartTime=0,w.last=h,w.tail=o,w.tailMode=y)}function Ob(n,r,o){var h=r.pendingProps,y=h.revealOrder,w=h.tail;if(sa(n,r,h.children,o),h=Ln.current,h&2)h=h&1|2,r.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=r.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&rx(n,o,r);else if(n.tag===19)rx(n,o,r);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break e;for(;n.sibling===null;){if(n.return===null||n.return===r)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}h&=1}if(yn(Ln,h),!(r.mode&1))r.memoizedState=null;else switch(y){case"forwards":for(o=r.child,y=null;o!==null;)n=o.alternate,n!==null&&af(n)===null&&(y=o),o=o.sibling;o=y,o===null?(y=r.child,r.child=null):(y=o.sibling,o.sibling=null),og(r,!1,y,o,w);break;case"backwards":for(o=null,y=r.child,r.child=null;y!==null;){if(n=y.alternate,n!==null&&af(n)===null){r.child=y;break}n=y.sibling,y.sibling=o,o=y,y=n}og(r,!0,o,null,w);break;case"together":og(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Lp(n,r){!(r.mode&1)&&n!==null&&(n.alternate=null,r.alternate=null,r.flags|=2)}function Vo(n,r,o){if(n!==null&&(r.dependencies=n.dependencies),Eu|=r.lanes,!(o&r.childLanes))return null;if(n!==null&&r.child!==n.child)throw Error(pt(153));if(r.child!==null){for(n=r.child,o=Bl(n,n.pendingProps),r.child=o,o.return=r;n.sibling!==null;)n=n.sibling,o=o.sibling=Bl(n,n.pendingProps),o.return=r;o.sibling=null}return r.child}function vC(n,r,o){switch(r.tag){case 3:Lb(r),jc();break;case 5:lb(r);break;case 1:Ia(r.type)&&Jp(r);break;case 4:Hy(r,r.stateNode.containerInfo);break;case 10:var h=r.type._context,y=r.memoizedProps.value;yn(tf,h._currentValue),h._currentValue=y;break;case 13:if(h=r.memoizedState,h!==null)return h.dehydrated!==null?(yn(Ln,Ln.current&1),r.flags|=128,null):o&r.child.childLanes?Rb(n,r,o):(yn(Ln,Ln.current&1),n=Vo(n,r,o),n!==null?n.sibling:null);yn(Ln,Ln.current&1);break;case 19:if(h=(o&r.childLanes)!==0,n.flags&128){if(h)return Ob(n,r,o);r.flags|=128}if(y=r.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),yn(Ln,Ln.current),h)break;return null;case 22:case 23:return r.lanes=0,Db(n,r,o)}return Vo(n,r,o)}var Fb,iy,Bb,Nb;Fb=function(n,r){for(var o=r.child;o!==null;){if(o.tag===5||o.tag===6)n.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};iy=function(){};Bb=function(n,r,o,h){var y=n.memoizedProps;if(y!==h){n=r.stateNode,xu(lo.current);var w=null;switch(o){case"input":y=Tg(n,y),h=Tg(n,h),w=[];break;case"select":y=On({},y,{value:void 0}),h=On({},h,{value:void 0}),w=[];break;case"textarea":y=Eg(n,y),h=Eg(n,h),w=[];break;default:typeof y.onClick!="function"&&typeof h.onClick=="function"&&(n.onclick=Xp)}Mg(o,h);var x;o=null;for(G in y)if(!h.hasOwnProperty(G)&&y.hasOwnProperty(G)&&y[G]!=null)if(G==="style"){var c=y[G];for(x in c)c.hasOwnProperty(x)&&(o||(o={}),o[x]="")}else G!=="dangerouslySetInnerHTML"&&G!=="children"&&G!=="suppressContentEditableWarning"&&G!=="suppressHydrationWarning"&&G!=="autoFocus"&&(sd.hasOwnProperty(G)?w||(w=[]):(w=w||[]).push(G,null));for(G in h){var V=h[G];if(c=y?.[G],h.hasOwnProperty(G)&&V!==c&&(V!=null||c!=null))if(G==="style")if(c){for(x in c)!c.hasOwnProperty(x)||V&&V.hasOwnProperty(x)||(o||(o={}),o[x]="");for(x in V)V.hasOwnProperty(x)&&c[x]!==V[x]&&(o||(o={}),o[x]=V[x])}else o||(w||(w=[]),w.push(G,o)),o=V;else G==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,c=c?c.__html:void 0,V!=null&&c!==V&&(w=w||[]).push(G,V)):G==="children"?typeof V!="string"&&typeof V!="number"||(w=w||[]).push(G,""+V):G!=="suppressContentEditableWarning"&&G!=="suppressHydrationWarning"&&(sd.hasOwnProperty(G)?(V!=null&&G==="onScroll"&&bn("scroll",n),w||c===V||(w=[])):(w=w||[]).push(G,V))}o&&(w=w||[]).push("style",o);var G=w;(r.updateQueue=G)&&(r.flags|=4)}};Nb=function(n,r,o,h){o!==h&&(r.flags|=4)};function jh(n,r){if(!En)switch(n.tailMode){case"hidden":r=n.tail;for(var o=null;r!==null;)r.alternate!==null&&(o=r),r=r.sibling;o===null?n.tail=null:o.sibling=null;break;case"collapsed":o=n.tail;for(var h=null;o!==null;)o.alternate!==null&&(h=o),o=o.sibling;h===null?r||n.tail===null?n.tail=null:n.tail.sibling=null:h.sibling=null}}function Hi(n){var r=n.alternate!==null&&n.alternate.child===n.child,o=0,h=0;if(r)for(var y=n.child;y!==null;)o|=y.lanes|y.childLanes,h|=y.subtreeFlags&14680064,h|=y.flags&14680064,y.return=n,y=y.sibling;else for(y=n.child;y!==null;)o|=y.lanes|y.childLanes,h|=y.subtreeFlags,h|=y.flags,y.return=n,y=y.sibling;return n.subtreeFlags|=h,n.childLanes=o,r}function xC(n,r,o){var h=r.pendingProps;switch(jy(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hi(r),null;case 1:return Ia(r.type)&&Yp(),Hi(r),null;case 3:return h=r.stateNode,Vc(),wn(Ta),wn(Zi),Zy(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(n===null||n.child===null)&&(gp(r)?r.flags|=4:n===null||n.memoizedState.isDehydrated&&!(r.flags&256)||(r.flags|=1024,Ds!==null&&(dy(Ds),Ds=null))),iy(n,r),Hi(r),null;case 5:Wy(r);var y=xu(_d.current);if(o=r.type,n!==null&&r.stateNode!=null)Bb(n,r,o,h,y),n.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!h){if(r.stateNode===null)throw Error(pt(166));return Hi(r),null}if(n=xu(lo.current),gp(r)){h=r.stateNode,o=r.type;var w=r.memoizedProps;switch(h[so]=r,h[gd]=w,n=(r.mode&1)!==0,o){case"dialog":bn("cancel",h),bn("close",h);break;case"iframe":case"object":case"embed":bn("load",h);break;case"video":case"audio":for(y=0;y<Wh.length;y++)bn(Wh[y],h);break;case"source":bn("error",h);break;case"img":case"image":case"link":bn("error",h),bn("load",h);break;case"details":bn("toggle",h);break;case"input":h0(h,w),bn("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!w.multiple},bn("invalid",h);break;case"textarea":p0(h,w),bn("invalid",h)}Mg(o,w),y=null;for(var x in w)if(w.hasOwnProperty(x)){var c=w[x];x==="children"?typeof c=="string"?h.textContent!==c&&(w.suppressHydrationWarning!==!0&&mp(h.textContent,c,n),y=["children",c]):typeof c=="number"&&h.textContent!==""+c&&(w.suppressHydrationWarning!==!0&&mp(h.textContent,c,n),y=["children",""+c]):sd.hasOwnProperty(x)&&c!=null&&x==="onScroll"&&bn("scroll",h)}switch(o){case"input":op(h),d0(h,w,!0);break;case"textarea":op(h),f0(h);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(h.onclick=Xp)}h=y,r.updateQueue=h,h!==null&&(r.flags|=4)}else{x=y.nodeType===9?y:y.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=p1(o)),n==="http://www.w3.org/1999/xhtml"?o==="script"?(n=x.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof h.is=="string"?n=x.createElement(o,{is:h.is}):(n=x.createElement(o),o==="select"&&(x=n,h.multiple?x.multiple=!0:h.size&&(x.size=h.size))):n=x.createElementNS(n,o),n[so]=r,n[gd]=h,Fb(n,r,!1,!1),r.stateNode=n;e:{switch(x=Dg(o,h),o){case"dialog":bn("cancel",n),bn("close",n),y=h;break;case"iframe":case"object":case"embed":bn("load",n),y=h;break;case"video":case"audio":for(y=0;y<Wh.length;y++)bn(Wh[y],n);y=h;break;case"source":bn("error",n),y=h;break;case"img":case"image":case"link":bn("error",n),bn("load",n),y=h;break;case"details":bn("toggle",n),y=h;break;case"input":h0(n,h),y=Tg(n,h),bn("invalid",n);break;case"option":y=h;break;case"select":n._wrapperState={wasMultiple:!!h.multiple},y=On({},h,{value:void 0}),bn("invalid",n);break;case"textarea":p0(n,h),y=Eg(n,h),bn("invalid",n);break;default:y=h}Mg(o,y),c=y;for(w in c)if(c.hasOwnProperty(w)){var V=c[w];w==="style"?g1(n,V):w==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,V!=null&&f1(n,V)):w==="children"?typeof V=="string"?(o!=="textarea"||V!=="")&&od(n,V):typeof V=="number"&&od(n,""+V):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(sd.hasOwnProperty(w)?V!=null&&w==="onScroll"&&bn("scroll",n):V!=null&&Cy(n,w,V,x))}switch(o){case"input":op(n),d0(n,h,!1);break;case"textarea":op(n),f0(n);break;case"option":h.value!=null&&n.setAttribute("value",""+jl(h.value));break;case"select":n.multiple=!!h.multiple,w=h.value,w!=null?Mc(n,!!h.multiple,w,!1):h.defaultValue!=null&&Mc(n,!!h.multiple,h.defaultValue,!0);break;default:typeof y.onClick=="function"&&(n.onclick=Xp)}switch(o){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Hi(r),null;case 6:if(n&&r.stateNode!=null)Nb(n,r,n.memoizedProps,h);else{if(typeof h!="string"&&r.stateNode===null)throw Error(pt(166));if(o=xu(_d.current),xu(lo.current),gp(r)){if(h=r.stateNode,o=r.memoizedProps,h[so]=r,(w=h.nodeValue!==o)&&(n=Ga,n!==null))switch(n.tag){case 3:mp(h.nodeValue,o,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&mp(h.nodeValue,o,(n.mode&1)!==0)}w&&(r.flags|=4)}else h=(o.nodeType===9?o:o.ownerDocument).createTextNode(h),h[so]=r,r.stateNode=h}return Hi(r),null;case 13:if(wn(Ln),h=r.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(En&&qa!==null&&r.mode&1&&!(r.flags&128))nb(),jc(),r.flags|=98560,w=!1;else if(w=gp(r),h!==null&&h.dehydrated!==null){if(n===null){if(!w)throw Error(pt(318));if(w=r.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(pt(317));w[so]=r}else jc(),!(r.flags&128)&&(r.memoizedState=null),r.flags|=4;Hi(r),w=!1}else Ds!==null&&(dy(Ds),Ds=null),w=!0;if(!w)return r.flags&65536?r:null}return r.flags&128?(r.lanes=o,r):(h=h!==null,h!==(n!==null&&n.memoizedState!==null)&&h&&(r.child.flags|=8192,r.mode&1&&(n===null||Ln.current&1?ui===0&&(ui=3):o_())),r.updateQueue!==null&&(r.flags|=4),Hi(r),null);case 4:return Vc(),iy(n,r),n===null&&fd(r.stateNode.containerInfo),Hi(r),null;case 10:return qy(r.type._context),Hi(r),null;case 17:return Ia(r.type)&&Yp(),Hi(r),null;case 19:if(wn(Ln),w=r.memoizedState,w===null)return Hi(r),null;if(h=(r.flags&128)!==0,x=w.rendering,x===null)if(h)jh(w,!1);else{if(ui!==0||n!==null&&n.flags&128)for(n=r.child;n!==null;){if(x=af(n),x!==null){for(r.flags|=128,jh(w,!1),h=x.updateQueue,h!==null&&(r.updateQueue=h,r.flags|=4),r.subtreeFlags=0,h=o,o=r.child;o!==null;)w=o,n=h,w.flags&=14680066,x=w.alternate,x===null?(w.childLanes=0,w.lanes=n,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=x.childLanes,w.lanes=x.lanes,w.child=x.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=x.memoizedProps,w.memoizedState=x.memoizedState,w.updateQueue=x.updateQueue,w.type=x.type,n=x.dependencies,w.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),o=o.sibling;return yn(Ln,Ln.current&1|2),r.child}n=n.sibling}w.tail!==null&&Gn()>qc&&(r.flags|=128,h=!0,jh(w,!1),r.lanes=4194304)}else{if(!h)if(n=af(x),n!==null){if(r.flags|=128,h=!0,o=n.updateQueue,o!==null&&(r.updateQueue=o,r.flags|=4),jh(w,!0),w.tail===null&&w.tailMode==="hidden"&&!x.alternate&&!En)return Hi(r),null}else 2*Gn()-w.renderingStartTime>qc&&o!==1073741824&&(r.flags|=128,h=!0,jh(w,!1),r.lanes=4194304);w.isBackwards?(x.sibling=r.child,r.child=x):(o=w.last,o!==null?o.sibling=x:r.child=x,w.last=x)}return w.tail!==null?(r=w.tail,w.rendering=r,w.tail=r.sibling,w.renderingStartTime=Gn(),r.sibling=null,o=Ln.current,yn(Ln,h?o&1|2:o&1),r):(Hi(r),null);case 22:case 23:return s_(),h=r.memoizedState!==null,n!==null&&n.memoizedState!==null!==h&&(r.flags|=8192),h&&r.mode&1?$a&1073741824&&(Hi(r),r.subtreeFlags&6&&(r.flags|=8192)):Hi(r),null;case 24:return null;case 25:return null}throw Error(pt(156,r.tag))}function bC(n,r){switch(jy(r),r.tag){case 1:return Ia(r.type)&&Yp(),n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 3:return Vc(),wn(Ta),wn(Zi),Zy(),n=r.flags,n&65536&&!(n&128)?(r.flags=n&-65537|128,r):null;case 5:return Wy(r),null;case 13:if(wn(Ln),n=r.memoizedState,n!==null&&n.dehydrated!==null){if(r.alternate===null)throw Error(pt(340));jc()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 19:return wn(Ln),null;case 4:return Vc(),null;case 10:return qy(r.type._context),null;case 22:case 23:return s_(),null;case 24:return null;default:return null}}var vp=!1,Wi=!1,wC=typeof WeakSet=="function"?WeakSet:Set,Zt=null;function Ec(n,r){var o=n.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(h){Vn(n,r,h)}else o.current=null}function ay(n,r,o){try{o()}catch(h){Vn(n,r,h)}}var nx=!1;function SC(n,r){if(Vg=Hp,n=q1(),By(n)){if("selectionStart"in n)var o={start:n.selectionStart,end:n.selectionEnd};else e:{o=(o=n.ownerDocument)&&o.defaultView||window;var h=o.getSelection&&o.getSelection();if(h&&h.rangeCount!==0){o=h.anchorNode;var y=h.anchorOffset,w=h.focusNode;h=h.focusOffset;try{o.nodeType,w.nodeType}catch{o=null;break e}var x=0,c=-1,V=-1,G=0,Y=0,Q=n,H=null;t:for(;;){for(var Le;Q!==o||y!==0&&Q.nodeType!==3||(c=x+y),Q!==w||h!==0&&Q.nodeType!==3||(V=x+h),Q.nodeType===3&&(x+=Q.nodeValue.length),(Le=Q.firstChild)!==null;)H=Q,Q=Le;for(;;){if(Q===n)break t;if(H===o&&++G===y&&(c=x),H===w&&++Y===h&&(V=x),(Le=Q.nextSibling)!==null)break;Q=H,H=Q.parentNode}Q=Le}o=c===-1||V===-1?null:{start:c,end:V}}else o=null}o=o||{start:0,end:0}}else o=null;for($g={focusedElem:n,selectionRange:o},Hp=!1,Zt=r;Zt!==null;)if(r=Zt,n=r.child,(r.subtreeFlags&1028)!==0&&n!==null)n.return=r,Zt=n;else for(;Zt!==null;){r=Zt;try{var Be=r.alternate;if(r.flags&1024)switch(r.tag){case 0:case 11:case 15:break;case 1:if(Be!==null){var be=Be.memoizedProps,$e=Be.memoizedState,re=r.stateNode,J=re.getSnapshotBeforeUpdate(r.elementType===r.type?be:As(r.type,be),$e);re.__reactInternalSnapshotBeforeUpdate=J}break;case 3:var le=r.stateNode.containerInfo;le.nodeType===1?le.textContent="":le.nodeType===9&&le.documentElement&&le.removeChild(le.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(pt(163))}}catch(we){Vn(r,r.return,we)}if(n=r.sibling,n!==null){n.return=r.return,Zt=n;break}Zt=r.return}return Be=nx,nx=!1,Be}function td(n,r,o){var h=r.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var y=h=h.next;do{if((y.tag&n)===n){var w=y.destroy;y.destroy=void 0,w!==void 0&&ay(r,o,w)}y=y.next}while(y!==h)}}function Ef(n,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&n)===n){var h=o.create;o.destroy=h()}o=o.next}while(o!==r)}}function sy(n){var r=n.ref;if(r!==null){var o=n.stateNode;switch(n.tag){case 5:n=o;break;default:n=o}typeof r=="function"?r(n):r.current=n}}function jb(n){var r=n.alternate;r!==null&&(n.alternate=null,jb(r)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(r=n.stateNode,r!==null&&(delete r[so],delete r[gd],delete r[Kg],delete r[aC],delete r[sC])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Ub(n){return n.tag===5||n.tag===3||n.tag===4}function ix(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Ub(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function oy(n,r,o){var h=n.tag;if(h===5||h===6)n=n.stateNode,r?o.nodeType===8?o.parentNode.insertBefore(n,r):o.insertBefore(n,r):(o.nodeType===8?(r=o.parentNode,r.insertBefore(n,o)):(r=o,r.appendChild(n)),o=o._reactRootContainer,o!=null||r.onclick!==null||(r.onclick=Xp));else if(h!==4&&(n=n.child,n!==null))for(oy(n,r,o),n=n.sibling;n!==null;)oy(n,r,o),n=n.sibling}function ly(n,r,o){var h=n.tag;if(h===5||h===6)n=n.stateNode,r?o.insertBefore(n,r):o.appendChild(n);else if(h!==4&&(n=n.child,n!==null))for(ly(n,r,o),n=n.sibling;n!==null;)ly(n,r,o),n=n.sibling}var Ai=null,Ms=!1;function xl(n,r,o){for(o=o.child;o!==null;)Vb(n,r,o),o=o.sibling}function Vb(n,r,o){if(oo&&typeof oo.onCommitFiberUnmount=="function")try{oo.onCommitFiberUnmount(bf,o)}catch{}switch(o.tag){case 5:Wi||Ec(o,r);case 6:var h=Ai,y=Ms;Ai=null,xl(n,r,o),Ai=h,Ms=y,Ai!==null&&(Ms?(n=Ai,o=o.stateNode,n.nodeType===8?n.parentNode.removeChild(o):n.removeChild(o)):Ai.removeChild(o.stateNode));break;case 18:Ai!==null&&(Ms?(n=Ai,o=o.stateNode,n.nodeType===8?eg(n.parentNode,o):n.nodeType===1&&eg(n,o),hd(n)):eg(Ai,o.stateNode));break;case 4:h=Ai,y=Ms,Ai=o.stateNode.containerInfo,Ms=!0,xl(n,r,o),Ai=h,Ms=y;break;case 0:case 11:case 14:case 15:if(!Wi&&(h=o.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){y=h=h.next;do{var w=y,x=w.destroy;w=w.tag,x!==void 0&&(w&2||w&4)&&ay(o,r,x),y=y.next}while(y!==h)}xl(n,r,o);break;case 1:if(!Wi&&(Ec(o,r),h=o.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=o.memoizedProps,h.state=o.memoizedState,h.componentWillUnmount()}catch(c){Vn(o,r,c)}xl(n,r,o);break;case 21:xl(n,r,o);break;case 22:o.mode&1?(Wi=(h=Wi)||o.memoizedState!==null,xl(n,r,o),Wi=h):xl(n,r,o);break;default:xl(n,r,o)}}function ax(n){var r=n.updateQueue;if(r!==null){n.updateQueue=null;var o=n.stateNode;o===null&&(o=n.stateNode=new wC),r.forEach(function(h){var y=DC.bind(null,n,h);o.has(h)||(o.add(h),h.then(y,y))})}}function Es(n,r){var o=r.deletions;if(o!==null)for(var h=0;h<o.length;h++){var y=o[h];try{var w=n,x=r,c=x;e:for(;c!==null;){switch(c.tag){case 5:Ai=c.stateNode,Ms=!1;break e;case 3:Ai=c.stateNode.containerInfo,Ms=!0;break e;case 4:Ai=c.stateNode.containerInfo,Ms=!0;break e}c=c.return}if(Ai===null)throw Error(pt(160));Vb(w,x,y),Ai=null,Ms=!1;var V=y.alternate;V!==null&&(V.return=null),y.return=null}catch(G){Vn(y,r,G)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)$b(r,n),r=r.sibling}function $b(n,r){var o=n.alternate,h=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Es(r,n),io(n),h&4){try{td(3,n,n.return),Ef(3,n)}catch(be){Vn(n,n.return,be)}try{td(5,n,n.return)}catch(be){Vn(n,n.return,be)}}break;case 1:Es(r,n),io(n),h&512&&o!==null&&Ec(o,o.return);break;case 5:if(Es(r,n),io(n),h&512&&o!==null&&Ec(o,o.return),n.flags&32){var y=n.stateNode;try{od(y,"")}catch(be){Vn(n,n.return,be)}}if(h&4&&(y=n.stateNode,y!=null)){var w=n.memoizedProps,x=o!==null?o.memoizedProps:w,c=n.type,V=n.updateQueue;if(n.updateQueue=null,V!==null)try{c==="input"&&w.type==="radio"&&w.name!=null&&h1(y,w),Dg(c,x);var G=Dg(c,w);for(x=0;x<V.length;x+=2){var Y=V[x],Q=V[x+1];Y==="style"?g1(y,Q):Y==="dangerouslySetInnerHTML"?f1(y,Q):Y==="children"?od(y,Q):Cy(y,Y,Q,G)}switch(c){case"input":Ig(y,w);break;case"textarea":d1(y,w);break;case"select":var H=y._wrapperState.wasMultiple;y._wrapperState.wasMultiple=!!w.multiple;var Le=w.value;Le!=null?Mc(y,!!w.multiple,Le,!1):H!==!!w.multiple&&(w.defaultValue!=null?Mc(y,!!w.multiple,w.defaultValue,!0):Mc(y,!!w.multiple,w.multiple?[]:"",!1))}y[gd]=w}catch(be){Vn(n,n.return,be)}}break;case 6:if(Es(r,n),io(n),h&4){if(n.stateNode===null)throw Error(pt(162));y=n.stateNode,w=n.memoizedProps;try{y.nodeValue=w}catch(be){Vn(n,n.return,be)}}break;case 3:if(Es(r,n),io(n),h&4&&o!==null&&o.memoizedState.isDehydrated)try{hd(r.containerInfo)}catch(be){Vn(n,n.return,be)}break;case 4:Es(r,n),io(n);break;case 13:Es(r,n),io(n),y=n.child,y.flags&8192&&(w=y.memoizedState!==null,y.stateNode.isHidden=w,!w||y.alternate!==null&&y.alternate.memoizedState!==null||(i_=Gn())),h&4&&ax(n);break;case 22:if(Y=o!==null&&o.memoizedState!==null,n.mode&1?(Wi=(G=Wi)||Y,Es(r,n),Wi=G):Es(r,n),io(n),h&8192){if(G=n.memoizedState!==null,(n.stateNode.isHidden=G)&&!Y&&n.mode&1)for(Zt=n,Y=n.child;Y!==null;){for(Q=Zt=Y;Zt!==null;){switch(H=Zt,Le=H.child,H.tag){case 0:case 11:case 14:case 15:td(4,H,H.return);break;case 1:Ec(H,H.return);var Be=H.stateNode;if(typeof Be.componentWillUnmount=="function"){h=H,o=H.return;try{r=h,Be.props=r.memoizedProps,Be.state=r.memoizedState,Be.componentWillUnmount()}catch(be){Vn(h,o,be)}}break;case 5:Ec(H,H.return);break;case 22:if(H.memoizedState!==null){ox(Q);continue}}Le!==null?(Le.return=H,Zt=Le):ox(Q)}Y=Y.sibling}e:for(Y=null,Q=n;;){if(Q.tag===5){if(Y===null){Y=Q;try{y=Q.stateNode,G?(w=y.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(c=Q.stateNode,V=Q.memoizedProps.style,x=V!=null&&V.hasOwnProperty("display")?V.display:null,c.style.display=m1("display",x))}catch(be){Vn(n,n.return,be)}}}else if(Q.tag===6){if(Y===null)try{Q.stateNode.nodeValue=G?"":Q.memoizedProps}catch(be){Vn(n,n.return,be)}}else if((Q.tag!==22&&Q.tag!==23||Q.memoizedState===null||Q===n)&&Q.child!==null){Q.child.return=Q,Q=Q.child;continue}if(Q===n)break e;for(;Q.sibling===null;){if(Q.return===null||Q.return===n)break e;Y===Q&&(Y=null),Q=Q.return}Y===Q&&(Y=null),Q.sibling.return=Q.return,Q=Q.sibling}}break;case 19:Es(r,n),io(n),h&4&&ax(n);break;case 21:break;default:Es(r,n),io(n)}}function io(n){var r=n.flags;if(r&2){try{e:{for(var o=n.return;o!==null;){if(Ub(o)){var h=o;break e}o=o.return}throw Error(pt(160))}switch(h.tag){case 5:var y=h.stateNode;h.flags&32&&(od(y,""),h.flags&=-33);var w=ix(n);ly(n,w,y);break;case 3:case 4:var x=h.stateNode.containerInfo,c=ix(n);oy(n,c,x);break;default:throw Error(pt(161))}}catch(V){Vn(n,n.return,V)}n.flags&=-3}r&4096&&(n.flags&=-4097)}function kC(n,r,o){Zt=n,qb(n)}function qb(n,r,o){for(var h=(n.mode&1)!==0;Zt!==null;){var y=Zt,w=y.child;if(y.tag===22&&h){var x=y.memoizedState!==null||vp;if(!x){var c=y.alternate,V=c!==null&&c.memoizedState!==null||Wi;c=vp;var G=Wi;if(vp=x,(Wi=V)&&!G)for(Zt=y;Zt!==null;)x=Zt,V=x.child,x.tag===22&&x.memoizedState!==null?lx(y):V!==null?(V.return=x,Zt=V):lx(y);for(;w!==null;)Zt=w,qb(w),w=w.sibling;Zt=y,vp=c,Wi=G}sx(n)}else y.subtreeFlags&8772&&w!==null?(w.return=y,Zt=w):sx(n)}}function sx(n){for(;Zt!==null;){var r=Zt;if(r.flags&8772){var o=r.alternate;try{if(r.flags&8772)switch(r.tag){case 0:case 11:case 15:Wi||Ef(5,r);break;case 1:var h=r.stateNode;if(r.flags&4&&!Wi)if(o===null)h.componentDidMount();else{var y=r.elementType===r.type?o.memoizedProps:As(r.type,o.memoizedProps);h.componentDidUpdate(y,o.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var w=r.updateQueue;w!==null&&q0(r,w,h);break;case 3:var x=r.updateQueue;if(x!==null){if(o=null,r.child!==null)switch(r.child.tag){case 5:o=r.child.stateNode;break;case 1:o=r.child.stateNode}q0(r,x,o)}break;case 5:var c=r.stateNode;if(o===null&&r.flags&4){o=c;var V=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":V.autoFocus&&o.focus();break;case"img":V.src&&(o.src=V.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var G=r.alternate;if(G!==null){var Y=G.memoizedState;if(Y!==null){var Q=Y.dehydrated;Q!==null&&hd(Q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(pt(163))}Wi||r.flags&512&&sy(r)}catch(H){Vn(r,r.return,H)}}if(r===n){Zt=null;break}if(o=r.sibling,o!==null){o.return=r.return,Zt=o;break}Zt=r.return}}function ox(n){for(;Zt!==null;){var r=Zt;if(r===n){Zt=null;break}var o=r.sibling;if(o!==null){o.return=r.return,Zt=o;break}Zt=r.return}}function lx(n){for(;Zt!==null;){var r=Zt;try{switch(r.tag){case 0:case 11:case 15:var o=r.return;try{Ef(4,r)}catch(V){Vn(r,o,V)}break;case 1:var h=r.stateNode;if(typeof h.componentDidMount=="function"){var y=r.return;try{h.componentDidMount()}catch(V){Vn(r,y,V)}}var w=r.return;try{sy(r)}catch(V){Vn(r,w,V)}break;case 5:var x=r.return;try{sy(r)}catch(V){Vn(r,x,V)}}}catch(V){Vn(r,r.return,V)}if(r===n){Zt=null;break}var c=r.sibling;if(c!==null){c.return=r.return,Zt=c;break}Zt=r.return}}var CC=Math.ceil,lf=$o.ReactCurrentDispatcher,r_=$o.ReactCurrentOwner,fs=$o.ReactCurrentBatchConfig,qr=0,xi=null,Qn=null,Mi=0,$a=0,Ac=$l(0),ui=0,wd=null,Eu=0,Af=0,n_=0,rd=null,Sa=null,i_=0,qc=1/0,Lo=null,uf=!1,uy=null,Ol=null,xp=!1,Tl=null,cf=0,nd=0,cy=null,Rp=-1,Op=0;function oa(){return qr&6?Gn():Rp!==-1?Rp:Rp=Gn()}function Fl(n){return n.mode&1?qr&2&&Mi!==0?Mi&-Mi:lC.transition!==null?(Op===0&&(Op=P1()),Op):(n=rn,n!==0||(n=window.event,n=n===void 0?16:R1(n.type)),n):1}function Rs(n,r,o,h){if(50<nd)throw nd=0,cy=null,Error(pt(185));Cd(n,o,h),(!(qr&2)||n!==xi)&&(n===xi&&(!(qr&2)&&(Af|=o),ui===4&&kl(n,Mi)),Pa(n,h),o===1&&qr===0&&!(r.mode&1)&&(qc=Gn()+500,Tf&&ql()))}function Pa(n,r){var o=n.callbackNode;lk(n,r);var h=Kp(n,n===xi?Mi:0);if(h===0)o!==null&&y0(o),n.callbackNode=null,n.callbackPriority=0;else if(r=h&-h,n.callbackPriority!==r){if(o!=null&&y0(o),r===1)n.tag===0?oC(ux.bind(null,n)):eb(ux.bind(null,n)),nC(function(){!(qr&6)&&ql()}),o=null;else{switch(E1(h)){case 1:o=Ay;break;case 4:o=T1;break;case 16:o=Gp;break;case 536870912:o=I1;break;default:o=Gp}o=Jb(o,Gb.bind(null,n))}n.callbackPriority=r,n.callbackNode=o}}function Gb(n,r){if(Rp=-1,Op=0,qr&6)throw Error(pt(327));var o=n.callbackNode;if(Oc()&&n.callbackNode!==o)return null;var h=Kp(n,n===xi?Mi:0);if(h===0)return null;if(h&30||h&n.expiredLanes||r)r=hf(n,h);else{r=h;var y=qr;qr|=2;var w=Hb();(xi!==n||Mi!==r)&&(Lo=null,qc=Gn()+500,ku(n,r));do try{PC();break}catch(c){Kb(n,c)}while(!0);$y(),lf.current=w,qr=y,Qn!==null?r=0:(xi=null,Mi=0,r=ui)}if(r!==0){if(r===2&&(y=Fg(n),y!==0&&(h=y,r=hy(n,y))),r===1)throw o=wd,ku(n,0),kl(n,h),Pa(n,Gn()),o;if(r===6)kl(n,h);else{if(y=n.current.alternate,!(h&30)&&!TC(y)&&(r=hf(n,h),r===2&&(w=Fg(n),w!==0&&(h=w,r=hy(n,w))),r===1))throw o=wd,ku(n,0),kl(n,h),Pa(n,Gn()),o;switch(n.finishedWork=y,n.finishedLanes=h,r){case 0:case 1:throw Error(pt(345));case 2:gu(n,Sa,Lo);break;case 3:if(kl(n,h),(h&130023424)===h&&(r=i_+500-Gn(),10<r)){if(Kp(n,0)!==0)break;if(y=n.suspendedLanes,(y&h)!==h){oa(),n.pingedLanes|=n.suspendedLanes&y;break}n.timeoutHandle=Gg(gu.bind(null,n,Sa,Lo),r);break}gu(n,Sa,Lo);break;case 4:if(kl(n,h),(h&4194240)===h)break;for(r=n.eventTimes,y=-1;0<h;){var x=31-Ls(h);w=1<<x,x=r[x],x>y&&(y=x),h&=~w}if(h=y,h=Gn()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*CC(h/1960))-h,10<h){n.timeoutHandle=Gg(gu.bind(null,n,Sa,Lo),h);break}gu(n,Sa,Lo);break;case 5:gu(n,Sa,Lo);break;default:throw Error(pt(329))}}}return Pa(n,Gn()),n.callbackNode===o?Gb.bind(null,n):null}function hy(n,r){var o=rd;return n.current.memoizedState.isDehydrated&&(ku(n,r).flags|=256),n=hf(n,r),n!==2&&(r=Sa,Sa=o,r!==null&&dy(r)),n}function dy(n){Sa===null?Sa=n:Sa.push.apply(Sa,n)}function TC(n){for(var r=n;;){if(r.flags&16384){var o=r.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var h=0;h<o.length;h++){var y=o[h],w=y.getSnapshot;y=y.value;try{if(!Os(w(),y))return!1}catch{return!1}}}if(o=r.child,r.subtreeFlags&16384&&o!==null)o.return=r,r=o;else{if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function kl(n,r){for(r&=~n_,r&=~Af,n.suspendedLanes|=r,n.pingedLanes&=~r,n=n.expirationTimes;0<r;){var o=31-Ls(r),h=1<<o;n[o]=-1,r&=~h}}function ux(n){if(qr&6)throw Error(pt(327));Oc();var r=Kp(n,0);if(!(r&1))return Pa(n,Gn()),null;var o=hf(n,r);if(n.tag!==0&&o===2){var h=Fg(n);h!==0&&(r=h,o=hy(n,h))}if(o===1)throw o=wd,ku(n,0),kl(n,r),Pa(n,Gn()),o;if(o===6)throw Error(pt(345));return n.finishedWork=n.current.alternate,n.finishedLanes=r,gu(n,Sa,Lo),Pa(n,Gn()),null}function a_(n,r){var o=qr;qr|=1;try{return n(r)}finally{qr=o,qr===0&&(qc=Gn()+500,Tf&&ql())}}function Au(n){Tl!==null&&Tl.tag===0&&!(qr&6)&&Oc();var r=qr;qr|=1;var o=fs.transition,h=rn;try{if(fs.transition=null,rn=1,n)return n()}finally{rn=h,fs.transition=o,qr=r,!(qr&6)&&ql()}}function s_(){$a=Ac.current,wn(Ac)}function ku(n,r){n.finishedWork=null,n.finishedLanes=0;var o=n.timeoutHandle;if(o!==-1&&(n.timeoutHandle=-1,rC(o)),Qn!==null)for(o=Qn.return;o!==null;){var h=o;switch(jy(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&Yp();break;case 3:Vc(),wn(Ta),wn(Zi),Zy();break;case 5:Wy(h);break;case 4:Vc();break;case 13:wn(Ln);break;case 19:wn(Ln);break;case 10:qy(h.type._context);break;case 22:case 23:s_()}o=o.return}if(xi=n,Qn=n=Bl(n.current,null),Mi=$a=r,ui=0,wd=null,n_=Af=Eu=0,Sa=rd=null,vu!==null){for(r=0;r<vu.length;r++)if(o=vu[r],h=o.interleaved,h!==null){o.interleaved=null;var y=h.next,w=o.pending;if(w!==null){var x=w.next;w.next=y,h.next=x}o.pending=h}vu=null}return n}function Kb(n,r){do{var o=Qn;try{if($y(),Dp.current=of,sf){for(var h=Rn.memoizedState;h!==null;){var y=h.queue;y!==null&&(y.pending=null),h=h.next}sf=!1}if(Pu=0,vi=li=Rn=null,ed=!1,vd=0,r_.current=null,o===null||o.return===null){ui=1,wd=r,Qn=null;break}e:{var w=n,x=o.return,c=o,V=r;if(r=Mi,c.flags|=32768,V!==null&&typeof V=="object"&&typeof V.then=="function"){var G=V,Y=c,Q=Y.tag;if(!(Y.mode&1)&&(Q===0||Q===11||Q===15)){var H=Y.alternate;H?(Y.updateQueue=H.updateQueue,Y.memoizedState=H.memoizedState,Y.lanes=H.lanes):(Y.updateQueue=null,Y.memoizedState=null)}var Le=X0(x);if(Le!==null){Le.flags&=-257,Y0(Le,x,c,w,r),Le.mode&1&&Z0(w,G,r),r=Le,V=G;var Be=r.updateQueue;if(Be===null){var be=new Set;be.add(V),r.updateQueue=be}else Be.add(V);break e}else{if(!(r&1)){Z0(w,G,r),o_();break e}V=Error(pt(426))}}else if(En&&c.mode&1){var $e=X0(x);if($e!==null){!($e.flags&65536)&&($e.flags|=256),Y0($e,x,c,w,r),Uy($c(V,c));break e}}w=V=$c(V,c),ui!==4&&(ui=2),rd===null?rd=[w]:rd.push(w),w=x;do{switch(w.tag){case 3:w.flags|=65536,r&=-r,w.lanes|=r;var re=Eb(w,V,r);$0(w,re);break e;case 1:c=V;var J=w.type,le=w.stateNode;if(!(w.flags&128)&&(typeof J.getDerivedStateFromError=="function"||le!==null&&typeof le.componentDidCatch=="function"&&(Ol===null||!Ol.has(le)))){w.flags|=65536,r&=-r,w.lanes|=r;var we=Ab(w,c,r);$0(w,we);break e}}w=w.return}while(w!==null)}Zb(o)}catch(Ze){r=Ze,Qn===o&&o!==null&&(Qn=o=o.return);continue}break}while(!0)}function Hb(){var n=lf.current;return lf.current=of,n===null?of:n}function o_(){(ui===0||ui===3||ui===2)&&(ui=4),xi===null||!(Eu&268435455)&&!(Af&268435455)||kl(xi,Mi)}function hf(n,r){var o=qr;qr|=2;var h=Hb();(xi!==n||Mi!==r)&&(Lo=null,ku(n,r));do try{IC();break}catch(y){Kb(n,y)}while(!0);if($y(),qr=o,lf.current=h,Qn!==null)throw Error(pt(261));return xi=null,Mi=0,ui}function IC(){for(;Qn!==null;)Wb(Qn)}function PC(){for(;Qn!==null&&!QS();)Wb(Qn)}function Wb(n){var r=Yb(n.alternate,n,$a);n.memoizedProps=n.pendingProps,r===null?Zb(n):Qn=r,r_.current=null}function Zb(n){var r=n;do{var o=r.alternate;if(n=r.return,r.flags&32768){if(o=bC(o,r),o!==null){o.flags&=32767,Qn=o;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{ui=6,Qn=null;return}}else if(o=xC(o,r,$a),o!==null){Qn=o;return}if(r=r.sibling,r!==null){Qn=r;return}Qn=r=n}while(r!==null);ui===0&&(ui=5)}function gu(n,r,o){var h=rn,y=fs.transition;try{fs.transition=null,rn=1,EC(n,r,o,h)}finally{fs.transition=y,rn=h}return null}function EC(n,r,o,h){do Oc();while(Tl!==null);if(qr&6)throw Error(pt(327));o=n.finishedWork;var y=n.finishedLanes;if(o===null)return null;if(n.finishedWork=null,n.finishedLanes=0,o===n.current)throw Error(pt(177));n.callbackNode=null,n.callbackPriority=0;var w=o.lanes|o.childLanes;if(uk(n,w),n===xi&&(Qn=xi=null,Mi=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||xp||(xp=!0,Jb(Gp,function(){return Oc(),null})),w=(o.flags&15990)!==0,o.subtreeFlags&15990||w){w=fs.transition,fs.transition=null;var x=rn;rn=1;var c=qr;qr|=4,r_.current=null,SC(n,o),$b(o,n),Zk($g),Hp=!!Vg,$g=Vg=null,n.current=o,kC(o),ek(),qr=c,rn=x,fs.transition=w}else n.current=o;if(xp&&(xp=!1,Tl=n,cf=y),w=n.pendingLanes,w===0&&(Ol=null),nk(o.stateNode),Pa(n,Gn()),r!==null)for(h=n.onRecoverableError,o=0;o<r.length;o++)y=r[o],h(y.value,{componentStack:y.stack,digest:y.digest});if(uf)throw uf=!1,n=uy,uy=null,n;return cf&1&&n.tag!==0&&Oc(),w=n.pendingLanes,w&1?n===cy?nd++:(nd=0,cy=n):nd=0,ql(),null}function Oc(){if(Tl!==null){var n=E1(cf),r=fs.transition,o=rn;try{if(fs.transition=null,rn=16>n?16:n,Tl===null)var h=!1;else{if(n=Tl,Tl=null,cf=0,qr&6)throw Error(pt(331));var y=qr;for(qr|=4,Zt=n.current;Zt!==null;){var w=Zt,x=w.child;if(Zt.flags&16){var c=w.deletions;if(c!==null){for(var V=0;V<c.length;V++){var G=c[V];for(Zt=G;Zt!==null;){var Y=Zt;switch(Y.tag){case 0:case 11:case 15:td(8,Y,w)}var Q=Y.child;if(Q!==null)Q.return=Y,Zt=Q;else for(;Zt!==null;){Y=Zt;var H=Y.sibling,Le=Y.return;if(jb(Y),Y===G){Zt=null;break}if(H!==null){H.return=Le,Zt=H;break}Zt=Le}}}var Be=w.alternate;if(Be!==null){var be=Be.child;if(be!==null){Be.child=null;do{var $e=be.sibling;be.sibling=null,be=$e}while(be!==null)}}Zt=w}}if(w.subtreeFlags&2064&&x!==null)x.return=w,Zt=x;else e:for(;Zt!==null;){if(w=Zt,w.flags&2048)switch(w.tag){case 0:case 11:case 15:td(9,w,w.return)}var re=w.sibling;if(re!==null){re.return=w.return,Zt=re;break e}Zt=w.return}}var J=n.current;for(Zt=J;Zt!==null;){x=Zt;var le=x.child;if(x.subtreeFlags&2064&&le!==null)le.return=x,Zt=le;else e:for(x=J;Zt!==null;){if(c=Zt,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Ef(9,c)}}catch(Ze){Vn(c,c.return,Ze)}if(c===x){Zt=null;break e}var we=c.sibling;if(we!==null){we.return=c.return,Zt=we;break e}Zt=c.return}}if(qr=y,ql(),oo&&typeof oo.onPostCommitFiberRoot=="function")try{oo.onPostCommitFiberRoot(bf,n)}catch{}h=!0}return h}finally{rn=o,fs.transition=r}}return!1}function cx(n,r,o){r=$c(o,r),r=Eb(n,r,1),n=Rl(n,r,1),r=oa(),n!==null&&(Cd(n,1,r),Pa(n,r))}function Vn(n,r,o){if(n.tag===3)cx(n,n,o);else for(;r!==null;){if(r.tag===3){cx(r,n,o);break}else if(r.tag===1){var h=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Ol===null||!Ol.has(h))){n=$c(o,n),n=Ab(r,n,1),r=Rl(r,n,1),n=oa(),r!==null&&(Cd(r,1,n),Pa(r,n));break}}r=r.return}}function AC(n,r,o){var h=n.pingCache;h!==null&&h.delete(r),r=oa(),n.pingedLanes|=n.suspendedLanes&o,xi===n&&(Mi&o)===o&&(ui===4||ui===3&&(Mi&130023424)===Mi&&500>Gn()-i_?ku(n,0):n_|=o),Pa(n,r)}function Xb(n,r){r===0&&(n.mode&1?(r=cp,cp<<=1,!(cp&130023424)&&(cp=4194304)):r=1);var o=oa();n=Uo(n,r),n!==null&&(Cd(n,r,o),Pa(n,o))}function MC(n){var r=n.memoizedState,o=0;r!==null&&(o=r.retryLane),Xb(n,o)}function DC(n,r){var o=0;switch(n.tag){case 13:var h=n.stateNode,y=n.memoizedState;y!==null&&(o=y.retryLane);break;case 19:h=n.stateNode;break;default:throw Error(pt(314))}h!==null&&h.delete(r),Xb(n,o)}var Yb;Yb=function(n,r,o){if(n!==null)if(n.memoizedProps!==r.pendingProps||Ta.current)Ca=!0;else{if(!(n.lanes&o)&&!(r.flags&128))return Ca=!1,vC(n,r,o);Ca=!!(n.flags&131072)}else Ca=!1,En&&r.flags&1048576&&tb(r,ef,r.index);switch(r.lanes=0,r.tag){case 2:var h=r.type;Lp(n,r),n=r.pendingProps;var y=Nc(r,Zi.current);Rc(r,o),y=Yy(null,r,h,n,y,o);var w=Jy();return r.flags|=1,typeof y=="object"&&y!==null&&typeof y.render=="function"&&y.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,Ia(h)?(w=!0,Jp(r)):w=!1,r.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,Ky(r),y.updater=Pf,r.stateNode=y,y._reactInternals=r,Jg(r,h,n,o),r=ty(null,r,h,!0,w,o)):(r.tag=0,En&&w&&Ny(r),sa(null,r,y,o),r=r.child),r;case 16:h=r.elementType;e:{switch(Lp(n,r),n=r.pendingProps,y=h._init,h=y(h._payload),r.type=h,y=r.tag=LC(h),n=As(h,n),y){case 0:r=ey(null,r,h,n,o);break e;case 1:r=ex(null,r,h,n,o);break e;case 11:r=J0(null,r,h,n,o);break e;case 14:r=Q0(null,r,h,As(h.type,n),o);break e}throw Error(pt(306,h,""))}return r;case 0:return h=r.type,y=r.pendingProps,y=r.elementType===h?y:As(h,y),ey(n,r,h,y,o);case 1:return h=r.type,y=r.pendingProps,y=r.elementType===h?y:As(h,y),ex(n,r,h,y,o);case 3:e:{if(Lb(r),n===null)throw Error(pt(387));h=r.pendingProps,w=r.memoizedState,y=w.element,ob(n,r),nf(r,h,null,o);var x=r.memoizedState;if(h=x.element,w.isDehydrated)if(w={element:h,isDehydrated:!1,cache:x.cache,pendingSuspenseBoundaries:x.pendingSuspenseBoundaries,transitions:x.transitions},r.updateQueue.baseState=w,r.memoizedState=w,r.flags&256){y=$c(Error(pt(423)),r),r=tx(n,r,h,o,y);break e}else if(h!==y){y=$c(Error(pt(424)),r),r=tx(n,r,h,o,y);break e}else for(qa=Ll(r.stateNode.containerInfo.firstChild),Ga=r,En=!0,Ds=null,o=ab(r,null,h,o),r.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(jc(),h===y){r=Vo(n,r,o);break e}sa(n,r,h,o)}r=r.child}return r;case 5:return lb(r),n===null&&Zg(r),h=r.type,y=r.pendingProps,w=n!==null?n.memoizedProps:null,x=y.children,qg(h,y)?x=null:w!==null&&qg(h,w)&&(r.flags|=32),zb(n,r),sa(n,r,x,o),r.child;case 6:return n===null&&Zg(r),null;case 13:return Rb(n,r,o);case 4:return Hy(r,r.stateNode.containerInfo),h=r.pendingProps,n===null?r.child=Uc(r,null,h,o):sa(n,r,h,o),r.child;case 11:return h=r.type,y=r.pendingProps,y=r.elementType===h?y:As(h,y),J0(n,r,h,y,o);case 7:return sa(n,r,r.pendingProps,o),r.child;case 8:return sa(n,r,r.pendingProps.children,o),r.child;case 12:return sa(n,r,r.pendingProps.children,o),r.child;case 10:e:{if(h=r.type._context,y=r.pendingProps,w=r.memoizedProps,x=y.value,yn(tf,h._currentValue),h._currentValue=x,w!==null)if(Os(w.value,x)){if(w.children===y.children&&!Ta.current){r=Vo(n,r,o);break e}}else for(w=r.child,w!==null&&(w.return=r);w!==null;){var c=w.dependencies;if(c!==null){x=w.child;for(var V=c.firstContext;V!==null;){if(V.context===h){if(w.tag===1){V=Bo(-1,o&-o),V.tag=2;var G=w.updateQueue;if(G!==null){G=G.shared;var Y=G.pending;Y===null?V.next=V:(V.next=Y.next,Y.next=V),G.pending=V}}w.lanes|=o,V=w.alternate,V!==null&&(V.lanes|=o),Xg(w.return,o,r),c.lanes|=o;break}V=V.next}}else if(w.tag===10)x=w.type===r.type?null:w.child;else if(w.tag===18){if(x=w.return,x===null)throw Error(pt(341));x.lanes|=o,c=x.alternate,c!==null&&(c.lanes|=o),Xg(x,o,r),x=w.sibling}else x=w.child;if(x!==null)x.return=w;else for(x=w;x!==null;){if(x===r){x=null;break}if(w=x.sibling,w!==null){w.return=x.return,x=w;break}x=x.return}w=x}sa(n,r,y.children,o),r=r.child}return r;case 9:return y=r.type,h=r.pendingProps.children,Rc(r,o),y=gs(y),h=h(y),r.flags|=1,sa(n,r,h,o),r.child;case 14:return h=r.type,y=As(h,r.pendingProps),y=As(h.type,y),Q0(n,r,h,y,o);case 15:return Mb(n,r,r.type,r.pendingProps,o);case 17:return h=r.type,y=r.pendingProps,y=r.elementType===h?y:As(h,y),Lp(n,r),r.tag=1,Ia(h)?(n=!0,Jp(r)):n=!1,Rc(r,o),Pb(r,h,y),Jg(r,h,y,o),ty(null,r,h,!0,n,o);case 19:return Ob(n,r,o);case 22:return Db(n,r,o)}throw Error(pt(156,r.tag))};function Jb(n,r){return C1(n,r)}function zC(n,r,o,h){this.tag=n,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ps(n,r,o,h){return new zC(n,r,o,h)}function l_(n){return n=n.prototype,!(!n||!n.isReactComponent)}function LC(n){if(typeof n=="function")return l_(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Iy)return 11;if(n===Py)return 14}return 2}function Bl(n,r){var o=n.alternate;return o===null?(o=ps(n.tag,r,n.key,n.mode),o.elementType=n.elementType,o.type=n.type,o.stateNode=n.stateNode,o.alternate=n,n.alternate=o):(o.pendingProps=r,o.type=n.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=n.flags&14680064,o.childLanes=n.childLanes,o.lanes=n.lanes,o.child=n.child,o.memoizedProps=n.memoizedProps,o.memoizedState=n.memoizedState,o.updateQueue=n.updateQueue,r=n.dependencies,o.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},o.sibling=n.sibling,o.index=n.index,o.ref=n.ref,o}function Fp(n,r,o,h,y,w){var x=2;if(h=n,typeof n=="function")l_(n)&&(x=1);else if(typeof n=="string")x=5;else e:switch(n){case xc:return Cu(o.children,y,w,r);case Ty:x=8,y|=8;break;case wg:return n=ps(12,o,r,y|2),n.elementType=wg,n.lanes=w,n;case Sg:return n=ps(13,o,r,y),n.elementType=Sg,n.lanes=w,n;case kg:return n=ps(19,o,r,y),n.elementType=kg,n.lanes=w,n;case l1:return Mf(o,y,w,r);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case s1:x=10;break e;case o1:x=9;break e;case Iy:x=11;break e;case Py:x=14;break e;case bl:x=16,h=null;break e}throw Error(pt(130,n==null?n:typeof n,""))}return r=ps(x,o,r,y),r.elementType=n,r.type=h,r.lanes=w,r}function Cu(n,r,o,h){return n=ps(7,n,h,r),n.lanes=o,n}function Mf(n,r,o,h){return n=ps(22,n,h,r),n.elementType=l1,n.lanes=o,n.stateNode={isHidden:!1},n}function lg(n,r,o){return n=ps(6,n,null,r),n.lanes=o,n}function ug(n,r,o){return r=ps(4,n.children!==null?n.children:[],n.key,r),r.lanes=o,r.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},r}function RC(n,r,o,h,y){this.tag=r,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=$m(0),this.expirationTimes=$m(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$m(0),this.identifierPrefix=h,this.onRecoverableError=y,this.mutableSourceEagerHydrationData=null}function u_(n,r,o,h,y,w,x,c,V){return n=new RC(n,r,o,c,V),r===1?(r=1,w===!0&&(r|=8)):r=0,w=ps(3,null,null,r),n.current=w,w.stateNode=n,w.memoizedState={element:h,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ky(w),n}function OC(n,r,o){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:vc,key:h==null?null:""+h,children:n,containerInfo:r,implementation:o}}function Qb(n){if(!n)return Ul;n=n._reactInternals;e:{if(Ou(n)!==n||n.tag!==1)throw Error(pt(170));var r=n;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(Ia(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(pt(171))}if(n.tag===1){var o=n.type;if(Ia(o))return Q1(n,o,r)}return r}function ew(n,r,o,h,y,w,x,c,V){return n=u_(o,h,!0,n,y,w,x,c,V),n.context=Qb(null),o=n.current,h=oa(),y=Fl(o),w=Bo(h,y),w.callback=r??null,Rl(o,w,y),n.current.lanes=y,Cd(n,y,h),Pa(n,h),n}function Df(n,r,o,h){var y=r.current,w=oa(),x=Fl(y);return o=Qb(o),r.context===null?r.context=o:r.pendingContext=o,r=Bo(w,x),r.payload={element:n},h=h===void 0?null:h,h!==null&&(r.callback=h),n=Rl(y,r,x),n!==null&&(Rs(n,y,x,w),Mp(n,y,x)),x}function df(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function hx(n,r){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var o=n.retryLane;n.retryLane=o!==0&&o<r?o:r}}function c_(n,r){hx(n,r),(n=n.alternate)&&hx(n,r)}function FC(){return null}var tw=typeof reportError=="function"?reportError:function(n){console.error(n)};function h_(n){this._internalRoot=n}zf.prototype.render=h_.prototype.render=function(n){var r=this._internalRoot;if(r===null)throw Error(pt(409));Df(n,r,null,null)};zf.prototype.unmount=h_.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var r=n.containerInfo;Au(function(){Df(null,n,null,null)}),r[jo]=null}};function zf(n){this._internalRoot=n}zf.prototype.unstable_scheduleHydration=function(n){if(n){var r=D1();n={blockedOn:null,target:n,priority:r};for(var o=0;o<Sl.length&&r!==0&&r<Sl[o].priority;o++);Sl.splice(o,0,n),o===0&&L1(n)}};function d_(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Lf(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function dx(){}function BC(n,r,o,h,y){if(y){if(typeof h=="function"){var w=h;h=function(){var G=df(x);w.call(G)}}var x=ew(r,h,n,0,null,!1,!1,"",dx);return n._reactRootContainer=x,n[jo]=x.current,fd(n.nodeType===8?n.parentNode:n),Au(),x}for(;y=n.lastChild;)n.removeChild(y);if(typeof h=="function"){var c=h;h=function(){var G=df(V);c.call(G)}}var V=u_(n,0,!1,null,null,!1,!1,"",dx);return n._reactRootContainer=V,n[jo]=V.current,fd(n.nodeType===8?n.parentNode:n),Au(function(){Df(r,V,o,h)}),V}function Rf(n,r,o,h,y){var w=o._reactRootContainer;if(w){var x=w;if(typeof y=="function"){var c=y;y=function(){var V=df(x);c.call(V)}}Df(r,x,n,y)}else x=BC(o,r,n,y,h);return df(x)}A1=function(n){switch(n.tag){case 3:var r=n.stateNode;if(r.current.memoizedState.isDehydrated){var o=Hh(r.pendingLanes);o!==0&&(My(r,o|1),Pa(r,Gn()),!(qr&6)&&(qc=Gn()+500,ql()))}break;case 13:Au(function(){var h=Uo(n,1);if(h!==null){var y=oa();Rs(h,n,1,y)}}),c_(n,1)}};Dy=function(n){if(n.tag===13){var r=Uo(n,134217728);if(r!==null){var o=oa();Rs(r,n,134217728,o)}c_(n,134217728)}};M1=function(n){if(n.tag===13){var r=Fl(n),o=Uo(n,r);if(o!==null){var h=oa();Rs(o,n,r,h)}c_(n,r)}};D1=function(){return rn};z1=function(n,r){var o=rn;try{return rn=n,r()}finally{rn=o}};Lg=function(n,r,o){switch(r){case"input":if(Ig(n,o),r=o.name,o.type==="radio"&&r!=null){for(o=n;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<o.length;r++){var h=o[r];if(h!==n&&h.form===n.form){var y=Cf(h);if(!y)throw Error(pt(90));c1(h),Ig(h,y)}}}break;case"textarea":d1(n,o);break;case"select":r=o.value,r!=null&&Mc(n,!!o.multiple,r,!1)}};v1=a_;x1=Au;var NC={usingClientEntryPoint:!1,Events:[Id,kc,Cf,y1,_1,a_]},Uh={findFiberByHostInstance:_u,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},jC={bundleType:Uh.bundleType,version:Uh.version,rendererPackageName:Uh.rendererPackageName,rendererConfig:Uh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$o.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=S1(n),n===null?null:n.stateNode},findFiberByHostInstance:Uh.findFiberByHostInstance||FC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bp.isDisabled&&bp.supportsFiber)try{bf=bp.inject(jC),oo=bp}catch{}}Ha.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=NC;Ha.createPortal=function(n,r){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d_(r))throw Error(pt(200));return OC(n,r,null,o)};Ha.createRoot=function(n,r){if(!d_(n))throw Error(pt(299));var o=!1,h="",y=tw;return r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onRecoverableError!==void 0&&(y=r.onRecoverableError)),r=u_(n,1,!1,null,null,o,!1,h,y),n[jo]=r.current,fd(n.nodeType===8?n.parentNode:n),new h_(r)};Ha.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var r=n._reactInternals;if(r===void 0)throw typeof n.render=="function"?Error(pt(188)):(n=Object.keys(n).join(","),Error(pt(268,n)));return n=S1(r),n=n===null?null:n.stateNode,n};Ha.flushSync=function(n){return Au(n)};Ha.hydrate=function(n,r,o){if(!Lf(r))throw Error(pt(200));return Rf(null,n,r,!0,o)};Ha.hydrateRoot=function(n,r,o){if(!d_(n))throw Error(pt(405));var h=o!=null&&o.hydratedSources||null,y=!1,w="",x=tw;if(o!=null&&(o.unstable_strictMode===!0&&(y=!0),o.identifierPrefix!==void 0&&(w=o.identifierPrefix),o.onRecoverableError!==void 0&&(x=o.onRecoverableError)),r=ew(r,null,n,1,o??null,y,!1,w,x),n[jo]=r.current,fd(n),h)for(n=0;n<h.length;n++)o=h[n],y=o._getVersion,y=y(o._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[o,y]:r.mutableSourceEagerHydrationData.push(o,y);return new zf(r)};Ha.render=function(n,r,o){if(!Lf(r))throw Error(pt(200));return Rf(null,n,r,!1,o)};Ha.unmountComponentAtNode=function(n){if(!Lf(n))throw Error(pt(40));return n._reactRootContainer?(Au(function(){Rf(null,null,n,!1,function(){n._reactRootContainer=null,n[jo]=null})}),!0):!1};Ha.unstable_batchedUpdates=a_;Ha.unstable_renderSubtreeIntoContainer=function(n,r,o,h){if(!Lf(o))throw Error(pt(200));if(n==null||n._reactInternals===void 0)throw Error(pt(38));return Rf(n,r,o,!1,h)};Ha.version="18.3.1-next-f1338f8080-20240426";function rw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(rw)}catch(n){console.error(n)}}rw(),r1.exports=Ha;var UC=r1.exports,px=UC;xg.createRoot=px.createRoot,xg.hydrateRoot=px.hydrateRoot;var nw={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(n,r){(function(o,h){n.exports=h()})(Up,function(){var o={},h={};function y(x,c,V){if(h[x]=V,x==="index"){var G="var sharedModule = {}; ("+h.shared+")(sharedModule); ("+h.worker+")(sharedModule);",Y={};return h.shared(Y),h.index(o,Y),typeof window<"u"&&o.setWorkerUrl(window.URL.createObjectURL(new Blob([G],{type:"text/javascript"}))),o}}y("shared",["exports"],function(x){function c(i,t,a,l){return new(a||(a=Promise))(function(p,g){function _(P){try{C(l.next(P))}catch(A){g(A)}}function b(P){try{C(l.throw(P))}catch(A){g(A)}}function C(P){var A;P.done?p(P.value):(A=P.value,A instanceof a?A:new a(function(z){z(A)})).then(_,b)}C((l=l.apply(i,t||[])).next())})}function V(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var G=Y;function Y(i,t){this.x=i,this.y=t}Y.prototype={clone:function(){return new Y(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,a=i.y-this.y;return t*t+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),a=Math.sin(i),l=a*this.x+t*this.y;return this.x=t*this.x-a*this.y,this.y=l,this},_rotateAround:function(i,t){var a=Math.cos(i),l=Math.sin(i),p=t.y+l*(this.x-t.x)+a*(this.y-t.y);return this.x=t.x+a*(this.x-t.x)-l*(this.y-t.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Y.convert=function(i){return i instanceof Y?i:Array.isArray(i)?new Y(i[0],i[1]):i};var Q=V(G),H=Le;function Le(i,t,a,l){this.cx=3*i,this.bx=3*(a-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=a,this.p2y=l}Le.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var a=i,l=0;l<8;l++){var p=this.sampleCurveX(a)-i;if(Math.abs(p)<t)return a;var g=this.sampleCurveDerivativeX(a);if(Math.abs(g)<1e-6)break;a-=p/g}var _=0,b=1;for(a=i,l=0;l<20&&(p=this.sampleCurveX(a),!(Math.abs(p-i)<t));l++)i>p?_=a:b=a,a=.5*(b-_)+_;return a},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Be=V(H);let be,$e;function re(){return be==null&&(be=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),be}function J(){if($e==null&&($e=!1,re())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let l=0;l<5*5;l++){const p=4*l;t.fillStyle=`rgb(${p},${p+1},${p+2})`,t.fillRect(l%5,Math.floor(l/5),1,1)}const a=t.getImageData(0,0,5,5).data;for(let l=0;l<5*5*4;l++)if(l%4!=3&&a[l]!==l){$e=!0;break}}}return $e||!1}function le(i,t,a,l){const p=new Be(i,t,a,l);return g=>p.solve(g)}const we=le(.25,.1,.25,1);function Ze(i,t,a){return Math.min(a,Math.max(t,i))}function He(i,t,a){const l=a-t,p=((i-t)%l+l)%l+t;return p===t?a:p}function Xe(i,...t){for(const a of t)for(const l in a)i[l]=a[l];return i}let fe=1;function ve(i,t,a){const l={};for(const p in i)l[p]=t.call(this,i[p],p,i);return l}function je(i,t,a){const l={};for(const p in i)t.call(this,i[p],p,i)&&(l[p]=i[p]);return l}function tt(i){return Array.isArray(i)?i.map(tt):typeof i=="object"&&i?ve(i,tt):i}const _t={};function Bt(i){_t[i]||(typeof console<"u"&&console.warn(i),_t[i]=!0)}function gr(i,t,a){return(a.y-i.y)*(t.x-i.x)>(t.y-i.y)*(a.x-i.x)}function Gr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Hr=null;function ar(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function it(i,t,a,l,p){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(i,{timestamp:0});try{const _=g?.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const b=_.startsWith("BGR"),C=new Uint8ClampedArray(l*p*4);if(yield g.copyTo(C,function(P,A,z,F,U){const K=4*Math.max(-A,0),W=(Math.max(0,z)-z)*F*4+K,ae=4*F,ue=Math.max(0,A),Fe=Math.max(0,z);return{rect:{x:ue,y:Fe,width:Math.min(P.width,A+F)-ue,height:Math.min(P.height,z+U)-Fe},layout:[{offset:W,stride:ae}]}}(i,t,a,l,p)),b)for(let P=0;P<C.length;P+=4){const A=C[P];C[P]=C[P+2],C[P+2]=A}return C}finally{g.close()}})}let Mt,Tt;const jt="AbortError";function zt(){return new Error(jt)}const Sr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function br(i){return Sr.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const kr="global-dispatcher";class Mr extends Error{constructor(t,a,l,p){super(`AJAXError: ${a} (${t}): ${l}`),this.status=t,this.statusText=a,this.url=l,this.body=p}}const lr=()=>Gr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ct=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const l=br(i.url);if(l)return l(i,t);if(Gr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:kr},t)}if(!(/^file:/.test(a=i.url)||/^file:/.test(lr())&&!/^\w+:/.test(a))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(l,p){return c(this,void 0,void 0,function*(){const g=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:lr(),signal:p.signal});l.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");const _=yield fetch(g);if(!_.ok){const P=yield _.blob();throw new Mr(_.status,_.statusText,l.url,P)}let b;b=l.type==="arrayBuffer"||l.type==="image"?_.arrayBuffer():l.type==="json"?_.json():_.text();const C=yield b;if(p.signal.aborted)throw zt();return{data:C,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(i,t);if(Gr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:kr},t)}var a;return function(l,p){return new Promise((g,_)=>{var b;const C=new XMLHttpRequest;C.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(C.responseType="arraybuffer");for(const P in l.headers)C.setRequestHeader(P,l.headers[P]);l.type==="json"&&(C.responseType="text",!((b=l.headers)===null||b===void 0)&&b.Accept||C.setRequestHeader("Accept","application/json")),C.withCredentials=l.credentials==="include",C.onerror=()=>{_(new Error(C.statusText))},C.onload=()=>{if(!p.signal.aborted)if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){let P=C.response;if(l.type==="json")try{P=JSON.parse(C.response)}catch(A){return void _(A)}g({data:P,cacheControl:C.getResponseHeader("Cache-Control"),expires:C.getResponseHeader("Expires")})}else{const P=new Blob([C.response],{type:C.getResponseHeader("Content-Type")});_(new Mr(C.status,C.statusText,l.url,P))}},p.signal.addEventListener("abort",()=>{C.abort(),_(zt())}),C.send(l.body)})}(i,t)};function Ht(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),a=window.location;return t.protocol===a.protocol&&t.host===a.host}function Nt(i,t,a){a[i]&&a[i].indexOf(t)!==-1||(a[i]=a[i]||[],a[i].push(t))}function wt(i,t,a){if(a&&a[i]){const l=a[i].indexOf(t);l!==-1&&a[i].splice(l,1)}}class Ir{constructor(t,a={}){Xe(this,a),this.type=t}}class Dr extends Ir{constructor(t,a={}){super("error",Xe({error:t},a))}}class _r{on(t,a){return this._listeners=this._listeners||{},Nt(t,a,this._listeners),this}off(t,a){return wt(t,a,this._listeners),wt(t,a,this._oneTimeListeners),this}once(t,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Nt(t,a,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,a){typeof t=="string"&&(t=new Ir(t,a||{}));const l=t.type;if(this.listens(l)){t.target=this;const p=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const b of p)b.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const b of g)wt(l,b,this._oneTimeListeners),b.call(this,t);const _=this._eventedParent;_&&(Xe(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof Dr&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,a){return this._eventedParent=t,this._eventedParentData=a,this}}var Ee={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const nn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Pr(i,t){const a={};for(const l in i)l!=="ref"&&(a[l]=i[l]);return nn.forEach(l=>{l in t&&(a[l]=t[l])}),a}function Jt(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let a=0;a<i.length;a++)if(!Jt(i[a],t[a]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const a in i)if(!Jt(i[a],t[a]))return!1;return!0}return i===t}function pr(i,t){i.push(t)}function _n(i,t,a){pr(a,{command:"addSource",args:[i,t[i]]})}function Sn(i,t,a){pr(t,{command:"removeSource",args:[i]}),a[i]=!0}function An(i,t,a,l){Sn(i,a,l),_n(i,t,a)}function an(i,t,a){let l;for(l in i[a])if(Object.prototype.hasOwnProperty.call(i[a],l)&&l!=="data"&&!Jt(i[a][l],t[a][l]))return!1;for(l in t[a])if(Object.prototype.hasOwnProperty.call(t[a],l)&&l!=="data"&&!Jt(i[a][l],t[a][l]))return!1;return!0}function Wr(i,t,a,l,p,g){i=i||{},t=t||{};for(const _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(Jt(i[_],t[_])||a.push({command:g,args:[l,_,t[_],p]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(i,_)&&(Jt(i[_],t[_])||a.push({command:g,args:[l,_,t[_],p]}))}function Vr(i){return i.id}function Yr(i,t){return i[t.id]=t,i}class rt{constructor(t,a,l,p){this.message=(t?`${t}: `:"")+l,p&&(this.identifier=p),a!=null&&a.__line__&&(this.line=a.__line__)}}function Fn(i,...t){for(const a of t)for(const l in a)i[l]=a[l];return i}class kn extends Error{constructor(t,a){super(a),this.message=a,this.key=t}}class Cn{constructor(t,a=[]){this.parent=t,this.bindings={};for(const[l,p]of a)this.bindings[l]=p}concat(t){return new Cn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const en={kind:"null"},lt={kind:"number"},hr={kind:"string"},Xt={kind:"boolean"},Ot={kind:"color"},ti={kind:"object"},rr={kind:"value"},wi={kind:"collator"},St={kind:"formatted"},ca={kind:"padding"},Xi={kind:"resolvedImage"},oe={kind:"variableAnchorOffsetCollection"};function j(i,t){return{kind:"array",itemType:i,N:t}}function N(i){if(i.kind==="array"){const t=N(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const Z=[en,lt,hr,Xt,Ot,St,ti,j(rr),ca,Xi,oe];function ie(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ie(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const a of Z)if(!ie(a,t))return null}}return`Expected ${N(i)} but found ${N(t)} instead.`}function ye(i,t){return t.some(a=>a.kind===i.kind)}function Se(i,t){return t.some(a=>a==="null"?i===null:a==="array"?Array.isArray(i):a==="object"?i&&!Array.isArray(i)&&typeof i=="object":a===typeof i)}function ze(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const pe=.96422,Ue=.82521,We=4/29,qe=6/29,ht=3*qe*qe,Ut=qe*qe*qe,Wt=Math.PI/180,zr=180/Math.PI;function nr(i){return(i%=360)<0&&(i+=360),i}function wr([i,t,a,l]){let p,g;const _=dn((.2225045*(i=dr(i))+.7168786*(t=dr(t))+.0606169*(a=dr(a)))/1);i===t&&t===a?p=g=_:(p=dn((.4360747*i+.3850649*t+.1430804*a)/pe),g=dn((.0139322*i+.0971045*t+.7141733*a)/Ue));const b=116*_-16;return[b<0?0:b,500*(p-_),200*(_-g),l]}function dr(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function dn(i){return i>Ut?Math.pow(i,1/3):i/ht+We}function pn([i,t,a,l]){let p=(i+16)/116,g=isNaN(t)?p:p+t/500,_=isNaN(a)?p:p-a/200;return p=1*jr(p),g=pe*jr(g),_=Ue*jr(_),[ur(3.1338561*g-1.6168667*p-.4906146*_),ur(-.9787684*g+1.9161415*p+.033454*_),ur(.0719453*g-.2289914*p+1.4052427*_),l]}function ur(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function jr(i){return i>qe?i*i*i:ht*(i-We)}function Ur(i){return parseInt(i.padEnd(2,i),16)/255}function Mn(i,t){return Dn(t?i/100:i,0,1)}function Dn(i,t,a){return Math.min(Math.max(t,i),a)}function Lr(i){return!i.some(Number.isNaN)}const zi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Cr{constructor(t,a,l,p=1,g=!0){this.r=t,this.g=a,this.b=l,this.a=p,g||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[t,a,l,p]))}static parse(t){if(t instanceof Cr)return t;if(typeof t!="string")return;const a=function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=zi[l];if(p){const[_,b,C]=p;return[_/255,b/255,C/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const _=l.length<6?1:2;let b=1;return[Ur(l.slice(b,b+=_)),Ur(l.slice(b,b+=_)),Ur(l.slice(b,b+=_)),Ur(l.slice(b,b+_)||"ff")]}if(l.startsWith("rgb")){const _=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[b,C,P,A,z,F,U,K,W,ae,ue,Fe]=_,_e=[A||" ",U||" ",ae].join("");if(_e==="  "||_e==="  /"||_e===",,"||_e===",,,"){const Me=[P,F,W].join(""),Ke=Me==="%%%"?100:Me===""?255:0;if(Ke){const nt=[Dn(+C/Ke,0,1),Dn(+z/Ke,0,1),Dn(+K/Ke,0,1),ue?Mn(+ue,Fe):1];if(Lr(nt))return nt}}return}}const g=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,b,C,P,A,z,F,U,K]=g,W=[C||" ",A||" ",F].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){const ae=[+b,Dn(+P,0,100),Dn(+z,0,100),U?Mn(+U,K):1];if(Lr(ae))return function([ue,Fe,_e,Me]){function Ke(nt){const Et=(nt+ue/30)%12,Qt=Fe*Math.min(_e,1-_e);return _e-Qt*Math.max(-1,Math.min(Et-3,9-Et,1))}return ue=nr(ue),Fe/=100,_e/=100,[Ke(0),Ke(8),Ke(4),Me]}(ae)}}}(t);return a?new Cr(...a,!1):void 0}get rgb(){const{r:t,g:a,b:l,a:p}=this,g=p||1/0;return this.overwriteGetter("rgb",[t/g,a/g,l/g,p])}get hcl(){return this.overwriteGetter("hcl",function(t){const[a,l,p,g]=wr(t),_=Math.sqrt(l*l+p*p);return[Math.round(1e4*_)?nr(Math.atan2(p,l)*zr):NaN,_,a,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",wr(this.rgb))}overwriteGetter(t,a){return Object.defineProperty(this,t,{value:a}),a}toString(){const[t,a,l,p]=this.rgb;return`rgba(${[t,a,l].map(g=>Math.round(255*g)).join(",")},${p})`}}Cr.black=new Cr(0,0,0,1),Cr.white=new Cr(1,1,1,1),Cr.transparent=new Cr(0,0,0,0),Cr.red=new Cr(1,0,0,1);class qo{constructor(t,a,l){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,a){return this.collator.compare(t,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Za{constructor(t,a,l,p,g){this.text=t,this.image=a,this.scale=l,this.fontStack=p,this.textColor=g}}class Hn{constructor(t){this.sections=t}static fromString(t){return new Hn([new Za(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Hn?t:Hn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class ri{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ri)return t;if(typeof t=="number")return new ri([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const a of t)if(typeof a!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new ri(t)}}toString(){return JSON.stringify(this.values)}}const Kl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Bn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Bn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let a=0;a<t.length;a+=2){const l=t[a],p=t[a+1];if(typeof l!="string"||!Kl.has(l)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new Bn(t)}}toString(){return JSON.stringify(this.values)}}class ci{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ci({name:t,available:!1}):null}}function Ea(i,t,a,l){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,t,a,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,t,a,l]:[i,t,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xa(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Cr||i instanceof qo||i instanceof Hn||i instanceof ri||i instanceof Bn||i instanceof ci)return!0;if(Array.isArray(i)){for(const t of i)if(!Xa(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Xa(i[t]))return!1;return!0}return!1}function ir(i){if(i===null)return en;if(typeof i=="string")return hr;if(typeof i=="boolean")return Xt;if(typeof i=="number")return lt;if(i instanceof Cr)return Ot;if(i instanceof qo)return wi;if(i instanceof Hn)return St;if(i instanceof ri)return ca;if(i instanceof Bn)return oe;if(i instanceof ci)return Xi;if(Array.isArray(i)){const t=i.length;let a;for(const l of i){const p=ir(l);if(a){if(a===p)continue;a=rr;break}a=p}return j(a||rr,t)}return ti}function Bs(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof Cr||i instanceof Hn||i instanceof ri||i instanceof Bn||i instanceof ci?i.toString():JSON.stringify(i)}class Li{constructor(t,a){this.type=t,this.value=a}static parse(t,a){if(t.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Xa(t[1]))return a.error("invalid value");const l=t[1];let p=ir(l);const g=a.expectedType;return p.kind!=="array"||p.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(p=g),new Li(p,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class sn{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ya={string:hr,number:lt,boolean:Xt,object:ti};class Ri{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");let l,p=1;const g=t[0];if(g==="array"){let b,C;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in Ya)||P==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ya[P],p++}else b=rr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);C=t[2],p++}l=j(b,C)}else{if(!Ya[g])throw new Error(`Types doesn't contain name = ${g}`);l=Ya[g]}const _=[];for(;p<t.length;p++){const b=a.parse(t[p],p,rr);if(!b)return null;_.push(b)}return new Ri(l,_)}evaluate(t){for(let a=0;a<this.args.length;a++){const l=this.args[a].evaluate(t);if(!ie(this.type,ir(l)))return l;if(a===this.args.length-1)throw new sn(`Expected value to be of type ${N(this.type)}, but found ${N(ir(l))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Go={"to-boolean":Xt,"to-color":Ot,"to-number":lt,"to-string":hr};class Oi{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const l=t[0];if(!Go[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&t.length!==2)return a.error("Expected one argument.");const p=Go[l],g=[];for(let _=1;_<t.length;_++){const b=a.parse(t[_],_,rr);if(!b)return null;g.push(b)}return new Oi(p,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let a,l;for(const p of this.args){if(a=p.evaluate(t),l=null,a instanceof Cr)return a;if(typeof a=="string"){const g=t.parseColor(a);if(g)return g}else if(Array.isArray(a)&&(l=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Ea(a[0],a[1],a[2],a[3]),!l))return new Cr(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new sn(l||`Could not parse color from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"padding":{let a;for(const l of this.args){a=l.evaluate(t);const p=ri.parse(a);if(p)return p}throw new sn(`Could not parse padding from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"variableAnchorOffsetCollection":{let a;for(const l of this.args){a=l.evaluate(t);const p=Bn.parse(a);if(p)return p}throw new sn(`Could not parse variableAnchorOffsetCollection from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"number":{let a=null;for(const l of this.args){if(a=l.evaluate(t),a===null)return 0;const p=Number(a);if(!isNaN(p))return p}throw new sn(`Could not convert ${JSON.stringify(a)} to number.`)}case"formatted":return Hn.fromString(Bs(this.args[0].evaluate(t)));case"resolvedImage":return ci.fromString(Bs(this.args[0].evaluate(t)));default:return Bs(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Jr=["Unknown","Point","LineString","Polygon"];class Ja{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Jr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=Cr.parse(t)),a}}class Yi{constructor(t,a,l=[],p,g=new Cn,_=[]){this.registry=t,this.path=l,this.key=l.map(b=>`[${b}]`).join(""),this.scope=g,this.errors=_,this.expectedType=p,this._isConstant=a}parse(t,a,l,p,g={}){return a?this.concat(a,l,p)._parse(t,g):this._parse(t,g)}_parse(t,a){function l(p,g,_){return _==="assert"?new Ri(g,[p]):_==="coerce"?new Oi(g,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=t[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[p];if(g){let _=g.parse(t,this);if(!_)return null;if(this.expectedType){const b=this.expectedType,C=_.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||C.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(b.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array")if(b.kind!=="variableAnchorOffsetCollection"||C.kind!=="value"&&C.kind!=="array"){if(this.checkSubtype(b,C))return null}else _=l(_,b,a.typeAnnotation||"coerce");else _=l(_,b,a.typeAnnotation||"coerce");else _=l(_,b,a.typeAnnotation||"coerce");else _=l(_,b,a.typeAnnotation||"assert")}if(!(_ instanceof Li)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const b=new Ja;try{_=new Li(_.type,_.evaluate(b))}catch(C){return this.error(C.message),null}}return _}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,a,l){const p=typeof t=="number"?this.path.concat(t):this.path,g=l?this.scope.concat(l):this.scope;return new Yi(this.registry,this._isConstant,p,a||null,g,this.errors)}error(t,...a){const l=`${this.key}${a.map(p=>`[${p}]`).join("")}`;this.errors.push(new kn(l,t))}checkSubtype(t,a){const l=ie(t,a);return l&&this.error(l),l}}class Si{constructor(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const a of this.bindings)t(a[1]);t(this.result)}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let g=1;g<t.length-1;g+=2){const _=t[g];if(typeof _!="string")return a.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",g);const b=a.parse(t[g+1],g+1);if(!b)return null;l.push([_,b])}const p=a.parse(t[t.length-1],t.length-1,a.expectedType,l);return p?new Si(l,p):null}outputDefined(){return this.result.outputDefined()}}class Rr{constructor(t,a){this.type=a.type,this.name=t,this.boundExpression=a}static parse(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const l=t[1];return a.scope.has(l)?new Rr(l,a.scope.get(l)):a.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ho{constructor(t,a,l){this.type=t,this.index=a,this.input=l}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=a.parse(t[1],1,lt),p=a.parse(t[2],2,j(a.expectedType||rr));return l&&p?new ho(p.type.itemType,l,p):null}evaluate(t){const a=this.index.evaluate(t),l=this.input.evaluate(t);if(a<0)throw new sn(`Array index out of bounds: ${a} < 0.`);if(a>=l.length)throw new sn(`Array index out of bounds: ${a} > ${l.length-1}.`);if(a!==Math.floor(a))throw new sn(`Array index must be an integer, but found ${a} instead.`);return l[a]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Ns{constructor(t,a){this.type=Xt,this.needle=t,this.haystack=a}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=a.parse(t[1],1,rr),p=a.parse(t[2],2,rr);return l&&p?ye(l.type,[Xt,hr,lt,en,rr])?new Ns(l,p):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${N(l.type)} instead`):null}evaluate(t){const a=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!Se(a,["boolean","string","number","null"]))throw new sn(`Expected first argument to be of type boolean, string, number or null, but found ${N(ir(a))} instead.`);if(!Se(l,["string","array"]))throw new sn(`Expected second argument to be of type array or string, but found ${N(ir(l))} instead.`);return l.indexOf(a)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class _s{constructor(t,a,l){this.type=lt,this.needle=t,this.haystack=a,this.fromIndex=l}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=a.parse(t[1],1,rr),p=a.parse(t[2],2,rr);if(!l||!p)return null;if(!ye(l.type,[Xt,hr,lt,en,rr]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${N(l.type)} instead`);if(t.length===4){const g=a.parse(t[3],3,lt);return g?new _s(l,p,g):null}return new _s(l,p)}evaluate(t){const a=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!Se(a,["boolean","string","number","null"]))throw new sn(`Expected first argument to be of type boolean, string, number or null, but found ${N(ir(a))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(t)),Se(l,["string"])){const g=l.indexOf(a,p);return g===-1?-1:[...l.slice(0,g)].length}if(Se(l,["array"]))return l.indexOf(a,p);throw new sn(`Expected second argument to be of type array or string, but found ${N(ir(l))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class js{constructor(t,a,l,p,g,_){this.inputType=t,this.type=a,this.input=l,this.cases=p,this.outputs=g,this.otherwise=_}static parse(t,a){if(t.length<5)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return a.error("Expected an even number of arguments.");let l,p;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);const g={},_=[];for(let P=2;P<t.length-1;P+=2){let A=t[P];const z=t[P+1];Array.isArray(A)||(A=[A]);const F=a.concat(P);if(A.length===0)return F.error("Expected at least one branch label.");for(const K of A){if(typeof K!="number"&&typeof K!="string")return F.error("Branch labels must be numbers or strings.");if(typeof K=="number"&&Math.abs(K)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof K=="number"&&Math.floor(K)!==K)return F.error("Numeric branch labels must be integer values.");if(l){if(F.checkSubtype(l,ir(K)))return null}else l=ir(K);if(g[String(K)]!==void 0)return F.error("Branch labels must be unique.");g[String(K)]=_.length}const U=a.parse(z,P,p);if(!U)return null;p=p||U.type,_.push(U)}const b=a.parse(t[1],1,rr);if(!b)return null;const C=a.parse(t[t.length-1],t.length-1,p);return C?b.type.kind!=="value"&&a.concat(1).checkSubtype(l,b.type)?null:new js(l,p,b,g,_,C):null}evaluate(t){const a=this.input.evaluate(t);return(ir(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class po{constructor(t,a,l){this.type=t,this.branches=a,this.otherwise=l}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return a.error("Expected an odd number of arguments.");let l;a.expectedType&&a.expectedType.kind!=="value"&&(l=a.expectedType);const p=[];for(let _=1;_<t.length-1;_+=2){const b=a.parse(t[_],_,Xt);if(!b)return null;const C=a.parse(t[_+1],_+1,l);if(!C)return null;p.push([b,C]),l=l||C.type}const g=a.parse(t[t.length-1],t.length-1,l);if(!g)return null;if(!l)throw new Error("Can't infer output type");return new po(l,p,g)}evaluate(t){for(const[a,l]of this.branches)if(a.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[a,l]of this.branches)t(a),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,a])=>a.outputDefined())&&this.otherwise.outputDefined()}}class fo{constructor(t,a,l,p){this.type=t,this.input=a,this.beginIndex=l,this.endIndex=p}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=a.parse(t[1],1,rr),p=a.parse(t[2],2,lt);if(!l||!p)return null;if(!ye(l.type,[j(rr),hr,rr]))return a.error(`Expected first argument to be of type array or string, but found ${N(l.type)} instead`);if(t.length===4){const g=a.parse(t[3],3,lt);return g?new fo(l.type,l,p,g):null}return new fo(l.type,l,p)}evaluate(t){const a=this.input.evaluate(t),l=this.beginIndex.evaluate(t);let p;if(this.endIndex&&(p=this.endIndex.evaluate(t)),Se(a,["string"]))return[...a].slice(l,p).join("");if(Se(a,["array"]))return a.slice(l,p);throw new sn(`Expected first argument to be of type array or string, but found ${N(ir(a))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Or(i,t){const a=i.length-1;let l,p,g=0,_=a,b=0;for(;g<=_;)if(b=Math.floor((g+_)/2),l=i[b],p=i[b+1],l<=t){if(b===a||t<p)return b;g=b+1}else{if(!(l>t))throw new sn("Input is not a number.");_=b-1}return 0}class vs{constructor(t,a,l){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(const[p,g]of l)this.labels.push(p),this.outputs.push(g)}static parse(t,a){if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");const l=a.parse(t[1],1,lt);if(!l)return null;const p=[];let g=null;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);for(let _=1;_<t.length;_+=2){const b=_===1?-1/0:t[_],C=t[_+1],P=_,A=_+1;if(typeof b!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(p.length&&p[p.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const z=a.parse(C,A,g);if(!z)return null;g=g||z.type,p.push([b,z])}return new vs(g,l,p)}evaluate(t){const a=this.labels,l=this.outputs;if(a.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=a[0])return l[0].evaluate(t);const g=a.length;return p>=a[g-1]?l[g-1].evaluate(t):l[Or(a,p)].evaluate(t)}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Bu(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Xc=hi;function hi(i,t,a,l){this.cx=3*i,this.bx=3*(a-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=a,this.p2y=l}hi.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var a=i,l=0;l<8;l++){var p=this.sampleCurveX(a)-i;if(Math.abs(p)<t)return a;var g=this.sampleCurveDerivativeX(a);if(Math.abs(g)<1e-6)break;a-=p/g}var _=0,b=1;for(a=i,l=0;l<20&&(p=this.sampleCurveX(a),!(Math.abs(p-i)<t));l++)i>p?_=a:b=a,a=.5*(b-_)+_;return a},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Us=Bu(Xc);function ha(i,t,a){return i+a*(t-i)}function Fi(i,t,a){return i.map((l,p)=>ha(l,t[p],a))}const ni={number:ha,color:function(i,t,a,l="rgb"){switch(l){case"rgb":{const[p,g,_,b]=Fi(i.rgb,t.rgb,a);return new Cr(p,g,_,b,!1)}case"hcl":{const[p,g,_,b]=i.hcl,[C,P,A,z]=t.hcl;let F,U;if(isNaN(p)||isNaN(C))isNaN(p)?isNaN(C)?F=NaN:(F=C,_!==1&&_!==0||(U=P)):(F=p,A!==1&&A!==0||(U=g));else{let Fe=C-p;C>p&&Fe>180?Fe-=360:C<p&&p-C>180&&(Fe+=360),F=p+a*Fe}const[K,W,ae,ue]=function([Fe,_e,Me,Ke]){return Fe=isNaN(Fe)?0:Fe*Wt,pn([Me,Math.cos(Fe)*_e,Math.sin(Fe)*_e,Ke])}([F,U??ha(g,P,a),ha(_,A,a),ha(b,z,a)]);return new Cr(K,W,ae,ue,!1)}case"lab":{const[p,g,_,b]=pn(Fi(i.lab,t.lab,a));return new Cr(p,g,_,b,!1)}}},array:Fi,padding:function(i,t,a){return new ri(Fi(i.values,t.values,a))},variableAnchorOffsetCollection:function(i,t,a){const l=i.values,p=t.values;if(l.length!==p.length)throw new sn(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const g=[];for(let _=0;_<l.length;_+=2){if(l[_]!==p[_])throw new sn(`Cannot interpolate values containing mismatched anchors. from[${_}]: ${l[_]}, to[${_}]: ${p[_]}`);g.push(l[_]);const[b,C]=l[_+1],[P,A]=p[_+1];g.push([ha(b,P,a),ha(C,A,a)])}return new Bn(g)}};class ii{constructor(t,a,l,p,g){this.type=t,this.operator=a,this.interpolation=l,this.input=p,this.labels=[],this.outputs=[];for(const[_,b]of g)this.labels.push(_),this.outputs.push(b)}static interpolationFactor(t,a,l,p){let g=0;if(t.name==="exponential")g=vn(a,t.base,l,p);else if(t.name==="linear")g=vn(a,1,l,p);else if(t.name==="cubic-bezier"){const _=t.controlPoints;g=new Us(_[0],_[1],_[2],_[3]).solve(vn(a,1,l,p))}return g}static parse(t,a){let[l,p,g,..._]=t;if(!Array.isArray(p)||p.length===0)return a.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const P=p[1];if(typeof P!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:P}}else{if(p[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const P=p.slice(1);if(P.length!==4||P.some(A=>typeof A!="number"||A<0||A>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(g=a.parse(g,2,lt),!g)return null;const b=[];let C=null;l==="interpolate-hcl"||l==="interpolate-lab"?C=Ot:a.expectedType&&a.expectedType.kind!=="value"&&(C=a.expectedType);for(let P=0;P<_.length;P+=2){const A=_[P],z=_[P+1],F=P+3,U=P+4;if(typeof A!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(b.length&&b[b.length-1][0]>=A)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const K=a.parse(z,U,C);if(!K)return null;C=C||K.type,b.push([A,K])}return ze(C,lt)||ze(C,Ot)||ze(C,ca)||ze(C,oe)||ze(C,j(lt))?new ii(C,l,p,g,b):a.error(`Type ${N(C)} is not interpolatable.`)}evaluate(t){const a=this.labels,l=this.outputs;if(a.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=a[0])return l[0].evaluate(t);const g=a.length;if(p>=a[g-1])return l[g-1].evaluate(t);const _=Or(a,p),b=ii.interpolationFactor(this.interpolation,p,a[_],a[_+1]),C=l[_].evaluate(t),P=l[_+1].evaluate(t);switch(this.operator){case"interpolate":return ni[this.type.kind](C,P,b);case"interpolate-hcl":return ni.color(C,P,b,"hcl");case"interpolate-lab":return ni.color(C,P,b,"lab")}}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function vn(i,t,a,l){const p=l-a,g=i-a;return p===0?0:t===1?g/p:(Math.pow(t,g)-1)/(Math.pow(t,p)-1)}class ki{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expectected at least one argument.");let l=null;const p=a.expectedType;p&&p.kind!=="value"&&(l=p);const g=[];for(const b of t.slice(1)){const C=a.parse(b,1+g.length,l,void 0,{typeAnnotation:"omit"});if(!C)return null;l=l||C.type,g.push(C)}if(!l)throw new Error("No output type");const _=p&&g.some(b=>ie(p,b.type));return new ki(_?rr:l,g)}evaluate(t){let a,l=null,p=0;for(const g of this.args)if(p++,l=g.evaluate(t),l&&l instanceof ci&&!l.available&&(a||(a=l.name),l=null,p===this.args.length&&(l=a)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Qa(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Vs(i,t,a,l){return l.compare(t,a)===0}function es(i,t,a){const l=i!=="=="&&i!=="!=";return class iw{constructor(g,_,b){this.type=Xt,this.lhs=g,this.rhs=_,this.collator=b,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const b=g[0];let C=_.parse(g[1],1,rr);if(!C)return null;if(!Qa(b,C.type))return _.concat(1).error(`"${b}" comparisons are not supported for type '${N(C.type)}'.`);let P=_.parse(g[2],2,rr);if(!P)return null;if(!Qa(b,P.type))return _.concat(2).error(`"${b}" comparisons are not supported for type '${N(P.type)}'.`);if(C.type.kind!==P.type.kind&&C.type.kind!=="value"&&P.type.kind!=="value")return _.error(`Cannot compare types '${N(C.type)}' and '${N(P.type)}'.`);l&&(C.type.kind==="value"&&P.type.kind!=="value"?C=new Ri(P.type,[C]):C.type.kind!=="value"&&P.type.kind==="value"&&(P=new Ri(C.type,[P])));let A=null;if(g.length===4){if(C.type.kind!=="string"&&P.type.kind!=="string"&&C.type.kind!=="value"&&P.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(A=_.parse(g[3],3,wi),!A)return null}return new iw(C,P,A)}evaluate(g){const _=this.lhs.evaluate(g),b=this.rhs.evaluate(g);if(l&&this.hasUntypedArgument){const C=ir(_),P=ir(b);if(C.kind!==P.kind||C.kind!=="string"&&C.kind!=="number")throw new sn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${C.kind}, ${P.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const C=ir(_),P=ir(b);if(C.kind!=="string"||P.kind!=="string")return t(g,_,b)}return this.collator?a(g,_,b,this.collator.evaluate(g)):t(g,_,b)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const ts=es("==",function(i,t,a){return t===a},Vs),Nu=es("!=",function(i,t,a){return t!==a},function(i,t,a,l){return!Vs(0,t,a,l)}),Ji=es("<",function(i,t,a){return t<a},function(i,t,a,l){return l.compare(t,a)<0}),Hl=es(">",function(i,t,a){return t>a},function(i,t,a,l){return l.compare(t,a)>0}),ju=es("<=",function(i,t,a){return t<=a},function(i,t,a,l){return l.compare(t,a)<=0}),Ko=es(">=",function(i,t,a){return t>=a},function(i,t,a,l){return l.compare(t,a)>=0});class Aa{constructor(t,a,l){this.type=wi,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=a}static parse(t,a){if(t.length!==2)return a.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return a.error("Collator options argument must be an object.");const p=a.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Xt);if(!p)return null;const g=a.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Xt);if(!g)return null;let _=null;return l.locale&&(_=a.parse(l.locale,1,hr),!_)?null:new Aa(p,g,_)}evaluate(t){return new qo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class mo{constructor(t,a,l,p,g){this.type=hr,this.number=t,this.locale=a,this.currency=l,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(t,a){if(t.length!==3)return a.error("Expected two arguments.");const l=a.parse(t[1],1,lt);if(!l)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return a.error("NumberFormat options argument must be an object.");let g=null;if(p.locale&&(g=a.parse(p.locale,1,hr),!g))return null;let _=null;if(p.currency&&(_=a.parse(p.currency,1,hr),!_))return null;let b=null;if(p["min-fraction-digits"]&&(b=a.parse(p["min-fraction-digits"],1,lt),!b))return null;let C=null;return p["max-fraction-digits"]&&(C=a.parse(p["max-fraction-digits"],1,lt),!C)?null:new mo(l,g,_,b,C)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class go{constructor(t){this.type=St,this.sections=t}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return a.error("First argument must be an image or text section.");const p=[];let g=!1;for(let _=1;_<=t.length-1;++_){const b=t[_];if(g&&typeof b=="object"&&!Array.isArray(b)){g=!1;let C=null;if(b["font-scale"]&&(C=a.parse(b["font-scale"],1,lt),!C))return null;let P=null;if(b["text-font"]&&(P=a.parse(b["text-font"],1,j(hr)),!P))return null;let A=null;if(b["text-color"]&&(A=a.parse(b["text-color"],1,Ot),!A))return null;const z=p[p.length-1];z.scale=C,z.font=P,z.textColor=A}else{const C=a.parse(t[_],1,rr);if(!C)return null;const P=C.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:C,scale:null,font:null,textColor:null})}}return new go(p)}evaluate(t){return new Hn(this.sections.map(a=>{const l=a.content.evaluate(t);return ir(l)===Xi?new Za("",l,null,null,null):new Za(Bs(l),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))}eachChild(t){for(const a of this.sections)t(a.content),a.scale&&t(a.scale),a.font&&t(a.font),a.textColor&&t(a.textColor)}outputDefined(){return!1}}class Wl{constructor(t){this.type=Xi,this.input=t}static parse(t,a){if(t.length!==2)return a.error("Expected two arguments.");const l=a.parse(t[1],1,hr);return l?new Wl(l):a.error("No image name provided.")}evaluate(t){const a=this.input.evaluate(t),l=ci.fromString(a);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(a)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}}class xs{constructor(t){this.type=lt,this.input=t}static parse(t,a){if(t.length!==2)return a.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=a.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${N(l.type)} instead.`):new xs(l):null}evaluate(t){const a=this.input.evaluate(t);if(typeof a=="string")return[...a].length;if(Array.isArray(a))return a.length;throw new sn(`Expected value to be of type string or array, but found ${N(ir(a))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const da=8192;function Yc(i,t){const a=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(a*p*da),Math.round(l*p*da)]}function $s(i,t){const a=Math.pow(2,t.z);return[(p=(i[0]/da+t.x)/a,360*p-180),(l=(i[1]/da+t.y)/a,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,p}function pa(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function fa(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function Br(i,t,a){const l=i[0]-t[0],p=i[1]-t[1],g=i[0]-a[0],_=i[1]-a[1];return l*_-g*p==0&&l*g<=0&&p*_<=0}function Ho(i,t,a,l){return(p=[l[0]-a[0],l[1]-a[1]])[0]*(g=[t[0]-i[0],t[1]-i[1]])[1]-p[1]*g[0]!=0&&!(!yo(i,t,a,l)||!yo(a,l,i,t));var p,g}function Jc(i,t,a){for(const l of a)for(let p=0;p<l.length-1;++p)if(Ho(i,t,l[p],l[p+1]))return!0;return!1}function rs(i,t,a=!1){let l=!1;for(const b of t)for(let C=0;C<b.length-1;C++){if(Br(i,b[C],b[C+1]))return a;(g=b[C])[1]>(p=i)[1]!=(_=b[C+1])[1]>p[1]&&p[0]<(_[0]-g[0])*(p[1]-g[1])/(_[1]-g[1])+g[0]&&(l=!l)}var p,g,_;return l}function Zl(i,t){for(const a of t)if(rs(i,a))return!0;return!1}function Xl(i,t){for(const a of i)if(!rs(a,t))return!1;for(let a=0;a<i.length-1;++a)if(Jc(i[a],i[a+1],t))return!1;return!0}function Wo(i,t){for(const a of t)if(Xl(i,a))return!0;return!1}function yo(i,t,a,l){const p=l[0]-a[0],g=l[1]-a[1],_=(i[0]-a[0])*g-p*(i[1]-a[1]),b=(t[0]-a[0])*g-p*(t[1]-a[1]);return _>0&&b<0||_<0&&b>0}function qs(i,t,a){const l=[];for(let p=0;p<i.length;p++){const g=[];for(let _=0;_<i[p].length;_++){const b=Yc(i[p][_],a);pa(t,b),g.push(b)}l.push(g)}return l}function Yl(i,t,a){const l=[];for(let p=0;p<i.length;p++){const g=qs(i[p],t,a);l.push(g)}return l}function Uu(i,t,a,l){if(i[0]<a[0]||i[0]>a[2]){const p=.5*l;let g=i[0]-a[0]>p?-l:a[0]-i[0]>p?l:0;g===0&&(g=i[0]-a[2]>p?-l:a[2]-i[0]>p?l:0),i[0]+=g}pa(t,i)}function bs(i,t,a,l){const p=Math.pow(2,l.z)*da,g=[l.x*da,l.y*da],_=[];for(const b of i)for(const C of b){const P=[C.x+g[0],C.y+g[1]];Uu(P,t,a,p),_.push(P)}return _}function Zo(i,t,a,l){const p=Math.pow(2,l.z)*da,g=[l.x*da,l.y*da],_=[];for(const C of i){const P=[];for(const A of C){const z=[A.x+g[0],A.y+g[1]];pa(t,z),P.push(z)}_.push(P)}if(t[2]-t[0]<=p/2){(b=t)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const C of _)for(const P of C)Uu(P,t,a,p)}var b;return _}class Ma{constructor(t,a){this.type=Xt,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Xa(t[1])){const l=t[1];if(l.type==="FeatureCollection"){const p=[];for(const g of l.features){const{type:_,coordinates:b}=g.geometry;_==="Polygon"&&p.push(b),_==="MultiPolygon"&&p.push(...b)}if(p.length)return new Ma(l,{type:"MultiPolygon",coordinates:p})}else if(l.type==="Feature"){const p=l.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Ma(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Ma(l,l)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,l){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(l.type==="Polygon"){const b=qs(l.coordinates,g,_),C=bs(a.geometry(),p,g,_);if(!fa(p,g))return!1;for(const P of C)if(!rs(P,b))return!1}if(l.type==="MultiPolygon"){const b=Yl(l.coordinates,g,_),C=bs(a.geometry(),p,g,_);if(!fa(p,g))return!1;for(const P of C)if(!Zl(P,b))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,l){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(l.type==="Polygon"){const b=qs(l.coordinates,g,_),C=Zo(a.geometry(),p,g,_);if(!fa(p,g))return!1;for(const P of C)if(!Xl(P,b))return!1}if(l.type==="MultiPolygon"){const b=Yl(l.coordinates,g,_),C=Zo(a.geometry(),p,g,_);if(!fa(p,g))return!1;for(const P of C)if(!Wo(P,b))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Xo=class{constructor(i=[],t=(a,l)=>a<l?-1:a>l?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:a}=this,l=t[i];for(;i>0;){const p=i-1>>1,g=t[p];if(a(l,g)>=0)break;t[i]=g,i=p}t[i]=l}_down(i){const{data:t,compare:a}=this,l=this.length>>1,p=t[i];for(;i<l;){let g=1+(i<<1);const _=g+1;if(_<this.length&&a(t[_],t[g])<0&&(g=_),a(t[g],p)>=0)break;t[i]=t[g],i=g}t[i]=p}};function Jl(i,t,a,l,p){$n(i,t,a,l||i.length-1,p||_o)}function $n(i,t,a,l,p){for(;l>a;){if(l-a>600){var g=l-a+1,_=t-a+1,b=Math.log(g),C=.5*Math.exp(2*b/3),P=.5*Math.sqrt(b*C*(g-C)/g)*(_-g/2<0?-1:1);$n(i,t,Math.max(a,Math.floor(t-_*C/g+P)),Math.min(l,Math.floor(t+(g-_)*C/g+P)),p)}var A=i[t],z=a,F=l;for(Da(i,a,t),p(i[l],A)>0&&Da(i,a,l);z<F;){for(Da(i,z,F),z++,F--;p(i[z],A)<0;)z++;for(;p(i[F],A)>0;)F--}p(i[a],A)===0?Da(i,a,F):Da(i,++F,l),F<=t&&(a=F+1),t<=F&&(l=F-1)}}function Da(i,t,a){var l=i[t];i[t]=i[a],i[a]=l}function _o(i,t){return i<t?-1:i>t?1:0}function vo(i,t){if(i.length<=1)return[i];const a=[];let l,p;for(const g of i){const _=Vu(g);_!==0&&(g.area=Math.abs(_),p===void 0&&(p=_<0),p===_<0?(l&&a.push(l),l=[g]):l.push(g))}if(l&&a.push(l),t>1)for(let g=0;g<a.length;g++)a[g].length<=t||(Jl(a[g],t,1,a[g].length-1,Yo),a[g]=a[g].slice(0,t));return a}function Yo(i,t){return t.area-i.area}function Vu(i){let t=0;for(let a,l,p=0,g=i.length,_=g-1;p<g;_=p++)a=i[p],l=i[_],t+=(l.x-a.x)*(a.y+l.y);return t}const Ql=1/298.257223563,xo=Ql*(2-Ql),Jo=Math.PI/180;class za{constructor(t){const a=6378.137*Jo*1e3,l=Math.cos(t*Jo),p=1/(1-xo*(1-l*l)),g=Math.sqrt(p);this.kx=a*g*l,this.ky=a*g*p*(1-xo)}distance(t,a){const l=this.wrap(t[0]-a[0])*this.kx,p=(t[1]-a[1])*this.ky;return Math.sqrt(l*l+p*p)}pointOnLine(t,a){let l,p,g,_,b=1/0;for(let C=0;C<t.length-1;C++){let P=t[C][0],A=t[C][1],z=this.wrap(t[C+1][0]-P)*this.kx,F=(t[C+1][1]-A)*this.ky,U=0;z===0&&F===0||(U=(this.wrap(a[0]-P)*this.kx*z+(a[1]-A)*this.ky*F)/(z*z+F*F),U>1?(P=t[C+1][0],A=t[C+1][1]):U>0&&(P+=z/this.kx*U,A+=F/this.ky*U)),z=this.wrap(a[0]-P)*this.kx,F=(a[1]-A)*this.ky;const K=z*z+F*F;K<b&&(b=K,l=P,p=A,g=C,_=U)}return{point:[l,p],index:g,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Qo(i,t){return t[0]-i[0]}function Gs(i){return i[1]-i[0]+1}function Bi(i,t){return i[1]>=i[0]&&i[1]<t}function bo(i,t){if(i[0]>i[1])return[null,null];const a=Gs(i);if(t){if(a===2)return[i,null];const p=Math.floor(a/2);return[[i[0],i[0]+p],[i[0]+p,i[1]]]}if(a===1)return[i,null];const l=Math.floor(a/2)-1;return[[i[0],i[0]+l],[i[0]+l+1,i[1]]]}function el(i,t){if(!Bi(t,i.length))return[1/0,1/0,-1/0,-1/0];const a=[1/0,1/0,-1/0,-1/0];for(let l=t[0];l<=t[1];++l)pa(a,i[l]);return a}function eu(i){const t=[1/0,1/0,-1/0,-1/0];for(const a of i)for(const l of a)pa(t,l);return t}function Ks(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Hs(i,t,a){if(!Ks(i)||!Ks(t))return NaN;let l=0,p=0;return i[2]<t[0]&&(l=t[0]-i[2]),i[0]>t[2]&&(l=i[0]-t[2]),i[1]>t[3]&&(p=i[1]-t[3]),i[3]<t[1]&&(p=t[1]-i[3]),a.distance([0,0],[l,p])}function ws(i,t,a){const l=a.pointOnLine(t,i);return a.distance(i,l.point)}function wo(i,t,a,l,p){const g=Math.min(ws(i,[a,l],p),ws(t,[a,l],p)),_=Math.min(ws(a,[i,t],p),ws(l,[i,t],p));return Math.min(g,_)}function tu(i,t,a,l,p){if(!Bi(t,i.length)||!Bi(l,a.length))return 1/0;let g=1/0;for(let _=t[0];_<t[1];++_){const b=i[_],C=i[_+1];for(let P=l[0];P<l[1];++P){const A=a[P],z=a[P+1];if(Ho(b,C,A,z))return 0;g=Math.min(g,wo(b,C,A,z,p))}}return g}function gn(i,t,a,l,p){if(!Bi(t,i.length)||!Bi(l,a.length))return NaN;let g=1/0;for(let _=t[0];_<=t[1];++_)for(let b=l[0];b<=l[1];++b)if(g=Math.min(g,p.distance(i[_],a[b])),g===0)return g;return g}function $u(i,t,a){if(rs(i,t,!0))return 0;let l=1/0;for(const p of t){const g=p[0],_=p[p.length-1];if(g!==_&&(l=Math.min(l,ws(i,[_,g],a)),l===0))return l;const b=a.pointOnLine(p,i);if(l=Math.min(l,a.distance(i,b.point)),l===0)return l}return l}function vr(i,t,a,l){if(!Bi(t,i.length))return NaN;for(let g=t[0];g<=t[1];++g)if(rs(i[g],a,!0))return 0;let p=1/0;for(let g=t[0];g<t[1];++g){const _=i[g],b=i[g+1];for(const C of a)for(let P=0,A=C.length,z=A-1;P<A;z=P++){const F=C[z],U=C[P];if(Ho(_,b,F,U))return 0;p=Math.min(p,wo(_,b,F,U,l))}}return p}function So(i,t){for(const a of i)for(const l of a)if(rs(l,t,!0))return!0;return!1}function Kr(i,t,a,l=1/0){const p=eu(i),g=eu(t);if(l!==1/0&&Hs(p,g,a)>=l)return l;if(fa(p,g)){if(So(i,t))return 0}else if(So(t,i))return 0;let _=1/0;for(const b of i)for(let C=0,P=b.length,A=P-1;C<P;A=C++){const z=b[A],F=b[C];for(const U of t)for(let K=0,W=U.length,ae=W-1;K<W;ae=K++){const ue=U[ae],Fe=U[K];if(Ho(z,F,ue,Fe))return 0;_=Math.min(_,wo(z,F,ue,Fe,a))}}return _}function $r(i,t,a,l,p,g){if(!g)return;const _=Hs(el(l,g),p,a);_<t&&i.push([_,g,[0,0]])}function ns(i,t,a,l,p,g,_){if(!g||!_)return;const b=Hs(el(l,g),el(p,_),a);b<t&&i.push([b,g,_])}function Ss(i,t,a,l,p=1/0){let g=Math.min(l.distance(i[0],a[0][0]),p);if(g===0)return g;const _=new Xo([[0,[0,i.length-1],[0,0]]],Qo),b=eu(a);for(;_.length>0;){const C=_.pop();if(C[0]>=g)continue;const P=C[1],A=t?50:100;if(Gs(P)<=A){if(!Bi(P,i.length))return NaN;if(t){const z=vr(i,P,a,l);if(isNaN(z)||z===0)return z;g=Math.min(g,z)}else for(let z=P[0];z<=P[1];++z){const F=$u(i[z],a,l);if(g=Math.min(g,F),g===0)return 0}}else{const z=bo(P,t);$r(_,g,l,i,b,z[0]),$r(_,g,l,i,b,z[1])}}return g}function Ws(i,t,a,l,p,g=1/0){let _=Math.min(g,p.distance(i[0],a[0]));if(_===0)return _;const b=new Xo([[0,[0,i.length-1],[0,a.length-1]]],Qo);for(;b.length>0;){const C=b.pop();if(C[0]>=_)continue;const P=C[1],A=C[2],z=t?50:100,F=l?50:100;if(Gs(P)<=z&&Gs(A)<=F){if(!Bi(P,i.length)&&Bi(A,a.length))return NaN;let U;if(t&&l)U=tu(i,P,a,A,p),_=Math.min(_,U);else if(t&&!l){const K=i.slice(P[0],P[1]+1);for(let W=A[0];W<=A[1];++W)if(U=ws(a[W],K,p),_=Math.min(_,U),_===0)return _}else if(!t&&l){const K=a.slice(A[0],A[1]+1);for(let W=P[0];W<=P[1];++W)if(U=ws(i[W],K,p),_=Math.min(_,U),_===0)return _}else U=gn(i,P,a,A,p),_=Math.min(_,U)}else{const U=bo(P,t),K=bo(A,l);ns(b,_,p,i,a,U[0],K[0]),ns(b,_,p,i,a,U[0],K[1]),ns(b,_,p,i,a,U[1],K[0]),ns(b,_,p,i,a,U[1],K[1])}}return _}function tl(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class ks{constructor(t,a){this.type=lt,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Xa(t[1])){const l=t[1];if(l.type==="FeatureCollection")return new ks(l,l.features.map(p=>tl(p.geometry)).flat());if(l.type==="Feature")return new ks(l,tl(l.geometry));if("type"in l&&"coordinates"in l)return new ks(l,tl(l))}return a.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,l){const p=a.geometry(),g=p.flat().map(C=>$s([C.x,C.y],a.canonical));if(p.length===0)return NaN;const _=new za(g[0][1]);let b=1/0;for(const C of l){switch(C.type){case"Point":b=Math.min(b,Ws(g,!1,[C.coordinates],!1,_,b));break;case"LineString":b=Math.min(b,Ws(g,!1,C.coordinates,!0,_,b));break;case"Polygon":b=Math.min(b,Ss(g,!1,C.coordinates,_,b))}if(b===0)return b}return b}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,l){const p=a.geometry(),g=p.flat().map(C=>$s([C.x,C.y],a.canonical));if(p.length===0)return NaN;const _=new za(g[0][1]);let b=1/0;for(const C of l){switch(C.type){case"Point":b=Math.min(b,Ws(g,!0,[C.coordinates],!1,_,b));break;case"LineString":b=Math.min(b,Ws(g,!0,C.coordinates,!0,_,b));break;case"Polygon":b=Math.min(b,Ss(g,!0,C.coordinates,_,b))}if(b===0)return b}return b}(t,this.geometries);if(t.geometryType()==="Polygon")return function(a,l){const p=a.geometry();if(p.length===0||p[0].length===0)return NaN;const g=vo(p,0).map(C=>C.map(P=>P.map(A=>$s([A.x,A.y],a.canonical)))),_=new za(g[0][0][0][1]);let b=1/0;for(const C of l)for(const P of g){switch(C.type){case"Point":b=Math.min(b,Ss([C.coordinates],!1,P,_,b));break;case"LineString":b=Math.min(b,Ss(C.coordinates,!0,P,_,b));break;case"Polygon":b=Math.min(b,Kr(P,C.coordinates,_,b))}if(b===0)return b}return b}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Zs={"==":ts,"!=":Nu,">":Hl,"<":Ji,">=":Ko,"<=":ju,array:Ri,at:ho,boolean:Ri,case:po,coalesce:ki,collator:Aa,format:go,image:Wl,in:Ns,"index-of":_s,interpolate:ii,"interpolate-hcl":ii,"interpolate-lab":ii,length:xs,let:Si,literal:Li,match:js,number:Ri,"number-format":mo,object:Ri,slice:fo,step:vs,string:Ri,"to-boolean":Oi,"to-color":Oi,"to-number":Oi,"to-string":Oi,var:Rr,within:Ma,distance:ks};class Ni{constructor(t,a,l,p){this.name=t,this.type=a,this._evaluate=l,this.args=p}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,a){const l=t[0],p=Ni.definitions[l];if(!p)return a.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(p)?p[0]:p.type,_=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,b=_.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let C=null;for(const[P,A]of b){C=new Yi(a.registry,Wn,a.path,null,a.scope);const z=[];let F=!1;for(let U=1;U<t.length;U++){const K=t[U],W=Array.isArray(P)?P[U-1]:P.type,ae=C.parse(K,1+z.length,W);if(!ae){F=!0;break}z.push(ae)}if(!F)if(Array.isArray(P)&&P.length!==z.length)C.error(`Expected ${P.length} arguments, but found ${z.length} instead.`);else{for(let U=0;U<z.length;U++){const K=Array.isArray(P)?P[U]:P.type,W=z[U];C.concat(U+1).checkSubtype(K,W.type)}if(C.errors.length===0)return new Ni(l,g,A,z)}}if(b.length===1)a.errors.push(...C.errors);else{const P=(b.length?b:_).map(([z])=>{return F=z,Array.isArray(F)?`(${F.map(N).join(", ")})`:`(${N(F.type)}...)`;var F}).join(" | "),A=[];for(let z=1;z<t.length;z++){const F=a.parse(t[z],1+A.length);if(!F)return null;A.push(N(F.type))}a.error(`Expected arguments of type ${P}, but found (${A.join(", ")}) instead.`)}return null}static register(t,a){Ni.definitions=a;for(const l in a)t[l]=Ni}}function Xs(i,[t,a,l,p]){t=t.evaluate(i),a=a.evaluate(i),l=l.evaluate(i);const g=p?p.evaluate(i):1,_=Ea(t,a,l,g);if(_)throw new sn(_);return new Cr(t/255,a/255,l/255,g,!1)}function Qi(i,t){return i in t}function fn(i,t){const a=t[i];return a===void 0?null:a}function ma(i){return{type:i}}function Wn(i){if(i instanceof Rr)return Wn(i.boundExpression);if(i instanceof Ni&&i.name==="error"||i instanceof Aa||i instanceof Ma||i instanceof ks)return!1;const t=i instanceof Oi||i instanceof Ri;let a=!0;return i.eachChild(l=>{a=t?a&&Wn(l):a&&l instanceof Li}),!!a&&ko(i)&&Ys(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ko(i){if(i instanceof Ni&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ma||i instanceof ks)return!1;let t=!0;return i.eachChild(a=>{t&&!ko(a)&&(t=!1)}),t}function is(i){if(i instanceof Ni&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(a=>{t&&!is(a)&&(t=!1)}),t}function Ys(i,t){if(i instanceof Ni&&t.indexOf(i.name)>=0)return!1;let a=!0;return i.eachChild(l=>{a&&!Ys(l,t)&&(a=!1)}),a}function ga(i){return{result:"success",value:i}}function as(i){return{result:"error",value:i}}function ea(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function La(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function rl(i){return!!i.expression&&i.expression.interpolated}function v(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function k(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function E(i){return i}function D(i,t){const a=t.type==="color",l=i.stops&&typeof i.stops[0][0]=="object",p=l||!(l||i.property!==void 0),g=i.type||(rl(t)?"exponential":"interval");if(a||t.type==="padding"){const A=a?Cr.parse:ri.parse;(i=Fn({},i)).stops&&(i.stops=i.stops.map(z=>[z[0],A(z[1])])),i.default=A(i.default?i.default:t.default)}if(i.colorSpace&&(_=i.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var _;let b,C,P;if(g==="exponential")b=he;else if(g==="interval")b=te;else if(g==="categorical"){b=q,C=Object.create(null);for(const A of i.stops)C[A[0]]=A[1];P=typeof i.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);b=xe}if(l){const A={},z=[];for(let K=0;K<i.stops.length;K++){const W=i.stops[K],ae=W[0].zoom;A[ae]===void 0&&(A[ae]={zoom:ae,type:i.type,property:i.property,default:i.default,stops:[]},z.push(ae)),A[ae].stops.push([W[0].value,W[1]])}const F=[];for(const K of z)F.push([A[K].zoom,D(A[K],t)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:ii.interpolationFactor.bind(void 0,U),zoomStops:F.map(K=>K[0]),evaluate:({zoom:K},W)=>he({stops:F,base:i.base},t,K).evaluate(K,W)}}if(p){const A=g==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:ii.interpolationFactor.bind(void 0,A),zoomStops:i.stops.map(z=>z[0]),evaluate:({zoom:z})=>b(i,t,z,C,P)}}return{kind:"source",evaluate(A,z){const F=z&&z.properties?z.properties[i.property]:void 0;return F===void 0?B(i.default,t.default):b(i,t,F,C,P)}}}function B(i,t,a){return i!==void 0?i:t!==void 0?t:a!==void 0?a:void 0}function q(i,t,a,l,p){return B(typeof a===p?l[a]:void 0,i.default,t.default)}function te(i,t,a){if(v(a)!=="number")return B(i.default,t.default);const l=i.stops.length;if(l===1||a<=i.stops[0][0])return i.stops[0][1];if(a>=i.stops[l-1][0])return i.stops[l-1][1];const p=Or(i.stops.map(g=>g[0]),a);return i.stops[p][1]}function he(i,t,a){const l=i.base!==void 0?i.base:1;if(v(a)!=="number")return B(i.default,t.default);const p=i.stops.length;if(p===1||a<=i.stops[0][0])return i.stops[0][1];if(a>=i.stops[p-1][0])return i.stops[p-1][1];const g=Or(i.stops.map(A=>A[0]),a),_=function(A,z,F,U){const K=U-F,W=A-F;return K===0?0:z===1?W/K:(Math.pow(z,W)-1)/(Math.pow(z,K)-1)}(a,l,i.stops[g][0],i.stops[g+1][0]),b=i.stops[g][1],C=i.stops[g+1][1],P=ni[t.type]||E;return typeof b.evaluate=="function"?{evaluate(...A){const z=b.evaluate.apply(void 0,A),F=C.evaluate.apply(void 0,A);if(z!==void 0&&F!==void 0)return P(z,F,_,i.colorSpace)}}:P(b,C,_,i.colorSpace)}function xe(i,t,a){switch(t.type){case"color":a=Cr.parse(a);break;case"formatted":a=Hn.fromString(a.toString());break;case"resolvedImage":a=ci.fromString(a.toString());break;case"padding":a=ri.parse(a);break;default:v(a)===t.type||t.type==="enum"&&t.values[a]||(a=void 0)}return B(a,i.default,t.default)}Ni.register(Zs,{error:[{kind:"error"},[hr],(i,[t])=>{throw new sn(t.evaluate(i))}],typeof:[hr,[rr],(i,[t])=>N(ir(t.evaluate(i)))],"to-rgba":[j(lt,4),[Ot],(i,[t])=>{const[a,l,p,g]=t.evaluate(i).rgb;return[255*a,255*l,255*p,g]}],rgb:[Ot,[lt,lt,lt],Xs],rgba:[Ot,[lt,lt,lt,lt],Xs],has:{type:Xt,overloads:[[[hr],(i,[t])=>Qi(t.evaluate(i),i.properties())],[[hr,ti],(i,[t,a])=>Qi(t.evaluate(i),a.evaluate(i))]]},get:{type:rr,overloads:[[[hr],(i,[t])=>fn(t.evaluate(i),i.properties())],[[hr,ti],(i,[t,a])=>fn(t.evaluate(i),a.evaluate(i))]]},"feature-state":[rr,[hr],(i,[t])=>fn(t.evaluate(i),i.featureState||{})],properties:[ti,[],i=>i.properties()],"geometry-type":[hr,[],i=>i.geometryType()],id:[rr,[],i=>i.id()],zoom:[lt,[],i=>i.globals.zoom],"heatmap-density":[lt,[],i=>i.globals.heatmapDensity||0],"line-progress":[lt,[],i=>i.globals.lineProgress||0],accumulated:[rr,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[lt,ma(lt),(i,t)=>{let a=0;for(const l of t)a+=l.evaluate(i);return a}],"*":[lt,ma(lt),(i,t)=>{let a=1;for(const l of t)a*=l.evaluate(i);return a}],"-":{type:lt,overloads:[[[lt,lt],(i,[t,a])=>t.evaluate(i)-a.evaluate(i)],[[lt],(i,[t])=>-t.evaluate(i)]]},"/":[lt,[lt,lt],(i,[t,a])=>t.evaluate(i)/a.evaluate(i)],"%":[lt,[lt,lt],(i,[t,a])=>t.evaluate(i)%a.evaluate(i)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(i,[t,a])=>Math.pow(t.evaluate(i),a.evaluate(i))],sqrt:[lt,[lt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[lt,[lt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[lt,[lt],(i,[t])=>Math.log(t.evaluate(i))],log2:[lt,[lt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[lt,[lt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[lt,[lt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[lt,[lt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[lt,[lt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[lt,[lt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[lt,[lt],(i,[t])=>Math.atan(t.evaluate(i))],min:[lt,ma(lt),(i,t)=>Math.min(...t.map(a=>a.evaluate(i)))],max:[lt,ma(lt),(i,t)=>Math.max(...t.map(a=>a.evaluate(i)))],abs:[lt,[lt],(i,[t])=>Math.abs(t.evaluate(i))],round:[lt,[lt],(i,[t])=>{const a=t.evaluate(i);return a<0?-Math.round(-a):Math.round(a)}],floor:[lt,[lt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[lt,[lt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Xt,[hr,rr],(i,[t,a])=>i.properties()[t.value]===a.value],"filter-id-==":[Xt,[rr],(i,[t])=>i.id()===t.value],"filter-type-==":[Xt,[hr],(i,[t])=>i.geometryType()===t.value],"filter-<":[Xt,[hr,rr],(i,[t,a])=>{const l=i.properties()[t.value],p=a.value;return typeof l==typeof p&&l<p}],"filter-id-<":[Xt,[rr],(i,[t])=>{const a=i.id(),l=t.value;return typeof a==typeof l&&a<l}],"filter->":[Xt,[hr,rr],(i,[t,a])=>{const l=i.properties()[t.value],p=a.value;return typeof l==typeof p&&l>p}],"filter-id->":[Xt,[rr],(i,[t])=>{const a=i.id(),l=t.value;return typeof a==typeof l&&a>l}],"filter-<=":[Xt,[hr,rr],(i,[t,a])=>{const l=i.properties()[t.value],p=a.value;return typeof l==typeof p&&l<=p}],"filter-id-<=":[Xt,[rr],(i,[t])=>{const a=i.id(),l=t.value;return typeof a==typeof l&&a<=l}],"filter->=":[Xt,[hr,rr],(i,[t,a])=>{const l=i.properties()[t.value],p=a.value;return typeof l==typeof p&&l>=p}],"filter-id->=":[Xt,[rr],(i,[t])=>{const a=i.id(),l=t.value;return typeof a==typeof l&&a>=l}],"filter-has":[Xt,[rr],(i,[t])=>t.value in i.properties()],"filter-has-id":[Xt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Xt,[j(hr)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Xt,[j(rr)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Xt,[hr,j(rr)],(i,[t,a])=>a.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Xt,[hr,j(rr)],(i,[t,a])=>function(l,p,g,_){for(;g<=_;){const b=g+_>>1;if(p[b]===l)return!0;p[b]>l?_=b-1:g=b+1}return!1}(i.properties()[t.value],a.value,0,a.value.length-1)],all:{type:Xt,overloads:[[[Xt,Xt],(i,[t,a])=>t.evaluate(i)&&a.evaluate(i)],[ma(Xt),(i,t)=>{for(const a of t)if(!a.evaluate(i))return!1;return!0}]]},any:{type:Xt,overloads:[[[Xt,Xt],(i,[t,a])=>t.evaluate(i)||a.evaluate(i)],[ma(Xt),(i,t)=>{for(const a of t)if(a.evaluate(i))return!0;return!1}]]},"!":[Xt,[Xt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Xt,[hr],(i,[t])=>{const a=i.globals&&i.globals.isSupportedScript;return!a||a(t.evaluate(i))}],upcase:[hr,[hr],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[hr,[hr],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[hr,ma(rr),(i,t)=>t.map(a=>Bs(a.evaluate(i))).join("")],"resolved-locale":[hr,[wi],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Ce{constructor(t,a){var l;this.expression=t,this._warningHistory={},this._evaluator=new Ja,this._defaultValue=a?(l=a).type==="color"&&k(l.default)?new Cr(0,0,0,0):l.type==="color"?Cr.parse(l.default)||null:l.type==="padding"?ri.parse(l.default)||null:l.type==="variableAnchorOffsetCollection"?Bn.parse(l.default)||null:l.default===void 0?null:l.default:null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(t,a,l,p,g,_){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=l,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,a,l,p,g,_){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=l||null,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new sn(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function De(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Zs}function me(i,t){const a=new Yi(Zs,Wn,[],t?function(p){const g={color:Ot,string:hr,number:lt,enum:hr,boolean:Xt,formatted:St,padding:ca,resolvedImage:Xi,variableAnchorOffsetCollection:oe};return p.type==="array"?j(g[p.value]||rr,p.length):g[p.type]}(t):void 0),l=a.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?ga(new Ce(l,t)):as(a.errors)}class Oe{constructor(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!is(a.expression)}evaluateWithoutErrorHandling(t,a,l,p,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,a,l,p,g,_)}evaluate(t,a,l,p,g,_){return this._styleExpression.evaluate(t,a,l,p,g,_)}}class ke{constructor(t,a,l,p){this.kind=t,this.zoomStops=l,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!is(a.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,a,l,p,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,a,l,p,g,_)}evaluate(t,a,l,p,g,_){return this._styleExpression.evaluate(t,a,l,p,g,_)}interpolationFactor(t,a,l){return this.interpolationType?ii.interpolationFactor(this.interpolationType,t,a,l):0}}function Pe(i,t){const a=me(i,t);if(a.result==="error")return a;const l=a.value.expression,p=ko(l);if(!p&&!ea(t))return as([new kn("","data expressions not supported")]);const g=Ys(l,["zoom"]);if(!g&&!La(t))return as([new kn("","zoom expressions not supported")]);const _=Re(l);return _||g?_ instanceof kn?as([_]):_ instanceof ii&&!rl(t)?as([new kn("",'"interpolate" expressions cannot be used with this property')]):ga(_?new ke(p?"camera":"composite",a.value,_.labels,_ instanceof ii?_.interpolation:void 0):new Oe(p?"constant":"source",a.value)):as([new kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ie{constructor(t,a){this._parameters=t,this._specification=a,Fn(this,D(this._parameters,this._specification))}static deserialize(t){return new Ie(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Re(i){let t=null;if(i instanceof Si)t=Re(i.result);else if(i instanceof ki){for(const a of i.args)if(t=Re(a),t)break}else(i instanceof vs||i instanceof ii)&&i.input instanceof Ni&&i.input.name==="zoom"&&(t=i);return t instanceof kn||i.eachChild(a=>{const l=Re(a);l instanceof kn?t=l:!t&&l?t=new kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new kn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ve(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Ve(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Ge={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ye(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Ve(i)||(i=kt(i));const t=me(i,Ge);if(t.result==="error")throw new Error(t.value.map(a=>`${a.key}: ${a.message}`).join(", "));return{filter:(a,l,p)=>t.value.evaluate(a,l,{},p),needGeometry:ft(i)}}function et(i,t){return i<t?-1:i>t?1:0}function ft(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(ft(i[t]))return!0;return!1}function kt(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?dt(i[1],i[2],"=="):t==="!="?ot(dt(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?dt(i[1],i[2],t):t==="any"?(a=i.slice(1),["any"].concat(a.map(kt))):t==="all"?["all"].concat(i.slice(1).map(kt)):t==="none"?["all"].concat(i.slice(1).map(kt).map(ot)):t==="in"?mt(i[1],i.slice(2)):t==="!in"?ot(mt(i[1],i.slice(2))):t==="has"?Ct(i[1]):t!=="!has"||ot(Ct(i[1]));var a}function dt(i,t,a){switch(i){case"$type":return[`filter-type-${a}`,t];case"$id":return[`filter-id-${a}`,t];default:return[`filter-${a}`,i,t]}}function mt(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(a=>typeof a!=typeof t[0])?["filter-in-large",i,["literal",t.sort(et)]]:["filter-in-small",i,["literal",t]]}}function Ct(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ot(i){return["!",i]}function Lt(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let p="[";for(const g of i)p+=`${Lt(g)},`;return`${p}]`}const a=Object.keys(i).sort();let l="{";for(let p=0;p<a.length;p++)l+=`${JSON.stringify(a[p])}:${Lt(i[a[p]])},`;return`${l}}`}function mr(i){let t="";for(const a of nn)t+=`/${Lt(i[a])}`;return t}function xr(i){const t=i.value;return t?[new rt(i.key,t,"constants have been deprecated as of v8")]:[]}function Yt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function mn(i){if(Array.isArray(i))return i.map(mn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const a in i)t[a]=mn(i[a]);return t}return Yt(i)}function er(i){const t=i.key,a=i.value,l=i.valueSpec||{},p=i.objectElementValidators||{},g=i.style,_=i.styleSpec,b=i.validateSpec;let C=[];const P=v(a);if(P!=="object")return[new rt(t,a,`object expected, ${P} found`)];for(const A in a){const z=A.split(".")[0],F=l[z]||l["*"];let U;if(p[z])U=p[z];else if(l[z])U=b;else if(p["*"])U=p["*"];else{if(!l["*"]){C.push(new rt(t,a[A],`unknown property "${A}"`));continue}U=b}C=C.concat(U({key:(t&&`${t}.`)+A,value:a[A],valueSpec:F,style:g,styleSpec:_,object:a,objectKey:A,validateSpec:b},a))}for(const A in l)p[A]||l[A].required&&l[A].default===void 0&&a[A]===void 0&&C.push(new rt(t,a,`missing required property "${A}"`));return C}function Tn(i){const t=i.value,a=i.valueSpec,l=i.style,p=i.styleSpec,g=i.key,_=i.arrayElementValidator||i.validateSpec;if(v(t)!=="array")return[new rt(g,t,`array expected, ${v(t)} found`)];if(a.length&&t.length!==a.length)return[new rt(g,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new rt(g,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let b={type:a.value,values:a.values};p.$version<7&&(b.function=a.function),v(a.value)==="object"&&(b=a.value);let C=[];for(let P=0;P<t.length;P++)C=C.concat(_({array:t,arrayIndex:P,value:t[P],valueSpec:b,validateSpec:i.validateSpec,style:l,styleSpec:p,key:`${g}[${P}]`}));return C}function Nn(i){const t=i.key,a=i.value,l=i.valueSpec;let p=v(a);return p==="number"&&a!=a&&(p="NaN"),p!=="number"?[new rt(t,a,`number expected, ${p} found`)]:"minimum"in l&&a<l.minimum?[new rt(t,a,`${a} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&a>l.maximum?[new rt(t,a,`${a} is greater than the maximum value ${l.maximum}`)]:[]}function Cs(i){const t=i.valueSpec,a=Yt(i.value.type);let l,p,g,_={};const b=a!=="categorical"&&i.value.property===void 0,C=!b,P=v(i.value.stops)==="array"&&v(i.value.stops[0])==="array"&&v(i.value.stops[0][0])==="object",A=er({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(U){if(a==="identity")return[new rt(U.key,U.value,'identity function may not have a "stops" property')];let K=[];const W=U.value;return K=K.concat(Tn({key:U.key,value:W,valueSpec:U.valueSpec,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:z})),v(W)==="array"&&W.length===0&&K.push(new rt(U.key,W,"array must have at least one stop")),K},default:function(U){return U.validateSpec({key:U.key,value:U.value,valueSpec:t,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec})}}});return a==="identity"&&b&&A.push(new rt(i.key,i.value,'missing required property "property"')),a==="identity"||i.value.stops||A.push(new rt(i.key,i.value,'missing required property "stops"')),a==="exponential"&&i.valueSpec.expression&&!rl(i.valueSpec)&&A.push(new rt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(C&&!ea(i.valueSpec)?A.push(new rt(i.key,i.value,"property functions not supported")):b&&!La(i.valueSpec)&&A.push(new rt(i.key,i.value,"zoom functions not supported"))),a!=="categorical"&&!P||i.value.property!==void 0||A.push(new rt(i.key,i.value,'"property" property is required')),A;function z(U){let K=[];const W=U.value,ae=U.key;if(v(W)!=="array")return[new rt(ae,W,`array expected, ${v(W)} found`)];if(W.length!==2)return[new rt(ae,W,`array length 2 expected, length ${W.length} found`)];if(P){if(v(W[0])!=="object")return[new rt(ae,W,`object expected, ${v(W[0])} found`)];if(W[0].zoom===void 0)return[new rt(ae,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new rt(ae,W,"object stop key must have value")];if(g&&g>Yt(W[0].zoom))return[new rt(ae,W[0].zoom,"stop zoom values must appear in ascending order")];Yt(W[0].zoom)!==g&&(g=Yt(W[0].zoom),p=void 0,_={}),K=K.concat(er({key:`${ae}[0]`,value:W[0],valueSpec:{zoom:{}},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:Nn,value:F}}))}else K=K.concat(F({key:`${ae}[0]`,value:W[0],validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec},W));return De(mn(W[1]))?K.concat([new rt(`${ae}[1]`,W[1],"expressions are not allowed in function stops.")]):K.concat(U.validateSpec({key:`${ae}[1]`,value:W[1],valueSpec:t,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec}))}function F(U,K){const W=v(U.value),ae=Yt(U.value),ue=U.value!==null?U.value:K;if(l){if(W!==l)return[new rt(U.key,ue,`${W} stop domain type must match previous stop domain type ${l}`)]}else l=W;if(W!=="number"&&W!=="string"&&W!=="boolean")return[new rt(U.key,ue,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&a!=="categorical"){let Fe=`number expected, ${W} found`;return ea(t)&&a===void 0&&(Fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new rt(U.key,ue,Fe)]}return a!=="categorical"||W!=="number"||isFinite(ae)&&Math.floor(ae)===ae?a!=="categorical"&&W==="number"&&p!==void 0&&ae<p?[new rt(U.key,ue,"stop domain values must appear in ascending order")]:(p=ae,a==="categorical"&&ae in _?[new rt(U.key,ue,"stop domain values must be unique")]:(_[ae]=!0,[])):[new rt(U.key,ue,`integer expected, found ${ae}`)]}}function In(i){const t=(i.expressionContext==="property"?Pe:me)(mn(i.value),i.valueSpec);if(t.result==="error")return t.value.map(l=>new rt(`${i.key}${l.key}`,i.value,l.message));const a=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!a.outputDefined())return[new rt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!is(a))return[new rt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!is(a))return[new rt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ys(a,["zoom","feature-state"]))return[new rt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ko(a))return[new rt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ai(i){const t=i.key,a=i.value,l=i.valueSpec,p=[];return Array.isArray(l.values)?l.values.indexOf(Yt(a))===-1&&p.push(new rt(t,a,`expected one of [${l.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(l.values).indexOf(Yt(a))===-1&&p.push(new rt(t,a,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(a)} found`)),p}function Co(i){return Ve(mn(i.value))?In(Fn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):qu(i)}function qu(i){const t=i.value,a=i.key;if(v(t)!=="array")return[new rt(a,t,`array expected, ${v(t)} found`)];const l=i.styleSpec;let p,g=[];if(t.length<1)return[new rt(a,t,"filter array must have at least 1 element")];switch(g=g.concat(ai({key:`${a}[0]`,value:t[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),Yt(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Yt(t[1])==="$type"&&g.push(new rt(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new rt(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=v(t[1]),p!=="string"&&g.push(new rt(`${a}[1]`,t[1],`string expected, ${p} found`)));for(let _=2;_<t.length;_++)p=v(t[_]),Yt(t[1])==="$type"?g=g.concat(ai({key:`${a}[${_}]`,value:t[_],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&g.push(new rt(`${a}[${_}]`,t[_],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)g=g.concat(qu({key:`${a}[${_}]`,value:t[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=v(t[1]),t.length!==2?g.push(new rt(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&g.push(new rt(`${a}[1]`,t[1],`string expected, ${p} found`))}return g}function Qc(i,t){const a=i.key,l=i.validateSpec,p=i.style,g=i.styleSpec,_=i.value,b=i.objectKey,C=g[`${t}_${i.layerType}`];if(!C)return[];const P=b.match(/^(.*)-transition$/);if(t==="paint"&&P&&C[P[1]]&&C[P[1]].transition)return l({key:a,value:_,valueSpec:g.transition,style:p,styleSpec:g});const A=i.valueSpec||C[b];if(!A)return[new rt(a,_,`unknown property "${b}"`)];let z;if(v(_)==="string"&&ea(A)&&!A.tokens&&(z=/^{([^}]+)}$/.exec(_)))return[new rt(a,_,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const F=[];return i.layerType==="symbol"&&(b==="text-field"&&p&&!p.glyphs&&F.push(new rt(a,_,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&k(mn(_))&&Yt(_.type)==="identity"&&F.push(new rt(a,_,'"text-font" does not support identity functions'))),F.concat(l({key:i.key,value:_,valueSpec:A,style:p,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:b}))}function Gu(i){return Qc(i,"paint")}function eh(i){return Qc(i,"layout")}function th(i){let t=[];const a=i.value,l=i.key,p=i.style,g=i.styleSpec;a.type||a.ref||t.push(new rt(l,a,'either "type" or "ref" is required'));let _=Yt(a.type);const b=Yt(a.ref);if(a.id){const C=Yt(a.id);for(let P=0;P<i.arrayIndex;P++){const A=p.layers[P];Yt(A.id)===C&&t.push(new rt(l,a.id,`duplicate layer id "${a.id}", previously used at line ${A.id.__line__}`))}}if("ref"in a){let C;["type","source","source-layer","filter","layout"].forEach(P=>{P in a&&t.push(new rt(l,a[P],`"${P}" is prohibited for ref layers`))}),p.layers.forEach(P=>{Yt(P.id)===b&&(C=P)}),C?C.ref?t.push(new rt(l,a.ref,"ref cannot reference another ref layer")):_=Yt(C.type):t.push(new rt(l,a.ref,`ref layer "${b}" not found`))}else if(_!=="background")if(a.source){const C=p.sources&&p.sources[a.source],P=C&&Yt(C.type);C?P==="vector"&&_==="raster"?t.push(new rt(l,a.source,`layer "${a.id}" requires a raster source`)):P!=="raster-dem"&&_==="hillshade"?t.push(new rt(l,a.source,`layer "${a.id}" requires a raster-dem source`)):P==="raster"&&_!=="raster"?t.push(new rt(l,a.source,`layer "${a.id}" requires a vector source`)):P!=="vector"||a["source-layer"]?P==="raster-dem"&&_!=="hillshade"?t.push(new rt(l,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!a.paint||!a.paint["line-gradient"]||P==="geojson"&&C.lineMetrics||t.push(new rt(l,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new rt(l,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new rt(l,a.source,`source "${a.source}" not found`))}else t.push(new rt(l,a,'missing required property "source"'));return t=t.concat(er({key:l,value:a,valueSpec:g.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${l}.type`,value:a.type,valueSpec:g.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:a,objectKey:"type"}),filter:Co,layout:C=>er({layer:a,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":P=>eh(Fn({layerType:_},P))}}),paint:C=>er({layer:a,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":P=>Gu(Fn({layerType:_},P))}})}})),t}function To(i){const t=i.value,a=i.key,l=v(t);return l!=="string"?[new rt(a,t,`string expected, ${l} found`)]:[]}const Ku={promoteId:function({key:i,value:t}){if(v(t)==="string")return To({key:i,value:t});{const a=[];for(const l in t)a.push(...To({key:`${i}.${l}`,value:t[l]}));return a}}};function ru(i){const t=i.value,a=i.key,l=i.styleSpec,p=i.style,g=i.validateSpec;if(!t.type)return[new rt(a,t,'"type" is required')];const _=Yt(t.type);let b;switch(_){case"vector":case"raster":return b=er({key:a,value:t,valueSpec:l[`source_${_.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:Ku,validateSpec:g}),b;case"raster-dem":return b=function(C){var P;const A=(P=C.sourceName)!==null&&P!==void 0?P:"",z=C.value,F=C.styleSpec,U=F.source_raster_dem,K=C.style;let W=[];const ae=v(z);if(z===void 0)return W;if(ae!=="object")return W.push(new rt("source_raster_dem",z,`object expected, ${ae} found`)),W;const ue=Yt(z.encoding)==="custom",Fe=["redFactor","greenFactor","blueFactor","baseShift"],_e=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const Me in z)!ue&&Fe.includes(Me)?W.push(new rt(Me,z[Me],`In "${A}": "${Me}" is only valid when "encoding" is set to "custom". ${_e} encoding found`)):U[Me]?W=W.concat(C.validateSpec({key:Me,value:z[Me],valueSpec:U[Me],validateSpec:C.validateSpec,style:K,styleSpec:F})):W.push(new rt(Me,z[Me],`unknown property "${Me}"`));return W}({sourceName:a,value:t,style:i.style,styleSpec:l,validateSpec:g}),b;case"geojson":if(b=er({key:a,value:t,valueSpec:l.source_geojson,style:p,styleSpec:l,validateSpec:g,objectElementValidators:Ku}),t.cluster)for(const C in t.clusterProperties){const[P,A]=t.clusterProperties[C],z=typeof P=="string"?[P,["accumulated"],["get",C]]:P;b.push(...In({key:`${a}.${C}.map`,value:A,expressionContext:"cluster-map"})),b.push(...In({key:`${a}.${C}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return b;case"video":return er({key:a,value:t,valueSpec:l.source_video,style:p,validateSpec:g,styleSpec:l});case"image":return er({key:a,value:t,valueSpec:l.source_image,style:p,validateSpec:g,styleSpec:l});case"canvas":return[new rt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ai({key:`${a}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function rh(i){const t=i.value,a=i.styleSpec,l=a.light,p=i.style;let g=[];const _=v(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new rt("light",t,`object expected, ${_} found`)]),g;for(const b in t){const C=b.match(/^(.*)-transition$/);g=g.concat(C&&l[C[1]]&&l[C[1]].transition?i.validateSpec({key:b,value:t[b],valueSpec:a.transition,validateSpec:i.validateSpec,style:p,styleSpec:a}):l[b]?i.validateSpec({key:b,value:t[b],valueSpec:l[b],validateSpec:i.validateSpec,style:p,styleSpec:a}):[new rt(b,t[b],`unknown property "${b}"`)])}return g}function nh(i){const t=i.value,a=i.styleSpec,l=a.sky,p=i.style,g=v(t);if(t===void 0)return[];if(g!=="object")return[new rt("sky",t,`object expected, ${g} found`)];let _=[];for(const b in t)_=_.concat(l[b]?i.validateSpec({key:b,value:t[b],valueSpec:l[b],style:p,styleSpec:a}):[new rt(b,t[b],`unknown property "${b}"`)]);return _}function ih(i){const t=i.value,a=i.styleSpec,l=a.terrain,p=i.style;let g=[];const _=v(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new rt("terrain",t,`object expected, ${_} found`)]),g;for(const b in t)g=g.concat(l[b]?i.validateSpec({key:b,value:t[b],valueSpec:l[b],validateSpec:i.validateSpec,style:p,styleSpec:a}):[new rt(b,t[b],`unknown property "${b}"`)]);return g}function ah(i){let t=[];const a=i.value,l=i.key;if(Array.isArray(a)){const p=[],g=[];for(const _ in a)a[_].id&&p.includes(a[_].id)&&t.push(new rt(l,a,`all the sprites' ids must be unique, but ${a[_].id} is duplicated`)),p.push(a[_].id),a[_].url&&g.includes(a[_].url)&&t.push(new rt(l,a,`all the sprites' URLs must be unique, but ${a[_].url} is duplicated`)),g.push(a[_].url),t=t.concat(er({key:`${l}[${_}]`,value:a[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return To({key:l,value:a})}const Hu={"*":()=>[],array:Tn,boolean:function(i){const t=i.value,a=i.key,l=v(t);return l!=="boolean"?[new rt(a,t,`boolean expected, ${l} found`)]:[]},number:Nn,color:function(i){const t=i.key,a=i.value,l=v(a);return l!=="string"?[new rt(t,a,`color expected, ${l} found`)]:Cr.parse(String(a))?[]:[new rt(t,a,`color expected, "${a}" found`)]},constants:xr,enum:ai,filter:Co,function:Cs,layer:th,object:er,source:ru,light:rh,sky:nh,terrain:ih,projection:function(i){const t=i.value,a=i.styleSpec,l=a.projection,p=i.style,g=v(t);if(t===void 0)return[];if(g!=="object")return[new rt("projection",t,`object expected, ${g} found`)];let _=[];for(const b in t)_=_.concat(l[b]?i.validateSpec({key:b,value:t[b],valueSpec:l[b],style:p,styleSpec:a}):[new rt(b,t[b],`unknown property "${b}"`)]);return _},string:To,formatted:function(i){return To(i).length===0?[]:In(i)},resolvedImage:function(i){return To(i).length===0?[]:In(i)},padding:function(i){const t=i.key,a=i.value;if(v(a)==="array"){if(a.length<1||a.length>4)return[new rt(t,a,`padding requires 1 to 4 values; ${a.length} values found`)];const l={type:"number"};let p=[];for(let g=0;g<a.length;g++)p=p.concat(i.validateSpec({key:`${t}[${g}]`,value:a[g],validateSpec:i.validateSpec,valueSpec:l}));return p}return Nn({key:t,value:a,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,a=i.value,l=v(a),p=i.styleSpec;if(l!=="array"||a.length<1||a.length%2!=0)return[new rt(t,a,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<a.length;_+=2)g=g.concat(ai({key:`${t}[${_}]`,value:a[_],valueSpec:p.layout_symbol["text-anchor"]})),g=g.concat(Tn({key:`${t}[${_+1}]`,value:a[_+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:p}));return g},sprite:ah};function nu(i){const t=i.value,a=i.valueSpec,l=i.styleSpec;return i.validateSpec=nu,a.expression&&k(Yt(t))?Cs(i):a.expression&&De(mn(t))?In(i):a.type&&Hu[a.type]?Hu[a.type](i):er(Fn({},i,{valueSpec:a.type?l[a.type]:a}))}function Ed(i){const t=i.value,a=i.key,l=To(i);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new rt(a,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new rt(a,t,'"glyphs" url must include a "{range}" token'))),l}function ya(i,t=Ee){let a=[];return a=a.concat(nu({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:nu,objectElementValidators:{glyphs:Ed,"*":()=>[]}})),i.constants&&(a=a.concat(xr({key:"constants",value:i.constants}))),sh(a)}function ss(i){return function(t){return i({...t,validateSpec:nu})}}function sh(i){return[].concat(i).sort((t,a)=>t.line-a.line)}function Ra(i){return function(...t){return sh(i.apply(this,t))}}ya.source=Ra(ss(ru)),ya.sprite=Ra(ss(ah)),ya.glyphs=Ra(ss(Ed)),ya.light=Ra(ss(rh)),ya.sky=Ra(ss(nh)),ya.terrain=Ra(ss(ih)),ya.layer=Ra(ss(th)),ya.filter=Ra(ss(Co)),ya.paintProperty=Ra(ss(Gu)),ya.layoutProperty=Ra(ss(eh));const Io=ya,Vf=Io.light,$f=Io.sky,Ad=Io.paintProperty,Md=Io.layoutProperty;function oh(i,t){let a=!1;if(t&&t.length)for(const l of t)i.fire(new Dr(new Error(l.message))),a=!0;return a}class nl{constructor(t,a,l){const p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(a=_[1])+2*(l=_[2]);for(let C=0;C<this.d*this.d;C++){const P=_[3+C],A=_[3+C+1];p.push(P===A?null:_.subarray(P,A))}const b=_[3+p.length+1];this.keys=_.subarray(_[3+p.length],b),this.bboxes=_.subarray(b),this.insert=this._insertReadonly}else{this.d=a+2*l;for(let _=0;_<this.d*this.d;_++)p.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=l,this.scale=a/t,this.uid=0;const g=l/a*t;this.min=-g,this.max=t+g}insert(t,a,l,p,g){this._forEachCell(a,l,p,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,a,l,p,g,_){this.cells[g].push(_)}query(t,a,l,p,g){const _=this.min,b=this.max;if(t<=_&&a<=_&&b<=l&&b<=p&&!g)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(t,a,l,p,this._queryCell,C,{},g),C}}_queryCell(t,a,l,p,g,_,b,C){const P=this.cells[g];if(P!==null){const A=this.keys,z=this.bboxes;for(let F=0;F<P.length;F++){const U=P[F];if(b[U]===void 0){const K=4*U;(C?C(z[K+0],z[K+1],z[K+2],z[K+3]):t<=z[K+2]&&a<=z[K+3]&&l>=z[K+0]&&p>=z[K+1])?(b[U]=!0,_.push(A[U])):b[U]=!1}}}}_forEachCell(t,a,l,p,g,_,b,C){const P=this._convertToCellCoord(t),A=this._convertToCellCoord(a),z=this._convertToCellCoord(l),F=this._convertToCellCoord(p);for(let U=P;U<=z;U++)for(let K=A;K<=F;K++){const W=this.d*K+U;if((!C||C(this._convertFromCellCoord(U),this._convertFromCellCoord(K),this._convertFromCellCoord(U+1),this._convertFromCellCoord(K+1)))&&g.call(this,t,a,l,p,W,_,b,C))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,a=3+this.cells.length+1+1;let l=0;for(let _=0;_<this.cells.length;_++)l+=this.cells[_].length;const p=new Int32Array(a+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let g=a;for(let _=0;_<t.length;_++){const b=t[_];p[3+_]=g,p.set(b,g),g+=b.length}return p[3+t.length]=g,p.set(this.keys,g),g+=this.keys.length,p[3+t.length+1]=g,p.set(this.bboxes,g),g+=this.bboxes.length,p.buffer}static serialize(t,a){const l=t.toArrayBuffer();return a&&a.push(l),{buffer:l}}static deserialize(t){return new nl(t.buffer)}}const _a={};function Rt(i,t,a={}){if(_a[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),_a[i]={klass:t,omit:a.omit||[],shallow:a.shallow||[]}}Rt("Object",Object),Rt("TransferableGridIndex",nl),Rt("Color",Cr),Rt("Error",Error),Rt("AJAXError",Mr),Rt("ResolvedImage",ci),Rt("StylePropertyFunction",Ie),Rt("StyleExpression",Ce,{omit:["_evaluator"]}),Rt("ZoomDependentExpression",ke),Rt("ZoomConstantExpression",Oe),Rt("CompoundExpression",Ni,{omit:["_evaluate"]});for(const i in Zs)Zs[i]._classRegistryKey||Rt(`Expression_${i}`,Zs[i]);function Wu(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function lh(i){return i.$name||i.constructor._classRegistryKey}function Dd(i){return!function(t){if(t===null||typeof t!="object")return!1;const a=lh(t);return!(!a||a==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Wu(i)||ar(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function il(i,t){if(Dd(i))return(Wu(i)||ar(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const g=[];for(const _ of i)g.push(il(_,t));return g}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const a=lh(i);if(!a)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!_a[a])throw new Error(`${a} is not registered.`);const{klass:l}=_a[a],p=l.serialize?l.serialize(i,t):{};if(l.serialize){if(t&&p===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in i){if(!i.hasOwnProperty(g)||_a[a].omit.indexOf(g)>=0)continue;const _=i[g];p[g]=_a[a].shallow.indexOf(g)>=0?_:il(_,t)}i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(p.$name=a),p}function al(i){if(Dd(i))return i;if(Array.isArray(i))return i.map(al);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=lh(i)||"Object";if(!_a[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:a}=_a[t];if(!a)throw new Error(`can't deserialize unregistered class ${t}`);if(a.deserialize)return a.deserialize(i);const l=Object.create(a.prototype);for(const p of Object.keys(i)){if(p==="$name")continue;const g=i[p];l[p]=_a[t].shallow.indexOf(p)>=0?g:al(g)}return l}class uh{constructor(){this.first=!0}update(t,a){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const Er={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function ch(i){for(const t of i)if(dh(t.charCodeAt(0)))return!0;return!1}function qf(i){for(const t of i)if(!sl(t.charCodeAt(0)))return!1;return!0}function hh(i){const t=i.map(a=>{try{return new RegExp(`\\p{sc=${a}}`,"u").source}catch{return null}}).filter(a=>a);return new RegExp(t.join("|"),"u")}const Gf=hh(["Arab","Dupl","Mong","Ougr","Syrc"]);function sl(i){return!Gf.test(String.fromCodePoint(i))}const zd=hh(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function dh(i){return!(i!==746&&i!==747&&(i<4352||!(Er["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Er["CJK Compatibility"](i)||Er["CJK Strokes"](i)||!(!Er["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Er["Enclosed CJK Letters and Months"](i)||Er["Ideographic Description Characters"](i)||Er.Kanbun(i)||Er.Katakana(i)&&i!==12540||!(!Er["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Er["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Er["Vertical Forms"](i)||Er["Yijing Hexagram Symbols"](i)||/\p{sc=Cans}/u.test(String.fromCodePoint(i))||/\p{sc=Hang}/u.test(String.fromCodePoint(i))||zd.test(String.fromCodePoint(i)))))}function Ld(i){return!(dh(i)||function(t){return!!(Er["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Er["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Er["Letterlike Symbols"](t)||Er["Number Forms"](t)||Er["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Er["Control Pictures"](t)&&t!==9251||Er["Optical Character Recognition"](t)||Er["Enclosed Alphanumerics"](t)||Er["Geometric Shapes"](t)||Er["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Er["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Er["CJK Symbols and Punctuation"](t)||Er.Katakana(t)||Er["Private Use Area"](t)||Er["CJK Compatibility Forms"](t)||Er["Small Form Variants"](t)||Er["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const Kf=hh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ph(i){return Kf.test(String.fromCodePoint(i))}function Hf(i,t){return!(!t&&ph(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Er.Khmer(i))}function Wf(i){for(const t of i)if(ph(t.charCodeAt(0)))return!0;return!1}const ta=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class on{constructor(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new uh,this.transition={})}isSupportedScript(t){return function(a,l){for(const p of a)if(!Hf(p.charCodeAt(0),l))return!1;return!0}(t,ta.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,a=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*a}}}class ol{constructor(t,a){this.property=t,this.value=a,this.expression=function(l,p){if(k(l))return new Ie(l,p);if(De(l)){const g=Pe(l,p);if(g.result==="error")throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=l;return p.type==="color"&&typeof l=="string"?g=Cr.parse(l):p.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(l)&&(g=Bn.parse(l)):g=ri.parse(l),{kind:"constant",evaluate:()=>g}}}(a===void 0?t.specification.default:a,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,a,l){return this.property.possiblyEvaluate(this,t,a,l)}}class Zu{constructor(t){this.property=t,this.value=new ol(t,void 0)}transitioned(t,a){return new Rd(this.property,this.value,a,Xe({},t.transition,this.transition),t.now)}untransitioned(){return new Rd(this.property,this.value,null,{},0)}}class Xu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return tt(this._values[t].value.value)}setValue(t,a){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Zu(this._values[t].property)),this._values[t].value=new ol(this._values[t].property,a===null?void 0:tt(a))}getTransition(t){return tt(this._values[t].transition)}setTransition(t,a){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Zu(this._values[t].property)),this._values[t].transition=tt(a)||void 0}serialize(){const t={};for(const a of Object.keys(this._values)){const l=this.getValue(a);l!==void 0&&(t[a]=l);const p=this.getTransition(a);p!==void 0&&(t[`${a}-transition`]=p)}return t}transitioned(t,a){const l=new iu(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].transitioned(t,a._values[p]);return l}untransitioned(){const t=new iu(this._properties);for(const a of Object.keys(this._values))t._values[a]=this._values[a].untransitioned();return t}}class Rd{constructor(t,a,l,p,g){this.property=t,this.value=a,this.begin=g+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=l)}possiblyEvaluate(t,a,l){const p=t.now||0,g=this.value.possiblyEvaluate(t,a,l),_=this.prior;if(_){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return _.possiblyEvaluate(t,a,l);{const b=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,a,l),g,function(C){if(C<=0)return 0;if(C>=1)return 1;const P=C*C,A=P*C;return 4*(C<.5?A:3*(C-P)+A-.75)}(b))}}return g}}class iu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,a,l){const p=new su(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(t,a,l);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class au{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return tt(this._values[t].value)}setValue(t,a){this._values[t]=new ol(this._values[t].property,a===null?void 0:tt(a))}serialize(){const t={};for(const a of Object.keys(this._values)){const l=this.getValue(a);l!==void 0&&(t[a]=l)}return t}possiblyEvaluate(t,a,l){const p=new su(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(t,a,l);return p}}class os{constructor(t,a,l){this.property=t,this.value=a,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,a,l,p){return this.property.evaluate(this.value,this.parameters,t,a,l,p)}}class su{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Vt{constructor(t){this.specification=t}possiblyEvaluate(t,a){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(a)}interpolate(t,a,l){const p=ni[this.specification.type];return p?p(t,a,l):t}}class tr{constructor(t,a){this.specification=t,this.overrides=a}possiblyEvaluate(t,a,l,p){return new os(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},l,p)}:t.expression,a)}interpolate(t,a,l){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new os(this,{kind:"constant",value:void 0},t.parameters);const p=ni[this.specification.type];if(p){const g=p(t.value.value,a.value.value,l);return new os(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,a,l,p,g,_){return t.kind==="constant"?t.value:t.evaluate(a,l,p,g,_)}}class Yu extends tr{possiblyEvaluate(t,a,l,p){if(t.value===void 0)return new os(this,{kind:"constant",value:void 0},a);if(t.expression.kind==="constant"){const g=t.expression.evaluate(a,null,{},l,p),_=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,b=this._calculate(_,_,_,a);return new os(this,{kind:"constant",value:b},a)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:a.zoom-1}),t.expression.evaluate({zoom:a.zoom}),t.expression.evaluate({zoom:a.zoom+1}),a);return new os(this,{kind:"constant",value:g},a)}return new os(this,t.expression,a)}evaluate(t,a,l,p,g,_){if(t.kind==="source"){const b=t.evaluate(a,l,p,g,_);return this._calculate(b,b,b,a)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(a.zoom)-1},l,p),t.evaluate({zoom:Math.floor(a.zoom)},l,p),t.evaluate({zoom:Math.floor(a.zoom)+1},l,p),a):t.value}_calculate(t,a,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:l,to:a}}interpolate(t){return t}}class Ju{constructor(t){this.specification=t}possiblyEvaluate(t,a,l,p){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(a,null,{},l,p);return this._calculate(g,g,g,a)}return this._calculate(t.expression.evaluate(new on(Math.floor(a.zoom-1),a)),t.expression.evaluate(new on(Math.floor(a.zoom),a)),t.expression.evaluate(new on(Math.floor(a.zoom+1),a)),a)}}_calculate(t,a,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:l,to:a}}interpolate(t){return t}}class fh{constructor(t){this.specification=t}possiblyEvaluate(t,a,l,p){return!!t.expression.evaluate(a,null,{},l,p)}interpolate(){return!1}}class m{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in t){const l=t[a];l.specification.overridable&&this.overridableProperties.push(a);const p=this.defaultPropertyValues[a]=new ol(l,void 0),g=this.defaultTransitionablePropertyValues[a]=new Zu(l);this.defaultTransitioningPropertyValues[a]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=p.possiblyEvaluate({})}}}Rt("DataDrivenProperty",tr),Rt("DataConstantProperty",Vt),Rt("CrossFadedDataDrivenProperty",Yu),Rt("CrossFadedProperty",Ju),Rt("ColorRampProperty",fh);const e="-transition";class s extends _r{constructor(t,a){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),a.layout&&(this._unevaluatedLayout=new au(a.layout)),a.paint)){this._transitionablePaint=new Xu(a.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new su(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,a,l={}){a!=null&&this._validate(Md,`layers.${this.id}.layout.${t}`,t,a,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,a):this.visibility=a)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,a,l={}){if(a!=null&&this._validate(Ad,`layers.${this.id}.paint.${t}`,t,a,l))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),a||void 0),!1;{const p=this._transitionablePaint._values[t],g=p.property.specification["property-type"]==="cross-faded-data-driven",_=p.value.isDataDriven(),b=p.value;this._transitionablePaint.setValue(t,a),this._handleSpecialPaintPropertyUpdate(t);const C=this._transitionablePaint._values[t].value;return C.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(t,b,C)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,a,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,a){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,a)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),je(t,(a,l)=>!(a===void 0||l==="layout"&&!Object.keys(a).length||l==="paint"&&!Object.keys(a).length))}_validate(t,a,l,p,g={}){return(!g||g.validate!==!1)&&oh(this,t.call(Io,{key:a,layerType:this.type,objectKey:l,value:p,styleSpec:Ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const a=this.paint.get(t);if(a instanceof os&&ea(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}}const u={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class d{constructor(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class f{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function S(i,t=1){let a=0,l=0;return{members:i.map(p=>{const g=u[p.type].BYTES_PER_ELEMENT,_=a=T(a,Math.max(t,g)),b=p.components||1;return l=Math.max(l,g),a+=g*b,{name:p.name,type:p.type,components:b,offset:_}}),size:T(a,Math.max(l,t)),alignment:t}}function T(i,t){return Math.ceil(i/t)*t}class I extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,a)}emplace(t,a,l){const p=2*t;return this.int16[p+0]=a,this.int16[p+1]=l,t}}I.prototype.bytesPerElement=4,Rt("StructArrayLayout2i4",I);class M extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,a,l)}emplace(t,a,l,p){const g=3*t;return this.int16[g+0]=a,this.int16[g+1]=l,this.int16[g+2]=p,t}}M.prototype.bytesPerElement=6,Rt("StructArrayLayout3i6",M);class L extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,a,l,p)}emplace(t,a,l,p,g){const _=4*t;return this.int16[_+0]=a,this.int16[_+1]=l,this.int16[_+2]=p,this.int16[_+3]=g,t}}L.prototype.bytesPerElement=8,Rt("StructArrayLayout4i8",L);class R extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,p,g,_){const b=this.length;return this.resize(b+1),this.emplace(b,t,a,l,p,g,_)}emplace(t,a,l,p,g,_,b){const C=6*t;return this.int16[C+0]=a,this.int16[C+1]=l,this.int16[C+2]=p,this.int16[C+3]=g,this.int16[C+4]=_,this.int16[C+5]=b,t}}R.prototype.bytesPerElement=12,Rt("StructArrayLayout2i4i12",R);class $ extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,p,g,_){const b=this.length;return this.resize(b+1),this.emplace(b,t,a,l,p,g,_)}emplace(t,a,l,p,g,_,b){const C=4*t,P=8*t;return this.int16[C+0]=a,this.int16[C+1]=l,this.uint8[P+4]=p,this.uint8[P+5]=g,this.uint8[P+6]=_,this.uint8[P+7]=b,t}}$.prototype.bytesPerElement=8,Rt("StructArrayLayout2i4ub8",$);class X extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,a)}emplace(t,a,l){const p=2*t;return this.float32[p+0]=a,this.float32[p+1]=l,t}}X.prototype.bytesPerElement=8,Rt("StructArrayLayout2f8",X);class ee extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l,p,g,_,b,C,P,A){const z=this.length;return this.resize(z+1),this.emplace(z,t,a,l,p,g,_,b,C,P,A)}emplace(t,a,l,p,g,_,b,C,P,A,z){const F=10*t;return this.uint16[F+0]=a,this.uint16[F+1]=l,this.uint16[F+2]=p,this.uint16[F+3]=g,this.uint16[F+4]=_,this.uint16[F+5]=b,this.uint16[F+6]=C,this.uint16[F+7]=P,this.uint16[F+8]=A,this.uint16[F+9]=z,t}}ee.prototype.bytesPerElement=20,Rt("StructArrayLayout10ui20",ee);class se extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l,p,g,_,b,C,P,A,z,F){const U=this.length;return this.resize(U+1),this.emplace(U,t,a,l,p,g,_,b,C,P,A,z,F)}emplace(t,a,l,p,g,_,b,C,P,A,z,F,U){const K=12*t;return this.int16[K+0]=a,this.int16[K+1]=l,this.int16[K+2]=p,this.int16[K+3]=g,this.uint16[K+4]=_,this.uint16[K+5]=b,this.uint16[K+6]=C,this.uint16[K+7]=P,this.int16[K+8]=A,this.int16[K+9]=z,this.int16[K+10]=F,this.int16[K+11]=U,t}}se.prototype.bytesPerElement=24,Rt("StructArrayLayout4i4ui4i24",se);class ce extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,a,l)}emplace(t,a,l,p){const g=3*t;return this.float32[g+0]=a,this.float32[g+1]=l,this.float32[g+2]=p,t}}ce.prototype.bytesPerElement=12,Rt("StructArrayLayout3f12",ce);class de extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint32[1*t+0]=a,t}}de.prototype.bytesPerElement=4,Rt("StructArrayLayout1ul4",de);class ge extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l,p,g,_,b,C,P){const A=this.length;return this.resize(A+1),this.emplace(A,t,a,l,p,g,_,b,C,P)}emplace(t,a,l,p,g,_,b,C,P,A){const z=10*t,F=5*t;return this.int16[z+0]=a,this.int16[z+1]=l,this.int16[z+2]=p,this.int16[z+3]=g,this.int16[z+4]=_,this.int16[z+5]=b,this.uint32[F+3]=C,this.uint16[z+8]=P,this.uint16[z+9]=A,t}}ge.prototype.bytesPerElement=20,Rt("StructArrayLayout6i1ul2ui20",ge);class ne extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,p,g,_){const b=this.length;return this.resize(b+1),this.emplace(b,t,a,l,p,g,_)}emplace(t,a,l,p,g,_,b){const C=6*t;return this.int16[C+0]=a,this.int16[C+1]=l,this.int16[C+2]=p,this.int16[C+3]=g,this.int16[C+4]=_,this.int16[C+5]=b,t}}ne.prototype.bytesPerElement=12,Rt("StructArrayLayout2i2i2i12",ne);class Te extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,p,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,l,p,g)}emplace(t,a,l,p,g,_){const b=4*t,C=8*t;return this.float32[b+0]=a,this.float32[b+1]=l,this.float32[b+2]=p,this.int16[C+6]=g,this.int16[C+7]=_,t}}Te.prototype.bytesPerElement=16,Rt("StructArrayLayout2f1f2i16",Te);class Ae extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,p,g,_){const b=this.length;return this.resize(b+1),this.emplace(b,t,a,l,p,g,_)}emplace(t,a,l,p,g,_,b){const C=16*t,P=4*t,A=8*t;return this.uint8[C+0]=a,this.uint8[C+1]=l,this.float32[P+1]=p,this.float32[P+2]=g,this.int16[A+6]=_,this.int16[A+7]=b,t}}Ae.prototype.bytesPerElement=16,Rt("StructArrayLayout2ub2f2i16",Ae);class Ne extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,a,l)}emplace(t,a,l,p){const g=3*t;return this.uint16[g+0]=a,this.uint16[g+1]=l,this.uint16[g+2]=p,t}}Ne.prototype.bytesPerElement=6,Rt("StructArrayLayout3ui6",Ne);class Qe extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l,p,g,_,b,C,P,A,z,F,U,K,W,ae,ue){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,t,a,l,p,g,_,b,C,P,A,z,F,U,K,W,ae,ue)}emplace(t,a,l,p,g,_,b,C,P,A,z,F,U,K,W,ae,ue,Fe){const _e=24*t,Me=12*t,Ke=48*t;return this.int16[_e+0]=a,this.int16[_e+1]=l,this.uint16[_e+2]=p,this.uint16[_e+3]=g,this.uint32[Me+2]=_,this.uint32[Me+3]=b,this.uint32[Me+4]=C,this.uint16[_e+10]=P,this.uint16[_e+11]=A,this.uint16[_e+12]=z,this.float32[Me+7]=F,this.float32[Me+8]=U,this.uint8[Ke+36]=K,this.uint8[Ke+37]=W,this.uint8[Ke+38]=ae,this.uint32[Me+10]=ue,this.int16[_e+22]=Fe,t}}Qe.prototype.bytesPerElement=48,Rt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Qe);class ut extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l,p,g,_,b,C,P,A,z,F,U,K,W,ae,ue,Fe,_e,Me,Ke,nt,Et,Qt,It,xt,Gt,Ft){const Dt=this.length;return this.resize(Dt+1),this.emplace(Dt,t,a,l,p,g,_,b,C,P,A,z,F,U,K,W,ae,ue,Fe,_e,Me,Ke,nt,Et,Qt,It,xt,Gt,Ft)}emplace(t,a,l,p,g,_,b,C,P,A,z,F,U,K,W,ae,ue,Fe,_e,Me,Ke,nt,Et,Qt,It,xt,Gt,Ft,Dt){const Je=32*t,Kt=16*t;return this.int16[Je+0]=a,this.int16[Je+1]=l,this.int16[Je+2]=p,this.int16[Je+3]=g,this.int16[Je+4]=_,this.int16[Je+5]=b,this.int16[Je+6]=C,this.int16[Je+7]=P,this.uint16[Je+8]=A,this.uint16[Je+9]=z,this.uint16[Je+10]=F,this.uint16[Je+11]=U,this.uint16[Je+12]=K,this.uint16[Je+13]=W,this.uint16[Je+14]=ae,this.uint16[Je+15]=ue,this.uint16[Je+16]=Fe,this.uint16[Je+17]=_e,this.uint16[Je+18]=Me,this.uint16[Je+19]=Ke,this.uint16[Je+20]=nt,this.uint16[Je+21]=Et,this.uint16[Je+22]=Qt,this.uint32[Kt+12]=It,this.float32[Kt+13]=xt,this.float32[Kt+14]=Gt,this.uint16[Je+30]=Ft,this.uint16[Je+31]=Dt,t}}ut.prototype.bytesPerElement=64,Rt("StructArrayLayout8i15ui1ul2f2ui64",ut);class bt extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.float32[1*t+0]=a,t}}bt.prototype.bytesPerElement=4,Rt("StructArrayLayout1f4",bt);class At extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,a,l)}emplace(t,a,l,p){const g=3*t;return this.uint16[6*t+0]=a,this.float32[g+1]=l,this.float32[g+2]=p,t}}At.prototype.bytesPerElement=12,Rt("StructArrayLayout1ui2f12",At);class yt extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,a,l)}emplace(t,a,l,p){const g=4*t;return this.uint32[2*t+0]=a,this.uint16[g+2]=l,this.uint16[g+3]=p,t}}yt.prototype.bytesPerElement=8,Rt("StructArrayLayout1ul2ui8",yt);class gt extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,a)}emplace(t,a,l){const p=2*t;return this.uint16[p+0]=a,this.uint16[p+1]=l,t}}gt.prototype.bytesPerElement=4,Rt("StructArrayLayout2ui4",gt);class $t extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint16[1*t+0]=a,t}}$t.prototype.bytesPerElement=2,Rt("StructArrayLayout1ui2",$t);class cr extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,a,l,p)}emplace(t,a,l,p,g){const _=4*t;return this.float32[_+0]=a,this.float32[_+1]=l,this.float32[_+2]=p,this.float32[_+3]=g,t}}cr.prototype.bytesPerElement=16,Rt("StructArrayLayout4f16",cr);class vt extends d{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Q(this.anchorPointX,this.anchorPointY)}}vt.prototype.size=20;class Pt extends ge{get(t){return new vt(this,t)}}Rt("CollisionBoxArray",Pt);class sr extends d{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}sr.prototype.size=48;class ln extends Qe{get(t){return new sr(this,t)}}Rt("PlacedSymbolArray",ln);class yr extends d{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}yr.prototype.size=64;class Tr extends ut{get(t){return new yr(this,t)}}Rt("SymbolInstanceArray",Tr);class un extends bt{getoffsetX(t){return this.float32[1*t+0]}}Rt("GlyphOffsetArray",un);class di extends M{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Rt("SymbolLineVertexArray",di);class Oa extends d{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Oa.prototype.size=12;class cn extends At{get(t){return new Oa(this,t)}}Rt("TextAnchorOffsetArray",cn);class ji extends d{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ji.prototype.size=8;class Ci extends yt{get(t){return new ji(this,t)}}Rt("FeatureIndexArray",Ci);class pi extends I{}class Ti extends I{}class ls extends I{}class ll extends R{}class Qu extends ${}class ul extends X{}class va extends ee{}class ec extends se{}class mh extends ce{}class xa extends de{}class ba extends ne{}class Js extends Ae{}class Fa extends Ne{}class si extends gt{}const fi=S([{name:"a_pos",components:2,type:"Int16"}],4),{members:ra}=fi;class Ar{constructor(t=[]){this.segments=t}prepareSegment(t,a,l,p){let g=this.segments[this.segments.length-1];return t>Ar.MAX_VERTEX_ARRAY_LENGTH&&Bt(`Max vertices per segment is ${Ar.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>Ar.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:a.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},p!==void 0&&(g.sortKey=p),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const t of this.segments)for(const a in t.vaos)t.vaos[a].destroy()}static simpleSegment(t,a,l,p){return new Ar([{vertexOffset:t,primitiveOffset:a,vertexLength:l,primitiveLength:p,vaos:{},sortKey:0}])}}function Po(i,t){return 256*(i=Ze(Math.floor(i),0,255))+Ze(Math.floor(t),0,255)}Ar.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rt("SegmentVector",Ar);const cl=S([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var hl={exports:{}},Od={exports:{}};Od.exports=function(i,t){var a,l,p,g,_,b,C,P;for(l=i.length-(a=3&i.length),p=t,_=3432918353,b=461845907,P=0;P<l;)C=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,p=27492+(65535&(g=5*(65535&(p=(p^=C=(65535&(C=(C=(65535&C)*_+(((C>>>16)*_&65535)<<16)&4294967295)<<15|C>>>17))*b+(((C>>>16)*b&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(C=0,a){case 3:C^=(255&i.charCodeAt(P+2))<<16;case 2:C^=(255&i.charCodeAt(P+1))<<8;case 1:p^=C=(65535&(C=(C=(65535&(C^=255&i.charCodeAt(P)))*_+(((C>>>16)*_&65535)<<16)&4294967295)<<15|C>>>17))*b+(((C>>>16)*b&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var Zf=Od.exports,Fd={exports:{}};Fd.exports=function(i,t){for(var a,l=i.length,p=t^l,g=0;l>=4;)a=1540483477*(65535&(a=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(a>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),l-=4,++g;switch(l){case 3:p^=(255&i.charCodeAt(g+2))<<16;case 2:p^=(255&i.charCodeAt(g+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(g)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var Qs=Zf,Bd=Fd.exports;hl.exports=Qs,hl.exports.murmur3=Qs,hl.exports.murmur2=Bd;var tc=V(hl.exports);class ou{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,a,l,p){this.ids.push(rc(t)),this.positions.push(a,l,p)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const a=rc(t);let l=0,p=this.ids.length-1;for(;l<p;){const _=l+p>>1;this.ids[_]>=a?p=_:l=_+1}const g=[];for(;this.ids[l]===a;)g.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return g}static serialize(t,a){const l=new Float64Array(t.ids),p=new Uint32Array(t.positions);return nc(l,p,0,l.length-1),a&&a.push(l.buffer,p.buffer),{ids:l,positions:p}}static deserialize(t){const a=new ou;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a}}function rc(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:tc(String(i))}function nc(i,t,a,l){for(;a<l;){const p=i[a+l>>1];let g=a-1,_=l+1;for(;;){do g++;while(i[g]<p);do _--;while(i[_]>p);if(g>=_)break;dl(i,g,_),dl(t,3*g,3*_),dl(t,3*g+1,3*_+1),dl(t,3*g+2,3*_+2)}_-a<l-_?(nc(i,t,a,_),a=_+1):(nc(i,t,_+1,l),l=_)}}function dl(i,t,a){const l=i[t];i[t]=i[a],i[a]=l}Rt("FeaturePositionMap",ou);class lu{constructor(t,a){this.gl=t.gl,this.location=a}}class Nd extends lu{constructor(t,a){super(t,a),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class w_ extends lu{constructor(t,a){super(t,a),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class S_ extends lu{constructor(t,a){super(t,a),this.current=Cr.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const kw=new Float32Array(16);function Xf(i){return[Po(255*i.r,255*i.g),Po(255*i.b,255*i.a)]}class gh{constructor(t,a,l){this.value=t,this.uniformNames=a.map(p=>`u_${p}`),this.type=l}setUniform(t,a,l){t.set(l.constantOr(this.value))}getBinding(t,a,l){return this.type==="color"?new S_(t,a):new Nd(t,a)}}class ic{constructor(t,a){this.uniformNames=a.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr}setUniform(t,a,l,p){const g=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,a,l){return l.substr(0,9)==="u_pattern"?new w_(t,a):new Nd(t,a)}}class Eo{constructor(t,a,l,p){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=a.map(g=>({name:`a_${g}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,a,l,p,g){const _=this.paintVertexArray.length,b=this.expression.evaluate(new on(0),a,{},p,[],g);this.paintVertexArray.resize(t),this._setPaintValue(_,t,b)}updatePaintArray(t,a,l,p){const g=this.expression.evaluate({zoom:0},l,p);this._setPaintValue(t,a,g)}_setPaintValue(t,a,l){if(this.type==="color"){const p=Xf(l);for(let g=t;g<a;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=t;p<a;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ts{constructor(t,a,l,p,g,_){this.expression=t,this.uniformNames=a.map(b=>`u_${b}_t`),this.type=l,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=a.map(b=>({name:`a_${b}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,a,l,p,g){const _=this.expression.evaluate(new on(this.zoom),a,{},p,[],g),b=this.expression.evaluate(new on(this.zoom+1),a,{},p,[],g),C=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(C,t,_,b)}updatePaintArray(t,a,l,p){const g=this.expression.evaluate({zoom:this.zoom},l,p),_=this.expression.evaluate({zoom:this.zoom+1},l,p);this._setPaintValue(t,a,g,_)}_setPaintValue(t,a,l,p){if(this.type==="color"){const g=Xf(l),_=Xf(p);for(let b=t;b<a;b++)this.paintVertexArray.emplace(b,g[0],g[1],_[0],_[1])}else{for(let g=t;g<a;g++)this.paintVertexArray.emplace(g,l,p);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,a){const l=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,p=Ze(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(p)}getBinding(t,a,l){return new Nd(t,a)}}class pl{constructor(t,a,l,p,g,_){this.expression=t,this.type=a,this.useIntegerZoom=l,this.zoom=p,this.layerId=_,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,a,l){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,a.patterns&&a.patterns[this.layerId],l)}updatePaintArray(t,a,l,p,g){this._setPaintValues(t,a,l.patterns&&l.patterns[this.layerId],g)}_setPaintValues(t,a,l,p){if(!p||!l)return;const{min:g,mid:_,max:b}=l,C=p[g],P=p[_],A=p[b];if(C&&P&&A)for(let z=t;z<a;z++)this.zoomInPaintVertexArray.emplace(z,P.tl[0],P.tl[1],P.br[0],P.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],P.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,P.tl[0],P.tl[1],P.br[0],P.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],P.pixelRatio,A.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,cl.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,cl.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class k_{constructor(t,a,l){this.binders={},this._buffers=[];const p=[];for(const g in t.paint._values){if(!l(g))continue;const _=t.paint.get(g);if(!(_ instanceof os&&ea(_.property.specification)))continue;const b=Cw(g,t.type),C=_.value,P=_.property.specification.type,A=_.property.useIntegerZoom,z=_.property.specification["property-type"],F=z==="cross-faded"||z==="cross-faded-data-driven";if(C.kind==="constant")this.binders[g]=F?new ic(C.value,b):new gh(C.value,b,P),p.push(`/u_${g}`);else if(C.kind==="source"||F){const U=C_(g,P,"source");this.binders[g]=F?new pl(C,P,A,a,U,t.id):new Eo(C,b,P,U),p.push(`/a_${g}`)}else{const U=C_(g,P,"composite");this.binders[g]=new Ts(C,b,P,A,a,U),p.push(`/z_${g}`)}}this.cacheKey=p.sort().join("")}getMaxValue(t){const a=this.binders[t];return a instanceof Eo||a instanceof Ts?a.maxValue:0}populatePaintArrays(t,a,l,p,g){for(const _ in this.binders){const b=this.binders[_];(b instanceof Eo||b instanceof Ts||b instanceof pl)&&b.populatePaintArray(t,a,l,p,g)}}setConstantPatternPositions(t,a){for(const l in this.binders){const p=this.binders[l];p instanceof ic&&p.setConstantPatternPositions(t,a)}}updatePaintArrays(t,a,l,p,g){let _=!1;for(const b in t){const C=a.getPositions(b);for(const P of C){const A=l.feature(P.index);for(const z in this.binders){const F=this.binders[z];if((F instanceof Eo||F instanceof Ts||F instanceof pl)&&F.expression.isStateDependent===!0){const U=p.paint.get(z);F.expression=U.value,F.updatePaintArray(P.start,P.end,A,t[b],g),_=!0}}}}return _}defines(){const t=[];for(const a in this.binders){const l=this.binders[a];(l instanceof gh||l instanceof ic)&&t.push(...l.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof Eo||l instanceof Ts)for(let p=0;p<l.paintVertexAttributes.length;p++)t.push(l.paintVertexAttributes[p].name);else if(l instanceof pl)for(let p=0;p<cl.members.length;p++)t.push(cl.members[p].name)}return t}getBinderUniforms(){const t=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof gh||l instanceof ic||l instanceof Ts)for(const p of l.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,a){const l=[];for(const p in this.binders){const g=this.binders[p];if(g instanceof gh||g instanceof ic||g instanceof Ts){for(const _ of g.uniformNames)if(a[_]){const b=g.getBinding(t,a[_],_);l.push({name:_,property:p,binding:b})}}}return l}setUniforms(t,a,l,p){for(const{name:g,property:_,binding:b}of a)this.binders[_].setUniform(b,p,l.get(_),g)}updatePaintBuffers(t){this._buffers=[];for(const a in this.binders){const l=this.binders[a];if(t&&l instanceof pl){const p=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(l instanceof Eo||l instanceof Ts)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const a in this.binders){const l=this.binders[a];(l instanceof Eo||l instanceof Ts||l instanceof pl)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const a=this.binders[t];(a instanceof Eo||a instanceof Ts||a instanceof pl)&&a.destroy()}}}class uu{constructor(t,a,l=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new k_(p,a,l);this.needsUpload=!1,this._featureMap=new ou,this._bufferOffset=0}populatePaintArrays(t,a,l,p,g,_){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(t,a,p,g,_);a.id!==void 0&&this._featureMap.add(a.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,a,l,p){for(const g of l)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,a,g,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Cw(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function C_(i,t,a){const l={color:{source:X,composite:cr},number:{source:bt,composite:X}},p=function(g){return{"line-pattern":{source:va,composite:va},"fill-pattern":{source:va,composite:va},"fill-extrusion-pattern":{source:va,composite:va}}[g]}(i);return p&&p[a]||l[t][a]}Rt("ConstantBinder",gh),Rt("CrossFadedConstantBinder",ic),Rt("SourceExpressionBinder",Eo),Rt("CrossFadedCompositeBinder",pl),Rt("CompositeExpressionBinder",Ts),Rt("ProgramConfiguration",k_,{omit:["_buffers"]}),Rt("ProgramConfigurationSet",uu);const jn=8192,Yf=Math.pow(2,14)-1,T_=-Yf-1;function cu(i){const t=jn/i.extent,a=i.loadGeometry();for(let l=0;l<a.length;l++){const p=a[l];for(let g=0;g<p.length;g++){const _=p[g],b=Math.round(_.x*t),C=Math.round(_.y*t);_.x=Ze(b,T_,Yf),_.y=Ze(C,T_,Yf),(b<_.x||b>_.x+1||C<_.y||C>_.y+1)&&Bt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return a}function hu(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?cu(i):[]}}function jd(i,t,a,l,p){i.emplaceBack(2*t+(l+1)/2,2*a+(p+1)/2)}class Jf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ti,this.indexArray=new Fa,this.segments=new Ar,this.programConfigurations=new uu(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,l){const p=this.layers[0],g=[];let _=null,b=!1;p.type==="circle"&&(_=p.layout.get("circle-sort-key"),b=!_.isConstant());for(const{feature:C,id:P,index:A,sourceLayerIndex:z}of t){const F=this.layers[0]._featureFilter.needGeometry,U=hu(C,F);if(!this.layers[0]._featureFilter.filter(new on(this.zoom),U,l))continue;const K=b?_.evaluate(U,{},l):void 0,W={id:P,properties:C.properties,type:C.type,sourceLayerIndex:z,index:A,geometry:F?U.geometry:cu(C),patterns:{},sortKey:K};g.push(W)}b&&g.sort((C,P)=>C.sortKey-P.sortKey);for(const C of g){const{geometry:P,index:A,sourceLayerIndex:z}=C,F=t[A].feature;this.addFeature(C,P,A,l),a.featureIndex.insert(F,P,A,z,this.index)}}update(t,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ra),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,a,l,p){for(const g of a)for(const _ of g){const b=_.x,C=_.y;if(b<0||b>=jn||C<0||C>=jn)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),A=P.vertexLength;jd(this.layoutVertexArray,b,C,-1,-1),jd(this.layoutVertexArray,b,C,1,-1),jd(this.layoutVertexArray,b,C,1,1),jd(this.layoutVertexArray,b,C,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+3,A+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},p)}}function I_(i,t){for(let a=0;a<i.length;a++)if(ac(t,i[a]))return!0;for(let a=0;a<t.length;a++)if(ac(i,t[a]))return!0;return!!Qf(i,t)}function Tw(i,t,a){return!!ac(i,t)||!!em(t,i,a)}function P_(i,t){if(i.length===1)return A_(t,i[0]);for(let a=0;a<t.length;a++){const l=t[a];for(let p=0;p<l.length;p++)if(ac(i,l[p]))return!0}for(let a=0;a<i.length;a++)if(A_(t,i[a]))return!0;for(let a=0;a<t.length;a++)if(Qf(i,t[a]))return!0;return!1}function Iw(i,t,a){if(i.length>1){if(Qf(i,t))return!0;for(let l=0;l<t.length;l++)if(em(t[l],i,a))return!0}for(let l=0;l<i.length;l++)if(em(i[l],t,a))return!0;return!1}function Qf(i,t){if(i.length===0||t.length===0)return!1;for(let a=0;a<i.length-1;a++){const l=i[a],p=i[a+1];for(let g=0;g<t.length-1;g++)if(Pw(l,p,t[g],t[g+1]))return!0}return!1}function Pw(i,t,a,l){return gr(i,a,l)!==gr(t,a,l)&&gr(i,t,a)!==gr(i,t,l)}function em(i,t,a){const l=a*a;if(t.length===1)return i.distSqr(t[0])<l;for(let p=1;p<t.length;p++)if(E_(i,t[p-1],t[p])<l)return!0;return!1}function E_(i,t,a){const l=t.distSqr(a);if(l===0)return i.distSqr(t);const p=((i.x-t.x)*(a.x-t.x)+(i.y-t.y)*(a.y-t.y))/l;return i.distSqr(p<0?t:p>1?a:a.sub(t)._mult(p)._add(t))}function A_(i,t){let a,l,p,g=!1;for(let _=0;_<i.length;_++){a=i[_];for(let b=0,C=a.length-1;b<a.length;C=b++)l=a[b],p=a[C],l.y>t.y!=p.y>t.y&&t.x<(p.x-l.x)*(t.y-l.y)/(p.y-l.y)+l.x&&(g=!g)}return g}function ac(i,t){let a=!1;for(let l=0,p=i.length-1;l<i.length;p=l++){const g=i[l],_=i[p];g.y>t.y!=_.y>t.y&&t.x<(_.x-g.x)*(t.y-g.y)/(_.y-g.y)+g.x&&(a=!a)}return a}function Ew(i,t,a){const l=a[0],p=a[2];if(i.x<l.x&&t.x<l.x||i.x>p.x&&t.x>p.x||i.y<l.y&&t.y<l.y||i.y>p.y&&t.y>p.y)return!1;const g=gr(i,t,a[0]);return g!==gr(i,t,a[1])||g!==gr(i,t,a[2])||g!==gr(i,t,a[3])}function yh(i,t,a){const l=t.paint.get(i).value;return l.kind==="constant"?l.value:a.programConfigurations.get(t.id).getMaxValue(i)}function Ud(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Vd(i,t,a,l,p){if(!t[0]&&!t[1])return i;const g=Q.convert(t)._mult(p);a==="viewport"&&g._rotate(-l);const _=[];for(let b=0;b<i.length;b++)_.push(i[b].sub(g));return _}let M_,D_;Rt("CircleBucket",Jf,{omit:["layers"]});var Aw={get paint(){return D_=D_||new m({"circle-radius":new tr(Ee.paint_circle["circle-radius"]),"circle-color":new tr(Ee.paint_circle["circle-color"]),"circle-blur":new tr(Ee.paint_circle["circle-blur"]),"circle-opacity":new tr(Ee.paint_circle["circle-opacity"]),"circle-translate":new Vt(Ee.paint_circle["circle-translate"]),"circle-translate-anchor":new Vt(Ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Vt(Ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Vt(Ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new tr(Ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new tr(Ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new tr(Ee.paint_circle["circle-stroke-opacity"])})},get layout(){return M_=M_||new m({"circle-sort-key":new tr(Ee.layout_circle["circle-sort-key"])})}},Ui=1e-6,sc=typeof Float32Array<"u"?Float32Array:Array;function tm(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function z_(i,t,a){var l=t[0],p=t[1],g=t[2],_=t[3],b=t[4],C=t[5],P=t[6],A=t[7],z=t[8],F=t[9],U=t[10],K=t[11],W=t[12],ae=t[13],ue=t[14],Fe=t[15],_e=a[0],Me=a[1],Ke=a[2],nt=a[3];return i[0]=_e*l+Me*b+Ke*z+nt*W,i[1]=_e*p+Me*C+Ke*F+nt*ae,i[2]=_e*g+Me*P+Ke*U+nt*ue,i[3]=_e*_+Me*A+Ke*K+nt*Fe,i[4]=(_e=a[4])*l+(Me=a[5])*b+(Ke=a[6])*z+(nt=a[7])*W,i[5]=_e*p+Me*C+Ke*F+nt*ae,i[6]=_e*g+Me*P+Ke*U+nt*ue,i[7]=_e*_+Me*A+Ke*K+nt*Fe,i[8]=(_e=a[8])*l+(Me=a[9])*b+(Ke=a[10])*z+(nt=a[11])*W,i[9]=_e*p+Me*C+Ke*F+nt*ae,i[10]=_e*g+Me*P+Ke*U+nt*ue,i[11]=_e*_+Me*A+Ke*K+nt*Fe,i[12]=(_e=a[12])*l+(Me=a[13])*b+(Ke=a[14])*z+(nt=a[15])*W,i[13]=_e*p+Me*C+Ke*F+nt*ae,i[14]=_e*g+Me*P+Ke*U+nt*ue,i[15]=_e*_+Me*A+Ke*K+nt*Fe,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var _h,Mw=z_;function $d(i,t,a){var l=t[0],p=t[1],g=t[2],_=t[3];return i[0]=a[0]*l+a[4]*p+a[8]*g+a[12]*_,i[1]=a[1]*l+a[5]*p+a[9]*g+a[13]*_,i[2]=a[2]*l+a[6]*p+a[10]*g+a[14]*_,i[3]=a[3]*l+a[7]*p+a[11]*g+a[15]*_,i}_h=new sc(4),sc!=Float32Array&&(_h[0]=0,_h[1]=0,_h[2]=0,_h[3]=0);class Dw extends s{constructor(t){super(t,Aw)}createBucket(t){return new Jf(t)}queryRadius(t){const a=t;return yh("circle-radius",this,a)+yh("circle-stroke-width",this,a)+Ud(this.paint.get("circle-translate"))}queryIntersectsFeature(t,a,l,p,g,_,b,C){const P=Vd(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,b),A=this.paint.get("circle-radius").evaluate(a,l)+this.paint.get("circle-stroke-width").evaluate(a,l),z=this.paint.get("circle-pitch-alignment")==="map",F=z?P:function(K,W){return K.map(ae=>L_(ae,W))}(P,C),U=z?A*b:A;for(const K of p)for(const W of K){const ae=z?W:L_(W,C);let ue=U;const Fe=$d([],[W.x,W.y,0,1],C);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ue*=Fe[3]/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ue*=_.cameraToCenterDistance/Fe[3]),Tw(F,ae,ue))return!0}return!1}}function L_(i,t){const a=$d([],[i.x,i.y,0,1],t);return new Q(a[0]/a[3],a[1]/a[3])}class R_ extends Jf{}let O_;Rt("HeatmapBucket",R_,{omit:["layers"]});var zw={get paint(){return O_=O_||new m({"heatmap-radius":new tr(Ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new tr(Ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Vt(Ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fh(Ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Vt(Ee.paint_heatmap["heatmap-opacity"])})}};function rm(i,{width:t,height:a},l,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*a*l)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${t*a*l}`)}else p=new Uint8Array(t*a*l);return i.width=t,i.height=a,i.data=p,i}function F_(i,{width:t,height:a},l){if(t===i.width&&a===i.height)return;const p=rm({},{width:t,height:a},l);nm(i,p,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,a)},l),i.width=t,i.height=a,i.data=p.data}function nm(i,t,a,l,p,g){if(p.width===0||p.height===0)return t;if(p.width>i.width||p.height>i.height||a.x>i.width-p.width||a.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||l.x>t.width-p.width||l.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,b=t.data;if(_===b)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<p.height;C++){const P=((a.y+C)*i.width+a.x)*g,A=((l.y+C)*t.width+l.x)*g;for(let z=0;z<p.width*g;z++)b[A+z]=_[P+z]}return t}class vh{constructor(t,a){rm(this,t,1,a)}resize(t){F_(this,t,1)}clone(){return new vh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,l,p,g){nm(t,a,l,p,g,1)}}class Ba{constructor(t,a){rm(this,t,4,a)}resize(t){F_(this,t,4)}replace(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ba({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,l,p,g){nm(t,a,l,p,g,4)}}function B_(i){const t={},a=i.resolution||256,l=i.clips?i.clips.length:1,p=i.image||new Ba({width:a,height:l});if(Math.log(a)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${a}`);const g=(_,b,C)=>{t[i.evaluationKey]=C;const P=i.expression.evaluate(t);p.data[_+b+0]=Math.floor(255*P.r/P.a),p.data[_+b+1]=Math.floor(255*P.g/P.a),p.data[_+b+2]=Math.floor(255*P.b/P.a),p.data[_+b+3]=Math.floor(255*P.a)};if(i.clips)for(let _=0,b=0;_<l;++_,b+=4*a)for(let C=0,P=0;C<a;C++,P+=4){const A=C/(a-1),{start:z,end:F}=i.clips[_];g(b,P,z*(1-A)+F*A)}else for(let _=0,b=0;_<a;_++,b+=4)g(0,b,_/(a-1));return p}Rt("AlphaImage",vh),Rt("RGBAImage",Ba);const im="big-fb";class Lw extends s{createBucket(t){return new R_(t)}constructor(t){super(t,zw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=B_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(im)&&this.heatmapFbos.delete(im)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let N_;var Rw={get paint(){return N_=N_||new m({"hillshade-illumination-direction":new Vt(Ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Vt(Ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Vt(Ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Vt(Ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Vt(Ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Vt(Ee.paint_hillshade["hillshade-accent-color"])})}};class Ow extends s{constructor(t){super(t,Rw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Fw=S([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bw}=Fw;function j_(i,t,a=2){const l=t&&t.length,p=l?t[0]*a:i.length;let g=U_(i,0,p,a,!0);const _=[];if(!g||g.next===g.prev)return _;let b,C,P;if(l&&(g=function(A,z,F,U){const K=[];for(let W=0,ae=z.length;W<ae;W++){const ue=U_(A,z[W]*U,W<ae-1?z[W+1]*U:A.length,U,!1);ue===ue.next&&(ue.steiner=!0),K.push(Kw(ue))}K.sort($w);for(let W=0;W<K.length;W++)F=qw(K[W],F);return F}(i,t,g,a)),i.length>80*a){b=1/0,C=1/0;let A=-1/0,z=-1/0;for(let F=a;F<p;F+=a){const U=i[F],K=i[F+1];U<b&&(b=U),K<C&&(C=K),U>A&&(A=U),K>z&&(z=K)}P=Math.max(A-b,z-C),P=P!==0?32767/P:0}return xh(g,_,a,b,C,P,0),_}function U_(i,t,a,l,p){let g;if(p===function(_,b,C,P){let A=0;for(let z=b,F=C-P;z<C;z+=P)A+=(_[F]-_[z])*(_[z+1]+_[F+1]),F=z;return A}(i,t,a,l)>0)for(let _=t;_<a;_+=l)g=q_(_/l|0,i[_],i[_+1],g);else for(let _=a-l;_>=t;_-=l)g=q_(_/l|0,i[_],i[_+1],g);return g&&qd(g,g.next)&&(wh(g),g=g.next),g}function du(i,t){if(!i)return i;t||(t=i);let a,l=i;do if(a=!1,l.steiner||!qd(l,l.next)&&zn(l.prev,l,l.next)!==0)l=l.next;else{if(wh(l),l=t=l.prev,l===l.next)break;a=!0}while(a||l!==t);return t}function xh(i,t,a,l,p,g,_){if(!i)return;!_&&g&&function(C,P,A,z){let F=C;do F.z===0&&(F.z=am(F.x,F.y,P,A,z)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==C);F.prevZ.nextZ=null,F.prevZ=null,function(U){let K,W=1;do{let ae,ue=U;U=null;let Fe=null;for(K=0;ue;){K++;let _e=ue,Me=0;for(let nt=0;nt<W&&(Me++,_e=_e.nextZ,_e);nt++);let Ke=W;for(;Me>0||Ke>0&&_e;)Me!==0&&(Ke===0||!_e||ue.z<=_e.z)?(ae=ue,ue=ue.nextZ,Me--):(ae=_e,_e=_e.nextZ,Ke--),Fe?Fe.nextZ=ae:U=ae,ae.prevZ=Fe,Fe=ae;ue=_e}Fe.nextZ=null,W*=2}while(K>1)}(F)}(i,l,p,g);let b=i;for(;i.prev!==i.next;){const C=i.prev,P=i.next;if(g?jw(i,l,p,g):Nw(i))t.push(C.i,i.i,P.i),wh(i),i=P.next,b=P.next;else if((i=P)===b){_?_===1?xh(i=Uw(du(i),t),t,a,l,p,g,2):_===2&&Vw(i,t,a,l,p,g):xh(du(i),t,a,l,p,g,1);break}}}function Nw(i){const t=i.prev,a=i,l=i.next;if(zn(t,a,l)>=0)return!1;const p=t.x,g=a.x,_=l.x,b=t.y,C=a.y,P=l.y,A=p<g?p<_?p:_:g<_?g:_,z=b<C?b<P?b:P:C<P?C:P,F=p>g?p>_?p:_:g>_?g:_,U=b>C?b>P?b:P:C>P?C:P;let K=l.next;for(;K!==t;){if(K.x>=A&&K.x<=F&&K.y>=z&&K.y<=U&&oc(p,b,g,C,_,P,K.x,K.y)&&zn(K.prev,K,K.next)>=0)return!1;K=K.next}return!0}function jw(i,t,a,l){const p=i.prev,g=i,_=i.next;if(zn(p,g,_)>=0)return!1;const b=p.x,C=g.x,P=_.x,A=p.y,z=g.y,F=_.y,U=b<C?b<P?b:P:C<P?C:P,K=A<z?A<F?A:F:z<F?z:F,W=b>C?b>P?b:P:C>P?C:P,ae=A>z?A>F?A:F:z>F?z:F,ue=am(U,K,t,a,l),Fe=am(W,ae,t,a,l);let _e=i.prevZ,Me=i.nextZ;for(;_e&&_e.z>=ue&&Me&&Me.z<=Fe;){if(_e.x>=U&&_e.x<=W&&_e.y>=K&&_e.y<=ae&&_e!==p&&_e!==_&&oc(b,A,C,z,P,F,_e.x,_e.y)&&zn(_e.prev,_e,_e.next)>=0||(_e=_e.prevZ,Me.x>=U&&Me.x<=W&&Me.y>=K&&Me.y<=ae&&Me!==p&&Me!==_&&oc(b,A,C,z,P,F,Me.x,Me.y)&&zn(Me.prev,Me,Me.next)>=0))return!1;Me=Me.nextZ}for(;_e&&_e.z>=ue;){if(_e.x>=U&&_e.x<=W&&_e.y>=K&&_e.y<=ae&&_e!==p&&_e!==_&&oc(b,A,C,z,P,F,_e.x,_e.y)&&zn(_e.prev,_e,_e.next)>=0)return!1;_e=_e.prevZ}for(;Me&&Me.z<=Fe;){if(Me.x>=U&&Me.x<=W&&Me.y>=K&&Me.y<=ae&&Me!==p&&Me!==_&&oc(b,A,C,z,P,F,Me.x,Me.y)&&zn(Me.prev,Me,Me.next)>=0)return!1;Me=Me.nextZ}return!0}function Uw(i,t){let a=i;do{const l=a.prev,p=a.next.next;!qd(l,p)&&V_(l,a,a.next,p)&&bh(l,p)&&bh(p,l)&&(t.push(l.i,a.i,p.i),wh(a),wh(a.next),a=i=p),a=a.next}while(a!==i);return du(a)}function Vw(i,t,a,l,p,g){let _=i;do{let b=_.next.next;for(;b!==_.prev;){if(_.i!==b.i&&Hw(_,b)){let C=$_(_,b);return _=du(_,_.next),C=du(C,C.next),xh(_,t,a,l,p,g,0),void xh(C,t,a,l,p,g,0)}b=b.next}_=_.next}while(_!==i)}function $w(i,t){return i.x-t.x}function qw(i,t){const a=function(p,g){let _=g;const b=p.x,C=p.y;let P,A=-1/0;do{if(C<=_.y&&C>=_.next.y&&_.next.y!==_.y){const W=_.x+(C-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(W<=b&&W>A&&(A=W,P=_.x<_.next.x?_:_.next,W===b))return P}_=_.next}while(_!==g);if(!P)return null;const z=P,F=P.x,U=P.y;let K=1/0;_=P;do{if(b>=_.x&&_.x>=F&&b!==_.x&&oc(C<U?b:A,C,F,U,C<U?A:b,C,_.x,_.y)){const W=Math.abs(C-_.y)/(b-_.x);bh(_,p)&&(W<K||W===K&&(_.x>P.x||_.x===P.x&&Gw(P,_)))&&(P=_,K=W)}_=_.next}while(_!==z);return P}(i,t);if(!a)return t;const l=$_(a,i);return du(l,l.next),du(a,a.next)}function Gw(i,t){return zn(i.prev,i,t.prev)<0&&zn(t.next,i,i.next)<0}function am(i,t,a,l,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-a)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Kw(i){let t=i,a=i;do(t.x<a.x||t.x===a.x&&t.y<a.y)&&(a=t),t=t.next;while(t!==i);return a}function oc(i,t,a,l,p,g,_,b){return(p-_)*(t-b)>=(i-_)*(g-b)&&(i-_)*(l-b)>=(a-_)*(t-b)&&(a-_)*(g-b)>=(p-_)*(l-b)}function Hw(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(a,l){let p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==l.i&&p.next.i!==l.i&&V_(p,p.next,a,l))return!0;p=p.next}while(p!==a);return!1}(i,t)&&(bh(i,t)&&bh(t,i)&&function(a,l){let p=a,g=!1;const _=(a.x+l.x)/2,b=(a.y+l.y)/2;do p.y>b!=p.next.y>b&&p.next.y!==p.y&&_<(p.next.x-p.x)*(b-p.y)/(p.next.y-p.y)+p.x&&(g=!g),p=p.next;while(p!==a);return g}(i,t)&&(zn(i.prev,i,t.prev)||zn(i,t.prev,t))||qd(i,t)&&zn(i.prev,i,i.next)>0&&zn(t.prev,t,t.next)>0)}function zn(i,t,a){return(t.y-i.y)*(a.x-t.x)-(t.x-i.x)*(a.y-t.y)}function qd(i,t){return i.x===t.x&&i.y===t.y}function V_(i,t,a,l){const p=Kd(zn(i,t,a)),g=Kd(zn(i,t,l)),_=Kd(zn(a,l,i)),b=Kd(zn(a,l,t));return p!==g&&_!==b||!(p!==0||!Gd(i,a,t))||!(g!==0||!Gd(i,l,t))||!(_!==0||!Gd(a,i,l))||!(b!==0||!Gd(a,t,l))}function Gd(i,t,a){return t.x<=Math.max(i.x,a.x)&&t.x>=Math.min(i.x,a.x)&&t.y<=Math.max(i.y,a.y)&&t.y>=Math.min(i.y,a.y)}function Kd(i){return i>0?1:i<0?-1:0}function bh(i,t){return zn(i.prev,i,i.next)<0?zn(i,t,i.next)>=0&&zn(i,i.prev,t)>=0:zn(i,t,i.prev)<0||zn(i,i.next,t)<0}function $_(i,t){const a=sm(i.i,i.x,i.y),l=sm(t.i,t.x,t.y),p=i.next,g=t.prev;return i.next=t,t.prev=i,a.next=p,p.prev=a,l.next=a,a.prev=l,g.next=l,l.prev=g,l}function q_(i,t,a,l){const p=sm(i,t,a);return l?(p.next=l.next,p.prev=l,l.next.prev=p,l.next=p):(p.prev=p,p.next=p),p}function wh(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function sm(i,t,a){return{i,x:t,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function om(i,t,a){const l=a.patternDependencies;let p=!1;for(const g of t){const _=g.paint.get(`${i}-pattern`);_.isConstant()||(p=!0);const b=_.constantOr(null);b&&(p=!0,l[b.to]=!0,l[b.from]=!0)}return p}function lm(i,t,a,l,p){const g=p.patternDependencies;for(const _ of t){const b=_.paint.get(`${i}-pattern`).value;if(b.kind!=="constant"){let C=b.evaluate({zoom:l-1},a,{},p.availableImages),P=b.evaluate({zoom:l},a,{},p.availableImages),A=b.evaluate({zoom:l+1},a,{},p.availableImages);C=C&&C.name?C.name:C,P=P&&P.name?P.name:P,A=A&&A.name?A.name:A,g[C]=!0,g[P]=!0,g[A]=!0,a.patterns[_.id]={min:C,mid:P,max:A}}}return a}class um{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ls,this.indexArray=new Fa,this.indexArray2=new si,this.programConfigurations=new uu(t.layers,t.zoom),this.segments=new Ar,this.segments2=new Ar,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,l){this.hasPattern=om("fill",this.layers,a);const p=this.layers[0].layout.get("fill-sort-key"),g=!p.isConstant(),_=[];for(const{feature:b,id:C,index:P,sourceLayerIndex:A}of t){const z=this.layers[0]._featureFilter.needGeometry,F=hu(b,z);if(!this.layers[0]._featureFilter.filter(new on(this.zoom),F,l))continue;const U=g?p.evaluate(F,{},l,a.availableImages):void 0,K={id:C,properties:b.properties,type:b.type,sourceLayerIndex:A,index:P,geometry:z?F.geometry:cu(b),patterns:{},sortKey:U};_.push(K)}g&&_.sort((b,C)=>b.sortKey-C.sortKey);for(const b of _){const{geometry:C,index:P,sourceLayerIndex:A}=b;if(this.hasPattern){const z=lm("fill",this.layers,b,this.zoom,a);this.patternFeatures.push(z)}else this.addFeature(b,C,P,l,{});a.featureIndex.insert(t[P].feature,C,P,A,this.index)}}update(t,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,l)}addFeatures(t,a,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bw),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,a,l,p,g){for(const _ of vo(a,500)){let b=0;for(const U of _)b+=U.length;const C=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),P=C.vertexLength,A=[],z=[];for(const U of _){if(U.length===0)continue;U!==_[0]&&z.push(A.length/2);const K=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),W=K.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(W+U.length-1,W),A.push(U[0].x),A.push(U[0].y);for(let ae=1;ae<U.length;ae++)this.layoutVertexArray.emplaceBack(U[ae].x,U[ae].y),this.indexArray2.emplaceBack(W+ae-1,W+ae),A.push(U[ae].x),A.push(U[ae].y);K.vertexLength+=U.length,K.primitiveLength+=U.length}const F=j_(A,z);for(let U=0;U<F.length;U+=3)this.indexArray.emplaceBack(P+F[U],P+F[U+1],P+F[U+2]);C.vertexLength+=b,C.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,g,p)}}let G_,K_;Rt("FillBucket",um,{omit:["layers","patternFeatures"]});var Ww={get paint(){return K_=K_||new m({"fill-antialias":new Vt(Ee.paint_fill["fill-antialias"]),"fill-opacity":new tr(Ee.paint_fill["fill-opacity"]),"fill-color":new tr(Ee.paint_fill["fill-color"]),"fill-outline-color":new tr(Ee.paint_fill["fill-outline-color"]),"fill-translate":new Vt(Ee.paint_fill["fill-translate"]),"fill-translate-anchor":new Vt(Ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new Yu(Ee.paint_fill["fill-pattern"])})},get layout(){return G_=G_||new m({"fill-sort-key":new tr(Ee.layout_fill["fill-sort-key"])})}};class Zw extends s{constructor(t){super(t,Ww)}recalculate(t,a){super.recalculate(t,a);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new um(t)}queryRadius(){return Ud(this.paint.get("fill-translate"))}queryIntersectsFeature(t,a,l,p,g,_,b){return P_(Vd(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,b),p)}isTileClipped(){return!0}}const Xw=S([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Yw=S([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Jw}=Xw;var fl={},Qw=G,H_=lc;function lc(i,t,a,l,p){this.properties={},this.extent=a,this.type=0,this._pbf=i,this._geometry=-1,this._keys=l,this._values=p,i.readFields(e2,this,t)}function e2(i,t,a){i==1?t.id=a.readVarint():i==2?function(l,p){for(var g=l.readVarint()+l.pos;l.pos<g;){var _=p._keys[l.readVarint()],b=p._values[l.readVarint()];p.properties[_]=b}}(a,t):i==3?t.type=a.readVarint():i==4&&(t._geometry=a.pos)}function t2(i){for(var t,a,l=0,p=0,g=i.length,_=g-1;p<g;_=p++)l+=((a=i[_]).x-(t=i[p]).x)*(t.y+a.y);return l}lc.types=["Unknown","Point","LineString","Polygon"],lc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,a=i.readVarint()+i.pos,l=1,p=0,g=0,_=0,b=[];i.pos<a;){if(p<=0){var C=i.readVarint();l=7&C,p=C>>3}if(p--,l===1||l===2)g+=i.readSVarint(),_+=i.readSVarint(),l===1&&(t&&b.push(t),t=[]),t.push(new Qw(g,_));else{if(l!==7)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&b.push(t),b},lc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,a=1,l=0,p=0,g=0,_=1/0,b=-1/0,C=1/0,P=-1/0;i.pos<t;){if(l<=0){var A=i.readVarint();a=7&A,l=A>>3}if(l--,a===1||a===2)(p+=i.readSVarint())<_&&(_=p),p>b&&(b=p),(g+=i.readSVarint())<C&&(C=g),g>P&&(P=g);else if(a!==7)throw new Error("unknown command "+a)}return[_,C,b,P]},lc.prototype.toGeoJSON=function(i,t,a){var l,p,g=this.extent*Math.pow(2,a),_=this.extent*i,b=this.extent*t,C=this.loadGeometry(),P=lc.types[this.type];function A(U){for(var K=0;K<U.length;K++){var W=U[K];U[K]=[360*(W.x+_)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(W.y+b)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(l=0;l<C.length;l++)z[l]=C[l][0];A(C=z);break;case 2:for(l=0;l<C.length;l++)A(C[l]);break;case 3:for(C=function(U){var K=U.length;if(K<=1)return[U];for(var W,ae,ue=[],Fe=0;Fe<K;Fe++){var _e=t2(U[Fe]);_e!==0&&(ae===void 0&&(ae=_e<0),ae===_e<0?(W&&ue.push(W),W=[U[Fe]]):W.push(U[Fe]))}return W&&ue.push(W),ue}(C),l=0;l<C.length;l++)for(p=0;p<C[l].length;p++)A(C[l][p])}C.length===1?C=C[0]:P="Multi"+P;var F={type:"Feature",geometry:{type:P,coordinates:C},properties:this.properties};return"id"in this&&(F.id=this.id),F};var r2=H_,W_=Z_;function Z_(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(n2,this,t),this.length=this._features.length}function n2(i,t,a){i===15?t.version=a.readVarint():i===1?t.name=a.readString():i===5?t.extent=a.readVarint():i===2?t._features.push(a.pos):i===3?t._keys.push(a.readString()):i===4&&t._values.push(function(l){for(var p=null,g=l.readVarint()+l.pos;l.pos<g;){var _=l.readVarint()>>3;p=_===1?l.readString():_===2?l.readFloat():_===3?l.readDouble():_===4?l.readVarint64():_===5?l.readVarint():_===6?l.readSVarint():_===7?l.readBoolean():null}return p}(a))}Z_.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new r2(this._pbf,t,this.extent,this._keys,this._values)};var i2=W_;function a2(i,t,a){if(i===3){var l=new i2(a,a.readVarint()+a.pos);l.length&&(t[l.name]=l)}}fl.VectorTile=function(i,t){this.layers=i.readFields(a2,{},t)},fl.VectorTileFeature=H_,fl.VectorTileLayer=W_;const s2=fl.VectorTileFeature.types,cm=Math.pow(2,13);function Sh(i,t,a,l,p,g,_,b){i.emplaceBack(t,a,2*Math.floor(l*cm)+_,p*cm*2,g*cm*2,Math.round(b))}class hm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ll,this.centroidVertexArray=new pi,this.indexArray=new Fa,this.programConfigurations=new uu(t.layers,t.zoom),this.segments=new Ar,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,l){this.features=[],this.hasPattern=om("fill-extrusion",this.layers,a);for(const{feature:p,id:g,index:_,sourceLayerIndex:b}of t){const C=this.layers[0]._featureFilter.needGeometry,P=hu(p,C);if(!this.layers[0]._featureFilter.filter(new on(this.zoom),P,l))continue;const A={id:g,sourceLayerIndex:b,index:_,geometry:C?P.geometry:cu(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(lm("fill-extrusion",this.layers,A,this.zoom,a)):this.addFeature(A,A.geometry,_,l,{}),a.featureIndex.insert(p,A.geometry,_,b,this.index,!0)}}addFeatures(t,a,l){for(const p of this.features){const{geometry:g}=p;this.addFeature(p,g,p.index,a,l)}}update(t,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jw),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Yw.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,a,l,p,g){for(const _ of vo(a,500)){const b={x:0,y:0,vertexCount:0};let C=0;for(const K of _)C+=K.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const K of _){if(K.length===0||l2(K))continue;let W=0;for(let ae=0;ae<K.length;ae++){const ue=K[ae];if(ae>=1){const Fe=K[ae-1];if(!o2(ue,Fe)){P.vertexLength+4>Ar.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const _e=ue.sub(Fe)._perp()._unit(),Me=Fe.dist(ue);W+Me>32768&&(W=0),Sh(this.layoutVertexArray,ue.x,ue.y,_e.x,_e.y,0,0,W),Sh(this.layoutVertexArray,ue.x,ue.y,_e.x,_e.y,0,1,W),b.x+=2*ue.x,b.y+=2*ue.y,b.vertexCount+=2,W+=Me,Sh(this.layoutVertexArray,Fe.x,Fe.y,_e.x,_e.y,0,0,W),Sh(this.layoutVertexArray,Fe.x,Fe.y,_e.x,_e.y,0,1,W),b.x+=2*Fe.x,b.y+=2*Fe.y,b.vertexCount+=2;const Ke=P.vertexLength;this.indexArray.emplaceBack(Ke,Ke+2,Ke+1),this.indexArray.emplaceBack(Ke+1,Ke+2,Ke+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+C>Ar.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray)),s2[t.type]!=="Polygon")continue;const A=[],z=[],F=P.vertexLength;for(const K of _)if(K.length!==0){K!==_[0]&&z.push(A.length/2);for(let W=0;W<K.length;W++){const ae=K[W];Sh(this.layoutVertexArray,ae.x,ae.y,0,0,1,1,0),b.x+=ae.x,b.y+=ae.y,b.vertexCount+=1,A.push(ae.x),A.push(ae.y)}}const U=j_(A,z);for(let K=0;K<U.length;K+=3)this.indexArray.emplaceBack(F+U[K],F+U[K+2],F+U[K+1]);P.primitiveLength+=U.length/3,P.vertexLength+=C;for(let K=0;K<b.vertexCount;K++){const W=Math.floor(b.x/b.vertexCount),ae=Math.floor(b.y/b.vertexCount);this.centroidVertexArray.emplaceBack(W,ae)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,g,p)}}function o2(i,t){return i.x===t.x&&(i.x<0||i.x>jn)||i.y===t.y&&(i.y<0||i.y>jn)}function l2(i){return i.every(t=>t.x<0)||i.every(t=>t.x>jn)||i.every(t=>t.y<0)||i.every(t=>t.y>jn)}let X_;Rt("FillExtrusionBucket",hm,{omit:["layers","features"]});var u2={get paint(){return X_=X_||new m({"fill-extrusion-opacity":new Vt(Ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new tr(Ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Vt(Ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Vt(Ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Yu(Ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new tr(Ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new tr(Ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Vt(Ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class c2 extends s{constructor(t){super(t,u2)}createBucket(t){return new hm(t)}queryRadius(){return Ud(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,a,l,p,g,_,b,C){const P=Vd(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,b),A=this.paint.get("fill-extrusion-height").evaluate(a,l),z=this.paint.get("fill-extrusion-base").evaluate(a,l),F=function(K,W,ae,ue){const Fe=[];for(const _e of K){const Me=[_e.x,_e.y,0,1];$d(Me,Me,W),Fe.push(new Q(Me[0]/Me[3],Me[1]/Me[3]))}return Fe}(P,C),U=function(K,W,ae,ue){const Fe=[],_e=[],Me=ue[8]*W,Ke=ue[9]*W,nt=ue[10]*W,Et=ue[11]*W,Qt=ue[8]*ae,It=ue[9]*ae,xt=ue[10]*ae,Gt=ue[11]*ae;for(const Ft of K){const Dt=[],Je=[];for(const Kt of Ft){const qt=Kt.x,or=Kt.y,Qr=ue[0]*qt+ue[4]*or+ue[12],Xr=ue[1]*qt+ue[5]*or+ue[13],Zn=ue[2]*qt+ue[6]*or+ue[14],us=ue[3]*qt+ue[7]*or+ue[15],gi=Zn+nt,Xn=us+Et,Vi=Qr+Qt,$i=Xr+It,qi=Zn+xt,Pn=us+Gt,Yn=new Q((Qr+Me)/Xn,(Xr+Ke)/Xn);Yn.z=gi/Xn,Dt.push(Yn);const Ii=new Q(Vi/Pn,$i/Pn);Ii.z=qi/Pn,Je.push(Ii)}Fe.push(Dt),_e.push(Je)}return[Fe,_e]}(p,z,A,C);return function(K,W,ae){let ue=1/0;P_(ae,W)&&(ue=Y_(ae,W[0]));for(let Fe=0;Fe<W.length;Fe++){const _e=W[Fe],Me=K[Fe];for(let Ke=0;Ke<_e.length-1;Ke++){const nt=_e[Ke],Et=[nt,_e[Ke+1],Me[Ke+1],Me[Ke],nt];I_(ae,Et)&&(ue=Math.min(ue,Y_(ae,Et)))}}return ue!==1/0&&ue}(U[0],U[1],F)}}function kh(i,t){return i.x*t.x+i.y*t.y}function Y_(i,t){if(i.length===1){let a=0;const l=t[a++];let p;for(;!p||l.equals(p);)if(p=t[a++],!p)return 1/0;for(;a<t.length;a++){const g=t[a],_=i[0],b=p.sub(l),C=g.sub(l),P=_.sub(l),A=kh(b,b),z=kh(b,C),F=kh(C,C),U=kh(P,b),K=kh(P,C),W=A*F-z*z,ae=(F*U-z*K)/W,ue=(A*K-z*U)/W,Fe=l.z*(1-ae-ue)+p.z*ae+g.z*ue;if(isFinite(Fe))return Fe}return 1/0}{let a=1/0;for(const l of t)a=Math.min(a,l.z);return a}}const h2=S([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:d2}=h2,p2=S([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:f2}=p2,m2=fl.VectorTileFeature.types,g2=Math.cos(Math.PI/180*37.5),J_=Math.pow(2,14)/.5;class dm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Qu,this.layoutVertexArray2=new ul,this.indexArray=new Fa,this.programConfigurations=new uu(t.layers,t.zoom),this.segments=new Ar,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,l){this.hasPattern=om("line",this.layers,a);const p=this.layers[0].layout.get("line-sort-key"),g=!p.isConstant(),_=[];for(const{feature:b,id:C,index:P,sourceLayerIndex:A}of t){const z=this.layers[0]._featureFilter.needGeometry,F=hu(b,z);if(!this.layers[0]._featureFilter.filter(new on(this.zoom),F,l))continue;const U=g?p.evaluate(F,{},l):void 0,K={id:C,properties:b.properties,type:b.type,sourceLayerIndex:A,index:P,geometry:z?F.geometry:cu(b),patterns:{},sortKey:U};_.push(K)}g&&_.sort((b,C)=>b.sortKey-C.sortKey);for(const b of _){const{geometry:C,index:P,sourceLayerIndex:A}=b;if(this.hasPattern){const z=lm("line",this.layers,b,this.zoom,a);this.patternFeatures.push(z)}else this.addFeature(b,C,P,l,{});a.featureIndex.insert(t[P].feature,C,P,A,this.index)}}update(t,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,l)}addFeatures(t,a,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,f2)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,d2),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,a,l,p,g){const _=this.layers[0].layout,b=_.get("line-join").evaluate(t,{}),C=_.get("line-cap"),P=_.get("line-miter-limit"),A=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const z of a)this.addLine(z,t,b,C,P,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,g,p)}addLine(t,a,l,p,g,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<t.length-1;ue++)this.totalDistance+=t[ue].dist(t[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=m2[a.type]==="Polygon";let C=t.length;for(;C>=2&&t[C-1].equals(t[C-2]);)C--;let P=0;for(;P<C-1&&t[P].equals(t[P+1]);)P++;if(C<(b?3:2))return;l==="bevel"&&(g=1.05);const A=this.overscaling<=16?15*jn/(512*this.overscaling):0,z=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let F,U,K,W,ae;this.e1=this.e2=-1,b&&(F=t[C-2],ae=t[P].sub(F)._unit()._perp());for(let ue=P;ue<C;ue++){if(K=ue===C-1?b?t[P+1]:void 0:t[ue+1],K&&t[ue].equals(K))continue;ae&&(W=ae),F&&(U=F),F=t[ue],ae=K?K.sub(F)._unit()._perp():W,W=W||ae;let Fe=W.add(ae);Fe.x===0&&Fe.y===0||Fe._unit();const _e=W.x*ae.x+W.y*ae.y,Me=Fe.x*ae.x+Fe.y*ae.y,Ke=Me!==0?1/Me:1/0,nt=2*Math.sqrt(2-2*Me),Et=Me<g2&&U&&K,Qt=W.x*ae.y-W.y*ae.x>0;if(Et&&ue>P){const Gt=F.dist(U);if(Gt>2*A){const Ft=F.sub(F.sub(U)._mult(A/Gt)._round());this.updateDistance(U,Ft),this.addCurrentVertex(Ft,W,0,0,z),U=Ft}}const It=U&&K;let xt=It?l:b?"butt":p;if(It&&xt==="round"&&(Ke<_?xt="miter":Ke<=2&&(xt="fakeround")),xt==="miter"&&Ke>g&&(xt="bevel"),xt==="bevel"&&(Ke>2&&(xt="flipbevel"),Ke<g&&(xt="miter")),U&&this.updateDistance(U,F),xt==="miter")Fe._mult(Ke),this.addCurrentVertex(F,Fe,0,0,z);else if(xt==="flipbevel"){if(Ke>100)Fe=ae.mult(-1);else{const Gt=Ke*W.add(ae).mag()/W.sub(ae).mag();Fe._perp()._mult(Gt*(Qt?-1:1))}this.addCurrentVertex(F,Fe,0,0,z),this.addCurrentVertex(F,Fe.mult(-1),0,0,z)}else if(xt==="bevel"||xt==="fakeround"){const Gt=-Math.sqrt(Ke*Ke-1),Ft=Qt?Gt:0,Dt=Qt?0:Gt;if(U&&this.addCurrentVertex(F,W,Ft,Dt,z),xt==="fakeround"){const Je=Math.round(180*nt/Math.PI/20);for(let Kt=1;Kt<Je;Kt++){let qt=Kt/Je;if(qt!==.5){const Qr=qt-.5;qt+=qt*Qr*(qt-1)*((1.0904+_e*(_e*(3.55645-1.43519*_e)-3.2452))*Qr*Qr+(.848013+_e*(.215638*_e-1.06021)))}const or=ae.sub(W)._mult(qt)._add(W)._unit()._mult(Qt?-1:1);this.addHalfVertex(F,or.x,or.y,!1,Qt,0,z)}}K&&this.addCurrentVertex(F,ae,-Ft,-Dt,z)}else if(xt==="butt")this.addCurrentVertex(F,Fe,0,0,z);else if(xt==="square"){const Gt=U?1:-1;this.addCurrentVertex(F,Fe,Gt,Gt,z)}else xt==="round"&&(U&&(this.addCurrentVertex(F,W,0,0,z),this.addCurrentVertex(F,W,1,1,z,!0)),K&&(this.addCurrentVertex(F,ae,-1,-1,z,!0),this.addCurrentVertex(F,ae,0,0,z)));if(Et&&ue<C-1){const Gt=F.dist(K);if(Gt>2*A){const Ft=F.add(K.sub(F)._mult(A/Gt)._round());this.updateDistance(F,Ft),this.addCurrentVertex(Ft,ae,0,0,z),F=Ft}}}}addCurrentVertex(t,a,l,p,g,_=!1){const b=a.y*p-a.x,C=-a.y-a.x*p;this.addHalfVertex(t,a.x+a.y*l,a.y-a.x*l,_,!1,l,g),this.addHalfVertex(t,b,C,_,!0,-p,g),this.distance>J_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,a,l,p,g,_))}addHalfVertex({x:t,y:a},l,p,g,_,b,C){const P=.5*(this.lineClips?this.scaledDistance*(J_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(a<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*p)+128,1+(b===0?0:b<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),C.primitiveLength++),_?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,a){this.distance+=t.dist(a),this.updateScaledDistance()}}let Q_,ev;Rt("LineBucket",dm,{omit:["layers","patternFeatures"]});var tv={get paint(){return ev=ev||new m({"line-opacity":new tr(Ee.paint_line["line-opacity"]),"line-color":new tr(Ee.paint_line["line-color"]),"line-translate":new Vt(Ee.paint_line["line-translate"]),"line-translate-anchor":new Vt(Ee.paint_line["line-translate-anchor"]),"line-width":new tr(Ee.paint_line["line-width"]),"line-gap-width":new tr(Ee.paint_line["line-gap-width"]),"line-offset":new tr(Ee.paint_line["line-offset"]),"line-blur":new tr(Ee.paint_line["line-blur"]),"line-dasharray":new Ju(Ee.paint_line["line-dasharray"]),"line-pattern":new Yu(Ee.paint_line["line-pattern"]),"line-gradient":new fh(Ee.paint_line["line-gradient"])})},get layout(){return Q_=Q_||new m({"line-cap":new Vt(Ee.layout_line["line-cap"]),"line-join":new tr(Ee.layout_line["line-join"]),"line-miter-limit":new Vt(Ee.layout_line["line-miter-limit"]),"line-round-limit":new Vt(Ee.layout_line["line-round-limit"]),"line-sort-key":new tr(Ee.layout_line["line-sort-key"])})}};class y2 extends tr{possiblyEvaluate(t,a){return a=new on(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(t,a)}evaluate(t,a,l,p){return a=Xe({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(t,a,l,p)}}let Hd;class _2 extends s{constructor(t){super(t,tv),this.gradientVersion=0,Hd||(Hd=new y2(tv.paint.properties["line-width"].specification),Hd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const a=this.gradientExpression();this.stepInterpolant=!!function(l){return l._styleExpression!==void 0}(a)&&a._styleExpression.expression instanceof vs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,a){super.recalculate(t,a),this.paint._values["line-floorwidth"]=Hd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new dm(t)}queryRadius(t){const a=t,l=rv(yh("line-width",this,a),yh("line-gap-width",this,a)),p=yh("line-offset",this,a);return l/2+Math.abs(p)+Ud(this.paint.get("line-translate"))}queryIntersectsFeature(t,a,l,p,g,_,b){const C=Vd(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,b),P=b/2*rv(this.paint.get("line-width").evaluate(a,l),this.paint.get("line-gap-width").evaluate(a,l)),A=this.paint.get("line-offset").evaluate(a,l);return A&&(p=function(z,F){const U=[];for(let K=0;K<z.length;K++){const W=z[K],ae=[];for(let ue=0;ue<W.length;ue++){const Fe=W[ue-1],_e=W[ue],Me=W[ue+1],Ke=ue===0?new Q(0,0):_e.sub(Fe)._unit()._perp(),nt=ue===W.length-1?new Q(0,0):Me.sub(_e)._unit()._perp(),Et=Ke._add(nt)._unit(),Qt=Et.x*nt.x+Et.y*nt.y;Qt!==0&&Et._mult(1/Qt),ae.push(Et._mult(F)._add(_e))}U.push(ae)}return U}(p,A*b)),function(z,F,U){for(let K=0;K<F.length;K++){const W=F[K];if(z.length>=3){for(let ae=0;ae<W.length;ae++)if(ac(z,W[ae]))return!0}if(Iw(z,W,U))return!0}return!1}(C,p,P)}isTileClipped(){return!0}}function rv(i,t){return t>0?t+2*i:i}const v2=S([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),x2=S([{name:"a_projected_pos",components:3,type:"Float32"}],4);S([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const b2=S([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);S([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const nv=S([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),w2=S([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function S2(i,t,a){return i.sections.forEach(l=>{l.text=function(p,g,_){const b=g.layout.get("text-transform").evaluate(_,{});return b==="uppercase"?p=p.toLocaleUpperCase():b==="lowercase"&&(p=p.toLocaleLowerCase()),ta.applyArabicShaping&&(p=ta.applyArabicShaping(p)),p}(l.text,t,a)}),i}S([{name:"triangle",components:3,type:"Uint16"}]),S([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),S([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),S([{type:"Float32",name:"offsetX"}]),S([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),S([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ch={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var qn=24,iv=Zr,av=function(i,t,a,l,p){var g,_,b=8*p-l-1,C=(1<<b)-1,P=C>>1,A=-7,z=p-1,F=-1,U=i[t+z];for(z+=F,g=U&(1<<-A)-1,U>>=-A,A+=b;A>0;g=256*g+i[t+z],z+=F,A-=8);for(_=g&(1<<-A)-1,g>>=-A,A+=l;A>0;_=256*_+i[t+z],z+=F,A-=8);if(g===0)g=1-P;else{if(g===C)return _?NaN:1/0*(U?-1:1);_+=Math.pow(2,l),g-=P}return(U?-1:1)*_*Math.pow(2,g-l)},sv=function(i,t,a,l,p,g){var _,b,C,P=8*g-p-1,A=(1<<P)-1,z=A>>1,F=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=0,K=1,W=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(b=isNaN(t)?1:0,_=A):(_=Math.floor(Math.log(t)/Math.LN2),t*(C=Math.pow(2,-_))<1&&(_--,C*=2),(t+=_+z>=1?F/C:F*Math.pow(2,1-z))*C>=2&&(_++,C/=2),_+z>=A?(b=0,_=A):_+z>=1?(b=(t*C-1)*Math.pow(2,p),_+=z):(b=t*Math.pow(2,z-1)*Math.pow(2,p),_=0));p>=8;i[a+U]=255&b,U+=K,b/=256,p-=8);for(_=_<<p|b,P+=p;P>0;i[a+U]=255&_,U+=K,_/=256,P-=8);i[a+U-K]|=128*W};function Zr(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Zr.Varint=0,Zr.Fixed64=1,Zr.Bytes=2,Zr.Fixed32=5;var pm=4294967296,ov=1/pm,lv=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ao(i){return i.type===Zr.Bytes?i.readVarint()+i.pos:i.pos+1}function uc(i,t,a){return a?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function uv(i,t,a){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));a.realloc(l);for(var p=a.pos-1;p>=i;p--)a.buf[p+l]=a.buf[p]}function k2(i,t){for(var a=0;a<i.length;a++)t.writeVarint(i[a])}function C2(i,t){for(var a=0;a<i.length;a++)t.writeSVarint(i[a])}function T2(i,t){for(var a=0;a<i.length;a++)t.writeFloat(i[a])}function I2(i,t){for(var a=0;a<i.length;a++)t.writeDouble(i[a])}function P2(i,t){for(var a=0;a<i.length;a++)t.writeBoolean(i[a])}function E2(i,t){for(var a=0;a<i.length;a++)t.writeFixed32(i[a])}function A2(i,t){for(var a=0;a<i.length;a++)t.writeSFixed32(i[a])}function M2(i,t){for(var a=0;a<i.length;a++)t.writeFixed64(i[a])}function D2(i,t){for(var a=0;a<i.length;a++)t.writeSFixed64(i[a])}function Wd(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function cc(i,t,a){i[a]=t,i[a+1]=t>>>8,i[a+2]=t>>>16,i[a+3]=t>>>24}function cv(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Zr.prototype={destroy:function(){this.buf=null},readFields:function(i,t,a){for(a=a||this.length;this.pos<a;){var l=this.readVarint(),p=l>>3,g=this.pos;this.type=7&l,i(p,t,this),this.pos===g&&this.skip(l)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Wd(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=cv(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Wd(this.buf,this.pos)+Wd(this.buf,this.pos+4)*pm;return this.pos+=8,i},readSFixed64:function(){var i=Wd(this.buf,this.pos)+cv(this.buf,this.pos+4)*pm;return this.pos+=8,i},readFloat:function(){var i=av(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=av(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,a,l=this.buf;return t=127&(a=l[this.pos++]),a<128?t:(t|=(127&(a=l[this.pos++]))<<7,a<128?t:(t|=(127&(a=l[this.pos++]))<<14,a<128?t:(t|=(127&(a=l[this.pos++]))<<21,a<128?t:function(p,g,_){var b,C,P=_.buf;if(b=(112&(C=P[_.pos++]))>>4,C<128||(b|=(127&(C=P[_.pos++]))<<3,C<128)||(b|=(127&(C=P[_.pos++]))<<10,C<128)||(b|=(127&(C=P[_.pos++]))<<17,C<128)||(b|=(127&(C=P[_.pos++]))<<24,C<128)||(b|=(1&(C=P[_.pos++]))<<31,C<128))return uc(p,b,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(a=l[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&lv?function(a,l,p){return lv.decode(a.subarray(l,p))}(this.buf,t,i):function(a,l,p){for(var g="",_=l;_<p;){var b,C,P,A=a[_],z=null,F=A>239?4:A>223?3:A>191?2:1;if(_+F>p)break;F===1?A<128&&(z=A):F===2?(192&(b=a[_+1]))==128&&(z=(31&A)<<6|63&b)<=127&&(z=null):F===3?(C=a[_+2],(192&(b=a[_+1]))==128&&(192&C)==128&&((z=(15&A)<<12|(63&b)<<6|63&C)<=2047||z>=55296&&z<=57343)&&(z=null)):F===4&&(C=a[_+2],P=a[_+3],(192&(b=a[_+1]))==128&&(192&C)==128&&(192&P)==128&&((z=(15&A)<<18|(63&b)<<12|(63&C)<<6|63&P)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,F=1):z>65535&&(z-=65536,g+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),g+=String.fromCharCode(z),_+=F}return g}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Zr.Bytes)return i.push(this.readVarint(t));var a=Ao(this);for(i=i||[];this.pos<a;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Zr.Bytes)return i.push(this.readSVarint());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Zr.Bytes)return i.push(this.readBoolean());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Zr.Bytes)return i.push(this.readFloat());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Zr.Bytes)return i.push(this.readDouble());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Zr.Bytes)return i.push(this.readFixed32());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Zr.Bytes)return i.push(this.readSFixed32());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Zr.Bytes)return i.push(this.readFixed64());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Zr.Bytes)return i.push(this.readSFixed64());var t=Ao(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Zr.Varint)for(;this.buf[this.pos++]>127;);else if(t===Zr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Zr.Fixed32)this.pos+=4;else{if(t!==Zr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var a=new Uint8Array(t);a.set(this.buf),this.buf=a,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),cc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),cc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),cc(this.buf,-1&i,this.pos),cc(this.buf,Math.floor(i*ov),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),cc(this.buf,-1&i,this.pos),cc(this.buf,Math.floor(i*ov),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,a){var l,p;if(t>=0?(l=t%4294967296|0,p=t/4294967296|0):(p=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,p=p+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(g,_,b){b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,b.buf[b.pos]=127&(g>>>=7)}(l,0,a),function(g,_){var b=(7&g)<<4;_.buf[_.pos++]|=b|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))}(p,a)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(l,p,g){for(var _,b,C=0;C<p.length;C++){if((_=p.charCodeAt(C))>55295&&_<57344){if(!b){_>56319||C+1===p.length?(l[g++]=239,l[g++]=191,l[g++]=189):b=_;continue}if(_<56320){l[g++]=239,l[g++]=191,l[g++]=189,b=_;continue}_=b-55296<<10|_-56320|65536,b=null}else b&&(l[g++]=239,l[g++]=191,l[g++]=189,b=null);_<128?l[g++]=_:(_<2048?l[g++]=_>>6|192:(_<65536?l[g++]=_>>12|224:(l[g++]=_>>18|240,l[g++]=_>>12&63|128),l[g++]=_>>6&63|128),l[g++]=63&_|128)}return g}(this.buf,i,this.pos);var a=this.pos-t;a>=128&&uv(t,a,this),this.pos=t-1,this.writeVarint(a),this.pos+=a},writeFloat:function(i){this.realloc(4),sv(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),sv(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var a=0;a<t;a++)this.buf[this.pos++]=i[a]},writeRawMessage:function(i,t){this.pos++;var a=this.pos;i(t,this);var l=this.pos-a;l>=128&&uv(a,l,this),this.pos=a-1,this.writeVarint(l),this.pos+=l},writeMessage:function(i,t,a){this.writeTag(i,Zr.Bytes),this.writeRawMessage(t,a)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,k2,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,C2,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,P2,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,T2,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,I2,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,E2,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,A2,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,M2,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,D2,t)},writeBytesField:function(i,t){this.writeTag(i,Zr.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Zr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Zr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Zr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Zr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Zr.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Zr.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Zr.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Zr.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Zr.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var fm=V(iv);const mm=3;function z2(i,t,a){i===1&&a.readMessage(L2,t)}function L2(i,t,a){if(i===3){const{id:l,bitmap:p,width:g,height:_,left:b,top:C,advance:P}=a.readMessage(R2,{});t.push({id:l,bitmap:new vh({width:g+2*mm,height:_+2*mm},p),metrics:{width:g,height:_,left:b,top:C,advance:P}})}}function R2(i,t,a){i===1?t.id=a.readVarint():i===2?t.bitmap=a.readBytes():i===3?t.width=a.readVarint():i===4?t.height=a.readVarint():i===5?t.left=a.readSVarint():i===6?t.top=a.readSVarint():i===7&&(t.advance=a.readVarint())}const hv=mm;function dv(i){let t=0,a=0;for(const _ of i)t+=_.w*_.h,a=Math.max(a,_.w);i.sort((_,b)=>b.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),a),h:1/0}];let p=0,g=0;for(const _ of i)for(let b=l.length-1;b>=0;b--){const C=l[b];if(!(_.w>C.w||_.h>C.h)){if(_.x=C.x,_.y=C.y,g=Math.max(g,_.y+_.h),p=Math.max(p,_.x+_.w),_.w===C.w&&_.h===C.h){const P=l.pop();b<l.length&&(l[b]=P)}else _.h===C.h?(C.x+=_.w,C.w-=_.w):_.w===C.w?(C.y+=_.h,C.h-=_.h):(l.push({x:C.x+_.w,y:C.y,w:C.w-_.w,h:_.h}),C.y+=_.h,C.h-=_.h);break}}return{w:p,h:g,fill:t/(p*g)||0}}const na=1;class gm{constructor(t,{pixelRatio:a,version:l,stretchX:p,stretchY:g,content:_,textFitWidth:b,textFitHeight:C}){this.paddedRect=t,this.pixelRatio=a,this.stretchX=p,this.stretchY=g,this.content=_,this.version=l,this.textFitWidth=b,this.textFitHeight=C}get tl(){return[this.paddedRect.x+na,this.paddedRect.y+na]}get br(){return[this.paddedRect.x+this.paddedRect.w-na,this.paddedRect.y+this.paddedRect.h-na]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*na)/this.pixelRatio,(this.paddedRect.h-2*na)/this.pixelRatio]}}class pv{constructor(t,a){const l={},p={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,l,g),this.addImages(a,p,g);const{w:_,h:b}=dv(g),C=new Ba({width:_||1,height:b||1});for(const P in t){const A=t[P],z=l[P].paddedRect;Ba.copy(A.data,C,{x:0,y:0},{x:z.x+na,y:z.y+na},A.data)}for(const P in a){const A=a[P],z=p[P].paddedRect,F=z.x+na,U=z.y+na,K=A.data.width,W=A.data.height;Ba.copy(A.data,C,{x:0,y:0},{x:F,y:U},A.data),Ba.copy(A.data,C,{x:0,y:W-1},{x:F,y:U-1},{width:K,height:1}),Ba.copy(A.data,C,{x:0,y:0},{x:F,y:U+W},{width:K,height:1}),Ba.copy(A.data,C,{x:K-1,y:0},{x:F-1,y:U},{width:1,height:W}),Ba.copy(A.data,C,{x:0,y:0},{x:F+K,y:U},{width:1,height:W})}this.image=C,this.iconPositions=l,this.patternPositions=p}addImages(t,a,l){for(const p in t){const g=t[p],_={x:0,y:0,w:g.data.width+2*na,h:g.data.height+2*na};l.push(_),a[p]=new gm(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(t,a){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),a),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),a)}patchUpdatedImage(t,a,l){if(!t||!a||t.version===a.version)return;t.version=a.version;const[p,g]=t.tl;l.update(a.data,void 0,{x:p,y:g})}}var ml;Rt("ImagePosition",gm),Rt("ImageAtlas",pv),x.ah=void 0,(ml=x.ah||(x.ah={}))[ml.none=0]="none",ml[ml.horizontal=1]="horizontal",ml[ml.vertical=2]="vertical",ml[ml.horizontalOnly=3]="horizontalOnly";const Th=-17;class Ih{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,a){const l=new Ih;return l.scale=t||1,l.fontStack=a,l}static forImage(t){const a=new Ih;return a.imageName=t,a}}class hc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,a){const l=new hc;for(let p=0;p<t.sections.length;p++){const g=t.sections[p];g.image?l.addImageSection(g):l.addTextSection(g,a)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let a="";for(let l=0;l<t.length;l++){const p=t.charCodeAt(l+1)||null,g=t.charCodeAt(l-1)||null;a+=p&&Ld(p)&&!Ch[t[l+1]]||g&&Ld(g)&&!Ch[t[l-1]]||!Ch[t[l]]?t[l]:Ch[t[l]]}return a}(this.text)}trim(){let t=0;for(let l=0;l<this.text.length&&Xd[this.text.charCodeAt(l)];l++)t++;let a=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&Xd[this.text.charCodeAt(l)];l--)a--;this.text=this.text.substring(t,a),this.sectionIndex=this.sectionIndex.slice(t,a)}substring(t,a){const l=new hc;return l.text=this.text.substring(t,a),l.sectionIndex=this.sectionIndex.slice(t,a),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,a)=>Math.max(t,this.sections[a].scale),0)}addTextSection(t,a){this.text+=t.text,this.sections.push(Ih.forText(t.scale,t.fontStack||a));const l=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(l)}addImageSection(t){const a=t.image?t.image.name:"";if(a.length===0)return void Bt("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Ih.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Bt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zd(i,t,a,l,p,g,_,b,C,P,A,z,F,U,K){const W=hc.fromFeature(i,p);let ae;z===x.ah.vertical&&W.verticalizePunctuation();const{processBidirectionalText:ue,processStyledBidirectionalText:Fe}=ta;if(ue&&W.sections.length===1){ae=[];const Ke=ue(W.toString(),ym(W,P,g,t,l,U));for(const nt of Ke){const Et=new hc;Et.text=nt,Et.sections=W.sections;for(let Qt=0;Qt<nt.length;Qt++)Et.sectionIndex.push(0);ae.push(Et)}}else if(Fe){ae=[];const Ke=Fe(W.text,W.sectionIndex,ym(W,P,g,t,l,U));for(const nt of Ke){const Et=new hc;Et.text=nt[0],Et.sectionIndex=nt[1],Et.sections=W.sections,ae.push(Et)}}else ae=function(Ke,nt){const Et=[],Qt=Ke.text;let It=0;for(const xt of nt)Et.push(Ke.substring(It,xt)),It=xt;return It<Qt.length&&Et.push(Ke.substring(It,Qt.length)),Et}(W,ym(W,P,g,t,l,U));const _e=[],Me={positionedLines:_e,text:W.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(Ke,nt,Et,Qt,It,xt,Gt,Ft,Dt,Je,Kt,qt){let or=0,Qr=Th,Xr=0,Zn=0;const us=Ft==="right"?1:Ft==="left"?0:.5;let gi=0;for(const Pn of It){Pn.trim();const Yn=Pn.getMaxScale(),Ii=(Yn-1)*qn,yi={positionedGlyphs:[],lineOffset:0};Ke.positionedLines[gi]=yi;const Gi=yi.positionedGlyphs;let _i=0;if(!Pn.length()){Qr+=xt,++gi;continue}for(let ia=0;ia<Pn.length();ia++){const Nr=Pn.getSection(ia),tn=Pn.getSectionIndex(ia),hn=Pn.getCharCode(ia);let wa=0,xn=null,mc=null,to=null,ro=qn;const cs=!(Dt===x.ah.horizontal||!Kt&&!dh(hn)||Kt&&(Xd[hn]||(Xn=hn,/\p{sc=Arab}/u.test(String.fromCodePoint(Xn)))));if(Nr.imageName){const Ua=Qt[Nr.imageName];if(!Ua)continue;to=Nr.imageName,Ke.iconsInText=Ke.iconsInText||!0,mc=Ua.paddedRect;const oi=Ua.displaySize;Nr.scale=Nr.scale*qn/qt,xn={width:oi[0],height:oi[1],left:na,top:-hv,advance:cs?oi[1]:oi[0]},wa=Ii+(qn-oi[1]*Nr.scale),ro=xn.advance;const Mo=cs?oi[0]*Nr.scale-qn*Yn:oi[1]*Nr.scale-qn*Yn;Mo>0&&Mo>_i&&(_i=Mo)}else{const Ua=Et[Nr.fontStack],oi=Ua&&Ua[hn];if(oi&&oi.rect)mc=oi.rect,xn=oi.metrics;else{const Mo=nt[Nr.fontStack],zh=Mo&&Mo[hn];if(!zh)continue;xn=zh.metrics}wa=(Yn-Nr.scale)*qn}cs?(Ke.verticalizable=!0,Gi.push({glyph:hn,imageName:to,x:or,y:Qr+wa,vertical:cs,scale:Nr.scale,fontStack:Nr.fontStack,sectionIndex:tn,metrics:xn,rect:mc}),or+=ro*Nr.scale+Je):(Gi.push({glyph:hn,imageName:to,x:or,y:Qr+wa,vertical:cs,scale:Nr.scale,fontStack:Nr.fontStack,sectionIndex:tn,metrics:xn,rect:mc}),or+=xn.advance*Nr.scale+Je)}Gi.length!==0&&(Xr=Math.max(or-Je,Xr),N2(Gi,0,Gi.length-1,us,_i)),or=0;const ja=xt*Yn+_i;yi.lineOffset=Math.max(_i,Ii),Qr+=ja,Zn=Math.max(ja,Zn),++gi}var Xn;const Vi=Qr-Th,{horizontalAlign:$i,verticalAlign:qi}=_m(Gt);(function(Pn,Yn,Ii,yi,Gi,_i,ja,ia,Nr){const tn=(Yn-Ii)*Gi;let hn=0;hn=_i!==ja?-ia*yi-Th:(-yi*Nr+.5)*ja;for(const wa of Pn)for(const xn of wa.positionedGlyphs)xn.x+=tn,xn.y+=hn})(Ke.positionedLines,us,$i,qi,Xr,Zn,xt,Vi,It.length),Ke.top+=-qi*Vi,Ke.bottom=Ke.top+Vi,Ke.left+=-$i*Xr,Ke.right=Ke.left+Xr}(Me,t,a,l,ae,_,b,C,z,P,F,K),!function(Ke){for(const nt of Ke)if(nt.positionedGlyphs.length!==0)return!1;return!0}(_e)&&Me}const Xd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},O2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},F2={40:!0};function fv(i,t,a,l,p,g){if(t.imageName){const _=l[t.imageName];return _?_.displaySize[0]*t.scale*qn/g+p:0}{const _=a[t.fontStack],b=_&&_[i];return b?b.metrics.advance*t.scale+p:0}}function mv(i,t,a,l){const p=Math.pow(i-t,2);return l?i<t?p/2:2*p:p+Math.abs(a)*a}function B2(i,t,a){let l=0;return i===10&&(l-=1e4),a&&(l+=150),i!==40&&i!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function gv(i,t,a,l,p,g){let _=null,b=mv(t,a,p,g);for(const C of l){const P=mv(t-C.x,a,p,g)+C.badness;P<=b&&(_=C,b=P)}return{index:i,x:t,priorBreak:_,badness:b}}function yv(i){return i?yv(i.priorBreak).concat(i.index):[]}function ym(i,t,a,l,p,g){if(!i)return[];const _=[],b=function(z,F,U,K,W,ae){let ue=0;for(let Fe=0;Fe<z.length();Fe++){const _e=z.getSection(Fe);ue+=fv(z.getCharCode(Fe),_e,K,W,F,ae)}return ue/Math.max(1,Math.ceil(ue/U))}(i,t,a,l,p,g),C=i.text.indexOf("")>=0;let P=0;for(let z=0;z<i.length();z++){const F=i.getSection(z),U=i.getCharCode(z);if(Xd[U]||(P+=fv(U,F,l,p,t,g)),z<i.length()-1){const K=!((A=U)<11904)&&(!!Er["CJK Compatibility Forms"](A)||!!Er["CJK Compatibility"](A)||!!Er["CJK Strokes"](A)||!!Er["CJK Symbols and Punctuation"](A)||!!Er["Enclosed CJK Letters and Months"](A)||!!Er["Halfwidth and Fullwidth Forms"](A)||!!Er["Ideographic Description Characters"](A)||!!Er["Vertical Forms"](A)||zd.test(String.fromCodePoint(A)));(O2[U]||K||F.imageName||z!==i.length()-2&&F2[i.getCharCode(z+1)])&&_.push(gv(z+1,P,b,_,B2(U,i.getCharCode(z+1),K&&C),!1))}}var A;return yv(gv(i.length(),P,b,_,0,!0))}function _m(i){let t=.5,a=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:t,verticalAlign:a}}function N2(i,t,a,l,p){if(!l&&!p)return;const g=i[a],_=(i[a].x+g.metrics.advance*g.scale)*l;for(let b=t;b<=a;b++)i[b].x-=_,i[b].y+=p}function j2(i,t,a){const{horizontalAlign:l,verticalAlign:p}=_m(a),g=t[0]-i.displaySize[0]*l,_=t[1]-i.displaySize[1]*p;return{image:i,top:_,bottom:_+i.displaySize[1],left:g,right:g+i.displaySize[0]}}function _v(i){var t,a;let l=i.left,p=i.top,g=i.right-l,_=i.bottom-p;const b=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",C=(a=i.image.textFitHeight)!==null&&a!==void 0?a:"stretchOrShrink",P=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(C==="proportional"){if(b==="stretchOnly"&&g/_<P||b==="proportional"){const A=Math.ceil(_*P);l*=A/g,g=A}}else if(b==="proportional"&&C==="stretchOnly"&&P!==0&&g/_>P){const A=Math.ceil(g/P);p*=A/_,_=A}return{x1:l,y1:p,x2:l+g,y2:p+_}}function vv(i,t,a,l,p,g){const _=i.image;let b;if(_.content){const ae=_.content,ue=_.pixelRatio||1;b=[ae[0]/ue,ae[1]/ue,_.displaySize[0]-ae[2]/ue,_.displaySize[1]-ae[3]/ue]}const C=t.left*g,P=t.right*g;let A,z,F,U;a==="width"||a==="both"?(U=p[0]+C-l[3],z=p[0]+P+l[1]):(U=p[0]+(C+P-_.displaySize[0])/2,z=U+_.displaySize[0]);const K=t.top*g,W=t.bottom*g;return a==="height"||a==="both"?(A=p[1]+K-l[0],F=p[1]+W+l[2]):(A=p[1]+(K+W-_.displaySize[1])/2,F=A+_.displaySize[1]),{image:_,top:A,right:z,bottom:F,left:U,collisionPadding:b}}const Ph=255,eo=128,gl=Ph*eo;function xv(i,t){const{expression:a}=t;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new on(i+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:p}=a;let g=0;for(;g<l.length&&l[g]<=i;)g++;g=Math.max(0,g-1);let _=g;for(;_<l.length&&l[_]<i+1;)_++;_=Math.min(l.length-1,_);const b=l[g],C=l[_];return a.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:C,interpolationType:p}:{kind:"camera",minZoom:b,maxZoom:C,minSize:a.evaluate(new on(b)),maxSize:a.evaluate(new on(C)),interpolationType:p}}}function vm(i,t,a){let l="never";const p=i.get(t);return p?l=p:i.get(a)&&(l="always"),l}const U2=fl.VectorTileFeature.types,V2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Yd(i,t,a,l,p,g,_,b,C,P,A,z,F){const U=b?Math.min(gl,Math.round(b[0])):0,K=b?Math.min(gl,Math.round(b[1])):0;i.emplaceBack(t,a,Math.round(32*l),Math.round(32*p),g,_,(U<<1)+(C?1:0),K,16*P,16*A,256*z,256*F)}function xm(i,t,a){i.emplaceBack(t.x,t.y,a),i.emplaceBack(t.x,t.y,a),i.emplaceBack(t.x,t.y,a),i.emplaceBack(t.x,t.y,a)}function $2(i){for(const t of i.sections)if(Wf(t.text))return!0;return!1}class bm{constructor(t){this.layoutVertexArray=new ec,this.indexArray=new Fa,this.programConfigurations=t,this.segments=new Ar,this.dynamicLayoutVertexArray=new mh,this.opacityVertexArray=new xa,this.hasVisibleVertices=!1,this.placedSymbolArray=new ln}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,a,l,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,v2.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,x2.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,V2,!0),this.opacityVertexBuffer.itemSize=1),(l||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Rt("SymbolBuffers",bm);class wm{constructor(t,a,l){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new l,this.segments=new Ar,this.collisionVertexArray=new Js}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,b2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Rt("CollisionBuffers",wm);class dc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=tm([]),this.placementViewportMatrix=tm([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=xv(this.zoom,a["text-size"]),this.iconSizeData=xv(this.zoom,a["icon-size"]);const l=this.layers[0].layout,p=l.get("symbol-sort-key"),g=l.get("symbol-z-order");this.canOverlap=vm(l,"text-overlap","text-allow-overlap")!=="never"||vm(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(_=>x.ah[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID}createArrays(){this.text=new bm(new uu(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new bm(new uu(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new un,this.lineVertexArray=new di,this.symbolInstances=new Tr,this.textAnchorOffsets=new cn}calculateGlyphDependencies(t,a,l,p,g){for(let _=0;_<t.length;_++)if(a[t.charCodeAt(_)]=!0,(l||p)&&g){const b=Ch[t.charAt(_)];b&&(a[b.charCodeAt(0)]=!0)}}populate(t,a,l){const p=this.layers[0],g=p.layout,_=g.get("text-font"),b=g.get("text-field"),C=g.get("icon-image"),P=(b.value.kind!=="constant"||b.value.value instanceof Hn&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),A=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,z=g.get("symbol-sort-key");if(this.features=[],!P&&!A)return;const F=a.iconDependencies,U=a.glyphDependencies,K=a.availableImages,W=new on(this.zoom);for(const{feature:ae,id:ue,index:Fe,sourceLayerIndex:_e}of t){const Me=p._featureFilter.needGeometry,Ke=hu(ae,Me);if(!p._featureFilter.filter(W,Ke,l))continue;let nt,Et;if(Me||(Ke.geometry=cu(ae)),P){const It=p.getValueAndResolveTokens("text-field",Ke,l,K),xt=Hn.factory(It),Gt=this.hasRTLText=this.hasRTLText||$2(xt);(!Gt||ta.getRTLTextPluginStatus()==="unavailable"||Gt&&ta.isParsed())&&(nt=S2(xt,p,Ke))}if(A){const It=p.getValueAndResolveTokens("icon-image",Ke,l,K);Et=It instanceof ci?It:ci.fromString(It)}if(!nt&&!Et)continue;const Qt=this.sortFeaturesByKey?z.evaluate(Ke,{},l):void 0;if(this.features.push({id:ue,text:nt,icon:Et,index:Fe,sourceLayerIndex:_e,geometry:Ke.geometry,properties:ae.properties,type:U2[ae.type],sortKey:Qt}),Et&&(F[Et.name]=!0),nt){const It=_.evaluate(Ke,{},l).join(","),xt=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(x.ah.vertical)>=0;for(const Gt of nt.sections)if(Gt.image)F[Gt.image.name]=!0;else{const Ft=ch(nt.toString()),Dt=Gt.fontStack||It,Je=U[Dt]=U[Dt]||{};this.calculateGlyphDependencies(Gt.text,Je,xt,this.allowVerticalPlacement,Ft)}}}g.get("symbol-placement")==="line"&&(this.features=function(ae){const ue={},Fe={},_e=[];let Me=0;function Ke(It){_e.push(ae[It]),Me++}function nt(It,xt,Gt){const Ft=Fe[It];return delete Fe[It],Fe[xt]=Ft,_e[Ft].geometry[0].pop(),_e[Ft].geometry[0]=_e[Ft].geometry[0].concat(Gt[0]),Ft}function Et(It,xt,Gt){const Ft=ue[xt];return delete ue[xt],ue[It]=Ft,_e[Ft].geometry[0].shift(),_e[Ft].geometry[0]=Gt[0].concat(_e[Ft].geometry[0]),Ft}function Qt(It,xt,Gt){const Ft=Gt?xt[0][xt[0].length-1]:xt[0][0];return`${It}:${Ft.x}:${Ft.y}`}for(let It=0;It<ae.length;It++){const xt=ae[It],Gt=xt.geometry,Ft=xt.text?xt.text.toString():null;if(!Ft){Ke(It);continue}const Dt=Qt(Ft,Gt),Je=Qt(Ft,Gt,!0);if(Dt in Fe&&Je in ue&&Fe[Dt]!==ue[Je]){const Kt=Et(Dt,Je,Gt),qt=nt(Dt,Je,_e[Kt].geometry);delete ue[Dt],delete Fe[Je],Fe[Qt(Ft,_e[qt].geometry,!0)]=qt,_e[Kt].geometry=null}else Dt in Fe?nt(Dt,Je,Gt):Je in ue?Et(Dt,Je,Gt):(Ke(It),ue[Dt]=Me-1,Fe[Je]=Me-1)}return _e.filter(It=>It.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ae,ue)=>ae.sortKey-ue.sortKey)}update(t,a,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,l),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,a){const l=this.lineVertexArray.length;if(t.segment!==void 0){let p=t.dist(a[t.segment+1]),g=t.dist(a[t.segment]);const _={};for(let b=t.segment+1;b<a.length;b++)_[b]={x:a[b].x,y:a[b].y,tileUnitDistanceFromAnchor:p},b<a.length-1&&(p+=a[b+1].dist(a[b]));for(let b=t.segment||0;b>=0;b--)_[b]={x:a[b].x,y:a[b].y,tileUnitDistanceFromAnchor:g},b>0&&(g+=a[b-1].dist(a[b]));for(let b=0;b<a.length;b++){const C=_[b];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,a,l,p,g,_,b,C,P,A,z,F){const U=t.indexArray,K=t.layoutVertexArray,W=t.segments.prepareSegment(4*a.length,K,U,this.canOverlap?_.sortKey:void 0),ae=this.glyphOffsetArray.length,ue=W.vertexLength,Fe=this.allowVerticalPlacement&&b===x.ah.vertical?Math.PI/2:0,_e=_.text&&_.text.sections;for(let Me=0;Me<a.length;Me++){const{tl:Ke,tr:nt,bl:Et,br:Qt,tex:It,pixelOffsetTL:xt,pixelOffsetBR:Gt,minFontScaleX:Ft,minFontScaleY:Dt,glyphOffset:Je,isSDF:Kt,sectionIndex:qt}=a[Me],or=W.vertexLength,Qr=Je[1];Yd(K,C.x,C.y,Ke.x,Qr+Ke.y,It.x,It.y,l,Kt,xt.x,xt.y,Ft,Dt),Yd(K,C.x,C.y,nt.x,Qr+nt.y,It.x+It.w,It.y,l,Kt,Gt.x,xt.y,Ft,Dt),Yd(K,C.x,C.y,Et.x,Qr+Et.y,It.x,It.y+It.h,l,Kt,xt.x,Gt.y,Ft,Dt),Yd(K,C.x,C.y,Qt.x,Qr+Qt.y,It.x+It.w,It.y+It.h,l,Kt,Gt.x,Gt.y,Ft,Dt),xm(t.dynamicLayoutVertexArray,C,Fe),U.emplaceBack(or,or+1,or+2),U.emplaceBack(or+1,or+2,or+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Je[0]),Me!==a.length-1&&qt===a[Me+1].sectionIndex||t.programConfigurations.populatePaintArrays(K.length,_,_.index,{},F,_e&&_e[qt])}t.placedSymbolArray.emplaceBack(C.x,C.y,ae,this.glyphOffsetArray.length-ae,ue,P,A,C.segment,l?l[0]:0,l?l[1]:0,p[0],p[1],b,0,!1,0,z)}_addCollisionDebugVertex(t,a,l,p,g,_){return a.emplaceBack(0,0),t.emplaceBack(l.x,l.y,p,g,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,a,l,p,g,_,b){const C=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),P=C.vertexLength,A=g.layoutVertexArray,z=g.collisionVertexArray,F=b.anchorX,U=b.anchorY;this._addCollisionDebugVertex(A,z,_,F,U,new Q(t,a)),this._addCollisionDebugVertex(A,z,_,F,U,new Q(l,a)),this._addCollisionDebugVertex(A,z,_,F,U,new Q(l,p)),this._addCollisionDebugVertex(A,z,_,F,U,new Q(t,p)),C.vertexLength+=4;const K=g.indexArray;K.emplaceBack(P,P+1),K.emplaceBack(P+1,P+2),K.emplaceBack(P+2,P+3),K.emplaceBack(P+3,P),C.primitiveLength+=4}addDebugCollisionBoxes(t,a,l,p){for(let g=t;g<a;g++){const _=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,p?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new wm(ba,nv.members,si),this.iconCollisionBox=new wm(ba,nv.members,si);for(let t=0;t<this.symbolInstances.length;t++){const a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(t,a,l,p,g,_,b,C,P){const A={};for(let z=a;z<l;z++){const F=t.get(z);A.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},A.textFeatureIndex=F.featureIndex;break}for(let z=p;z<g;z++){const F=t.get(z);A.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},A.verticalTextFeatureIndex=F.featureIndex;break}for(let z=_;z<b;z++){const F=t.get(z);A.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},A.iconFeatureIndex=F.featureIndex;break}for(let z=C;z<P;z++){const F=t.get(z);A.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},A.verticalIconFeatureIndex=F.featureIndex;break}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const l=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,a){const l=t.placedSymbolArray.get(a),p=l.vertexStartIndex+4*l.numGlyphs;for(let g=l.vertexStartIndex;g<p;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(t),l=Math.cos(t),p=[],g=[],_=[];for(let b=0;b<this.symbolInstances.length;++b){_.push(b);const C=this.symbolInstances.get(b);p.push(0|Math.round(a*C.anchorX+l*C.anchorY)),g.push(C.featureIndex)}return _.sort((b,C)=>p[b]-p[C]||g[C]-g[b]),_}addToSortKeyRanges(t,a){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===a?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const l=this.symbolInstances.get(a);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((p,g,_)=>{p>=0&&_.indexOf(p)===g&&this.addIndicesForPlacedSymbol(this.text,p)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let bv,wv;Rt("SymbolBucket",dc,{omit:["layers","collisionBoxArray","features","compareText"]}),dc.MAX_GLYPHS=65535,dc.addDynamicAttributes=xm;var Sm={get paint(){return wv=wv||new m({"icon-opacity":new tr(Ee.paint_symbol["icon-opacity"]),"icon-color":new tr(Ee.paint_symbol["icon-color"]),"icon-halo-color":new tr(Ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new tr(Ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new tr(Ee.paint_symbol["icon-halo-blur"]),"icon-translate":new Vt(Ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new Vt(Ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new tr(Ee.paint_symbol["text-opacity"]),"text-color":new tr(Ee.paint_symbol["text-color"],{runtimeType:Ot,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new tr(Ee.paint_symbol["text-halo-color"]),"text-halo-width":new tr(Ee.paint_symbol["text-halo-width"]),"text-halo-blur":new tr(Ee.paint_symbol["text-halo-blur"]),"text-translate":new Vt(Ee.paint_symbol["text-translate"]),"text-translate-anchor":new Vt(Ee.paint_symbol["text-translate-anchor"])})},get layout(){return bv=bv||new m({"symbol-placement":new Vt(Ee.layout_symbol["symbol-placement"]),"symbol-spacing":new Vt(Ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Vt(Ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new tr(Ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Vt(Ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Vt(Ee.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Vt(Ee.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Vt(Ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new Vt(Ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Vt(Ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new tr(Ee.layout_symbol["icon-size"]),"icon-text-fit":new Vt(Ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Vt(Ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new tr(Ee.layout_symbol["icon-image"]),"icon-rotate":new tr(Ee.layout_symbol["icon-rotate"]),"icon-padding":new tr(Ee.layout_symbol["icon-padding"]),"icon-keep-upright":new Vt(Ee.layout_symbol["icon-keep-upright"]),"icon-offset":new tr(Ee.layout_symbol["icon-offset"]),"icon-anchor":new tr(Ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Vt(Ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Vt(Ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Vt(Ee.layout_symbol["text-rotation-alignment"]),"text-field":new tr(Ee.layout_symbol["text-field"]),"text-font":new tr(Ee.layout_symbol["text-font"]),"text-size":new tr(Ee.layout_symbol["text-size"]),"text-max-width":new tr(Ee.layout_symbol["text-max-width"]),"text-line-height":new Vt(Ee.layout_symbol["text-line-height"]),"text-letter-spacing":new tr(Ee.layout_symbol["text-letter-spacing"]),"text-justify":new tr(Ee.layout_symbol["text-justify"]),"text-radial-offset":new tr(Ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Vt(Ee.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new tr(Ee.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new tr(Ee.layout_symbol["text-anchor"]),"text-max-angle":new Vt(Ee.layout_symbol["text-max-angle"]),"text-writing-mode":new Vt(Ee.layout_symbol["text-writing-mode"]),"text-rotate":new tr(Ee.layout_symbol["text-rotate"]),"text-padding":new Vt(Ee.layout_symbol["text-padding"]),"text-keep-upright":new Vt(Ee.layout_symbol["text-keep-upright"]),"text-transform":new tr(Ee.layout_symbol["text-transform"]),"text-offset":new tr(Ee.layout_symbol["text-offset"]),"text-allow-overlap":new Vt(Ee.layout_symbol["text-allow-overlap"]),"text-overlap":new Vt(Ee.layout_symbol["text-overlap"]),"text-ignore-placement":new Vt(Ee.layout_symbol["text-ignore-placement"]),"text-optional":new Vt(Ee.layout_symbol["text-optional"])})}};class Sv{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:en,this.defaultValue=t}evaluate(t){if(t.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Rt("FormatSectionOverride",Sv,{omit:["defaultValue"]});class Jd extends s{constructor(t){super(t,Sm)}recalculate(t,a){if(super.recalculate(t,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const p=[];for(const g of l)p.indexOf(g)<0&&p.push(g);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,a,l,p){const g=this.layout.get(t).evaluate(a,{},l,p),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||De(_.value)||!g?g:function(b,C){return C.replace(/{([^{}]+)}/g,(P,A)=>b&&A in b?String(b[A]):"")}(a.properties,g)}createBucket(t){return new dc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Sm.paint.overridableProperties){if(!Jd.hasPaintOverride(this.layout,t))continue;const a=this.paint.get(t),l=new Sv(a),p=new Ce(l,a.property.specification);let g=null;g=a.value.kind==="constant"||a.value.kind==="source"?new Oe("source",p):new ke("composite",p,a.value.zoomStops),this.paint._values[t]=new os(a.property,g,a.parameters)}}_handleOverridablePaintPropertyUpdate(t,a,l){return!(!this.layout||a.isDataDriven()||l.isDataDriven())&&Jd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,a){const l=t.get("text-field"),p=Sm.paint.properties[a];let g=!1;const _=b=>{for(const C of b)if(p.overrides&&p.overrides.hasOverride(C))return void(g=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Hn)_(l.value.value.sections);else if(l.value.kind==="source"){const b=P=>{g||(P instanceof Li&&ir(P.value)===St?_(P.value.sections):P instanceof go?_(P.sections):P.eachChild(b))},C=l.value;C._styleExpression&&b(C._styleExpression.expression)}return g}}let kv;var q2={get paint(){return kv=kv||new m({"background-color":new Vt(Ee.paint_background["background-color"]),"background-pattern":new Ju(Ee.paint_background["background-pattern"]),"background-opacity":new Vt(Ee.paint_background["background-opacity"])})}};class G2 extends s{constructor(t){super(t,q2)}}let Cv;var K2={get paint(){return Cv=Cv||new m({"raster-opacity":new Vt(Ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new Vt(Ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Vt(Ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Vt(Ee.paint_raster["raster-brightness-max"]),"raster-saturation":new Vt(Ee.paint_raster["raster-saturation"]),"raster-contrast":new Vt(Ee.paint_raster["raster-contrast"]),"raster-resampling":new Vt(Ee.paint_raster["raster-resampling"]),"raster-fade-duration":new Vt(Ee.paint_raster["raster-fade-duration"])})}};class H2 extends s{constructor(t){super(t,K2)}}class W2 extends s{constructor(t){super(t,{}),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Z2{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const km=63710088e-1;class yl{constructor(t,a){if(isNaN(t)||isNaN(a))throw new Error(`Invalid LngLat object: (${t}, ${a})`);if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new yl(He(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const a=Math.PI/180,l=this.lat*a,p=t.lat*a,g=Math.sin(l)*Math.sin(p)+Math.cos(l)*Math.cos(p)*Math.cos((t.lng-this.lng)*a);return km*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof yl)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new yl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new yl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Tv=2*Math.PI*km;function Iv(i){return Tv*Math.cos(i*Math.PI/180)}function Pv(i){return(180+i)/360}function Ev(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Av(i,t){return i/Iv(t)}function Cm(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Eh{constructor(t,a,l=0){this.x=+t,this.y=+a,this.z=+l}static fromLngLat(t,a=0){const l=yl.convert(t);return new Eh(Pv(l.lng),Ev(l.lat),Av(a,l.lat))}toLngLat(){return new yl(360*this.x-180,Cm(this.y))}toAltitude(){return this.z*Iv(Cm(this.y))}meterInMercatorCoordinateUnits(){return 1/Tv*(t=Cm(this.y),1/Math.cos(t*Math.PI/180));var t}}function Mv(i,t,a){var l=2*Math.PI*6378137/256/Math.pow(2,a);return[i*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class Tm{constructor(t,a,l){if(!function(p,g,_){return!(p<0||p>25||_<0||_>=Math.pow(2,p)||g<0||g>=Math.pow(2,p))}(t,a,l))throw new Error(`x=${a}, y=${l}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=a,this.y=l,this.key=Ah(0,t,t,a,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,a,l){const p=(_=this.y,b=this.z,C=Mv(256*(g=this.x),256*(_=Math.pow(2,b)-_-1),b),P=Mv(256*(g+1),256*(_+1),b),C[0]+","+C[1]+","+P[0]+","+P[1]);var g,_,b,C,P;const A=function(z,F,U){let K,W="";for(let ae=z;ae>0;ae--)K=1<<ae-1,W+=(F&K?1:0)+(U&K?2:0);return W}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,a>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,p)}isChildOf(t){const a=this.z-t.z;return a>0&&t.x===this.x>>a&&t.y===this.y>>a}getTilePoint(t){const a=Math.pow(2,this.z);return new Q((t.x*a-this.x)*jn,(t.y*a-this.y)*jn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Dv{constructor(t,a){this.wrap=t,this.canonical=a,this.key=Ah(t,a.z,a.z,a.x,a.y)}}class Na{constructor(t,a,l,p,g){if(t<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${l}`);this.overscaledZ=t,this.wrap=a,this.canonical=new Tm(l,+p,+g),this.key=Ah(a,t,l,p,g)}clone(){return new Na(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?new Na(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Na(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(t,a){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?Ah(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):Ah(this.wrap*+a,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a}children(t){if(this.overscaledZ>=t)return[new Na(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,l=2*this.canonical.x,p=2*this.canonical.y;return[new Na(a,this.wrap,a,l,p),new Na(a,this.wrap,a,l+1,p),new Na(a,this.wrap,a,l,p+1),new Na(a,this.wrap,a,l+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Na(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Na(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Dv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Eh(t.x-this.wrap,t.y))}}function Ah(i,t,a,l,p){(i*=2)<0&&(i=-1*i-1);const g=1<<a;return(g*g*i+g*p+l).toString(36)+a.toString(36)+t.toString(36)}Rt("CanonicalTileID",Tm),Rt("OverscaledTileID",Na,{omit:["posMatrix"]});class zv{constructor(t,a,l,p=1,g=1,_=1,b=0){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void Bt(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=a.height;const C=this.dim=a.height-2;switch(this.data=new Uint32Array(a.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=g,this.blueFactor=_,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<C;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(C,P)]=this.data[this._idx(C-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,C)]=this.data[this._idx(P,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<C;P++)for(let A=0;A<C;A++){const z=this.get(P,A);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(t,a){const l=new Uint8Array(this.data.buffer),p=4*this._idx(t,a);return this.unpack(l[p],l[p+1],l[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)}unpack(t,a,l){return t*this.redFactor+a*this.greenFactor+l*this.blueFactor-this.baseShift}getPixels(){return new Ba({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,a,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=a*this.dim,g=a*this.dim+this.dim,_=l*this.dim,b=l*this.dim+this.dim;switch(a){case-1:p=g-1;break;case 1:g=p+1}switch(l){case-1:_=b-1;break;case 1:b=_+1}const C=-a*this.dim,P=-l*this.dim;for(let A=_;A<b;A++)for(let z=p;z<g;z++)this.data[this._idx(z,A)]=t.data[this._idx(z+C,A+P)]}}Rt("DEMData",zv);class Lv{constructor(t){this._stringToNumber={},this._numberToString=[];for(let a=0;a<t.length;a++){const l=t[a];this._stringToNumber[l]=a,this._numberToString[a]=l}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Rv{constructor(t,a,l,p,g){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=l,t._y=p,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t}}class Ov{constructor(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new nl(jn,16,0),this.grid3D=new nl(jn,16,0),this.featureIndexArray=new Ci,this.promoteId=a}insert(t,a,l,p,g,_){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,p,g);const C=_?this.grid3D:this.grid;for(let P=0;P<a.length;P++){const A=a[P],z=[1/0,1/0,-1/0,-1/0];for(let F=0;F<A.length;F++){const U=A[F];z[0]=Math.min(z[0],U.x),z[1]=Math.min(z[1],U.y),z[2]=Math.max(z[2],U.x),z[3]=Math.max(z[3],U.y)}z[0]<jn&&z[1]<jn&&z[2]>=0&&z[3]>=0&&C.insert(b,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new fl.VectorTile(new fm(this.rawTileData)).layers,this.sourceLayerCoder=new Lv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,a,l,p){this.loadVTLayers();const g=t.params||{},_=jn/t.tileSize/t.scale,b=Ye(g.filter),C=t.queryGeometry,P=t.queryPadding*_,A=Bv(C),z=this.grid.query(A.minX-P,A.minY-P,A.maxX+P,A.maxY+P),F=Bv(t.cameraQueryGeometry),U=this.grid3D.query(F.minX-P,F.minY-P,F.maxX+P,F.maxY+P,(ae,ue,Fe,_e)=>function(Me,Ke,nt,Et,Qt){for(const xt of Me)if(Ke<=xt.x&&nt<=xt.y&&Et>=xt.x&&Qt>=xt.y)return!0;const It=[new Q(Ke,nt),new Q(Ke,Qt),new Q(Et,Qt),new Q(Et,nt)];if(Me.length>2){for(const xt of It)if(ac(Me,xt))return!0}for(let xt=0;xt<Me.length-1;xt++)if(Ew(Me[xt],Me[xt+1],It))return!0;return!1}(t.cameraQueryGeometry,ae-P,ue-P,Fe+P,_e+P));for(const ae of U)z.push(ae);z.sort(X2);const K={};let W;for(let ae=0;ae<z.length;ae++){const ue=z[ae];if(ue===W)continue;W=ue;const Fe=this.featureIndexArray.get(ue);let _e=null;this.loadMatchingFeature(K,Fe.bucketIndex,Fe.sourceLayerIndex,Fe.featureIndex,b,g.layers,g.availableImages,a,l,p,(Me,Ke,nt)=>(_e||(_e=cu(Me)),Ke.queryIntersectsFeature(C,Me,nt,_e,this.z,t.transform,_,t.pixelPosMatrix)))}return K}loadMatchingFeature(t,a,l,p,g,_,b,C,P,A,z){const F=this.bucketLayerIDs[a];if(_&&!function(ae,ue){for(let Fe=0;Fe<ae.length;Fe++)if(ue.indexOf(ae[Fe])>=0)return!0;return!1}(_,F))return;const U=this.sourceLayerCoder.decode(l),K=this.vtLayers[U].feature(p);if(g.needGeometry){const ae=hu(K,!0);if(!g.filter(new on(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!g.filter(new on(this.tileID.overscaledZ),K))return;const W=this.getId(K,U);for(let ae=0;ae<F.length;ae++){const ue=F[ae];if(_&&_.indexOf(ue)<0)continue;const Fe=C[ue];if(!Fe)continue;let _e={};W&&A&&(_e=A.getState(Fe.sourceLayer||"_geojsonTileLayer",W));const Me=Xe({},P[ue]);Me.paint=Fv(Me.paint,Fe.paint,K,_e,b),Me.layout=Fv(Me.layout,Fe.layout,K,_e,b);const Ke=!z||z(K,Fe,_e);if(!Ke)continue;const nt=new Rv(K,this.z,this.x,this.y,W);nt.layer=Me;let Et=t[ue];Et===void 0&&(Et=t[ue]=[]),Et.push({featureIndex:p,feature:nt,intersectionZ:Ke})}}lookupSymbolFeatures(t,a,l,p,g,_,b,C){const P={};this.loadVTLayers();const A=Ye(g);for(const z of t)this.loadMatchingFeature(P,l,p,z,A,_,b,C,a);return P}hasLayer(t){for(const a of this.bucketLayerIDs)for(const l of a)if(t===l)return!0;return!1}getId(t,a){let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]],typeof l=="boolean"&&(l=Number(l))),l}}function Fv(i,t,a,l,p){return ve(i,(g,_)=>{const b=t instanceof su?t.get(_):null;return b&&b.evaluate?b.evaluate(a,l,p):b})}function Bv(i){let t=1/0,a=1/0,l=-1/0,p=-1/0;for(const g of i)t=Math.min(t,g.x),a=Math.min(a,g.y),l=Math.max(l,g.x),p=Math.max(p,g.y);return{minX:t,minY:a,maxX:l,maxY:p}}function X2(i,t){return t-i}function Nv(i,t,a,l,p){const g=[];for(let _=0;_<i.length;_++){const b=i[_];let C;for(let P=0;P<b.length-1;P++){let A=b[P],z=b[P+1];A.x<t&&z.x<t||(A.x<t?A=new Q(t,A.y+(t-A.x)/(z.x-A.x)*(z.y-A.y))._round():z.x<t&&(z=new Q(t,A.y+(t-A.x)/(z.x-A.x)*(z.y-A.y))._round()),A.y<a&&z.y<a||(A.y<a?A=new Q(A.x+(a-A.y)/(z.y-A.y)*(z.x-A.x),a)._round():z.y<a&&(z=new Q(A.x+(a-A.y)/(z.y-A.y)*(z.x-A.x),a)._round()),A.x>=l&&z.x>=l||(A.x>=l?A=new Q(l,A.y+(l-A.x)/(z.x-A.x)*(z.y-A.y))._round():z.x>=l&&(z=new Q(l,A.y+(l-A.x)/(z.x-A.x)*(z.y-A.y))._round()),A.y>=p&&z.y>=p||(A.y>=p?A=new Q(A.x+(p-A.y)/(z.y-A.y)*(z.x-A.x),p)._round():z.y>=p&&(z=new Q(A.x+(p-A.y)/(z.y-A.y)*(z.x-A.x),p)._round()),C&&A.equals(C[C.length-1])||(C=[A],g.push(C)),C.push(z)))))}}return g}Rt("FeatureIndex",Ov,{omit:["rawTileData","sourceLayerCoder"]});class _l extends Q{constructor(t,a,l,p){super(t,a),this.angle=l,p!==void 0&&(this.segment=p)}clone(){return new _l(this.x,this.y,this.angle,this.segment)}}function jv(i,t,a,l,p){if(t.segment===void 0||a===0)return!0;let g=t,_=t.segment+1,b=0;for(;b>-a/2;){if(_--,_<0)return!1;b-=i[_].dist(g),g=i[_]}b+=i[_].dist(i[_+1]),_++;const C=[];let P=0;for(;b<a/2;){const A=i[_],z=i[_+1];if(!z)return!1;let F=i[_-1].angleTo(A)-A.angleTo(z);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:b,angleDelta:F}),P+=F;b-C[0].distance>l;)P-=C.shift().angleDelta;if(P>p)return!1;_++,b+=A.dist(z)}return!0}function Uv(i){let t=0;for(let a=0;a<i.length-1;a++)t+=i[a].dist(i[a+1]);return t}function Vv(i,t,a){return i?.6*t*a:0}function $v(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function Y2(i,t,a,l,p,g){const _=Vv(a,p,g),b=$v(a,l)*g;let C=0;const P=Uv(i)/2;for(let A=0;A<i.length-1;A++){const z=i[A],F=i[A+1],U=z.dist(F);if(C+U>P){const K=(P-C)/U,W=ni.number(z.x,F.x,K),ae=ni.number(z.y,F.y,K),ue=new _l(W,ae,F.angleTo(z),A);return ue._round(),!_||jv(i,ue,b,_,t)?ue:void 0}C+=U}}function J2(i,t,a,l,p,g,_,b,C){const P=Vv(l,g,_),A=$v(l,p),z=A*_,F=i[0].x===0||i[0].x===C||i[0].y===0||i[0].y===C;return t-z<t/4&&(t=z+t/4),qv(i,F?t/2*b%t:(A/2+2*g)*_*b%t,t,P,a,z,F,!1,C)}function qv(i,t,a,l,p,g,_,b,C){const P=g/2,A=Uv(i);let z=0,F=t-a,U=[];for(let K=0;K<i.length-1;K++){const W=i[K],ae=i[K+1],ue=W.dist(ae),Fe=ae.angleTo(W);for(;F+a<z+ue;){F+=a;const _e=(F-z)/ue,Me=ni.number(W.x,ae.x,_e),Ke=ni.number(W.y,ae.y,_e);if(Me>=0&&Me<C&&Ke>=0&&Ke<C&&F-P>=0&&F+P<=A){const nt=new _l(Me,Ke,Fe,K);nt._round(),l&&!jv(i,nt,g,l,p)||U.push(nt)}}z+=ue}return b||U.length||_||(U=qv(i,z/2,a,l,p,g,_,!0,C)),U}Rt("Anchor",_l);const pc=na;function Gv(i,t,a,l){const p=[],g=i.image,_=g.pixelRatio,b=g.paddedRect.w-2*pc,C=g.paddedRect.h-2*pc;let P={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const A=g.stretchX||[[0,b]],z=g.stretchY||[[0,C]],F=(Je,Kt)=>Je+Kt[1]-Kt[0],U=A.reduce(F,0),K=z.reduce(F,0),W=b-U,ae=C-K;let ue=0,Fe=U,_e=0,Me=K,Ke=0,nt=W,Et=0,Qt=ae;if(g.content&&l){const Je=g.content,Kt=Je[2]-Je[0],qt=Je[3]-Je[1];(g.textFitWidth||g.textFitHeight)&&(P=_v(i)),ue=Qd(A,0,Je[0]),_e=Qd(z,0,Je[1]),Fe=Qd(A,Je[0],Je[2]),Me=Qd(z,Je[1],Je[3]),Ke=Je[0]-ue,Et=Je[1]-_e,nt=Kt-Fe,Qt=qt-Me}const It=P.x1,xt=P.y1,Gt=P.x2-It,Ft=P.y2-xt,Dt=(Je,Kt,qt,or)=>{const Qr=ep(Je.stretch-ue,Fe,Gt,It),Xr=tp(Je.fixed-Ke,nt,Je.stretch,U),Zn=ep(Kt.stretch-_e,Me,Ft,xt),us=tp(Kt.fixed-Et,Qt,Kt.stretch,K),gi=ep(qt.stretch-ue,Fe,Gt,It),Xn=tp(qt.fixed-Ke,nt,qt.stretch,U),Vi=ep(or.stretch-_e,Me,Ft,xt),$i=tp(or.fixed-Et,Qt,or.stretch,K),qi=new Q(Qr,Zn),Pn=new Q(gi,Zn),Yn=new Q(gi,Vi),Ii=new Q(Qr,Vi),yi=new Q(Xr/_,us/_),Gi=new Q(Xn/_,$i/_),_i=t*Math.PI/180;if(_i){const Nr=Math.sin(_i),tn=Math.cos(_i),hn=[tn,-Nr,Nr,tn];qi._matMult(hn),Pn._matMult(hn),Ii._matMult(hn),Yn._matMult(hn)}const ja=Je.stretch+Je.fixed,ia=Kt.stretch+Kt.fixed;return{tl:qi,tr:Pn,bl:Ii,br:Yn,tex:{x:g.paddedRect.x+pc+ja,y:g.paddedRect.y+pc+ia,w:qt.stretch+qt.fixed-ja,h:or.stretch+or.fixed-ia},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yi,pixelOffsetBR:Gi,minFontScaleX:nt/_/Gt,minFontScaleY:Qt/_/Ft,isSDF:a}};if(l&&(g.stretchX||g.stretchY)){const Je=Kv(A,W,U),Kt=Kv(z,ae,K);for(let qt=0;qt<Je.length-1;qt++){const or=Je[qt],Qr=Je[qt+1];for(let Xr=0;Xr<Kt.length-1;Xr++)p.push(Dt(or,Kt[Xr],Qr,Kt[Xr+1]))}}else p.push(Dt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:C+1}));return p}function Qd(i,t,a){let l=0;for(const p of i)l+=Math.max(t,Math.min(a,p[1]))-Math.max(t,Math.min(a,p[0]));return l}function Kv(i,t,a){const l=[{fixed:-pc,stretch:0}];for(const[p,g]of i){const _=l[l.length-1];l.push({fixed:p-_.stretch,stretch:_.stretch}),l.push({fixed:p-_.stretch,stretch:_.stretch+(g-p)})}return l.push({fixed:t+pc,stretch:a}),l}function ep(i,t,a,l){return i/t*a+l}function tp(i,t,a,l){return i-t*a/l}class rp{constructor(t,a,l,p,g,_,b,C,P,A){var z;if(this.boxStartIndex=t.length,P){let F=_.top,U=_.bottom;const K=_.collisionPadding;K&&(F-=K[1],U+=K[3]);let W=U-F;W>0&&(W=Math.max(10,W),this.circleDiameter=W)}else{const F=!((z=_.image)===null||z===void 0)&&z.content&&(_.image.textFitWidth||_.image.textFitHeight)?_v(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};F.y1=F.y1*b-C[0],F.y2=F.y2*b+C[2],F.x1=F.x1*b-C[3],F.x2=F.x2*b+C[1];const U=_.collisionPadding;if(U&&(F.x1-=U[0]*b,F.y1-=U[1]*b,F.x2+=U[2]*b,F.y2+=U[3]*b),A){const K=new Q(F.x1,F.y1),W=new Q(F.x2,F.y1),ae=new Q(F.x1,F.y2),ue=new Q(F.x2,F.y2),Fe=A*Math.PI/180;K._rotate(Fe),W._rotate(Fe),ae._rotate(Fe),ue._rotate(Fe),F.x1=Math.min(K.x,W.x,ae.x,ue.x),F.x2=Math.max(K.x,W.x,ae.x,ue.x),F.y1=Math.min(K.y,W.y,ae.y,ue.y),F.y2=Math.max(K.y,W.y,ae.y,ue.y)}t.emplaceBack(a.x,a.y,F.x1,F.y1,F.x2,F.y2,l,p,g)}this.boxEndIndex=t.length}}class Q2{constructor(t=[],a=(l,p)=>l<p?-1:l>p?1:0){if(this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:a,compare:l}=this,p=a[t];for(;t>0;){const g=t-1>>1,_=a[g];if(l(p,_)>=0)break;a[t]=_,t=g}a[t]=p}_down(t){const{data:a,compare:l}=this,p=this.length>>1,g=a[t];for(;t<p;){let _=1+(t<<1);const b=_+1;if(b<this.length&&l(a[b],a[_])<0&&(_=b),l(a[_],g)>=0)break;a[t]=a[_],t=_}a[t]=g}}function eS(i,t=1,a=!1){let l=1/0,p=1/0,g=-1/0,_=-1/0;const b=i[0];for(let U=0;U<b.length;U++){const K=b[U];(!U||K.x<l)&&(l=K.x),(!U||K.y<p)&&(p=K.y),(!U||K.x>g)&&(g=K.x),(!U||K.y>_)&&(_=K.y)}const C=Math.min(g-l,_-p);let P=C/2;const A=new Q2([],tS);if(C===0)return new Q(l,p);for(let U=l;U<g;U+=C)for(let K=p;K<_;K+=C)A.push(new fc(U+P,K+P,P,i));let z=function(U){let K=0,W=0,ae=0;const ue=U[0];for(let Fe=0,_e=ue.length,Me=_e-1;Fe<_e;Me=Fe++){const Ke=ue[Fe],nt=ue[Me],Et=Ke.x*nt.y-nt.x*Ke.y;W+=(Ke.x+nt.x)*Et,ae+=(Ke.y+nt.y)*Et,K+=3*Et}return new fc(W/K,ae/K,0,U)}(i),F=A.length;for(;A.length;){const U=A.pop();(U.d>z.d||!z.d)&&(z=U,a&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,F)),U.max-z.d<=t||(P=U.h/2,A.push(new fc(U.p.x-P,U.p.y-P,P,i)),A.push(new fc(U.p.x+P,U.p.y-P,P,i)),A.push(new fc(U.p.x-P,U.p.y+P,P,i)),A.push(new fc(U.p.x+P,U.p.y+P,P,i)),F+=4)}return a&&(console.log(`num probes: ${F}`),console.log(`best distance: ${z.d}`)),z.p}function tS(i,t){return t.max-i.max}function fc(i,t,a,l){this.p=new Q(i,t),this.h=a,this.d=function(p,g){let _=!1,b=1/0;for(let C=0;C<g.length;C++){const P=g[C];for(let A=0,z=P.length,F=z-1;A<z;F=A++){const U=P[A],K=P[F];U.y>p.y!=K.y>p.y&&p.x<(K.x-U.x)*(p.y-U.y)/(K.y-U.y)+U.x&&(_=!_),b=Math.min(b,E_(p,U,K))}}return(_?1:-1)*Math.sqrt(b)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}var mi;x.aq=void 0,(mi=x.aq||(x.aq={}))[mi.center=1]="center",mi[mi.left=2]="left",mi[mi.right=3]="right",mi[mi.top=4]="top",mi[mi.bottom=5]="bottom",mi[mi["top-left"]=6]="top-left",mi[mi["top-right"]=7]="top-right",mi[mi["bottom-left"]=8]="bottom-left",mi[mi["bottom-right"]=9]="bottom-right";const vl=7,Im=Number.POSITIVE_INFINITY;function Hv(i,t){return t[1]!==Im?function(a,l,p){let g=0,_=0;switch(l=Math.abs(l),p=Math.abs(p),a){case"top-right":case"top-left":case"top":_=p-vl;break;case"bottom-right":case"bottom-left":case"bottom":_=-p+vl}switch(a){case"top-right":case"bottom-right":case"right":g=-l;break;case"top-left":case"bottom-left":case"left":g=l}return[g,_]}(i,t[0],t[1]):function(a,l){let p=0,g=0;l<0&&(l=0);const _=l/Math.SQRT2;switch(a){case"top-right":case"top-left":g=_-vl;break;case"bottom-right":case"bottom-left":g=-_+vl;break;case"bottom":g=-l+vl;break;case"top":g=l-vl}switch(a){case"top-right":case"bottom-right":p=-_;break;case"top-left":case"bottom-left":p=_;break;case"left":p=l;break;case"right":p=-l}return[p,g]}(i,t[0])}function Wv(i,t,a){var l;const p=i.layout,g=(l=p.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(t,{},a);if(g){const b=g.values,C=[];for(let P=0;P<b.length;P+=2){const A=C[P]=b[P],z=b[P+1].map(F=>F*qn);A.startsWith("top")?z[1]-=vl:A.startsWith("bottom")&&(z[1]+=vl),C[P+1]=z}return new Bn(C)}const _=p.get("text-variable-anchor");if(_){let b;b=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(t,{},a)*qn,Im]:p.get("text-offset").evaluate(t,{},a).map(P=>P*qn);const C=[];for(const P of _)C.push(P,Hv(P,b));return new Bn(C)}return null}function Pm(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function rS(i,t,a,l,p,g,_,b,C,P,A){let z=g.textMaxSize.evaluate(t,{});z===void 0&&(z=_);const F=i.layers[0].layout,U=F.get("icon-offset").evaluate(t,{},A),K=Xv(a.horizontal),W=_/24,ae=i.tilePixelRatio*W,ue=i.tilePixelRatio*z/24,Fe=i.tilePixelRatio*b,_e=i.tilePixelRatio*F.get("symbol-spacing"),Me=F.get("text-padding")*i.tilePixelRatio,Ke=function(Je,Kt,qt,or=1){const Qr=Je.get("icon-padding").evaluate(Kt,{},qt),Xr=Qr&&Qr.values;return[Xr[0]*or,Xr[1]*or,Xr[2]*or,Xr[3]*or]}(F,t,A,i.tilePixelRatio),nt=F.get("text-max-angle")/180*Math.PI,Et=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",Qt=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",It=F.get("symbol-placement"),xt=_e/2,Gt=F.get("icon-text-fit");let Ft;l&&Gt!=="none"&&(i.allowVerticalPlacement&&a.vertical&&(Ft=vv(l,a.vertical,Gt,F.get("icon-text-fit-padding"),U,W)),K&&(l=vv(l,K,Gt,F.get("icon-text-fit-padding"),U,W)));const Dt=(Je,Kt)=>{Kt.x<0||Kt.x>=jn||Kt.y<0||Kt.y>=jn||function(qt,or,Qr,Xr,Zn,us,gi,Xn,Vi,$i,qi,Pn,Yn,Ii,yi,Gi,_i,ja,ia,Nr,tn,hn,wa,xn,mc){const to=qt.addToLineVertexArray(or,Qr);let ro,cs,Ua,oi,Mo=0,zh=0,e0=0,t0=0,Om=-1,Fm=-1;const Do={};let r0=tc("");if(qt.allowVerticalPlacement&&Xr.vertical){const Pi=Xn.layout.get("text-rotate").evaluate(tn,{},xn)+90;Ua=new rp(Vi,or,$i,qi,Pn,Xr.vertical,Yn,Ii,yi,Pi),gi&&(oi=new rp(Vi,or,$i,qi,Pn,gi,_i,ja,yi,Pi))}if(Zn){const Pi=Xn.layout.get("icon-rotate").evaluate(tn,{}),Va=Xn.layout.get("icon-text-fit")!=="none",pu=Gv(Zn,Pi,wa,Va),Ps=gi?Gv(gi,Pi,wa,Va):void 0;cs=new rp(Vi,or,$i,qi,Pn,Zn,_i,ja,!1,Pi),Mo=4*pu.length;const fu=qt.iconSizeData;let no=null;fu.kind==="source"?(no=[eo*Xn.layout.get("icon-size").evaluate(tn,{})],no[0]>gl&&Bt(`${qt.layerIds[0]}: Value for "icon-size" is >= ${Ph}. Reduce your "icon-size".`)):fu.kind==="composite"&&(no=[eo*hn.compositeIconSizes[0].evaluate(tn,{},xn),eo*hn.compositeIconSizes[1].evaluate(tn,{},xn)],(no[0]>gl||no[1]>gl)&&Bt(`${qt.layerIds[0]}: Value for "icon-size" is >= ${Ph}. Reduce your "icon-size".`)),qt.addSymbols(qt.icon,pu,no,Nr,ia,tn,x.ah.none,or,to.lineStartIndex,to.lineLength,-1,xn),Om=qt.icon.placedSymbolArray.length-1,Ps&&(zh=4*Ps.length,qt.addSymbols(qt.icon,Ps,no,Nr,ia,tn,x.ah.vertical,or,to.lineStartIndex,to.lineLength,-1,xn),Fm=qt.icon.placedSymbolArray.length-1)}const n0=Object.keys(Xr.horizontal);for(const Pi of n0){const Va=Xr.horizontal[Pi];if(!ro){r0=tc(Va.text);const Ps=Xn.layout.get("text-rotate").evaluate(tn,{},xn);ro=new rp(Vi,or,$i,qi,Pn,Va,Yn,Ii,yi,Ps)}const pu=Va.positionedLines.length===1;if(e0+=Zv(qt,or,Va,us,Xn,yi,tn,Gi,to,Xr.vertical?x.ah.horizontal:x.ah.horizontalOnly,pu?n0:[Pi],Do,Om,hn,xn),pu)break}Xr.vertical&&(t0+=Zv(qt,or,Xr.vertical,us,Xn,yi,tn,Gi,to,x.ah.vertical,["vertical"],Do,Fm,hn,xn));const aS=ro?ro.boxStartIndex:qt.collisionBoxArray.length,sS=ro?ro.boxEndIndex:qt.collisionBoxArray.length,oS=Ua?Ua.boxStartIndex:qt.collisionBoxArray.length,lS=Ua?Ua.boxEndIndex:qt.collisionBoxArray.length,uS=cs?cs.boxStartIndex:qt.collisionBoxArray.length,cS=cs?cs.boxEndIndex:qt.collisionBoxArray.length,hS=oi?oi.boxStartIndex:qt.collisionBoxArray.length,dS=oi?oi.boxEndIndex:qt.collisionBoxArray.length;let Is=-1;const ip=(Pi,Va)=>Pi&&Pi.circleDiameter?Math.max(Pi.circleDiameter,Va):Va;Is=ip(ro,Is),Is=ip(Ua,Is),Is=ip(cs,Is),Is=ip(oi,Is);const i0=Is>-1?1:0;i0&&(Is*=mc/qn),qt.glyphOffsetArray.length>=dc.MAX_GLYPHS&&Bt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tn.sortKey!==void 0&&qt.addToSortKeyRanges(qt.symbolInstances.length,tn.sortKey);const pS=Wv(Xn,tn,xn),[fS,mS]=function(Pi,Va){const pu=Pi.length,Ps=Va?.values;if(Ps?.length>0)for(let fu=0;fu<Ps.length;fu+=2){const no=Ps[fu+1];Pi.emplaceBack(x.aq[Ps[fu]],no[0],no[1])}return[pu,Pi.length]}(qt.textAnchorOffsets,pS);qt.symbolInstances.emplaceBack(or.x,or.y,Do.right>=0?Do.right:-1,Do.center>=0?Do.center:-1,Do.left>=0?Do.left:-1,Do.vertical||-1,Om,Fm,r0,aS,sS,oS,lS,uS,cS,hS,dS,$i,e0,t0,Mo,zh,i0,0,Yn,Is,fS,mS)}(i,Kt,Je,a,l,p,Ft,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,ae,[Me,Me,Me,Me],Et,C,Fe,Ke,Qt,U,t,g,P,A,_)};if(It==="line")for(const Je of Nv(t.geometry,0,0,jn,jn)){const Kt=J2(Je,_e,nt,a.vertical||K,l,24,ue,i.overscaling,jn);for(const qt of Kt)K&&nS(i,K.text,xt,qt)||Dt(Je,qt)}else if(It==="line-center"){for(const Je of t.geometry)if(Je.length>1){const Kt=Y2(Je,nt,a.vertical||K,l,24,ue);Kt&&Dt(Je,Kt)}}else if(t.type==="Polygon")for(const Je of vo(t.geometry,0)){const Kt=eS(Je,16);Dt(Je[0],new _l(Kt.x,Kt.y,0))}else if(t.type==="LineString")for(const Je of t.geometry)Dt(Je,new _l(Je[0].x,Je[0].y,0));else if(t.type==="Point")for(const Je of t.geometry)for(const Kt of Je)Dt([Kt],new _l(Kt.x,Kt.y,0))}function Zv(i,t,a,l,p,g,_,b,C,P,A,z,F,U,K){const W=function(Fe,_e,Me,Ke,nt,Et,Qt,It){const xt=Ke.layout.get("text-rotate").evaluate(Et,{})*Math.PI/180,Gt=[];for(const Ft of _e.positionedLines)for(const Dt of Ft.positionedGlyphs){if(!Dt.rect)continue;const Je=Dt.rect||{};let Kt=hv+1,qt=!0,or=1,Qr=0;const Xr=(nt||It)&&Dt.vertical,Zn=Dt.metrics.advance*Dt.scale/2;if(It&&_e.verticalizable&&(Qr=Ft.lineOffset/2-(Dt.imageName?-(qn-Dt.metrics.width*Dt.scale)/2:(Dt.scale-1)*qn)),Dt.imageName){const Nr=Qt[Dt.imageName];qt=Nr.sdf,or=Nr.pixelRatio,Kt=na/or}const us=nt?[Dt.x+Zn,Dt.y]:[0,0];let gi=nt?[0,0]:[Dt.x+Zn+Me[0],Dt.y+Me[1]-Qr],Xn=[0,0];Xr&&(Xn=gi,gi=[0,0]);const Vi=Dt.metrics.isDoubleResolution?2:1,$i=(Dt.metrics.left-Kt)*Dt.scale-Zn+gi[0],qi=(-Dt.metrics.top-Kt)*Dt.scale+gi[1],Pn=$i+Je.w/Vi*Dt.scale/or,Yn=qi+Je.h/Vi*Dt.scale/or,Ii=new Q($i,qi),yi=new Q(Pn,qi),Gi=new Q($i,Yn),_i=new Q(Pn,Yn);if(Xr){const Nr=new Q(-Zn,Zn-Th),tn=-Math.PI/2,hn=qn/2-Zn,wa=new Q(5-Th-hn,-(Dt.imageName?hn:0)),xn=new Q(...Xn);Ii._rotateAround(tn,Nr)._add(wa)._add(xn),yi._rotateAround(tn,Nr)._add(wa)._add(xn),Gi._rotateAround(tn,Nr)._add(wa)._add(xn),_i._rotateAround(tn,Nr)._add(wa)._add(xn)}if(xt){const Nr=Math.sin(xt),tn=Math.cos(xt),hn=[tn,-Nr,Nr,tn];Ii._matMult(hn),yi._matMult(hn),Gi._matMult(hn),_i._matMult(hn)}const ja=new Q(0,0),ia=new Q(0,0);Gt.push({tl:Ii,tr:yi,bl:Gi,br:_i,tex:Je,writingMode:_e.writingMode,glyphOffset:us,sectionIndex:Dt.sectionIndex,isSDF:qt,pixelOffsetTL:ja,pixelOffsetBR:ia,minFontScaleX:0,minFontScaleY:0})}return Gt}(0,a,b,p,g,_,l,i.allowVerticalPlacement),ae=i.textSizeData;let ue=null;ae.kind==="source"?(ue=[eo*p.layout.get("text-size").evaluate(_,{})],ue[0]>gl&&Bt(`${i.layerIds[0]}: Value for "text-size" is >= ${Ph}. Reduce your "text-size".`)):ae.kind==="composite"&&(ue=[eo*U.compositeTextSizes[0].evaluate(_,{},K),eo*U.compositeTextSizes[1].evaluate(_,{},K)],(ue[0]>gl||ue[1]>gl)&&Bt(`${i.layerIds[0]}: Value for "text-size" is >= ${Ph}. Reduce your "text-size".`)),i.addSymbols(i.text,W,ue,b,g,_,P,t,C.lineStartIndex,C.lineLength,F,K);for(const Fe of A)z[Fe]=i.text.placedSymbolArray.length-1;return 4*W.length}function Xv(i){for(const t in i)return i[t];return null}function nS(i,t,a,l){const p=i.compareText;if(t in p){const g=p[t];for(let _=g.length-1;_>=0;_--)if(l.dist(g[_])<a)return!0}else p[t]=[];return p[t].push(l),!1}const Yv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Em{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,l]=new Uint8Array(t,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=l>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const g=Yv[15&l];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[b]=new Uint32Array(t,4,1);return new Em(b,_,g,t)}constructor(t,a=64,l=Float64Array,p){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=Yv.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,b=t*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-b%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${l}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+C,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+b+C),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+C,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=t)}add(t,a){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=a,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Am(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,a,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:b}=this,C=[0,g.length-1,0],P=[];for(;C.length;){const A=C.pop()||0,z=C.pop()||0,F=C.pop()||0;if(z-F<=b){for(let ae=F;ae<=z;ae++){const ue=_[2*ae],Fe=_[2*ae+1];ue>=t&&ue<=l&&Fe>=a&&Fe<=p&&P.push(g[ae])}continue}const U=F+z>>1,K=_[2*U],W=_[2*U+1];K>=t&&K<=l&&W>=a&&W<=p&&P.push(g[U]),(A===0?t<=K:a<=W)&&(C.push(F),C.push(U-1),C.push(1-A)),(A===0?l>=K:p>=W)&&(C.push(U+1),C.push(z),C.push(1-A))}return P}within(t,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:_}=this,b=[0,p.length-1,0],C=[],P=l*l;for(;b.length;){const A=b.pop()||0,z=b.pop()||0,F=b.pop()||0;if(z-F<=_){for(let ae=F;ae<=z;ae++)Qv(g[2*ae],g[2*ae+1],t,a)<=P&&C.push(p[ae]);continue}const U=F+z>>1,K=g[2*U],W=g[2*U+1];Qv(K,W,t,a)<=P&&C.push(p[U]),(A===0?t-l<=K:a-l<=W)&&(b.push(F),b.push(U-1),b.push(1-A)),(A===0?t+l>=K:a+l>=W)&&(b.push(U+1),b.push(z),b.push(1-A))}return C}}function Am(i,t,a,l,p,g){if(p-l<=a)return;const _=l+p>>1;Jv(i,t,_,l,p,g),Am(i,t,a,l,_-1,1-g),Am(i,t,a,_+1,p,1-g)}function Jv(i,t,a,l,p,g){for(;p>l;){if(p-l>600){const P=p-l+1,A=a-l+1,z=Math.log(P),F=.5*Math.exp(2*z/3),U=.5*Math.sqrt(z*F*(P-F)/P)*(A-P/2<0?-1:1);Jv(i,t,a,Math.max(l,Math.floor(a-A*F/P+U)),Math.min(p,Math.floor(a+(P-A)*F/P+U)),g)}const _=t[2*a+g];let b=l,C=p;for(Mh(i,t,l,a),t[2*p+g]>_&&Mh(i,t,l,p);b<C;){for(Mh(i,t,b,C),b++,C--;t[2*b+g]<_;)b++;for(;t[2*C+g]>_;)C--}t[2*l+g]===_?Mh(i,t,l,C):(C++,Mh(i,t,C,p)),C<=a&&(l=C+1),a<=C&&(p=C-1)}}function Mh(i,t,a,l){Mm(i,a,l),Mm(t,2*a,2*l),Mm(t,2*a+1,2*l+1)}function Mm(i,t,a){const l=i[t];i[t]=i[a],i[a]=l}function Qv(i,t,a,l){const p=i-a,g=t-l;return p*p+g*g}var Dm;x.bg=void 0,(Dm=x.bg||(x.bg={})).create="create",Dm.load="load",Dm.fullLoad="fullLoad";let np=null,Dh=[];const zm=1e3/60,Lm="loadTime",Rm="fullLoadTime",iS={mark(i){performance.mark(i)},frame(i){const t=i;np!=null&&Dh.push(t-np),np=t},clearMetrics(){np=null,Dh=[],performance.clearMeasures(Lm),performance.clearMeasures(Rm);for(const i in x.bg)performance.clearMarks(x.bg[i])},getPerformanceMetrics(){performance.measure(Lm,x.bg.create,x.bg.load),performance.measure(Rm,x.bg.create,x.bg.fullLoad);const i=performance.getEntriesByName(Lm)[0].duration,t=performance.getEntriesByName(Rm)[0].duration,a=Dh.length,l=1/(Dh.reduce((g,_)=>g+_,0)/a/1e3),p=Dh.filter(g=>g>zm).reduce((g,_)=>g+(_-zm)/zm,0);return{loadTime:i,fullLoadTime:t,fps:l,percentDroppedFrames:p/(a+p)*100,totalFrames:a}}};x.$=class extends L{},x.A=sc,x.B=$f,x.C=function(i){if(Hr==null){const t=i.navigator?i.navigator.userAgent:null;Hr=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Hr},x.D=Vt,x.E=_r,x.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Z2(()=>this.process()),this.subscription=function(a,l,p,g){return a.addEventListener(l,p,!1),{unsubscribe:()=>{a.removeEventListener(l,p,!1)}}}(this.target,"message",a=>this.receive(a)),this.globalScope=Gr(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((a,l)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[p]={resolve:a,reject:l},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[p];const b={id:p,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(b)},{once:!0});const g=[],_=Object.assign(Object.assign({},i),{id:p,sourceMapId:this.mapId,origin:location.origin,data:il(i.data,g)});this.target.postMessage(_,{transfer:g})})}receive(i){const t=i.data,a=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[a];const l=this.abortControllers[a];return delete this.abortControllers[a],void(l&&l.abort())}if(Gr(self)||t.mustQueue)return this.tasks[a]=t,this.taskQueue.push(a),void this.invoker.trigger();this.processTask(a,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const p=this.resolveRejects[i];return delete this.resolveRejects[i],p?void(t.error?p.reject(al(t.error)):p.resolve(al(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const a=al(t.data),l=new AbortController;this.abortControllers[i]=l;try{const p=yield this.messageHandlers[t.type](t.sourceMapId,a,l);this.completeTask(i,null,p)}catch(p){this.completeTask(i,p)}})}completeTask(i,t,a){const l=[];delete this.abortControllers[i];const p={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?il(t):null,data:il(a,l)};this.target.postMessage(p,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},x.G=kr,x.H=function(){var i=new sc(16);return sc!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},x.I=gm,x.J=function(i,t,a){var l,p,g,_,b,C,P,A,z,F,U,K,W=a[0],ae=a[1],ue=a[2];return t===i?(i[12]=t[0]*W+t[4]*ae+t[8]*ue+t[12],i[13]=t[1]*W+t[5]*ae+t[9]*ue+t[13],i[14]=t[2]*W+t[6]*ae+t[10]*ue+t[14],i[15]=t[3]*W+t[7]*ae+t[11]*ue+t[15]):(p=t[1],g=t[2],_=t[3],b=t[4],C=t[5],P=t[6],A=t[7],z=t[8],F=t[9],U=t[10],K=t[11],i[0]=l=t[0],i[1]=p,i[2]=g,i[3]=_,i[4]=b,i[5]=C,i[6]=P,i[7]=A,i[8]=z,i[9]=F,i[10]=U,i[11]=K,i[12]=l*W+b*ae+z*ue+t[12],i[13]=p*W+C*ae+F*ue+t[13],i[14]=g*W+P*ae+U*ue+t[14],i[15]=_*W+A*ae+K*ue+t[15]),i},x.K=function(i,t,a){var l=a[0],p=a[1],g=a[2];return i[0]=t[0]*l,i[1]=t[1]*l,i[2]=t[2]*l,i[3]=t[3]*l,i[4]=t[4]*p,i[5]=t[5]*p,i[6]=t[6]*p,i[7]=t[7]*p,i[8]=t[8]*g,i[9]=t[9]*g,i[10]=t[10]*g,i[11]=t[11]*g,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},x.L=z_,x.M=function(i,t){const a={};for(let l=0;l<t.length;l++){const p=t[l];p in i&&(a[p]=i[p])}return a},x.N=yl,x.O=Pv,x.P=Q,x.Q=Ev,x.R=Ba,x.S=Na,x.T=Xu,x.U=re,x.V=J,x.W=it,x.X=jn,x.Y=S,x.Z=Eh,x._=c,x.a=Sr,x.a$=function(i,t){var a=i[0],l=i[1],p=i[2],g=i[3],_=i[4],b=i[5],C=i[6],P=i[7],A=i[8],z=i[9],F=i[10],U=i[11],K=i[12],W=i[13],ae=i[14],ue=i[15],Fe=t[0],_e=t[1],Me=t[2],Ke=t[3],nt=t[4],Et=t[5],Qt=t[6],It=t[7],xt=t[8],Gt=t[9],Ft=t[10],Dt=t[11],Je=t[12],Kt=t[13],qt=t[14],or=t[15];return Math.abs(a-Fe)<=Ui*Math.max(1,Math.abs(a),Math.abs(Fe))&&Math.abs(l-_e)<=Ui*Math.max(1,Math.abs(l),Math.abs(_e))&&Math.abs(p-Me)<=Ui*Math.max(1,Math.abs(p),Math.abs(Me))&&Math.abs(g-Ke)<=Ui*Math.max(1,Math.abs(g),Math.abs(Ke))&&Math.abs(_-nt)<=Ui*Math.max(1,Math.abs(_),Math.abs(nt))&&Math.abs(b-Et)<=Ui*Math.max(1,Math.abs(b),Math.abs(Et))&&Math.abs(C-Qt)<=Ui*Math.max(1,Math.abs(C),Math.abs(Qt))&&Math.abs(P-It)<=Ui*Math.max(1,Math.abs(P),Math.abs(It))&&Math.abs(A-xt)<=Ui*Math.max(1,Math.abs(A),Math.abs(xt))&&Math.abs(z-Gt)<=Ui*Math.max(1,Math.abs(z),Math.abs(Gt))&&Math.abs(F-Ft)<=Ui*Math.max(1,Math.abs(F),Math.abs(Ft))&&Math.abs(U-Dt)<=Ui*Math.max(1,Math.abs(U),Math.abs(Dt))&&Math.abs(K-Je)<=Ui*Math.max(1,Math.abs(K),Math.abs(Je))&&Math.abs(W-Kt)<=Ui*Math.max(1,Math.abs(W),Math.abs(Kt))&&Math.abs(ae-qt)<=Ui*Math.max(1,Math.abs(ae),Math.abs(qt))&&Math.abs(ue-or)<=Ui*Math.max(1,Math.abs(ue),Math.abs(or))},x.a0=Ar,x.a1=Tm,x.a2=rt,x.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(a=>{t.onloadstart=()=>{a(t)};for(const l of i){const p=window.document.createElement("source");Ht(l)||(t.crossOrigin="Anonymous"),p.src=l,t.appendChild(p)}})},x.a4=function(){return fe++},x.a5=Pt,x.a6=dc,x.a7=Ye,x.a8=hu,x.a9=Rv,x.aA=function(i){if(i.type==="custom")return new W2(i);switch(i.type){case"background":return new G2(i);case"circle":return new Dw(i);case"fill":return new Zw(i);case"fill-extrusion":return new c2(i);case"heatmap":return new Lw(i);case"hillshade":return new Ow(i);case"line":return new _2(i);case"raster":return new H2(i);case"symbol":return new Jd(i)}},x.aB=tt,x.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let a=[];try{if(!Jt(i.version,t.version))return[{command:"setStyle",args:[t]}];Jt(i.center,t.center)||a.push({command:"setCenter",args:[t.center]}),Jt(i.zoom,t.zoom)||a.push({command:"setZoom",args:[t.zoom]}),Jt(i.bearing,t.bearing)||a.push({command:"setBearing",args:[t.bearing]}),Jt(i.pitch,t.pitch)||a.push({command:"setPitch",args:[t.pitch]}),Jt(i.sprite,t.sprite)||a.push({command:"setSprite",args:[t.sprite]}),Jt(i.glyphs,t.glyphs)||a.push({command:"setGlyphs",args:[t.glyphs]}),Jt(i.transition,t.transition)||a.push({command:"setTransition",args:[t.transition]}),Jt(i.light,t.light)||a.push({command:"setLight",args:[t.light]}),Jt(i.terrain,t.terrain)||a.push({command:"setTerrain",args:[t.terrain]}),Jt(i.sky,t.sky)||a.push({command:"setSky",args:[t.sky]}),Jt(i.projection,t.projection)||a.push({command:"setProjection",args:[t.projection]});const l={},p=[];(function(_,b,C,P){let A;for(A in b=b||{},_=_||{})Object.prototype.hasOwnProperty.call(_,A)&&(Object.prototype.hasOwnProperty.call(b,A)||Sn(A,C,P));for(A in b)Object.prototype.hasOwnProperty.call(b,A)&&(Object.prototype.hasOwnProperty.call(_,A)?Jt(_[A],b[A])||(_[A].type==="geojson"&&b[A].type==="geojson"&&an(_,b,A)?pr(C,{command:"setGeoJSONSourceData",args:[A,b[A].data]}):An(A,b,C,P)):_n(A,b,C))})(i.sources,t.sources,p,l);const g=[];i.layers&&i.layers.forEach(_=>{"source"in _&&l[_.source]?a.push({command:"removeLayer",args:[_.id]}):g.push(_)}),a=a.concat(p),function(_,b,C){b=b||[];const P=(_=_||[]).map(Vr),A=b.map(Vr),z=_.reduce(Yr,{}),F=b.reduce(Yr,{}),U=P.slice(),K=Object.create(null);let W,ae,ue,Fe,_e;for(let Me=0,Ke=0;Me<P.length;Me++)W=P[Me],Object.prototype.hasOwnProperty.call(F,W)?Ke++:(pr(C,{command:"removeLayer",args:[W]}),U.splice(U.indexOf(W,Ke),1));for(let Me=0,Ke=0;Me<A.length;Me++)W=A[A.length-1-Me],U[U.length-1-Me]!==W&&(Object.prototype.hasOwnProperty.call(z,W)?(pr(C,{command:"removeLayer",args:[W]}),U.splice(U.lastIndexOf(W,U.length-Ke),1)):Ke++,Fe=U[U.length-Me],pr(C,{command:"addLayer",args:[F[W],Fe]}),U.splice(U.length-Me,0,W),K[W]=!0);for(let Me=0;Me<A.length;Me++)if(W=A[Me],ae=z[W],ue=F[W],!K[W]&&!Jt(ae,ue))if(Jt(ae.source,ue.source)&&Jt(ae["source-layer"],ue["source-layer"])&&Jt(ae.type,ue.type)){for(_e in Wr(ae.layout,ue.layout,C,W,null,"setLayoutProperty"),Wr(ae.paint,ue.paint,C,W,null,"setPaintProperty"),Jt(ae.filter,ue.filter)||pr(C,{command:"setFilter",args:[W,ue.filter]}),Jt(ae.minzoom,ue.minzoom)&&Jt(ae.maxzoom,ue.maxzoom)||pr(C,{command:"setLayerZoomRange",args:[W,ue.minzoom,ue.maxzoom]}),ae)Object.prototype.hasOwnProperty.call(ae,_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&(_e.indexOf("paint.")===0?Wr(ae[_e],ue[_e],C,W,_e.slice(6),"setPaintProperty"):Jt(ae[_e],ue[_e])||pr(C,{command:"setLayerProperty",args:[W,_e,ue[_e]]}));for(_e in ue)Object.prototype.hasOwnProperty.call(ue,_e)&&!Object.prototype.hasOwnProperty.call(ae,_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&(_e.indexOf("paint.")===0?Wr(ae[_e],ue[_e],C,W,_e.slice(6),"setPaintProperty"):Jt(ae[_e],ue[_e])||pr(C,{command:"setLayerProperty",args:[W,_e,ue[_e]]}))}else pr(C,{command:"removeLayer",args:[W]}),Fe=U[U.lastIndexOf(W)+1],pr(C,{command:"addLayer",args:[ue,Fe]})}(g,t.layers,a)}catch(l){console.warn("Unable to compute style diff:",l),a=[{command:"setStyle",args:[t]}]}return a},x.aD=function(i){const t=[],a=i.id;return a===void 0&&t.push({message:`layers.${a}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${a}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),t},x.aE=function i(t,a){if(Array.isArray(t)){if(!Array.isArray(a)||t.length!==a.length)return!1;for(let l=0;l<t.length;l++)if(!i(t[l],a[l]))return!1;return!0}if(typeof t=="object"&&t!==null&&a!==null){if(typeof a!="object"||Object.keys(t).length!==Object.keys(a).length)return!1;for(const l in t)if(!i(t[l],a[l]))return!1;return!0}return t===a},x.aF=ve,x.aG=je,x.aH=class extends lu{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},x.aI=Nd,x.aJ=class extends lu{constructor(i,t){super(i,t),this.current=kw}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},x.aK=w_,x.aL=S_,x.aM=Cr,x.aN=class extends lu{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},x.aO=class extends lu{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},x.aP=function(i,t,a,l,p,g,_){var b=1/(t-a),C=1/(l-p),P=1/(g-_);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*C,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*P,i[11]=0,i[12]=(t+a)*b,i[13]=(p+l)*C,i[14]=(_+g)*P,i[15]=1,i},x.aQ=Mw,x.aR=class extends Te{},x.aS=w2,x.aT=class extends Ne{},x.aU=im,x.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},x.aW=B_,x.aX=pi,x.aY=Fa,x.aZ=class extends $t{},x.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},x.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,l,p,g)=>{const _=p||g;return t[l]=!_||_.toLowerCase(),""}),t["max-age"]){const a=parseInt(t["max-age"],10);isNaN(a)?delete t["max-age"]:t["max-age"]=a}return t},x.ab=function(i,t){const a=[];for(const l in i)l in t||a.push(l);return a},x.ac=Ze,x.ad=function(i,t,a){var l=Math.sin(a),p=Math.cos(a),g=t[0],_=t[1],b=t[2],C=t[3],P=t[4],A=t[5],z=t[6],F=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=g*p+P*l,i[1]=_*p+A*l,i[2]=b*p+z*l,i[3]=C*p+F*l,i[4]=P*p-g*l,i[5]=A*p-_*l,i[6]=z*p-b*l,i[7]=F*p-C*l,i},x.ae=function(i){var t=new sc(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},x.af=$d,x.ag=function(i,t){let a=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:g,maxZoom:_}=i,b=p?Ze(ii.interpolationFactor(p,t,g,_),0,1):0;i.kind==="camera"?l=ni.number(i.minSize,i.maxSize,b):a=b}return{uSizeT:a,uSize:l}},x.ai=function(i,{uSize:t,uSizeT:a},{lowerSize:l,upperSize:p}){return i.kind==="source"?l/eo:i.kind==="composite"?ni.number(l/eo,p/eo,a):t},x.aj=xm,x.ak=function(i,t,a,l){const p=t.y-i.y,g=t.x-i.x,_=l.y-a.y,b=l.x-a.x,C=_*g-b*p;if(C===0)return null;const P=(b*(i.y-a.y)-_*(i.x-a.x))/C;return new Q(i.x+P*g,i.y+P*p)},x.al=Nv,x.am=I_,x.an=tm,x.ao=function(i){let t=1/0,a=1/0,l=-1/0,p=-1/0;for(const g of i)t=Math.min(t,g.x),a=Math.min(a,g.y),l=Math.max(l,g.x),p=Math.max(p,g.y);return[t,a,l,p]},x.ap=qn,x.ar=vm,x.as=function(i,t){var a=t[0],l=t[1],p=t[2],g=t[3],_=t[4],b=t[5],C=t[6],P=t[7],A=t[8],z=t[9],F=t[10],U=t[11],K=t[12],W=t[13],ae=t[14],ue=t[15],Fe=a*b-l*_,_e=a*C-p*_,Me=a*P-g*_,Ke=l*C-p*b,nt=l*P-g*b,Et=p*P-g*C,Qt=A*W-z*K,It=A*ae-F*K,xt=A*ue-U*K,Gt=z*ae-F*W,Ft=z*ue-U*W,Dt=F*ue-U*ae,Je=Fe*Dt-_e*Ft+Me*Gt+Ke*xt-nt*It+Et*Qt;return Je?(i[0]=(b*Dt-C*Ft+P*Gt)*(Je=1/Je),i[1]=(p*Ft-l*Dt-g*Gt)*Je,i[2]=(W*Et-ae*nt+ue*Ke)*Je,i[3]=(F*nt-z*Et-U*Ke)*Je,i[4]=(C*xt-_*Dt-P*It)*Je,i[5]=(a*Dt-p*xt+g*It)*Je,i[6]=(ae*Me-K*Et-ue*_e)*Je,i[7]=(A*Et-F*Me+U*_e)*Je,i[8]=(_*Ft-b*xt+P*Qt)*Je,i[9]=(l*xt-a*Ft-g*Qt)*Je,i[10]=(K*nt-W*Me+ue*Fe)*Je,i[11]=(z*Me-A*nt-U*Fe)*Je,i[12]=(b*It-_*Gt-C*Qt)*Je,i[13]=(a*Gt-l*It+p*Qt)*Je,i[14]=(W*_e-K*Ke-ae*Fe)*Je,i[15]=(A*Ke-z*_e+F*Fe)*Je,i):null},x.at=Pm,x.au=_m,x.av=Em,x.aw=function(){const i={},t=Ee.$version;for(const a in Ee.$root){const l=Ee.$root[a];if(l.required){let p=null;p=a==="version"?t:l.type==="array"?[]:{},p!=null&&(i[a]=p)}}return i},x.ax=uh,x.ay=lr,x.az=function(i){i=i.slice();const t=Object.create(null);for(let a=0;a<i.length;a++)t[i[a].id]=i[a];for(let a=0;a<i.length;a++)"ref"in i[a]&&(i[a]=Pr(i[a],t[i[a].ref]));return i},x.b=ar,x.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},x.b1=function(i,t,a){return i[0]=t[0]*a[0],i[1]=t[1]*a[1],i[2]=t[2]*a[2],i[3]=t[3]*a[3],i},x.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},x.b3=He,x.b4=Dv,x.b5=Av,x.b6=function(i,t,a,l,p){var g,_=1/Math.tan(t/2);return i[0]=_/a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0?(i[10]=(p+l)*(g=1/(l-p)),i[14]=2*p*l*g):(i[10]=-1,i[14]=-2*l),i},x.b7=function(i,t,a){var l=Math.sin(a),p=Math.cos(a),g=t[4],_=t[5],b=t[6],C=t[7],P=t[8],A=t[9],z=t[10],F=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=g*p+P*l,i[5]=_*p+A*l,i[6]=b*p+z*l,i[7]=C*p+F*l,i[8]=P*p-g*l,i[9]=A*p-_*l,i[10]=z*p-b*l,i[11]=F*p-C*l,i},x.b8=le,x.b9=we,x.bA=iv,x.bB=function(i){return i.message===jt},x.bC=me,x.bD=ta,x.ba=function(i){return i*Math.PI/180},x.bb=function(i,t){const{x:a,y:l}=Eh.fromLngLat(t);return!(i<0||i>25||l<0||l>=1||a<0||a>=1)},x.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},x.bd=class extends M{},x.be=km,x.bf=iS,x.bh=Mr,x.bi=function(i,t){Sr.REGISTERED_PROTOCOLS[i]=t},x.bj=function(i){delete Sr.REGISTERED_PROTOCOLS[i]},x.bk=function(i,t){const a={};for(let p=0;p<i.length;p++){const g=t&&t[i[p].id]||mr(i[p]);t&&(t[i[p].id]=g);let _=a[g];_||(_=a[g]=[]),_.push(i[p])}const l=[];for(const p in a)l.push(a[p]);return l},x.bl=Rt,x.bm=Lv,x.bn=Ov,x.bo=pv,x.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=jn/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],a=t.layout,l=t._unevaluatedLayout._values,p={layoutIconSize:l["icon-size"].possiblyEvaluate(new on(i.bucket.zoom+1),i.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new on(i.bucket.zoom+1),i.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new on(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:A}=i.bucket.textSizeData;p.compositeTextSizes=[l["text-size"].possiblyEvaluate(new on(P),i.canonical),l["text-size"].possiblyEvaluate(new on(A),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:A}=i.bucket.iconSizeData;p.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new on(P),i.canonical),l["icon-size"].possiblyEvaluate(new on(A),i.canonical)]}const g=a.get("text-line-height")*qn,_=a.get("text-rotation-alignment")!=="viewport"&&a.get("symbol-placement")!=="point",b=a.get("text-keep-upright"),C=a.get("text-size");for(const P of i.bucket.features){const A=a.get("text-font").evaluate(P,{},i.canonical).join(","),z=C.evaluate(P,{},i.canonical),F=p.layoutTextSize.evaluate(P,{},i.canonical),U=p.layoutIconSize.evaluate(P,{},i.canonical),K={horizontal:{},vertical:void 0},W=P.text;let ae,ue=[0,0];if(W){const Me=W.toString(),Ke=a.get("text-letter-spacing").evaluate(P,{},i.canonical)*qn,nt=qf(Me)?Ke:0,Et=a.get("text-anchor").evaluate(P,{},i.canonical),Qt=Wv(t,P,i.canonical);if(!Qt){const Ft=a.get("text-radial-offset").evaluate(P,{},i.canonical);ue=Ft?Hv(Et,[Ft*qn,Im]):a.get("text-offset").evaluate(P,{},i.canonical).map(Dt=>Dt*qn)}let It=_?"center":a.get("text-justify").evaluate(P,{},i.canonical);const xt=a.get("symbol-placement")==="point"?a.get("text-max-width").evaluate(P,{},i.canonical)*qn:1/0,Gt=()=>{i.bucket.allowVerticalPlacement&&ch(Me)&&(K.vertical=Zd(W,i.glyphMap,i.glyphPositions,i.imagePositions,A,xt,g,Et,"left",nt,ue,x.ah.vertical,!0,F,z))};if(!_&&Qt){const Ft=new Set;if(It==="auto")for(let Je=0;Je<Qt.values.length;Je+=2)Ft.add(Pm(Qt.values[Je]));else Ft.add(It);let Dt=!1;for(const Je of Ft)if(!K.horizontal[Je])if(Dt)K.horizontal[Je]=K.horizontal[0];else{const Kt=Zd(W,i.glyphMap,i.glyphPositions,i.imagePositions,A,xt,g,"center",Je,nt,ue,x.ah.horizontal,!1,F,z);Kt&&(K.horizontal[Je]=Kt,Dt=Kt.positionedLines.length===1)}Gt()}else{It==="auto"&&(It=Pm(Et));const Ft=Zd(W,i.glyphMap,i.glyphPositions,i.imagePositions,A,xt,g,Et,It,nt,ue,x.ah.horizontal,!1,F,z);Ft&&(K.horizontal[It]=Ft),Gt(),ch(Me)&&_&&b&&(K.vertical=Zd(W,i.glyphMap,i.glyphPositions,i.imagePositions,A,xt,g,Et,It,nt,ue,x.ah.vertical,!1,F,z))}}let Fe=!1;if(P.icon&&P.icon.name){const Me=i.imageMap[P.icon.name];Me&&(ae=j2(i.imagePositions[P.icon.name],a.get("icon-offset").evaluate(P,{},i.canonical),a.get("icon-anchor").evaluate(P,{},i.canonical)),Fe=!!Me.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Fe:i.bucket.sdfIcons!==Fe&&Bt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Me.pixelRatio!==i.bucket.pixelRatio||a.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const _e=Xv(K.horizontal)||K.vertical;i.bucket.iconsInText=!!_e&&_e.iconsInText,(_e||ae)&&rS(i.bucket,P,K,ae,i.imageMap,p,F,U,ue,Fe,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},x.bq=dm,x.br=um,x.bs=hm,x.bt=fl,x.bu=fm,x.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},x.bw=function(i,t,a,l,p){return c(this,void 0,void 0,function*(){if(J())try{return yield it(i,t,a,l,p)}catch{}return function(g,_,b,C,P){const A=g.width,z=g.height;Mt&&Tt||(Mt=new OffscreenCanvas(A,z),Tt=Mt.getContext("2d",{willReadFrequently:!0})),Mt.width=A,Mt.height=z,Tt.drawImage(g,0,0,A,z);const F=Tt.getImageData(_,b,C,P);return Tt.clearRect(0,0,A,z),F.data}(i,t,a,l,p)})},x.bx=zv,x.by=V,x.bz=G,x.c=zt,x.d=i=>c(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(a){throw new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),x.e=Xe,x.f=i=>new Promise((t,a)=>{const l=new Image;l.onload=()=>{t(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame(()=>{l.src=at})},l.onerror=()=>a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(i)],{type:"image/png"});l.src=i.byteLength?URL.createObjectURL(p):at}),x.g=br,x.h=(i,t)=>ct(Xe(i,{type:"json"}),t),x.i=Gr,x.j=Dr,x.k=Ir,x.l=(i,t)=>ct(Xe(i,{type:"arrayBuffer"}),t),x.m=ct,x.n=function(i){return new fm(i).readFields(z2,[])},x.o=vh,x.p=dv,x.q=m,x.r=Vf,x.s=Ht,x.t=oh,x.u=Io,x.v=Ee,x.w=Bt,x.x=function([i,t,a]){return t+=90,t*=Math.PI/180,a*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(a),y:i*Math.sin(t)*Math.sin(a),z:i*Math.cos(a)}},x.y=ni,x.z=on}),y("worker",["./shared"],function(x){class c{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,N){for(const ie of j){this._layerConfigs[ie.id]=ie;const ye=this._layers[ie.id]=x.aA(ie);ye._featureFilter=x.a7(ye.filter),this.keyCache[ie.id]&&delete this.keyCache[ie.id]}for(const ie of N)delete this.keyCache[ie],delete this._layerConfigs[ie],delete this._layers[ie];this.familiesBySource={};const Z=x.bk(Object.values(this._layerConfigs),this.keyCache);for(const ie of Z){const ye=ie.map(qe=>this._layers[qe.id]),Se=ye[0];if(Se.visibility==="none")continue;const ze=Se.source||"";let pe=this.familiesBySource[ze];pe||(pe=this.familiesBySource[ze]={});const Ue=Se.sourceLayer||"_geojsonTileLayer";let We=pe[Ue];We||(We=pe[Ue]=[]),We.push(ye)}}}class V{constructor(j){const N={},Z=[];for(const ze in j){const pe=j[ze],Ue=N[ze]={};for(const We in pe){const qe=pe[+We];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const ht={x:0,y:0,w:qe.bitmap.width+2,h:qe.bitmap.height+2};Z.push(ht),Ue[We]={rect:ht,metrics:qe.metrics}}}const{w:ie,h:ye}=x.p(Z),Se=new x.o({width:ie||1,height:ye||1});for(const ze in j){const pe=j[ze];for(const Ue in pe){const We=pe[+Ue];if(!We||We.bitmap.width===0||We.bitmap.height===0)continue;const qe=N[ze][Ue].rect;x.o.copy(We.bitmap,Se,{x:0,y:0},{x:qe.x+1,y:qe.y+1},We.bitmap)}}this.image=Se,this.positions=N}}x.bl("GlyphAtlas",V);class G{constructor(j){this.tileID=new x.S(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,N,Z,ie){return x._(this,void 0,void 0,function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new x.a5;const ye=new x.bm(Object.keys(j.layers).sort()),Se=new x.bn(this.tileID,this.promoteId);Se.bucketLayerIDs=[];const ze={},pe={featureIndex:Se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Z},Ue=N.familiesBySource[this.source];for(const ur in Ue){const jr=j.layers[ur];if(!jr)continue;jr.version===1&&x.w(`Vector tile source "${this.source}" layer "${ur}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ur=ye.encode(ur),Mn=[];for(let Dn=0;Dn<jr.length;Dn++){const Lr=jr.feature(Dn),zi=Se.getId(Lr,ur);Mn.push({feature:Lr,id:zi,index:Dn,sourceLayerIndex:Ur})}for(const Dn of Ue[ur]){const Lr=Dn[0];Lr.source!==this.source&&x.w(`layer.source = ${Lr.source} does not equal this.source = ${this.source}`),Lr.minzoom&&this.zoom<Math.floor(Lr.minzoom)||Lr.maxzoom&&this.zoom>=Lr.maxzoom||Lr.visibility!=="none"&&(Y(Dn,this.zoom,Z),(ze[Lr.id]=Lr.createBucket({index:Se.bucketLayerIDs.length,layers:Dn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ur,sourceID:this.source})).populate(Mn,pe,this.tileID.canonical),Se.bucketLayerIDs.push(Dn.map(zi=>zi.id)))}}const We=x.aF(pe.glyphDependencies,ur=>Object.keys(ur).map(Number));this.inFlightDependencies.forEach(ur=>ur?.abort()),this.inFlightDependencies=[];let qe=Promise.resolve({});if(Object.keys(We).length){const ur=new AbortController;this.inFlightDependencies.push(ur),qe=ie.sendAsync({type:"GG",data:{stacks:We,source:this.source,tileID:this.tileID,type:"glyphs"}},ur)}const ht=Object.keys(pe.iconDependencies);let Ut=Promise.resolve({});if(ht.length){const ur=new AbortController;this.inFlightDependencies.push(ur),Ut=ie.sendAsync({type:"GI",data:{icons:ht,source:this.source,tileID:this.tileID,type:"icons"}},ur)}const Wt=Object.keys(pe.patternDependencies);let zr=Promise.resolve({});if(Wt.length){const ur=new AbortController;this.inFlightDependencies.push(ur),zr=ie.sendAsync({type:"GI",data:{icons:Wt,source:this.source,tileID:this.tileID,type:"patterns"}},ur)}const[nr,wr,dr]=yield Promise.all([qe,Ut,zr]),dn=new V(nr),pn=new x.bo(wr,dr);for(const ur in ze){const jr=ze[ur];jr instanceof x.a6?(Y(jr.layers,this.zoom,Z),x.bp({bucket:jr,glyphMap:nr,glyphPositions:dn.positions,imageMap:wr,imagePositions:pn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):jr.hasPattern&&(jr instanceof x.bq||jr instanceof x.br||jr instanceof x.bs)&&(Y(jr.layers,this.zoom,Z),jr.addFeatures(pe,this.tileID.canonical,pn.patternPositions))}return this.status="done",{buckets:Object.values(ze).filter(ur=>!ur.isEmpty()),featureIndex:Se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:dn.image,imageAtlas:pn,glyphMap:this.returnDependencies?nr:null,iconMap:this.returnDependencies?wr:null,glyphPositions:this.returnDependencies?dn.positions:null}})}}function Y(oe,j,N){const Z=new x.z(j);for(const ie of oe)ie.recalculate(Z,N)}class Q{constructor(j,N,Z){this.actor=j,this.layerIndex=N,this.availableImages=Z,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(j,N){return x._(this,void 0,void 0,function*(){const Z=yield x.l(j.request,N);try{return{vectorTile:new x.bt.VectorTile(new x.bu(Z.data)),rawData:Z.data,cacheControl:Z.cacheControl,expires:Z.expires}}catch(ie){const ye=new Uint8Array(Z.data);let Se=`Unable to parse the tile at ${j.request.url}, `;throw Se+=ye[0]===31&&ye[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ie.message}`,new Error(Se)}})}loadTile(j){return x._(this,void 0,void 0,function*(){const N=j.uid,Z=!!(j&&j.request&&j.request.collectResourceTiming)&&new x.bv(j.request),ie=new G(j);this.loading[N]=ie;const ye=new AbortController;ie.abort=ye;try{const Se=yield this.loadVectorTile(j,ye);if(delete this.loading[N],!Se)return null;const ze=Se.rawData,pe={};Se.expires&&(pe.expires=Se.expires),Se.cacheControl&&(pe.cacheControl=Se.cacheControl);const Ue={};if(Z){const qe=Z.finish();qe&&(Ue.resourceTiming=JSON.parse(JSON.stringify(qe)))}ie.vectorTile=Se.vectorTile;const We=ie.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[N]=ie,this.fetching[N]={rawTileData:ze,cacheControl:pe,resourceTiming:Ue};try{const qe=yield We;return x.e({rawTileData:ze.slice(0)},qe,pe,Ue)}finally{delete this.fetching[N]}}catch(Se){throw delete this.loading[N],ie.status="done",this.loaded[N]=ie,Se}})}reloadTile(j){return x._(this,void 0,void 0,function*(){const N=j.uid;if(!this.loaded||!this.loaded[N])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Z=this.loaded[N];if(Z.showCollisionBoxes=j.showCollisionBoxes,Z.status==="parsing"){const ie=yield Z.parse(Z.vectorTile,this.layerIndex,this.availableImages,this.actor);let ye;if(this.fetching[N]){const{rawTileData:Se,cacheControl:ze,resourceTiming:pe}=this.fetching[N];delete this.fetching[N],ye=x.e({rawTileData:Se.slice(0)},ie,ze,pe)}else ye=ie;return ye}if(Z.status==="done"&&Z.vectorTile)return Z.parse(Z.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(j){return x._(this,void 0,void 0,function*(){const N=this.loading,Z=j.uid;N&&N[Z]&&N[Z].abort&&(N[Z].abort.abort(),delete N[Z])})}removeTile(j){return x._(this,void 0,void 0,function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]})}}class H{constructor(){this.loaded={}}loadTile(j){return x._(this,void 0,void 0,function*(){const{uid:N,encoding:Z,rawImageData:ie,redFactor:ye,greenFactor:Se,blueFactor:ze,baseShift:pe}=j,Ue=ie.width+2,We=ie.height+2,qe=x.b(ie)?new x.R({width:Ue,height:We},yield x.bw(ie,-1,-1,Ue,We)):ie,ht=new x.bx(N,qe,Z,ye,Se,ze,pe);return this.loaded=this.loaded||{},this.loaded[N]=ht,ht})}removeTile(j){const N=this.loaded,Z=j.uid;N&&N[Z]&&delete N[Z]}}function Le(oe,j){if(oe.length!==0){Be(oe[0],j);for(var N=1;N<oe.length;N++)Be(oe[N],!j)}}function Be(oe,j){for(var N=0,Z=0,ie=0,ye=oe.length,Se=ye-1;ie<ye;Se=ie++){var ze=(oe[ie][0]-oe[Se][0])*(oe[Se][1]+oe[ie][1]),pe=N+ze;Z+=Math.abs(N)>=Math.abs(ze)?N-pe+ze:ze-pe+N,N=pe}N+Z>=0!=!!j&&oe.reverse()}var be=x.by(function oe(j,N){var Z,ie=j&&j.type;if(ie==="FeatureCollection")for(Z=0;Z<j.features.length;Z++)oe(j.features[Z],N);else if(ie==="GeometryCollection")for(Z=0;Z<j.geometries.length;Z++)oe(j.geometries[Z],N);else if(ie==="Feature")oe(j.geometry,N);else if(ie==="Polygon")Le(j.coordinates,N);else if(ie==="MultiPolygon")for(Z=0;Z<j.coordinates.length;Z++)Le(j.coordinates[Z],N);return j});const $e=x.bt.VectorTileFeature.prototype.toGeoJSON;var re={exports:{}},J=x.bz,le=x.bt.VectorTileFeature,we=Ze;function Ze(oe,j){this.options=j||{},this.features=oe,this.length=oe.length}function He(oe,j){this.id=typeof oe.id=="number"?oe.id:void 0,this.type=oe.type,this.rawGeometry=oe.type===1?[oe.geometry]:oe.geometry,this.properties=oe.tags,this.extent=j||4096}Ze.prototype.feature=function(oe){return new He(this.features[oe],this.options.extent)},He.prototype.loadGeometry=function(){var oe=this.rawGeometry;this.geometry=[];for(var j=0;j<oe.length;j++){for(var N=oe[j],Z=[],ie=0;ie<N.length;ie++)Z.push(new J(N[ie][0],N[ie][1]));this.geometry.push(Z)}return this.geometry},He.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var oe=this.geometry,j=1/0,N=-1/0,Z=1/0,ie=-1/0,ye=0;ye<oe.length;ye++)for(var Se=oe[ye],ze=0;ze<Se.length;ze++){var pe=Se[ze];j=Math.min(j,pe.x),N=Math.max(N,pe.x),Z=Math.min(Z,pe.y),ie=Math.max(ie,pe.y)}return[j,Z,N,ie]},He.prototype.toGeoJSON=le.prototype.toGeoJSON;var Xe=x.bA,fe=we;function ve(oe){var j=new Xe;return function(N,Z){for(var ie in N.layers)Z.writeMessage(3,je,N.layers[ie])}(oe,j),j.finish()}function je(oe,j){var N;j.writeVarintField(15,oe.version||1),j.writeStringField(1,oe.name||""),j.writeVarintField(5,oe.extent||4096);var Z={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<oe.length;N++)Z.feature=oe.feature(N),j.writeMessage(2,tt,Z);var ie=Z.keys;for(N=0;N<ie.length;N++)j.writeStringField(3,ie[N]);var ye=Z.values;for(N=0;N<ye.length;N++)j.writeMessage(4,Hr,ye[N])}function tt(oe,j){var N=oe.feature;N.id!==void 0&&j.writeVarintField(1,N.id),j.writeMessage(2,_t,oe),j.writeVarintField(3,N.type),j.writeMessage(4,Gr,N)}function _t(oe,j){var N=oe.feature,Z=oe.keys,ie=oe.values,ye=oe.keycache,Se=oe.valuecache;for(var ze in N.properties){var pe=N.properties[ze],Ue=ye[ze];if(pe!==null){Ue===void 0&&(Z.push(ze),ye[ze]=Ue=Z.length-1),j.writeVarint(Ue);var We=typeof pe;We!=="string"&&We!=="boolean"&&We!=="number"&&(pe=JSON.stringify(pe));var qe=We+":"+pe,ht=Se[qe];ht===void 0&&(ie.push(pe),Se[qe]=ht=ie.length-1),j.writeVarint(ht)}}}function Bt(oe,j){return(j<<3)+(7&oe)}function gr(oe){return oe<<1^oe>>31}function Gr(oe,j){for(var N=oe.loadGeometry(),Z=oe.type,ie=0,ye=0,Se=N.length,ze=0;ze<Se;ze++){var pe=N[ze],Ue=1;Z===1&&(Ue=pe.length),j.writeVarint(Bt(1,Ue));for(var We=Z===3?pe.length-1:pe.length,qe=0;qe<We;qe++){qe===1&&Z!==1&&j.writeVarint(Bt(2,We-1));var ht=pe[qe].x-ie,Ut=pe[qe].y-ye;j.writeVarint(gr(ht)),j.writeVarint(gr(Ut)),ie+=ht,ye+=Ut}Z===3&&j.writeVarint(Bt(7,1))}}function Hr(oe,j){var N=typeof oe;N==="string"?j.writeStringField(1,oe):N==="boolean"?j.writeBooleanField(7,oe):N==="number"&&(oe%1!=0?j.writeDoubleField(3,oe):oe<0?j.writeSVarintField(6,oe):j.writeVarintField(5,oe))}re.exports=ve,re.exports.fromVectorTileJs=ve,re.exports.fromGeojsonVt=function(oe,j){j=j||{};var N={};for(var Z in oe)N[Z]=new fe(oe[Z].features,j),N[Z].name=Z,N[Z].version=j.version,N[Z].extent=j.extent;return ve({layers:N})},re.exports.GeoJSONWrapper=fe;var ar=x.by(re.exports);const at={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:oe=>oe},it=Math.fround||(Mt=new Float32Array(1),oe=>(Mt[0]=+oe,Mt[0]));var Mt;const Tt=3,jt=5,zt=6;class Sr{constructor(j){this.options=Object.assign(Object.create(at),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:N,minZoom:Z,maxZoom:ie}=this.options;N&&console.time("total time");const ye=`prepare ${j.length} points`;N&&console.time(ye),this.points=j;const Se=[];for(let pe=0;pe<j.length;pe++){const Ue=j[pe];if(!Ue.geometry)continue;const[We,qe]=Ue.geometry.coordinates,ht=it(Mr(We)),Ut=it(lr(qe));Se.push(ht,Ut,1/0,pe,-1,1),this.options.reduce&&Se.push(0)}let ze=this.trees[ie+1]=this._createTree(Se);N&&console.timeEnd(ye);for(let pe=ie;pe>=Z;pe--){const Ue=+Date.now();ze=this.trees[pe]=this._createTree(this._cluster(ze,pe)),N&&console.log("z%d: %d clusters in %dms",pe,ze.numItems,+Date.now()-Ue)}return N&&console.timeEnd("total time"),this}getClusters(j,N){let Z=((j[0]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,j[1]));let ye=j[2]===180?180:((j[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)Z=-180,ye=180;else if(Z>ye){const qe=this.getClusters([Z,ie,180,Se],N),ht=this.getClusters([-180,ie,ye,Se],N);return qe.concat(ht)}const ze=this.trees[this._limitZoom(N)],pe=ze.range(Mr(Z),lr(Se),Mr(ye),lr(ie)),Ue=ze.data,We=[];for(const qe of pe){const ht=this.stride*qe;We.push(Ue[ht+jt]>1?br(Ue,ht,this.clusterProps):this.points[Ue[ht+Tt]])}return We}getChildren(j){const N=this._getOriginId(j),Z=this._getOriginZoom(j),ie="No cluster with the specified id.",ye=this.trees[Z];if(!ye)throw new Error(ie);const Se=ye.data;if(N*this.stride>=Se.length)throw new Error(ie);const ze=this.options.radius/(this.options.extent*Math.pow(2,Z-1)),pe=ye.within(Se[N*this.stride],Se[N*this.stride+1],ze),Ue=[];for(const We of pe){const qe=We*this.stride;Se[qe+4]===j&&Ue.push(Se[qe+jt]>1?br(Se,qe,this.clusterProps):this.points[Se[qe+Tt]])}if(Ue.length===0)throw new Error(ie);return Ue}getLeaves(j,N,Z){const ie=[];return this._appendLeaves(ie,j,N=N||10,Z=Z||0,0),ie}getTile(j,N,Z){const ie=this.trees[this._limitZoom(j)],ye=Math.pow(2,j),{extent:Se,radius:ze}=this.options,pe=ze/Se,Ue=(Z-pe)/ye,We=(Z+1+pe)/ye,qe={features:[]};return this._addTileFeatures(ie.range((N-pe)/ye,Ue,(N+1+pe)/ye,We),ie.data,N,Z,ye,qe),N===0&&this._addTileFeatures(ie.range(1-pe/ye,Ue,1,We),ie.data,ye,Z,ye,qe),N===ye-1&&this._addTileFeatures(ie.range(0,Ue,pe/ye,We),ie.data,-1,Z,ye,qe),qe.features.length?qe:null}getClusterExpansionZoom(j){let N=this._getOriginZoom(j)-1;for(;N<=this.options.maxZoom;){const Z=this.getChildren(j);if(N++,Z.length!==1)break;j=Z[0].properties.cluster_id}return N}_appendLeaves(j,N,Z,ie,ye){const Se=this.getChildren(N);for(const ze of Se){const pe=ze.properties;if(pe&&pe.cluster?ye+pe.point_count<=ie?ye+=pe.point_count:ye=this._appendLeaves(j,pe.cluster_id,Z,ie,ye):ye<ie?ye++:j.push(ze),j.length===Z)break}return ye}_createTree(j){const N=new x.av(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Z=0;Z<j.length;Z+=this.stride)N.add(j[Z],j[Z+1]);return N.finish(),N.data=j,N}_addTileFeatures(j,N,Z,ie,ye,Se){for(const ze of j){const pe=ze*this.stride,Ue=N[pe+jt]>1;let We,qe,ht;if(Ue)We=kr(N,pe,this.clusterProps),qe=N[pe],ht=N[pe+1];else{const zr=this.points[N[pe+Tt]];We=zr.properties;const[nr,wr]=zr.geometry.coordinates;qe=Mr(nr),ht=lr(wr)}const Ut={type:1,geometry:[[Math.round(this.options.extent*(qe*ye-Z)),Math.round(this.options.extent*(ht*ye-ie))]],tags:We};let Wt;Wt=Ue||this.options.generateId?N[pe+Tt]:this.points[N[pe+Tt]].id,Wt!==void 0&&(Ut.id=Wt),Se.features.push(Ut)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,N){const{radius:Z,extent:ie,reduce:ye,minPoints:Se}=this.options,ze=Z/(ie*Math.pow(2,N)),pe=j.data,Ue=[],We=this.stride;for(let qe=0;qe<pe.length;qe+=We){if(pe[qe+2]<=N)continue;pe[qe+2]=N;const ht=pe[qe],Ut=pe[qe+1],Wt=j.within(pe[qe],pe[qe+1],ze),zr=pe[qe+jt];let nr=zr;for(const wr of Wt){const dr=wr*We;pe[dr+2]>N&&(nr+=pe[dr+jt])}if(nr>zr&&nr>=Se){let wr,dr=ht*zr,dn=Ut*zr,pn=-1;const ur=((qe/We|0)<<5)+(N+1)+this.points.length;for(const jr of Wt){const Ur=jr*We;if(pe[Ur+2]<=N)continue;pe[Ur+2]=N;const Mn=pe[Ur+jt];dr+=pe[Ur]*Mn,dn+=pe[Ur+1]*Mn,pe[Ur+4]=ur,ye&&(wr||(wr=this._map(pe,qe,!0),pn=this.clusterProps.length,this.clusterProps.push(wr)),ye(wr,this._map(pe,Ur)))}pe[qe+4]=ur,Ue.push(dr/nr,dn/nr,1/0,ur,-1,nr),ye&&Ue.push(pn)}else{for(let wr=0;wr<We;wr++)Ue.push(pe[qe+wr]);if(nr>1)for(const wr of Wt){const dr=wr*We;if(!(pe[dr+2]<=N)){pe[dr+2]=N;for(let dn=0;dn<We;dn++)Ue.push(pe[dr+dn])}}}}return Ue}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,N,Z){if(j[N+jt]>1){const Se=this.clusterProps[j[N+zt]];return Z?Object.assign({},Se):Se}const ie=this.points[j[N+Tt]].properties,ye=this.options.map(ie);return Z&&ye===ie?Object.assign({},ye):ye}}function br(oe,j,N){return{type:"Feature",id:oe[j+Tt],properties:kr(oe,j,N),geometry:{type:"Point",coordinates:[(Z=oe[j],360*(Z-.5)),ct(oe[j+1])]}};var Z}function kr(oe,j,N){const Z=oe[j+jt],ie=Z>=1e4?`${Math.round(Z/1e3)}k`:Z>=1e3?Math.round(Z/100)/10+"k":Z,ye=oe[j+zt],Se=ye===-1?{}:Object.assign({},N[ye]);return Object.assign(Se,{cluster:!0,cluster_id:oe[j+Tt],point_count:Z,point_count_abbreviated:ie})}function Mr(oe){return oe/360+.5}function lr(oe){const j=Math.sin(oe*Math.PI/180),N=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return N<0?0:N>1?1:N}function ct(oe){const j=(180-360*oe)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function Ht(oe,j,N,Z){let ie=Z;const ye=j+(N-j>>1);let Se,ze=N-j;const pe=oe[j],Ue=oe[j+1],We=oe[N],qe=oe[N+1];for(let ht=j+3;ht<N;ht+=3){const Ut=Nt(oe[ht],oe[ht+1],pe,Ue,We,qe);if(Ut>ie)Se=ht,ie=Ut;else if(Ut===ie){const Wt=Math.abs(ht-ye);Wt<ze&&(Se=ht,ze=Wt)}}ie>Z&&(Se-j>3&&Ht(oe,j,Se,Z),oe[Se+2]=ie,N-Se>3&&Ht(oe,Se,N,Z))}function Nt(oe,j,N,Z,ie,ye){let Se=ie-N,ze=ye-Z;if(Se!==0||ze!==0){const pe=((oe-N)*Se+(j-Z)*ze)/(Se*Se+ze*ze);pe>1?(N=ie,Z=ye):pe>0&&(N+=Se*pe,Z+=ze*pe)}return Se=oe-N,ze=j-Z,Se*Se+ze*ze}function wt(oe,j,N,Z){const ie={id:oe??null,type:j,geometry:N,tags:Z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")Ir(ie,N);else if(j==="Polygon")Ir(ie,N[0]);else if(j==="MultiLineString")for(const ye of N)Ir(ie,ye);else if(j==="MultiPolygon")for(const ye of N)Ir(ie,ye[0]);return ie}function Ir(oe,j){for(let N=0;N<j.length;N+=3)oe.minX=Math.min(oe.minX,j[N]),oe.minY=Math.min(oe.minY,j[N+1]),oe.maxX=Math.max(oe.maxX,j[N]),oe.maxY=Math.max(oe.maxY,j[N+1])}function Dr(oe,j,N,Z){if(!j.geometry)return;const ie=j.geometry.coordinates;if(ie&&ie.length===0)return;const ye=j.geometry.type,Se=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2);let ze=[],pe=j.id;if(N.promoteId?pe=j.properties[N.promoteId]:N.generateId&&(pe=Z||0),ye==="Point")_r(ie,ze);else if(ye==="MultiPoint")for(const Ue of ie)_r(Ue,ze);else if(ye==="LineString")Ee(ie,ze,Se,!1);else if(ye==="MultiLineString"){if(N.lineMetrics){for(const Ue of ie)ze=[],Ee(Ue,ze,Se,!1),oe.push(wt(pe,"LineString",ze,j.properties));return}nn(ie,ze,Se,!1)}else if(ye==="Polygon")nn(ie,ze,Se,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(const Ue of j.geometry.geometries)Dr(oe,{id:pe,geometry:Ue,properties:j.properties},N,Z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ue of ie){const We=[];nn(Ue,We,Se,!0),ze.push(We)}}oe.push(wt(pe,ye,ze,j.properties))}function _r(oe,j){j.push(Pr(oe[0]),Jt(oe[1]),0)}function Ee(oe,j,N,Z){let ie,ye,Se=0;for(let pe=0;pe<oe.length;pe++){const Ue=Pr(oe[pe][0]),We=Jt(oe[pe][1]);j.push(Ue,We,0),pe>0&&(Se+=Z?(ie*We-Ue*ye)/2:Math.sqrt(Math.pow(Ue-ie,2)+Math.pow(We-ye,2))),ie=Ue,ye=We}const ze=j.length-3;j[2]=1,Ht(j,0,ze,N),j[ze+2]=1,j.size=Math.abs(Se),j.start=0,j.end=j.size}function nn(oe,j,N,Z){for(let ie=0;ie<oe.length;ie++){const ye=[];Ee(oe[ie],ye,N,Z),j.push(ye)}}function Pr(oe){return oe/360+.5}function Jt(oe){const j=Math.sin(oe*Math.PI/180),N=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return N<0?0:N>1?1:N}function pr(oe,j,N,Z,ie,ye,Se,ze){if(Z/=j,ye>=(N/=j)&&Se<Z)return oe;if(Se<N||ye>=Z)return null;const pe=[];for(const Ue of oe){const We=Ue.geometry;let qe=Ue.type;const ht=ie===0?Ue.minX:Ue.minY,Ut=ie===0?Ue.maxX:Ue.maxY;if(ht>=N&&Ut<Z){pe.push(Ue);continue}if(Ut<N||ht>=Z)continue;let Wt=[];if(qe==="Point"||qe==="MultiPoint")_n(We,Wt,N,Z,ie);else if(qe==="LineString")Sn(We,Wt,N,Z,ie,!1,ze.lineMetrics);else if(qe==="MultiLineString")an(We,Wt,N,Z,ie,!1);else if(qe==="Polygon")an(We,Wt,N,Z,ie,!0);else if(qe==="MultiPolygon")for(const zr of We){const nr=[];an(zr,nr,N,Z,ie,!0),nr.length&&Wt.push(nr)}if(Wt.length){if(ze.lineMetrics&&qe==="LineString"){for(const zr of Wt)pe.push(wt(Ue.id,qe,zr,Ue.tags));continue}qe!=="LineString"&&qe!=="MultiLineString"||(Wt.length===1?(qe="LineString",Wt=Wt[0]):qe="MultiLineString"),qe!=="Point"&&qe!=="MultiPoint"||(qe=Wt.length===3?"Point":"MultiPoint"),pe.push(wt(Ue.id,qe,Wt,Ue.tags))}}return pe.length?pe:null}function _n(oe,j,N,Z,ie){for(let ye=0;ye<oe.length;ye+=3){const Se=oe[ye+ie];Se>=N&&Se<=Z&&Wr(j,oe[ye],oe[ye+1],oe[ye+2])}}function Sn(oe,j,N,Z,ie,ye,Se){let ze=An(oe);const pe=ie===0?Vr:Yr;let Ue,We,qe=oe.start;for(let nr=0;nr<oe.length-3;nr+=3){const wr=oe[nr],dr=oe[nr+1],dn=oe[nr+2],pn=oe[nr+3],ur=oe[nr+4],jr=ie===0?wr:dr,Ur=ie===0?pn:ur;let Mn=!1;Se&&(Ue=Math.sqrt(Math.pow(wr-pn,2)+Math.pow(dr-ur,2))),jr<N?Ur>N&&(We=pe(ze,wr,dr,pn,ur,N),Se&&(ze.start=qe+Ue*We)):jr>Z?Ur<Z&&(We=pe(ze,wr,dr,pn,ur,Z),Se&&(ze.start=qe+Ue*We)):Wr(ze,wr,dr,dn),Ur<N&&jr>=N&&(We=pe(ze,wr,dr,pn,ur,N),Mn=!0),Ur>Z&&jr<=Z&&(We=pe(ze,wr,dr,pn,ur,Z),Mn=!0),!ye&&Mn&&(Se&&(ze.end=qe+Ue*We),j.push(ze),ze=An(oe)),Se&&(qe+=Ue)}let ht=oe.length-3;const Ut=oe[ht],Wt=oe[ht+1],zr=ie===0?Ut:Wt;zr>=N&&zr<=Z&&Wr(ze,Ut,Wt,oe[ht+2]),ht=ze.length-3,ye&&ht>=3&&(ze[ht]!==ze[0]||ze[ht+1]!==ze[1])&&Wr(ze,ze[0],ze[1],ze[2]),ze.length&&j.push(ze)}function An(oe){const j=[];return j.size=oe.size,j.start=oe.start,j.end=oe.end,j}function an(oe,j,N,Z,ie,ye){for(const Se of oe)Sn(Se,j,N,Z,ie,ye,!1)}function Wr(oe,j,N,Z){oe.push(j,N,Z)}function Vr(oe,j,N,Z,ie,ye){const Se=(ye-j)/(Z-j);return Wr(oe,ye,N+(ie-N)*Se,1),Se}function Yr(oe,j,N,Z,ie,ye){const Se=(ye-N)/(ie-N);return Wr(oe,j+(Z-j)*Se,ye,1),Se}function rt(oe,j){const N=[];for(let Z=0;Z<oe.length;Z++){const ie=oe[Z],ye=ie.type;let Se;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Se=Fn(ie.geometry,j);else if(ye==="MultiLineString"||ye==="Polygon"){Se=[];for(const ze of ie.geometry)Se.push(Fn(ze,j))}else if(ye==="MultiPolygon"){Se=[];for(const ze of ie.geometry){const pe=[];for(const Ue of ze)pe.push(Fn(Ue,j));Se.push(pe)}}N.push(wt(ie.id,ye,Se,ie.tags))}return N}function Fn(oe,j){const N=[];N.size=oe.size,oe.start!==void 0&&(N.start=oe.start,N.end=oe.end);for(let Z=0;Z<oe.length;Z+=3)N.push(oe[Z]+j,oe[Z+1],oe[Z+2]);return N}function kn(oe,j){if(oe.transformed)return oe;const N=1<<oe.z,Z=oe.x,ie=oe.y;for(const ye of oe.features){const Se=ye.geometry,ze=ye.type;if(ye.geometry=[],ze===1)for(let pe=0;pe<Se.length;pe+=2)ye.geometry.push(Cn(Se[pe],Se[pe+1],j,N,Z,ie));else for(let pe=0;pe<Se.length;pe++){const Ue=[];for(let We=0;We<Se[pe].length;We+=2)Ue.push(Cn(Se[pe][We],Se[pe][We+1],j,N,Z,ie));ye.geometry.push(Ue)}}return oe.transformed=!0,oe}function Cn(oe,j,N,Z,ie,ye){return[Math.round(N*(oe*Z-ie)),Math.round(N*(j*Z-ye))]}function en(oe,j,N,Z,ie){const ye=j===ie.maxZoom?0:ie.tolerance/((1<<j)*ie.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:oe.length,source:null,x:N,y:Z,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ze of oe)lt(Se,ze,ye,ie);return Se}function lt(oe,j,N,Z){const ie=j.geometry,ye=j.type,Se=[];if(oe.minX=Math.min(oe.minX,j.minX),oe.minY=Math.min(oe.minY,j.minY),oe.maxX=Math.max(oe.maxX,j.maxX),oe.maxY=Math.max(oe.maxY,j.maxY),ye==="Point"||ye==="MultiPoint")for(let ze=0;ze<ie.length;ze+=3)Se.push(ie[ze],ie[ze+1]),oe.numPoints++,oe.numSimplified++;else if(ye==="LineString")hr(Se,ie,oe,N,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let ze=0;ze<ie.length;ze++)hr(Se,ie[ze],oe,N,ye==="Polygon",ze===0);else if(ye==="MultiPolygon")for(let ze=0;ze<ie.length;ze++){const pe=ie[ze];for(let Ue=0;Ue<pe.length;Ue++)hr(Se,pe[Ue],oe,N,!0,Ue===0)}if(Se.length){let ze=j.tags||null;if(ye==="LineString"&&Z.lineMetrics){ze={};for(const Ue in j.tags)ze[Ue]=j.tags[Ue];ze.mapbox_clip_start=ie.start/ie.size,ze.mapbox_clip_end=ie.end/ie.size}const pe={geometry:Se,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:ze};j.id!==null&&(pe.id=j.id),oe.features.push(pe)}}function hr(oe,j,N,Z,ie,ye){const Se=Z*Z;if(Z>0&&j.size<(ie?Se:Z))return void(N.numPoints+=j.length/3);const ze=[];for(let pe=0;pe<j.length;pe+=3)(Z===0||j[pe+2]>Se)&&(N.numSimplified++,ze.push(j[pe],j[pe+1])),N.numPoints++;ie&&function(pe,Ue){let We=0;for(let qe=0,ht=pe.length,Ut=ht-2;qe<ht;Ut=qe,qe+=2)We+=(pe[qe]-pe[Ut])*(pe[qe+1]+pe[Ut+1]);if(We>0===Ue)for(let qe=0,ht=pe.length;qe<ht/2;qe+=2){const Ut=pe[qe],Wt=pe[qe+1];pe[qe]=pe[ht-2-qe],pe[qe+1]=pe[ht-1-qe],pe[ht-2-qe]=Ut,pe[ht-1-qe]=Wt}}(ze,ye),oe.push(ze)}const Xt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ot{constructor(j,N){const Z=(N=this.options=function(ye,Se){for(const ze in Se)ye[ze]=Se[ze];return ye}(Object.create(Xt),N)).debug;if(Z&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");let ie=function(ye,Se){const ze=[];if(ye.type==="FeatureCollection")for(let pe=0;pe<ye.features.length;pe++)Dr(ze,ye.features[pe],Se,pe);else Dr(ze,ye.type==="Feature"?ye:{geometry:ye},Se);return ze}(j,N);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ie=function(ye,Se){const ze=Se.buffer/Se.extent;let pe=ye;const Ue=pr(ye,1,-1-ze,ze,0,-1,2,Se),We=pr(ye,1,1-ze,2+ze,0,-1,2,Se);return(Ue||We)&&(pe=pr(ye,1,-ze,1+ze,0,-1,2,Se)||[],Ue&&(pe=rt(Ue,1).concat(pe)),We&&(pe=pe.concat(rt(We,-1)))),pe}(ie,N),ie.length&&this.splitTile(ie,0,0,0),Z&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,N,Z,ie,ye,Se,ze){const pe=[j,N,Z,ie],Ue=this.options,We=Ue.debug;for(;pe.length;){ie=pe.pop(),Z=pe.pop(),N=pe.pop(),j=pe.pop();const qe=1<<N,ht=ti(N,Z,ie);let Ut=this.tiles[ht];if(!Ut&&(We>1&&console.time("creation"),Ut=this.tiles[ht]=en(j,N,Z,ie,Ue),this.tileCoords.push({z:N,x:Z,y:ie}),We)){We>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,Z,ie,Ut.numFeatures,Ut.numPoints,Ut.numSimplified),console.timeEnd("creation"));const Mn=`z${N}`;this.stats[Mn]=(this.stats[Mn]||0)+1,this.total++}if(Ut.source=j,ye==null){if(N===Ue.indexMaxZoom||Ut.numPoints<=Ue.indexMaxPoints)continue}else{if(N===Ue.maxZoom||N===ye)continue;if(ye!=null){const Mn=ye-N;if(Z!==Se>>Mn||ie!==ze>>Mn)continue}}if(Ut.source=null,j.length===0)continue;We>1&&console.time("clipping");const Wt=.5*Ue.buffer/Ue.extent,zr=.5-Wt,nr=.5+Wt,wr=1+Wt;let dr=null,dn=null,pn=null,ur=null,jr=pr(j,qe,Z-Wt,Z+nr,0,Ut.minX,Ut.maxX,Ue),Ur=pr(j,qe,Z+zr,Z+wr,0,Ut.minX,Ut.maxX,Ue);j=null,jr&&(dr=pr(jr,qe,ie-Wt,ie+nr,1,Ut.minY,Ut.maxY,Ue),dn=pr(jr,qe,ie+zr,ie+wr,1,Ut.minY,Ut.maxY,Ue),jr=null),Ur&&(pn=pr(Ur,qe,ie-Wt,ie+nr,1,Ut.minY,Ut.maxY,Ue),ur=pr(Ur,qe,ie+zr,ie+wr,1,Ut.minY,Ut.maxY,Ue),Ur=null),We>1&&console.timeEnd("clipping"),pe.push(dr||[],N+1,2*Z,2*ie),pe.push(dn||[],N+1,2*Z,2*ie+1),pe.push(pn||[],N+1,2*Z+1,2*ie),pe.push(ur||[],N+1,2*Z+1,2*ie+1)}}getTile(j,N,Z){j=+j,N=+N,Z=+Z;const ie=this.options,{extent:ye,debug:Se}=ie;if(j<0||j>24)return null;const ze=1<<j,pe=ti(j,N=N+ze&ze-1,Z);if(this.tiles[pe])return kn(this.tiles[pe],ye);Se>1&&console.log("drilling down to z%d-%d-%d",j,N,Z);let Ue,We=j,qe=N,ht=Z;for(;!Ue&&We>0;)We--,qe>>=1,ht>>=1,Ue=this.tiles[ti(We,qe,ht)];return Ue&&Ue.source?(Se>1&&(console.log("found parent tile z%d-%d-%d",We,qe,ht),console.time("drilling down")),this.splitTile(Ue.source,We,qe,ht,j,N,Z),Se>1&&console.timeEnd("drilling down"),this.tiles[pe]?kn(this.tiles[pe],ye):null):null}}function ti(oe,j,N){return 32*((1<<oe)*N+j)+oe}function rr(oe,j){return j?oe.properties[j]:oe.id}function wi(oe,j){if(oe==null)return!0;if(oe.type==="Feature")return rr(oe,j)!=null;if(oe.type==="FeatureCollection"){const N=new Set;for(const Z of oe.features){const ie=rr(Z,j);if(ie==null||N.has(ie))return!1;N.add(ie)}return!0}return!1}function St(oe,j){const N=new Map;if(oe!=null)if(oe.type==="Feature")N.set(rr(oe,j),oe);else for(const Z of oe.features)N.set(rr(Z,j),Z);return N}class ca extends Q{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(j,N){return x._(this,void 0,void 0,function*(){const Z=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ie=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!ie)return null;const ye=new class{constructor(ze){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=x.X,this.length=ze.length,this._features=ze}feature(ze){return new class{constructor(pe){this._feature=pe,this.extent=x.X,this.type=pe.type,this.properties=pe.tags,"id"in pe&&!isNaN(pe.id)&&(this.id=parseInt(pe.id,10))}loadGeometry(){if(this._feature.type===1){const pe=[];for(const Ue of this._feature.geometry)pe.push([new x.P(Ue[0],Ue[1])]);return pe}{const pe=[];for(const Ue of this._feature.geometry){const We=[];for(const qe of Ue)We.push(new x.P(qe[0],qe[1]));pe.push(We)}return pe}}toGeoJSON(pe,Ue,We){return $e.call(this,pe,Ue,We)}}(this._features[ze])}}(ie.features);let Se=ar(ye);return Se.byteOffset===0&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),{vectorTile:ye,rawData:Se.buffer}})}loadData(j){return x._(this,void 0,void 0,function*(){var N;(N=this._pendingRequest)===null||N===void 0||N.abort();const Z=!!(j&&j.request&&j.request.collectResourceTiming)&&new x.bv(j.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest),this._geoJSONIndex=j.cluster?new Sr(function({superclusterOptions:Se,clusterProperties:ze}){if(!ze||!Se)return Se;const pe={},Ue={},We={accumulated:null,zoom:0},qe={properties:null},ht=Object.keys(ze);for(const Ut of ht){const[Wt,zr]=ze[Ut],nr=x.bC(zr),wr=x.bC(typeof Wt=="string"?[Wt,["accumulated"],["get",Ut]]:Wt);pe[Ut]=nr.value,Ue[Ut]=wr.value}return Se.map=Ut=>{qe.properties=Ut;const Wt={};for(const zr of ht)Wt[zr]=pe[zr].evaluate(We,qe);return Wt},Se.reduce=(Ut,Wt)=>{qe.properties=Wt;for(const zr of ht)We.accumulated=Ut[zr],Ut[zr]=Ue[zr].evaluate(We,qe)},Se}(j)).load((yield this._pendingData).features):(ie=yield this._pendingData,new Ot(ie,j.geojsonVtOptions)),this.loaded={};const ye={};if(Z){const Se=Z.finish();Se&&(ye.resourceTiming={},ye.resourceTiming[j.source]=JSON.parse(JSON.stringify(Se)))}return ye}catch(ye){if(delete this._pendingRequest,x.bB(ye))return{abandoned:!0};throw ye}var ie})}getData(){return x._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(j){const N=this.loaded;return N&&N[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,N){return x._(this,void 0,void 0,function*(){let Z=yield this.loadGeoJSON(j,N);if(delete this._pendingRequest,typeof Z!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(be(Z,!0),j.filter){const ie=x.bC(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ie.result==="error")throw new Error(ie.value.map(Se=>`${Se.key}: ${Se.message}`).join(", "));Z={type:"FeatureCollection",features:Z.features.filter(Se=>ie.value.evaluate({zoom:0},Se))}}return Z})}loadGeoJSON(j,N){return x._(this,void 0,void 0,function*(){const{promoteId:Z}=j;if(j.request){const ie=yield x.h(j.request,N);return this._dataUpdateable=wi(ie.data,Z)?St(ie.data,Z):void 0,ie.data}if(typeof j.data=="string")try{const ie=JSON.parse(j.data);return this._dataUpdateable=wi(ie,Z)?St(ie,Z):void 0,ie}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return function(ie,ye,Se){var ze,pe,Ue,We;if(ye.removeAll&&ie.clear(),ye.remove)for(const qe of ye.remove)ie.delete(qe);if(ye.add)for(const qe of ye.add){const ht=rr(qe,Se);ht!=null&&ie.set(ht,qe)}if(ye.update)for(const qe of ye.update){let ht=ie.get(qe.id);if(ht==null)continue;const Ut=!qe.removeAllProperties&&(((ze=qe.removeProperties)===null||ze===void 0?void 0:ze.length)>0||((pe=qe.addOrUpdateProperties)===null||pe===void 0?void 0:pe.length)>0);if((qe.newGeometry||qe.removeAllProperties||Ut)&&(ht=Object.assign({},ht),ie.set(qe.id,ht),Ut&&(ht.properties=Object.assign({},ht.properties))),qe.newGeometry&&(ht.geometry=qe.newGeometry),qe.removeAllProperties)ht.properties={};else if(((Ue=qe.removeProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const Wt of qe.removeProperties)Object.prototype.hasOwnProperty.call(ht.properties,Wt)&&delete ht.properties[Wt];if(((We=qe.addOrUpdateProperties)===null||We===void 0?void 0:We.length)>0)for(const{key:Wt,value:zr}of qe.addOrUpdateProperties)ht.properties[Wt]=zr}}(this._dataUpdateable,j.dataDiff,Z),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(j){return x._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}class Xi{constructor(j){this.self=j,this.actor=new x.F(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(N,Z)=>{if(this.externalWorkerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.externalWorkerSourceTypes[N]=Z},this.self.addProtocol=x.bi,this.self.removeProtocol=x.bj,this.self.registerRTLTextPlugin=N=>{if(x.bD.isParsed())throw new Error("RTL text plugin already registered.");x.bD.setMethods(N)},this.actor.registerMessageHandler("LDT",(N,Z)=>this._getDEMWorkerSource(N,Z.source).loadTile(Z)),this.actor.registerMessageHandler("RDT",(N,Z)=>x._(this,void 0,void 0,function*(){this._getDEMWorkerSource(N,Z.source).removeTile(Z)})),this.actor.registerMessageHandler("GCEZ",(N,Z)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(N,Z.type,Z.source).getClusterExpansionZoom(Z)})),this.actor.registerMessageHandler("GCC",(N,Z)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(N,Z.type,Z.source).getClusterChildren(Z)})),this.actor.registerMessageHandler("GCL",(N,Z)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(N,Z.type,Z.source).getClusterLeaves(Z)})),this.actor.registerMessageHandler("LD",(N,Z)=>this._getWorkerSource(N,Z.type,Z.source).loadData(Z)),this.actor.registerMessageHandler("GD",(N,Z)=>this._getWorkerSource(N,Z.type,Z.source).getData()),this.actor.registerMessageHandler("LT",(N,Z)=>this._getWorkerSource(N,Z.type,Z.source).loadTile(Z)),this.actor.registerMessageHandler("RT",(N,Z)=>this._getWorkerSource(N,Z.type,Z.source).reloadTile(Z)),this.actor.registerMessageHandler("AT",(N,Z)=>this._getWorkerSource(N,Z.type,Z.source).abortTile(Z)),this.actor.registerMessageHandler("RMT",(N,Z)=>this._getWorkerSource(N,Z.type,Z.source).removeTile(Z)),this.actor.registerMessageHandler("RS",(N,Z)=>x._(this,void 0,void 0,function*(){if(!this.workerSources[N]||!this.workerSources[N][Z.type]||!this.workerSources[N][Z.type][Z.source])return;const ie=this.workerSources[N][Z.type][Z.source];delete this.workerSources[N][Z.type][Z.source],ie.removeSource!==void 0&&ie.removeSource(Z)})),this.actor.registerMessageHandler("RM",N=>x._(this,void 0,void 0,function*(){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N]})),this.actor.registerMessageHandler("SR",(N,Z)=>x._(this,void 0,void 0,function*(){this.referrer=Z})),this.actor.registerMessageHandler("SRPS",(N,Z)=>this._syncRTLPluginState(N,Z)),this.actor.registerMessageHandler("IS",(N,Z)=>x._(this,void 0,void 0,function*(){this.self.importScripts(Z)})),this.actor.registerMessageHandler("SI",(N,Z)=>this._setImages(N,Z)),this.actor.registerMessageHandler("UL",(N,Z)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(N).update(Z.layers,Z.removedIds)})),this.actor.registerMessageHandler("SL",(N,Z)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(N).replace(Z)}))}_setImages(j,N){return x._(this,void 0,void 0,function*(){this.availableImages[j]=N;for(const Z in this.workerSources[j]){const ie=this.workerSources[j][Z];for(const ye in ie)ie[ye].availableImages=N}})}_syncRTLPluginState(j,N){return x._(this,void 0,void 0,function*(){if(x.bD.isParsed())return x.bD.getState();if(N.pluginStatus!=="loading")return x.bD.setState(N),N;const Z=N.pluginURL;if(this.self.importScripts(Z),x.bD.isParsed()){const ie={pluginStatus:"loaded",pluginURL:Z};return x.bD.setState(ie),ie}throw x.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${Z}`)})}_getAvailableImages(j){let N=this.availableImages[j];return N||(N=[]),N}_getLayerIndex(j){let N=this.layerIndexes[j];return N||(N=this.layerIndexes[j]=new c),N}_getWorkerSource(j,N,Z){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][N]||(this.workerSources[j][N]={}),!this.workerSources[j][N][Z]){const ie={sendAsync:(ye,Se)=>(ye.targetMapId=j,this.actor.sendAsync(ye,Se))};switch(N){case"vector":this.workerSources[j][N][Z]=new Q(ie,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][N][Z]=new ca(ie,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][N][Z]=new this.externalWorkerSourceTypes[N](ie,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][N][Z]}_getDEMWorkerSource(j,N){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][N]||(this.demWorkerSources[j][N]=new H),this.demWorkerSources[j][N]}}return x.i(self)&&(self.worker=new Xi(self)),Xi}),y("index",["exports","./shared"],function(x,c){var V="4.7.1";let G,Y;const Q={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:m=>new Promise((e,s)=>{const u=requestAnimationFrame(e);m.signal.addEventListener("abort",()=>{cancelAnimationFrame(u),s(c.c())})}),getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,s.drawImage(m,0,0,m.width,m.height),s},resolveURL:m=>(G||(G=document.createElement("a")),G.href=m,G.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Y==null&&(Y=matchMedia("(prefers-reduced-motion: reduce)")),Y.matches)}};class H{static testProp(e){if(!H.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in H.docStyle)return e[s];return e[0]}static create(e,s,u){const d=window.document.createElement(e);return s!==void 0&&(d.className=s),u&&u.appendChild(d),d}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){H.docStyle&&H.selectProp&&(H.userSelect=H.docStyle[H.selectProp],H.docStyle[H.selectProp]="none")}static enableDrag(){H.docStyle&&H.selectProp&&(H.docStyle[H.selectProp]=H.userSelect)}static setTransform(e,s){e.style[H.transformProp]=s}static addEventListener(e,s,u,d={}){e.addEventListener(s,u,"passive"in d?d:d.capture)}static removeEventListener(e,s,u,d={}){e.removeEventListener(s,u,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",H.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",H.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",H.suppressClickInternal,!0)},0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,u){const d=s.boundingClientRect;return new c.P((u.clientX-d.left)/s.x-e.clientLeft,(u.clientY-d.top)/s.y-e.clientTop)}static mousePos(e,s){const u=H.getScale(e);return H.getPoint(e,u,s)}static touchPos(e,s){const u=[],d=H.getScale(e);for(let f=0;f<s.length;f++)u.push(H.getPoint(e,d,s[f]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}H.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,H.selectProp=H.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),H.transformProp=H.testProp(["transform","WebkitTransform"]);const Le={supported:!1,testSupport:function(m){!$e&&be&&(re?J(m):Be=m)}};let Be,be,$e=!1,re=!1;function J(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,be),m.isContextLost())return;Le.supported=!0}catch{}m.deleteTexture(e),$e=!0}var le;typeof document<"u"&&(be=document.createElement("img"),be.onload=()=>{Be&&J(Be),Be=null,re=!0},be.onerror=()=>{$e=!0,Be=null},be.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let e,s,u,d;m.resetRequestQueue=()=>{e=[],s=0,u=0,d={}},m.addThrottleControl=I=>{const M=u++;return d[M]=I,M},m.removeThrottleControl=I=>{delete d[I],S()},m.getImage=(I,M,L=!0)=>new Promise((R,$)=>{Le.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),c.e(I,{type:"image"}),e.push({abortController:M,requestParameters:I,supportImageRefresh:L,state:"queued",onError:X=>{$(X)},onSuccess:X=>{R(X)}}),S()});const f=I=>c._(this,void 0,void 0,function*(){I.state="running";const{requestParameters:M,supportImageRefresh:L,onError:R,onSuccess:$,abortController:X}=I,ee=L===!1&&!c.i(self)&&!c.g(M.url)&&(!M.headers||Object.keys(M.headers).reduce((de,ge)=>de&&ge==="accept",!0));s++;const se=ee?T(M,X):c.m(M,X);try{const de=yield se;delete I.abortController,I.state="completed",de.data instanceof HTMLImageElement||c.b(de.data)?$(de):de.data&&$({data:yield(ce=de.data,typeof createImageBitmap=="function"?c.d(ce):c.f(ce)),cacheControl:de.cacheControl,expires:de.expires})}catch(de){delete I.abortController,R(de)}finally{s--,S()}var ce}),S=()=>{const I=(()=>{for(const M of Object.keys(d))if(d[M]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=s;M<I&&e.length>0;M++){const L=e.shift();L.abortController.signal.aborted?M--:f(L)}},T=(I,M)=>new Promise((L,R)=>{const $=new Image,X=I.url,ee=I.credentials;ee&&ee==="include"?$.crossOrigin="use-credentials":(ee&&ee==="same-origin"||!c.s(X))&&($.crossOrigin="anonymous"),M.signal.addEventListener("abort",()=>{$.src="",R(c.c())}),$.fetchPriority="high",$.onload=()=>{$.onerror=$.onload=null,L({data:$})},$.onerror=()=>{$.onerror=$.onload=null,M.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},$.src=X})}(le||(le={})),le.resetRequestQueue();class we{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Ze(m){var e=new c.A(3);return e[0]=m[0],e[1]=m[1],e[2]=m[2],e}var He,Xe=function(m,e,s){return m[0]=e[0]-s[0],m[1]=e[1]-s[1],m[2]=e[2]-s[2],m};He=new c.A(3),c.A!=Float32Array&&(He[0]=0,He[1]=0,He[2]=0);var fe=function(m){var e=m[0],s=m[1];return e*e+s*s};function ve(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const s=[];for(const{id:u,url:d}of m){const f=`${u}${d}`;s.indexOf(f)===-1&&(s.push(f),e.push({id:u,url:d}))}}return e}function je(m,e,s){const u=m.split("?");return u[0]+=`${e}${s}`,u.join("?")}(function(){var m=new c.A(2);c.A!=Float32Array&&(m[0]=0,m[1]=0)})();class tt{constructor(e,s,u,d){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(s,d)}update(e,s,u){const{width:d,height:f}=e,S=!(this.size&&this.size[0]===d&&this.size[1]===f||u),{context:T}=this,{gl:I}=T;if(this.useMipmap=!!(s&&s.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!s||s.premultiply!==!1)),S)this.size=[d,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,e):I.texImage2D(I.TEXTURE_2D,0,this.format,d,f,0,this.format,I.UNSIGNED_BYTE,e.data);else{const{x:M,y:L}=u||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?I.texSubImage2D(I.TEXTURE_2D,0,M,L,I.RGBA,I.UNSIGNED_BYTE,e):I.texSubImage2D(I.TEXTURE_2D,0,M,L,d,f,I.RGBA,I.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(e,s,u){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),u!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,u||e),this.filter=e),s!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function _t(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class Bt extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:u}of this.requestors)u(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const u=s.spriteData;s.data=new c.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let u=!0;const d=s.data||s.spriteData;return this._validateStretch(s.stretchX,d&&d.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,d&&d.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,s){if(!e)return!0;let u=0;for(const d of e){if(d[0]<u||d[1]<d[0]||s<d[1])return!1;u=d[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const u=s.spriteData,d=u&&u.width||s.data.width,f=u&&u.height||s.data.height;return!(e[0]<0||d<e[0]||e[1]<0||f<e[1]||e[2]<0||d<e[2]||e[3]<0||f<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,u=!0){const d=this.getImage(e);if(u&&(d.data.width!==s.data.width||d.data.height!==s.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=d.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((s,u)=>{let d=!0;if(!this.isLoaded())for(const f of e)this.images[f]||(d=!1);this.isLoaded()||d?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})})}_getImagesForIds(e){const s={};for(const u of e){let d=this.getImage(u);d||(this.fire(new c.k("styleimagemissing",{id:u})),d=this.getImage(u)),d?s[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:c.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],u=this.getImage(e);if(!u)return null;if(s&&s.position.version===u.version)return s.position;if(s)s.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},f=new c.I(d,u);this.patterns[e]={bin:d,position:f}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new tt(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const f in this.patterns)e.push(this.patterns[f].bin);const{w:s,h:u}=c.p(e),d=this.atlasImage;d.resize({width:s||1,height:u||1});for(const f in this.patterns){const{bin:S}=this.patterns[f],T=S.x+1,I=S.y+1,M=this.getImage(f).data,L=M.width,R=M.height;c.R.copy(M,d,{x:0,y:0},{x:T,y:I},{width:L,height:R}),c.R.copy(M,d,{x:0,y:R-1},{x:T,y:I-1},{width:L,height:1}),c.R.copy(M,d,{x:0,y:0},{x:T,y:I+R},{width:L,height:1}),c.R.copy(M,d,{x:L-1,y:0},{x:T-1,y:I},{width:1,height:R}),c.R.copy(M,d,{x:0,y:0},{x:T+L,y:I},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const u=this.getImage(s);u||c.w(`Image with ID: "${s}" was not found`),_t(u)&&this.updateImage(s,u)}}}const gr=1e20;function Gr(m,e,s,u,d,f,S,T,I){for(let M=e;M<e+u;M++)Hr(m,s*f+M,f,d,S,T,I);for(let M=s;M<s+d;M++)Hr(m,M*f+e,1,u,S,T,I)}function Hr(m,e,s,u,d,f,S){f[0]=0,S[0]=-gr,S[1]=gr,d[0]=m[e];for(let T=1,I=0,M=0;T<u;T++){d[T]=m[e+T*s];const L=T*T;do{const R=f[I];M=(d[T]-d[R]+L-R*R)/(T-R)/2}while(M<=S[I]&&--I>-1);I++,f[I]=T,S[I]=M,S[I+1]=gr}for(let T=0,I=0;T<u;T++){for(;S[I+1]<T;)I++;const M=f[I],L=T-M;m[e+T*s]=d[M]+L*L}}class ar{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const s=[];for(const f in e)for(const S of e[f])s.push(this._getAndCacheGlyphsPromise(f,S));const u=yield Promise.all(s),d={};for(const{stack:f,id:S,glyph:T}of u)d[f]||(d[f]={}),d[f][S]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return d})}_getAndCacheGlyphsPromise(e,s){return c._(this,void 0,void 0,function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=u.glyphs[s];if(d!==void 0)return{stack:e,id:s,glyph:d};if(d=this._tinySDF(u,e,s),d)return u.glyphs[s]=d,{stack:e,id:s,glyph:d};const f=Math.floor(s/256);if(256*f>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[f])return{stack:e,id:s,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[f]){const T=ar.loadGlyphRange(e,f,this.url,this.requestManager);u.requests[f]=T}const S=yield u.requests[f];for(const T in S)this._doesCharSupportLocalGlyph(+T)||(u.glyphs[+T]=S[+T]);return u.ranges[f]=!0,{stack:e,id:s,glyph:S[s]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(e))}_tinySDF(e,s,u){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let f=e.tinySDF;if(!f){let T="400";/bold/i.test(s)?T="900":/medium/i.test(s)?T="500":/light/i.test(s)&&(T="200"),f=e.tinySDF=new ar.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:T})}const S=f.draw(String.fromCharCode(u));return{id:u,bitmap:new c.o({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}ar.loadGlyphRange=function(m,e,s,u){return c._(this,void 0,void 0,function*(){const d=256*e,f=d+255,S=u.transformRequest(s.replace("{fontstack}",m).replace("{range}",`${d}-${f}`),"Glyphs"),T=yield c.l(S,new AbortController);if(!T||!T.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${f}`);const I={};for(const M of c.n(T.data))I[M.id]=M;return I})},ar.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:s=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:f="normal",fontStyle:S="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=s;const T=this.size=m+4*e,I=this._createCanvas(T),M=this.ctx=I.getContext("2d",{willReadFrequently:!0});M.font=`${S} ${f} ${m}px ${d}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:f}=this.ctx.measureText(m),S=Math.ceil(s),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-d))),I=Math.min(this.size-this.buffer,S+Math.ceil(u)),M=T+2*this.buffer,L=I+2*this.buffer,R=Math.max(M*L,0),$=new Uint8ClampedArray(R),X={data:$,width:M,height:L,glyphWidth:T,glyphHeight:I,glyphTop:S,glyphLeft:0,glyphAdvance:e};if(T===0||I===0)return X;const{ctx:ee,buffer:se,gridInner:ce,gridOuter:de}=this;ee.clearRect(se,se,T,I),ee.fillText(m,se,se+S);const ge=ee.getImageData(se,se,T,I);de.fill(gr,0,R),ce.fill(0,0,R);for(let ne=0;ne<I;ne++)for(let Te=0;Te<T;Te++){const Ae=ge.data[4*(ne*T+Te)+3]/255;if(Ae===0)continue;const Ne=(ne+se)*M+Te+se;if(Ae===1)de[Ne]=0,ce[Ne]=gr;else{const Qe=.5-Ae;de[Ne]=Qe>0?Qe*Qe:0,ce[Ne]=Qe<0?Qe*Qe:0}}Gr(de,0,0,M,L,M,this.f,this.v,this.z),Gr(ce,se,se,T,I,M,this.f,this.v,this.z);for(let ne=0;ne<R;ne++){const Te=Math.sqrt(de[ne])-Math.sqrt(ce[ne]);$[ne]=Math.round(255-255*(Te/this.radius+this.cutoff))}return X}};class at{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,s){return c.x(e.expression.evaluate(s))}interpolate(e,s,u){return{x:c.y.number(e.x,s.x,u),y:c.y.number(e.y,s.y,u),z:c.y.number(e.z,s.z,u)}}}let it;class Mt extends c.E{constructor(e){super(),it=it||new c.q({anchor:new c.D(c.v.light.anchor),position:new at,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(it),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(c.r,e,s))for(const u in e){const d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,u){return(!u||u.validate!==!1)&&c.t(this,e.call(c.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const Tt=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class jt extends c.E{constructor(e){super(),this._transitionable=new c.T(Tt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,s={}){if(!this._validate(c.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,u={}){return u?.validate!==!1&&c.t(this,e.call(c.u,c.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class zt{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const u=e.join(",")+String(s);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,s)),this.dashEntry[u]}getDashRanges(e,s,u){const d=[];let f=e.length%2==1?-e[e.length-1]*u:0,S=e[0]*u,T=!0;d.push({left:f,right:S,isDash:T,zeroLength:e[0]===0});let I=e[0];for(let M=1;M<e.length;M++){T=!T;const L=e[M];f=I*u,I+=L,S=I*u,d.push({left:f,right:S,isDash:T,zeroLength:L===0})}return d}addRoundDash(e,s,u){const d=s/2;for(let f=-u;f<=u;f++){const S=this.width*(this.nextRow+u+f);let T=0,I=e[T];for(let M=0;M<this.width;M++){M/I.right>1&&(I=e[++T]);const L=Math.abs(M-I.left),R=Math.abs(M-I.right),$=Math.min(L,R);let X;const ee=f/u*(d+1);if(I.isDash){const se=d-Math.abs(ee);X=Math.sqrt($*$+se*se)}else X=d-Math.sqrt($*$+ee*ee);this.data[S+M]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(e){for(let T=e.length-1;T>=0;--T){const I=e[T],M=e[T+1];I.zeroLength?e.splice(T,1):M&&M.isDash===I.isDash&&(M.left=I.left,e.splice(T,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const d=this.width*this.nextRow;let f=0,S=e[f];for(let T=0;T<this.width;T++){T/S.right>1&&(S=e[++f]);const I=Math.abs(T-S.left),M=Math.abs(T-S.right),L=Math.min(I,M);this.data[d+T]=Math.max(0,Math.min(255,(S.isDash?L:-L)+128))}}addDash(e,s){const u=s?7:0,d=2*u+1;if(this.nextRow+d>this.height)return c.w("LineAtlas out of space"),null;let f=0;for(let T=0;T<e.length;T++)f+=e[T];if(f!==0){const T=this.width/f,I=this.getDashRanges(e,this.width,T);s?this.addRoundDash(I,T,u):this.addRegularDash(I)}const S={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:f};return this.nextRow+=d,this.dirty=!0,S}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Sr="maplibre_preloaded_worker_pool";class br{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<br.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Sr]}numActive(){return Object.keys(this.active).length}}const kr=Math.floor(Q.hardwareConcurrency/2);let Mr,lr;function ct(){return Mr||(Mr=new br),Mr}br.workerCount=c.C(globalThis)?Math.max(Math.min(kr,3),1):1;class Ht{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const u=this.workerPool.acquire(s);for(let d=0;d<u.length;d++){const f=new c.F(u[d],s);f.name=`Worker ${d}`,this.actors.push(f)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const u=[];for(const d of this.actors)u.push(d.sendAsync({type:e,data:s}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const u of this.actors)u.registerMessageHandler(e,s)}}function Nt(){return lr||(lr=new Ht(ct(),c.G),lr.registerMessageHandler("GR",(m,e,s)=>c.m(e,s))),lr}function wt(m,e){const s=c.H();return c.J(s,s,[1,1,0]),c.K(s,s,[.5*m.width,.5*m.height,1]),c.L(s,s,m.calculatePosMatrix(e.toUnwrapped()))}function Ir(m,e,s,u,d,f){const S=function(R,$,X){if(R)for(const ee of R){const se=$[ee];if(se&&se.source===X&&se.type==="fill-extrusion")return!0}else for(const ee in $){const se=$[ee];if(se.source===X&&se.type==="fill-extrusion")return!0}return!1}(d&&d.layers,e,m.id),T=f.maxPitchScaleFactor(),I=m.tilesIn(u,T,S);I.sort(Dr);const M=[];for(const R of I)M.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(e,s,m._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,d,f,T,wt(m.transform,R.tileID))});const L=function(R){const $={},X={};for(const ee of R){const se=ee.queryResults,ce=ee.wrappedTileID,de=X[ce]=X[ce]||{};for(const ge in se){const ne=se[ge],Te=de[ge]=de[ge]||{},Ae=$[ge]=$[ge]||[];for(const Ne of ne)Te[Ne.featureIndex]||(Te[Ne.featureIndex]=!0,Ae.push(Ne))}}return $}(M);for(const R in L)L[R].forEach($=>{const X=$.feature,ee=m.getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=ee});return L}function Dr(m,e){const s=m.tileID,u=e.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}function _r(m,e,s){return c._(this,void 0,void 0,function*(){let u=m;if(m.url?u=(yield c.h(e.transformRequest(m.url,"Source"),s)).data:yield Q.frameAsync(s),!u)return null;const d=c.M(c.e(u,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(d.vectorLayerIds=u.vector_layers.map(f=>f.id)),d})}class Ee{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){const s=this._sw,u=this._ne;let d,f;if(e instanceof c.N)d=e,f=e;else{if(!(e instanceof Ee))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ee.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(d=e._sw,f=e._ne,!d||!f)return this}return s||u?(s.lng=Math.min(d.lng,s.lng),s.lat=Math.min(d.lat,s.lat),u.lng=Math.max(f.lng,u.lng),u.lat=Math.max(f.lat,u.lat)):(this._sw=new c.N(d.lng,d.lat),this._ne=new c.N(f.lng,f.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:u}=c.N.convert(e);let d=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(e){return e instanceof Ee?e:e&&new Ee(e)}static fromLngLat(e,s=0){const u=360*s/40075017,d=u/Math.cos(Math.PI/180*e.lat);return new Ee(new c.N(e.lng-d,e.lat-u),new c.N(e.lng+d,e.lat+u))}adjustAntiMeridian(){const e=new c.N(this._sw.lng,this._sw.lat),s=new c.N(this._ne.lng,this._ne.lat);return new Ee(e,e.lng>s.lng?new c.N(s.lng+360,s.lat):s)}}class nn{constructor(e,s,u){this.bounds=Ee.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),u=Math.floor(c.O(this.bounds.getWest())*s),d=Math.floor(c.Q(this.bounds.getNorth())*s),f=Math.ceil(c.O(this.bounds.getEast())*s),S=Math.ceil(c.Q(this.bounds.getSouth())*s);return e.x>=u&&e.x<f&&e.y>=d&&e.y<S}}class Pr extends c.E{constructor(e,s,u,d){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(s,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield _r(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new nn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((f,S)=>{e.reloadPromise={resolve:f,reject:S}})}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{const f=yield e.actor.sendAsync({type:d,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,f)}catch(f){if(delete e.abortController,e.aborted)return;if(f&&f.status!==404)throw f;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Jt extends c.E{constructor(e,s,u,d){super(),this.id=e,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},s),c.e(this,c.M(s,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield _r(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(c.e(this,e),e.bounds&&(this.tileBounds=new nn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield le.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const d=this.map.painter.context,f=d.gl,S=u.data;e.texture=this.map.painter.getTileTexture(S.width),e.texture?e.texture.update(S,{useMipmap:!0}):(e.texture=new tt(d,S,f.RGBA,{useMipmap:!0}),e.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class pr extends Jt{constructor(e,s,u,d){super(e,s,u,d),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const d=yield le.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){const f=d.data;this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const S=c.b(f)&&c.U()?f:yield this.readImageNow(f),T={type:this.type,uid:e.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const I=yield e.actor.sendAsync({type:"LDT",data:T});e.dem=I,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){const s=e.width+2,u=e.height+2;try{return new c.R({width:s,height:u},yield c.W(e,-1,-1,s,u))}catch{}}return Q.getImageData(e,1)})}_getNeighboringTiles(e){const s=e.canonical,u=Math.pow(2,s.z),d=(s.x-1+u)%u,f=s.x===0?e.wrap-1:e.wrap,S=(s.x+1+u)%u,T=s.x+1===u?e.wrap+1:e.wrap,I={};return I[new c.S(e.overscaledZ,f,s.z,d,s.y).key]={backfilled:!1},I[new c.S(e.overscaledZ,T,s.z,S,s.y).key]={backfilled:!1},s.y>0&&(I[new c.S(e.overscaledZ,f,s.z,d,s.y-1).key]={backfilled:!1},I[new c.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},I[new c.S(e.overscaledZ,T,s.z,S,s.y-1).key]={backfilled:!1}),s.y+1<u&&(I[new c.S(e.overscaledZ,f,s.z,d,s.y+1).key]={backfilled:!1},I[new c.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},I[new c.S(e.overscaledZ,T,s.z,S,s.y+1).key]={backfilled:!1}),I}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class _n extends c.E{constructor(e,s,u,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(d),this._data=s.data,this._options=c.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const f=c.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*f,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*f,extent:c.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:c.X,radius:(s.clusterRadius||50)*f,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:u}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const s=c.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(Q.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let d=null;u.resourceTiming&&u.resourceTiming[this.id]&&(d=u.resourceTiming[this.id].slice(0));const f={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&c.e(f,{resourceTiming:d}),this.fire(new c.k("data",Object.assign(Object.assign({},f),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},f),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(u))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const d=yield this.actor.sendAsync({type:s,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,s==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Sn=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class An extends c.E{constructor(e,s,u,d){super(),this.id=e,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=s}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield le.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new c.j(s))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(c.Z.fromLngLat);this.tileID=function(d){let f=1/0,S=1/0,T=-1/0,I=-1/0;for(const $ of d)f=Math.min(f,$.x),S=Math.min(S,$.y),T=Math.max(T,$.x),I=Math.max(I,$.y);const M=Math.max(T-f,I-S),L=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),R=Math.pow(2,L);return new c.a1(L,Math.floor((f+T)/2*R),Math.floor((S+I)/2*R))}(s),this.minzoom=this.maxzoom=this.tileID.z;const u=s.map(d=>this.tileID.getTilePoint(d)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,c.X,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,c.X),this._boundsArray.emplaceBack(u[2].x,u[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Sn.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new tt(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const f=this.tiles[d];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,u=!0)}u&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class an extends An{constructor(e,s,u,d){super(e,s,u,d),this.roundZoom=!0,this.type="video",this.options=s}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield c.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new c.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Sn.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new tt(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const f=this.tiles[d];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,u=!0)}u&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Wr extends An{constructor(e,s,u,d){super(e,s,u,d),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(S=>typeof S!="number"))||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,u=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Sn.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new tt(s,this.canvas,u.RGBA,{premultiply:!0});let d=!1;for(const f in this.tiles){const S=this.tiles[f];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,d=!0)}d&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Vr={},Yr=m=>{switch(m){case"geojson":return _n;case"image":return An;case"raster":return Jt;case"raster-dem":return pr;case"vector":return Pr;case"video":return an;case"canvas":return Wr}return Vr[m]},rt="RTLPluginLoaded";class Fn extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Nt()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(s,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Q.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(rt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let kn=null;function Cn(){return kn||(kn=new Fn),kn}class en{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(d,f){const S={};if(!f)return S;for(const T of d){const I=T.layerIds.map(M=>f.getLayer(M)).filter(Boolean);if(I.length!==0){T.layers=I,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(M=>I.filter(L=>L.id===M)[0]));for(const M of I)S[M.id]=T}}return S}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const f=this.buckets[d];if(f instanceof c.a6){if(this.hasSymbolBuckets=!0,!u)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const f=this.buckets[d];if(f instanceof c.a6&&f.hasRTLText){this.hasRTLText=!0,Cn().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const f=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(d).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new tt(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new tt(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,u,d,f,S,T,I,M,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:f,scale:S,tileSize:this.tileSize,pixelPosMatrix:L,transform:I,params:T,queryPadding:this.queryPadding*M},e,s,u):{}}querySourceFeatures(e,s){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),f=s&&s.sourceLayer?s.sourceLayer:"",S=d._geojsonTileLayer||d[f];if(!S)return;const T=c.a7(s&&s.filter),{z:I,x:M,y:L}=this.tileID.canonical,R={z:I,x:M,y:L};for(let $=0;$<S.length;$++){const X=S.feature($);if(T.needGeometry){const ce=c.a8(X,!0);if(!T.filter(new c.z(this.tileID.overscaledZ),ce,this.tileID.canonical))continue}else if(!T.filter(new c.z(this.tileID.overscaledZ),X))continue;const ee=u.getId(X,f),se=new c.a9(X,I,M,L,ee);se.tile=R,e.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const u=c.aa(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(s)if(this.expirationTime<s)d=!0;else{const f=this.expirationTime-s;f?this.expirationTime=u+Math.max(f,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!s.style.hasLayer(d))continue;const f=this.buckets[d],S=f.layers[0].sourceLayer||"_geojsonTileLayer",T=u[S],I=e[S];if(!T||!I||Object.keys(I).length===0)continue;f.update(I,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=s&&s.style&&s.style.getLayer(d);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Q.now()+e}setDependencies(e,s){const u={};for(const d of s)u[d]=!0;this.dependencies[e]=u}hasDependency(e,s){for(const u of e){const d=this.dependencies[u];if(d){for(const f of s)if(d[f])return!0}}return!1}}class lt{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,u){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const f={value:s,timeout:void 0};if(u!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},u)),this.data[d].push(f),this.order.push(d),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const u=e.wrapped().key,d=s===void 0?0:this.data[u].indexOf(s),f=this.data[u][d];return this.data[u].splice(d,1),f.timeout&&clearTimeout(f.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(f.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const u in this.data)for(const d of this.data[u])e(d.value)||s.push(d);for(const u of s)this.remove(u.value.tileID,u)}}class hr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,u){const d=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},c.e(this.stateChanges[e][d],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==d&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const f in this.state[e][d])u[f]||(this.deletedStates[e][d][f]=null)}else for(const f in u)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][f]===null&&delete this.deletedStates[e][d][f]}removeFeatureState(e,s,u){if(this.deletedStates[e]===null)return;const d=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&s!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][u]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(u in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][u]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,s){const u=String(s),d=c.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][s];if(f===null)return{};for(const S in f)delete d[S]}return d}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const f={};for(const S in this.stateChanges[d])this.state[d][S]||(this.state[d][S]={}),c.e(this.state[d][S],this.stateChanges[d][S]),f[S]=this.state[d][S];u[d]=f}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const f={};if(this.deletedStates[d]===null)for(const S in this.state[d])f[S]={},this.state[d][S]={};else for(const S in this.deletedStates[d]){if(this.deletedStates[d][S]===null)this.state[d][S]={};else for(const T of Object.keys(this.deletedStates[d][S]))delete this.state[d][S][T];f[S]=this.state[d][S]}u[d]=u[d]||{},c.e(u[d],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const d in e)e[d].setFeatureState(u,s)}}class Xt extends c.E{constructor(e,s,u){super(),this.id=e,this.dispatcher=u,this.on("data",d=>this._dataHandler(d)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,f,S,T)=>{const I=new(Yr(f.type))(d,f,S,T);if(I.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${I.id}`);return I})(e,s,u,this),this._tiles={},this._cache=new lt(0,d=>this._unloadTile(d)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new hr,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,u){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,u)}catch(d){e.state="errored",d.status!==404?this._source.fire(new c.j(d,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const u=this._tiles[s];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Ot).map(e=>e.key)}getRenderableIds(e){const s=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&s.push(this._tiles[u]);return e?s.sort((u,d)=>{const f=u.tileID,S=d.tileID,T=new c.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),I=new c.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-S.overscaledZ||I.y-T.y||I.x-T.x}).map(u=>u.tileID.key):s.map(u=>u.tileID).sort(Ot).map(u=>u.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return c._(this,void 0,void 0,function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=s),yield this._loadTile(u,e,s))})}_tileLoaded(e,s,u){e.timeAdded=Q.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let d=0;d<s.length;d++){const f=s[d];if(e.neighboringTiles&&e.neighboringTiles[f]){const S=this.getTileByID(f);u(e,S),u(S,e)}}function u(d,f){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let S=f.tileID.canonical.x-d.tileID.canonical.x;const T=f.tileID.canonical.y-d.tileID.canonical.y,I=Math.pow(2,d.tileID.canonical.z),M=f.tileID.key;S===0&&T===0||Math.abs(T)>1||(Math.abs(S)>1&&(Math.abs(S+I)===1?S+=I:Math.abs(S-I)===1&&(S-=I)),f.dem&&d.dem&&(d.dem.backfillBorder(f.dem,S,T),d.neighboringTiles&&d.neighboringTiles[M]&&(d.neighboringTiles[M].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,u,d){for(const f in this._tiles){let S=this._tiles[f];if(d[f]||!S.hasData()||S.tileID.overscaledZ<=s||S.tileID.overscaledZ>u)continue;let T=S.tileID;for(;S&&S.tileID.overscaledZ>s+1;){const M=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[M.key],S&&S.hasData()&&(T=M)}let I=T;for(;I.overscaledZ>s;)if(I=I.scaledTo(I.overscaledZ-1),e[I.key]){d[T.key]=T;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=s?u:null}for(let u=e.overscaledZ-1;u>=s;u--){const d=e.scaledTo(u),f=this._getLoadedTile(d);if(f)return f}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(s*u*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(f)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const u={};for(const d in this._tiles){const f=this._tiles[d];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+s),u[f.tileID.key]=f}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}_updateCoveredAndRetainedTiles(e,s,u,d,f,S){const T={},I={},M=Object.keys(e),L=Q.now();for(const R of M){const $=e[R],X=this._tiles[R];if(!X||X.fadeEndTime!==0&&X.fadeEndTime<=L)continue;const ee=this.findLoadedParent($,s),se=this.findLoadedSibling($),ce=ee||se||null;ce&&(this._addTile(ce.tileID),T[ce.tileID.key]=ce.tileID),I[R]=$}this._retainLoadedChildren(I,d,u,e);for(const R in T)e[R]||(this._coveredTiles[R]=!0,e[R]=T[R]);if(S){const R={},$={};for(const X of f)this._tiles[X.key].hasData()?R[X.key]=X:$[X.key]=X;for(const X in $){const ee=$[X].children(this._source.maxzoom);this._tiles[ee[0].key]&&this._tiles[ee[1].key]&&this._tiles[ee[2].key]&&this._tiles[ee[3].key]&&(R[ee[0].key]=e[ee[0].key]=ee[0],R[ee[1].key]=e[ee[1].key]=ee[1],R[ee[2].key]=e[ee[2].key]=ee[2],R[ee[3].key]=e[ee[3].key]=ee[3],delete $[X])}for(const X in $){const ee=$[X],se=this.findLoadedParent(ee,this._source.minzoom),ce=this.findLoadedSibling(ee),de=se||ce||null;if(de){R[de.tileID.key]=e[de.tileID.key]=de.tileID;for(const ge in R)R[ge].isChildOf(de.tileID)&&delete R[ge]}}for(const X in this._tiles)R[X]||(this._coveredTiles[X]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new c.S(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y)):(u=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(u=u.filter(L=>this._source.hasTile(L)))):u=[];const d=e.coveringZoomLevel(this._source),f=Math.max(d-Xt.maxOverzooming,this._source.minzoom),S=Math.max(d+Xt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const L={};for(const R of u)if(R.canonical.z>this._source.minzoom){const $=R.scaledTo(R.canonical.z-1);L[$.key]=$;const X=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));L[X.key]=X}u=u.concat(Object.values(L))}const T=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,T&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=this._updateRetainedTiles(u,d);ti(this._source.type)&&this._updateCoveredAndRetainedTiles(I,f,S,d,u,s);for(const L in I)this._tiles[L].clearFadeHold();const M=c.ab(this._tiles,I);for(const L of M){const R=this._tiles[L];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(L)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var u;const d={},f={},S=Math.max(s-Xt.maxOverzooming,this._source.minzoom),T=Math.max(s+Xt.maxUnderzooming,this._source.minzoom),I={};for(const M of e){const L=this._addTile(M);d[M.key]=M,L.hasData()||s<this._source.maxzoom&&(I[M.key]=M)}this._retainLoadedChildren(I,s,T,d);for(const M of e){let L=this._tiles[M.key];if(L.hasData())continue;if(s+1>this._source.maxzoom){const $=M.children(this._source.maxzoom)[0],X=this.getTile($);if(X&&X.hasData()){d[$.key]=$;continue}}else{const $=M.children(this._source.maxzoom);if(d[$[0].key]&&d[$[1].key]&&d[$[2].key]&&d[$[3].key])continue}let R=L.wasRequested();for(let $=M.overscaledZ-1;$>=S;--$){const X=M.scaledTo($);if(f[X.key])break;if(f[X.key]=!0,L=this.getTile(X),!L&&R&&(L=this._addTile(X)),L){const ee=L.hasData();if((ee||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||R)&&(d[X.key]=X),R=L.wasRequested(),ee)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let u,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}s.push(d.key);const f=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(f),u)break;d=f}for(const f of s)this._loadedParentTiles[f]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,u=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=u}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const u=s;return s||(s=new en(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,u||this._source.fire(new c.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=s.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,u){const d=[],f=this.transform;if(!f)return d;const S=u?f.getCameraQueryGeometry(e):e,T=e.map(ee=>f.pointCoordinate(ee,this.terrain)),I=S.map(ee=>f.pointCoordinate(ee,this.terrain)),M=this.getIds();let L=1/0,R=1/0,$=-1/0,X=-1/0;for(const ee of I)L=Math.min(L,ee.x),R=Math.min(R,ee.y),$=Math.max($,ee.x),X=Math.max(X,ee.y);for(let ee=0;ee<M.length;ee++){const se=this._tiles[M[ee]];if(se.holdingForFade())continue;const ce=se.tileID,de=Math.pow(2,f.zoom-se.tileID.overscaledZ),ge=s*se.queryPadding*c.X/se.tileSize/de,ne=[ce.getTilePoint(new c.Z(L,R)),ce.getTilePoint(new c.Z($,X))];if(ne[0].x-ge<c.X&&ne[0].y-ge<c.X&&ne[1].x+ge>=0&&ne[1].y+ge>=0){const Te=T.map(Ne=>ce.getTilePoint(Ne)),Ae=I.map(Ne=>ce.getTilePoint(Ne));d.push({tile:se,tileID:ce,queryGeometry:Te,cameraQueryGeometry:Ae,scale:de})}}return d}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(const u of s)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(ti(this._source.type)){const e=Q.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,u){this._state.updateState(e=e||"_geojsonTileLayer",s,u)}removeFeatureState(e,s,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,u)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,u){const d=this._tiles[e];d&&d.setDependencies(s,u)}reloadTilesForDependencies(e,s){for(const u in this._tiles)this._tiles[u].hasDependency(e,s)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,s))}}function Ot(m,e){const s=Math.abs(2*m.wrap)-+(m.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||u-s||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function ti(m){return m==="raster"||m==="image"||m==="video"}Xt.maxOverzooming=10,Xt.maxUnderzooming=3;class rr{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ac(e,0,1);let s=1,u=this._distances[s];const d=e*this.paddedLength+this.padding;for(;u<d&&s<this._distances.length;)u=this._distances[++s];const f=s-1,S=this._distances[f],T=u-S,I=T>0?(d-S)/T:0;return this.points[f].mult(1-I).add(this.points[s].mult(I))}}function wi(m,e){let s=!0;return m==="always"||m!=="never"&&e!=="never"||(s=!1),s}class St{constructor(e,s,u){const d=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(s/u);for(let S=0;S<this.xCellCount*this.yCellCount;S++)d.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,u,d,f){this._forEachCell(s,u,d,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(f)}insertCircle(e,s,u,d){this._forEachCell(s-d,u-d,s+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(u),this.circles.push(d)}_insertBoxCell(e,s,u,d,f,S){this.boxCells[f].push(S)}_insertCircleCell(e,s,u,d,f,S){this.circleCells[f].push(S)}_query(e,s,u,d,f,S,T){if(u<0||e>this.width||d<0||s>this.height)return[];const I=[];if(e<=0&&s<=0&&this.width<=u&&this.height<=d){if(f)return[{key:null,x1:e,y1:s,x2:u,y2:d}];for(let M=0;M<this.boxKeys.length;M++)I.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const L=this.circles[3*M],R=this.circles[3*M+1],$=this.circles[3*M+2];I.push({key:this.circleKeys[M],x1:L-$,y1:R-$,x2:L+$,y2:R+$})}}else this._forEachCell(e,s,u,d,this._queryCell,I,{hitTest:f,overlapMode:S,seenUids:{box:{},circle:{}}},T);return I}query(e,s,u,d){return this._query(e,s,u,d,!1,null)}hitTest(e,s,u,d,f,S){return this._query(e,s,u,d,!0,f,S).length>0}hitTestCircle(e,s,u,d,f){const S=e-u,T=e+u,I=s-u,M=s+u;if(T<0||S>this.width||M<0||I>this.height)return!1;const L=[];return this._forEachCell(S,I,T,M,this._queryCellCircle,L,{hitTest:!0,overlapMode:d,circle:{x:e,y:s,radius:u},seenUids:{box:{},circle:{}}},f),L.length>0}_queryCell(e,s,u,d,f,S,T,I){const{seenUids:M,hitTest:L,overlapMode:R}=T,$=this.boxCells[f];if($!==null){const ee=this.bboxes;for(const se of $)if(!M.box[se]){M.box[se]=!0;const ce=4*se,de=this.boxKeys[se];if(e<=ee[ce+2]&&s<=ee[ce+3]&&u>=ee[ce+0]&&d>=ee[ce+1]&&(!I||I(de))&&(!L||!wi(R,de.overlapMode))&&(S.push({key:de,x1:ee[ce],y1:ee[ce+1],x2:ee[ce+2],y2:ee[ce+3]}),L))return!0}}const X=this.circleCells[f];if(X!==null){const ee=this.circles;for(const se of X)if(!M.circle[se]){M.circle[se]=!0;const ce=3*se,de=this.circleKeys[se];if(this._circleAndRectCollide(ee[ce],ee[ce+1],ee[ce+2],e,s,u,d)&&(!I||I(de))&&(!L||!wi(R,de.overlapMode))){const ge=ee[ce],ne=ee[ce+1],Te=ee[ce+2];if(S.push({key:de,x1:ge-Te,y1:ne-Te,x2:ge+Te,y2:ne+Te}),L)return!0}}}return!1}_queryCellCircle(e,s,u,d,f,S,T,I){const{circle:M,seenUids:L,overlapMode:R}=T,$=this.boxCells[f];if($!==null){const ee=this.bboxes;for(const se of $)if(!L.box[se]){L.box[se]=!0;const ce=4*se,de=this.boxKeys[se];if(this._circleAndRectCollide(M.x,M.y,M.radius,ee[ce+0],ee[ce+1],ee[ce+2],ee[ce+3])&&(!I||I(de))&&!wi(R,de.overlapMode))return S.push(!0),!0}}const X=this.circleCells[f];if(X!==null){const ee=this.circles;for(const se of X)if(!L.circle[se]){L.circle[se]=!0;const ce=3*se,de=this.circleKeys[se];if(this._circlesCollide(ee[ce],ee[ce+1],ee[ce+2],M.x,M.y,M.radius)&&(!I||I(de))&&!wi(R,de.overlapMode))return S.push(!0),!0}}}_forEachCell(e,s,u,d,f,S,T,I){const M=this._convertToXCellCoord(e),L=this._convertToYCellCoord(s),R=this._convertToXCellCoord(u),$=this._convertToYCellCoord(d);for(let X=M;X<=R;X++)for(let ee=L;ee<=$;ee++)if(f.call(this,e,s,u,d,this.xCellCount*ee+X,S,T,I))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,u,d,f,S){const T=d-e,I=f-s,M=u+S;return M*M>T*T+I*I}_circleAndRectCollide(e,s,u,d,f,S,T){const I=(S-d)/2,M=Math.abs(e-(d+I));if(M>I+u)return!1;const L=(T-f)/2,R=Math.abs(s-(f+L));if(R>L+u)return!1;if(M<=I||R<=L)return!0;const $=M-I,X=R-L;return $*$+X*X<=u*u}}function ca(m,e,s,u,d){const f=c.H();return e?(c.K(f,f,[1/d,1/d,1]),s||c.ad(f,f,u.angle)):c.L(f,u.labelPlaneMatrix,m),f}function Xi(m,e,s,u,d){if(e){const f=c.ae(m);return c.K(f,f,[d,d,1]),s||c.ad(f,f,-u.angle),f}return u.glCoordMatrix}function oe(m,e,s,u){let d;u?(d=[m,e,u(m,e),1],c.af(d,d,s)):(d=[m,e,0,1],zr(d,d,s));const f=d[3];return{point:new c.P(d[0]/f,d[1]/f),signedDistanceFromCamera:f,isOccluded:!1}}function j(m,e){return .5+m/e*.5}function N(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function Z(m,e,s,u,d,f,S,T,I,M,L,R,$,X,ee){const se=u?m.textSizeData:m.iconSizeData,ce=c.ag(se,s.transform.zoom),de=[256/s.width*2+1,256/s.height*2+1],ge=u?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ge.clear();const ne=m.lineVertexArray,Te=u?m.text.placedSymbolArray:m.icon.placedSymbolArray,Ae=s.transform.width/s.transform.height;let Ne=!1;for(let Qe=0;Qe<Te.length;Qe++){const ut=Te.get(Qe);if(ut.hidden||ut.writingMode===c.ah.vertical&&!Ne){Wt(ut.numGlyphs,ge);continue}Ne=!1;const bt=oe(ut.anchorX,ut.anchorY,e,ee);if(!N(bt.point,de)){Wt(ut.numGlyphs,ge);continue}const At=j(s.transform.cameraToCenterDistance,bt.signedDistanceFromCamera),yt=c.ai(se,ce,ut),gt=S?yt/At:yt*At,$t={getElevation:ee,labelPlaneMatrix:d,lineVertexArray:ne,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:M,tileAnchorPoint:new c.P(ut.anchorX,ut.anchorY),unwrappedTileID:L,width:R,height:$,translation:X},cr=Se($t,ut,gt,!1,T,e,f,m.glyphOffsetArray,ge,Ae,I);Ne=cr.useVertical,(cr.notEnoughRoom||Ne||cr.needsFlipping&&Se($t,ut,gt,!0,T,e,f,m.glyphOffsetArray,ge,Ae,I).notEnoughRoom)&&Wt(ut.numGlyphs,ge)}u?m.text.dynamicLayoutVertexBuffer.updateData(ge):m.icon.dynamicLayoutVertexBuffer.updateData(ge)}function ie(m,e,s,u,d,f,S,T){const I=f.glyphStartIndex+f.numGlyphs,M=f.lineStartIndex,L=f.lineStartIndex+f.lineLength,R=e.getoffsetX(f.glyphStartIndex),$=e.getoffsetX(I-1),X=ht(m*R,s,u,d,f.segment,M,L,T,S);if(!X)return null;const ee=ht(m*$,s,u,d,f.segment,M,L,T,S);return ee?T.projectionCache.anyProjectionOccluded?null:{first:X,last:ee}:null}function ye(m,e,s,u){return m===c.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*u?{useVertical:!0}:(m===c.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function Se(m,e,s,u,d,f,S,T,I,M,L){const R=s/24,$=e.lineOffsetX*R,X=e.lineOffsetY*R;let ee;if(e.numGlyphs>1){const se=e.glyphStartIndex+e.numGlyphs,ce=e.lineStartIndex,de=e.lineStartIndex+e.lineLength,ge=ie(R,T,$,X,u,e,L,m);if(!ge)return{notEnoughRoom:!0};const ne=oe(ge.first.point.x,ge.first.point.y,S,m.getElevation).point,Te=oe(ge.last.point.x,ge.last.point.y,S,m.getElevation).point;if(d&&!u){const Ae=ye(e.writingMode,ne,Te,M);if(Ae)return Ae}ee=[ge.first];for(let Ae=e.glyphStartIndex+1;Ae<se-1;Ae++)ee.push(ht(R*T.getoffsetX(Ae),$,X,u,e.segment,ce,de,m,L));ee.push(ge.last)}else{if(d&&!u){const ce=oe(m.tileAnchorPoint.x,m.tileAnchorPoint.y,f,m.getElevation).point,de=e.lineStartIndex+e.segment+1,ge=new c.P(m.lineVertexArray.getx(de),m.lineVertexArray.gety(de)),ne=oe(ge.x,ge.y,f,m.getElevation),Te=ne.signedDistanceFromCamera>0?ne.point:function(Ne,Qe,ut,bt,At,yt){return ze(Ne,Qe,ut,1,At,yt)}(m.tileAnchorPoint,ge,ce,0,f,m),Ae=ye(e.writingMode,ce,Te,M);if(Ae)return Ae}const se=ht(R*T.getoffsetX(e.glyphStartIndex),$,X,u,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,m,L);if(!se||m.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ee=[se]}for(const se of ee)c.aj(I,se.point,se.angle);return{}}function ze(m,e,s,u,d,f){const S=m.add(m.sub(e)._unit()),T=d!==void 0?oe(S.x,S.y,d,f.getElevation).point:Ue(S.x,S.y,f).point,I=s.sub(T);return s.add(I._mult(u/I.mag()))}function pe(m,e,s){const u=e.projectionCache;if(u.projections[m])return u.projections[m];const d=new c.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),f=Ue(d.x,d.y,e);if(f.signedDistanceFromCamera>0)return u.projections[m]=f.point,u.anyProjectionOccluded=u.anyProjectionOccluded||f.isOccluded,f.point;const S=m-s.direction;return function(T,I,M,L,R){return ze(T,I,M,L,void 0,R)}(s.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(S),e.lineVertexArray.gety(S)),d,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function Ue(m,e,s){const u=m+s.translation[0],d=e+s.translation[1];let f;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(f=s.projection.projectTileCoordinates(u,d,s.unwrappedTileID,s.getElevation),f.point.x=(.5*f.point.x+.5)*s.width,f.point.y=(.5*-f.point.y+.5)*s.height):(f=oe(u,d,s.labelPlaneMatrix,s.getElevation),f.isOccluded=!1),f}function We(m,e,s){return m._unit()._perp()._mult(e*s)}function qe(m,e,s,u,d,f,S,T,I){if(T.projectionCache.offsets[m])return T.projectionCache.offsets[m];const M=s.add(e);if(m+I.direction<u||m+I.direction>=d)return T.projectionCache.offsets[m]=M,M;const L=pe(m+I.direction,T,I),R=We(L.sub(s),S,I.direction),$=s.add(R),X=L.add(R);return T.projectionCache.offsets[m]=c.ak(f,M,$,X)||M,T.projectionCache.offsets[m]}function ht(m,e,s,u,d,f,S,T,I){const M=u?m-e:m+e;let L=M>0?1:-1,R=0;u&&(L*=-1,R=Math.PI),L<0&&(R+=Math.PI);let $,X=L>0?f+d:f+d+1;T.projectionCache.cachedAnchorPoint?$=T.projectionCache.cachedAnchorPoint:($=Ue(T.tileAnchorPoint.x,T.tileAnchorPoint.y,T).point,T.projectionCache.cachedAnchorPoint=$);let ee,se,ce=$,de=$,ge=0,ne=0;const Te=Math.abs(M),Ae=[];let Ne;for(;ge+ne<=Te;){if(X+=L,X<f||X>=S)return null;ge+=ne,de=ce,se=ee;const bt={absOffsetX:Te,direction:L,distanceFromAnchor:ge,previousVertex:de};if(ce=pe(X,T,bt),s===0)Ae.push(de),Ne=ce.sub(de);else{let At;const yt=ce.sub(de);At=yt.mag()===0?We(pe(X+L,T,bt).sub(ce),s,L):We(yt,s,L),se||(se=de.add(At)),ee=qe(X,At,ce,f,S,se,s,T,bt),Ae.push(se),Ne=ee.sub(se)}ne=Ne.mag()}const Qe=Ne._mult((Te-ge)/ne)._add(se||de),ut=R+Math.atan2(ce.y-de.y,ce.x-de.x);return Ae.push(Qe),{point:Qe,angle:I?ut:0,path:Ae}}const Ut=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Wt(m,e){for(let s=0;s<m;s++){const u=e.length;e.resize(u+4),e.float32.set(Ut,3*u)}}function zr(m,e,s){const u=e[0],d=e[1];return m[0]=s[0]*u+s[4]*d+s[12],m[1]=s[1]*u+s[5]*d+s[13],m[3]=s[3]*u+s[7]*d+s[15],m}const nr=100;class wr{constructor(e,s,u=new St(e.width+200,e.height+200,25),d=new St(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=u,this.ignoredGrid=d,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+nr,this.screenBottomBoundary=e.height+nr,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,u,d,f,S,T,I,M,L,R){const $=e.anchorPointX+I[0],X=e.anchorPointY+I[1],ee=this.projectAndGetPerspectiveRatio(d,$,X,f,L),se=u*ee.perspectiveRatio;let ce;if(S||T)ce=this._projectCollisionBox(e,se,d,f,S,T,I,ee,L,R);else{const Ae=ee.point.x+(R?R.x*se:0),Ne=ee.point.y+(R?R.y*se:0);ce={allPointsOccluded:!1,box:[Ae+e.x1*se,Ne+e.y1*se,Ae+e.x2*se,Ne+e.y2*se]}}const[de,ge,ne,Te]=ce.box;return this.mapProjection.useSpecialProjectionForSymbols&&(S?ce.allPointsOccluded:this.mapProjection.isOccluded($,X,f))||ee.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(de,ge,ne,Te)||s!=="always"&&this.grid.hitTest(de,ge,ne,Te,s,M)?{box:[de,ge,ne,Te],placeable:!1,offscreen:!1}:{box:[de,ge,ne,Te],placeable:!0,offscreen:this.isOffscreen(de,ge,ne,Te)}}placeCollisionCircles(e,s,u,d,f,S,T,I,M,L,R,$,X,ee,se,ce){const de=[],ge=new c.P(s.anchorX,s.anchorY),ne=this.getPerspectiveRatio(S,ge.x,ge.y,T,ce),Te=(R?f/ne:f*ne)/c.ap,Ae={getElevation:ce,labelPlaneMatrix:I,lineVertexArray:u,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ge,unwrappedTileID:T,width:this.transform.width,height:this.transform.height,translation:se},Ne=ie(Te,d,s.lineOffsetX*Te,s.lineOffsetY*Te,!1,s,!1,Ae);let Qe=!1,ut=!1,bt=!0;if(Ne){const At=.5*X*ne+ee,yt=new c.P(-100,-100),gt=new c.P(this.screenRightBoundary,this.screenBottomBoundary),$t=new rr,cr=Ne.first,vt=Ne.last;let Pt=[];for(let yr=cr.path.length-1;yr>=1;yr--)Pt.push(cr.path[yr]);for(let yr=1;yr<vt.path.length;yr++)Pt.push(vt.path[yr]);const sr=2.5*At;if(M){const yr=this.projectPathToScreenSpace(Pt,Ae,M);Pt=yr.some(Tr=>Tr.signedDistanceFromCamera<=0)?[]:yr.map(Tr=>Tr.point)}let ln=[];if(Pt.length>0){const yr=Pt[0].clone(),Tr=Pt[0].clone();for(let un=1;un<Pt.length;un++)yr.x=Math.min(yr.x,Pt[un].x),yr.y=Math.min(yr.y,Pt[un].y),Tr.x=Math.max(Tr.x,Pt[un].x),Tr.y=Math.max(Tr.y,Pt[un].y);ln=yr.x>=yt.x&&Tr.x<=gt.x&&yr.y>=yt.y&&Tr.y<=gt.y?[Pt]:Tr.x<yt.x||yr.x>gt.x||Tr.y<yt.y||yr.y>gt.y?[]:c.al([Pt],yt.x,yt.y,gt.x,gt.y)}for(const yr of ln){$t.reset(yr,.25*At);let Tr=0;Tr=$t.length<=.5*At?1:Math.ceil($t.paddedLength/sr)+1;for(let un=0;un<Tr;un++){const di=un/Math.max(Tr-1,1),Oa=$t.lerp(di),cn=Oa.x+nr,ji=Oa.y+nr;de.push(cn,ji,At,0);const Ci=cn-At,pi=ji-At,Ti=cn+At,ls=ji+At;if(bt=bt&&this.isOffscreen(Ci,pi,Ti,ls),ut=ut||this.isInsideGrid(Ci,pi,Ti,ls),e!=="always"&&this.grid.hitTestCircle(cn,ji,At,e,$)&&(Qe=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Qe}}}}return{circles:!L&&Qe||!ut||ne<this.perspectiveRatioCutoff?[]:de,offscreen:bt,collisionDetected:Qe}}projectPathToScreenSpace(e,s,u){return e.map(d=>oe(d.x,d.y,u,s.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let u=1/0,d=1/0,f=-1/0,S=-1/0;for(const L of e){const R=new c.P(L.x+nr,L.y+nr);u=Math.min(u,R.x),d=Math.min(d,R.y),f=Math.max(f,R.x),S=Math.max(S,R.y),s.push(R)}const T=this.grid.query(u,d,f,S).concat(this.ignoredGrid.query(u,d,f,S)),I={},M={};for(const L of T){const R=L.key;if(I[R.bucketInstanceId]===void 0&&(I[R.bucketInstanceId]={}),I[R.bucketInstanceId][R.featureIndex])continue;const $=[new c.P(L.x1,L.y1),new c.P(L.x2,L.y1),new c.P(L.x2,L.y2),new c.P(L.x1,L.y2)];c.am(s,$)&&(I[R.bucketInstanceId][R.featureIndex]=!0,M[R.bucketInstanceId]===void 0&&(M[R.bucketInstanceId]=[]),M[R.bucketInstanceId].push(R.featureIndex))}return M}insertCollisionBox(e,s,u,d,f,S){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:f,collisionGroupID:S,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,u,d,f,S){const T=u?this.ignoredGrid:this.grid,I={bucketInstanceId:d,featureIndex:f,collisionGroupID:S,overlapMode:s};for(let M=0;M<e.length;M+=4)T.insertCircle(I,e[M],e[M+1],e[M+2])}projectAndGetPerspectiveRatio(e,s,u,d,f){let S;f?(S=[s,u,f(s,u),1],c.af(S,S,e)):(S=[s,u,0,1],zr(S,S,e));const T=S[3];return{point:new c.P((S[0]/T+1)/2*this.transform.width+nr,(-S[1]/T+1)/2*this.transform.height+nr),perspectiveRatio:.5+this.transform.cameraToCenterDistance/T*.5,isOccluded:!1,signedDistanceFromCamera:T}}getPerspectiveRatio(e,s,u,d,f){const S=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,u,d,f):oe(s,u,e,f);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(e,s,u,d){return u<nr||e>=this.screenRightBoundary||d<nr||s>this.screenBottomBoundary}isInsideGrid(e,s,u,d){return u>=0&&e<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=c.an([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,u,d,f,S,T,I,M,L){let R=new c.P(1,0),$=new c.P(0,1);const X=new c.P(e.anchorPointX+T[0],e.anchorPointY+T[1]);if(S&&!f){const bt=this.projectAndGetPerspectiveRatio(u,X.x+1,X.y,d,M).point.sub(I.point).unit(),At=Math.atan(bt.y/bt.x)+(bt.x<0?Math.PI:0),yt=Math.sin(At),gt=Math.cos(At);R=new c.P(gt,yt),$=new c.P(-yt,gt)}else if(!S&&f){const bt=-this.transform.angle,At=Math.sin(bt),yt=Math.cos(bt);R=new c.P(yt,At),$=new c.P(-At,yt)}let ee=I.point,se=s;if(f){ee=X;const bt=this.transform.zoom-Math.floor(this.transform.zoom);se=Math.pow(2,-bt),se*=this.mapProjection.getPitchedTextCorrection(this.transform,X,d),L||(se*=c.ac(.5+I.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}L&&(ee=ee.add(R.mult(L.x*se)).add($.mult(L.y*se)));const ce=e.x1*se,de=e.x2*se,ge=(ce+de)/2,ne=e.y1*se,Te=e.y2*se,Ae=(ne+Te)/2,Ne=[{offsetX:ce,offsetY:ne},{offsetX:ge,offsetY:ne},{offsetX:de,offsetY:ne},{offsetX:de,offsetY:Ae},{offsetX:de,offsetY:Te},{offsetX:ge,offsetY:Te},{offsetX:ce,offsetY:Te},{offsetX:ce,offsetY:Ae}];let Qe=[];for(const{offsetX:bt,offsetY:At}of Ne)Qe.push(new c.P(ee.x+R.x*bt+$.x*At,ee.y+R.y*bt+$.y*At));let ut=!1;if(f){const bt=Qe.map(At=>this.projectAndGetPerspectiveRatio(u,At.x,At.y,d,M));ut=bt.some(At=>!At.isOccluded),Qe=bt.map(At=>At.point)}else ut=!0;return{box:c.ao(Qe),allPointsOccluded:!ut}}}function dr(m,e,s){return e*(c.X/(m.tileSize*Math.pow(2,s-m.tileID.overscaledZ)))}class dn{constructor(e,s,u,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class pn{constructor(e,s,u,d,f){this.text=new dn(e?e.text:null,s,u,f),this.icon=new dn(e?e.icon:null,s,d,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ur{constructor(e,s,u){this.text=e,this.icon=s,this.skipFade=u}}class jr{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class Ur{constructor(e,s,u,d,f){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=f}}class Mn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[e]}}function Dn(m,e,s,u,d){const{horizontalAlign:f,verticalAlign:S}=c.au(m);return new c.P(-(f-.5)*e+u[0]*d,-(S-.5)*s+u[1]*d)}class Lr{constructor(e,s,u,d,f,S){this.transform=e.clone(),this.terrain=u,this.collisionIndex=new wr(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Mn(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(u,d)=>s.getElevation(e,u,d):null}getBucketParts(e,s,u,d){const f=u.getBucket(s),S=u.latestFeatureIndex;if(!f||!S||s.id!==f.layerIds[0])return;const T=u.collisionBoxArray,I=f.layers[0].layout,M=f.layers[0].paint,L=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),R=u.tileSize/c.X,$=u.tileID.toUnwrapped(),X=this.transform.calculatePosMatrix($),ee=I.get("text-pitch-alignment")==="map",se=I.get("text-rotation-alignment")==="map",ce=dr(u,1,this.transform.zoom),de=this.collisionIndex.mapProjection.translatePosition(this.transform,u,M.get("text-translate"),M.get("text-translate-anchor")),ge=this.collisionIndex.mapProjection.translatePosition(this.transform,u,M.get("icon-translate"),M.get("icon-translate-anchor")),ne=ca(X,ee,se,this.transform,ce);let Te=null;if(ee){const Ne=Xi(X,ee,se,this.transform,ce);Te=c.L([],this.transform.labelPlaneMatrix,Ne)}this.retainedQueryData[f.bucketInstanceId]=new Ur(f.bucketInstanceId,S,f.sourceLayerIndex,f.index,u.tileID);const Ae={bucket:f,layout:I,translationText:de,translationIcon:ge,posMatrix:X,unwrappedTileID:$,textLabelPlaneMatrix:ne,labelToScreenMatrix:Te,scale:L,textPixelRatio:R,holdingForFade:u.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:c.ag(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(d)for(const Ne of f.sortKeyRanges){const{sortKey:Qe,symbolInstanceStart:ut,symbolInstanceEnd:bt}=Ne;e.push({sortKey:Qe,symbolInstanceStart:ut,symbolInstanceEnd:bt,parameters:Ae})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:Ae})}attemptAnchorPlacement(e,s,u,d,f,S,T,I,M,L,R,$,X,ee,se,ce,de,ge,ne){const Te=c.aq[e.textAnchor],Ae=[e.textOffset0,e.textOffset1],Ne=Dn(Te,u,d,Ae,f),Qe=this.collisionIndex.placeCollisionBox(s,$,I,M,L,T,S,ce,R.predicate,ne,Ne);if((!ge||this.collisionIndex.placeCollisionBox(ge,$,I,M,L,T,S,de,R.predicate,ne,Ne).placeable)&&Qe.placeable){let ut;if(this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(ut=this.prevPlacement.variableOffsets[X.crossTileID].anchor),X.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[X.crossTileID]={textOffset:Ae,width:u,height:d,anchor:Te,textBoxScale:f,prevAnchor:ut},this.markUsedJustification(ee,Te,X,se),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,se,X),this.placedOrientations[X.crossTileID]=se),{shift:Ne,placedGlyphBoxes:Qe}}}placeLayerBucketPart(e,s,u){const{bucket:d,layout:f,translationText:S,translationIcon:T,posMatrix:I,unwrappedTileID:M,textLabelPlaneMatrix:L,labelToScreenMatrix:R,textPixelRatio:$,holdingForFade:X,collisionBoxArray:ee,partiallyEvaluatedTextSize:se,collisionGroup:ce}=e.parameters,de=f.get("text-optional"),ge=f.get("icon-optional"),ne=c.ar(f,"text-overlap","text-allow-overlap"),Te=ne==="always",Ae=c.ar(f,"icon-overlap","icon-allow-overlap"),Ne=Ae==="always",Qe=f.get("text-rotation-alignment")==="map",ut=f.get("text-pitch-alignment")==="map",bt=f.get("icon-text-fit")!=="none",At=f.get("symbol-z-order")==="viewport-y",yt=Te&&(Ne||!d.hasIconData()||ge),gt=Ne&&(Te||!d.hasTextData()||de);!d.collisionArrays&&ee&&d.deserializeCollisionBoxes(ee);const $t=this._getTerrainElevationFunc(this.retainedQueryData[d.bucketInstanceId].tileID),cr=(vt,Pt,sr)=>{var ln,yr;if(s[vt.crossTileID])return;if(X)return void(this.placements[vt.crossTileID]=new ur(!1,!1,!1));let Tr=!1,un=!1,di=!0,Oa=null,cn={box:null,placeable:!1,offscreen:null},ji={placeable:!1},Ci=null,pi=null,Ti=null,ls=0,ll=0,Qu=0;Pt.textFeatureIndex?ls=Pt.textFeatureIndex:vt.useRuntimeCollisionCircles&&(ls=vt.featureIndex),Pt.verticalTextFeatureIndex&&(ll=Pt.verticalTextFeatureIndex);const ul=Pt.textBox;if(ul){const xa=si=>{let fi=c.ah.horizontal;if(d.allowVerticalPlacement&&!si&&this.prevPlacement){const ra=this.prevPlacement.placedOrientations[vt.crossTileID];ra&&(this.placedOrientations[vt.crossTileID]=ra,fi=ra,this.markUsedOrientation(d,fi,vt))}return fi},ba=(si,fi)=>{if(d.allowVerticalPlacement&&vt.numVerticalGlyphVertices>0&&Pt.verticalTextBox){for(const ra of d.writingModes)if(ra===c.ah.vertical?(cn=fi(),ji=cn):cn=si(),cn&&cn.placeable)break}else cn=si()},Js=vt.textAnchorOffsetStartIndex,Fa=vt.textAnchorOffsetEndIndex;if(Fa===Js){const si=(fi,ra)=>{const Ar=this.collisionIndex.placeCollisionBox(fi,ne,$,I,M,ut,Qe,S,ce.predicate,$t);return Ar&&Ar.placeable&&(this.markUsedOrientation(d,ra,vt),this.placedOrientations[vt.crossTileID]=ra),Ar};ba(()=>si(ul,c.ah.horizontal),()=>{const fi=Pt.verticalTextBox;return d.allowVerticalPlacement&&vt.numVerticalGlyphVertices>0&&fi?si(fi,c.ah.vertical):{box:null,offscreen:null}}),xa(cn&&cn.placeable)}else{let si=c.aq[(yr=(ln=this.prevPlacement)===null||ln===void 0?void 0:ln.variableOffsets[vt.crossTileID])===null||yr===void 0?void 0:yr.anchor];const fi=(Ar,Po,cl)=>{const hl=Ar.x2-Ar.x1,Od=Ar.y2-Ar.y1,Zf=vt.textBoxScale,Fd=bt&&Ae==="never"?Po:null;let Qs=null,Bd=ne==="never"?1:2,tc="never";si&&Bd++;for(let ou=0;ou<Bd;ou++){for(let rc=Js;rc<Fa;rc++){const nc=d.textAnchorOffsets.get(rc);if(si&&nc.textAnchor!==si)continue;const dl=this.attemptAnchorPlacement(nc,Ar,hl,Od,Zf,Qe,ut,$,I,M,ce,tc,vt,d,cl,S,T,Fd,$t);if(dl&&(Qs=dl.placedGlyphBoxes,Qs&&Qs.placeable))return Tr=!0,Oa=dl.shift,Qs}si?si=null:tc=ne}return u&&!Qs&&(Qs={box:this.collisionIndex.placeCollisionBox(ul,"always",$,I,M,ut,Qe,S,ce.predicate,$t,new c.P(0,0)).box,offscreen:!1,placeable:!1}),Qs};ba(()=>fi(ul,Pt.iconBox,c.ah.horizontal),()=>{const Ar=Pt.verticalTextBox;return d.allowVerticalPlacement&&(!cn||!cn.placeable)&&vt.numVerticalGlyphVertices>0&&Ar?fi(Ar,Pt.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}}),cn&&(Tr=cn.placeable,di=cn.offscreen);const ra=xa(cn&&cn.placeable);if(!Tr&&this.prevPlacement){const Ar=this.prevPlacement.variableOffsets[vt.crossTileID];Ar&&(this.variableOffsets[vt.crossTileID]=Ar,this.markUsedJustification(d,Ar.anchor,vt,ra))}}}if(Ci=cn,Tr=Ci&&Ci.placeable,di=Ci&&Ci.offscreen,vt.useRuntimeCollisionCircles){const xa=d.text.placedSymbolArray.get(vt.centerJustifiedTextSymbolIndex),ba=c.ai(d.textSizeData,se,xa),Js=f.get("text-padding");pi=this.collisionIndex.placeCollisionCircles(ne,xa,d.lineVertexArray,d.glyphOffsetArray,ba,I,M,L,R,u,ut,ce.predicate,vt.collisionCircleDiameter,Js,S,$t),pi.circles.length&&pi.collisionDetected&&!u&&c.w("Collisions detected, but collision boxes are not shown"),Tr=Te||pi.circles.length>0&&!pi.collisionDetected,di=di&&pi.offscreen}if(Pt.iconFeatureIndex&&(Qu=Pt.iconFeatureIndex),Pt.iconBox){const xa=ba=>this.collisionIndex.placeCollisionBox(ba,Ae,$,I,M,ut,Qe,T,ce.predicate,$t,bt&&Oa?Oa:void 0);ji&&ji.placeable&&Pt.verticalIconBox?(Ti=xa(Pt.verticalIconBox),un=Ti.placeable):(Ti=xa(Pt.iconBox),un=Ti.placeable),di=di&&Ti.offscreen}const va=de||vt.numHorizontalGlyphVertices===0&&vt.numVerticalGlyphVertices===0,ec=ge||vt.numIconVertices===0;va||ec?ec?va||(un=un&&Tr):Tr=un&&Tr:un=Tr=un&&Tr;const mh=un&&Ti.placeable;if(Tr&&Ci.placeable&&this.collisionIndex.insertCollisionBox(Ci.box,ne,f.get("text-ignore-placement"),d.bucketInstanceId,ji&&ji.placeable&&ll?ll:ls,ce.ID),mh&&this.collisionIndex.insertCollisionBox(Ti.box,Ae,f.get("icon-ignore-placement"),d.bucketInstanceId,Qu,ce.ID),pi&&Tr&&this.collisionIndex.insertCollisionCircles(pi.circles,ne,f.get("text-ignore-placement"),d.bucketInstanceId,ls,ce.ID),u&&this.storeCollisionData(d.bucketInstanceId,sr,Pt,Ci,Ti,pi),vt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[vt.crossTileID]=new ur(Tr||yt,un||gt,di||d.justReloaded),s[vt.crossTileID]=!0};if(At){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const vt=d.getSortedSymbolIndexes(this.transform.angle);for(let Pt=vt.length-1;Pt>=0;--Pt){const sr=vt[Pt];cr(d.symbolInstances.get(sr),d.collisionArrays[sr],sr)}}else for(let vt=e.symbolInstanceStart;vt<e.symbolInstanceEnd;vt++)cr(d.symbolInstances.get(vt),d.collisionArrays[vt],vt);if(u&&d.bucketInstanceId in this.collisionCircleArrays){const vt=this.collisionCircleArrays[d.bucketInstanceId];c.as(vt.invProjMatrix,I),vt.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}storeCollisionData(e,s,u,d,f,S){if(u.textBox||u.iconBox){let T,I;this.collisionBoxArrays.has(e)?T=this.collisionBoxArrays.get(e):(T=new Map,this.collisionBoxArrays.set(e,T)),T.has(s)?I=T.get(s):(I={text:null,icon:null},T.set(s,I)),u.textBox&&(I.text=d.box),u.iconBox&&(I.icon=f.box)}if(S){let T=this.collisionCircleArrays[e];T===void 0&&(T=this.collisionCircleArrays[e]=new jr);for(let I=0;I<S.circles.length;I+=4)T.circles.push(S.circles[I+0]),T.circles.push(S.circles[I+1]),T.circles.push(S.circles[I+2]),T.circles.push(S.collisionDetected?1:0)}}markUsedJustification(e,s,u,d){let f;f=d===c.ah.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[c.at(s)];const S=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const T of S)T>=0&&(e.text.placedSymbolArray.get(T).crossTileID=f>=0&&T!==f?0:u.crossTileID)}markUsedOrientation(e,s,u){const d=s===c.ah.horizontal||s===c.ah.horizontalOnly?s:0,f=s===c.ah.vertical?s:0,S=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const T of S)e.text.placedSymbolArray.get(T).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const d=s?s.symbolFadeChange(e):1,f=s?s.opacities:{},S=s?s.variableOffsets:{},T=s?s.placedOrientations:{};for(const I in this.placements){const M=this.placements[I],L=f[I];L?(this.opacities[I]=new pn(L,d,M.text,M.icon),u=u||M.text!==L.text.placed||M.icon!==L.icon.placed):(this.opacities[I]=new pn(null,d,M.text,M.icon,M.skipFade),u=u||M.text||M.icon)}for(const I in f){const M=f[I];if(!this.opacities[I]){const L=new pn(M,d,!1,!1);L.isHidden()||(this.opacities[I]=L,u=u||M.text.placed||M.icon.placed)}}for(const I in S)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=S[I]);for(const I in T)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=T[I]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const u={};for(const d of s){const f=d.getBucket(e);f&&d.latestFeatureIndex&&e.id===f.layerIds[0]&&this.updateBucketOpacities(f,d.tileID,u,d.collisionBoxArray)}}updateBucketOpacities(e,s,u,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const f=e.layers[0],S=f.layout,T=new pn(null,0,!1,!1,!0),I=S.get("text-allow-overlap"),M=S.get("icon-allow-overlap"),L=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=S.get("text-rotation-alignment")==="map",$=S.get("text-pitch-alignment")==="map",X=S.get("icon-text-fit")!=="none",ee=new pn(null,0,I&&(M||!e.hasIconData()||S.get("icon-optional")),M&&(I||!e.hasTextData()||S.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);const se=(de,ge,ne)=>{for(let Te=0;Te<ge/4;Te++)de.opacityVertexArray.emplaceBack(ne);de.hasVisibleVertices=de.hasVisibleVertices||ne!==Ea},ce=this.collisionBoxArrays.get(e.bucketInstanceId);for(let de=0;de<e.symbolInstances.length;de++){const ge=e.symbolInstances.get(de),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:Te,crossTileID:Ae}=ge;let Ne=this.opacities[Ae];u[Ae]?Ne=T:Ne||(Ne=ee,this.opacities[Ae]=Ne),u[Ae]=!0;const Qe=ge.numIconVertices>0,ut=this.placedOrientations[ge.crossTileID],bt=ut===c.ah.vertical,At=ut===c.ah.horizontal||ut===c.ah.horizontalOnly;if(ne>0||Te>0){const gt=ci(Ne.text);se(e.text,ne,bt?Ea:gt),se(e.text,Te,At?Ea:gt);const $t=Ne.text.isHidden();[ge.rightJustifiedTextSymbolIndex,ge.centerJustifiedTextSymbolIndex,ge.leftJustifiedTextSymbolIndex].forEach(Pt=>{Pt>=0&&(e.text.placedSymbolArray.get(Pt).hidden=$t||bt?1:0)}),ge.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ge.verticalPlacedTextSymbolIndex).hidden=$t||At?1:0);const cr=this.variableOffsets[ge.crossTileID];cr&&this.markUsedJustification(e,cr.anchor,ge,ut);const vt=this.placedOrientations[ge.crossTileID];vt&&(this.markUsedJustification(e,"left",ge,vt),this.markUsedOrientation(e,vt,ge))}if(Qe){const gt=ci(Ne.icon),$t=!(X&&ge.verticalPlacedIconSymbolIndex&&bt);ge.placedIconSymbolIndex>=0&&(se(e.icon,ge.numIconVertices,$t?gt:Ea),e.icon.placedSymbolArray.get(ge.placedIconSymbolIndex).hidden=Ne.icon.isHidden()),ge.verticalPlacedIconSymbolIndex>=0&&(se(e.icon,ge.numVerticalIconVertices,$t?Ea:gt),e.icon.placedSymbolArray.get(ge.verticalPlacedIconSymbolIndex).hidden=Ne.icon.isHidden())}const yt=ce&&ce.has(de)?ce.get(de):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const gt=e.collisionArrays[de];if(gt){let $t=new c.P(0,0);if(gt.textBox||gt.verticalTextBox){let cr=!0;if(L){const vt=this.variableOffsets[Ae];vt?($t=Dn(vt.anchor,vt.width,vt.height,vt.textOffset,vt.textBoxScale),R&&$t._rotate($?this.transform.angle:-this.transform.angle)):cr=!1}if(gt.textBox||gt.verticalTextBox){let vt;gt.textBox&&(vt=bt),gt.verticalTextBox&&(vt=At),zi(e.textCollisionBox.collisionVertexArray,Ne.text.placed,!cr||vt,yt.text,$t.x,$t.y)}}if(gt.iconBox||gt.verticalIconBox){const cr=!!(!At&&gt.verticalIconBox);let vt;gt.iconBox&&(vt=cr),gt.verticalIconBox&&(vt=!cr),zi(e.iconCollisionBox.collisionVertexArray,Ne.icon.placed,vt,yt.icon,X?$t.x:0,X?$t.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const de=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=de.invProjMatrix,e.placementViewportMatrix=de.viewportMatrix,e.collisionCircleArray=de.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function zi(m,e,s,u,d,f){u&&u.length!==0||(u=[0,0,0,0]);const S=u[0]-nr,T=u[1]-nr,I=u[2]-nr,M=u[3]-nr;m.emplaceBack(e?1:0,s?1:0,d||0,f||0,S,T),m.emplaceBack(e?1:0,s?1:0,d||0,f||0,I,T),m.emplaceBack(e?1:0,s?1:0,d||0,f||0,I,M),m.emplaceBack(e?1:0,s?1:0,d||0,f||0,S,M)}const Cr=Math.pow(2,25),qo=Math.pow(2,24),Za=Math.pow(2,17),Hn=Math.pow(2,16),ri=Math.pow(2,9),Kl=Math.pow(2,8),Bn=Math.pow(2,1);function ci(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,s=Math.floor(127*m.opacity);return s*Cr+e*qo+s*Za+e*Hn+s*ri+e*Kl+s*Bn+e}const Ea=0;function Xa(){return{isOccluded:(m,e,s)=>!1,getPitchedTextCorrection:(m,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(m,e,s,u){throw new Error("Not implemented.")},translatePosition:(m,e,s,u)=>function(d,f,S,T,I=!1){if(!S[0]&&!S[1])return[0,0];const M=I?T==="map"?d.angle:0:T==="viewport"?-d.angle:0;if(M){const L=Math.sin(M),R=Math.cos(M);S=[S[0]*R-S[1]*L,S[0]*L+S[1]*R]}return[I?S[0]:dr(f,S[0],d.zoom),I?S[1]:dr(f,S[1],d.zoom)]}(m,e,s,u),getCircleRadiusCorrection:m=>1}}class ir{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,u,d,f){const S=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(S,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((T,I)=>T.sortKey-I.sortKey));this._currentPartIndex<S.length;)if(s.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,f())return!0;return!1}}class Bs{constructor(e,s,u,d,f,S,T,I){this.placement=new Lr(e,Xa(),s,S,T,I),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(e,s,u){const d=Q.now(),f=()=>!this._forceFullPlacement&&Q.now()-d>2;for(;this._currentPlacementIndex>=0;){const S=s[e[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=T)&&(!S.maxzoom||S.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new ir(S)),this._inProgressLayer.continuePlacement(u[S.source],this.placement,this._showCollisionBoxes,S,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Li=512/c.X/2;class sn{constructor(e,s,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const d=new Map;for(let f=0;f<s.length;f++){const S=s.get(f),T=S.key,I=d.get(T);I?I.push(S):d.set(T,[S])}for(const[f,S]of d){const T={positions:S.map(I=>({x:Math.floor(I.anchorX*Li),y:Math.floor(I.anchorY*Li)})),crossTileIDs:S.map(I=>I.crossTileID)};if(T.positions.length>128){const I=new c.av(T.positions.length,16,Uint16Array);for(const{x:M,y:L}of T.positions)I.add(M,L);I.finish(),delete T.positions,T.index=I}this._symbolsByKey[f]=T}}getScaledCoordinates(e,s){const{x:u,y:d,z:f}=this.tileID.canonical,{x:S,y:T,z:I}=s.canonical,M=Li/Math.pow(2,I-f),L=(T*c.X+e.anchorY)*M,R=d*c.X*Li;return{x:Math.floor((S*c.X+e.anchorX)*M-u*c.X*Li),y:Math.floor(L-R)}}findMatches(e,s,u){const d=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let f=0;f<e.length;f++){const S=e.get(f);if(S.crossTileID)continue;const T=this._symbolsByKey[S.key];if(!T)continue;const I=this.getScaledCoordinates(S,s);if(T.index){const M=T.index.range(I.x-d,I.y-d,I.x+d,I.y+d).sort();for(const L of M){const R=T.crossTileIDs[L];if(!u[R]){u[R]=!0,S.crossTileID=R;break}}}else if(T.positions)for(let M=0;M<T.positions.length;M++){const L=T.positions[M],R=T.crossTileIDs[M];if(Math.abs(L.x-I.x)<=d&&Math.abs(L.y-I.y)<=d&&!u[R]){u[R]=!0,S.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ya{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ri{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const u in this.indexes){const d=this.indexes[u],f={};for(const S in d){const T=d[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+s),f[T.tileID.key]=T}this.indexes[u]=f}this.lng=e}addBucket(e,s,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let f=0;f<s.symbolInstances.length;f++)s.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const f in this.indexes){const S=this.indexes[f];if(Number(f)>e.overscaledZ)for(const T in S){const I=S[T];I.tileID.isChildOf(e)&&I.findMatches(s.symbolInstances,e,d)}else{const T=S[e.scaledTo(Number(f)).key];T&&T.findMatches(s.symbolInstances,e,d)}}for(let f=0;f<s.symbolInstances.length;f++){const S=s.symbolInstances.get(f);S.crossTileID||(S.crossTileID=u.generate(),d[S.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new sn(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const u of s.getCrossTileIDsLists())for(const d of u)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let s=!1;for(const u in this.indexes){const d=this.indexes[u];for(const f in d)e[d[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[f]),delete d[f],s=!0)}return s}}class Go{constructor(){this.layerIndexes={},this.crossTileIDs=new Ya,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,u){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new Ri);let f=!1;const S={};d.handleWrapJump(u);for(const T of s){const I=T.getBucket(e);I&&e.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(T.tileID,I,this.crossTileIDs)&&(f=!0),S[I.bucketInstanceId]=!0)}return d.removeStaleBuckets(S)&&(f=!0),f}pruneUnusedLayers(e){const s={};e.forEach(u=>{s[u]=!0});for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}const Oi=(m,e)=>c.t(m,e&&e.filter(s=>s.identifier!=="source.canvas")),Jr=c.aw();class Ja extends c.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const d=this.sourceCaches[u].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new Ht(ct(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,d)=>this.getGlyphs(u,d)),this.dispatcher.registerMessageHandler("GI",(u,d)=>this.getImages(u,d)),this.imageManager=new Bt,this.imageManager.setEventedParent(this),this.glyphManager=new ar(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new zt(256,512),this.crossTileSymbolIndex=new Go,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),Cn().on(rt,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const d=this.sourceCaches[u.sourceId];if(!d)return;const f=d.getSource();if(f&&f.vectorLayerIds)for(const S in this._layers){const T=this._layers[S];T.source===f.id&&this._validateLayer(T)}})}loadURL(e,s={},u){this.fire(new c.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const f=this._loadStyleRequest;c.h(d,this._loadStyleRequest).then(S=>{this._loadStyleRequest=null,this._load(S.data,s,u)}).catch(S=>{this._loadStyleRequest=null,S&&!f.signal.aborted&&this.fire(new c.j(S))})}loadJSON(e,s={},u){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Q.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,u)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(Jr,{validate:!1})}_load(e,s,u){var d;const f=s.transformStyle?s.transformStyle(u,e):e;if(!s.validate||!Oi(this,c.u(f))){this._loaded=!0,this.stylesheet=f;for(const S in f.sources)this.addSource(S,f.sources[S],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new Mt(this.stylesheet.light),this.sky=new jt(this.stylesheet.sky),this.map.setTerrain((d=this.stylesheet.terrain)!==null&&d!==void 0?d:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const e=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of e){const u=c.aA(s);u.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=u}}_loadSprite(e,s=!1,u=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(f,S,T,I){return c._(this,void 0,void 0,function*(){const M=ve(f),L=T>1?"@2x":"",R={},$={};for(const{id:X,url:ee}of M){const se=S.transformRequest(je(ee,L,".json"),"SpriteJSON");R[X]=c.h(se,I);const ce=S.transformRequest(je(ee,L,".png"),"SpriteImage");$[X]=le.getImage(ce,I)}return yield Promise.all([...Object.values(R),...Object.values($)]),function(X,ee){return c._(this,void 0,void 0,function*(){const se={};for(const ce in X){se[ce]={};const de=Q.getImageCanvasContext((yield ee[ce]).data),ge=(yield X[ce]).data;for(const ne in ge){const{width:Te,height:Ae,x:Ne,y:Qe,sdf:ut,pixelRatio:bt,stretchX:At,stretchY:yt,content:gt,textFitWidth:$t,textFitHeight:cr}=ge[ne];se[ce][ne]={data:null,pixelRatio:bt,sdf:ut,stretchX:At,stretchY:yt,content:gt,textFitWidth:$t,textFitHeight:cr,spriteData:{width:Te,height:Ae,x:Ne,y:Qe,context:de}}}}return se})}(R,$)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(f=>{if(this._spriteRequest=null,f)for(const S in f){this._spritesImagesIds[S]=[];const T=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(I=>!(I in f)):[];for(const I of T)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in f[S]){const M=S==="default"?I:`${S}:${I}`;this._spritesImagesIds[S].push(M),M in this.imageManager.images?this.imageManager.updateImage(M,f[S][I],!1):this.imageManager.addImage(M,f[S][I]),s&&(this._changedImages[M]=!0)}}}).catch(f=>{this._spriteRequest=null,d=f,this.fire(new c.j(d))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),u&&u(d)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const u=e.sourceLayer;if(!u)return;const d=s.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(u)===-1)&&this.fire(new c.j(new Error(`Source layer "${u}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?c.aB(u):u);const d=[];for(const f of e)if(u[f]){const S=s?c.aB(u[f]):u[f];d.push(S)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const u of s){const d=this._layers[u];d.type!=="custom"&&(e[u]=d.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const d=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(d.length||f.length)&&this._updateWorkerLayers(d,f);for(const S in this._updatedSources){const T=this._updatedSources[S];if(T==="reload")this._reloadSource(S);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const d in this.sourceCaches){const f=this.sourceCaches[d];u[d]=f.used,f.used=!1}for(const d of this._order){const f=this._layers[d];f.recalculate(e,this._availableImages),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const d in u){const f=this.sourceCaches[d];!!u[d]!=!!f.used&&f.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var u;this._checkLoaded();const d=this.serialize();if(e=s.transformStyle?s.transformStyle(d,e):e,((u=s.validate)===null||u===void 0||u)&&Oi(this,c.u(e)))return!1;(e=c.aB(e)).layers=c.az(e.layers);const f=c.aC(d,e),S=this._getOperationsToPerform(f);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const T of S.operations)T();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],u=[];for(const d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,d.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,d.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,d.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,d.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,d.args));break;case"addSource":s.push(()=>this.addSource.apply(this,d.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,d.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,d.args));break;case"setLight":s.push(()=>this.setLight.apply(this,d.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,d.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,d.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,d.args));break;case"setSky":s.push(()=>this.setSky.apply(this,d.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,d.args));break;case"setTransition":s.push(()=>{});break;default:u.push(d.command)}return{operations:s,unimplemented:u}}addImage(e,s){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(c.u.source,`sources.${e}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const d=this.sourceCaches[e]=new Xt(e,s,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e})),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,u={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new c.j(new Error(`Layer "${d}" already exists on this map.`)));let f;if(e.type==="custom"){if(Oi(this,c.aD(e)))return;f=c.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=c.aB(e),e=c.e(e,{source:d})),this._validate(c.u.layer,`layers.${d}`,e,{arrayIndex:-1},u))return;f=c.aA(e),this._validateLayer(f),f.setEventedParent(this,{layer:{id:d}})}const S=s?this._order.indexOf(s):this._order.length;if(s&&S===-1)this.fire(new c.j(new Error(`Cannot add layer "${d}" before non-existing layer "${s}".`)));else{if(this._order.splice(S,0,d),this._layerOrderChanged=!0,this._layers[d]=f,this._removedLayers[d]&&f.source&&f.type!=="custom"){const T=this._removedLayers[d];delete this._removedLayers[d],T.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const u=this._order.indexOf(e);this._order.splice(u,1);const d=s?this._order.indexOf(s):this._order.length;s&&d===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,u){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===s&&d.maxzoom===u||(s!=null&&(d.minzoom=s),u!=null&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,u={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!c.aE(d.filter,s))return s==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(c.u.filter,`layers.${d.id}.filter`,s,null,u)||(d.filter=c.aB(s),this._updateLayer(d)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,u,d={}){this._checkLoaded();const f=this.getLayer(e);f?c.aE(f.getLayoutProperty(s),u)||(f.setLayoutProperty(s,u,d),this._updateLayer(f)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const u=this.getLayer(e);if(u)return u.getLayoutProperty(s);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,u,d={}){this._checkLoaded();const f=this.getLayer(e);f?c.aE(f.getPaintProperty(s),u)||(f.setPaintProperty(s,u,d)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const u=e.source,d=e.sourceLayer,f=this.sourceCaches[u];if(f===void 0)return void this.fire(new c.j(new Error(`The source '${u}' does not exist in the map's style.`)));const S=f.getSource().type;S==="geojson"&&d?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||d?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),f.setFeatureState(d,e.id,s)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const u=e.source,d=this.sourceCaches[u];if(d===void 0)return void this.fire(new c.j(new Error(`The source '${u}' does not exist in the map's style.`)));const f=d.getSource().type,S=f==="vector"?e.sourceLayer:void 0;f!=="vector"||S?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(S,e.id,s):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,u=e.sourceLayer,d=this.sourceCaches[s];if(d!==void 0)return d.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),d.getFeatureState(u,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.aF(this.sourceCaches,f=>f.serialize()),s=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,d=this.stylesheet;return c.aG({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,sources:e,layers:s,terrain:u},f=>f!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=S=>this._layers[S].type==="fill-extrusion",u={},d=[];for(let S=this._order.length-1;S>=0;S--){const T=this._order[S];if(s(T)){u[T]=S;for(const I of e){const M=I[T];if(M)for(const L of M)d.push(L)}}}d.sort((S,T)=>T.intersectionZ-S.intersectionZ);const f=[];for(let S=this._order.length-1;S>=0;S--){const T=this._order[S];if(s(T))for(let I=d.length-1;I>=0;I--){const M=d[I].feature;if(u[M.layer.id]<S)break;f.push(M),d.pop()}else for(const I of e){const M=I[T];if(M)for(const L of M)f.push(L.feature)}}return f}queryRenderedFeatures(e,s,u){s&&s.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const d={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const T of s.layers){const I=this._layers[T];if(!I)return this.fire(new c.j(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];d[I.source]=!0}}const f=[];s.availableImages=this._availableImages;const S=this._serializedAllLayers();for(const T in this.sourceCaches)s.layers&&!d[T]||f.push(Ir(this.sourceCaches[T],this._layers,S,e,s,u));return this.placement&&f.push(function(T,I,M,L,R,$,X){const ee={},se=$.queryRenderedSymbols(L),ce=[];for(const de of Object.keys(se).map(Number))ce.push(X[de]);ce.sort(Dr);for(const de of ce){const ge=de.featureIndex.lookupSymbolFeatures(se[de.bucketInstanceId],I,de.bucketIndex,de.sourceLayerIndex,R.filter,R.layers,R.availableImages,T);for(const ne in ge){const Te=ee[ne]=ee[ne]||[],Ae=ge[ne];Ae.sort((Ne,Qe)=>{const ut=de.featureSortOrder;if(ut){const bt=ut.indexOf(Ne.featureIndex);return ut.indexOf(Qe.featureIndex)-bt}return Qe.featureIndex-Ne.featureIndex});for(const Ne of Ae)Te.push(Ne)}}for(const de in ee)ee[de].forEach(ge=>{const ne=ge.feature,Te=M[T[de].source].getFeatureState(ne.layer["source-layer"],ne.id);ne.source=ne.layer.source,ne.layer["source-layer"]&&(ne.sourceLayer=ne.layer["source-layer"]),ne.state=Te});return ee}(this._layers,S,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(e,s){s&&s.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",s.filter,null,s);const u=this.sourceCaches[e];return u?function(d,f){const S=d.getRenderableIds().map(M=>d.getTileByID(M)),T=[],I={};for(let M=0;M<S.length;M++){const L=S[M],R=L.tileID.canonical.key;I[R]||(I[R]=!0,L.querySourceFeatures(T,f))}return T}(u,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const S in e)if(!c.aE(e[S],u[S])){d=!0;break}if(!d)return;const f={now:Q.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(f)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const u=this.getSky();let d=!1;if(!e&&!u)return;if(e&&!u)d=!0;else if(!e&&u)d=!0;else for(const S in e)if(!c.aE(e[S],u[S])){d=!0;break}if(!d)return;const f={now:Q.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(f)}_validate(e,s,u,d,f={}){return(!f||f.validate!==!1)&&Oi(this,e.call(c.u,c.e({key:s,style:this.serialize(),value:u,styleSpec:c.v},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Cn().off(rt,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const u=this.sourceCaches[s];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,u,d,f=!1){let S=!1,T=!1;const I={};for(const M of this._order){const L=this._layers[M];if(L.type!=="symbol")continue;if(!I[L.source]){const $=this.sourceCaches[L.source];I[L.source]=$.getRenderableIds(!0).map(X=>$.getTileByID(X)).sort((X,ee)=>ee.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(ee.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(L,I[L.source],e.center.lng);S=S||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Q.now(),e.zoom))&&(this.pauseablePlacement=new Bs(e,this.map.terrain,this._order,f,s,u,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Q.now()),T=!0),S&&this.pauseablePlacement.placement.setStale()),T||S)for(const M of this._order){const L=this._layers[M];L.type==="symbol"&&this.placement.updateLayerOpacities(L,I[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Q.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return c._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[s.source];return d&&d.setDependencies(s.tileID.key,s.type,s.icons),u})}getGlyphs(e,s){return c._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(s.stacks),d=this.sourceCaches[s.source];return d&&d.setDependencies(s.tileID.key,s.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,u={},d){this._checkLoaded();const f=[{id:e,url:s}],S=[...ve(this.stylesheet.sprite),...f];this._validate(c.u.sprite,"sprite",S,null,u)||(this.stylesheet.sprite=S,this._loadSprite(f,!0,d))}removeSprite(e){this._checkLoaded();const s=ve(this.stylesheet.sprite);if(s.find(u=>u.id===e)){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;s.splice(s.findIndex(u=>u.id===e),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return ve(this.stylesheet.sprite)}setSprite(e,s={},u){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var Yi=c.Y([{name:"a_pos",type:"Int16",components:2}]);const Si={prelude:Rr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Rr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Rr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Rr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Rr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Rr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Rr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Rr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Rr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Rr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Rr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Rr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Rr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Rr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Rr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Rr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Rr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Rr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Rr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Rr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Rr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Rr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Rr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Rr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Rr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Rr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Rr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Rr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Rr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Rr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Rr(m,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/attribute ([\w]+) ([\w]+)/g),d=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=f?f.concat(d):d,T={};return{fragmentSource:m=m.replace(s,(I,M,L,R,$)=>(T[$]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${$}
varying ${L} ${R} ${$};
#else
uniform ${L} ${R} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${L} ${R} ${$} = u_${$};
#endif
`)),vertexSource:e=e.replace(s,(I,M,L,R,$)=>{const X=R==="float"?"vec2":"vec4",ee=$.match(/color/)?"color":X;return T[$]?M==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${L} ${X} a_${$};
varying ${L} ${R} ${$};
#else
uniform ${L} ${R} u_${$};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${L} ${R} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${ee}(a_${$}, u_${$}_t);
#else
    ${L} ${R} ${$} = u_${$};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${L} ${X} a_${$};
#else
uniform ${L} ${R} u_${$};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${L} ${R} ${$} = a_${$};
#else
    ${L} ${R} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${L} ${R} ${$} = unpack_mix_${ee}(a_${$}, u_${$}_t);
#else
    ${L} ${R} ${$} = u_${$};
#endif
`}),staticAttributes:u,staticUniforms:S}}class ho{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,u,d,f,S,T,I,M){this.context=e;let L=this.boundPaintVertexBuffers.length!==d.length;for(let R=0;!L&&R<d.length;R++)this.boundPaintVertexBuffers[R]!==d[R]&&(L=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==u||L||this.boundIndexBuffer!==f||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==M?this.freshBind(s,u,d,f,S,T,I,M):(e.bindVertexArray.set(this.vao),T&&T.bind(),f&&f.dynamicDraw&&f.bind(),I&&I.bind(),M&&M.bind())}freshBind(e,s,u,d,f,S,T,I){const M=e.numAttributes,L=this.context,R=L.gl;this.vao&&this.destroy(),this.vao=L.createVertexArray(),L.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=I,s.enableAttributes(R,e);for(const $ of u)$.enableAttributes(R,e);S&&S.enableAttributes(R,e),T&&T.enableAttributes(R,e),I&&I.enableAttributes(R,e),s.bind(),s.setVertexAttribPointers(R,e,f);for(const $ of u)$.bind(),$.setVertexAttribPointers(R,e,f);S&&(S.bind(),S.setVertexAttribPointers(R,e,f)),d&&d.bind(),T&&(T.bind(),T.setVertexAttribPointers(R,e,f)),I&&(I.bind(),I.setVertexAttribPointers(R,e,f)),L.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ns=(m,e,s,u,d)=>({u_matrix:m,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:u?u.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:u?u.calculateFogBlendOpacity(d):0,u_horizon_color:u?u.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1});function _s(m){const e=[];for(let s=0;s<m.length;s++){if(m[s]===null)continue;const u=m[s].split(" ");e.push(u.pop())}return e}class js{constructor(e,s,u,d,f,S){const T=e.gl;this.program=T.createProgram();const I=_s(s.staticAttributes),M=u?u.getBinderAttributes():[],L=I.concat(M),R=Si.prelude.staticUniforms?_s(Si.prelude.staticUniforms):[],$=s.staticUniforms?_s(s.staticUniforms):[],X=u?u.getBinderUniforms():[],ee=R.concat($).concat(X),se=[];for(const Ne of ee)se.indexOf(Ne)<0&&se.push(Ne);const ce=u?u.defines():[];f&&ce.push("#define OVERDRAW_INSPECTOR;"),S&&ce.push("#define TERRAIN3D;");const de=ce.concat(Si.prelude.fragmentSource,s.fragmentSource).join(`
`),ge=ce.concat(Si.prelude.vertexSource,s.vertexSource).join(`
`),ne=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(ne,de),T.compileShader(ne),!T.getShaderParameter(ne,T.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${T.getShaderInfoLog(ne)}`);T.attachShader(this.program,ne);const Te=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(Te,ge),T.compileShader(Te),!T.getShaderParameter(Te,T.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${T.getShaderInfoLog(Te)}`);T.attachShader(this.program,Te),this.attributes={};const Ae={};this.numAttributes=L.length;for(let Ne=0;Ne<this.numAttributes;Ne++)L[Ne]&&(T.bindAttribLocation(this.program,Ne,L[Ne]),this.attributes[L[Ne]]=Ne);if(T.linkProgram(this.program),!T.getProgramParameter(this.program,T.LINK_STATUS))throw new Error(`Program failed to link: ${T.getProgramInfoLog(this.program)}`);T.deleteShader(Te),T.deleteShader(ne);for(let Ne=0;Ne<se.length;Ne++){const Qe=se[Ne];if(Qe&&!Ae[Qe]){const ut=T.getUniformLocation(this.program,Qe);ut&&(Ae[Qe]=ut)}}this.fixedUniforms=d(e,Ae),this.terrainUniforms=((Ne,Qe)=>({u_depth:new c.aH(Ne,Qe.u_depth),u_terrain:new c.aH(Ne,Qe.u_terrain),u_terrain_dim:new c.aI(Ne,Qe.u_terrain_dim),u_terrain_matrix:new c.aJ(Ne,Qe.u_terrain_matrix),u_terrain_unpack:new c.aK(Ne,Qe.u_terrain_unpack),u_terrain_exaggeration:new c.aI(Ne,Qe.u_terrain_exaggeration)}))(e,Ae),this.binderUniforms=u?u.getUniforms(e,Ae):[]}draw(e,s,u,d,f,S,T,I,M,L,R,$,X,ee,se,ce,de,ge){const ne=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(d),e.setColorMode(f),e.setCullFace(S),I){e.activeTexture.set(ne.TEXTURE2),ne.bindTexture(ne.TEXTURE_2D,I.depthTexture),e.activeTexture.set(ne.TEXTURE3),ne.bindTexture(ne.TEXTURE_2D,I.texture);for(const Ae in this.terrainUniforms)this.terrainUniforms[Ae].set(I[Ae])}for(const Ae in this.fixedUniforms)this.fixedUniforms[Ae].set(T[Ae]);se&&se.setUniforms(e,this.binderUniforms,X,{zoom:ee});let Te=0;switch(s){case ne.LINES:Te=2;break;case ne.TRIANGLES:Te=3;break;case ne.LINE_STRIP:Te=1}for(const Ae of $.get()){const Ne=Ae.vaos||(Ae.vaos={});(Ne[M]||(Ne[M]=new ho)).bind(e,this,L,se?se.getPaintVertexBuffers():[],R,Ae.vertexOffset,ce,de,ge),ne.drawElements(s,Ae.primitiveLength*Te,ne.UNSIGNED_SHORT,Ae.primitiveOffset*Te*2)}}}function po(m,e,s){const u=1/dr(s,1,e.transform.tileZoom),d=Math.pow(2,s.tileID.overscaledZ),f=s.tileSize*Math.pow(2,e.transform.tileZoom)/d,S=f*(s.tileID.canonical.x+s.tileID.wrap*d),T=f*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[u,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[S>>16,T>>16],u_pixel_coord_lower:[65535&S,65535&T]}}const fo=(m,e,s,u)=>{const d=e.style.light,f=d.properties.get("position"),S=[f.x,f.y,f.z],T=function(){var M=new c.A(9);return c.A!=Float32Array&&(M[1]=0,M[2]=0,M[3]=0,M[5]=0,M[6]=0,M[7]=0),M[0]=1,M[4]=1,M[8]=1,M}();d.properties.get("anchor")==="viewport"&&function(M,L){var R=Math.sin(L),$=Math.cos(L);M[0]=$,M[1]=R,M[2]=0,M[3]=-R,M[4]=$,M[5]=0,M[6]=0,M[7]=0,M[8]=1}(T,-e.transform.angle),function(M,L,R){var $=L[0],X=L[1],ee=L[2];M[0]=$*R[0]+X*R[3]+ee*R[6],M[1]=$*R[1]+X*R[4]+ee*R[7],M[2]=$*R[2]+X*R[5]+ee*R[8]}(S,S,T);const I=d.properties.get("color");return{u_matrix:m,u_lightpos:S,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+s,u_opacity:u}},Or=(m,e,s,u,d,f,S)=>c.e(fo(m,e,s,u),po(f,e,S),{u_height_factor:-Math.pow(2,d.overscaledZ)/S.tileSize/8}),vs=m=>({u_matrix:m}),Bu=(m,e,s,u)=>c.e(vs(m),po(s,e,u)),Xc=(m,e)=>({u_matrix:m,u_world:e}),hi=(m,e,s,u,d)=>c.e(Bu(m,e,s,u),{u_world:d}),Us=(m,e,s,u)=>{const d=m.transform;let f,S;if(u.paint.get("circle-pitch-alignment")==="map"){const T=dr(s,1,d.zoom);f=!0,S=[T,T]}else f=!1,S=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(e.posMatrix,s,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:S}},ha=(m,e,s)=>({u_matrix:m,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),Fi=(m,e,s=1)=>({u_matrix:m,u_color:e,u_overlay:0,u_overlay_scale:s}),ni=m=>({u_matrix:m}),ii=(m,e,s,u)=>({u_matrix:m,u_extrude_scale:dr(e,1,s),u_intensity:u}),vn=(m,e,s,u)=>{const d=c.H();c.aP(d,0,m.width,m.height,0,0,1);const f=m.context.gl;return{u_matrix:d,u_world:[f.drawingBufferWidth,f.drawingBufferHeight],u_image:s,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}};function ki(m,e){const s=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new c.Z(0,u/s).toLngLat().lat,new c.Z(0,(u+1)/s).toLngLat().lat]}const Qa=(m,e,s,u)=>{const d=m.transform;return{u_matrix:Ji(m,e,s,u),u_ratio:1/dr(e,1,d.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Vs=(m,e,s,u,d)=>c.e(Qa(m,e,s,d),{u_image:0,u_image_height:u}),es=(m,e,s,u,d)=>{const f=m.transform,S=Nu(e,f);return{u_matrix:Ji(m,e,s,d),u_texsize:e.imageAtlasTexture.size,u_ratio:1/dr(e,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[S,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},ts=(m,e,s,u,d,f)=>{const S=m.lineAtlas,T=Nu(e,m.transform),I=s.layout.get("line-cap")==="round",M=S.getDash(u.from,I),L=S.getDash(u.to,I),R=M.width*d.fromScale,$=L.width*d.toScale;return c.e(Qa(m,e,s,f),{u_patternscale_a:[T/R,-M.height/2],u_patternscale_b:[T/$,-L.height/2],u_sdfgamma:S.width/(256*Math.min(R,$)*m.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:L.y,u_mix:d.t})};function Nu(m,e){return 1/dr(m,1,e.tileZoom)}function Ji(m,e,s,u){return m.translatePosMatrix(u?u.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Hl=(m,e,s,u,d)=>{return{u_matrix:m,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(S=d.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(f=d.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:ju(d.paint.get("raster-hue-rotate"))};var f,S};function ju(m){m*=Math.PI/180;const e=Math.sin(m),s=Math.cos(m);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const Ko=(m,e,s,u,d,f,S,T,I,M,L,R,$,X)=>{const ee=S.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:ee.cameraToCenterDistance,u_pitch:ee.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:ee.width/ee.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:I,u_coord_matrix:M,u_is_text:+R,u_pitch_with_map:+u,u_is_along_line:d,u_is_variable_anchor:f,u_texsize:$,u_texture:0,u_translation:L,u_pitched_scale:X}},Aa=(m,e,s,u,d,f,S,T,I,M,L,R,$,X,ee)=>{const se=S.transform;return c.e(Ko(m,e,s,u,d,f,S,T,I,M,L,R,$,ee),{u_gamma_scale:u?Math.cos(se._pitch)*se.cameraToCenterDistance:1,u_device_pixel_ratio:S.pixelRatio,u_is_halo:1})},mo=(m,e,s,u,d,f,S,T,I,M,L,R,$,X)=>c.e(Aa(m,e,s,u,d,f,S,T,I,M,L,!0,R,!0,X),{u_texsize_icon:$,u_texture_icon:1}),go=(m,e,s)=>({u_matrix:m,u_opacity:e,u_color:s}),Wl=(m,e,s,u,d,f)=>c.e(function(S,T,I,M){const L=I.imageManager.getPattern(S.from.toString()),R=I.imageManager.getPattern(S.to.toString()),{width:$,height:X}=I.imageManager.getPixelSize(),ee=Math.pow(2,M.tileID.overscaledZ),se=M.tileSize*Math.pow(2,I.transform.tileZoom)/ee,ce=se*(M.tileID.canonical.x+M.tileID.wrap*ee),de=se*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[$,X],u_mix:T.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/dr(M,1,I.transform.tileZoom),u_pixel_coord_upper:[ce>>16,de>>16],u_pixel_coord_lower:[65535&ce,65535&de]}}(u,f,s,d),{u_matrix:m,u_opacity:e}),xs={fillExtrusion:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_lightpos:new c.aN(m,e.u_lightpos),u_lightintensity:new c.aI(m,e.u_lightintensity),u_lightcolor:new c.aN(m,e.u_lightcolor),u_vertical_gradient:new c.aI(m,e.u_vertical_gradient),u_opacity:new c.aI(m,e.u_opacity)}),fillExtrusionPattern:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_lightpos:new c.aN(m,e.u_lightpos),u_lightintensity:new c.aI(m,e.u_lightintensity),u_lightcolor:new c.aN(m,e.u_lightcolor),u_vertical_gradient:new c.aI(m,e.u_vertical_gradient),u_height_factor:new c.aI(m,e.u_height_factor),u_image:new c.aH(m,e.u_image),u_texsize:new c.aO(m,e.u_texsize),u_pixel_coord_upper:new c.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(m,e.u_pixel_coord_lower),u_scale:new c.aN(m,e.u_scale),u_fade:new c.aI(m,e.u_fade),u_opacity:new c.aI(m,e.u_opacity)}),fill:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix)}),fillPattern:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_image:new c.aH(m,e.u_image),u_texsize:new c.aO(m,e.u_texsize),u_pixel_coord_upper:new c.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(m,e.u_pixel_coord_lower),u_scale:new c.aN(m,e.u_scale),u_fade:new c.aI(m,e.u_fade)}),fillOutline:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_world:new c.aO(m,e.u_world)}),fillOutlinePattern:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_world:new c.aO(m,e.u_world),u_image:new c.aH(m,e.u_image),u_texsize:new c.aO(m,e.u_texsize),u_pixel_coord_upper:new c.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(m,e.u_pixel_coord_lower),u_scale:new c.aN(m,e.u_scale),u_fade:new c.aI(m,e.u_fade)}),circle:(m,e)=>({u_camera_to_center_distance:new c.aI(m,e.u_camera_to_center_distance),u_scale_with_map:new c.aH(m,e.u_scale_with_map),u_pitch_with_map:new c.aH(m,e.u_pitch_with_map),u_extrude_scale:new c.aO(m,e.u_extrude_scale),u_device_pixel_ratio:new c.aI(m,e.u_device_pixel_ratio),u_matrix:new c.aJ(m,e.u_matrix)}),collisionBox:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_pixel_extrude_scale:new c.aO(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_inv_matrix:new c.aJ(m,e.u_inv_matrix),u_camera_to_center_distance:new c.aI(m,e.u_camera_to_center_distance),u_viewport_size:new c.aO(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new c.aL(m,e.u_color),u_matrix:new c.aJ(m,e.u_matrix),u_overlay:new c.aH(m,e.u_overlay),u_overlay_scale:new c.aI(m,e.u_overlay_scale)}),clippingMask:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix)}),heatmap:(m,e)=>({u_extrude_scale:new c.aI(m,e.u_extrude_scale),u_intensity:new c.aI(m,e.u_intensity),u_matrix:new c.aJ(m,e.u_matrix)}),heatmapTexture:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_world:new c.aO(m,e.u_world),u_image:new c.aH(m,e.u_image),u_color_ramp:new c.aH(m,e.u_color_ramp),u_opacity:new c.aI(m,e.u_opacity)}),hillshade:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_image:new c.aH(m,e.u_image),u_latrange:new c.aO(m,e.u_latrange),u_light:new c.aO(m,e.u_light),u_shadow:new c.aL(m,e.u_shadow),u_highlight:new c.aL(m,e.u_highlight),u_accent:new c.aL(m,e.u_accent)}),hillshadePrepare:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_image:new c.aH(m,e.u_image),u_dimension:new c.aO(m,e.u_dimension),u_zoom:new c.aI(m,e.u_zoom),u_unpack:new c.aK(m,e.u_unpack)}),line:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_ratio:new c.aI(m,e.u_ratio),u_device_pixel_ratio:new c.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_ratio:new c.aI(m,e.u_ratio),u_device_pixel_ratio:new c.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(m,e.u_units_to_pixels),u_image:new c.aH(m,e.u_image),u_image_height:new c.aI(m,e.u_image_height)}),linePattern:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_texsize:new c.aO(m,e.u_texsize),u_ratio:new c.aI(m,e.u_ratio),u_device_pixel_ratio:new c.aI(m,e.u_device_pixel_ratio),u_image:new c.aH(m,e.u_image),u_units_to_pixels:new c.aO(m,e.u_units_to_pixels),u_scale:new c.aN(m,e.u_scale),u_fade:new c.aI(m,e.u_fade)}),lineSDF:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_ratio:new c.aI(m,e.u_ratio),u_device_pixel_ratio:new c.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(m,e.u_units_to_pixels),u_patternscale_a:new c.aO(m,e.u_patternscale_a),u_patternscale_b:new c.aO(m,e.u_patternscale_b),u_sdfgamma:new c.aI(m,e.u_sdfgamma),u_image:new c.aH(m,e.u_image),u_tex_y_a:new c.aI(m,e.u_tex_y_a),u_tex_y_b:new c.aI(m,e.u_tex_y_b),u_mix:new c.aI(m,e.u_mix)}),raster:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_tl_parent:new c.aO(m,e.u_tl_parent),u_scale_parent:new c.aI(m,e.u_scale_parent),u_buffer_scale:new c.aI(m,e.u_buffer_scale),u_fade_t:new c.aI(m,e.u_fade_t),u_opacity:new c.aI(m,e.u_opacity),u_image0:new c.aH(m,e.u_image0),u_image1:new c.aH(m,e.u_image1),u_brightness_low:new c.aI(m,e.u_brightness_low),u_brightness_high:new c.aI(m,e.u_brightness_high),u_saturation_factor:new c.aI(m,e.u_saturation_factor),u_contrast_factor:new c.aI(m,e.u_contrast_factor),u_spin_weights:new c.aN(m,e.u_spin_weights)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new c.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(m,e.u_is_size_feature_constant),u_size_t:new c.aI(m,e.u_size_t),u_size:new c.aI(m,e.u_size),u_camera_to_center_distance:new c.aI(m,e.u_camera_to_center_distance),u_pitch:new c.aI(m,e.u_pitch),u_rotate_symbol:new c.aH(m,e.u_rotate_symbol),u_aspect_ratio:new c.aI(m,e.u_aspect_ratio),u_fade_change:new c.aI(m,e.u_fade_change),u_matrix:new c.aJ(m,e.u_matrix),u_label_plane_matrix:new c.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(m,e.u_coord_matrix),u_is_text:new c.aH(m,e.u_is_text),u_pitch_with_map:new c.aH(m,e.u_pitch_with_map),u_is_along_line:new c.aH(m,e.u_is_along_line),u_is_variable_anchor:new c.aH(m,e.u_is_variable_anchor),u_texsize:new c.aO(m,e.u_texsize),u_texture:new c.aH(m,e.u_texture),u_translation:new c.aO(m,e.u_translation),u_pitched_scale:new c.aI(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new c.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(m,e.u_is_size_feature_constant),u_size_t:new c.aI(m,e.u_size_t),u_size:new c.aI(m,e.u_size),u_camera_to_center_distance:new c.aI(m,e.u_camera_to_center_distance),u_pitch:new c.aI(m,e.u_pitch),u_rotate_symbol:new c.aH(m,e.u_rotate_symbol),u_aspect_ratio:new c.aI(m,e.u_aspect_ratio),u_fade_change:new c.aI(m,e.u_fade_change),u_matrix:new c.aJ(m,e.u_matrix),u_label_plane_matrix:new c.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(m,e.u_coord_matrix),u_is_text:new c.aH(m,e.u_is_text),u_pitch_with_map:new c.aH(m,e.u_pitch_with_map),u_is_along_line:new c.aH(m,e.u_is_along_line),u_is_variable_anchor:new c.aH(m,e.u_is_variable_anchor),u_texsize:new c.aO(m,e.u_texsize),u_texture:new c.aH(m,e.u_texture),u_gamma_scale:new c.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(m,e.u_device_pixel_ratio),u_is_halo:new c.aH(m,e.u_is_halo),u_translation:new c.aO(m,e.u_translation),u_pitched_scale:new c.aI(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new c.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(m,e.u_is_size_feature_constant),u_size_t:new c.aI(m,e.u_size_t),u_size:new c.aI(m,e.u_size),u_camera_to_center_distance:new c.aI(m,e.u_camera_to_center_distance),u_pitch:new c.aI(m,e.u_pitch),u_rotate_symbol:new c.aH(m,e.u_rotate_symbol),u_aspect_ratio:new c.aI(m,e.u_aspect_ratio),u_fade_change:new c.aI(m,e.u_fade_change),u_matrix:new c.aJ(m,e.u_matrix),u_label_plane_matrix:new c.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(m,e.u_coord_matrix),u_is_text:new c.aH(m,e.u_is_text),u_pitch_with_map:new c.aH(m,e.u_pitch_with_map),u_is_along_line:new c.aH(m,e.u_is_along_line),u_is_variable_anchor:new c.aH(m,e.u_is_variable_anchor),u_texsize:new c.aO(m,e.u_texsize),u_texsize_icon:new c.aO(m,e.u_texsize_icon),u_texture:new c.aH(m,e.u_texture),u_texture_icon:new c.aH(m,e.u_texture_icon),u_gamma_scale:new c.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(m,e.u_device_pixel_ratio),u_is_halo:new c.aH(m,e.u_is_halo),u_translation:new c.aO(m,e.u_translation),u_pitched_scale:new c.aI(m,e.u_pitched_scale)}),background:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_opacity:new c.aI(m,e.u_opacity),u_color:new c.aL(m,e.u_color)}),backgroundPattern:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_opacity:new c.aI(m,e.u_opacity),u_image:new c.aH(m,e.u_image),u_pattern_tl_a:new c.aO(m,e.u_pattern_tl_a),u_pattern_br_a:new c.aO(m,e.u_pattern_br_a),u_pattern_tl_b:new c.aO(m,e.u_pattern_tl_b),u_pattern_br_b:new c.aO(m,e.u_pattern_br_b),u_texsize:new c.aO(m,e.u_texsize),u_mix:new c.aI(m,e.u_mix),u_pattern_size_a:new c.aO(m,e.u_pattern_size_a),u_pattern_size_b:new c.aO(m,e.u_pattern_size_b),u_scale_a:new c.aI(m,e.u_scale_a),u_scale_b:new c.aI(m,e.u_scale_b),u_pixel_coord_upper:new c.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_texture:new c.aH(m,e.u_texture),u_ele_delta:new c.aI(m,e.u_ele_delta),u_fog_matrix:new c.aJ(m,e.u_fog_matrix),u_fog_color:new c.aL(m,e.u_fog_color),u_fog_ground_blend:new c.aI(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(m,e.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(m,e.u_horizon_color),u_horizon_fog_blend:new c.aI(m,e.u_horizon_fog_blend)}),terrainDepth:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_ele_delta:new c.aI(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_matrix:new c.aJ(m,e.u_matrix),u_texture:new c.aH(m,e.u_texture),u_terrain_coords_id:new c.aI(m,e.u_terrain_coords_id),u_ele_delta:new c.aI(m,e.u_ele_delta)}),sky:(m,e)=>({u_sky_color:new c.aL(m,e.u_sky_color),u_horizon_color:new c.aL(m,e.u_horizon_color),u_horizon:new c.aI(m,e.u_horizon),u_sky_horizon_blend:new c.aI(m,e.u_sky_horizon_blend)})};class da{constructor(e,s,u){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $s{constructor(e,s,u,d){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=d,this.context=e;const f=e.gl;this.buffer=f.createBuffer(),e.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let u=0;u<this.attributes.length;u++){const d=s.attributes[this.attributes[u].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,s,u){for(let d=0;d<this.attributes.length;d++){const f=this.attributes[d],S=s.attributes[f.name];S!==void 0&&e.vertexAttribPointer(S,f.components,e[Yc[f.type]],!1,this.itemSize,f.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const pa=new WeakMap;function fa(m){var e;if(pa.has(m))return pa.get(m);{const s=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return pa.set(m,s),s}}class Br{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ho extends Br{getDefault(){return c.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Jc extends Br{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class rs extends Br{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Zl extends Br{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Xl extends Br{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Wo extends Br{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class yo extends Br{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class qs extends Br{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Yl extends Br{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class Uu extends Br{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class bs extends Br{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class Zo extends Br{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ma extends Br{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class Xo extends Br{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Jl extends Br{getDefault(){return c.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class $n extends Br{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Da extends Br{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class _o extends Br{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class vo extends Br{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Yo extends Br{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Vu extends Br{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Ql extends Br{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class xo extends Br{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Jo extends Br{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class za extends Br{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Qo extends Br{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Gs extends Br{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Bi extends Br{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const u=this.gl;fa(u)?u.bindVertexArray(e):(s=u.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class bo extends Br{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class el extends Br{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class eu extends Br{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ks extends Br{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class Hs extends Ks{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ws extends Ks{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class wo extends Ks{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class tu{constructor(e,s,u,d,f){this.context=e,this.width=s,this.height=u;const S=e.gl,T=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new Hs(e,T),d)this.depthAttachment=f?new wo(e,T):new ws(e,T);else if(f)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class gn{constructor(e,s,u){this.blendFunction=e,this.blendColor=s,this.mask=u}}gn.Replace=[1,0],gn.disabled=new gn(gn.Replace,c.aM.transparent,[!1,!1,!1,!1]),gn.unblended=new gn(gn.Replace,c.aM.transparent,[!0,!0,!0,!0]),gn.alphaBlended=new gn([1,771],c.aM.transparent,[!0,!0,!0,!0]);class $u{constructor(e){var s,u;if(this.gl=e,this.clearColor=new Ho(this),this.clearDepth=new Jc(this),this.clearStencil=new rs(this),this.colorMask=new Zl(this),this.depthMask=new Xl(this),this.stencilMask=new Wo(this),this.stencilFunc=new yo(this),this.stencilOp=new qs(this),this.stencilTest=new Yl(this),this.depthRange=new Uu(this),this.depthTest=new bs(this),this.depthFunc=new Zo(this),this.blend=new Ma(this),this.blendFunc=new Xo(this),this.blendColor=new Jl(this),this.blendEquation=new $n(this),this.cullFace=new Da(this),this.cullFaceSide=new _o(this),this.frontFace=new vo(this),this.program=new Yo(this),this.activeTexture=new Vu(this),this.viewport=new Ql(this),this.bindFramebuffer=new xo(this),this.bindRenderbuffer=new Jo(this),this.bindTexture=new za(this),this.bindVertexBuffer=new Qo(this),this.bindElementBuffer=new Gs(this),this.bindVertexArray=new Bi(this),this.pixelStoreUnpack=new bo(this),this.pixelStoreUnpackPremultiplyAlpha=new el(this),this.pixelStoreUnpackFlipY=new eu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),fa(e)){this.HALF_FLOAT=e.HALF_FLOAT;const d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:d?.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:d?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new da(this,e,s)}createVertexBuffer(e,s,u){return new $s(this,e,s,u)}createRenderbuffer(e,s,u){const d=this.gl,f=d.createRenderbuffer();return this.bindRenderbuffer.set(f),d.renderbufferStorage(d.RENDERBUFFER,e,s,u),this.bindRenderbuffer.set(null),f}createFramebuffer(e,s,u,d){return new tu(this,e,s,u,d)}clear({color:e,depth:s,stencil:u}){const d=this.gl;let f=0;e&&(f|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(f|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u!==void 0&&(f|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(f)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aE(e.blendFunction,gn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return fa(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return fa(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class vr{constructor(e,s,u){this.func=e,this.mask=s,this.range=u}}vr.ReadOnly=!1,vr.ReadWrite=!0,vr.disabled=new vr(519,vr.ReadOnly,[0,1]);const So=7680;class Kr{constructor(e,s,u,d,f,S){this.test=e,this.ref=s,this.mask=u,this.fail=d,this.depthFail=f,this.pass=S}}Kr.disabled=new Kr({func:519,mask:0},0,0,So,So,So);class $r{constructor(e,s,u){this.enable=e,this.mode=s,this.frontFace=u}}let ns;function Ss(m,e,s,u,d){const f=m.context,S=f.gl,T=m.useProgram("collisionBox"),I=[];let M=0,L=0;for(let de=0;de<u.length;de++){const ge=u[de],ne=e.getTile(ge).getBucket(s);if(!ne)continue;const Te=d?ne.textCollisionBox:ne.iconCollisionBox,Ae=ne.collisionCircleArray;if(Ae.length>0){const Ne=c.H();c.aQ(Ne,ne.placementInvProjMatrix,m.transform.glCoordMatrix),c.aQ(Ne,Ne,ne.placementViewportMatrix),I.push({circleArray:Ae,circleOffset:L,transform:ge.posMatrix,invTransform:Ne,coord:ge}),M+=Ae.length/4,L=M}Te&&T.draw(f,S.LINES,vr.disabled,Kr.disabled,m.colorModeForRenderPass(),$r.disabled,{u_matrix:ge.posMatrix,u_pixel_extrude_scale:[1/(R=m.transform).width,1/R.height]},m.style.map.terrain&&m.style.map.terrain.getTerrainData(ge),s.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,null,m.transform.zoom,null,null,Te.collisionVertexBuffer)}var R;if(!d||!I.length)return;const $=m.useProgram("collisionCircle"),X=new c.aR;X.resize(4*M),X._trim();let ee=0;for(const de of I)for(let ge=0;ge<de.circleArray.length/4;ge++){const ne=4*ge,Te=de.circleArray[ne+0],Ae=de.circleArray[ne+1],Ne=de.circleArray[ne+2],Qe=de.circleArray[ne+3];X.emplace(ee++,Te,Ae,Ne,Qe,0),X.emplace(ee++,Te,Ae,Ne,Qe,1),X.emplace(ee++,Te,Ae,Ne,Qe,2),X.emplace(ee++,Te,Ae,Ne,Qe,3)}(!ns||ns.length<2*M)&&(ns=function(de){const ge=2*de,ne=new c.aT;ne.resize(ge),ne._trim();for(let Te=0;Te<ge;Te++){const Ae=6*Te;ne.uint16[Ae+0]=4*Te+0,ne.uint16[Ae+1]=4*Te+1,ne.uint16[Ae+2]=4*Te+2,ne.uint16[Ae+3]=4*Te+2,ne.uint16[Ae+4]=4*Te+3,ne.uint16[Ae+5]=4*Te+0}return ne}(M));const se=f.createIndexBuffer(ns,!0),ce=f.createVertexBuffer(X,c.aS.members,!0);for(const de of I){const ge=ha(de.transform,de.invTransform,m.transform);$.draw(f,S.TRIANGLES,vr.disabled,Kr.disabled,m.colorModeForRenderPass(),$r.disabled,ge,m.style.map.terrain&&m.style.map.terrain.getTerrainData(de.coord),s.id,ce,se,c.a0.simpleSegment(0,2*de.circleOffset,de.circleArray.length,de.circleArray.length/2),null,m.transform.zoom,null,null,null)}ce.destroy(),se.destroy()}$r.disabled=new $r(!1,1029,2305),$r.backCCW=new $r(!0,1029,2305);const Ws=c.an(new Float32Array(16));function tl(m,e,s,u,d,f){const{horizontalAlign:S,verticalAlign:T}=c.au(m);return new c.P((-(S-.5)*e/d+u[0])*f,(-(T-.5)*s/d+u[1])*f)}function ks(m,e,s,u,d,f){const S=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let T=u.mult(f);s||(T=T.rotate(-d));const I=S.add(T);return oe(I.x,I.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const T=Ue(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),I=Math.atan(T.y/T.x)+(T.x<0?Math.PI:0);return m.add(u.rotate(I))}return m.add(u)}function Zs(m,e,s,u,d,f,S,T,I,M,L,R,$,X){const ee=m.text.placedSymbolArray,se=m.text.dynamicLayoutVertexArray,ce=m.icon.dynamicLayoutVertexArray,de={};se.clear();for(let ge=0;ge<ee.length;ge++){const ne=ee.get(ge),Te=ne.hidden||!ne.crossTileID||m.allowVerticalPlacement&&!ne.placedOrientation?null:u[ne.crossTileID];if(Te){const Ae=new c.P(ne.anchorX,ne.anchorY),Ne={getElevation:X,width:d.width,height:d.height,labelPlaneMatrix:f,pitchWithMap:s,projection:L,tileAnchorPoint:Ae,translation:R,unwrappedTileID:$},Qe=s?oe(Ae.x,Ae.y,S,X):Ue(Ae.x,Ae.y,Ne),ut=j(d.cameraToCenterDistance,Qe.signedDistanceFromCamera);let bt=c.ai(m.textSizeData,I,ne)*ut/c.ap;s&&(bt*=m.tilePixelRatio/T);const{width:At,height:yt,anchor:gt,textOffset:$t,textBoxScale:cr}=Te,vt=tl(gt,At,yt,$t,cr,bt),Pt=L.getPitchedTextCorrection(d,Ae.add(new c.P(R[0],R[1])),$),sr=ks(Qe.point,Ne,e,vt,d.angle,Pt),ln=m.allowVerticalPlacement&&ne.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let yr=0;yr<ne.numGlyphs;yr++)c.aj(se,sr,ln);M&&ne.associatedIconIndex>=0&&(de[ne.associatedIconIndex]={shiftedAnchor:sr,angle:ln})}else Wt(ne.numGlyphs,se)}if(M){ce.clear();const ge=m.icon.placedSymbolArray;for(let ne=0;ne<ge.length;ne++){const Te=ge.get(ne);if(Te.hidden)Wt(Te.numGlyphs,ce);else{const Ae=de[ne];if(Ae)for(let Ne=0;Ne<Te.numGlyphs;Ne++)c.aj(ce,Ae.shiftedAnchor,Ae.angle);else Wt(Te.numGlyphs,ce)}}m.icon.dynamicLayoutVertexBuffer.updateData(ce)}m.text.dynamicLayoutVertexBuffer.updateData(se)}function Ni(m,e,s){return s.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Xs(m,e,s,u,d,f,S,T,I,M,L,R){const $=m.context,X=$.gl,ee=m.transform,se=Xa(),ce=T==="map",de=I==="map",ge=T!=="viewport"&&s.layout.get("symbol-placement")!=="point",ne=ce&&!de&&!ge,Te=!de&&ge,Ae=!s.layout.get("symbol-sort-key").isConstant();let Ne=!1;const Qe=m.depthModeForSublayer(0,vr.ReadOnly),ut=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),bt=[],At=se.getCircleRadiusCorrection(ee);for(const yt of u){const gt=e.getTile(yt),$t=gt.getBucket(s);if(!$t)continue;const cr=d?$t.text:$t.icon;if(!cr||!cr.segments.get().length||!cr.hasVisibleVertices)continue;const vt=cr.programConfigurations.get(s.id),Pt=d||$t.sdfIcons,sr=d?$t.textSizeData:$t.iconSizeData,ln=de||ee.pitch!==0,yr=m.useProgram(Ni(Pt,d,$t),vt),Tr=c.ag(sr,ee.zoom),un=m.style.map.terrain&&m.style.map.terrain.getTerrainData(yt);let di,Oa,cn,ji,Ci=[0,0],pi=null;if(d)Oa=gt.glyphAtlasTexture,cn=X.LINEAR,di=gt.glyphAtlasTexture.size,$t.iconsInText&&(Ci=gt.imageAtlasTexture.size,pi=gt.imageAtlasTexture,ji=ln||m.options.rotating||m.options.zooming||sr.kind==="composite"||sr.kind==="camera"?X.LINEAR:X.NEAREST);else{const Ar=s.layout.get("icon-size").constantOr(0)!==1||$t.iconsNeedLinear;Oa=gt.imageAtlasTexture,cn=Pt||m.options.rotating||m.options.zooming||Ar||ln?X.LINEAR:X.NEAREST,di=gt.imageAtlasTexture.size}const Ti=dr(gt,1,m.transform.zoom),ls=Te?yt.posMatrix:Ws,ll=ca(ls,de,ce,m.transform,Ti),Qu=Xi(ls,de,ce,m.transform,Ti),ul=Xi(yt.posMatrix,de,ce,m.transform,Ti),va=se.translatePosition(m.transform,gt,f,S),ec=ut&&$t.hasTextData(),mh=s.layout.get("icon-text-fit")!=="none"&&ec&&$t.hasIconData();if(ge){const Ar=m.style.map.terrain?(cl,hl)=>m.style.map.terrain.getElevation(yt,cl,hl):null,Po=s.layout.get("text-rotation-alignment")==="map";Z($t,yt.posMatrix,m,d,ll,ul,de,M,Po,se,yt.toUnwrapped(),ee.width,ee.height,va,Ar)}const xa=yt.posMatrix,ba=d&&ut||mh,Js=ge||ba?Ws:ll,Fa=Qu,si=Pt&&s.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let fi;fi=Pt?$t.iconsInText?mo(sr.kind,Tr,ne,de,ge,ba,m,xa,Js,Fa,va,di,Ci,At):Aa(sr.kind,Tr,ne,de,ge,ba,m,xa,Js,Fa,va,d,di,!0,At):Ko(sr.kind,Tr,ne,de,ge,ba,m,xa,Js,Fa,va,d,di,At);const ra={program:yr,buffers:cr,uniformValues:fi,atlasTexture:Oa,atlasTextureIcon:pi,atlasInterpolation:cn,atlasInterpolationIcon:ji,isSDF:Pt,hasHalo:si};if(Ae&&$t.canOverlap){Ne=!0;const Ar=cr.segments.get();for(const Po of Ar)bt.push({segments:new c.a0([Po]),sortKey:Po.sortKey,state:ra,terrainData:un})}else bt.push({segments:cr.segments,sortKey:0,state:ra,terrainData:un})}Ne&&bt.sort((yt,gt)=>yt.sortKey-gt.sortKey);for(const yt of bt){const gt=yt.state;if($.activeTexture.set(X.TEXTURE0),gt.atlasTexture.bind(gt.atlasInterpolation,X.CLAMP_TO_EDGE),gt.atlasTextureIcon&&($.activeTexture.set(X.TEXTURE1),gt.atlasTextureIcon&&gt.atlasTextureIcon.bind(gt.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),gt.isSDF){const $t=gt.uniformValues;gt.hasHalo&&($t.u_is_halo=1,Qi(gt.buffers,yt.segments,s,m,gt.program,Qe,L,R,$t,yt.terrainData)),$t.u_is_halo=0}Qi(gt.buffers,yt.segments,s,m,gt.program,Qe,L,R,gt.uniformValues,yt.terrainData)}}function Qi(m,e,s,u,d,f,S,T,I,M){const L=u.context;d.draw(L,L.gl.TRIANGLES,f,S,T,$r.disabled,I,M,s.id,m.layoutVertexBuffer,m.indexBuffer,e,s.paint,u.transform.zoom,m.programConfigurations.get(s.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function fn(m,e,s,u){const d=m.context,f=d.gl,S=Kr.disabled,T=new gn([f.ONE,f.ONE],c.aM.transparent,[!0,!0,!0,!0]),I=e.getBucket(s);if(!I)return;const M=u.key;let L=s.heatmapFbos.get(M);L||(L=Wn(d,e.tileSize,e.tileSize),s.heatmapFbos.set(M,L)),d.bindFramebuffer.set(L.framebuffer),d.viewport.set([0,0,e.tileSize,e.tileSize]),d.clear({color:c.aM.transparent});const R=I.programConfigurations.get(s.id),$=m.useProgram("heatmap",R),X=m.style.map.terrain.getTerrainData(u);$.draw(d,f.TRIANGLES,vr.disabled,S,T,$r.disabled,ii(u.posMatrix,e,m.transform.zoom,s.paint.get("heatmap-intensity")),X,s.id,I.layoutVertexBuffer,I.indexBuffer,I.segments,s.paint,m.transform.zoom,R)}function ma(m,e,s){const u=m.context,d=u.gl;u.setColorMode(m.colorModeForRenderPass());const f=ko(u,e),S=s.key,T=e.heatmapFbos.get(S);T&&(u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,T.colorAttachment.get()),u.activeTexture.set(d.TEXTURE1),f.bind(d.LINEAR,d.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(u,d.TRIANGLES,vr.disabled,Kr.disabled,m.colorModeForRenderPass(),$r.disabled,vn(m,e,0,1),null,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,m.transform.zoom),T.destroy(),e.heatmapFbos.delete(S))}function Wn(m,e,s){var u,d;const f=m.gl,S=f.createTexture();f.bindTexture(f.TEXTURE_2D,S),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);const T=(u=m.HALF_FLOAT)!==null&&u!==void 0?u:f.UNSIGNED_BYTE,I=(d=m.RGBA16F)!==null&&d!==void 0?d:f.RGBA;f.texImage2D(f.TEXTURE_2D,0,I,e,s,0,f.RGBA,T,null);const M=m.createFramebuffer(e,s,!1,!1);return M.colorAttachment.set(S),M}function ko(m,e){return e.colorRampTexture||(e.colorRampTexture=new tt(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function is(m,e,s,u,d){if(!s||!u||!u.imageAtlas)return;const f=u.imageAtlas.patternPositions;let S=f[s.to.toString()],T=f[s.from.toString()];if(!S&&T&&(S=T),!T&&S&&(T=S),!S||!T){const I=d.getPaintProperty(e);S=f[I],T=f[I]}S&&T&&m.setConstantPatternPositions(S,T)}function Ys(m,e,s,u,d,f,S){const T=m.context.gl,I="fill-pattern",M=s.paint.get(I),L=M&&M.constantOr(1),R=s.getCrossfadeParameters();let $,X,ee,se,ce;S?(X=L&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=T.LINES):(X=L?"fillPattern":"fill",$=T.TRIANGLES);const de=M.constantOr(null);for(const ge of u){const ne=e.getTile(ge);if(L&&!ne.patternsLoaded())continue;const Te=ne.getBucket(s);if(!Te)continue;const Ae=Te.programConfigurations.get(s.id),Ne=m.useProgram(X,Ae),Qe=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ge);L&&(m.context.activeTexture.set(T.TEXTURE0),ne.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Ae.updatePaintBuffers(R)),is(Ae,I,de,ne,s);const ut=Qe?ge:null,bt=m.translatePosMatrix(ut?ut.posMatrix:ge.posMatrix,ne,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(S){se=Te.indexBuffer2,ce=Te.segments2;const At=[T.drawingBufferWidth,T.drawingBufferHeight];ee=X==="fillOutlinePattern"&&L?hi(bt,m,R,ne,At):Xc(bt,At)}else se=Te.indexBuffer,ce=Te.segments,ee=L?Bu(bt,m,R,ne):vs(bt);Ne.draw(m.context,$,d,m.stencilModeForClipping(ge),f,$r.disabled,ee,Qe,s.id,Te.layoutVertexBuffer,se,ce,s.paint,m.transform.zoom,Ae)}}function ga(m,e,s,u,d,f,S){const T=m.context,I=T.gl,M="fill-extrusion-pattern",L=s.paint.get(M),R=L.constantOr(1),$=s.getCrossfadeParameters(),X=s.paint.get("fill-extrusion-opacity"),ee=L.constantOr(null);for(const se of u){const ce=e.getTile(se),de=ce.getBucket(s);if(!de)continue;const ge=m.style.map.terrain&&m.style.map.terrain.getTerrainData(se),ne=de.programConfigurations.get(s.id),Te=m.useProgram(R?"fillExtrusionPattern":"fillExtrusion",ne);R&&(m.context.activeTexture.set(I.TEXTURE0),ce.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ne.updatePaintBuffers($)),is(ne,M,ee,ce,s);const Ae=m.translatePosMatrix(se.posMatrix,ce,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ne=s.paint.get("fill-extrusion-vertical-gradient"),Qe=R?Or(Ae,m,Ne,X,se,$,ce):fo(Ae,m,Ne,X);Te.draw(T,T.gl.TRIANGLES,d,f,S,$r.backCCW,Qe,ge,s.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,s.paint,m.transform.zoom,ne,m.style.map.terrain&&de.centroidVertexBuffer)}}function as(m,e,s,u,d,f,S){const T=m.context,I=T.gl,M=s.fbo;if(!M)return;const L=m.useProgram("hillshade"),R=m.style.map.terrain&&m.style.map.terrain.getTerrainData(e);T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,M.colorAttachment.get()),L.draw(T,I.TRIANGLES,d,f,S,$r.disabled,(($,X,ee,se)=>{const ce=ee.paint.get("hillshade-shadow-color"),de=ee.paint.get("hillshade-highlight-color"),ge=ee.paint.get("hillshade-accent-color");let ne=ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);ee.paint.get("hillshade-illumination-anchor")==="viewport"&&(ne-=$.transform.angle);const Te=!$.options.moving;return{u_matrix:se?se.posMatrix:$.transform.calculatePosMatrix(X.tileID.toUnwrapped(),Te),u_image:0,u_latrange:ki(0,X.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),ne],u_shadow:ce,u_highlight:de,u_accent:ge}})(m,s,u,R?e:null),R,u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function ea(m,e,s,u,d,f){const S=m.context,T=S.gl,I=e.dem;if(I&&I.data){const M=I.dim,L=I.stride,R=I.getPixels();if(S.activeTexture.set(T.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||m.getTileTexture(L),e.demTexture){const X=e.demTexture;X.update(R,{premultiply:!1}),X.bind(T.NEAREST,T.CLAMP_TO_EDGE)}else e.demTexture=new tt(S,R,T.RGBA,{premultiply:!1}),e.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);S.activeTexture.set(T.TEXTURE0);let $=e.fbo;if(!$){const X=new tt(S,{width:M,height:M,data:null},T.RGBA);X.bind(T.LINEAR,T.CLAMP_TO_EDGE),$=e.fbo=S.createFramebuffer(M,M,!0,!1),$.colorAttachment.set(X.texture)}S.bindFramebuffer.set($.framebuffer),S.viewport.set([0,0,M,M]),m.useProgram("hillshadePrepare").draw(S,T.TRIANGLES,u,d,f,$r.disabled,((X,ee)=>{const se=ee.stride,ce=c.H();return c.aP(ce,0,c.X,-c.X,0,0,1),c.J(ce,ce,[0,-c.X,0]),{u_matrix:ce,u_image:1,u_dimension:[se,se],u_zoom:X.overscaledZ,u_unpack:ee.getUnpackVector()}})(e.tileID,I),null,s.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function La(m,e,s,u,d,f){const S=u.paint.get("raster-fade-duration");if(!f&&S>0){const T=Q.now(),I=(T-m.timeAdded)/S,M=e?(T-e.timeAdded)/S:-1,L=s.getSource(),R=d.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),$=!e||Math.abs(e.tileID.overscaledZ-R)>Math.abs(m.tileID.overscaledZ-R),X=$&&m.refreshedUponExpiration?1:c.ac($?I:1-M,0,1);return m.refreshedUponExpiration&&I>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-X}:{opacity:X,mix:0}}return{opacity:1,mix:0}}const rl=new c.aM(1,0,0,1),v=new c.aM(0,1,0,1),k=new c.aM(0,0,1,1),E=new c.aM(1,0,1,1),D=new c.aM(0,1,1,1);function B(m,e,s,u){te(m,0,e+s/2,m.transform.width,s,u)}function q(m,e,s,u){te(m,e-s/2,0,s,m.transform.height,u)}function te(m,e,s,u,d,f){const S=m.context,T=S.gl;T.enable(T.SCISSOR_TEST),T.scissor(e*m.pixelRatio,s*m.pixelRatio,u*m.pixelRatio,d*m.pixelRatio),S.clear({color:f}),T.disable(T.SCISSOR_TEST)}function he(m,e,s){const u=m.context,d=u.gl,f=s.posMatrix,S=m.useProgram("debug"),T=vr.disabled,I=Kr.disabled,M=m.colorModeForRenderPass(),L="$debug",R=m.style.map.terrain&&m.style.map.terrain.getTerrainData(s);u.activeTexture.set(d.TEXTURE0);const $=e.getTileByID(s.key).latestRawTileData,X=Math.floor(($&&$.byteLength||0)/1024),ee=e.getTile(s).tileSize,se=512/Math.min(ee,512)*(s.overscaledZ/m.transform.zoom)*.5;let ce=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(ce+=` => ${s.overscaledZ}`),function(de,ge){de.initDebugOverlayCanvas();const ne=de.debugOverlayCanvas,Te=de.context.gl,Ae=de.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,ne.width,ne.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(ge,5,5),Ae.strokeText(ge,5,5),de.debugOverlayTexture.update(ne),de.debugOverlayTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}(m,`${ce} ${X}kB`),S.draw(u,d.TRIANGLES,T,I,gn.alphaBlended,$r.disabled,Fi(f,c.aM.transparent,se),null,L,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),S.draw(u,d.LINE_STRIP,T,I,M,$r.disabled,Fi(f,c.aM.red),R,L,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function xe(m,e,s){const u=m.context,d=u.gl,f=m.colorModeForRenderPass(),S=new vr(d.LEQUAL,vr.ReadWrite,m.depthRangeFor3D),T=m.useProgram("terrain"),I=e.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,m.width,m.height]);for(const M of s){const L=m.renderToTexture.getTexture(M),R=e.getTerrainData(M.tileID);u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,L.texture);const $=m.transform.calculatePosMatrix(M.tileID.toUnwrapped()),X=e.getMeshFrameDelta(m.transform.zoom),ee=m.transform.calculateFogMatrix(M.tileID.toUnwrapped()),se=Ns($,X,ee,m.style.sky,m.transform.pitch);T.draw(u,d.TRIANGLES,S,Kr.disabled,f,$r.backCCW,se,R,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}class Ce{constructor(e,s,u){this.vertexBuffer=e,this.indexBuffer=s,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class De{constructor(e,s){this.context=new $u(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Xt.maxUnderzooming+Xt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Go}resize(e,s,u){if(this.width=Math.floor(e*u),this.height=Math.floor(s*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,s=new c.aX;s.emplaceBack(0,0),s.emplaceBack(c.X,0),s.emplaceBack(0,c.X),s.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(s,Yi.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);const u=new c.aX;u.emplaceBack(0,0),u.emplaceBack(c.X,0),u.emplaceBack(0,c.X),u.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(u,Yi.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);const d=new c.$;d.emplaceBack(0,0,0,0),d.emplaceBack(c.X,0,c.X,0),d.emplaceBack(0,c.X,0,c.X),d.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(d,Sn.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);const f=new c.aX;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(f,Yi.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);const S=new c.aZ;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(S);const T=new c.aY;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);const I=this.context.gl;this.stencilClearMode=new Kr({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=c.H();c.aP(u,0,this.width,this.height,0,0,1),c.K(u,u,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,vr.disabled,this.stencilClearMode,gn.disabled,$r.disabled,ni(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const u=this.context,d=u.gl;this.nextStencilID+s.length>256&&this.clearStencil(),u.setColorMode(gn.disabled),u.setDepthMode(vr.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of s){const T=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S);f.draw(u,d.TRIANGLES,vr.disabled,new Kr({func:d.ALWAYS,mask:0},T,255,d.KEEP,d.KEEP,d.REPLACE),gn.disabled,$r.disabled,ni(S.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Kr({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Kr({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,u=e.sort((S,T)=>T.overscaledZ-S.overscaledZ),d=u[u.length-1].overscaledZ,f=u[0].overscaledZ-d+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const S={};for(let T=0;T<f;T++)S[T+d]=new Kr({func:s.GEQUAL,mask:255},T+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=f,[S,u]}return[{[d]:Kr.disabled},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new gn([e.CONSTANT_COLOR,e.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?gn.unblended:gn.alphaBlended}depthModeForSublayer(e,s,u){if(!this.opaquePassEnabledForLayer())return vr.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new vr(u||this.context.gl.LEQUAL,s,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Q.now()),this.imageManager.beginFrame();const u=this.style._order,d=this.style.sourceCaches,f={},S={},T={};for(const I in d){const M=d[I];M.used&&M.prepare(this.context),f[I]=M.getVisibleCoordinates(),S[I]=f[I].slice().reverse(),T[I]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<u.length;I++)if(this.style._layers[u[I]].is3D()){this.opaquePassCutoff=I;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const I of u){const M=this.style._layers[I];if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const L=S[M.source];(M.type==="custom"||L.length)&&this.renderLayer(this,d[M.source],M,L)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(I,M){const L=I.context,R=L.gl,$=((de,ge,ne)=>({u_sky_color:de.properties.get("sky-color"),u_horizon_color:de.properties.get("horizon-color"),u_horizon:(ge.height/2+ge.getHorizon())*ne,u_sky_horizon_blend:de.properties.get("sky-horizon-blend")*ge.height/2*ne}))(M,I.style.map.transform,I.pixelRatio),X=new vr(R.LEQUAL,vr.ReadWrite,[0,1]),ee=Kr.disabled,se=I.colorModeForRenderPass(),ce=I.useProgram("sky");if(!M.mesh){const de=new c.aX;de.emplaceBack(-1,-1),de.emplaceBack(1,-1),de.emplaceBack(1,1),de.emplaceBack(-1,1);const ge=new c.aY;ge.emplaceBack(0,1,2),ge.emplaceBack(0,2,3),M.mesh=new Ce(L.createVertexBuffer(de,Yi.members),L.createIndexBuffer(ge),c.a0.simpleSegment(0,0,de.length,ge.length))}ce.draw(L,R.TRIANGLES,X,ee,se,$r.disabled,$,void 0,"sky",M.mesh.vertexBuffer,M.mesh.indexBuffer,M.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[u[this.currentLayer]],M=d[I.source],L=f[I.source];this._renderTileClippingMasks(I,L),this.renderLayer(this,M,I,L)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const I=this.style._layers[u[this.currentLayer]],M=d[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I))continue;const L=(I.type==="symbol"?T:S)[I.source];this._renderTileClippingMasks(I,f[I.source]),this.renderLayer(this,M,I,L)}if(this.options.showTileBoundaries){const I=function(M,L){let R=null;const $=Object.values(M._layers).flatMap(ce=>ce.source&&!ce.isHidden(L)?[M.sourceCaches[ce.source]]:[]),X=$.filter(ce=>ce.getSource().type==="vector"),ee=$.filter(ce=>ce.getSource().type!=="vector"),se=ce=>{(!R||R.getSource().maxzoom<ce.getSource().maxzoom)&&(R=ce)};return X.forEach(ce=>se(ce)),R||ee.forEach(ce=>se(ce)),R}(this.style,this.transform.zoom);I&&function(M,L,R){for(let $=0;$<R.length;$++)he(M,L,R[$])}(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const M=I.transform.padding;B(I,I.transform.height-(M.top||0),3,rl),B(I,M.bottom||0,3,v),q(I,M.left||0,3,k),q(I,I.transform.width-(M.right||0),3,E);const L=I.transform.centerPoint;(function(R,$,X,ee){te(R,$-1,X-10,2,20,ee),te(R,$-10,X-1,20,2,ee)})(I,L.x,I.transform.height-L.y,D)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=e?!c.a_(s,u):!c.a$(s,u)),d||(d=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),d&&(c.b0(s,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(f,S){const T=f.context,I=T.gl,M=gn.unblended,L=new vr(I.LEQUAL,vr.ReadWrite,[0,1]),R=S.getTerrainMesh(),$=S.sourceCache.getRenderableTiles(),X=f.useProgram("terrainDepth");T.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),T.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),T.clear({color:c.aM.transparent,depth:1});for(const ee of $){const se=S.getTerrainData(ee.tileID),ce={u_matrix:f.transform.calculatePosMatrix(ee.tileID.toUnwrapped()),u_ele_delta:S.getMeshFrameDelta(f.transform.zoom)};X.draw(T,I.TRIANGLES,L,Kr.disabled,M,$r.backCCW,ce,se,"terrain",R.vertexBuffer,R.indexBuffer,R.segments)}T.bindFramebuffer.set(null),T.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain),function(f,S){const T=f.context,I=T.gl,M=gn.unblended,L=new vr(I.LEQUAL,vr.ReadWrite,[0,1]),R=S.getTerrainMesh(),$=S.getCoordsTexture(),X=S.sourceCache.getRenderableTiles(),ee=f.useProgram("terrainCoords");T.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),T.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),T.clear({color:c.aM.transparent,depth:1}),S.coordsIndex=[];for(const se of X){const ce=S.getTerrainData(se.tileID);T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,$.texture);const de={u_matrix:f.transform.calculatePosMatrix(se.tileID.toUnwrapped()),u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(f.transform.zoom)};ee.draw(T,I.TRIANGLES,L,Kr.disabled,M,$r.backCCW,de,ce,"terrain",R.vertexBuffer,R.indexBuffer,R.segments),S.coordsIndex.push(se.tileID.key)}T.bindFramebuffer.set(null),T.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain))}renderLayer(e,s,u,d){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(d||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(f,S,T,I,M){if(f.renderPass!=="translucent")return;const L=Kr.disabled,R=f.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function($,X,ee,se,ce,de,ge,ne,Te){const Ae=X.transform,Ne=Xa(),Qe=ce==="map",ut=de==="map";for(const bt of $){const At=se.getTile(bt),yt=At.getBucket(ee);if(!yt||!yt.text||!yt.text.segments.get().length)continue;const gt=c.ag(yt.textSizeData,Ae.zoom),$t=dr(At,1,X.transform.zoom),cr=ca(bt.posMatrix,ut,Qe,X.transform,$t),vt=ee.layout.get("icon-text-fit")!=="none"&&yt.hasIconData();if(gt){const Pt=Math.pow(2,Ae.zoom-At.tileID.overscaledZ),sr=X.style.map.terrain?(yr,Tr)=>X.style.map.terrain.getElevation(bt,yr,Tr):null,ln=Ne.translatePosition(Ae,At,ge,ne);Zs(yt,Qe,ut,Te,Ae,cr,bt.posMatrix,Pt,gt,vt,Ne,ln,bt.toUnwrapped(),sr)}}}(I,f,T,S,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),M),T.paint.get("icon-opacity").constantOr(1)!==0&&Xs(f,S,T,I,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),L,R),T.paint.get("text-opacity").constantOr(1)!==0&&Xs(f,S,T,I,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),L,R),S.map.showCollisionBoxes&&(Ss(f,S,T,I,!0),Ss(f,S,T,I,!1))})(e,s,u,d,this.style.placement.variableOffsets);break;case"circle":(function(f,S,T,I){if(f.renderPass!=="translucent")return;const M=T.paint.get("circle-opacity"),L=T.paint.get("circle-stroke-width"),R=T.paint.get("circle-stroke-opacity"),$=!T.layout.get("circle-sort-key").isConstant();if(M.constantOr(1)===0&&(L.constantOr(1)===0||R.constantOr(1)===0))return;const X=f.context,ee=X.gl,se=f.depthModeForSublayer(0,vr.ReadOnly),ce=Kr.disabled,de=f.colorModeForRenderPass(),ge=[];for(let ne=0;ne<I.length;ne++){const Te=I[ne],Ae=S.getTile(Te),Ne=Ae.getBucket(T);if(!Ne)continue;const Qe=Ne.programConfigurations.get(T.id),ut=f.useProgram("circle",Qe),bt=Ne.layoutVertexBuffer,At=Ne.indexBuffer,yt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Te),gt={programConfiguration:Qe,program:ut,layoutVertexBuffer:bt,indexBuffer:At,uniformValues:Us(f,Te,Ae,T),terrainData:yt};if($){const $t=Ne.segments.get();for(const cr of $t)ge.push({segments:new c.a0([cr]),sortKey:cr.sortKey,state:gt})}else ge.push({segments:Ne.segments,sortKey:0,state:gt})}$&&ge.sort((ne,Te)=>ne.sortKey-Te.sortKey);for(const ne of ge){const{programConfiguration:Te,program:Ae,layoutVertexBuffer:Ne,indexBuffer:Qe,uniformValues:ut,terrainData:bt}=ne.state;Ae.draw(X,ee.TRIANGLES,se,ce,de,$r.disabled,ut,bt,T.id,Ne,Qe,ne.segments,T.paint,f.transform.zoom,Te)}})(e,s,u,d);break;case"heatmap":(function(f,S,T,I){if(T.paint.get("heatmap-opacity")===0)return;const M=f.context;if(f.style.map.terrain){for(const L of I){const R=S.getTile(L);S.hasRenderableParent(L)||(f.renderPass==="offscreen"?fn(f,R,T,L):f.renderPass==="translucent"&&ma(f,T,L))}M.viewport.set([0,0,f.width,f.height])}else f.renderPass==="offscreen"?function(L,R,$,X){const ee=L.context,se=ee.gl,ce=Kr.disabled,de=new gn([se.ONE,se.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(ge,ne,Te){const Ae=ge.gl;ge.activeTexture.set(Ae.TEXTURE1),ge.viewport.set([0,0,ne.width/4,ne.height/4]);let Ne=Te.heatmapFbos.get(c.aU);Ne?(Ae.bindTexture(Ae.TEXTURE_2D,Ne.colorAttachment.get()),ge.bindFramebuffer.set(Ne.framebuffer)):(Ne=Wn(ge,ne.width/4,ne.height/4),Te.heatmapFbos.set(c.aU,Ne))})(ee,L,$),ee.clear({color:c.aM.transparent});for(let ge=0;ge<X.length;ge++){const ne=X[ge];if(R.hasRenderableParent(ne))continue;const Te=R.getTile(ne),Ae=Te.getBucket($);if(!Ae)continue;const Ne=Ae.programConfigurations.get($.id),Qe=L.useProgram("heatmap",Ne),{zoom:ut}=L.transform;Qe.draw(ee,se.TRIANGLES,vr.disabled,ce,de,$r.disabled,ii(ne.posMatrix,Te,ut,$.paint.get("heatmap-intensity")),null,$.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,$.paint,L.transform.zoom,Ne)}ee.viewport.set([0,0,L.width,L.height])}(f,S,T,I):f.renderPass==="translucent"&&function(L,R){const $=L.context,X=$.gl;$.setColorMode(L.colorModeForRenderPass());const ee=R.heatmapFbos.get(c.aU);ee&&($.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_2D,ee.colorAttachment.get()),$.activeTexture.set(X.TEXTURE1),ko($,R).bind(X.LINEAR,X.CLAMP_TO_EDGE),L.useProgram("heatmapTexture").draw($,X.TRIANGLES,vr.disabled,Kr.disabled,L.colorModeForRenderPass(),$r.disabled,vn(L,R,0,1),null,R.id,L.viewportBuffer,L.quadTriangleIndexBuffer,L.viewportSegments,R.paint,L.transform.zoom))}(f,T)})(e,s,u,d);break;case"line":(function(f,S,T,I){if(f.renderPass!=="translucent")return;const M=T.paint.get("line-opacity"),L=T.paint.get("line-width");if(M.constantOr(1)===0||L.constantOr(1)===0)return;const R=f.depthModeForSublayer(0,vr.ReadOnly),$=f.colorModeForRenderPass(),X=T.paint.get("line-dasharray"),ee=T.paint.get("line-pattern"),se=ee.constantOr(1),ce=T.paint.get("line-gradient"),de=T.getCrossfadeParameters(),ge=se?"linePattern":X?"lineSDF":ce?"lineGradient":"line",ne=f.context,Te=ne.gl;let Ae=!0;for(const Ne of I){const Qe=S.getTile(Ne);if(se&&!Qe.patternsLoaded())continue;const ut=Qe.getBucket(T);if(!ut)continue;const bt=ut.programConfigurations.get(T.id),At=f.context.program.get(),yt=f.useProgram(ge,bt),gt=Ae||yt.program!==At,$t=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Ne),cr=ee.constantOr(null);if(cr&&Qe.imageAtlas){const sr=Qe.imageAtlas,ln=sr.patternPositions[cr.to.toString()],yr=sr.patternPositions[cr.from.toString()];ln&&yr&&bt.setConstantPatternPositions(ln,yr)}const vt=$t?Ne:null,Pt=se?es(f,Qe,T,de,vt):X?ts(f,Qe,T,X,de,vt):ce?Vs(f,Qe,T,ut.lineClipsArray.length,vt):Qa(f,Qe,T,vt);if(se)ne.activeTexture.set(Te.TEXTURE0),Qe.imageAtlasTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),bt.updatePaintBuffers(de);else if(X&&(gt||f.lineAtlas.dirty))ne.activeTexture.set(Te.TEXTURE0),f.lineAtlas.bind(ne);else if(ce){const sr=ut.gradients[T.id];let ln=sr.texture;if(T.gradientVersion!==sr.version){let yr=256;if(T.stepInterpolant){const Tr=S.getSource().maxzoom,un=Ne.canonical.z===Tr?Math.ceil(1<<f.transform.maxZoom-Ne.canonical.z):1;yr=c.ac(c.aV(ut.maxLineLength/c.X*1024*un),256,ne.maxTextureSize)}sr.gradient=c.aW({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:yr,image:sr.gradient||void 0,clips:ut.lineClipsArray}),sr.texture?sr.texture.update(sr.gradient):sr.texture=new tt(ne,sr.gradient,Te.RGBA),sr.version=T.gradientVersion,ln=sr.texture}ne.activeTexture.set(Te.TEXTURE0),ln.bind(T.stepInterpolant?Te.NEAREST:Te.LINEAR,Te.CLAMP_TO_EDGE)}yt.draw(ne,Te.TRIANGLES,R,f.stencilModeForClipping(Ne),$,$r.disabled,Pt,$t,T.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,T.paint,f.transform.zoom,bt,ut.layoutVertexBuffer2),Ae=!1}})(e,s,u,d);break;case"fill":(function(f,S,T,I){const M=T.paint.get("fill-color"),L=T.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const R=f.colorModeForRenderPass(),$=T.paint.get("fill-pattern"),X=f.opaquePassEnabledForLayer()&&!$.constantOr(1)&&M.constantOr(c.aM.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===X){const ee=f.depthModeForSublayer(1,f.renderPass==="opaque"?vr.ReadWrite:vr.ReadOnly);Ys(f,S,T,I,ee,R,!1)}if(f.renderPass==="translucent"&&T.paint.get("fill-antialias")){const ee=f.depthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,vr.ReadOnly);Ys(f,S,T,I,ee,R,!0)}})(e,s,u,d);break;case"fill-extrusion":(function(f,S,T,I){const M=T.paint.get("fill-extrusion-opacity");if(M!==0&&f.renderPass==="translucent"){const L=new vr(f.context.gl.LEQUAL,vr.ReadWrite,f.depthRangeFor3D);if(M!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))ga(f,S,T,I,L,Kr.disabled,gn.disabled),ga(f,S,T,I,L,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const R=f.colorModeForRenderPass();ga(f,S,T,I,L,Kr.disabled,R)}}})(e,s,u,d);break;case"hillshade":(function(f,S,T,I){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const M=f.context,L=f.depthModeForSublayer(0,vr.ReadOnly),R=f.colorModeForRenderPass(),[$,X]=f.renderPass==="translucent"?f.stencilConfigForOverlap(I):[{},I];for(const ee of X){const se=S.getTile(ee);se.needsHillshadePrepare!==void 0&&se.needsHillshadePrepare&&f.renderPass==="offscreen"?ea(f,se,T,L,Kr.disabled,R):f.renderPass==="translucent"&&as(f,ee,se,T,L,$[ee.overscaledZ],R)}M.viewport.set([0,0,f.width,f.height])})(e,s,u,d);break;case"raster":(function(f,S,T,I){if(f.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!I.length)return;const M=f.context,L=M.gl,R=S.getSource(),$=f.useProgram("raster"),X=f.colorModeForRenderPass(),[ee,se]=R instanceof An?[{},I]:f.stencilConfigForOverlap(I),ce=se[se.length-1].overscaledZ,de=!f.options.moving;for(const ge of se){const ne=f.depthModeForSublayer(ge.overscaledZ-ce,T.paint.get("raster-opacity")===1?vr.ReadWrite:vr.ReadOnly,L.LESS),Te=S.getTile(ge);Te.registerFadeDuration(T.paint.get("raster-fade-duration"));const Ae=S.findLoadedParent(ge,0),Ne=S.findLoadedSibling(ge),Qe=La(Te,Ae||Ne||null,S,T,f.transform,f.style.map.terrain);let ut,bt;const At=T.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;M.activeTexture.set(L.TEXTURE0),Te.texture.bind(At,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),M.activeTexture.set(L.TEXTURE1),Ae?(Ae.texture.bind(At,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),ut=Math.pow(2,Ae.tileID.overscaledZ-Te.tileID.overscaledZ),bt=[Te.tileID.canonical.x*ut%1,Te.tileID.canonical.y*ut%1]):Te.texture.bind(At,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),Te.texture.useMipmap&&M.extTextureFilterAnisotropic&&f.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const yt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ge),gt=yt?ge:null,$t=gt?gt.posMatrix:f.transform.calculatePosMatrix(ge.toUnwrapped(),de),cr=Hl($t,bt||[0,0],ut||1,Qe,T);R instanceof An?$.draw(M,L.TRIANGLES,ne,Kr.disabled,X,$r.disabled,cr,yt,T.id,R.boundsBuffer,f.quadTriangleIndexBuffer,R.boundsSegments):$.draw(M,L.TRIANGLES,ne,ee[ge.overscaledZ],X,$r.disabled,cr,yt,T.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(e,s,u,d);break;case"background":(function(f,S,T,I){const M=T.paint.get("background-color"),L=T.paint.get("background-opacity");if(L===0)return;const R=f.context,$=R.gl,X=f.transform,ee=X.tileSize,se=T.paint.get("background-pattern");if(f.isPatternMissing(se))return;const ce=!se&&M.a===1&&L===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==ce)return;const de=Kr.disabled,ge=f.depthModeForSublayer(0,ce==="opaque"?vr.ReadWrite:vr.ReadOnly),ne=f.colorModeForRenderPass(),Te=f.useProgram(se?"backgroundPattern":"background"),Ae=I||X.coveringTiles({tileSize:ee,terrain:f.style.map.terrain});se&&(R.activeTexture.set($.TEXTURE0),f.imageManager.bind(f.context));const Ne=T.getCrossfadeParameters();for(const Qe of Ae){const ut=I?Qe.posMatrix:f.transform.calculatePosMatrix(Qe.toUnwrapped()),bt=se?Wl(ut,L,f,se,{tileID:Qe,tileSize:ee},Ne):go(ut,L,M),At=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Qe);Te.draw(R,$.TRIANGLES,ge,de,ne,$r.disabled,bt,At,T.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(e,0,u,d);break;case"custom":(function(f,S,T){const I=f.context,M=T.implementation;if(f.renderPass==="offscreen"){const L=M.prerender;L&&(f.setCustomLayerDefaults(),I.setColorMode(f.colorModeForRenderPass()),L.call(M,I.gl,f.transform.customLayerMatrix()),I.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),I.setColorMode(f.colorModeForRenderPass()),I.setStencilMode(Kr.disabled);const L=M.renderingMode==="3d"?new vr(f.context.gl.LEQUAL,vr.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,vr.ReadOnly);I.setDepthMode(L),M.render(I.gl,f.transform.customLayerMatrix(),{farZ:f.transform.farZ,nearZ:f.transform.nearZ,fov:f.transform._fov,modelViewProjectionMatrix:f.transform.modelViewProjectionMatrix,projectionMatrix:f.transform.projectionMatrix}),I.setDirty(),f.setBaseState(),I.bindFramebuffer.set(null)}})(e,0,u)}}translatePosMatrix(e,s,u,d,f){if(!u[0]&&!u[1])return e;const S=f?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(S){const M=Math.sin(S),L=Math.cos(S);u=[u[0]*L-u[1]*M,u[0]*M+u[1]*L]}const T=[f?u[0]:dr(s,u[0],this.transform.zoom),f?u[1]:dr(s,u[1],this.transform.zoom),0],I=new Float32Array(16);return c.J(I,e,T),I}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!s||!u}useProgram(e,s){this.cache=this.cache||{};const u=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new js(this.context,Si[e],s,xs[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new tt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class me{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,u){const d=Math.pow(2,u),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const I=1/(T=c.af([],T,e))[3]/s*d;return c.b1(T,T,[I,I,1/T[3],I])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const I=function($,X){var ee=X[0],se=X[1],ce=X[2],de=ee*ee+se*se+ce*ce;return de>0&&(de=1/Math.sqrt(de)),$[0]=X[0]*de,$[1]=X[1]*de,$[2]=X[2]*de,$}([],function($,X,ee){var se=X[0],ce=X[1],de=X[2],ge=ee[0],ne=ee[1],Te=ee[2];return $[0]=ce*Te-de*ne,$[1]=de*ge-se*Te,$[2]=se*ne-ce*ge,$}([],Xe([],f[T[0]],f[T[1]]),Xe([],f[T[2]],f[T[1]]))),M=-((L=I)[0]*(R=f[T[1]])[0]+L[1]*R[1]+L[2]*R[2]);var L,R;return I.concat(M)});return new me(f,S)}}class Oe{constructor(e,s){this.min=e,this.max=s,this.center=function(u,d,f){return u[0]=.5*d[0],u[1]=.5*d[1],u[2]=.5*d[2],u}([],function(u,d,f){return u[0]=d[0]+f[0],u[1]=d[1]+f[1],u[2]=d[2]+f[2],u}([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],u=Ze(this.min),d=Ze(this.max);for(let f=0;f<s.length;f++)u[f]=s[f]?this.min[f]:this.center[f],d[f]=s[f]?this.center[f]:this.max[f];return d[2]=this.max[2],new Oe(u,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let d=0;d<e.planes.length;d++){const f=e.planes[d];let S=0;for(let T=0;T<s.length;T++)c.b2(f,s[T])>=0&&S++;if(S===0)return 0;S!==s.length&&(u=!1)}if(u)return 2;for(let d=0;d<3;d++){let f=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let T=0;T<e.points.length;T++){const I=e.points[T][d]-this.min[d];f=Math.min(f,I),S=Math.max(S,I)}if(S<0||f>this.max[d]-this.min[d])return 0}return 1}}class ke{constructor(e=0,s=0,u=0,d=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=u,this.right=d}interpolate(e,s,u){return s.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,s.top,u)),s.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,s.bottom,u)),s.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,s.left,u)),s.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,s.right,u)),this}getCenter(e,s){const u=c.ac((this.left+e-this.right)/2,0,e),d=c.ac((this.top+s-this.bottom)/2,0,s);return new c.P(u,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ke(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Pe=85.051129;class Ie{constructor(e,s,u,d,f){this.tileSize=512,this._renderWorldCopies=f===void 0||!!f,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=u??0,this._maxPitch=d??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ke,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new Ie(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-c.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var u=new c.A(4);return c.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,d,f){var S=d[0],T=d[1],I=d[2],M=d[3],L=Math.sin(f),R=Math.cos(f);u[0]=S*R+I*L,u[1]=T*R+M*L,u[2]=S*-L+I*R,u[3]=T*-L+M*R}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=c.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,u){this._unmodified=!1,this._edgeInsets.interpolate(e,s,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new c.b4(0,e)];if(this._renderWorldCopies){const u=this.pointCoordinate(new c.P(0,0)),d=this.pointCoordinate(new c.P(this.width,0)),f=this.pointCoordinate(new c.P(this.width,this.height)),S=this.pointCoordinate(new c.P(0,this.height)),T=Math.floor(Math.min(u.x,d.x,f.x,S.x)),I=Math.floor(Math.max(u.x,d.x,f.x,S.x)),M=1;for(let L=T-M;L<=I+M;L++)L!==0&&s.push(new c.b4(L,e))}return s}coveringTiles(e){var s,u;let d=this.coveringZoomLevel(e);const f=d;if(e.minzoom!==void 0&&d<e.minzoom)return[];e.maxzoom!==void 0&&d>e.maxzoom&&(d=e.maxzoom);const S=this.pointCoordinate(this.getCameraPoint()),T=c.Z.fromLngLat(this.center),I=Math.pow(2,d),M=[I*S.x,I*S.y,0],L=[I*T.x,I*T.y,0],R=me.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,d);let $=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&($=d);const X=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,ee=ne=>({aabb:new Oe([ne*I,0,0],[(ne+1)*I,I,0]),zoom:0,x:0,y:0,wrap:ne,fullyVisible:!1}),se=[],ce=[],de=d,ge=e.reparseOverscaled?f:d;if(this._renderWorldCopies)for(let ne=1;ne<=3;ne++)se.push(ee(-ne)),se.push(ee(ne));for(se.push(ee(0));se.length>0;){const ne=se.pop(),Te=ne.x,Ae=ne.y;let Ne=ne.fullyVisible;if(!Ne){const yt=ne.aabb.intersects(R);if(yt===0)continue;Ne=yt===2}const Qe=e.terrain?M:L,ut=ne.aabb.distanceX(Qe),bt=ne.aabb.distanceY(Qe),At=Math.max(Math.abs(ut),Math.abs(bt));if(ne.zoom===de||At>X+(1<<de-ne.zoom)-2&&ne.zoom>=$){const yt=de-ne.zoom,gt=M[0]-.5-(Te<<yt),$t=M[1]-.5-(Ae<<yt);ce.push({tileID:new c.S(ne.zoom===de?ge:ne.zoom,ne.wrap,ne.zoom,Te,Ae),distanceSq:fe([L[0]-.5-Te,L[1]-.5-Ae]),tileDistanceToCamera:Math.sqrt(gt*gt+$t*$t)})}else for(let yt=0;yt<4;yt++){const gt=(Te<<1)+yt%2,$t=(Ae<<1)+(yt>>1),cr=ne.zoom+1;let vt=ne.aabb.quadrant(yt);if(e.terrain){const Pt=new c.S(cr,ne.wrap,cr,gt,$t),sr=e.terrain.getMinMaxElevation(Pt),ln=(s=sr.minElevation)!==null&&s!==void 0?s:this.elevation,yr=(u=sr.maxElevation)!==null&&u!==void 0?u:this.elevation;vt=new Oe([vt.min[0],vt.min[1],ln],[vt.max[0],vt.max[1],yr])}se.push({aabb:vt,zoom:cr,x:gt,y:$t,wrap:ne.wrap,fullyVisible:Ne})}}return ce.sort((ne,Te)=>ne.distanceSq-Te.distanceSq).map(ne=>ne.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=c.ac(e.lat,-85.051129,Pe);return new c.P(c.O(e.lng)*this.worldSize,c.Q(s)*this.worldSize)}unproject(e){return new c.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,u=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,d=this.pointLocation(this.centerPoint,e),f=e.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-f))return;const S=u+s-f,T=Math.cos(this._pitch)*this.cameraToCenterDistance/S/c.b5(1,d.lat),I=this.scaleZoom(T/this.tileSize);this._elevation=f,this._center=d,this.zoom=I}setLocationAtPoint(e,s){const u=this.pointCoordinate(s),d=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(e),S=new c.Z(f.x-(u.x-d.x),f.y-(u.y-d.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return c.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const $=s.pointCoordinate(e);if($!=null)return $}const u=[e.x,e.y,0,1],d=[e.x,e.y,1,1];c.af(u,u,this.pixelMatrixInverse),c.af(d,d,this.pixelMatrixInverse);const f=u[3],S=d[3],T=u[1]/f,I=d[1]/S,M=u[2]/f,L=d[2]/S,R=M===L?0:(0-M)/(L-M);return new c.Z(c.y.number(u[0]/f,d[0]/S,R)/this.worldSize,c.y.number(T,I,R)/this.worldSize)}coordinatePoint(e,s=0,u=this.pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,s,1];return c.af(d,d,u),new c.P(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new Ee().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ee([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Pe])}calculateTileMatrix(e){const s=e.canonical,u=this.worldSize/this.zoomScale(s.z),d=s.x+Math.pow(2,s.z)*e.wrap,f=c.an(new Float64Array(16));return c.J(f,f,[d*u,s.y*u,0]),c.K(f,f,[u/c.X,u/c.X,1]),f}calculatePosMatrix(e,s=!1){const u=e.key,d=s?this._alignedPosMatrixCache:this._posMatrixCache;if(d[u])return d[u];const f=this.calculateTileMatrix(e);return c.L(f,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,f),d[u]=new Float32Array(f),d[u]}calculateFogMatrix(e){const s=e.key,u=this._fogMatrixCache;if(u[s])return u[s];const d=this.calculateTileMatrix(e);return c.L(d,this.fogMatrix,d),u[s]=new Float32Array(d),u[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=c.ac(+s,this.minZoom,this.maxZoom);const u={center:new c.N(e.lng,e.lat),zoom:s};let d=this.lngRange;if(!this._renderWorldCopies&&d===null){const ne=179.9999999999;d=[-ne,ne]}const f=this.tileSize*this.zoomScale(u.zoom);let S=0,T=f,I=0,M=f,L=0,R=0;const{x:$,y:X}=this.size;if(this.latRange){const ne=this.latRange;S=c.Q(ne[1])*f,T=c.Q(ne[0])*f,T-S<X&&(L=X/(T-S))}d&&(I=c.b3(c.O(d[0])*f,0,f),M=c.b3(c.O(d[1])*f,0,f),M<I&&(M+=f),M-I<$&&(R=$/(M-I)));const{x:ee,y:se}=this.project.call({worldSize:f},e);let ce,de;const ge=Math.max(R||0,L||0);if(ge){const ne=new c.P(R?(M+I)/2:ee,L?(T+S)/2:se);return u.center=this.unproject.call({worldSize:f},ne).wrap(),u.zoom+=this.scaleZoom(ge),u}if(this.latRange){const ne=X/2;se-ne<S&&(de=S+ne),se+ne>T&&(de=T-ne)}if(d){const ne=(I+M)/2;let Te=ee;this._renderWorldCopies&&(Te=c.b3(ee,ne-f/2,ne+f/2));const Ae=$/2;Te-Ae<I&&(ce=I+Ae),Te+Ae>M&&(ce=M-Ae)}if(ce!==void 0||de!==void 0){const ne=new c.P(ce??ee,de??se);u.center=this.unproject.call({worldSize:f},ne).wrap()}return u}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:u}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=u,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let d=c.an(new Float64Array(16));c.K(d,d,[this.width/2,-this.height/2,1]),c.J(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=c.an(new Float64Array(16)),c.K(d,d,[1,-1,1]),c.J(d,d,[-1,-1,0]),c.K(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),S=Math.min(this.elevation,this.minElevationForCurrentTile),T=f-S*this._pixelPerMeter/Math.cos(this._pitch),I=S<0?T:f,M=Math.PI/2+this._pitch,L=this._fov*(.5+e.y/this.height),R=Math.sin(L)*I/Math.sin(c.ac(Math.PI-M-L,.01,Math.PI-.01)),$=this.getHorizon(),X=2*Math.atan($/this.cameraToCenterDistance)*(.5+e.y/(2*$)),ee=Math.sin(X)*I/Math.sin(c.ac(Math.PI-M-X,.01,Math.PI-.01)),se=Math.min(R,ee);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*se+I),this.nearZ=this.height/50,d=new Float64Array(16),c.b6(d,this._fov,this.width/this.height,this.nearZ,this.farZ),d[8]=2*-e.x/this.width,d[9]=2*e.y/this.height,this.projectionMatrix=c.ae(d),c.K(d,d,[1,-1,1]),c.J(d,d,[0,0,-this.cameraToCenterDistance]),c.b7(d,d,this._pitch),c.ad(d,d,this.angle),c.J(d,d,[-s,-u,0]),this.mercatorMatrix=c.K([],d,[this.worldSize,this.worldSize,this.worldSize]),c.K(d,d,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,d),c.J(d,d,[0,0,-this.elevation]),this.modelViewProjectionMatrix=d,this.invModelViewProjectionMatrix=c.as([],d),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,f,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-s,-u,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,d);const ce=this.width%2/2,de=this.height%2/2,ge=Math.cos(this.angle),ne=Math.sin(this.angle),Te=s-Math.round(s)+ge*ce+ne*de,Ae=u-Math.round(u)+ge*de+ne*ce,Ne=new Float64Array(d);if(c.J(Ne,Ne,[Te>.5?Te-1:Te,Ae>.5?Ae-1:Ae,0]),this.alignedModelViewProjectionMatrix=Ne,d=c.as(new Float64Array(16),this.pixelMatrix),!d)throw new Error("failed to invert matrix");this.pixelMatrixInverse=d,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new c.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let u=s.x,d=s.y,f=s.x,S=s.y;for(const T of e)u=Math.min(u,T.x),d=Math.min(d,T.y),f=Math.max(f,T.x),S=Math.max(S,T.y);return[new c.P(u,d),new c.P(f,d),new c.P(f,S),new c.P(u,S),new c.P(u,d)]}}lngLatToCameraDepth(e,s){const u=this.locationCoordinate(e),d=[u.x*this.worldSize,u.y*this.worldSize,s,1];return c.af(d,d,this.modelViewProjectionMatrix),d[2]/d[3]}}function Re(m,e){let s,u=!1,d=null,f=null;const S=()=>{d=null,u&&(m.apply(f,s),d=setTimeout(S,e),u=!1)};return(...T)=>(u=!0,f=this,s=T,d||S(),d)}class Ve{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let u;return s.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(u=d)}),(u&&u[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const u=s.join("/");let d=u;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${u}`);let f=window.location.hash.replace(d,"");f.startsWith("#&")?f=f.slice(0,1)+f.slice(2):f==="#"&&(f="");let S=window.location.href.replace(/(#.+)?$/,f);S=S.replace("&&","&"),window.history.replaceState(window.history.state,null,S)},this._updateHash=Re(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,d),S=Math.round(s.lng*f)/f,T=Math.round(s.lat*f)/f,I=this._map.getBearing(),M=this._map.getPitch();let L="";if(L+=e?`/${S}/${T}/${u}`:`${u}/${T}/${S}`,(I||M)&&(L+="/"+Math.round(10*I)/10),M&&(L+=`/${Math.round(M)}`),this._hashName){const R=this._hashName;let $=!1;const X=window.location.hash.slice(1).split("&").map(ee=>{const se=ee.split("=")[0];return se===R?($=!0,`${se}=${L}`):ee}).filter(ee=>ee);return $||X.push(`${R}=${L}`),`#${X.join("&")}`}return`#${L}`}}const Ge={linearity:.3,easing:c.b8(0,0,.3,1)},Ye=c.e({deceleration:2500,maxSpeed:1400},Ge),et=c.e({deceleration:20,maxSpeed:1400},Ge),ft=c.e({deceleration:1e3,maxSpeed:360},Ge),kt=c.e({deceleration:1e3,maxSpeed:90},Ge);class dt{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Q.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=Q.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)s.zoom+=f.zoomDelta||0,s.bearing+=f.bearingDelta||0,s.pitch+=f.pitchDelta||0,f.panDelta&&s.pan._add(f.panDelta),f.around&&(s.around=f.around),f.pinchAround&&(s.pinchAround=f.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(s.pan.mag()){const f=Ct(s.pan.mag(),u,c.e({},Ye,e||{}));d.offset=s.pan.mult(f.amount/s.pan.mag()),d.center=this._map.transform.center,mt(d,f)}if(s.zoom){const f=Ct(s.zoom,u,et);d.zoom=this._map.transform.zoom+f.amount,mt(d,f)}if(s.bearing){const f=Ct(s.bearing,u,ft);d.bearing=this._map.transform.bearing+c.ac(f.amount,-179,179),mt(d,f)}if(s.pitch){const f=Ct(s.pitch,u,kt);d.pitch=this._map.transform.pitch+f.amount,mt(d,f)}if(d.zoom||d.bearing){const f=s.pinchAround===void 0?s.around:s.pinchAround;d.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),c.e(d,{noMoveStart:!0})}}function mt(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function Ct(m,e,s){const{maxSpeed:u,linearity:d,deceleration:f}=s,S=c.ac(m*d/(e/1e3),-u,u),T=Math.abs(S)/(f*d);return{easing:s.easing,duration:1e3*T,amount:S*(T/2)}}class ot extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,u,d={}){const f=H.mousePos(s.getCanvas(),u),S=s.unproject(f);super(e,c.e({point:f,lngLat:S,originalEvent:u},d)),this._defaultPrevented=!1,this.target=s}}class Lt extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,u){const d=e==="touchend"?u.changedTouches:u.touches,f=H.touchPos(s.getCanvasContainer(),d),S=f.map(I=>s.unproject(I)),T=f.reduce((I,M,L,R)=>I.add(M.div(R.length)),new c.P(0,0));super(e,{points:f,point:T,lngLats:S,lngLat:s.unproject(T),originalEvent:u}),this._defaultPrevented=!1}}class mr extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class xr{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new mr(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new ot(e.type,this._map,e))}mouseup(e){this._map.fire(new ot(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new ot(e.type,this._map,e))}dblclick(e){return this._firePreventable(new ot(e.type,this._map,e))}mouseover(e){this._map.fire(new ot(e.type,this._map,e))}mouseout(e){this._map.fire(new ot(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Lt(e.type,this._map,e))}touchmove(e){this._map.fire(new Lt(e.type,this._map,e))}touchend(e){this._map.fire(new Lt(e.type,this._map,e))}touchcancel(e){this._map.fire(new Lt(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yt{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new ot(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ot("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new ot(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class er{constructor(e,s){this._map=e,this._tr=new mn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(H.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const u=s;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=u,this._box||(this._box=H.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const f=Math.min(d.x,u.x),S=Math.max(d.x,u.x),T=Math.min(d.y,u.y),I=Math.max(d.y,u.y);H.setTransform(this._box,`translate(${f}px,${T}px)`),this._box.style.width=S-f+"px",this._box.style.height=I-T+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const u=this._startPos,d=s;if(this.reset(),H.suppressClick(),u.x!==d.x||u.y!==d.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:f=>f.fitScreenCoordinates(u,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(H.remove(this._box),this._box=null),H.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new c.k(e,{originalEvent:s}))}}function Tn(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const s={};for(let u=0;u<m.length;u++)s[m[u].identifier]=e[u];return s}class Nn{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(d){const f=new c.P(0,0);for(const S of d)f._add(S);return f.div(d.length)}(s),this.touches=Tn(u,s)))}touchmove(e,s,u){if(this.aborted||!this.centroid)return;const d=Tn(u,s);for(const f in this.touches){const S=d[f];(!S||S.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(e,s,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Cs{constructor(e){this.singleTap=new Nn(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,u){this.singleTap.touchstart(e,s,u)}touchmove(e,s,u){this.singleTap.touchmove(e,s,u)}touchend(e,s,u){const d=this.singleTap.touchend(e,s,u);if(d){const f=e.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(d)<30;if(f&&S||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class In{constructor(e){this._tr=new mn(e),this._zoomIn=new Cs({numTouches:1,numTaps:2}),this._zoomOut=new Cs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,u){this._zoomIn.touchstart(e,s,u),this._zoomOut.touchstart(e,s,u)}touchmove(e,s,u){this._zoomIn.touchmove(e,s,u),this._zoomOut.touchmove(e,s,u)}touchend(e,s,u){const d=this._zoomIn.touchend(e,s,u),f=this._zoomOut.touchend(e,s,u),S=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(d)},{originalEvent:e})}):f?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(f)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ai{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const d=s.length?s[0]:s;return!this._moved&&d.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(u,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&H.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Co={0:1,2:2};class qu{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=H.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(s,u){const d=Co[u];return s.buttons===void 0||(s.buttons&d)!==d}(e,this._eventButton)}isValidEndEvent(e){return H.mouseButton(e)===this._eventButton}}class Qc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const Gu=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}},eh=({enable:m,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const u=new qu({checkCorrectEvent:d=>H.mouseButton(d)===0&&d.ctrlKey||H.mouseButton(d)===2});return new ai({clickTolerance:e,move:(d,f)=>({bearingDelta:(f.x-d.x)*s}),moveStateManager:u,enable:m,assignEvents:Gu})},th=({enable:m,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const u=new qu({checkCorrectEvent:d=>H.mouseButton(d)===0&&d.ctrlKey||H.mouseButton(d)===2});return new ai({clickTolerance:e,move:(d,f)=>({pitchDelta:(f.y-d.y)*s}),moveStateManager:u,enable:m,assignEvents:Gu})};class To{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,u){return this._calculateTransform(e,s,u)}touchmove(e,s,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,s,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,u){this._calculateTransform(e,s,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,u){u.length>0&&(this._active=!0);const d=Tn(u,s),f=new c.P(0,0),S=new c.P(0,0);let T=0;for(const M in d){const L=d[M],R=this._touches[M];R&&(f._add(L),S._add(L.sub(R)),T++,d[M]=L)}if(this._touches=d,this._shouldBePrevented(T)||!S.mag())return;const I=S.div(T);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(T),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ku{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,u){if(!this._firstTwoTouches)return;e.preventDefault();const[d,f]=this._firstTwoTouches,S=ru(u,s,d),T=ru(u,s,f);if(!S||!T)return;const I=this._aroundCenter?null:S.add(T).div(2);return this._move([S,T],I,e)}touchend(e,s,u){if(!this._firstTwoTouches)return;const[d,f]=this._firstTwoTouches,S=ru(u,s,d),T=ru(u,s,f);S&&T||(this._active&&H.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ru(m,e,s){for(let u=0;u<m.length;u++)if(m[u].identifier===s)return e[u]}function rh(m,e){return Math.log(m/e)/Math.LN2}class nh extends Ku{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(rh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:rh(this._distance,u),pinchAround:s}}}function ih(m,e){return 180*m.angleWith(e)/Math.PI}class ah extends Ku{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,u){const d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ih(this._vector,d),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,u=ih(e,this._startVector);return Math.abs(u)<s}}function Hu(m){return Math.abs(m.y)>Math.abs(m.x)}class nu extends Ku{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,u){super.touchstart(e,s,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,Hu(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),f=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,f,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,u){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,f=s.mag()>=2;if(!d&&!f)return;if(!d||!f)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const S=e.y>0==s.y>0;return Hu(e)&&Hu(s)&&S}}const Ed={panStep:100,bearingStep:15,pitchStep:10};class ya{constructor(e){this._tr=new mn(e);const s=Ed;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,u=0,d=0,f=0,S=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),f=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),f=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),S=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:T=>{const I=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:ss,zoom:s?Math.round(I.zoom)+s*(e.shiftKey?2:1):I.zoom,bearing:I.bearing+u*this._bearingStep,pitch:I.pitch+d*this._pitchStep,offset:[-f*this._panStep,-S*this._panStep],center:I.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ss(m){return m*(2-m)}const sh=4.000244140625;class Ra{constructor(e,s){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new mn(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=Q.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%sh==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=H.mousePos(this._map.getCanvas(),e),u=this._tr;this._around=s.y>u.transform.height/2-u.transform.getHorizon()?c.N.convert(this._aroundCenter?u.center:u.unproject(s)):c.N.convert(u.center),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>sh?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&M!==0&&(M=1/M);const L=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(L*M))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,u=this._startZoom,d=this._easing;let f,S=!1;const T=Q.now()-this._lastWheelEventTime;if(this._type==="wheel"&&u&&d&&T){const I=Math.min(T/200,1),M=d(I);f=c.y.number(u,s,M),I<1?this._frameId||(this._frameId=!0):S=!0}else f=s,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:f-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=c.b9;if(this._prevEase){const u=this._prevEase,d=(Q.now()-u.start)/u.duration,f=u.easing(d+.01)-u.easing(d),S=.27/Math.sqrt(f*f+1e-4)*.01,T=Math.sqrt(.0729-S*S);s=c.b8(S,T,.25,1)}return this._prevEase={start:Q.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Io{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vf{constructor(e){this._tr=new mn(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $f{constructor(){this._tap=new Cs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,u){if(!this._swipePoint)if(this._tapTime){const d=s[0],f=e.timeStamp-this._tapTime<500,S=this._tapPoint.dist(d)<30;f&&S?u.length>0&&(this._swipePoint=d,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,s,u)}touchmove(e,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=s[0],f=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(e,s,u)}touchend(e,s,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const d=this._tap.touchend(e,s,u);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ad{constructor(e,s,u){this._el=e,this._mousePan=s,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Md{constructor(e,s,u){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class oh{constructor(e,s,u,d){this._el=e,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class nl{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=H.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=s,this._container.appendChild(d);const f=document.createElement("div");f.className="maplibregl-mobile-message",f.textContent=u,this._container.appendChild(f),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(H.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const _a=m=>m.zoom||m.drag||m.pitch||m.rotate;class Rt extends c.k{}function Wu(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class lh{constructor(e,s){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,f)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=d.type==="renderFrame"?void 0:d,T={needsRenderFrame:!1},I={},M={},L=d.touches,R=L?this._getMapTouches(L):void 0,$=R?H.touchPos(this._map.getCanvas(),R):H.mousePos(this._map.getCanvas(),d);for(const{handlerName:se,handler:ce,allowed:de}of this._handlers){if(!ce.isEnabled())continue;let ge;this._blockedByActive(M,de,se)?ce.reset():ce[f||d.type]&&(ge=ce[f||d.type](d,$,R),this.mergeHandlerResult(T,I,ge,se,S),ge&&ge.needsRenderFrame&&this._triggerRenderFrame()),(ge||ce.isActive())&&(M[se]=ce)}const X={};for(const se in this._previousActiveHandlers)M[se]||(X[se]=S);this._previousActiveHandlers=M,(Object.keys(X).length||Wu(T))&&(this._changes.push([T,I,X]),this._triggerRenderFrame()),(Object.keys(M).length||Wu(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=T;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dt(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,f,S]of this._listeners)H.addEventListener(d,f,d===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[e,s,u]of this._listeners)H.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new xr(s,e));const d=s.boxZoom=new er(s,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();const f=s.cooperativeGestures=new nl(s,e.cooperativeGestures);this._add("cooperativeGestures",f),e.cooperativeGestures&&f.enable();const S=new In(s),T=new Vf(s);s.doubleClickZoom=new Io(T,S),this._add("tapZoom",S),this._add("clickZoom",T),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const I=new $f;this._add("tapDragZoom",I);const M=s.touchPitch=new nu(s);this._add("touchPitch",M),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const L=eh(e),R=th(e);s.dragRotate=new Md(e,L,R),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const $=(({enable:ge,clickTolerance:ne})=>{const Te=new qu({checkCorrectEvent:Ae=>H.mouseButton(Ae)===0&&!Ae.ctrlKey});return new ai({clickTolerance:ne,move:(Ae,Ne)=>({around:Ne,panDelta:Ne.sub(Ae)}),activateOnStart:!0,moveStateManager:Te,enable:ge,assignEvents:Gu})})(e),X=new To(e,s);s.dragPan=new Ad(u,$,X),this._add("mousePan",$),this._add("touchPan",X,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const ee=new ah,se=new nh;s.touchZoomRotate=new oh(u,se,ee,I),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const ce=s.scrollZoom=new Ra(s,()=>this._triggerRenderFrame());this._add("scrollZoom",ce,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const de=s.keyboard=new ya(s);this._add("keyboard",de),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new Yt(s))}_add(e,s,u){this._handlers.push({handlerName:e,handler:s,allowed:u}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_a(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,u){for(const d in e)if(d!==u&&(!s||s.indexOf(d)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const u of e)this._el.contains(u.target)&&s.push(u);return s}mergeHandlerResult(e,s,u,d,f){if(!u)return;c.e(e,u);const S={handlerName:d,originalEvent:u.originalEvent||f};u.zoomDelta!==void 0&&(s.zoom=S),u.panDelta!==void 0&&(s.drag=S),u.pitchDelta!==void 0&&(s.pitch=S),u.bearingDelta!==void 0&&(s.rotate=S)}_applyChanges(){const e={},s={},u={};for(const[d,f,S]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),c.e(s,f),c.e(u,S);this._updateMapTransform(e,s,u),this._changes=[]}_updateMapTransform(e,s,u){const d=this._map,f=d._getTransformForUpdate(),S=d.terrain;if(!(Wu(e)||S&&this._terrainMovement))return this._fireEvents(s,u,!0);let{panDelta:T,zoomDelta:I,bearingDelta:M,pitchDelta:L,around:R,pinchAround:$}=e;$!==void 0&&(R=$),d._stop(!0),R=R||d.transform.centerPoint;const X=f.pointLocation(T?R.sub(T):R);M&&(f.bearing+=M),L&&(f.pitch+=L),I&&(f.zoom+=I),S?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(T)):f.setLocationAtPoint(X,R):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint(X,R)):f.setLocationAtPoint(X,R),d._applyUpdatedTransform(f),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,u,!0)}_fireEvents(e,s,u){const d=_a(this._eventsInProgress),f=_a(e),S={};for(const R in e){const{originalEvent:$}=e[R];this._eventsInProgress[R]||(S[`${R}start`]=$),this._eventsInProgress[R]=e[R]}!d&&f&&this._fireEvent("movestart",f.originalEvent);for(const R in S)this._fireEvent(R,S[R]);f&&this._fireEvent("move",f.originalEvent);for(const R in e){const{originalEvent:$}=e[R];this._fireEvent(R,$)}const T={};let I;for(const R in this._eventsInProgress){const{handlerName:$,originalEvent:X}=this._eventsInProgress[R];this._handlersById[$].isActive()||(delete this._eventsInProgress[R],I=s[$]||X,T[`${R}end`]=I)}for(const R in T)this._fireEvent(R,T[R]);const M=_a(this._eventsInProgress),L=(d||f)&&!M;if(L&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const R=this._map._getTransformForUpdate();R.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(R)}if(u&&L){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;!R||!R.essential&&Q.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:I})),$(this._map.getBearing())&&this._map.resetNorth()):($(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new c.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Rt("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Dd extends c.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const u=Math.min((Q.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,u){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},s),u)}panTo(e,s,u){return this.easeTo(c.e({center:e},s),u)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,u){return this.easeTo(c.e({zoom:e},s),u)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,u){return this.easeTo(c.e({bearing:e},s),u)}resetNorth(e,s){return this.rotateTo(0,c.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=Ee.convert(e).adjustAntiMeridian();const u=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,s)}_cameraForBoxAndBearing(e,s,u,d){const f={top:0,bottom:0,right:0,left:0};if(typeof(d=c.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const yt=d.padding;d.padding={top:yt,bottom:yt,right:yt,left:yt}}d.padding=c.e(f,d.padding);const S=this.transform,T=S.padding,I=new Ee(e,s),M=S.project(I.getNorthWest()),L=S.project(I.getNorthEast()),R=S.project(I.getSouthEast()),$=S.project(I.getSouthWest()),X=c.ba(-u),ee=M.rotate(X),se=L.rotate(X),ce=R.rotate(X),de=$.rotate(X),ge=new c.P(Math.max(ee.x,se.x,de.x,ce.x),Math.max(ee.y,se.y,de.y,ce.y)),ne=new c.P(Math.min(ee.x,se.x,de.x,ce.x),Math.min(ee.y,se.y,de.y,ce.y)),Te=ge.sub(ne),Ae=(S.width-(T.left+T.right+d.padding.left+d.padding.right))/Te.x,Ne=(S.height-(T.top+T.bottom+d.padding.top+d.padding.bottom))/Te.y;if(Ne<0||Ae<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Qe=Math.min(S.scaleZoom(S.scale*Math.min(Ae,Ne)),d.maxZoom),ut=c.P.convert(d.offset),bt=new c.P((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(c.ba(u)),At=ut.add(bt).mult(S.scale/S.zoomScale(Qe));return{center:S.unproject(M.add(R).div(2).sub(At)),zoom:Qe,bearing:u}}fitBounds(e,s,u){return this._fitInternal(this.cameraForBounds(e,s),s,u)}fitScreenCoordinates(e,s,u,d,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(s)),u,d),d,f)}_fitInternal(e,s,u){return e?(delete(s=c.e(e,s)).padding,s.linear?this.easeTo(s,u):this.flyTo(s,u)):this}jumpTo(e,s){this.stop();const u=this._getTransformForUpdate();let d=!1,f=!1,S=!1;return"zoom"in e&&u.zoom!==+e.zoom&&(d=!0,u.zoom=+e.zoom),e.center!==void 0&&(u.center=c.N.convert(e.center)),"bearing"in e&&u.bearing!==+e.bearing&&(f=!0,u.bearing=+e.bearing),"pitch"in e&&u.pitch!==+e.pitch&&(S=!0,u.pitch=+e.pitch),e.padding==null||u.isPaddingEqual(e.padding)||(u.padding=e.padding),this._applyUpdatedTransform(u),this.fire(new c.k("movestart",s)).fire(new c.k("move",s)),d&&this.fire(new c.k("zoomstart",s)).fire(new c.k("zoom",s)).fire(new c.k("zoomend",s)),f&&this.fire(new c.k("rotatestart",s)).fire(new c.k("rotate",s)).fire(new c.k("rotateend",s)),S&&this.fire(new c.k("pitchstart",s)).fire(new c.k("pitch",s)).fire(new c.k("pitchend",s)),this.fire(new c.k("moveend",s))}calculateCameraOptionsFromTo(e,s,u,d=0){const f=c.Z.fromLngLat(e,s),S=c.Z.fromLngLat(u,d),T=S.x-f.x,I=S.y-f.y,M=S.z-f.z,L=Math.hypot(T,I,M);if(L===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(T,I),$=this.transform.scaleZoom(this.transform.cameraToCenterDistance/L/this.transform.tileSize),X=180*Math.atan2(T,-I)/Math.PI;let ee=180*Math.acos(R/L)/Math.PI;return ee=M<0?90-ee:90+ee,{center:S.toLngLat(),zoom:$,pitch:ee,bearing:X}}easeTo(e,s){var u;this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.b9},e)).animate===!1||!e.essential&&Q.prefersReducedMotion)&&(e.duration=0);const d=this._getTransformForUpdate(),f=d.zoom,S=d.bearing,T=d.pitch,I=d.padding,M="bearing"in e?this._normalizeBearing(e.bearing,S):S,L="pitch"in e?+e.pitch:T,R="padding"in e?e.padding:d.padding,$=c.P.convert(e.offset);let X=d.centerPoint.add($);const ee=d.pointLocation(X),{center:se,zoom:ce}=d.getConstrained(c.N.convert(e.center||ee),(u=e.zoom)!==null&&u!==void 0?u:f);this._normalizeCenter(se,d);const de=d.project(ee),ge=d.project(se).sub(de),ne=d.zoomScale(ce-f);let Te,Ae;e.around&&(Te=c.N.convert(e.around),Ae=d.locationPoint(Te));const Ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ce!==f,this._rotating=this._rotating||S!==M,this._pitching=this._pitching||L!==T,this._padding=!d.isPaddingEqual(R),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,Ne),this.terrain&&this._prepareElevation(se),this._ease(Qe=>{if(this._zooming&&(d.zoom=c.y.number(f,ce,Qe)),this._rotating&&(d.bearing=c.y.number(S,M,Qe)),this._pitching&&(d.pitch=c.y.number(T,L,Qe)),this._padding&&(d.interpolatePadding(I,R,Qe),X=d.centerPoint.add($)),this.terrain&&!e.freezeElevation&&this._updateElevation(Qe),Te)d.setLocationAtPoint(Te,Ae);else{const ut=d.zoomScale(d.zoom-f),bt=ce>f?Math.min(2,ne):Math.max(.5,ne),At=Math.pow(bt,1-Qe),yt=d.unproject(de.add(ge.mult(Qe*At)).mult(ut));d.setLocationAtPoint(d.renderWorldCopies?yt.wrap():yt,X)}this._applyUpdatedTransform(d),this._fireMoveEvents(s)},Qe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,Qe)},e),this}_prepareEase(e,s,u={}){this._moving=!0,s||u.moving||this.fire(new c.k("movestart",e)),this._zooming&&!u.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(s-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),u=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<u){const d=this.calculateCameraOptionsFromTo(s.lngLat,u,e.center,e.elevation);return{pitch:d.pitch,zoom:d.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push(d=>this._elevateCameraIfInsideTerrain(d)),this.transformCameraUpdate&&s.push(d=>this.transformCameraUpdate(d)),!s.length)return;const u=e.clone();for(const d of s){const f=u.clone(),{center:S,zoom:T,pitch:I,bearing:M,elevation:L}=d(f);S&&(f.center=S),T!==void 0&&(f.zoom=T),I!==void 0&&(f.pitch=I),M!==void 0&&(f.bearing=M),L!==void 0&&(f.elevation=L),u.apply(f)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const u=this._zooming,d=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new c.k("zoomend",e)),d&&this.fire(new c.k("rotateend",e)),f&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,s){var u;if(!e.essential&&Q.prefersReducedMotion){const Pt=c.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Pt,s)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},e);const d=this._getTransformForUpdate(),f=d.zoom,S=d.bearing,T=d.pitch,I=d.padding,M="bearing"in e?this._normalizeBearing(e.bearing,S):S,L="pitch"in e?+e.pitch:T,R="padding"in e?e.padding:d.padding,$=c.P.convert(e.offset);let X=d.centerPoint.add($);const ee=d.pointLocation(X),{center:se,zoom:ce}=d.getConstrained(c.N.convert(e.center||ee),(u=e.zoom)!==null&&u!==void 0?u:f);this._normalizeCenter(se,d);const de=d.zoomScale(ce-f),ge=d.project(ee),ne=d.project(se).sub(ge);let Te=e.curve;const Ae=Math.max(d.width,d.height),Ne=Ae/de,Qe=ne.mag();if("minZoom"in e){const Pt=c.ac(Math.min(e.minZoom,f,ce),d.minZoom,d.maxZoom),sr=Ae/d.zoomScale(Pt-f);Te=Math.sqrt(sr/Qe*2)}const ut=Te*Te;function bt(Pt){const sr=(Ne*Ne-Ae*Ae+(Pt?-1:1)*ut*ut*Qe*Qe)/(2*(Pt?Ne:Ae)*ut*Qe);return Math.log(Math.sqrt(sr*sr+1)-sr)}function At(Pt){return(Math.exp(Pt)-Math.exp(-Pt))/2}function yt(Pt){return(Math.exp(Pt)+Math.exp(-Pt))/2}const gt=bt(!1);let $t=function(Pt){return yt(gt)/yt(gt+Te*Pt)},cr=function(Pt){return Ae*((yt(gt)*(At(sr=gt+Te*Pt)/yt(sr))-At(gt))/ut)/Qe;var sr},vt=(bt(!0)-gt)/Te;if(Math.abs(Qe)<1e-6||!isFinite(vt)){if(Math.abs(Ae-Ne)<1e-6)return this.easeTo(e,s);const Pt=Ne<Ae?-1:1;vt=Math.abs(Math.log(Ne/Ae))/Te,cr=()=>0,$t=sr=>Math.exp(Pt*Te*sr)}return e.duration="duration"in e?+e.duration:1e3*vt/("screenSpeed"in e?+e.screenSpeed/Te:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=S!==M,this._pitching=L!==T,this._padding=!d.isPaddingEqual(R),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(se),this._ease(Pt=>{const sr=Pt*vt,ln=1/$t(sr);d.zoom=Pt===1?ce:f+d.scaleZoom(ln),this._rotating&&(d.bearing=c.y.number(S,M,Pt)),this._pitching&&(d.pitch=c.y.number(T,L,Pt)),this._padding&&(d.interpolatePadding(I,R,Pt),X=d.centerPoint.add($)),this.terrain&&!e.freezeElevation&&this._updateElevation(Pt);const yr=Pt===1?se:d.unproject(ge.add(ne.mult(cr(sr))).mult(ln));d.setLocationAtPoint(d.renderWorldCopies?yr.wrap():yr,X),this._applyUpdatedTransform(d),this._fireMoveEvents(s)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,s)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,s,u){u.animate===!1||u.duration===0?(e(1),s()):(this._easeStart=Q.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=c.b3(e,-180,180);const u=Math.abs(e-s);return Math.abs(e-360-s)<u&&(e-=360),Math.abs(e+360-s)<u&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const u=e.lng-s.center.lng;e.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const il={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class al{constructor(e=il){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=H.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=H.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=H.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){H.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const u=this._map._getUIString(`AttributionControl.${s}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const s=this._map.style.sourceCaches;for(const d in s){const f=s[d];if(f.used||f.usedForTerrain){const S=f.getSource();S.attribution&&e.indexOf(S.attribution)<0&&e.push(S.attribution)}}e=e.filter(d=>String(d).trim()),e.sort((d,f)=>d.length-f.length),e=e.filter((d,f)=>{for(let S=f+1;S<e.length;S++)if(e[S].indexOf(d)>=0)return!1;return!0});const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class uh{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const u=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=H.create("div","maplibregl-ctrl");const s=H.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){H.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Er{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const d of u)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ch=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class qf extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const u={};for(const d of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))u[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.posMatrix=new Float64Array(16),c.aP(d.posMatrix,0,c.X,0,c.X,0,1),this._tiles[d.key]=new en(d,this.tileSize));for(const d in this._tiles)u[d]||delete this._tiles[d]}freeRtt(e){for(const s in this._tiles){const u=this._tiles[s];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const u of this._renderableTilesKeys){const d=this._tiles[u].tileID;if(d.canonical.equals(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16),c.aP(f.posMatrix,0,c.X,0,c.X,0,1),s[u]=f}else if(d.canonical.isChildOf(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const S=d.canonical.z-e.canonical.z,T=d.canonical.x-(d.canonical.x>>S<<S),I=d.canonical.y-(d.canonical.y>>S<<S),M=c.X>>S;c.aP(f.posMatrix,0,M,0,M,0,1),c.J(f.posMatrix,f.posMatrix,[-T*M,-I*M,0]),s[u]=f}else if(e.canonical.isChildOf(d.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const S=e.canonical.z-d.canonical.z,T=e.canonical.x-(e.canonical.x>>S<<S),I=e.canonical.y-(e.canonical.y>>S<<S),M=c.X>>S;c.aP(f.posMatrix,0,c.X,0,c.X,0,1),c.J(f.posMatrix,f.posMatrix,[T*M,I*M,0]),c.K(f.posMatrix,f.posMatrix,[1/2**S,1/2**S,0]),s[u]=f}}return s}getSourceTile(e,s){const u=this.sourceCache._source;let d=e.overscaledZ-this.deltaZoom;if(d>u.maxzoom&&(d=u.maxzoom),d<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!f||!f.dem)&&s)for(;d>=u.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(e.scaledTo(d--).key);return f}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=e)}}class hh{constructor(e,s,u){this.painter=e,this.sourceCache=new qf(s),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,u,d=c.X){var f;if(!(s>=0&&s<d&&u>=0&&u<d))return 0;const S=this.getTerrainData(e),T=(f=S.tile)===null||f===void 0?void 0:f.dem;if(!T)return 0;const I=function(ee,se,ce){var de=se[0],ge=se[1];return ee[0]=ce[0]*de+ce[4]*ge+ce[12],ee[1]=ce[1]*de+ce[5]*ge+ce[13],ee}([],[s/d*c.X,u/d*c.X],S.u_terrain_matrix),M=[I[0]*T.dim,I[1]*T.dim],L=Math.floor(M[0]),R=Math.floor(M[1]),$=M[0]-L,X=M[1]-R;return T.get(L,R)*(1-$)*(1-X)+T.get(L+1,R)*$*(1-X)+T.get(L,R+1)*(1-$)*X+T.get(L+1,R+1)*$*X}getElevationForLngLatZoom(e,s){if(!c.bb(s,e.wrap()))return 0;const{tileID:u,mercatorX:d,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(u,d%c.X,f%c.X,c.X)}getElevation(e,s,u,d=c.X){return this.getDEMElevation(e,s,u,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.painter.context,f=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new tt(d,f,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new tt(d,new c.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const d=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new tt(d,s.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),s.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const u=s&&s+s.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const d=this.sourceCache.sourceCache._source.maxzoom;let f=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?f=e.canonical.z-d:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=e.canonical.x-(e.canonical.x>>f<<f),T=e.canonical.y-(e.canonical.y>>f<<f),I=c.bc(new Float64Array(16),[1/(c.X<<f),1/(c.X<<f),0]);c.J(I,I,[S*c.X,T*c.X,0]),this._demMatrixCache[e.key]={matrix:I,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,u=s.width/devicePixelRatio,d=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new tt(s.context,{width:u,height:d,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new tt(s.context,{width:u,height:d,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(u,d,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,u,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,S=0;f<this._coordsTextureSize;f++)for(let T=0;T<this._coordsTextureSize;T++,S+=4)s[S+0]=255&T,s[S+1]=255&f,s[S+2]=T>>8<<4|f>>8,s[S+3]=0;const u=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),d=new tt(e,u,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),u=this.painter.context,d=u.gl,f=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),T=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(f,T-S-1,1,1,d.RGBA,d.UNSIGNED_BYTE,s),u.bindFramebuffer.set(null);const I=s[0]+(s[2]>>4<<8),M=s[1]+((15&s[2])<<8),L=this.coordsIndex[255-s[3]],R=L&&this.sourceCache.getTileByID(L);if(!R)return null;const $=this._coordsTextureSize,X=(1<<R.tileID.canonical.z)*$;return new c.Z((R.tileID.canonical.x*$+I)/X+R.tileID.wrap,(R.tileID.canonical.y*$+M)/X,this.getElevation(R.tileID,I,M,$))}depthAtPoint(e){const s=new Uint8Array(4),u=this.painter.context,d=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,s),u.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new c.bd,u=new c.aY,d=this.meshSize,f=c.X/d,S=d*d;for(let R=0;R<=d;R++)for(let $=0;$<=d;$++)s.emplaceBack($*f,R*f,0);for(let R=0;R<S;R+=d+1)for(let $=0;$<d;$++)u.emplaceBack($+R,d+$+R+1,d+$+R+2),u.emplaceBack($+R,d+$+R+2,$+R+1);const T=s.length,I=T+2*(d+1);for(const R of[0,1])for(let $=0;$<=d;$++)for(const X of[0,1])s.emplaceBack($*f,R*c.X,X);for(let R=0;R<2*d;R+=2)u.emplaceBack(I+R,I+R+1,I+R+3),u.emplaceBack(I+R,I+R+3,I+R+2),u.emplaceBack(T+R,T+R+3,T+R+1),u.emplaceBack(T+R,T+R+2,T+R+3);const M=s.length,L=M+2*(d+1);for(const R of[0,1])for(let $=0;$<=d;$++)for(const X of[0,1])s.emplaceBack(R*c.X,$*f,X);for(let R=0;R<2*d;R+=2)u.emplaceBack(M+R,M+R+1,M+R+3),u.emplaceBack(M+R,M+R+3,M+R+2),u.emplaceBack(L+R,L+R+3,L+R+1),u.emplaceBack(L+R,L+R+2,L+R+3);return this._mesh=new Ce(e.createVertexBuffer(s,ch.members),e.createIndexBuffer(u),c.a0.simpleSegment(0,0,s.length,u.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var u;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(u=this.getMinMaxElevation(d).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return s&&s.dem&&(u.minElevation=s.dem.min*this.exaggeration,u.maxElevation=s.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,s){const u=c.Z.fromLngLat(e.wrap()),d=(1<<s)*c.X,f=u.x*d,S=u.y*d,T=Math.floor(f/c.X),I=Math.floor(S/c.X);return{tileID:new c.S(s,0,s,T,I),mercatorX:f,mercatorY:S}}}class Gf{constructor(e,s,u){this._context=e,this._size=s,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new tt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(u.texture),{id:e,fbo:s,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>e.id!==s),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const sl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class zd{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new Gf(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(u=>!e._layers[u].isHidden(s)),this._coordsDescendingInv={};for(const u in e.sourceCaches){this._coordsDescendingInv[u]={};const d=e.sourceCaches[u].getVisibleCoordinates();for(const f of d){const S=this.terrain.sourceCache.getTerrainCoords(f);for(const T in S)this._coordsDescendingInv[u][T]||(this._coordsDescendingInv[u][T]=[]),this._coordsDescendingInv[u][T].push(S[T])}}this._coordsDescendingInvStr={};for(const u of e._order){const d=e._layers[u],f=d.source;if(sl[d.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const S in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][S]=this._coordsDescendingInv[f][S].map(T=>T.key).sort().join()}}for(const u of this._renderableTiles)for(const d in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[d][u.tileID.key];f&&f!==u.rttCoords[d]&&(u.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,u=this.painter,d=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(sl[s]&&(this._prevType&&sl[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!d))return!0;if(sl[this._prevType]||sl[s]&&d){this._prevType=s;const f=this._stacks.length-1,S=this._stacks[f]||[];for(const T of this._renderableTiles){if(this.pool.isFull()&&(xe(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(T),T.rtt[f]){const M=this.pool.getObjectForId(T.rtt[f].id);if(M.stamp===T.rtt[f].stamp){this.pool.useObject(M);continue}}const I=this.pool.getOrCreateFreeObject();this.pool.useObject(I),this.pool.stampObject(I),T.rtt[f]={id:I.id,stamp:I.stamp},u.context.bindFramebuffer.set(I.fbo.framebuffer),u.context.clear({color:c.aM.transparent,stencil:0}),u.currentStencilSource=void 0;for(let M=0;M<S.length;M++){const L=u.style._layers[S[M]],R=L.source?this._coordsDescendingInv[L.source][T.tileID.key]:[T.tileID];u.context.viewport.set([0,0,I.fbo.width,I.fbo.height]),u._renderTileClippingMasks(L,R),u.renderLayer(u,u.style.sourceCaches[L.source],L,R),L.source&&(T.rttCoords[L.source]=this._coordsDescendingInvStr[L.source][T.tileID.key])}}return xe(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),sl[s]}return!1}}const dh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ld=V,Kf={hash:!1,interactive:!0,bearingSnap:7,attributionControl:il,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},ph=m=>{m.touchstart=m.dragStart,m.touchmoveWindow=m.dragMove,m.touchend=m.dragEnd},Hf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Wf{constructor(e,s,u=!1){this.mousedown=S=>{this.startMouse(c.e({},S,{ctrlKey:!0,preventDefault:()=>S.preventDefault()}),H.mousePos(this.element,S)),H.addEventListener(window,"mousemove",this.mousemove),H.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.moveMouse(S,H.mousePos(this.element,S))},this.mouseup=S=>{this.mouseRotate.dragEnd(S),this.mousePitch&&this.mousePitch.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=H.touchPos(this.element,S.targetTouches)[0],this.startTouch(S,this._startPos),H.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=H.touchPos(this.element,S.targetTouches)[0],this.moveTouch(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const d=e.dragRotate._mouseRotate.getClickTolerance(),f=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=eh({clickTolerance:d,enable:!0}),this.touchRotate=(({enable:S,clickTolerance:T,bearingDegreesPerPixelMoved:I=.8})=>{const M=new Qc;return new ai({clickTolerance:T,move:(L,R)=>({bearingDelta:(R.x-L.x)*I}),moveStateManager:M,enable:S,assignEvents:ph})})({clickTolerance:d,enable:!0}),this.map=e,u&&(this.mousePitch=th({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:S,clickTolerance:T,pitchDegreesPerPixelMoved:I=-.5})=>{const M=new Qc;return new ai({clickTolerance:T,move:(L,R)=>({pitchDelta:(R.y-L.y)*I}),moveStateManager:M,enable:S,assignEvents:ph})})({clickTolerance:f,enable:!0})),H.addEventListener(s,"mousedown",this.mousedown),H.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),H.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),H.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),H.disableDrag()}moveMouse(e,s){const u=this.map,{bearingDelta:d}=this.mouseRotate.dragMove(e,s)||{};if(d&&u.setBearing(u.getBearing()+d),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(e,s)||{};f&&u.setPitch(u.getPitch()+f)}}moveTouch(e,s){const u=this.map,{bearingDelta:d}=this.touchRotate.dragMove(e,s)||{};if(d&&u.setBearing(u.getBearing()+d),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(e,s)||{};f&&u.setPitch(u.getPitch()+f)}}off(){const e=this.element;H.removeEventListener(e,"mousedown",this.mousedown),H.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),H.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.removeEventListener(window,"touchend",this.touchend),H.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){H.enableDrag(),H.removeEventListener(window,"mousemove",this.mousemove),H.removeEventListener(window,"mouseup",this.mouseup),H.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.removeEventListener(window,"touchend",this.touchend)}}let ta;function on(m,e,s){const u=new c.N(m.lng,m.lat);if(m=new c.N(m.lng,m.lat),e){const d=new c.N(m.lng-360,m.lat),f=new c.N(m.lng+360,m.lat),S=s.locationPoint(m).distSqr(e);s.locationPoint(d).distSqr(e)<S?m=d:s.locationPoint(f).distSqr(e)<S&&(m=f)}for(;Math.abs(m.lng-s.center.lng)>180;){const d=s.locationPoint(m);if(d.x>=0&&d.y>=0&&d.x<=s.width&&d.y<=s.height)break;m.lng>s.center.lng?m.lng-=360:m.lng+=360}return m.lng!==u.lng&&s.locationPoint(m).y>s.height/2-s.getHorizon()?m:u}const ol={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zu(m,e,s){const u=m.classList;for(const d in ol)u.remove(`maplibregl-${s}-anchor-${d}`);u.add(`maplibregl-${s}-anchor-${e}`)}class Xu extends c.E{constructor(e){if(super(),this._onKeyPress=s=>{const u=s.code,d=s.charCode||s.keyCode;u!=="Space"&&u!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=s=>{const u=s.originalEvent.target,d=this._element;this._popup&&(u===d||d.contains(u))&&this.togglePopup()},this._update=s=>{var u;if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();(s?.type==="terrain"||s?.type==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?on(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),H.setTransform(this._element,`${ol[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${f}`),Q.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=H.create("div");const s=H.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${u}px`),s.setAttributeNS(null,"width",`${d}px`),s.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);const f=H.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const S=H.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const T=H.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const de of I){const ge=H.createNS("http://www.w3.org/2000/svg","ellipse");ge.setAttributeNS(null,"opacity","0.04"),ge.setAttributeNS(null,"cx","10.5"),ge.setAttributeNS(null,"cy","5.80029008"),ge.setAttributeNS(null,"rx",de.rx),ge.setAttributeNS(null,"ry",de.ry),T.appendChild(ge)}const M=H.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const L=H.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(L);const R=H.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const $=H.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild($);const X=H.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(6.0, 7.0)"),X.setAttributeNS(null,"fill","#FFFFFF");const ee=H.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=H.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const ce=H.createNS("http://www.w3.org/2000/svg","circle");ce.setAttributeNS(null,"fill","#FFFFFF"),ce.setAttributeNS(null,"cx","5.5"),ce.setAttributeNS(null,"cy","5.5"),ce.setAttributeNS(null,"r","5.4999962"),ee.appendChild(se),ee.appendChild(ce),S.appendChild(T),S.appendChild(M),S.appendChild(R),S.appendChild(X),S.appendChild(ee),s.appendChild(S),s.setAttributeNS(null,"height",u*this._scale+"px"),s.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(s),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Zu(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),H.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,u;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const d=this._map,f=d.terrain.depthAtPoint(this._pos),S=d.terrain.getElevationForLngLatZoom(this._lngLat,d.transform.tileZoom);if(d.transform.lngLatToCameraDepth(this._lngLat,S)-f<.006)return void(this._element.style.opacity=this._opacity);const T=-this._offset.y/d.transform._pixelPerMeter,I=Math.sin(d.getPitch()*Math.PI/180)*T,M=d.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),L=d.transform.lngLatToCameraDepth(this._lngLat,S+I)-M>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&L&&this._popup.remove(),this._element.style.opacity=L?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const Rd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let iu=0,au=!1;const os={maxWidth:100,unit:"metric"};function su(m,e,s){const u=s&&s.maxWidth||100,d=m._container.clientHeight/2,f=m.unproject([0,d]),S=m.unproject([u,d]),T=f.distanceTo(S);if(s&&s.unit==="imperial"){const I=3.2808*T;I>5280?Vt(e,u,I/5280,m._getUIString("ScaleControl.Miles")):Vt(e,u,I,m._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Vt(e,u,T/1852,m._getUIString("ScaleControl.NauticalMiles")):T>=1e3?Vt(e,u,T/1e3,m._getUIString("ScaleControl.Kilometers")):Vt(e,u,T,m._getUIString("ScaleControl.Meters"))}function Vt(m,e,s,u){const d=function(f){const S=Math.pow(10,`${Math.floor(f)}`.length-1);let T=f/S;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(I){const M=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*M)/M}(T),S*T}(s);m.style.width=e*(d/s)+"px",m.innerHTML=`${d}&nbsp;${u}`}const tr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Yu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ju(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,m),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-m),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(m,0),right:new c.P(-m,0)}}if(m instanceof c.P||Array.isArray(m)){const e=c.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(m.center||[0,0]),top:c.P.convert(m.top||[0,0]),"top-left":c.P.convert(m["top-left"]||[0,0]),"top-right":c.P.convert(m["top-right"]||[0,0]),bottom:c.P.convert(m.bottom||[0,0]),"bottom-left":c.P.convert(m["bottom-left"]||[0,0]),"bottom-right":c.P.convert(m["bottom-right"]||[0,0]),left:c.P.convert(m.left||[0,0]),right:c.P.convert(m.right||[0,0])}}return Ju(new c.P(0,0))}const fh=V;x.AJAXError=c.bh,x.Evented=c.E,x.LngLat=c.N,x.MercatorCoordinate=c.Z,x.Point=c.P,x.addProtocol=c.bi,x.config=c.a,x.removeProtocol=c.bj,x.AttributionControl=al,x.BoxZoomHandler=er,x.CanvasSource=Wr,x.CooperativeGesturesHandler=nl,x.DoubleClickZoomHandler=Io,x.DragPanHandler=Ad,x.DragRotateHandler=Md,x.EdgeInsets=ke,x.FullscreenControl=class extends c.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){H.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=H.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);H.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},x.GeoJSONSource=_n,x.GeolocateControl=class extends c.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new c.N(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,d=this._map.getBearing(),f=c.e({bearing:d},this.options.fitBoundsOptions),S=Ee.fromLngLat(s,u);this._map.fitBounds(S,f,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&au)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=H.create("button","maplibregl-ctrl-geolocate",this._container),H.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Xu({element:this._dotElement}),this._circleElement=H.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},Rd,m)}onAdd(m){return this._map=m,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(ta!==void 0&&!e)return ta;if(window.navigator.permissions===void 0)return ta=!!window.navigator.geolocation,ta;try{ta=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ta=!!window.navigator.geolocation}return ta})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),H.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,iu=0,au=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),s=m.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),e=m.getSouthEast(),s=m.getNorthEast(),u=e.distanceTo(s),d=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":iu--,au=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),iu++,iu>1?(m={maximumAge:6e5,timeout:0},au=!0):(m=this.options.positionOptions,au=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},x.Hash=Ve,x.ImageSource=An,x.KeyboardHandler=ya,x.LngLatBounds=Ee,x.LogoControl=uh,x.Map=class extends Dd{constructor(m){c.bf.mark(c.bg.create);const e=Object.assign(Object.assign({},Kf),m);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ie(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Er,this._controls=[],this._mapId=c.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},dh),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=le.addThrottleControl(()=>this.isMoving()),this._requestManager=new we(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const u=Re(d=>{this._trackResize&&!this._removed&&(this.resize(d),this.redraw())},50);this._resizeObserver=new ResizeObserver(d=>{s?u(d):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new lh(this,e),this._hash=e.hash&&new Ve(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,c.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new al(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new uh,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new c.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new c.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new c.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=m.onAdd(this);this._controls.push(m);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,e,s,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,s,u)}resize(m){var e;const s=this._containerDimensions(),u=s[0],d=s[1],f=this._getClampedPixelRatio(u,d);if(this._resizeCanvas(u,d,f),this.painter.resize(u,d,f),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const I=this._getClampedPixelRatio(u,d);this._resizeCanvas(u,d,I),this.painter.resize(u,d,I)}this.transform.resize(u,d),(e=this._requestedCameraState)===null||e===void 0||e.resize(u,d);const S=!this._moving;return S&&(this.stop(),this.fire(new c.k("movestart",m)).fire(new c.k("move",m))),this.fire(new c.k("resize",m)),S&&this.fire(new c.k("moveend",m)),this}_getClampedPixelRatio(m,e){const{0:s,1:u}=this._maxCanvasSize,d=this.getPixelRatio(),f=m*d,S=e*d;return Math.min(f>s?s/f:1,S>u?u/S:1)*d}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(Ee.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(c.N.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.pointLocation(c.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,s){if(m==="mouseenter"||m==="mouseover"){let u=!1;return{layers:e,listener:s,delegates:{mousemove:f=>{const S=e.filter(I=>this.getLayer(I)),T=S.length!==0?this.queryRenderedFeatures(f.point,{layers:S}):[];T.length?u||(u=!0,s.call(this,new ot(m,this,f.originalEvent,{features:T}))):u=!1},mouseout:()=>{u=!1}}}}if(m==="mouseleave"||m==="mouseout"){let u=!1;return{layers:e,listener:s,delegates:{mousemove:S=>{const T=e.filter(I=>this.getLayer(I));(T.length!==0?this.queryRenderedFeatures(S.point,{layers:T}):[]).length?u=!0:u&&(u=!1,s.call(this,new ot(m,this,S.originalEvent)))},mouseout:S=>{u&&(u=!1,s.call(this,new ot(m,this,S.originalEvent)))}}}}{const u=d=>{const f=e.filter(T=>this.getLayer(T)),S=f.length!==0?this.queryRenderedFeatures(d.point,{layers:f}):[];S.length&&(d.features=S,s.call(this,d),delete d.features)};return{layers:e,listener:s,delegates:{[m]:u}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,s){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const u=this._delegatedListeners[m];for(let d=0;d<u.length;d++){const f=u[d];if(f.listener===s&&f.layers.length===e.length&&f.layers.every(S=>e.includes(S))){for(const S in f.delegates)this.off(S,f.delegates[S]);return void u.splice(d,1)}}}on(m,e,s){if(s===void 0)return super.on(m,e);const u=this._createDelegatedListener(m,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(m,u);for(const d in u.delegates)this.on(d,u.delegates[d]);return this}once(m,e,s){if(s===void 0)return super.once(m,e);const u=typeof e=="string"?[e]:e,d=this._createDelegatedListener(m,u,s);for(const f in d.delegates){const S=d.delegates[f];d.delegates[f]=(...T)=>{this._removeDelegatedListener(m,u,s),S(...T)}}this._saveDelegatedListener(m,d);for(const f in d.delegates)this.once(f,d.delegates[f]);return this}off(m,e,s){return s===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let s;const u=m instanceof c.P||Array.isArray(m),d=u?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:m)||{},d instanceof c.P||typeof d[0]=="number")s=[c.P.convert(d)];else{const f=c.P.convert(d[0]),S=c.P.convert(d[1]);s=[f,new c.P(S.x,f.y),S,new c.P(f.x,S.y),f]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,e));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Ja(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,s):this.style.loadJSON(m,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ja(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const s=this._requestManager.transformRequest(m,"Style");c.h(s,new AbortController).then(u=>{this._updateDiff(u.data,e)}).catch(u=>{u&&this.fire(new c.j(u))})}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(s){c.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const u=this.style._layers[s];u.type==="hillshade"&&u.source===m.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new hh(this.painter,e,m),this.painter.renderToTexture=new zd(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==m.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const e in m){const s=m[e]._tiles;for(const u in s){const d=s[u];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,e,s={}){const{pixelRatio:u=1,sdf:d=!1,stretchX:f,stretchY:S,content:T,textFitWidth:I,textFitHeight:M}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:R,data:$}=e,X=e;return this.style.addImage(m,{data:new c.R({width:L,height:R},new Uint8Array($)),pixelRatio:u,stretchX:f,stretchY:S,content:T,textFitWidth:I,textFitHeight:M,sdf:d,version:0,userImage:X}),X.onAdd&&X.onAdd(this,m),this}}{const{width:L,height:R,data:$}=Q.getImageData(e);this.style.addImage(m,{data:new c.R({width:L,height:R},$),pixelRatio:u,stretchX:f,stretchY:S,content:T,textFitWidth:I,textFitHeight:M,sdf:d,version:0})}}updateImage(m,e){const s=this.style.getImage(m);if(!s)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||c.b(e)?Q.getImageData(e):e,{width:d,height:f,data:S}=u;if(d===void 0||f===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==s.data.width||f!==s.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(e instanceof HTMLImageElement||c.b(e));return s.data.replace(S,T),this.style.updateImage(m,s),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return le.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,s){return this.style.setLayerZoomRange(m,e,s),this._update(!0)}setFilter(m,e,s={}){return this.style.setFilter(m,e,s),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,s,u={}){return this.style.setPaintProperty(m,e,s,u),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,s,u={}){return this.style.setLayoutProperty(m,e,s,u),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,s,u=>{u||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,s=>{s||this._update(!0)}),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m){return this._lazyInitEmptyStyle(),this.style.setSky(m),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=H.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=H.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),u=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],u);const d=this._controlContainer=H.create("div","maplibregl-control-container",m),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{f[S]=H.create("div",`maplibregl-ctrl-${S} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,s){this._canvas.width=Math.floor(s*m),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{e={requestedAttributes:m},u&&(e.statusMessage=u.statusMessage,e.type=u.type)},{once:!0});const s=this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m);if(!s){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new De(s,this.transform),Le.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const d=this.transform.zoom,f=Q.now();this.style.zoomHistory.update(d,f);const S=new c.z(d,{now:f,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),T=S.crossFadingFactor();T===1&&T===this._crossFadingFactor||(s=!0,this._crossFadingFactor=T),this.style.update(S)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),le.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),H.remove(this._canvasContainer),H.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Q.frameAsync(this._frameRequest).then(m=>{c.bf.frame(m),this._frameRequest=null,this._render(m)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Ld}getCameraTargetElevation(){return this.transform.elevation}},x.MapMouseEvent=ot,x.MapTouchEvent=Lt,x.MapWheelEvent=mr,x.Marker=Xu,x.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const u=this._map._getUIString(`NavigationControl.${s}`);e.title=u,e.setAttribute("aria-label",u)},this.options=c.e({},Hf,m),this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),H.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),H.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=H.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Wf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){H.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const s=H.create("button",m,this._container);return s.type="button",s.addEventListener("click",e),s}},x.Popup=class extends c.E{constructor(m){super(),this.remove=()=>(this._content&&H.remove(this._content),this._container&&(H.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=H.create("div","maplibregl-popup",this._map.getContainer()),this._tip=H.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?on(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const u=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let d=this.options.anchor;const f=Ju(this.options.offset);if(!d){const T=this._container.offsetWidth,I=this._container.offsetHeight;let M;M=u.y+f.bottom.y<I?["top"]:u.y>this._map.transform.height-I?["bottom"]:[],u.x<T/2?M.push("left"):u.x>this._map.transform.width-T/2&&M.push("right"),d=M.length===0?"bottom":M.join("-")}let S=u.add(f[d]);this.options.subpixelPositioning||(S=S.round()),H.setTransform(this._container,`${ol[d]} translate(${S.x}px,${S.y}px)`),Zu(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(tr),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=c.N.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),s=document.createElement("body");let u;for(s.innerHTML=m;u=s.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=H.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=H.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Yu);m&&m.focus()}},x.RasterDEMTileSource=pr,x.RasterTileSource=Jt,x.ScaleControl=class{constructor(m){this._onMove=()=>{su(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,su(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},os),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){H.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},x.ScrollZoomHandler=Ra,x.Style=Ja,x.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=H.create("button","maplibregl-ctrl-terrain",this._container),H.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){H.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},x.TwoFingersTouchPitchHandler=nu,x.TwoFingersTouchRotateHandler=ah,x.TwoFingersTouchZoomHandler=nh,x.TwoFingersTouchZoomRotateHandler=oh,x.VectorTileSource=Pr,x.VideoSource=an,x.addSourceType=(m,e)=>c._(void 0,void 0,void 0,function*(){if(Yr(m))throw new Error(`A source type called "${m}" already exists.`);((s,u)=>{Vr[s]=u})(m,e)}),x.clearPrewarmedResources=function(){const m=Mr;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Sr),Mr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},x.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},x.getRTLTextPluginStatus=function(){return Cn().getRTLTextPluginStatus()},x.getVersion=function(){return fh},x.getWorkerCount=function(){return br.workerCount},x.getWorkerUrl=function(){return c.a.WORKER_URL},x.importScriptInWorkers=function(m){return Nt().broadcast("IS",m)},x.prewarm=function(){ct().acquire(Sr)},x.setMaxParallelImageRequests=function(m){c.a.MAX_PARALLEL_IMAGE_REQUESTS=m},x.setRTLTextPlugin=function(m,e){return Cn().setRTLTextPlugin(m,e)},x.setWorkerCount=function(m){br.workerCount=m},x.setWorkerUrl=function(m){c.a.WORKER_URL=m}});var w=o;return w})})(nw);var VC=nw.exports;const cg=vf(VC),fx={version:8,name:"Dark",sources:{"carto-dark":{type:"raster",tiles:["https://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png","https://b.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png","https://c.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png"],tileSize:256,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}},layers:[{id:"carto-dark-layer",type:"raster",source:"carto-dark",minzoom:0,maxzoom:22}]},mx={version:8,name:"Satellite",sources:{"esri-satellite":{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"Tiles &copy; Esri"}},layers:[{id:"esri-satellite-layer",type:"raster",source:"esri-satellite",minzoom:0,maxzoom:19}]},$C=[75.5,13],qC=8,aw=st.forwardRef(({center:n,zoom:r,basemap:o,layers:h,activeLayers:y,currentLocation:w,onMapMove:x,onMapClick:c},V)=>{const G=st.useRef(null),Y=st.useRef(null),Q=st.useRef(null),H=st.useRef(null);st.useImperativeHandle(V,()=>({zoomIn:()=>{Y.current&&Y.current.zoomIn({duration:300})},zoomOut:()=>{Y.current&&Y.current.zoomOut({duration:300})},flyTo:(be,$e)=>{Y.current&&Y.current.flyTo({center:be,zoom:$e??Y.current.getZoom(),duration:800,essential:!0})},resetView:()=>{Y.current&&Y.current.flyTo({center:$C,zoom:qC,duration:1e3,essential:!0})}}),[]),st.useEffect(()=>{if(!(!G.current||Y.current))return Y.current=new cg.Map({container:G.current,style:o==="dark"?fx:mx,center:n,zoom:r,attributionControl:{compact:!0},maxZoom:18,minZoom:4,touchZoomRotate:!0,touchPitch:!1,dragRotate:!1,pitchWithRotate:!1}),Y.current.addControl(new cg.ScaleControl({maxWidth:100}),"bottom-left"),Y.current.on("moveend",()=>{if(Y.current){const be=Y.current.getCenter();x([be.lng,be.lat],Y.current.getZoom())}}),Y.current.on("click",be=>{c&&c(be.lngLat.lat,be.lngLat.lng)}),()=>{Y.current?.remove(),Y.current=null}},[]),st.useEffect(()=>{Y.current&&Y.current.setStyle(o==="dark"?fx:mx)},[o]),st.useEffect(()=>{if(!Y.current)return;const be=Y.current.getCenter(),$e=Y.current.getZoom(),re=Math.abs(be.lng-n[0])+Math.abs(be.lat-n[1]),J=Math.abs($e-r);(re>.001||J>.5)&&Y.current.flyTo({center:n,zoom:r,duration:800,essential:!0})},[n,r]),st.useEffect(()=>{if(!Y.current||!w)return;if(Q.current)Q.current.setLngLat([w.lon,w.lat]);else{const $e=document.createElement("div");$e.className="user-marker",Q.current=new cg.Marker({element:$e}).setLngLat([w.lon,w.lat]).addTo(Y.current)}const be=()=>{if(!Y.current)return;const $e="accuracy-source",re="accuracy-layer",J=GC(w.lon,w.lat,w.accuracy);Y.current.getSource($e)?Y.current.getSource($e).setData(J):(Y.current.addSource($e,{type:"geojson",data:J}),Y.current.addLayer({id:re,type:"fill",source:$e,paint:{"fill-color":"#4a9eff","fill-opacity":.15}}),Y.current.addLayer({id:`${re}-outline`,type:"line",source:$e,paint:{"line-color":"#4a9eff","line-width":2}}),H.current=$e)};Y.current.isStyleLoaded()?be():Y.current.once("styledata",be)},[w]);const Le=st.useCallback(async()=>{if(Y.current){if(!Y.current.isStyleLoaded()){Y.current.once("styledata",Le);return}for(const be of h){if(be.source.format!=="geojson")continue;const $e=`source-${be.id}`,re=y.has(be.id);try{if(Y.current.getSource($e)){const J=`layer-${be.id}`;Y.current.getLayer(J)&&Y.current.setLayoutProperty(J,"visibility",re?"visible":"none"),Y.current.getLayer(`${J}-outline`)&&Y.current.setLayoutProperty(`${J}-outline`,"visibility",re?"visible":"none")}else{const J=await fetch(be.source.path);if(J.ok){const le=await J.json();Y.current.addSource($e,{type:"geojson",data:le});const we=`layer-${be.id}`;be.style?.kind==="polygon"||be.style?.kind==="choropleth"?(Y.current.addLayer({id:we,type:"fill",source:$e,paint:{"fill-color":be.style?.colors?.default||"#4a9eff","fill-opacity":.3},layout:{visibility:re?"visible":"none"}}),Y.current.addLayer({id:`${we}-outline`,type:"line",source:$e,paint:{"line-color":be.style?.colors?.default?.replace("33","ff")||"#4a9eff","line-width":2},layout:{visibility:re?"visible":"none"}})):be.style?.kind==="point"&&Y.current.addLayer({id:we,type:"circle",source:$e,paint:{"circle-radius":6,"circle-color":"#ff9800","circle-stroke-width":2,"circle-stroke-color":"#fff"},layout:{visibility:re?"visible":"none"}})}}}catch(J){console.warn(`Failed to load layer ${be.id}:`,J)}}}},[h,y]);st.useEffect(()=>{Le()},[Le]);const Be=st.useCallback(async()=>{if(Y.current){if(!Y.current.isStyleLoaded()){Y.current.once("styledata",Be);return}for(const be of h){if(be.type!=="image-overlay"||!be.bounds)continue;const $e=`source-${be.id}`,re=`layer-${be.id}`,J=y.has(be.id);try{Y.current.getSource($e)?Y.current.getLayer(re)&&Y.current.setLayoutProperty(re,"visibility",J?"visible":"none"):(Y.current.addSource($e,{type:"image",url:be.source.path,coordinates:[[be.bounds.west,be.bounds.north],[be.bounds.east,be.bounds.north],[be.bounds.east,be.bounds.south],[be.bounds.west,be.bounds.south]]}),Y.current.addLayer({id:re,type:"raster",source:$e,paint:{"raster-opacity":be.style?.opacity??.7,"raster-fade-duration":0},layout:{visibility:J?"visible":"none"}}))}catch(le){console.warn(`Failed to load image layer ${be.id}:`,le)}}}},[h,y]);return st.useEffect(()=>{Be()},[Be]),O.jsx("div",{ref:G,className:"map-container"})});aw.displayName="MapView";function GC(n,r,o){const y=[];for(let w=0;w<64;w++){const x=w/64*2*Math.PI,c=o*Math.cos(x),G=o*Math.sin(x)/111320,Y=c/(111320*Math.cos(r*Math.PI/180));y.push([n+Y,r+G])}return y.push(y[0]),{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[y]}}}const KC=({isOnline:n,syncStatus:r,onSettingsClick:o})=>O.jsxs("header",{className:"app-header",children:[O.jsxs("div",{className:"header-brand",children:[O.jsx("div",{className:"header-logo",children:O.jsxs("svg",{viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[O.jsx("path",{d:"M16 2L4 10v12l12 8 12-8V10L16 2z",fill:"url(#logoGrad)",opacity:"0.9"}),O.jsx("path",{d:"M16 6l-8 5v8l8 5 8-5v-8l-8-5z",fill:"#0f0f1a"}),O.jsx("path",{d:"M16 8l-6 4v6l6 4 6-4v-6l-6-4z",fill:"url(#logoGrad2)"}),O.jsx("circle",{cx:"16",cy:"15",r:"3",fill:"#0f0f1a"}),O.jsx("path",{d:"M14 14h4v3h-4z",fill:"#4caf50"}),O.jsxs("defs",{children:[O.jsxs("linearGradient",{id:"logoGrad",x1:"4",y1:"4",x2:"28",y2:"28",children:[O.jsx("stop",{offset:"0%",stopColor:"#4caf50"}),O.jsx("stop",{offset:"100%",stopColor:"#2e7d32"})]}),O.jsxs("linearGradient",{id:"logoGrad2",x1:"10",y1:"8",x2:"22",y2:"22",children:[O.jsx("stop",{offset:"0%",stopColor:"#81c784"}),O.jsx("stop",{offset:"100%",stopColor:"#4caf50"})]})]})]})}),O.jsxs("div",{className:"header-title",children:[O.jsx("span",{className:"title-main",children:"WG Field Validator"}),O.jsx("span",{className:"title-sub",children:"Western Ghats Eco-Monitor"})]})]}),O.jsxs("div",{className:"header-status",children:[O.jsxs("div",{className:`connection-indicator ${n?"online":"offline"}`,children:[O.jsx("span",{className:"indicator-dot"}),O.jsx("span",{className:"indicator-text",children:n?"Online":"Offline"})]}),r&&r.pending>0&&O.jsxs("div",{className:"sync-badge",children:[O.jsx("span",{className:"sync-icon",children:""}),O.jsx("span",{className:"sync-count",children:r.pending})]}),O.jsx("button",{className:"header-settings",onClick:o,title:"Settings",children:O.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:O.jsx("path",{d:"M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.49.49 0 00-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 00-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"})})})]})]}),HC=({activeTab:n,onTabChange:r,onCaptureClick:o,pendingSync:h=0})=>O.jsxs("nav",{className:"bottom-nav",children:[O.jsxs("button",{className:`nav-item ${n==="map"?"active":""}`,onClick:()=>r("map"),children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:O.jsx("path",{d:"M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z"})}),O.jsx("span",{children:"Map"})]}),O.jsxs("button",{className:`nav-item ${n==="layers"?"active":""}`,onClick:()=>r("layers"),children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:O.jsx("path",{d:"M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z"})}),O.jsx("span",{children:"Layers"})]}),O.jsx("button",{className:"nav-capture-btn",onClick:o,title:"Add Field Observation",children:O.jsx("svg",{viewBox:"0 0 24 24",width:"28",height:"28",fill:"currentColor",children:O.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"})})}),O.jsxs("button",{className:`nav-item ${n==="protocols"?"active":""}`,onClick:()=>r("protocols"),children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:O.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"})}),O.jsx("span",{children:"Guide"})]}),O.jsxs("button",{className:`nav-item ${n==="log"?"active":""}`,onClick:()=>r("log"),children:[O.jsxs("div",{className:"nav-item-badge-container",children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:O.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"})}),h>0&&O.jsx("span",{className:"nav-badge",children:h})]}),O.jsx("span",{children:"Log"})]})]}),WC=({onZoomIn:n,onZoomOut:r,onLocateMe:o,onResetView:h,isLocating:y=!1})=>O.jsxs("div",{className:"map-controls",children:[O.jsxs("div",{className:"zoom-controls",children:[O.jsx("button",{className:"map-ctrl-btn",onClick:n,title:"Zoom In",children:O.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:O.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})})}),O.jsx("button",{className:"map-ctrl-btn",onClick:r,title:"Zoom Out",children:O.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:O.jsx("path",{d:"M19 13H5v-2h14v2z"})})})]}),O.jsxs("div",{className:"location-controls",children:[O.jsx("button",{className:`map-ctrl-btn locate-btn ${y?"locating":""}`,onClick:o,title:"My Location",children:O.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:O.jsx("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"})})}),O.jsx("button",{className:"map-ctrl-btn",onClick:h,title:"Reset View to Western Ghats",children:O.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:O.jsx("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"})})})]})]}),ZC=[{id:"dk",name:"Dakshina Kannada",displayName:"Dakshina Kannada, Karnataka",type:"district",lat:12.8438,lon:75.2479,state:"Karnataka",importance:.9},{id:"uk",name:"Uttara Kannada",displayName:"Uttara Kannada, Karnataka",type:"district",lat:14.6819,lon:74.6899,state:"Karnataka",importance:.9},{id:"udupi",name:"Udupi",displayName:"Udupi, Karnataka",type:"district",lat:13.3409,lon:74.7421,state:"Karnataka",importance:.9},{id:"shimoga",name:"Shimoga",displayName:"Shimoga, Karnataka",type:"district",lat:13.9299,lon:75.5681,state:"Karnataka",importance:.9},{id:"chikmagalur",name:"Chikmagalur",displayName:"Chikmagalur, Karnataka",type:"district",lat:13.3161,lon:75.772,state:"Karnataka",importance:.9},{id:"hassan",name:"Hassan",displayName:"Hassan, Karnataka",type:"district",lat:13.0068,lon:76.1003,state:"Karnataka",importance:.9},{id:"kodagu",name:"Kodagu",displayName:"Kodagu (Coorg), Karnataka",type:"district",lat:12.4244,lon:75.7382,state:"Karnataka",importance:.9},{id:"mysore",name:"Mysore",displayName:"Mysore, Karnataka",type:"district",lat:12.2958,lon:76.6394,state:"Karnataka",importance:.95},{id:"bangalore",name:"Bangalore",displayName:"Bangalore, Karnataka",type:"district",lat:12.9716,lon:77.5946,state:"Karnataka",importance:1},{id:"belgaum",name:"Belgaum",displayName:"Belgaum, Karnataka",type:"district",lat:15.8497,lon:74.4977,state:"Karnataka",importance:.9},{id:"dharwad",name:"Dharwad",displayName:"Dharwad, Karnataka",type:"district",lat:15.4589,lon:75.0078,state:"Karnataka",importance:.9},{id:"haveri",name:"Haveri",displayName:"Haveri, Karnataka",type:"district",lat:14.7951,lon:75.3991,state:"Karnataka",importance:.85},{id:"chamrajnagar",name:"Chamarajanagar",displayName:"Chamarajanagar, Karnataka",type:"district",lat:11.9261,lon:76.9437,state:"Karnataka",importance:.85},{id:"mandya",name:"Mandya",displayName:"Mandya, Karnataka",type:"district",lat:12.5218,lon:76.8951,state:"Karnataka",importance:.85},{id:"ramanagara",name:"Ramanagara",displayName:"Ramanagara, Karnataka",type:"district",lat:12.7159,lon:77.2819,state:"Karnataka",importance:.8}],XC=[{id:"mangalore",name:"Mangalore",displayName:"Mangalore, Dakshina Kannada",type:"city",lat:12.9141,lon:74.856,district:"Dakshina Kannada",state:"Karnataka",importance:.95},{id:"puttur",name:"Puttur",displayName:"Puttur, Dakshina Kannada",type:"town",lat:12.7596,lon:75.2025,district:"Dakshina Kannada",state:"Karnataka",importance:.7},{id:"sullia",name:"Sullia",displayName:"Sullia, Dakshina Kannada",type:"town",lat:12.561,lon:75.3871,district:"Dakshina Kannada",state:"Karnataka",importance:.65},{id:"bantwal",name:"Bantwal",displayName:"Bantwal, Dakshina Kannada",type:"town",lat:12.8914,lon:75.0345,district:"Dakshina Kannada",state:"Karnataka",importance:.7},{id:"belthangady",name:"Belthangady",displayName:"Belthangady, Dakshina Kannada",type:"town",lat:12.9833,lon:75.3,district:"Dakshina Kannada",state:"Karnataka",importance:.65},{id:"udupi_city",name:"Udupi",displayName:"Udupi City, Udupi",type:"city",lat:13.3409,lon:74.7421,district:"Udupi",state:"Karnataka",importance:.85},{id:"kundapura",name:"Kundapura",displayName:"Kundapura, Udupi",type:"town",lat:13.6316,lon:74.6916,district:"Udupi",state:"Karnataka",importance:.7},{id:"karkala",name:"Karkala",displayName:"Karkala, Udupi",type:"town",lat:13.2167,lon:74.9833,district:"Udupi",state:"Karnataka",importance:.7},{id:"karwar",name:"Karwar",displayName:"Karwar, Uttara Kannada",type:"city",lat:14.8182,lon:74.1351,district:"Uttara Kannada",state:"Karnataka",importance:.8},{id:"sirsi",name:"Sirsi",displayName:"Sirsi, Uttara Kannada",type:"town",lat:14.6214,lon:74.8354,district:"Uttara Kannada",state:"Karnataka",importance:.75},{id:"kumta",name:"Kumta",displayName:"Kumta, Uttara Kannada",type:"town",lat:14.4284,lon:74.4141,district:"Uttara Kannada",state:"Karnataka",importance:.7},{id:"honavar",name:"Honavar",displayName:"Honavar, Uttara Kannada",type:"town",lat:14.2805,lon:74.4438,district:"Uttara Kannada",state:"Karnataka",importance:.7},{id:"bhatkal",name:"Bhatkal",displayName:"Bhatkal, Uttara Kannada",type:"town",lat:13.985,lon:74.5553,district:"Uttara Kannada",state:"Karnataka",importance:.7},{id:"dandeli",name:"Dandeli",displayName:"Dandeli, Uttara Kannada",type:"town",lat:15.2667,lon:74.6167,district:"Uttara Kannada",state:"Karnataka",importance:.75},{id:"ankola",name:"Ankola",displayName:"Ankola, Uttara Kannada",type:"town",lat:14.66,lon:74.3,district:"Uttara Kannada",state:"Karnataka",importance:.65},{id:"gokarna",name:"Gokarna",displayName:"Gokarna, Uttara Kannada",type:"town",lat:14.55,lon:74.3167,district:"Uttara Kannada",state:"Karnataka",importance:.75},{id:"murudeshwar",name:"Murudeshwar",displayName:"Murudeshwar, Uttara Kannada",type:"town",lat:14.0944,lon:74.4844,district:"Uttara Kannada",state:"Karnataka",importance:.7},{id:"shimoga_city",name:"Shimoga",displayName:"Shimoga City, Shimoga",type:"city",lat:13.9299,lon:75.5681,district:"Shimoga",state:"Karnataka",importance:.85},{id:"bhadravati",name:"Bhadravati",displayName:"Bhadravati, Shimoga",type:"town",lat:13.8489,lon:75.705,district:"Shimoga",state:"Karnataka",importance:.75},{id:"sagar",name:"Sagar",displayName:"Sagar, Shimoga",type:"town",lat:14.1667,lon:75.0333,district:"Shimoga",state:"Karnataka",importance:.7},{id:"hosanagara",name:"Hosanagara",displayName:"Hosanagara, Shimoga",type:"town",lat:13.9167,lon:75.0667,district:"Shimoga",state:"Karnataka",importance:.6},{id:"thirthahalli",name:"Thirthahalli",displayName:"Thirthahalli, Shimoga",type:"town",lat:13.6833,lon:75.2333,district:"Shimoga",state:"Karnataka",importance:.65},{id:"jog_falls",name:"Jog Falls",displayName:"Jog Falls, Shimoga",type:"landmark",lat:14.2294,lon:74.8124,district:"Shimoga",state:"Karnataka",importance:.8},{id:"chikmagalur_city",name:"Chikmagalur",displayName:"Chikmagalur City",type:"city",lat:13.3161,lon:75.772,district:"Chikmagalur",state:"Karnataka",importance:.8},{id:"kadur",name:"Kadur",displayName:"Kadur, Chikmagalur",type:"town",lat:13.55,lon:76.0167,district:"Chikmagalur",state:"Karnataka",importance:.65},{id:"mudigere",name:"Mudigere",displayName:"Mudigere, Chikmagalur",type:"town",lat:13.1333,lon:75.6333,district:"Chikmagalur",state:"Karnataka",importance:.65},{id:"sringeri",name:"Sringeri",displayName:"Sringeri, Chikmagalur",type:"town",lat:13.4167,lon:75.25,district:"Chikmagalur",state:"Karnataka",importance:.7},{id:"mullayanagiri",name:"Mullayanagiri",displayName:"Mullayanagiri Peak, Chikmagalur",type:"natural",lat:13.3875,lon:75.7229,district:"Chikmagalur",state:"Karnataka",importance:.75},{id:"bababudangiri",name:"Baba Budangiri",displayName:"Baba Budangiri, Chikmagalur",type:"natural",lat:13.4333,lon:75.75,district:"Chikmagalur",state:"Karnataka",importance:.7},{id:"madikeri",name:"Madikeri",displayName:"Madikeri (Mercara), Kodagu",type:"city",lat:12.4244,lon:75.7382,district:"Kodagu",state:"Karnataka",importance:.8},{id:"virajpet",name:"Virajpet",displayName:"Virajpet, Kodagu",type:"town",lat:12.1972,lon:75.8019,district:"Kodagu",state:"Karnataka",importance:.7},{id:"somwarpet",name:"Somwarpet",displayName:"Somwarpet, Kodagu",type:"town",lat:12.5961,lon:75.85,district:"Kodagu",state:"Karnataka",importance:.65},{id:"kushalnagar",name:"Kushalnagar",displayName:"Kushalnagar, Kodagu",type:"town",lat:12.4582,lon:75.9586,district:"Kodagu",state:"Karnataka",importance:.65},{id:"talakaveri",name:"Talakaveri",displayName:"Talakaveri, Kodagu",type:"landmark",lat:12.3833,lon:75.4833,district:"Kodagu",state:"Karnataka",importance:.7},{id:"hassan_city",name:"Hassan",displayName:"Hassan City",type:"city",lat:13.0068,lon:76.1003,district:"Hassan",state:"Karnataka",importance:.8},{id:"belur",name:"Belur",displayName:"Belur, Hassan",type:"town",lat:13.1667,lon:75.8667,district:"Hassan",state:"Karnataka",importance:.75},{id:"halebidu",name:"Halebidu",displayName:"Halebidu, Hassan",type:"landmark",lat:13.2117,lon:75.9944,district:"Hassan",state:"Karnataka",importance:.75},{id:"sakleshpur",name:"Sakleshpur",displayName:"Sakleshpur, Hassan",type:"town",lat:12.9429,lon:75.7847,district:"Hassan",state:"Karnataka",importance:.7},{id:"hubli",name:"Hubli",displayName:"Hubli-Dharwad, Karnataka",type:"city",lat:15.3647,lon:75.124,state:"Karnataka",importance:.9},{id:"belgaum_city",name:"Belgaum",displayName:"Belgaum City",type:"city",lat:15.8497,lon:74.4977,district:"Belgaum",state:"Karnataka",importance:.85}],YC=[{id:"kudremukh",name:"Kudremukh",displayName:"Kudremukh National Park",type:"natural",lat:13.25,lon:75.25,district:"Chikmagalur",state:"Karnataka",importance:.85},{id:"bhadra",name:"Bhadra Wildlife Sanctuary",displayName:"Bhadra Wildlife Sanctuary",type:"natural",lat:13.6833,lon:75.5167,district:"Chikmagalur",state:"Karnataka",importance:.8},{id:"sharavathi",name:"Sharavathi Valley",displayName:"Sharavathi Valley Wildlife Sanctuary",type:"natural",lat:14.1333,lon:74.9167,district:"Shimoga",state:"Karnataka",importance:.75},{id:"agumbe",name:"Agumbe",displayName:"Agumbe Rainforest",type:"natural",lat:13.5019,lon:75.0933,district:"Shimoga",state:"Karnataka",importance:.8},{id:"nagarhole",name:"Nagarhole",displayName:"Nagarhole National Park",type:"natural",lat:12.0167,lon:76.0167,district:"Kodagu",state:"Karnataka",importance:.85},{id:"bandipur",name:"Bandipur",displayName:"Bandipur National Park",type:"natural",lat:11.6667,lon:76.6333,district:"Chamarajanagar",state:"Karnataka",importance:.85},{id:"pushpagiri",name:"Pushpagiri",displayName:"Pushpagiri Wildlife Sanctuary",type:"natural",lat:12.5833,lon:75.7,district:"Kodagu",state:"Karnataka",importance:.7},{id:"brahmagiri",name:"Brahmagiri",displayName:"Brahmagiri Wildlife Sanctuary",type:"natural",lat:11.9333,lon:75.9833,district:"Kodagu",state:"Karnataka",importance:.7},{id:"anshi",name:"Anshi National Park",displayName:"Anshi National Park",type:"natural",lat:15.0667,lon:74.4,district:"Uttara Kannada",state:"Karnataka",importance:.75},{id:"kali_tiger",name:"Kali Tiger Reserve",displayName:"Kali Tiger Reserve",type:"natural",lat:15.3,lon:74.5,district:"Uttara Kannada",state:"Karnataka",importance:.8}],JC=[{id:"wayanad",name:"Wayanad",displayName:"Wayanad, Kerala",type:"district",lat:11.6854,lon:76.132,state:"Kerala",importance:.85},{id:"palakkad",name:"Palakkad",displayName:"Palakkad, Kerala",type:"district",lat:10.7867,lon:76.6548,state:"Kerala",importance:.85},{id:"idukki",name:"Idukki",displayName:"Idukki, Kerala",type:"district",lat:9.9189,lon:77.1025,state:"Kerala",importance:.85},{id:"munnar",name:"Munnar",displayName:"Munnar, Kerala",type:"town",lat:10.0889,lon:77.0595,state:"Kerala",importance:.85},{id:"nilgiris",name:"Nilgiris",displayName:"Nilgiris (Ooty), Tamil Nadu",type:"district",lat:11.4102,lon:76.695,state:"Tamil Nadu",importance:.9},{id:"ooty",name:"Ooty",displayName:"Ooty, Nilgiris",type:"city",lat:11.4102,lon:76.695,state:"Tamil Nadu",importance:.9},{id:"coimbatore",name:"Coimbatore",displayName:"Coimbatore, Tamil Nadu",type:"city",lat:11.0168,lon:76.9558,state:"Tamil Nadu",importance:.9},{id:"north_goa",name:"North Goa",displayName:"North Goa",type:"district",lat:15.5333,lon:73.95,state:"Goa",importance:.85},{id:"south_goa",name:"South Goa",displayName:"South Goa",type:"district",lat:15.2833,lon:74.1667,state:"Goa",importance:.85},{id:"kolhapur",name:"Kolhapur",displayName:"Kolhapur, Maharashtra",type:"district",lat:16.6913,lon:74.2446,state:"Maharashtra",importance:.85},{id:"satara",name:"Satara",displayName:"Satara, Maharashtra",type:"district",lat:17.6805,lon:74.0183,state:"Maharashtra",importance:.8},{id:"ratnagiri",name:"Ratnagiri",displayName:"Ratnagiri, Maharashtra",type:"district",lat:16.9944,lon:73.3,state:"Maharashtra",importance:.8},{id:"sindhudurg",name:"Sindhudurg",displayName:"Sindhudurg, Maharashtra",type:"district",lat:16.05,lon:73.4667,state:"Maharashtra",importance:.8},{id:"mahabaleshwar",name:"Mahabaleshwar",displayName:"Mahabaleshwar, Maharashtra",type:"town",lat:17.9307,lon:73.6477,state:"Maharashtra",importance:.85}],QC=[...ZC,...XC,...YC,...JC];class eT{places=QC;isOnline=navigator.onLine;constructor(){window.addEventListener("online",()=>this.isOnline=!0),window.addEventListener("offline",()=>this.isOnline=!1)}async search(r,o=10){const h=r.toLowerCase().trim();if(!h)return[];const y=h.match(/^(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)$/);if(y){const x=parseFloat(y[1]),c=parseFloat(y[2]);return[{id:`coord_${x}_${c}`,name:`${x.toFixed(4)}, ${c.toFixed(4)}`,displayName:`Coordinates: ${x.toFixed(4)}, ${c.toFixed(4)}`,type:"landmark",lat:x,lon:c,importance:1}]}return this.searchLocal(h,o)}searchLocal(r,o){const h=[];for(const y of this.places){const w=y.name.toLowerCase(),x=y.displayName.toLowerCase();let c=0;w===r?c=100:w.startsWith(r)?c=80+r.length/w.length*10:x.startsWith(r)?c=70+r.length/x.length*10:w.includes(r)?c=50+r.length/w.length*20:x.includes(r)?c=40+r.length/x.length*20:this.fuzzyMatch(r,w)&&(c=30),c>0&&(c+=y.importance*10,h.push({place:y,score:c}))}return h.sort((y,w)=>w.score-y.score).slice(0,o).map(y=>y.place)}fuzzyMatch(r,o){let h=0;for(let y=0;y<o.length&&h<r.length;y++)r[h]===o[y]&&h++;return h===r.length}async reverseGeocode(r,o){const h=this.findNearby(r,o,5e3);if(h)return h;if(this.isOnline)try{const y=`https://nominatim.openstreetmap.org/reverse?lat=${r}&lon=${o}&format=json&addressdetails=1`,w=await fetch(y,{headers:{Accept:"application/json","User-Agent":"WGFieldValidator/1.0"}});if(w.ok){const x=await w.json();return{id:`osm_${x.place_id}`,name:x.name||x.display_name.split(",")[0],displayName:x.display_name,type:"landmark",lat:r,lon:o,state:x.address?.state,district:x.address?.county||x.address?.state_district,importance:.5}}}catch{}return null}findNearby(r,o,h){let y=null,w=1/0;for(const x of this.places){const c=this.haversineDistance(r,o,x.lat,x.lon);c<h&&c<w&&(w=c,y=x)}return y}haversineDistance(r,o,h,y){const x=r*Math.PI/180,c=h*Math.PI/180,V=(h-r)*Math.PI/180,G=(y-o)*Math.PI/180,Y=Math.sin(V/2)**2+Math.cos(x)*Math.cos(c)*Math.sin(G/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(Y),Math.sqrt(1-Y)))}getPlacesByDistrict(r){const o=r.toLowerCase();return this.places.filter(h=>h.district?.toLowerCase()===o||h.name.toLowerCase()===o)}}const tT=new eT,rT=({onSearch:n,isOnline:r=!0})=>{const[o,h]=st.useState(""),[y,w]=st.useState([]),[x,c]=st.useState(!1),[V,G]=st.useState(!1),[Y,Q]=st.useState(-1),H=st.useRef(null),Le=st.useRef(null),Be=st.useRef(),be=st.useCallback(async we=>{if(!we.trim()){w([]),c(!1);return}G(!0);try{const Ze=await tT.search(we,8);w(Ze),c(Ze.length>0),Q(-1)}catch(Ze){console.error("Search failed:",Ze),w([])}finally{G(!1)}},[]),$e=we=>{const Ze=we.target.value;h(Ze),Be.current&&clearTimeout(Be.current),Be.current=setTimeout(()=>{be(Ze)},300)},re=we=>{switch(we.key){case"ArrowDown":we.preventDefault(),Q(Ze=>Ze<y.length-1?Ze+1:Ze);break;case"ArrowUp":we.preventDefault(),Q(Ze=>Ze>0?Ze-1:-1);break;case"Enter":if(we.preventDefault(),Y>=0&&y[Y])J(y[Y]);else if(y.length>0)J(y[0]);else{const Ze=o.match(/^(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)$/);if(Ze){const He=parseFloat(Ze[1]),Xe=parseFloat(Ze[2]);n(He,Xe),c(!1),h("")}}break;case"Escape":c(!1),Q(-1);break}},J=we=>{n(we.lat,we.lon,we.displayName),h(we.name),c(!1),Q(-1)};st.useEffect(()=>{const we=Ze=>{H.current&&!H.current.contains(Ze.target)&&Le.current&&!Le.current.contains(Ze.target)&&c(!1)};return document.addEventListener("mousedown",we),()=>document.removeEventListener("mousedown",we)},[]);const le=we=>{switch(we){case"city":return"";case"town":return"";case"village":return"";case"district":return"";case"taluk":return"";case"landmark":return"";case"natural":return"";default:return""}};return O.jsxs("div",{className:"search-bar",children:[O.jsxs("div",{className:"search-input-wrapper",children:[O.jsx("span",{className:"search-icon",children:""}),O.jsx("input",{ref:H,type:"text",value:o,onChange:$e,onKeyDown:re,onFocus:()=>y.length>0&&c(!0),placeholder:"Search places, districts, or coordinates...","aria-label":"Search location","aria-expanded":x,"aria-autocomplete":"list",autoComplete:"off"}),V&&O.jsx("span",{className:"search-spinner",children:""}),!r&&O.jsx("span",{className:"offline-badge",title:"Offline mode",children:""})]}),x&&y.length>0&&O.jsx("div",{ref:Le,className:"search-results",role:"listbox",children:y.map((we,Ze)=>O.jsxs("div",{className:`search-result-item ${Ze===Y?"selected":""}`,onClick:()=>J(we),onMouseEnter:()=>Q(Ze),role:"option","aria-selected":Ze===Y,children:[O.jsx("span",{className:"result-icon",children:le(we.type)}),O.jsxs("div",{className:"result-text",children:[O.jsx("div",{className:"result-name",children:we.name}),O.jsxs("div",{className:"result-detail",children:[we.district&&`${we.district}, `,we.state||"Karnataka"]})]}),O.jsx("span",{className:"result-type",children:we.type})]},we.id))})]})},gx={forest:{id:"forest",label:"Forest Analysis",icon:"",color:"#2e7d32",description:"Plantation vs natural forest classification"},lulc:{id:"lulc",label:"Land Cover Maps",icon:"",color:"#66bb6a",description:"Historical LULC from GLC-FCS30D"},built:{id:"built",label:"Urban Expansion",icon:"",color:"#ff7043",description:"Built-up area tracking over time"},boundary:{id:"boundary",label:"Boundaries",icon:"",color:"#42a5f5",description:"Administrative boundaries"},corestack:{id:"corestack",label:"Watershed Data",icon:"",color:"#29b6f6",description:"Water balance & cropping intensity"},treecover:{id:"treecover",label:"Tree Cover",icon:"",color:"#43a047",description:"Tree cover density analysis"},other:{id:"other",label:"Other Data",icon:"",color:"#78909c",description:"Additional datasets"}},nT=["forest","lulc","built","boundary","corestack","treecover","other"],iT=({layers:n,activeLayers:r,onToggle:o,onClose:h})=>{const[y,w]=st.useState("categories"),[x,c]=st.useState(new Set(["forest","boundary"])),[V,G]=st.useState(""),Y=st.useMemo(()=>{const J={};return n.forEach(le=>{const we=le.category||"other";J[we]||(J[we]=[]),J[we].push(le)}),Object.values(J).forEach(le=>{le.sort((we,Ze)=>we.year&&Ze.year?Ze.year-we.year:we.year?-1:Ze.year?1:we.title.localeCompare(Ze.title))}),J},[n]),Q=st.useMemo(()=>{const J={};return n.forEach(le=>{le.year&&(J[le.year]||(J[le.year]=[]),J[le.year].push(le))}),Object.entries(J).sort(([le],[we])=>Number(we)-Number(le)).map(([le,we])=>({year:Number(le),layers:we}))},[n]),H=st.useMemo(()=>{if(!V.trim())return null;const J=V.toLowerCase();return n.filter(le=>le.title.toLowerCase().includes(J)||le.description?.toLowerCase().includes(J)||le.category.toLowerCase().includes(J))},[n,V]),Le=J=>{c(le=>{const we=new Set(le);return we.has(J)?we.delete(J):we.add(J),we})},Be=(J,le)=>{(Y[J]||[]).forEach(Ze=>{const He=r.has(Ze.id);le&&!He&&o(Ze.id),!le&&He&&o(Ze.id)})},be=r.size,$e=n.filter(J=>J.type==="image-overlay").length,re=(J,le=!1)=>{const we=r.has(J.id),Ze=J.type==="image-overlay";return O.jsxs("div",{className:`layer-item-pro ${we?"active":""} ${le?"compact":""}`,onClick:()=>o(J.id),children:[O.jsx("div",{className:`layer-checkbox ${we?"checked":""}`,children:we&&O.jsx("svg",{viewBox:"0 0 24 24",width:"14",height:"14",fill:"currentColor",children:O.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})})}),O.jsxs("div",{className:"layer-info",children:[O.jsx("span",{className:"layer-title",children:J.title}),!le&&O.jsxs("span",{className:"layer-subtitle",children:[Ze&&O.jsx("span",{className:"layer-badge raster",children:"Map"}),J.year&&O.jsx("span",{className:"layer-badge year",children:J.year})]})]})]},J.id)};return O.jsxs("div",{className:"layer-panel-pro",children:[O.jsxs("div",{className:"lp-header",children:[O.jsxs("div",{className:"lp-title-row",children:[O.jsx("h2",{children:"Map Layers"}),O.jsx("button",{className:"lp-close",onClick:h,"aria-label":"Close",children:O.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:O.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),O.jsxs("p",{className:"lp-stats",children:[O.jsxs("span",{className:"lp-stat",children:[be," active"]}),O.jsx("span",{className:"lp-divider",children:""}),O.jsxs("span",{className:"lp-stat",children:[$e," map layers"]}),O.jsx("span",{className:"lp-divider",children:""}),O.jsxs("span",{className:"lp-stat",children:[n.length-$e," data tables"]})]})]}),O.jsxs("div",{className:"lp-search",children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",children:O.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})}),O.jsx("input",{type:"text",placeholder:"Search layers...",value:V,onChange:J=>G(J.target.value)}),V&&O.jsx("button",{className:"lp-search-clear",onClick:()=>G(""),children:O.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",children:O.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),!V&&O.jsxs("div",{className:"lp-tabs",children:[O.jsx("button",{className:`lp-tab ${y==="categories"?"active":""}`,onClick:()=>w("categories"),children:"By Category"}),O.jsx("button",{className:`lp-tab ${y==="timeline"?"active":""}`,onClick:()=>w("timeline"),children:"Timeline"}),O.jsx("button",{className:`lp-tab ${y==="all"?"active":""}`,onClick:()=>w("all"),children:"All Layers"})]}),O.jsxs("div",{className:"lp-content",children:[V&&H&&O.jsxs("div",{className:"lp-search-results",children:[O.jsxs("p",{className:"lp-results-count",children:[H.length," result",H.length!==1?"s":""]}),H.map(J=>re(J)),H.length===0&&O.jsxs("div",{className:"lp-empty",children:['No layers found matching "',V,'"']})]}),!V&&y==="categories"&&O.jsx("div",{className:"lp-categories",children:nT.map(J=>{const le=Y[J];if(!le||le.length===0)return null;const we=gx[J]||gx.other,Ze=x.has(J),He=le.filter(Xe=>r.has(Xe.id)).length;return O.jsxs("div",{className:`lp-category ${Ze?"expanded":""}`,children:[O.jsxs("button",{className:"lp-category-header",onClick:()=>Le(J),children:[O.jsx("span",{className:"lp-cat-icon",style:{backgroundColor:we.color+"25",color:we.color},children:we.icon}),O.jsxs("div",{className:"lp-cat-info",children:[O.jsx("span",{className:"lp-cat-name",children:we.label}),O.jsx("span",{className:"lp-cat-desc",children:we.description})]}),O.jsxs("div",{className:"lp-cat-right",children:[O.jsxs("span",{className:"lp-cat-count",style:{backgroundColor:we.color+"30",color:we.color},children:[He,"/",le.length]}),O.jsx("svg",{className:`lp-chevron ${Ze?"open":""}`,viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:O.jsx("path",{d:"M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"})})]})]}),Ze&&O.jsxs("div",{className:"lp-category-content",children:[O.jsxs("div",{className:"lp-cat-actions",children:[O.jsx("button",{onClick:()=>Be(J,!0),children:"Enable all"}),O.jsx("button",{onClick:()=>Be(J,!1),children:"Disable all"})]}),O.jsx("div",{className:"lp-layer-list",children:le.map(Xe=>re(Xe))})]})]},J)})}),!V&&y==="timeline"&&O.jsxs("div",{className:"lp-timeline",children:[Q.map(({year:J,layers:le})=>O.jsxs("div",{className:"lp-timeline-year",children:[O.jsxs("div",{className:"lp-year-header",children:[O.jsx("span",{className:"lp-year-badge",children:J}),O.jsxs("span",{className:"lp-year-count",children:[le.length," layers"]})]}),O.jsx("div",{className:"lp-year-layers",children:le.map(we=>re(we,!0))})]},J)),Q.length===0&&O.jsx("div",{className:"lp-empty",children:"No time-series layers available"})]}),!V&&y==="all"&&O.jsx("div",{className:"lp-all-layers",children:n.map(J=>re(J))})]}),O.jsxs("div",{className:"lp-footer",children:[O.jsx("button",{className:"lp-footer-btn",onClick:()=>n.forEach(J=>{r.has(J.id)||o(J.id)}),children:"Enable All"}),O.jsx("button",{className:"lp-footer-btn danger",onClick:()=>n.forEach(J=>{r.has(J.id)&&o(J.id)}),children:"Clear All"})]})]})};function aT(n,r,o){o===void 0&&(o={});var h={type:"Feature"};return(o.id===0||o.id)&&(h.id=o.id),o.bbox&&(h.bbox=o.bbox),h.properties={},h.geometry=n,h}function sT(n,r,o){if(o===void 0&&(o={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!yx(n[0])||!yx(n[1]))throw new Error("coordinates must contain numbers");var h={type:"Point",coordinates:n};return aT(h,r,o)}function yx(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function oT(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function lT(n){return n.type==="Feature"?n.geometry:n}function uT(n,r,o){if(o===void 0&&(o={}),!n)throw new Error("point is required");if(!r)throw new Error("polygon is required");var h=oT(n),y=lT(r),w=y.type,x=r.bbox,c=y.coordinates;if(x&&cT(h,x)===!1)return!1;w==="Polygon"&&(c=[c]);for(var V=!1,G=0;G<c.length&&!V;G++)if(_x(h,c[G][0],o.ignoreBoundary)){for(var Y=!1,Q=1;Q<c[G].length&&!Y;)_x(h,c[G][Q],!o.ignoreBoundary)&&(Y=!0),Q++;Y||(V=!0)}return V}function _x(n,r,o){var h=!1;r[0][0]===r[r.length-1][0]&&r[0][1]===r[r.length-1][1]&&(r=r.slice(0,r.length-1));for(var y=0,w=r.length-1;y<r.length;w=y++){var x=r[y][0],c=r[y][1],V=r[w][0],G=r[w][1],Y=n[1]*(x-V)+c*(V-n[0])+G*(n[0]-x)===0&&(x-n[0])*(V-n[0])<=0&&(c-n[1])*(G-n[1])<=0;if(Y)return!o;var Q=c>n[1]!=G>n[1]&&n[0]<(V-x)*(n[1]-c)/(G-c)+x;Q&&(h=!h)}return h}function cT(n,r){return r[0]<=n[0]&&r[1]<=n[1]&&r[2]>=n[0]&&r[3]>=n[1]}var sw={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(n,r){((o,h)=>{n.exports=h()})(Up,function o(){var h=typeof self<"u"?self:typeof window<"u"?window:h!==void 0?h:{},y,w=!h.document&&!!h.postMessage,x=h.IS_PAPA_WORKER||!1,c={},V=0,G={};function Y(fe){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(ve){var je=Ze(ve);je.chunkSize=parseInt(je.chunkSize),ve.step||ve.chunk||(je.chunkSize=null),this._handle=new be(je),(this._handle.streamer=this)._config=je}.call(this,fe),this.parseChunk=function(ve,je){var tt=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<tt){let Bt=this._config.newline;Bt||(_t=this._config.quoteChar||'"',Bt=this._handle.guessLineEndings(ve,_t)),ve=[...ve.split(Bt).slice(tt)].join(Bt)}this.isFirstChunk&&Xe(this._config.beforeFirstChunk)&&(_t=this._config.beforeFirstChunk(ve))!==void 0&&(ve=_t),this.isFirstChunk=!1,this._halted=!1;var tt=this._partialLine+ve,_t=(this._partialLine="",this._handle.parse(tt,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(ve=_t.meta.cursor,tt=(this._finished||(this._partialLine=tt.substring(ve-this._baseIndex),this._baseIndex=ve),_t&&_t.data&&(this._rowCount+=_t.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),x)h.postMessage({results:_t,workerId:G.WORKER_ID,finished:tt});else if(Xe(this._config.chunk)&&!je){if(this._config.chunk(_t,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=_t=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(_t.data),this._completeResults.errors=this._completeResults.errors.concat(_t.errors),this._completeResults.meta=_t.meta),this._completed||!tt||!Xe(this._config.complete)||_t&&_t.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),tt||_t&&_t.meta.paused||this._nextChunk(),_t}this._halted=!0},this._sendError=function(ve){Xe(this._config.error)?this._config.error(ve):x&&this._config.error&&h.postMessage({workerId:G.WORKER_ID,error:ve,finished:!1})}}function Q(fe){var ve;(fe=fe||{}).chunkSize||(fe.chunkSize=G.RemoteChunkSize),Y.call(this,fe),this._nextChunk=w?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(je){this._input=je,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(ve=new XMLHttpRequest,this._config.withCredentials&&(ve.withCredentials=this._config.withCredentials),w||(ve.onload=He(this._chunkLoaded,this),ve.onerror=He(this._chunkError,this)),ve.open(this._config.downloadRequestBody?"POST":"GET",this._input,!w),this._config.downloadRequestHeaders){var je,tt=this._config.downloadRequestHeaders;for(je in tt)ve.setRequestHeader(je,tt[je])}var _t;this._config.chunkSize&&(_t=this._start+this._config.chunkSize-1,ve.setRequestHeader("Range","bytes="+this._start+"-"+_t));try{ve.send(this._config.downloadRequestBody)}catch(Bt){this._chunkError(Bt.message)}w&&ve.status===0&&this._chunkError()}},this._chunkLoaded=function(){ve.readyState===4&&(ve.status<200||400<=ve.status?this._chunkError():(this._start+=this._config.chunkSize||ve.responseText.length,this._finished=!this._config.chunkSize||this._start>=(je=>(je=je.getResponseHeader("Content-Range"))!==null?parseInt(je.substring(je.lastIndexOf("/")+1)):-1)(ve),this.parseChunk(ve.responseText)))},this._chunkError=function(je){je=ve.statusText||je,this._sendError(new Error(je))}}function H(fe){(fe=fe||{}).chunkSize||(fe.chunkSize=G.LocalChunkSize),Y.call(this,fe);var ve,je,tt=typeof FileReader<"u";this.stream=function(_t){this._input=_t,je=_t.slice||_t.webkitSlice||_t.mozSlice,tt?((ve=new FileReader).onload=He(this._chunkLoaded,this),ve.onerror=He(this._chunkError,this)):ve=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var _t=this._input,Bt=(this._config.chunkSize&&(Bt=Math.min(this._start+this._config.chunkSize,this._input.size),_t=je.call(_t,this._start,Bt)),ve.readAsText(_t,this._config.encoding));tt||this._chunkLoaded({target:{result:Bt}})},this._chunkLoaded=function(_t){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(_t.target.result)},this._chunkError=function(){this._sendError(ve.error)}}function Le(fe){var ve;Y.call(this,fe=fe||{}),this.stream=function(je){return ve=je,this._nextChunk()},this._nextChunk=function(){var je,tt;if(!this._finished)return je=this._config.chunkSize,ve=je?(tt=ve.substring(0,je),ve.substring(je)):(tt=ve,""),this._finished=!ve,this.parseChunk(tt)}}function Be(fe){Y.call(this,fe=fe||{});var ve=[],je=!0,tt=!1;this.pause=function(){Y.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){Y.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(_t){this._input=_t,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){tt&&ve.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),ve.length?this.parseChunk(ve.shift()):je=!0},this._streamData=He(function(_t){try{ve.push(typeof _t=="string"?_t:_t.toString(this._config.encoding)),je&&(je=!1,this._checkIsFinished(),this.parseChunk(ve.shift()))}catch(Bt){this._streamError(Bt)}},this),this._streamError=He(function(_t){this._streamCleanUp(),this._sendError(_t)},this),this._streamEnd=He(function(){this._streamCleanUp(),tt=!0,this._streamData("")},this),this._streamCleanUp=He(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function be(fe){var ve,je,tt,_t,Bt=Math.pow(2,53),gr=-Bt,Gr=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,Hr=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,ar=this,at=0,it=0,Mt=!1,Tt=!1,jt=[],zt={data:[],errors:[],meta:{}};function Sr(lr){return fe.skipEmptyLines==="greedy"?lr.join("").trim()==="":lr.length===1&&lr[0].length===0}function br(){if(zt&&tt&&(Mr("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+G.DefaultDelimiter+"'"),tt=!1),fe.skipEmptyLines&&(zt.data=zt.data.filter(function(wt){return!Sr(wt)})),kr()){let wt=function(Ir,Dr){Xe(fe.transformHeader)&&(Ir=fe.transformHeader(Ir,Dr)),jt.push(Ir)};var Nt=wt;if(zt)if(Array.isArray(zt.data[0])){for(var lr=0;kr()&&lr<zt.data.length;lr++)zt.data[lr].forEach(wt);zt.data.splice(0,1)}else zt.data.forEach(wt)}function ct(wt,Ir){for(var Dr=fe.header?{}:[],_r=0;_r<wt.length;_r++){var Ee=_r,nn=wt[_r],nn=((Pr,Jt)=>(pr=>(fe.dynamicTypingFunction&&fe.dynamicTyping[pr]===void 0&&(fe.dynamicTyping[pr]=fe.dynamicTypingFunction(pr)),(fe.dynamicTyping[pr]||fe.dynamicTyping)===!0))(Pr)?Jt==="true"||Jt==="TRUE"||Jt!=="false"&&Jt!=="FALSE"&&((pr=>{if(Gr.test(pr)&&(pr=parseFloat(pr),gr<pr&&pr<Bt))return 1})(Jt)?parseFloat(Jt):Hr.test(Jt)?new Date(Jt):Jt===""?null:Jt):Jt)(Ee=fe.header?_r>=jt.length?"__parsed_extra":jt[_r]:Ee,nn=fe.transform?fe.transform(nn,Ee):nn);Ee==="__parsed_extra"?(Dr[Ee]=Dr[Ee]||[],Dr[Ee].push(nn)):Dr[Ee]=nn}return fe.header&&(_r>jt.length?Mr("FieldMismatch","TooManyFields","Too many fields: expected "+jt.length+" fields but parsed "+_r,it+Ir):_r<jt.length&&Mr("FieldMismatch","TooFewFields","Too few fields: expected "+jt.length+" fields but parsed "+_r,it+Ir)),Dr}var Ht;zt&&(fe.header||fe.dynamicTyping||fe.transform)&&(Ht=1,!zt.data.length||Array.isArray(zt.data[0])?(zt.data=zt.data.map(ct),Ht=zt.data.length):zt.data=ct(zt.data,0),fe.header&&zt.meta&&(zt.meta.fields=jt),it+=Ht)}function kr(){return fe.header&&jt.length===0}function Mr(lr,ct,Ht,Nt){lr={type:lr,code:ct,message:Ht},Nt!==void 0&&(lr.row=Nt),zt.errors.push(lr)}Xe(fe.step)&&(_t=fe.step,fe.step=function(lr){zt=lr,kr()?br():(br(),zt.data.length!==0&&(at+=lr.data.length,fe.preview&&at>fe.preview?je.abort():(zt.data=zt.data[0],_t(zt,ar))))}),this.parse=function(lr,ct,Ht){var Nt=fe.quoteChar||'"',Nt=(fe.newline||(fe.newline=this.guessLineEndings(lr,Nt)),tt=!1,fe.delimiter?Xe(fe.delimiter)&&(fe.delimiter=fe.delimiter(lr),zt.meta.delimiter=fe.delimiter):((Nt=((wt,Ir,Dr,_r,Ee)=>{var nn,Pr,Jt,pr;Ee=Ee||[",","	","|",";",G.RECORD_SEP,G.UNIT_SEP];for(var _n=0;_n<Ee.length;_n++){for(var Sn,An=Ee[_n],an=0,Wr=0,Vr=0,Yr=(Jt=void 0,new re({comments:_r,delimiter:An,newline:Ir,preview:10}).parse(wt)),rt=0;rt<Yr.data.length;rt++)Dr&&Sr(Yr.data[rt])?Vr++:(Sn=Yr.data[rt].length,Wr+=Sn,Jt===void 0?Jt=Sn:0<Sn&&(an+=Math.abs(Sn-Jt),Jt=Sn));0<Yr.data.length&&(Wr/=Yr.data.length-Vr),(Pr===void 0||an<=Pr)&&(pr===void 0||pr<Wr)&&1.99<Wr&&(Pr=an,nn=An,pr=Wr)}return{successful:!!(fe.delimiter=nn),bestDelimiter:nn}})(lr,fe.newline,fe.skipEmptyLines,fe.comments,fe.delimitersToGuess)).successful?fe.delimiter=Nt.bestDelimiter:(tt=!0,fe.delimiter=G.DefaultDelimiter),zt.meta.delimiter=fe.delimiter),Ze(fe));return fe.preview&&fe.header&&Nt.preview++,ve=lr,je=new re(Nt),zt=je.parse(ve,ct,Ht),br(),Mt?{meta:{paused:!0}}:zt||{meta:{paused:!1}}},this.paused=function(){return Mt},this.pause=function(){Mt=!0,je.abort(),ve=Xe(fe.chunk)?"":ve.substring(je.getCharIndex())},this.resume=function(){ar.streamer._halted?(Mt=!1,ar.streamer.parseChunk(ve,!0)):setTimeout(ar.resume,3)},this.aborted=function(){return Tt},this.abort=function(){Tt=!0,je.abort(),zt.meta.aborted=!0,Xe(fe.complete)&&fe.complete(zt),ve=""},this.guessLineEndings=function(wt,Nt){wt=wt.substring(0,1048576);var Nt=new RegExp($e(Nt)+"([^]*?)"+$e(Nt),"gm"),Ht=(wt=wt.replace(Nt,"")).split("\r"),Nt=wt.split(`
`),wt=1<Nt.length&&Nt[0].length<Ht[0].length;if(Ht.length===1||wt)return`
`;for(var Ir=0,Dr=0;Dr<Ht.length;Dr++)Ht[Dr][0]===`
`&&Ir++;return Ir>=Ht.length/2?`\r
`:"\r"}}function $e(fe){return fe.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function re(fe){var ve=(fe=fe||{}).delimiter,je=fe.newline,tt=fe.comments,_t=fe.step,Bt=fe.preview,gr=fe.fastMode,Gr=null,Hr=!1,ar=fe.quoteChar==null?'"':fe.quoteChar,at=ar;if(fe.escapeChar!==void 0&&(at=fe.escapeChar),(typeof ve!="string"||-1<G.BAD_DELIMITERS.indexOf(ve))&&(ve=","),tt===ve)throw new Error("Comment character same as delimiter");tt===!0?tt="#":(typeof tt!="string"||-1<G.BAD_DELIMITERS.indexOf(tt))&&(tt=!1),je!==`
`&&je!=="\r"&&je!==`\r
`&&(je=`
`);var it=0,Mt=!1;this.parse=function(Tt,jt,zt){if(typeof Tt!="string")throw new Error("Input must be a string");var Sr=Tt.length,br=ve.length,kr=je.length,Mr=tt.length,lr=Xe(_t),ct=[],Ht=[],Nt=[],wt=it=0;if(!Tt)return an();if(gr||gr!==!1&&Tt.indexOf(ar)===-1){for(var Ir=Tt.split(je),Dr=0;Dr<Ir.length;Dr++){if(Nt=Ir[Dr],it+=Nt.length,Dr!==Ir.length-1)it+=je.length;else if(zt)return an();if(!tt||Nt.substring(0,Mr)!==tt){if(lr){if(ct=[],pr(Nt.split(ve)),Wr(),Mt)return an()}else pr(Nt.split(ve));if(Bt&&Bt<=Dr)return ct=ct.slice(0,Bt),an(!0)}}return an()}for(var _r=Tt.indexOf(ve,it),Ee=Tt.indexOf(je,it),nn=new RegExp($e(at)+$e(ar),"g"),Pr=Tt.indexOf(ar,it);;)if(Tt[it]===ar)for(Pr=it,it++;;){if((Pr=Tt.indexOf(ar,Pr+1))===-1)return zt||Ht.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ct.length,index:it}),Sn();if(Pr===Sr-1)return Sn(Tt.substring(it,Pr).replace(nn,ar));if(ar===at&&Tt[Pr+1]===at)Pr++;else if(ar===at||Pr===0||Tt[Pr-1]!==at){_r!==-1&&_r<Pr+1&&(_r=Tt.indexOf(ve,Pr+1));var Jt=_n((Ee=Ee!==-1&&Ee<Pr+1?Tt.indexOf(je,Pr+1):Ee)===-1?_r:Math.min(_r,Ee));if(Tt.substr(Pr+1+Jt,br)===ve){Nt.push(Tt.substring(it,Pr).replace(nn,ar)),Tt[it=Pr+1+Jt+br]!==ar&&(Pr=Tt.indexOf(ar,it)),_r=Tt.indexOf(ve,it),Ee=Tt.indexOf(je,it);break}if(Jt=_n(Ee),Tt.substring(Pr+1+Jt,Pr+1+Jt+kr)===je){if(Nt.push(Tt.substring(it,Pr).replace(nn,ar)),An(Pr+1+Jt+kr),_r=Tt.indexOf(ve,it),Pr=Tt.indexOf(ar,it),lr&&(Wr(),Mt))return an();if(Bt&&ct.length>=Bt)return an(!0);break}Ht.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ct.length,index:it}),Pr++}}else if(tt&&Nt.length===0&&Tt.substring(it,it+Mr)===tt){if(Ee===-1)return an();it=Ee+kr,Ee=Tt.indexOf(je,it),_r=Tt.indexOf(ve,it)}else if(_r!==-1&&(_r<Ee||Ee===-1))Nt.push(Tt.substring(it,_r)),it=_r+br,_r=Tt.indexOf(ve,it);else{if(Ee===-1)break;if(Nt.push(Tt.substring(it,Ee)),An(Ee+kr),lr&&(Wr(),Mt))return an();if(Bt&&ct.length>=Bt)return an(!0)}return Sn();function pr(Vr){ct.push(Vr),wt=it}function _n(Vr){var Yr=0;return Yr=Vr!==-1&&(Vr=Tt.substring(Pr+1,Vr))&&Vr.trim()===""?Vr.length:Yr}function Sn(Vr){return zt||(Vr===void 0&&(Vr=Tt.substring(it)),Nt.push(Vr),it=Sr,pr(Nt),lr&&Wr()),an()}function An(Vr){it=Vr,pr(Nt),Nt=[],Ee=Tt.indexOf(je,it)}function an(Vr){if(fe.header&&!jt&&ct.length&&!Hr){var Yr=ct[0],rt=Object.create(null),Fn=new Set(Yr);let kn=!1;for(let Cn=0;Cn<Yr.length;Cn++){let en=Yr[Cn];if(rt[en=Xe(fe.transformHeader)?fe.transformHeader(en,Cn):en]){let lt,hr=rt[en];for(;lt=en+"_"+hr,hr++,Fn.has(lt););Fn.add(lt),Yr[Cn]=lt,rt[en]++,kn=!0,(Gr=Gr===null?{}:Gr)[lt]=en}else rt[en]=1,Yr[Cn]=en;Fn.add(en)}kn&&console.warn("Duplicate headers found and renamed."),Hr=!0}return{data:ct,errors:Ht,meta:{delimiter:ve,linebreak:je,aborted:Mt,truncated:!!Vr,cursor:wt+(jt||0),renamedHeaders:Gr}}}function Wr(){_t(an()),ct=[],Ht=[]}},this.abort=function(){Mt=!0},this.getCharIndex=function(){return it}}function J(fe){var ve=fe.data,je=c[ve.workerId],tt=!1;if(ve.error)je.userError(ve.error,ve.file);else if(ve.results&&ve.results.data){var _t={abort:function(){tt=!0,le(ve.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:we,resume:we};if(Xe(je.userStep)){for(var Bt=0;Bt<ve.results.data.length&&(je.userStep({data:ve.results.data[Bt],errors:ve.results.errors,meta:ve.results.meta},_t),!tt);Bt++);delete ve.results}else Xe(je.userChunk)&&(je.userChunk(ve.results,_t,ve.file),delete ve.results)}ve.finished&&!tt&&le(ve.workerId,ve.results)}function le(fe,ve){var je=c[fe];Xe(je.userComplete)&&je.userComplete(ve),je.terminate(),delete c[fe]}function we(){throw new Error("Not implemented.")}function Ze(fe){if(typeof fe!="object"||fe===null)return fe;var ve,je=Array.isArray(fe)?[]:{};for(ve in fe)je[ve]=Ze(fe[ve]);return je}function He(fe,ve){return function(){fe.apply(ve,arguments)}}function Xe(fe){return typeof fe=="function"}return G.parse=function(fe,ve){var je=(ve=ve||{}).dynamicTyping||!1;if(Xe(je)&&(ve.dynamicTypingFunction=je,je={}),ve.dynamicTyping=je,ve.transform=!!Xe(ve.transform)&&ve.transform,!ve.worker||!G.WORKERS_SUPPORTED)return je=null,G.NODE_STREAM_INPUT,typeof fe=="string"?(fe=(tt=>tt.charCodeAt(0)!==65279?tt:tt.slice(1))(fe),je=new(ve.download?Q:Le)(ve)):fe.readable===!0&&Xe(fe.read)&&Xe(fe.on)?je=new Be(ve):(h.File&&fe instanceof File||fe instanceof Object)&&(je=new H(ve)),je.stream(fe);(je=(()=>{var tt;return!!G.WORKERS_SUPPORTED&&(tt=(()=>{var _t=h.URL||h.webkitURL||null,Bt=o.toString();return G.BLOB_URL||(G.BLOB_URL=_t.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",Bt,")();"],{type:"text/javascript"})))})(),(tt=new h.Worker(tt)).onmessage=J,tt.id=V++,c[tt.id]=tt)})()).userStep=ve.step,je.userChunk=ve.chunk,je.userComplete=ve.complete,je.userError=ve.error,ve.step=Xe(ve.step),ve.chunk=Xe(ve.chunk),ve.complete=Xe(ve.complete),ve.error=Xe(ve.error),delete ve.worker,je.postMessage({input:fe,config:ve,workerId:je.id})},G.unparse=function(fe,ve){var je=!1,tt=!0,_t=",",Bt=`\r
`,gr='"',Gr=gr+gr,Hr=!1,ar=null,at=!1,it=((()=>{if(typeof ve=="object"){if(typeof ve.delimiter!="string"||G.BAD_DELIMITERS.filter(function(jt){return ve.delimiter.indexOf(jt)!==-1}).length||(_t=ve.delimiter),typeof ve.quotes!="boolean"&&typeof ve.quotes!="function"&&!Array.isArray(ve.quotes)||(je=ve.quotes),typeof ve.skipEmptyLines!="boolean"&&typeof ve.skipEmptyLines!="string"||(Hr=ve.skipEmptyLines),typeof ve.newline=="string"&&(Bt=ve.newline),typeof ve.quoteChar=="string"&&(gr=ve.quoteChar),typeof ve.header=="boolean"&&(tt=ve.header),Array.isArray(ve.columns)){if(ve.columns.length===0)throw new Error("Option columns is empty");ar=ve.columns}ve.escapeChar!==void 0&&(Gr=ve.escapeChar+gr),ve.escapeFormulae instanceof RegExp?at=ve.escapeFormulae:typeof ve.escapeFormulae=="boolean"&&ve.escapeFormulae&&(at=/^[=+\-@\t\r].*$/)}})(),new RegExp($e(gr),"g"));if(typeof fe=="string"&&(fe=JSON.parse(fe)),Array.isArray(fe)){if(!fe.length||Array.isArray(fe[0]))return Mt(null,fe,Hr);if(typeof fe[0]=="object")return Mt(ar||Object.keys(fe[0]),fe,Hr)}else if(typeof fe=="object")return typeof fe.data=="string"&&(fe.data=JSON.parse(fe.data)),Array.isArray(fe.data)&&(fe.fields||(fe.fields=fe.meta&&fe.meta.fields||ar),fe.fields||(fe.fields=Array.isArray(fe.data[0])?fe.fields:typeof fe.data[0]=="object"?Object.keys(fe.data[0]):[]),Array.isArray(fe.data[0])||typeof fe.data[0]=="object"||(fe.data=[fe.data])),Mt(fe.fields||[],fe.data||[],Hr);throw new Error("Unable to serialize unrecognized input");function Mt(jt,zt,Sr){var br="",kr=(typeof jt=="string"&&(jt=JSON.parse(jt)),typeof zt=="string"&&(zt=JSON.parse(zt)),Array.isArray(jt)&&0<jt.length),Mr=!Array.isArray(zt[0]);if(kr&&tt){for(var lr=0;lr<jt.length;lr++)0<lr&&(br+=_t),br+=Tt(jt[lr],lr);0<zt.length&&(br+=Bt)}for(var ct=0;ct<zt.length;ct++){var Ht=(kr?jt:zt[ct]).length,Nt=!1,wt=kr?Object.keys(zt[ct]).length===0:zt[ct].length===0;if(Sr&&!kr&&(Nt=Sr==="greedy"?zt[ct].join("").trim()==="":zt[ct].length===1&&zt[ct][0].length===0),Sr==="greedy"&&kr){for(var Ir=[],Dr=0;Dr<Ht;Dr++){var _r=Mr?jt[Dr]:Dr;Ir.push(zt[ct][_r])}Nt=Ir.join("").trim()===""}if(!Nt){for(var Ee=0;Ee<Ht;Ee++){0<Ee&&!wt&&(br+=_t);var nn=kr&&Mr?jt[Ee]:Ee;br+=Tt(zt[ct][nn],Ee)}ct<zt.length-1&&(!Sr||0<Ht&&!wt)&&(br+=Bt)}}return br}function Tt(jt,zt){var Sr,br;return jt==null?"":jt.constructor===Date?JSON.stringify(jt).slice(1,25):(br=!1,at&&typeof jt=="string"&&at.test(jt)&&(jt="'"+jt,br=!0),Sr=jt.toString().replace(it,Gr),(br=br||je===!0||typeof je=="function"&&je(jt,zt)||Array.isArray(je)&&je[zt]||((kr,Mr)=>{for(var lr=0;lr<Mr.length;lr++)if(-1<kr.indexOf(Mr[lr]))return!0;return!1})(Sr,G.BAD_DELIMITERS)||-1<Sr.indexOf(_t)||Sr.charAt(0)===" "||Sr.charAt(Sr.length-1)===" ")?gr+Sr+gr:Sr)}},G.RECORD_SEP="",G.UNIT_SEP="",G.BYTE_ORDER_MARK="\uFEFF",G.BAD_DELIMITERS=["\r",`
`,'"',G.BYTE_ORDER_MARK],G.WORKERS_SUPPORTED=!w&&!!h.Worker,G.NODE_STREAM_INPUT=1,G.LocalChunkSize=10485760,G.RemoteChunkSize=5242880,G.DefaultDelimiter=",",G.Parser=re,G.ParserHandle=be,G.NetworkStreamer=Q,G.FileStreamer=H,G.StringStreamer=Le,G.ReadableStreamStreamer=Be,h.jQuery&&((y=h.jQuery).fn.parse=function(fe){var ve=fe.config||{},je=[];return this.each(function(Bt){if(!(y(this).prop("tagName").toUpperCase()==="INPUT"&&y(this).attr("type").toLowerCase()==="file"&&h.FileReader)||!this.files||this.files.length===0)return!0;for(var gr=0;gr<this.files.length;gr++)je.push({file:this.files[gr],inputElem:this,instanceConfig:y.extend({},ve)})}),tt(),this;function tt(){if(je.length===0)Xe(fe.complete)&&fe.complete();else{var Bt,gr,Gr,Hr,ar=je[0];if(Xe(fe.before)){var at=fe.before(ar.file,ar.inputElem);if(typeof at=="object"){if(at.action==="abort")return Bt="AbortError",gr=ar.file,Gr=ar.inputElem,Hr=at.reason,void(Xe(fe.error)&&fe.error({name:Bt},gr,Gr,Hr));if(at.action==="skip")return void _t();typeof at.config=="object"&&(ar.instanceConfig=y.extend(ar.instanceConfig,at.config))}else if(at==="skip")return void _t()}var it=ar.instanceConfig.complete;ar.instanceConfig.complete=function(Mt){Xe(it)&&it(Mt,ar.file,ar.inputElem),_t()},G.parse(ar.file,ar.instanceConfig)}}function _t(){je.splice(0,1),tt()}}),x&&(h.onmessage=function(fe){fe=fe.data,G.WORKER_ID===void 0&&fe&&(G.WORKER_ID=fe.workerId),typeof fe.input=="string"?h.postMessage({workerId:G.WORKER_ID,results:G.parse(fe.input,fe.config),finished:!0}):(h.File&&fe.input instanceof File||fe.input instanceof Object)&&(fe=G.parse(fe.input,fe.config))&&h.postMessage({workerId:G.WORKER_ID,results:fe,finished:!0})}),(Q.prototype=Object.create(Y.prototype)).constructor=Q,(H.prototype=Object.create(Y.prototype)).constructor=H,(Le.prototype=Object.create(Le.prototype)).constructor=Le,(Be.prototype=Object.create(Y.prototype)).constructor=Be,G})})(sw);var hT=sw.exports;const dT=vf(hT);var ow={exports:{}};(function(n,r){(function(o,h){n.exports=h()})(Up,function(){var o=function(v,k){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,D){E.__proto__=D}||function(E,D){for(var B in D)Object.prototype.hasOwnProperty.call(D,B)&&(E[B]=D[B])})(v,k)},h=function(){return(h=Object.assign||function(v){for(var k,E=1,D=arguments.length;E<D;E++)for(var B in k=arguments[E])Object.prototype.hasOwnProperty.call(k,B)&&(v[B]=k[B]);return v}).apply(this,arguments)};function y(v,k,E){for(var D,B=0,q=k.length;B<q;B++)!D&&B in k||((D=D||Array.prototype.slice.call(k,0,B))[B]=k[B]);return v.concat(D||Array.prototype.slice.call(k))}var w=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Up,x=Object.keys,c=Array.isArray;function V(v,k){return typeof k!="object"||x(k).forEach(function(E){v[E]=k[E]}),v}typeof Promise>"u"||w.Promise||(w.Promise=Promise);var G=Object.getPrototypeOf,Y={}.hasOwnProperty;function Q(v,k){return Y.call(v,k)}function H(v,k){typeof k=="function"&&(k=k(G(v))),(typeof Reflect>"u"?x:Reflect.ownKeys)(k).forEach(function(E){Be(v,E,k[E])})}var Le=Object.defineProperty;function Be(v,k,E,D){Le(v,k,V(E&&Q(E,"get")&&typeof E.get=="function"?{get:E.get,set:E.set,configurable:!0}:{value:E,configurable:!0,writable:!0},D))}function be(v){return{from:function(k){return v.prototype=Object.create(k.prototype),Be(v.prototype,"constructor",v),{extend:H.bind(null,v.prototype)}}}}var $e=Object.getOwnPropertyDescriptor,re=[].slice;function J(v,k,E){return re.call(v,k,E)}function le(v,k){return k(v)}function we(v){if(!v)throw new Error("Assertion Failed")}function Ze(v){w.setImmediate?setImmediate(v):setTimeout(v,0)}function He(v,k){if(typeof k=="string"&&Q(v,k))return v[k];if(!k)return v;if(typeof k!="string"){for(var E=[],D=0,B=k.length;D<B;++D){var q=He(v,k[D]);E.push(q)}return E}var te=k.indexOf(".");if(te!==-1){var he=v[k.substr(0,te)];return he==null?void 0:He(he,k.substr(te+1))}}function Xe(v,k,E){if(v&&k!==void 0&&!("isFrozen"in Object&&Object.isFrozen(v)))if(typeof k!="string"&&"length"in k){we(typeof E!="string"&&"length"in E);for(var D=0,B=k.length;D<B;++D)Xe(v,k[D],E[D])}else{var q,te,he=k.indexOf(".");he!==-1?(q=k.substr(0,he),(te=k.substr(he+1))===""?E===void 0?c(v)&&!isNaN(parseInt(q))?v.splice(q,1):delete v[q]:v[q]=E:Xe(he=!(he=v[q])||!Q(v,q)?v[q]={}:he,te,E)):E===void 0?c(v)&&!isNaN(parseInt(k))?v.splice(k,1):delete v[k]:v[k]=E}}function fe(v){var k,E={};for(k in v)Q(v,k)&&(E[k]=v[k]);return E}var ve=[].concat;function je(v){return ve.apply([],v)}var Vr="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(je([8,16,32,64].map(function(v){return["Int","Uint","Float"].map(function(k){return k+v+"Array"})}))).filter(function(v){return w[v]}),tt=new Set(Vr.map(function(v){return w[v]})),_t=null;function Bt(v){return _t=new WeakMap,v=function k(E){if(!E||typeof E!="object")return E;var D=_t.get(E);if(D)return D;if(c(E)){D=[],_t.set(E,D);for(var B=0,q=E.length;B<q;++B)D.push(k(E[B]))}else if(tt.has(E.constructor))D=E;else{var te,he=G(E);for(te in D=he===Object.prototype?{}:Object.create(he),_t.set(E,D),E)Q(E,te)&&(D[te]=k(E[te]))}return D}(v),_t=null,v}var gr={}.toString;function Gr(v){return gr.call(v).slice(8,-1)}var Hr=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ar=typeof Hr=="symbol"?function(v){var k;return v!=null&&(k=v[Hr])&&k.apply(v)}:function(){return null};function at(v,k){return k=v.indexOf(k),0<=k&&v.splice(k,1),0<=k}var it={};function Mt(v){var k,E,D,B;if(arguments.length===1){if(c(v))return v.slice();if(this===it&&typeof v=="string")return[v];if(B=ar(v)){for(E=[];!(D=B.next()).done;)E.push(D.value);return E}if(v==null)return[v];if(typeof(k=v.length)!="number")return[v];for(E=new Array(k);k--;)E[k]=v[k];return E}for(k=arguments.length,E=new Array(k);k--;)E[k]=arguments[k];return E}var Tt=typeof Symbol<"u"?function(v){return v[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Wr=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Wn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Wr),jt={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function zt(v,k){this.name=v,this.message=k}function Sr(v,k){return v+". Errors: "+Object.keys(k).map(function(E){return k[E].toString()}).filter(function(E,D,B){return B.indexOf(E)===D}).join(`
`)}function br(v,k,E,D){this.failures=k,this.failedKeys=D,this.successCount=E,this.message=Sr(v,k)}function kr(v,k){this.name="BulkError",this.failures=Object.keys(k).map(function(E){return k[E]}),this.failuresByPos=k,this.message=Sr(v,this.failures)}be(zt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),be(br).from(zt),be(kr).from(zt);var Mr=Wn.reduce(function(v,k){return v[k]=k+"Error",v},{}),lr=zt,ct=Wn.reduce(function(v,k){var E=k+"Error";function D(B,q){this.name=E,B?typeof B=="string"?(this.message="".concat(B).concat(q?`
 `+q:""),this.inner=q||null):typeof B=="object"&&(this.message="".concat(B.name," ").concat(B.message),this.inner=B):(this.message=jt[k]||E,this.inner=null)}return be(D).from(lr),v[k]=D,v},{});ct.Syntax=SyntaxError,ct.Type=TypeError,ct.Range=RangeError;var Ht=Wr.reduce(function(v,k){return v[k+"Error"]=ct[k],v},{}),Nt=Wn.reduce(function(v,k){return["Syntax","Type","Range"].indexOf(k)===-1&&(v[k+"Error"]=ct[k]),v},{});function wt(){}function Ir(v){return v}function Dr(v,k){return v==null||v===Ir?k:function(E){return k(v(E))}}function _r(v,k){return function(){v.apply(this,arguments),k.apply(this,arguments)}}function Ee(v,k){return v===wt?k:function(){var E=v.apply(this,arguments);E!==void 0&&(arguments[0]=E);var D=this.onsuccess,B=this.onerror;this.onsuccess=null,this.onerror=null;var q=k.apply(this,arguments);return D&&(this.onsuccess=this.onsuccess?_r(D,this.onsuccess):D),B&&(this.onerror=this.onerror?_r(B,this.onerror):B),q!==void 0?q:E}}function nn(v,k){return v===wt?k:function(){v.apply(this,arguments);var E=this.onsuccess,D=this.onerror;this.onsuccess=this.onerror=null,k.apply(this,arguments),E&&(this.onsuccess=this.onsuccess?_r(E,this.onsuccess):E),D&&(this.onerror=this.onerror?_r(D,this.onerror):D)}}function Pr(v,k){return v===wt?k:function(E){var D=v.apply(this,arguments);V(E,D);var B=this.onsuccess,q=this.onerror;return this.onsuccess=null,this.onerror=null,E=k.apply(this,arguments),B&&(this.onsuccess=this.onsuccess?_r(B,this.onsuccess):B),q&&(this.onerror=this.onerror?_r(q,this.onerror):q),D===void 0?E===void 0?void 0:E:V(D,E)}}function Jt(v,k){return v===wt?k:function(){return k.apply(this,arguments)!==!1&&v.apply(this,arguments)}}function pr(v,k){return v===wt?k:function(){var E=v.apply(this,arguments);if(E&&typeof E.then=="function"){for(var D=this,B=arguments.length,q=new Array(B);B--;)q[B]=arguments[B];return E.then(function(){return k.apply(D,q)})}return k.apply(this,arguments)}}Nt.ModifyError=br,Nt.DexieError=zt,Nt.BulkError=kr;var _n=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Sn(v){_n=v}var An={},an=100,Vr=typeof Promise>"u"?[]:function(){var v=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[v,G(v),v];var k=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[k,G(k),v]}(),Wr=Vr[0],Wn=Vr[1],Vr=Vr[2],Wn=Wn&&Wn.then,Yr=Wr&&Wr.constructor,rt=!!Vr,Fn=function(v,k){ti.push([v,k]),Cn&&(queueMicrotask(ie),Cn=!1)},kn=!0,Cn=!0,en=[],lt=[],hr=Ir,Xt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:wt,pgp:!1,env:{},finalize:wt},Ot=Xt,ti=[],rr=0,wi=[];function St(v){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var k=this._PSD=Ot;if(typeof v!="function"){if(v!==An)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&oe(this,this._value))}this._state=null,this._value=null,++k.ref,function E(D,B){try{B(function(q){if(D._state===null){if(q===D)throw new TypeError("A promise cannot be resolved with itself.");var te=D._lib&&ye();q&&typeof q.then=="function"?E(D,function(he,xe){q instanceof St?q._then(he,xe):q.then(he,xe)}):(D._state=!0,D._value=q,j(D)),te&&Se()}},oe.bind(null,D))}catch(q){oe(D,q)}}(this,v)}var ca={get:function(){var v=Ot,k=Wt;function E(D,B){var q=this,te=!v.global&&(v!==Ot||k!==Wt),he=te&&!dr(),xe=new St(function(Ce,De){N(q,new Xi(Mn(D,v,te,he),Mn(B,v,te,he),Ce,De,v))});return this._consoleTask&&(xe._consoleTask=this._consoleTask),xe}return E.prototype=An,E},set:function(v){Be(this,"then",v&&v.prototype===An?ca:{get:function(){return v},set:ca.set})}};function Xi(v,k,E,D,B){this.onFulfilled=typeof v=="function"?v:null,this.onRejected=typeof k=="function"?k:null,this.resolve=E,this.reject=D,this.psd=B}function oe(v,k){var E,D;lt.push(k),v._state===null&&(E=v._lib&&ye(),k=hr(k),v._state=!1,v._value=k,D=v,en.some(function(B){return B._value===D._value})||en.push(D),j(v),E&&Se())}function j(v){var k=v._listeners;v._listeners=[];for(var E=0,D=k.length;E<D;++E)N(v,k[E]);var B=v._PSD;--B.ref||B.finalize(),rr===0&&(++rr,Fn(function(){--rr==0&&ze()},[]))}function N(v,k){if(v._state!==null){var E=v._state?k.onFulfilled:k.onRejected;if(E===null)return(v._state?k.resolve:k.reject)(v._value);++k.psd.ref,++rr,Fn(Z,[E,v,k])}else v._listeners.push(k)}function Z(v,k,E){try{var D,B=k._value;!k._state&&lt.length&&(lt=[]),D=_n&&k._consoleTask?k._consoleTask.run(function(){return v(B)}):v(B),k._state||lt.indexOf(B)!==-1||function(q){for(var te=en.length;te;)if(en[--te]._value===q._value)return en.splice(te,1)}(k),E.resolve(D)}catch(q){E.reject(q)}finally{--rr==0&&ze(),--E.psd.ref||E.psd.finalize()}}function ie(){Ur(Xt,function(){ye()&&Se()})}function ye(){var v=kn;return Cn=kn=!1,v}function Se(){var v,k,E;do for(;0<ti.length;)for(v=ti,ti=[],E=v.length,k=0;k<E;++k){var D=v[k];D[0].apply(null,D[1])}while(0<ti.length);Cn=kn=!0}function ze(){var v=en;en=[],v.forEach(function(D){D._PSD.onunhandled.call(null,D._value,D)});for(var k=wi.slice(0),E=k.length;E;)k[--E]()}function pe(v){return new St(An,!1,v)}function Ue(v,k){var E=Ot;return function(){var D=ye(),B=Ot;try{return ur(E,!0),v.apply(this,arguments)}catch(q){k&&k(q)}finally{ur(B,!1),D&&Se()}}}H(St.prototype,{then:ca,_then:function(v,k){N(this,new Xi(null,null,v,k,Ot))},catch:function(v){if(arguments.length===1)return this.then(null,v);var k=v,E=arguments[1];return typeof k=="function"?this.then(null,function(D){return(D instanceof k?E:pe)(D)}):this.then(null,function(D){return(D&&D.name===k?E:pe)(D)})},finally:function(v){return this.then(function(k){return St.resolve(v()).then(function(){return k})},function(k){return St.resolve(v()).then(function(){return pe(k)})})},timeout:function(v,k){var E=this;return v<1/0?new St(function(D,B){var q=setTimeout(function(){return B(new ct.Timeout(k))},v);E.then(D,B).finally(clearTimeout.bind(null,q))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Be(St.prototype,Symbol.toStringTag,"Dexie.Promise"),Xt.env=jr(),H(St,{all:function(){var v=Mt.apply(null,arguments).map(dn);return new St(function(k,E){v.length===0&&k([]);var D=v.length;v.forEach(function(B,q){return St.resolve(B).then(function(te){v[q]=te,--D||k(v)},E)})})},resolve:function(v){return v instanceof St?v:v&&typeof v.then=="function"?new St(function(k,E){v.then(k,E)}):new St(An,!0,v)},reject:pe,race:function(){var v=Mt.apply(null,arguments).map(dn);return new St(function(k,E){v.map(function(D){return St.resolve(D).then(k,E)})})},PSD:{get:function(){return Ot},set:function(v){return Ot=v}},totalEchoes:{get:function(){return Wt}},newPSD:nr,usePSD:Ur,scheduler:{get:function(){return Fn},set:function(v){Fn=v}},rejectionMapper:{get:function(){return hr},set:function(v){hr=v}},follow:function(v,k){return new St(function(E,D){return nr(function(B,q){var te=Ot;te.unhandleds=[],te.onunhandled=q,te.finalize=_r(function(){var he,xe=this;he=function(){xe.unhandleds.length===0?B():q(xe.unhandleds[0])},wi.push(function Ce(){he(),wi.splice(wi.indexOf(Ce),1)}),++rr,Fn(function(){--rr==0&&ze()},[])},te.finalize),v()},k,E,D)})}}),Yr&&(Yr.allSettled&&Be(St,"allSettled",function(){var v=Mt.apply(null,arguments).map(dn);return new St(function(k){v.length===0&&k([]);var E=v.length,D=new Array(E);v.forEach(function(B,q){return St.resolve(B).then(function(te){return D[q]={status:"fulfilled",value:te}},function(te){return D[q]={status:"rejected",reason:te}}).then(function(){return--E||k(D)})})})}),Yr.any&&typeof AggregateError<"u"&&Be(St,"any",function(){var v=Mt.apply(null,arguments).map(dn);return new St(function(k,E){v.length===0&&E(new AggregateError([]));var D=v.length,B=new Array(D);v.forEach(function(q,te){return St.resolve(q).then(function(he){return k(he)},function(he){B[te]=he,--D||E(new AggregateError(B))})})})}),Yr.withResolvers&&(St.withResolvers=Yr.withResolvers));var We={awaits:0,echoes:0,id:0},qe=0,ht=[],Ut=0,Wt=0,zr=0;function nr(v,k,E,D){var B=Ot,q=Object.create(B);return q.parent=B,q.ref=0,q.global=!1,q.id=++zr,Xt.env,q.env=rt?{Promise:St,PromiseProp:{value:St,configurable:!0,writable:!0},all:St.all,race:St.race,allSettled:St.allSettled,any:St.any,resolve:St.resolve,reject:St.reject}:{},k&&V(q,k),++B.ref,q.finalize=function(){--this.parent.ref||this.parent.finalize()},D=Ur(q,v,E,D),q.ref===0&&q.finalize(),D}function wr(){return We.id||(We.id=++qe),++We.awaits,We.echoes+=an,We.id}function dr(){return!!We.awaits&&(--We.awaits==0&&(We.id=0),We.echoes=We.awaits*an,!0)}function dn(v){return We.echoes&&v&&v.constructor===Yr?(wr(),v.then(function(k){return dr(),k},function(k){return dr(),Lr(k)})):v}function pn(){var v=ht[ht.length-1];ht.pop(),ur(v,!1)}function ur(v,k){var E,D=Ot;(k?!We.echoes||Ut++&&v===Ot:!Ut||--Ut&&v===Ot)||queueMicrotask(k?function(B){++Wt,We.echoes&&--We.echoes!=0||(We.echoes=We.awaits=We.id=0),ht.push(Ot),ur(B,!0)}.bind(null,v):pn),v!==Ot&&(Ot=v,D===Xt&&(Xt.env=jr()),rt&&(E=Xt.env.Promise,k=v.env,(D.global||v.global)&&(Object.defineProperty(w,"Promise",k.PromiseProp),E.all=k.all,E.race=k.race,E.resolve=k.resolve,E.reject=k.reject,k.allSettled&&(E.allSettled=k.allSettled),k.any&&(E.any=k.any))))}function jr(){var v=w.Promise;return rt?{Promise:v,PromiseProp:Object.getOwnPropertyDescriptor(w,"Promise"),all:v.all,race:v.race,allSettled:v.allSettled,any:v.any,resolve:v.resolve,reject:v.reject}:{}}function Ur(v,k,E,D,B){var q=Ot;try{return ur(v,!0),k(E,D,B)}finally{ur(q,!1)}}function Mn(v,k,E,D){return typeof v!="function"?v:function(){var B=Ot;E&&wr(),ur(k,!0);try{return v.apply(this,arguments)}finally{ur(B,!1),D&&queueMicrotask(dr)}}}function Dn(v){Promise===Yr&&We.echoes===0?Ut===0?v():enqueueNativeMicroTask(v):setTimeout(v,0)}(""+Wn).indexOf("[native code]")===-1&&(wr=dr=wt);var Lr=St.reject,zi="",Cr="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",qo="String expected.",Za=[],Hn="__dbnames",ri="readonly",Kl="readwrite";function Bn(v,k){return v?k?function(){return v.apply(this,arguments)&&k.apply(this,arguments)}:v:k}var ci={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ea(v){return typeof v!="string"||/\./.test(v)?function(k){return k}:function(k){return k[v]===void 0&&v in k&&delete(k=Bt(k))[v],k}}function Xa(){throw ct.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function ir(v,k){try{var E=Bs(v),D=Bs(k);if(E!==D)return E==="Array"?1:D==="Array"?-1:E==="binary"?1:D==="binary"?-1:E==="string"?1:D==="string"?-1:E==="Date"?1:D!=="Date"?NaN:-1;switch(E){case"number":case"Date":case"string":return k<v?1:v<k?-1:0;case"binary":return function(B,q){for(var te=B.length,he=q.length,xe=te<he?te:he,Ce=0;Ce<xe;++Ce)if(B[Ce]!==q[Ce])return B[Ce]<q[Ce]?-1:1;return te===he?0:te<he?-1:1}(Li(v),Li(k));case"Array":return function(B,q){for(var te=B.length,he=q.length,xe=te<he?te:he,Ce=0;Ce<xe;++Ce){var De=ir(B[Ce],q[Ce]);if(De!==0)return De}return te===he?0:te<he?-1:1}(v,k)}}catch{}return NaN}function Bs(v){var k=typeof v;return k!="object"?k:ArrayBuffer.isView(v)?"binary":(v=Gr(v),v==="ArrayBuffer"?"binary":v)}function Li(v){return v instanceof Uint8Array?v:ArrayBuffer.isView(v)?new Uint8Array(v.buffer,v.byteOffset,v.byteLength):new Uint8Array(v)}function sn(v,k,E){var D=v.schema.yProps;return D?(k&&0<E.numFailures&&(k=k.filter(function(B,q){return!E.failures[q]})),Promise.all(D.map(function(B){return B=B.updatesTable,k?v.db.table(B).where("k").anyOf(k).delete():v.db.table(B).clear()})).then(function(){return E})):E}var Ya=(Ri.prototype.execute=function(v){var k=this["@@propmod"];if(k.add!==void 0){var E=k.add;if(c(E))return y(y([],c(v)?v:[],!0),E).sort();if(typeof E=="number")return(Number(v)||0)+E;if(typeof E=="bigint")try{return BigInt(v)+E}catch{return BigInt(0)+E}throw new TypeError("Invalid term ".concat(E))}if(k.remove!==void 0){var D=k.remove;if(c(D))return c(v)?v.filter(function(B){return!D.includes(B)}).sort():[];if(typeof D=="number")return Number(v)-D;if(typeof D=="bigint")try{return BigInt(v)-D}catch{return BigInt(0)-D}throw new TypeError("Invalid subtrahend ".concat(D))}return E=(E=k.replacePrefix)===null||E===void 0?void 0:E[0],E&&typeof v=="string"&&v.startsWith(E)?k.replacePrefix[1]+v.substring(E.length):v},Ri);function Ri(v){this["@@propmod"]=v}function Go(v,k){for(var E=x(k),D=E.length,B=!1,q=0;q<D;++q){var te=E[q],he=k[te],xe=He(v,te);he instanceof Ya?(Xe(v,te,he.execute(xe)),B=!0):xe!==he&&(Xe(v,te,he),B=!0)}return B}var Oi=(Jr.prototype._trans=function(v,k,E){var D=this._tx||Ot.trans,B=this.name,q=_n&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(v==="readonly"?"read":"write"," ").concat(this.name));function te(Ce,De,me){if(!me.schema[B])throw new ct.NotFound("Table "+B+" not part of transaction");return k(me.idbtrans,me)}var he=ye();try{var xe=D&&D.db._novip===this.db._novip?D===Ot.trans?D._promise(v,te,E):nr(function(){return D._promise(v,te,E)},{trans:D,transless:Ot.transless||Ot}):function Ce(De,me,Oe,ke){if(De.idbdb&&(De._state.openComplete||Ot.letThrough||De._vip)){var Pe=De._createTransaction(me,Oe,De._dbSchema);try{Pe.create(),De._state.PR1398_maxLoop=3}catch(Ie){return Ie.name===Mr.InvalidState&&De.isOpen()&&0<--De._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),De.close({disableAutoOpen:!1}),De.open().then(function(){return Ce(De,me,Oe,ke)})):Lr(Ie)}return Pe._promise(me,function(Ie,Re){return nr(function(){return Ot.trans=Pe,ke(Ie,Re,Pe)})}).then(function(Ie){if(me==="readwrite")try{Pe.idbtrans.commit()}catch{}return me==="readonly"?Ie:Pe._completion.then(function(){return Ie})})}if(De._state.openComplete)return Lr(new ct.DatabaseClosed(De._state.dbOpenError));if(!De._state.isBeingOpened){if(!De._state.autoOpen)return Lr(new ct.DatabaseClosed);De.open().catch(wt)}return De._state.dbReadyPromise.then(function(){return Ce(De,me,Oe,ke)})}(this.db,v,[this.name],te);return q&&(xe._consoleTask=q,xe=xe.catch(function(Ce){return console.trace(Ce),Lr(Ce)})),xe}finally{he&&Se()}},Jr.prototype.get=function(v,k){var E=this;return v&&v.constructor===Object?this.where(v).first(k):v==null?Lr(new ct.Type("Invalid argument to Table.get()")):this._trans("readonly",function(D){return E.core.get({trans:D,key:v}).then(function(B){return E.hook.reading.fire(B)})}).then(k)},Jr.prototype.where=function(v){if(typeof v=="string")return new this.db.WhereClause(this,v);if(c(v))return new this.db.WhereClause(this,"[".concat(v.join("+"),"]"));var k=x(v);if(k.length===1)return this.where(k[0]).equals(v[k[0]]);var E=this.schema.indexes.concat(this.schema.primKey).filter(function(he){if(he.compound&&k.every(function(Ce){return 0<=he.keyPath.indexOf(Ce)})){for(var xe=0;xe<k.length;++xe)if(k.indexOf(he.keyPath[xe])===-1)return!1;return!0}return!1}).sort(function(he,xe){return he.keyPath.length-xe.keyPath.length})[0];if(E&&this.db._maxKey!==zi){var q=E.keyPath.slice(0,k.length);return this.where(q).equals(q.map(function(xe){return v[xe]}))}!E&&_n&&console.warn("The query ".concat(JSON.stringify(v)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(k.join("+"),"]"));var D=this.schema.idxByName;function B(he,xe){return ir(he,xe)===0}var te=k.reduce(function(me,xe){var Ce=me[0],De=me[1],me=D[xe],Oe=v[xe];return[Ce||me,Ce||!me?Bn(De,me&&me.multi?function(ke){return ke=He(ke,xe),c(ke)&&ke.some(function(Pe){return B(Oe,Pe)})}:function(ke){return B(Oe,He(ke,xe))}):De]},[null,null]),q=te[0],te=te[1];return q?this.where(q.name).equals(v[q.keyPath]).filter(te):E?this.filter(te):this.where(k).equals("")},Jr.prototype.filter=function(v){return this.toCollection().and(v)},Jr.prototype.count=function(v){return this.toCollection().count(v)},Jr.prototype.offset=function(v){return this.toCollection().offset(v)},Jr.prototype.limit=function(v){return this.toCollection().limit(v)},Jr.prototype.each=function(v){return this.toCollection().each(v)},Jr.prototype.toArray=function(v){return this.toCollection().toArray(v)},Jr.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Jr.prototype.orderBy=function(v){return new this.db.Collection(new this.db.WhereClause(this,c(v)?"[".concat(v.join("+"),"]"):v))},Jr.prototype.reverse=function(){return this.toCollection().reverse()},Jr.prototype.mapToClass=function(v){var k,E=this.db,D=this.name;function B(){return k!==null&&k.apply(this,arguments)||this}(this.schema.mappedClass=v).prototype instanceof Xa&&(function(xe,Ce){if(typeof Ce!="function"&&Ce!==null)throw new TypeError("Class extends value "+String(Ce)+" is not a constructor or null");function De(){this.constructor=xe}o(xe,Ce),xe.prototype=Ce===null?Object.create(Ce):(De.prototype=Ce.prototype,new De)}(B,k=v),Object.defineProperty(B.prototype,"db",{get:function(){return E},enumerable:!1,configurable:!0}),B.prototype.table=function(){return D},v=B);for(var q=new Set,te=v.prototype;te;te=G(te))Object.getOwnPropertyNames(te).forEach(function(xe){return q.add(xe)});function he(xe){if(!xe)return xe;var Ce,De=Object.create(v.prototype);for(Ce in xe)if(!q.has(Ce))try{De[Ce]=xe[Ce]}catch{}return De}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=he,this.hook("reading",he),v},Jr.prototype.defineClass=function(){return this.mapToClass(function(v){V(this,v)})},Jr.prototype.add=function(v,k){var E=this,D=this.schema.primKey,B=D.auto,q=D.keyPath,te=v;return q&&B&&(te=Ea(q)(v)),this._trans("readwrite",function(he){return E.core.mutate({trans:he,type:"add",keys:k!=null?[k]:null,values:[te]})}).then(function(he){return he.numFailures?St.reject(he.failures[0]):he.lastResult}).then(function(he){if(q)try{Xe(v,q,he)}catch{}return he})},Jr.prototype.upsert=function(v,k){var E=this,D=this.schema.primKey.keyPath;return this._trans("readwrite",function(B){return E.core.get({trans:B,key:v}).then(function(q){var te=q??{};return Go(te,k),D&&Xe(te,D,v),E.core.mutate({trans:B,type:"put",values:[te],keys:[v],upsert:!0,updates:{keys:[v],changeSpecs:[k]}}).then(function(he){return he.numFailures?St.reject(he.failures[0]):!!q})})})},Jr.prototype.update=function(v,k){return typeof v!="object"||c(v)?this.where(":id").equals(v).modify(k):(v=He(v,this.schema.primKey.keyPath),v===void 0?Lr(new ct.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(v).modify(k))},Jr.prototype.put=function(v,k){var E=this,D=this.schema.primKey,B=D.auto,q=D.keyPath,te=v;return q&&B&&(te=Ea(q)(v)),this._trans("readwrite",function(he){return E.core.mutate({trans:he,type:"put",values:[te],keys:k!=null?[k]:null})}).then(function(he){return he.numFailures?St.reject(he.failures[0]):he.lastResult}).then(function(he){if(q)try{Xe(v,q,he)}catch{}return he})},Jr.prototype.delete=function(v){var k=this;return this._trans("readwrite",function(E){return k.core.mutate({trans:E,type:"delete",keys:[v]}).then(function(D){return sn(k,[v],D)}).then(function(D){return D.numFailures?St.reject(D.failures[0]):void 0})})},Jr.prototype.clear=function(){var v=this;return this._trans("readwrite",function(k){return v.core.mutate({trans:k,type:"deleteRange",range:ci}).then(function(E){return sn(v,null,E)})}).then(function(k){return k.numFailures?St.reject(k.failures[0]):void 0})},Jr.prototype.bulkGet=function(v){var k=this;return this._trans("readonly",function(E){return k.core.getMany({keys:v,trans:E}).then(function(D){return D.map(function(B){return k.hook.reading.fire(B)})})})},Jr.prototype.bulkAdd=function(v,k,E){var D=this,B=Array.isArray(k)?k:void 0,q=(E=E||(B?void 0:k))?E.allKeys:void 0;return this._trans("readwrite",function(te){var Ce=D.schema.primKey,he=Ce.auto,Ce=Ce.keyPath;if(Ce&&B)throw new ct.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(B&&B.length!==v.length)throw new ct.InvalidArgument("Arguments objects and keys must have the same length");var xe=v.length,Ce=Ce&&he?v.map(Ea(Ce)):v;return D.core.mutate({trans:te,type:"add",keys:B,values:Ce,wantResults:q}).then(function(Pe){var me=Pe.numFailures,Oe=Pe.results,ke=Pe.lastResult,Pe=Pe.failures;if(me===0)return q?Oe:ke;throw new kr("".concat(D.name,".bulkAdd(): ").concat(me," of ").concat(xe," operations failed"),Pe)})})},Jr.prototype.bulkPut=function(v,k,E){var D=this,B=Array.isArray(k)?k:void 0,q=(E=E||(B?void 0:k))?E.allKeys:void 0;return this._trans("readwrite",function(te){var Ce=D.schema.primKey,he=Ce.auto,Ce=Ce.keyPath;if(Ce&&B)throw new ct.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(B&&B.length!==v.length)throw new ct.InvalidArgument("Arguments objects and keys must have the same length");var xe=v.length,Ce=Ce&&he?v.map(Ea(Ce)):v;return D.core.mutate({trans:te,type:"put",keys:B,values:Ce,wantResults:q}).then(function(Pe){var me=Pe.numFailures,Oe=Pe.results,ke=Pe.lastResult,Pe=Pe.failures;if(me===0)return q?Oe:ke;throw new kr("".concat(D.name,".bulkPut(): ").concat(me," of ").concat(xe," operations failed"),Pe)})})},Jr.prototype.bulkUpdate=function(v){var k=this,E=this.core,D=v.map(function(te){return te.key}),B=v.map(function(te){return te.changes}),q=[];return this._trans("readwrite",function(te){return E.getMany({trans:te,keys:D,cache:"clone"}).then(function(he){var xe=[],Ce=[];v.forEach(function(me,Oe){var ke=me.key,Pe=me.changes,Ie=he[Oe];if(Ie){for(var Re=0,Ve=Object.keys(Pe);Re<Ve.length;Re++){var Ge=Ve[Re],Ye=Pe[Ge];if(Ge===k.schema.primKey.keyPath){if(ir(Ye,ke)!==0)throw new ct.Constraint("Cannot update primary key in bulkUpdate()")}else Xe(Ie,Ge,Ye)}q.push(Oe),xe.push(ke),Ce.push(Ie)}});var De=xe.length;return E.mutate({trans:te,type:"put",keys:xe,values:Ce,updates:{keys:D,changeSpecs:B}}).then(function(me){var Oe=me.numFailures,ke=me.failures;if(Oe===0)return De;for(var Pe=0,Ie=Object.keys(ke);Pe<Ie.length;Pe++){var Re,Ve=Ie[Pe],Ge=q[Number(Ve)];Ge!=null&&(Re=ke[Ve],delete ke[Ve],ke[Ge]=Re)}throw new kr("".concat(k.name,".bulkUpdate(): ").concat(Oe," of ").concat(De," operations failed"),ke)})})})},Jr.prototype.bulkDelete=function(v){var k=this,E=v.length;return this._trans("readwrite",function(D){return k.core.mutate({trans:D,type:"delete",keys:v}).then(function(B){return sn(k,v,B)})}).then(function(te){var B=te.numFailures,q=te.lastResult,te=te.failures;if(B===0)return q;throw new kr("".concat(k.name,".bulkDelete(): ").concat(B," of ").concat(E," operations failed"),te)})},Jr);function Jr(){}function Ja(v){function k(te,he){if(he){for(var xe=arguments.length,Ce=new Array(xe-1);--xe;)Ce[xe-1]=arguments[xe];return E[te].subscribe.apply(null,Ce),v}if(typeof te=="string")return E[te]}var E={};k.addEventType=q;for(var D=1,B=arguments.length;D<B;++D)q(arguments[D]);return k;function q(te,he,xe){if(typeof te!="object"){var Ce;he=he||Jt;var De={subscribers:[],fire:xe=xe||wt,subscribe:function(me){De.subscribers.indexOf(me)===-1&&(De.subscribers.push(me),De.fire=he(De.fire,me))},unsubscribe:function(me){De.subscribers=De.subscribers.filter(function(Oe){return Oe!==me}),De.fire=De.subscribers.reduce(he,xe)}};return E[te]=k[te]=De}x(Ce=te).forEach(function(me){var Oe=Ce[me];if(c(Oe))q(me,Ce[me][0],Ce[me][1]);else{if(Oe!=="asap")throw new ct.InvalidArgument("Invalid event config");var ke=q(me,Ir,function(){for(var Pe=arguments.length,Ie=new Array(Pe);Pe--;)Ie[Pe]=arguments[Pe];ke.subscribers.forEach(function(Re){Ze(function(){Re.apply(null,Ie)})})})}})}}function Yi(v,k){return be(k).from({prototype:v}),k}function Si(v,k){return!(v.filter||v.algorithm||v.or)&&(k?v.justLimit:!v.replayFilter)}function Rr(v,k){v.filter=Bn(v.filter,k)}function ho(v,k,E){var D=v.replayFilter;v.replayFilter=D?function(){return Bn(D(),k())}:k,v.justLimit=E&&!D}function Ns(v,k){if(v.isPrimKey)return k.primaryKey;var E=k.getIndexByKeyPath(v.index);if(!E)throw new ct.Schema("KeyPath "+v.index+" on object store "+k.name+" is not indexed");return E}function _s(v,k,E){var D=Ns(v,k.schema);return k.openCursor({trans:E,values:!v.keysOnly,reverse:v.dir==="prev",unique:!!v.unique,query:{index:D,range:v.range}})}function js(v,k,E,D){var B=v.replayFilter?Bn(v.filter,v.replayFilter()):v.filter;if(v.or){var q={},te=function(he,xe,Ce){var De,me;B&&!B(xe,Ce,function(Oe){return xe.stop(Oe)},function(Oe){return xe.fail(Oe)})||((me=""+(De=xe.primaryKey))=="[object ArrayBuffer]"&&(me=""+new Uint8Array(De)),Q(q,me)||(q[me]=!0,k(he,xe,Ce)))};return Promise.all([v.or._iterate(te,E),po(_s(v,D,E),v.algorithm,te,!v.keysOnly&&v.valueMapper)])}return po(_s(v,D,E),Bn(v.algorithm,B),k,!v.keysOnly&&v.valueMapper)}function po(v,k,E,D){var B=Ue(D?function(q,te,he){return E(D(q),te,he)}:E);return v.then(function(q){if(q)return q.start(function(){var te=function(){return q.continue()};k&&!k(q,function(he){return te=he},function(he){q.stop(he),te=wt},function(he){q.fail(he),te=wt})||B(q.value,q,function(he){return te=he}),te()})})}var fo=(Or.prototype._read=function(v,k){var E=this._ctx;return E.error?E.table._trans(null,Lr.bind(null,E.error)):E.table._trans("readonly",v).then(k)},Or.prototype._write=function(v){var k=this._ctx;return k.error?k.table._trans(null,Lr.bind(null,k.error)):k.table._trans("readwrite",v,"locked")},Or.prototype._addAlgorithm=function(v){var k=this._ctx;k.algorithm=Bn(k.algorithm,v)},Or.prototype._iterate=function(v,k){return js(this._ctx,v,k,this._ctx.table.core)},Or.prototype.clone=function(v){var k=Object.create(this.constructor.prototype),E=Object.create(this._ctx);return v&&V(E,v),k._ctx=E,k},Or.prototype.raw=function(){return this._ctx.valueMapper=null,this},Or.prototype.each=function(v){var k=this._ctx;return this._read(function(E){return js(k,v,E,k.table.core)})},Or.prototype.count=function(v){var k=this;return this._read(function(E){var D=k._ctx,B=D.table.core;if(Si(D,!0))return B.count({trans:E,query:{index:Ns(D,B.schema),range:D.range}}).then(function(te){return Math.min(te,D.limit)});var q=0;return js(D,function(){return++q,!1},E,B).then(function(){return q})}).then(v)},Or.prototype.sortBy=function(v,k){var E=v.split(".").reverse(),D=E[0],B=E.length-1;function q(xe,Ce){return Ce?q(xe[E[Ce]],Ce-1):xe[D]}var te=this._ctx.dir==="next"?1:-1;function he(xe,Ce){return ir(q(xe,B),q(Ce,B))*te}return this.toArray(function(xe){return xe.sort(he)}).then(k)},Or.prototype.toArray=function(v){var k=this;return this._read(function(E){var D=k._ctx;if(D.dir==="next"&&Si(D,!0)&&0<D.limit){var B=D.valueMapper,q=Ns(D,D.table.core.schema);return D.table.core.query({trans:E,limit:D.limit,values:!0,query:{index:q,range:D.range}}).then(function(he){return he=he.result,B?he.map(B):he})}var te=[];return js(D,function(he){return te.push(he)},E,D.table.core).then(function(){return te})},v)},Or.prototype.offset=function(v){var k=this._ctx;return v<=0||(k.offset+=v,Si(k)?ho(k,function(){var E=v;return function(D,B){return E===0||(E===1?--E:B(function(){D.advance(E),E=0}),!1)}}):ho(k,function(){var E=v;return function(){return--E<0}})),this},Or.prototype.limit=function(v){return this._ctx.limit=Math.min(this._ctx.limit,v),ho(this._ctx,function(){var k=v;return function(E,D,B){return--k<=0&&D(B),0<=k}},!0),this},Or.prototype.until=function(v,k){return Rr(this._ctx,function(E,D,B){return!v(E.value)||(D(B),k)}),this},Or.prototype.first=function(v){return this.limit(1).toArray(function(k){return k[0]}).then(v)},Or.prototype.last=function(v){return this.reverse().first(v)},Or.prototype.filter=function(v){var k;return Rr(this._ctx,function(E){return v(E.value)}),(k=this._ctx).isMatch=Bn(k.isMatch,v),this},Or.prototype.and=function(v){return this.filter(v)},Or.prototype.or=function(v){return new this.db.WhereClause(this._ctx.table,v,this)},Or.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Or.prototype.desc=function(){return this.reverse()},Or.prototype.eachKey=function(v){var k=this._ctx;return k.keysOnly=!k.isMatch,this.each(function(E,D){v(D.key,D)})},Or.prototype.eachUniqueKey=function(v){return this._ctx.unique="unique",this.eachKey(v)},Or.prototype.eachPrimaryKey=function(v){var k=this._ctx;return k.keysOnly=!k.isMatch,this.each(function(E,D){v(D.primaryKey,D)})},Or.prototype.keys=function(v){var k=this._ctx;k.keysOnly=!k.isMatch;var E=[];return this.each(function(D,B){E.push(B.key)}).then(function(){return E}).then(v)},Or.prototype.primaryKeys=function(v){var k=this._ctx;if(k.dir==="next"&&Si(k,!0)&&0<k.limit)return this._read(function(D){var B=Ns(k,k.table.core.schema);return k.table.core.query({trans:D,values:!1,limit:k.limit,query:{index:B,range:k.range}})}).then(function(D){return D.result}).then(v);k.keysOnly=!k.isMatch;var E=[];return this.each(function(D,B){E.push(B.primaryKey)}).then(function(){return E}).then(v)},Or.prototype.uniqueKeys=function(v){return this._ctx.unique="unique",this.keys(v)},Or.prototype.firstKey=function(v){return this.limit(1).keys(function(k){return k[0]}).then(v)},Or.prototype.lastKey=function(v){return this.reverse().firstKey(v)},Or.prototype.distinct=function(){var v=this._ctx,v=v.index&&v.table.schema.idxByName[v.index];if(!v||!v.multi)return this;var k={};return Rr(this._ctx,function(B){var D=B.primaryKey.toString(),B=Q(k,D);return k[D]=!0,!B}),this},Or.prototype.modify=function(v){var k=this,E=this._ctx;return this._write(function(D){var B=typeof v=="function"?v:function(Ie){return Go(Ie,v)},q=E.table.core,Ce=q.schema.primaryKey,te=Ce.outbound,he=Ce.extractKey,xe=200,Ce=k.db._options.modifyChunkSize;Ce&&(xe=typeof Ce=="object"?Ce[q.name]||Ce["*"]||200:Ce);function De(Ie,Ge){var Ve=Ge.failures,Ge=Ge.numFailures;Oe+=Ie-Ge;for(var Ye=0,et=x(Ve);Ye<et.length;Ye++){var ft=et[Ye];me.push(Ve[ft])}}var me=[],Oe=0,ke=[],Pe=v===vs;return k.clone().primaryKeys().then(function(Ie){function Re(Ge){var Ye=Math.min(xe,Ie.length-Ge),et=Ie.slice(Ge,Ge+Ye);return(Pe?Promise.resolve([]):q.getMany({trans:D,keys:et,cache:"immutable"})).then(function(ft){var kt=[],dt=[],mt=te?[]:null,Ct=Pe?et:[];if(!Pe)for(var ot=0;ot<Ye;++ot){var Lt=ft[ot],mr={value:Bt(Lt),primKey:Ie[Ge+ot]};B.call(mr,mr.value,mr)!==!1&&(mr.value==null?Ct.push(Ie[Ge+ot]):te||ir(he(Lt),he(mr.value))===0?(dt.push(mr.value),te&&mt.push(Ie[Ge+ot])):(Ct.push(Ie[Ge+ot]),kt.push(mr.value)))}return Promise.resolve(0<kt.length&&q.mutate({trans:D,type:"add",values:kt}).then(function(xr){for(var Yt in xr.failures)Ct.splice(parseInt(Yt),1);De(kt.length,xr)})).then(function(){return(0<dt.length||Ve&&typeof v=="object")&&q.mutate({trans:D,type:"put",keys:mt,values:dt,criteria:Ve,changeSpec:typeof v!="function"&&v,isAdditionalChunk:0<Ge}).then(function(xr){return De(dt.length,xr)})}).then(function(){return(0<Ct.length||Ve&&Pe)&&q.mutate({trans:D,type:"delete",keys:Ct,criteria:Ve,isAdditionalChunk:0<Ge}).then(function(xr){return sn(E.table,Ct,xr)}).then(function(xr){return De(Ct.length,xr)})}).then(function(){return Ie.length>Ge+Ye&&Re(Ge+xe)})})}var Ve=Si(E)&&E.limit===1/0&&(typeof v!="function"||Pe)&&{index:E.index,range:E.range};return Re(0).then(function(){if(0<me.length)throw new br("Error modifying one or more objects",me,Oe,ke);return Ie.length})})})},Or.prototype.delete=function(){var v=this._ctx,k=v.range;return!Si(v)||v.table.schema.yProps||!v.isPrimKey&&k.type!==3?this.modify(vs):this._write(function(E){var D=v.table.core.schema.primaryKey,B=k;return v.table.core.count({trans:E,query:{index:D,range:B}}).then(function(q){return v.table.core.mutate({trans:E,type:"deleteRange",range:B}).then(function(xe){var he=xe.failures,xe=xe.numFailures;if(xe)throw new br("Could not delete some values",Object.keys(he).map(function(Ce){return he[Ce]}),q-xe);return q-xe})})})},Or);function Or(){}var vs=function(v,k){return k.value=null};function Bu(v,k){return v<k?-1:v===k?0:1}function Xc(v,k){return k<v?-1:v===k?0:1}function hi(v,k,E){return v=v instanceof ii?new v.Collection(v):v,v._ctx.error=new(E||TypeError)(k),v}function Us(v){return new v.Collection(v,function(){return ni("")}).limit(0)}function ha(v,k,E,D){var B,q,te,he,xe,Ce,De,me=E.length;if(!E.every(function(Pe){return typeof Pe=="string"}))return hi(v,qo);function Oe(Pe){B=Pe==="next"?function(Re){return Re.toUpperCase()}:function(Re){return Re.toLowerCase()},q=Pe==="next"?function(Re){return Re.toLowerCase()}:function(Re){return Re.toUpperCase()},te=Pe==="next"?Bu:Xc;var Ie=E.map(function(Re){return{lower:q(Re),upper:B(Re)}}).sort(function(Re,Ve){return te(Re.lower,Ve.lower)});he=Ie.map(function(Re){return Re.upper}),xe=Ie.map(function(Re){return Re.lower}),De=(Ce=Pe)==="next"?"":D}Oe("next"),v=new v.Collection(v,function(){return Fi(he[0],xe[me-1]+D)}),v._ondirectionchange=function(Pe){Oe(Pe)};var ke=0;return v._addAlgorithm(function(Pe,Ie,Re){var Ve=Pe.key;if(typeof Ve!="string")return!1;var Ge=q(Ve);if(k(Ge,xe,ke))return!0;for(var Ye=null,et=ke;et<me;++et){var ft=function(kt,dt,mt,Ct,ot,Lt){for(var mr=Math.min(kt.length,Ct.length),xr=-1,Yt=0;Yt<mr;++Yt){var mn=dt[Yt];if(mn!==Ct[Yt])return ot(kt[Yt],mt[Yt])<0?kt.substr(0,Yt)+mt[Yt]+mt.substr(Yt+1):ot(kt[Yt],Ct[Yt])<0?kt.substr(0,Yt)+Ct[Yt]+mt.substr(Yt+1):0<=xr?kt.substr(0,xr)+dt[xr]+mt.substr(xr+1):null;ot(kt[Yt],mn)<0&&(xr=Yt)}return mr<Ct.length&&Lt==="next"?kt+mt.substr(kt.length):mr<kt.length&&Lt==="prev"?kt.substr(0,mt.length):xr<0?null:kt.substr(0,xr)+Ct[xr]+mt.substr(xr+1)}(Ve,Ge,he[et],xe[et],te,Ce);ft===null&&Ye===null?ke=et+1:(Ye===null||0<te(Ye,ft))&&(Ye=ft)}return Ie(Ye!==null?function(){Pe.continue(Ye+De)}:Re),!1}),v}function Fi(v,k,E,D){return{type:2,lower:v,upper:k,lowerOpen:E,upperOpen:D}}function ni(v){return{type:1,lower:v,upper:v}}var ii=(Object.defineProperty(vn.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),vn.prototype.between=function(v,k,E,D){E=E!==!1,D=D===!0;try{return 0<this._cmp(v,k)||this._cmp(v,k)===0&&(E||D)&&(!E||!D)?Us(this):new this.Collection(this,function(){return Fi(v,k,!E,!D)})}catch{return hi(this,Cr)}},vn.prototype.equals=function(v){return v==null?hi(this,Cr):new this.Collection(this,function(){return ni(v)})},vn.prototype.above=function(v){return v==null?hi(this,Cr):new this.Collection(this,function(){return Fi(v,void 0,!0)})},vn.prototype.aboveOrEqual=function(v){return v==null?hi(this,Cr):new this.Collection(this,function(){return Fi(v,void 0,!1)})},vn.prototype.below=function(v){return v==null?hi(this,Cr):new this.Collection(this,function(){return Fi(void 0,v,!1,!0)})},vn.prototype.belowOrEqual=function(v){return v==null?hi(this,Cr):new this.Collection(this,function(){return Fi(void 0,v)})},vn.prototype.startsWith=function(v){return typeof v!="string"?hi(this,qo):this.between(v,v+zi,!0,!0)},vn.prototype.startsWithIgnoreCase=function(v){return v===""?this.startsWith(v):ha(this,function(k,E){return k.indexOf(E[0])===0},[v],zi)},vn.prototype.equalsIgnoreCase=function(v){return ha(this,function(k,E){return k===E[0]},[v],"")},vn.prototype.anyOfIgnoreCase=function(){var v=Mt.apply(it,arguments);return v.length===0?Us(this):ha(this,function(k,E){return E.indexOf(k)!==-1},v,"")},vn.prototype.startsWithAnyOfIgnoreCase=function(){var v=Mt.apply(it,arguments);return v.length===0?Us(this):ha(this,function(k,E){return E.some(function(D){return k.indexOf(D)===0})},v,zi)},vn.prototype.anyOf=function(){var v=this,k=Mt.apply(it,arguments),E=this._cmp;try{k.sort(E)}catch{return hi(this,Cr)}if(k.length===0)return Us(this);var D=new this.Collection(this,function(){return Fi(k[0],k[k.length-1])});D._ondirectionchange=function(q){E=q==="next"?v._ascending:v._descending,k.sort(E)};var B=0;return D._addAlgorithm(function(q,te,he){for(var xe=q.key;0<E(xe,k[B]);)if(++B===k.length)return te(he),!1;return E(xe,k[B])===0||(te(function(){q.continue(k[B])}),!1)}),D},vn.prototype.notEqual=function(v){return this.inAnyRange([[-1/0,v],[v,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},vn.prototype.noneOf=function(){var v=Mt.apply(it,arguments);if(v.length===0)return new this.Collection(this);try{v.sort(this._ascending)}catch{return hi(this,Cr)}var k=v.reduce(function(E,D){return E?E.concat([[E[E.length-1][1],D]]):[[-1/0,D]]},null);return k.push([v[v.length-1],this.db._maxKey]),this.inAnyRange(k,{includeLowers:!1,includeUppers:!1})},vn.prototype.inAnyRange=function(Ve,k){var E=this,D=this._cmp,B=this._ascending,q=this._descending,te=this._min,he=this._max;if(Ve.length===0)return Us(this);if(!Ve.every(function(Ge){return Ge[0]!==void 0&&Ge[1]!==void 0&&B(Ge[0],Ge[1])<=0}))return hi(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ct.InvalidArgument);var xe=!k||k.includeLowers!==!1,Ce=k&&k.includeUppers===!0,De,me=B;function Oe(Ge,Ye){return me(Ge[0],Ye[0])}try{(De=Ve.reduce(function(Ge,Ye){for(var et=0,ft=Ge.length;et<ft;++et){var kt=Ge[et];if(D(Ye[0],kt[1])<0&&0<D(Ye[1],kt[0])){kt[0]=te(kt[0],Ye[0]),kt[1]=he(kt[1],Ye[1]);break}}return et===ft&&Ge.push(Ye),Ge},[])).sort(Oe)}catch{return hi(this,Cr)}var ke=0,Pe=Ce?function(Ge){return 0<B(Ge,De[ke][1])}:function(Ge){return 0<=B(Ge,De[ke][1])},Ie=xe?function(Ge){return 0<q(Ge,De[ke][0])}:function(Ge){return 0<=q(Ge,De[ke][0])},Re=Pe,Ve=new this.Collection(this,function(){return Fi(De[0][0],De[De.length-1][1],!xe,!Ce)});return Ve._ondirectionchange=function(Ge){me=Ge==="next"?(Re=Pe,B):(Re=Ie,q),De.sort(Oe)},Ve._addAlgorithm(function(Ge,Ye,et){for(var ft,kt=Ge.key;Re(kt);)if(++ke===De.length)return Ye(et),!1;return!Pe(ft=kt)&&!Ie(ft)||(E._cmp(kt,De[ke][1])===0||E._cmp(kt,De[ke][0])===0||Ye(function(){me===B?Ge.continue(De[ke][0]):Ge.continue(De[ke][1])}),!1)}),Ve},vn.prototype.startsWithAnyOf=function(){var v=Mt.apply(it,arguments);return v.every(function(k){return typeof k=="string"})?v.length===0?Us(this):this.inAnyRange(v.map(function(k){return[k,k+zi]})):hi(this,"startsWithAnyOf() only works with strings")},vn);function vn(){}function ki(v){return Ue(function(k){return Qa(k),v(k.target.error),!1})}function Qa(v){v.stopPropagation&&v.stopPropagation(),v.preventDefault&&v.preventDefault()}var Vs="storagemutated",es="x-storagemutated-1",ts=Ja(null,Vs),Nu=(Ji.prototype._lock=function(){return we(!Ot.global),++this._reculock,this._reculock!==1||Ot.global||(Ot.lockOwnerFor=this),this},Ji.prototype._unlock=function(){if(we(!Ot.global),--this._reculock==0)for(Ot.global||(Ot.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var v=this._blockedFuncs.shift();try{Ur(v[1],v[0])}catch{}}return this},Ji.prototype._locked=function(){return this._reculock&&Ot.lockOwnerFor!==this},Ji.prototype.create=function(v){var k=this;if(!this.mode)return this;var E=this.db.idbdb,D=this.db._state.dbOpenError;if(we(!this.idbtrans),!v&&!E)switch(D&&D.name){case"DatabaseClosedError":throw new ct.DatabaseClosed(D);case"MissingAPIError":throw new ct.MissingAPI(D.message,D);default:throw new ct.OpenFailed(D)}if(!this.active)throw new ct.TransactionInactive;return we(this._completion._state===null),(v=this.idbtrans=v||(this.db.core||E).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ue(function(B){Qa(B),k._reject(v.error)}),v.onabort=Ue(function(B){Qa(B),k.active&&k._reject(new ct.Abort(v.error)),k.active=!1,k.on("abort").fire(B)}),v.oncomplete=Ue(function(){k.active=!1,k._resolve(),"mutatedParts"in v&&ts.storagemutated.fire(v.mutatedParts)}),this},Ji.prototype._promise=function(v,k,E){var D=this;if(v==="readwrite"&&this.mode!=="readwrite")return Lr(new ct.ReadOnly("Transaction is readonly"));if(!this.active)return Lr(new ct.TransactionInactive);if(this._locked())return new St(function(q,te){D._blockedFuncs.push([function(){D._promise(v,k,E).then(q,te)},Ot])});if(E)return nr(function(){var q=new St(function(te,he){D._lock();var xe=k(te,he,D);xe&&xe.then&&xe.then(te,he)});return q.finally(function(){return D._unlock()}),q._lib=!0,q});var B=new St(function(q,te){var he=k(q,te,D);he&&he.then&&he.then(q,te)});return B._lib=!0,B},Ji.prototype._root=function(){return this.parent?this.parent._root():this},Ji.prototype.waitFor=function(v){var k,E=this._root(),D=St.resolve(v);E._waitingFor?E._waitingFor=E._waitingFor.then(function(){return D}):(E._waitingFor=D,E._waitingQueue=[],k=E.idbtrans.objectStore(E.storeNames[0]),function q(){for(++E._spinCount;E._waitingQueue.length;)E._waitingQueue.shift()();E._waitingFor&&(k.get(-1/0).onsuccess=q)}());var B=E._waitingFor;return new St(function(q,te){D.then(function(he){return E._waitingQueue.push(Ue(q.bind(null,he)))},function(he){return E._waitingQueue.push(Ue(te.bind(null,he)))}).finally(function(){E._waitingFor===B&&(E._waitingFor=null)})})},Ji.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ct.Abort))},Ji.prototype.table=function(v){var k=this._memoizedTables||(this._memoizedTables={});if(Q(k,v))return k[v];var E=this.schema[v];if(!E)throw new ct.NotFound("Table "+v+" not part of transaction");return E=new this.db.Table(v,E,this),E.core=this.db.core.table(v),k[v]=E},Ji);function Ji(){}function Hl(v,k,E,D,B,q,te,he){return{name:v,keyPath:k,unique:E,multi:D,auto:B,compound:q,src:(E&&!te?"&":"")+(D?"*":"")+(B?"++":"")+ju(k),type:he}}function ju(v){return typeof v=="string"?v:v?"["+[].join.call(v,"+")+"]":""}function Ko(v,k,E){return{name:v,primKey:k,indexes:E,mappedClass:null,idxByName:(D=function(B){return[B.name,B]},E.reduce(function(B,q,te){return te=D(q,te),te&&(B[te[0]]=te[1]),B},{}))};var D}var Aa=function(v){try{return v.only([[]]),Aa=function(){return[[]]},[[]]}catch{return Aa=function(){return zi},zi}};function mo(v){return v==null?function(){}:typeof v=="string"?(k=v).split(".").length===1?function(E){return E[k]}:function(E){return He(E,k)}:function(E){return He(E,v)};var k}function go(v){return[].slice.call(v)}var Wl=0;function xs(v){return v==null?":id":typeof v=="string"?v:"[".concat(v.join("+"),"]")}function da(v,k,xe){function D(Re){if(Re.type===3)return null;if(Re.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var ke=Re.lower,Pe=Re.upper,Ie=Re.lowerOpen,Re=Re.upperOpen;return ke===void 0?Pe===void 0?null:k.upperBound(Pe,!!Re):Pe===void 0?k.lowerBound(ke,!!Ie):k.bound(ke,Pe,!!Ie,!!Re)}function B(Oe){var ke,Pe=Oe.name;return{name:Pe,schema:Oe,mutate:function(Ie){var Re=Ie.trans,Ve=Ie.type,Ge=Ie.keys,Ye=Ie.values,et=Ie.range;return new Promise(function(ft,kt){ft=Ue(ft);var dt=Re.objectStore(Pe),mt=dt.keyPath==null,Ct=Ve==="put"||Ve==="add";if(!Ct&&Ve!=="delete"&&Ve!=="deleteRange")throw new Error("Invalid operation type: "+Ve);var ot,Lt=(Ge||Ye||{length:1}).length;if(Ge&&Ye&&Ge.length!==Ye.length)throw new Error("Given keys array must have same length as given values array.");if(Lt===0)return ft({numFailures:0,failures:{},results:[],lastResult:void 0});function mr(In){++mn,Qa(In)}var xr=[],Yt=[],mn=0;if(Ve==="deleteRange"){if(et.type===4)return ft({numFailures:mn,failures:Yt,results:[],lastResult:void 0});et.type===3?xr.push(ot=dt.clear()):xr.push(ot=dt.delete(D(et)))}else{var mt=Ct?mt?[Ye,Ge]:[Ye,null]:[Ge,null],er=mt[0],Tn=mt[1];if(Ct)for(var Nn=0;Nn<Lt;++Nn)xr.push(ot=Tn&&Tn[Nn]!==void 0?dt[Ve](er[Nn],Tn[Nn]):dt[Ve](er[Nn])),ot.onerror=mr;else for(Nn=0;Nn<Lt;++Nn)xr.push(ot=dt[Ve](er[Nn])),ot.onerror=mr}function Cs(In){In=In.target.result,xr.forEach(function(ai,Co){return ai.error!=null&&(Yt[Co]=ai.error)}),ft({numFailures:mn,failures:Yt,results:Ve==="delete"?Ge:xr.map(function(ai){return ai.result}),lastResult:In})}ot.onerror=function(In){mr(In),Cs(In)},ot.onsuccess=Cs})},getMany:function(Ie){var Re=Ie.trans,Ve=Ie.keys;return new Promise(function(Ge,Ye){Ge=Ue(Ge);for(var et,ft=Re.objectStore(Pe),kt=Ve.length,dt=new Array(kt),mt=0,Ct=0,ot=function(xr){xr=xr.target,dt[xr._pos]=xr.result,++Ct===mt&&Ge(dt)},Lt=ki(Ye),mr=0;mr<kt;++mr)Ve[mr]!=null&&((et=ft.get(Ve[mr]))._pos=mr,et.onsuccess=ot,et.onerror=Lt,++mt);mt===0&&Ge(dt)})},get:function(Ie){var Re=Ie.trans,Ve=Ie.key;return new Promise(function(Ge,Ye){Ge=Ue(Ge);var et=Re.objectStore(Pe).get(Ve);et.onsuccess=function(ft){return Ge(ft.target.result)},et.onerror=ki(Ye)})},query:(ke=Ce,function(Ie){return new Promise(function(Re,Ve){Re=Ue(Re);var Ge,Ye,et,mt=Ie.trans,ft=Ie.values,kt=Ie.limit,ot=Ie.query,dt=kt===1/0?void 0:kt,Ct=ot.index,ot=ot.range,mt=mt.objectStore(Pe),Ct=Ct.isPrimaryKey?mt:mt.index(Ct.name),ot=D(ot);if(kt===0)return Re({result:[]});ke?((dt=ft?Ct.getAll(ot,dt):Ct.getAllKeys(ot,dt)).onsuccess=function(Lt){return Re({result:Lt.target.result})},dt.onerror=ki(Ve)):(Ge=0,Ye=!ft&&"openKeyCursor"in Ct?Ct.openKeyCursor(ot):Ct.openCursor(ot),et=[],Ye.onsuccess=function(Lt){var mr=Ye.result;return mr?(et.push(ft?mr.value:mr.primaryKey),++Ge===kt?Re({result:et}):void mr.continue()):Re({result:et})},Ye.onerror=ki(Ve))})}),openCursor:function(Ie){var Re=Ie.trans,Ve=Ie.values,Ge=Ie.query,Ye=Ie.reverse,et=Ie.unique;return new Promise(function(ft,kt){ft=Ue(ft);var Ct=Ge.index,dt=Ge.range,mt=Re.objectStore(Pe),mt=Ct.isPrimaryKey?mt:mt.index(Ct.name),Ct=Ye?et?"prevunique":"prev":et?"nextunique":"next",ot=!Ve&&"openKeyCursor"in mt?mt.openKeyCursor(D(dt),Ct):mt.openCursor(D(dt),Ct);ot.onerror=ki(kt),ot.onsuccess=Ue(function(Lt){var mr,xr,Yt,mn,er=ot.result;er?(er.___id=++Wl,er.done=!1,mr=er.continue.bind(er),xr=(xr=er.continuePrimaryKey)&&xr.bind(er),Yt=er.advance.bind(er),mn=function(){throw new Error("Cursor not stopped")},er.trans=Re,er.stop=er.continue=er.continuePrimaryKey=er.advance=function(){throw new Error("Cursor not started")},er.fail=Ue(kt),er.next=function(){var Tn=this,Nn=1;return this.start(function(){return Nn--?Tn.continue():Tn.stop()}).then(function(){return Tn})},er.start=function(Tn){function Nn(){if(ot.result)try{Tn()}catch(In){er.fail(In)}else er.done=!0,er.start=function(){throw new Error("Cursor behind last entry")},er.stop()}var Cs=new Promise(function(In,ai){In=Ue(In),ot.onerror=ki(ai),er.fail=ai,er.stop=function(Co){er.stop=er.continue=er.continuePrimaryKey=er.advance=mn,In(Co)}});return ot.onsuccess=Ue(function(In){ot.onsuccess=Nn,Nn()}),er.continue=mr,er.continuePrimaryKey=xr,er.advance=Yt,Nn(),Cs},ft(er)):ft(null)},kt)})},count:function(Ie){var Re=Ie.query,Ve=Ie.trans,Ge=Re.index,Ye=Re.range;return new Promise(function(et,ft){var kt=Ve.objectStore(Pe),dt=Ge.isPrimaryKey?kt:kt.index(Ge.name),kt=D(Ye),dt=kt?dt.count(kt):dt.count();dt.onsuccess=Ue(function(mt){return et(mt.target.result)}),dt.onerror=ki(ft)})}}}var q,te,he,De=(te=xe,he=go((q=v).objectStoreNames),{schema:{name:q.name,tables:he.map(function(Oe){return te.objectStore(Oe)}).map(function(Oe){var ke=Oe.keyPath,Re=Oe.autoIncrement,Pe=c(ke),Ie={},Re={name:Oe.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:ke==null,compound:Pe,keyPath:ke,autoIncrement:Re,unique:!0,extractKey:mo(ke)},indexes:go(Oe.indexNames).map(function(Ve){return Oe.index(Ve)}).map(function(et){var Ge=et.name,Ye=et.unique,ft=et.multiEntry,et=et.keyPath,ft={name:Ge,compound:c(et),keyPath:et,unique:Ye,multiEntry:ft,extractKey:mo(et)};return Ie[xs(et)]=ft}),getIndexByKeyPath:function(Ve){return Ie[xs(Ve)]}};return Ie[":id"]=Re.primaryKey,ke!=null&&(Ie[xs(ke)]=Re.primaryKey),Re})},hasGetAll:0<he.length&&"getAll"in te.objectStore(he[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),xe=De.schema,Ce=De.hasGetAll,De=xe.tables.map(B),me={};return De.forEach(function(Oe){return me[Oe.name]=Oe}),{stack:"dbcore",transaction:v.transaction.bind(v),table:function(Oe){if(!me[Oe])throw new Error("Table '".concat(Oe,"' not found"));return me[Oe]},MIN_KEY:-1/0,MAX_KEY:Aa(k),schema:xe}}function Yc(v,k,E,D){var B=E.IDBKeyRange;return E.indexedDB,{dbcore:(D=da(k,B,D),v.dbcore.reduce(function(q,te){return te=te.create,h(h({},q),te(q))},D))}}function $s(v,D){var E=D.db,D=Yc(v._middlewares,E,v._deps,D);v.core=D.dbcore,v.tables.forEach(function(B){var q=B.name;v.core.schema.tables.some(function(te){return te.name===q})&&(B.core=v.core.table(q),v[q]instanceof v.Table&&(v[q].core=B.core))})}function pa(v,k,E,D){E.forEach(function(B){var q=D[B];k.forEach(function(te){var he=function xe(Ce,De){return $e(Ce,De)||(Ce=G(Ce))&&xe(Ce,De)}(te,B);(!he||"value"in he&&he.value===void 0)&&(te===v.Transaction.prototype||te instanceof v.Transaction?Be(te,B,{get:function(){return this.table(B)},set:function(xe){Le(this,B,{value:xe,writable:!0,configurable:!0,enumerable:!0})}}):te[B]=new v.Table(B,q))})})}function fa(v,k){k.forEach(function(E){for(var D in E)E[D]instanceof v.Table&&delete E[D]})}function Br(v,k){return v._cfg.version-k._cfg.version}function Ho(v,k,E,D){var B=v._dbSchema;E.objectStoreNames.contains("$meta")&&!B.$meta&&(B.$meta=Ko("$meta",Yl("")[0],[]),v._storeNames.push("$meta"));var q=v._createTransaction("readwrite",v._storeNames,B);q.create(E),q._completion.catch(D);var te=q._reject.bind(q),he=Ot.transless||Ot;nr(function(){return Ot.trans=q,Ot.transless=he,k!==0?($s(v,E),Ce=k,((xe=q).storeNames.includes("$meta")?xe.table("$meta").get("version").then(function(De){return De??Ce}):St.resolve(Ce)).then(function(De){return Oe=De,ke=q,Pe=E,Ie=[],De=(me=v)._versions,Re=me._dbSchema=yo(0,me.idbdb,Pe),(De=De.filter(function(Ve){return Ve._cfg.version>=Oe})).length!==0?(De.forEach(function(Ve){Ie.push(function(){var Ge=Re,Ye=Ve._cfg.dbschema;qs(me,Ge,Pe),qs(me,Ye,Pe),Re=me._dbSchema=Ye;var et=rs(Ge,Ye);et.add.forEach(function(Ct){Zl(Pe,Ct[0],Ct[1].primKey,Ct[1].indexes)}),et.change.forEach(function(Ct){if(Ct.recreate)throw new ct.Upgrade("Not yet support for changing primary key");var ot=Pe.objectStore(Ct.name);Ct.add.forEach(function(Lt){return Wo(ot,Lt)}),Ct.change.forEach(function(Lt){ot.deleteIndex(Lt.name),Wo(ot,Lt)}),Ct.del.forEach(function(Lt){return ot.deleteIndex(Lt)})});var ft=Ve._cfg.contentUpgrade;if(ft&&Ve._cfg.version>Oe){$s(me,Pe),ke._memoizedTables={};var kt=fe(Ye);et.del.forEach(function(Ct){kt[Ct]=Ge[Ct]}),fa(me,[me.Transaction.prototype]),pa(me,[me.Transaction.prototype],x(kt),kt),ke.schema=kt;var dt,mt=Tt(ft);return mt&&wr(),et=St.follow(function(){var Ct;(dt=ft(ke))&&mt&&(Ct=dr.bind(null,null),dt.then(Ct,Ct))}),dt&&typeof dt.then=="function"?St.resolve(dt):et.then(function(){return dt})}}),Ie.push(function(Ge){var Ye,et,ft=Ve._cfg.dbschema;Ye=ft,et=Ge,[].slice.call(et.db.objectStoreNames).forEach(function(kt){return Ye[kt]==null&&et.db.deleteObjectStore(kt)}),fa(me,[me.Transaction.prototype]),pa(me,[me.Transaction.prototype],me._storeNames,me._dbSchema),ke.schema=me._dbSchema}),Ie.push(function(Ge){me.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(me.idbdb.version/10)===Ve._cfg.version?(me.idbdb.deleteObjectStore("$meta"),delete me._dbSchema.$meta,me._storeNames=me._storeNames.filter(function(Ye){return Ye!=="$meta"})):Ge.objectStore("$meta").put(Ve._cfg.version,"version"))})}),function Ve(){return Ie.length?St.resolve(Ie.shift()(ke.idbtrans)).then(Ve):St.resolve()}().then(function(){Xl(Re,Pe)})):St.resolve();var me,Oe,ke,Pe,Ie,Re}).catch(te)):(x(B).forEach(function(De){Zl(E,De,B[De].primKey,B[De].indexes)}),$s(v,E),void St.follow(function(){return v.on.populate.fire(q)}).catch(te));var xe,Ce})}function Jc(v,k){Xl(v._dbSchema,k),k.db.version%10!=0||k.objectStoreNames.contains("$meta")||k.db.createObjectStore("$meta").add(Math.ceil(k.db.version/10-1),"version");var E=yo(0,v.idbdb,k);qs(v,v._dbSchema,k);for(var D=0,B=rs(E,v._dbSchema).change;D<B.length;D++){var q=function(te){if(te.change.length||te.recreate)return console.warn("Unable to patch indexes of table ".concat(te.name," because it has changes on the type of index or primary key.")),{value:void 0};var he=k.objectStore(te.name);te.add.forEach(function(xe){_n&&console.debug("Dexie upgrade patch: Creating missing index ".concat(te.name,".").concat(xe.src)),Wo(he,xe)})}(B[D]);if(typeof q=="object")return q.value}}function rs(v,k){var E,D={del:[],add:[],change:[]};for(E in v)k[E]||D.del.push(E);for(E in k){var B=v[E],q=k[E];if(B){var te={name:E,def:q,recreate:!1,del:[],add:[],change:[]};if(""+(B.primKey.keyPath||"")!=""+(q.primKey.keyPath||"")||B.primKey.auto!==q.primKey.auto)te.recreate=!0,D.change.push(te);else{var he=B.idxByName,xe=q.idxByName,Ce=void 0;for(Ce in he)xe[Ce]||te.del.push(Ce);for(Ce in xe){var De=he[Ce],me=xe[Ce];De?De.src!==me.src&&te.change.push(me):te.add.push(me)}(0<te.del.length||0<te.add.length||0<te.change.length)&&D.change.push(te)}}else D.add.push([E,q])}return D}function Zl(v,k,E,D){var B=v.db.createObjectStore(k,E.keyPath?{keyPath:E.keyPath,autoIncrement:E.auto}:{autoIncrement:E.auto});return D.forEach(function(q){return Wo(B,q)}),B}function Xl(v,k){x(v).forEach(function(E){k.db.objectStoreNames.contains(E)||(_n&&console.debug("Dexie: Creating missing table",E),Zl(k,E,v[E].primKey,v[E].indexes))})}function Wo(v,k){v.createIndex(k.name,k.keyPath,{unique:k.unique,multiEntry:k.multi})}function yo(v,k,E){var D={};return J(k.objectStoreNames,0).forEach(function(B){for(var q=E.objectStore(B),te=Hl(ju(Ce=q.keyPath),Ce||"",!0,!1,!!q.autoIncrement,Ce&&typeof Ce!="string",!0),he=[],xe=0;xe<q.indexNames.length;++xe){var De=q.index(q.indexNames[xe]),Ce=De.keyPath,De=Hl(De.name,Ce,!!De.unique,!!De.multiEntry,!1,Ce&&typeof Ce!="string",!1);he.push(De)}D[B]=Ko(B,te,he)}),D}function qs(v,k,E){for(var D=E.db.objectStoreNames,B=0;B<D.length;++B){var q=D[B],te=E.objectStore(q);v._hasGetAll="getAll"in te;for(var he=0;he<te.indexNames.length;++he){var xe=te.indexNames[he],Ce=te.index(xe).keyPath,De=typeof Ce=="string"?Ce:"["+J(Ce).join("+")+"]";!k[q]||(Ce=k[q].idxByName[De])&&(Ce.name=xe,delete k[q].idxByName[De],k[q].idxByName[xe]=Ce)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&w.WorkerGlobalScope&&w instanceof w.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(v._hasGetAll=!1)}function Yl(v){return v.split(",").map(function(k,E){var q=k.split(":"),D=(B=q[1])===null||B===void 0?void 0:B.trim(),B=(k=q[0].trim()).replace(/([&*]|\+\+)/g,""),q=/^\[/.test(B)?B.match(/^\[(.*)\]$/)[1].split("+"):B;return Hl(B,q||null,/\&/.test(k),/\*/.test(k),/\+\+/.test(k),c(q),E===0,D)})}var Uu=(bs.prototype._createTableSchema=Ko,bs.prototype._parseIndexSyntax=Yl,bs.prototype._parseStoresSpec=function(v,k){var E=this;x(v).forEach(function(D){if(v[D]!==null){var B=E._parseIndexSyntax(v[D]),q=B.shift();if(!q)throw new ct.Schema("Invalid schema for table "+D+": "+v[D]);if(q.unique=!0,q.multi)throw new ct.Schema("Primary key cannot be multiEntry*");B.forEach(function(te){if(te.auto)throw new ct.Schema("Only primary key can be marked as autoIncrement (++)");if(!te.keyPath)throw new ct.Schema("Index must have a name and cannot be an empty string")}),B=E._createTableSchema(D,q,B),k[D]=B}})},bs.prototype.stores=function(E){var k=this.db;this._cfg.storesSource=this._cfg.storesSource?V(this._cfg.storesSource,E):E;var E=k._versions,D={},B={};return E.forEach(function(q){V(D,q._cfg.storesSource),B=q._cfg.dbschema={},q._parseStoresSpec(D,B)}),k._dbSchema=B,fa(k,[k._allTables,k,k.Transaction.prototype]),pa(k,[k._allTables,k,k.Transaction.prototype,this._cfg.tables],x(B),B),k._storeNames=x(B),this},bs.prototype.upgrade=function(v){return this._cfg.contentUpgrade=pr(this._cfg.contentUpgrade||wt,v),this},bs);function bs(){}function Zo(v,k){var E=v._dbNamesDB;return E||(E=v._dbNamesDB=new Qi(Hn,{addons:[],indexedDB:v,IDBKeyRange:k})).version(1).stores({dbnames:"name"}),E.table("dbnames")}function Ma(v){return v&&typeof v.databases=="function"}function Xo(v){return nr(function(){return Ot.letThrough=!0,v()})}function Jl(v){return!("from"in v)}var $n=function(v,k){if(!this){var E=new $n;return v&&"d"in v&&V(E,v),E}V(this,arguments.length?{d:1,from:v,to:1<arguments.length?k:v}:{d:0})};function Da(v,k,E){var D=ir(k,E);if(!isNaN(D)){if(0<D)throw RangeError();if(Jl(v))return V(v,{from:k,to:E,d:1});var B=v.l,D=v.r;if(ir(E,v.from)<0)return B?Da(B,k,E):v.l={from:k,to:E,d:1,l:null,r:null},Vu(v);if(0<ir(k,v.to))return D?Da(D,k,E):v.r={from:k,to:E,d:1,l:null,r:null},Vu(v);ir(k,v.from)<0&&(v.from=k,v.l=null,v.d=D?D.d+1:1),0<ir(E,v.to)&&(v.to=E,v.r=null,v.d=v.l?v.l.d+1:1),E=!v.r,B&&!v.l&&_o(v,B),D&&E&&_o(v,D)}}function _o(v,k){Jl(k)||function E(D,xe){var q=xe.from,te=xe.to,he=xe.l,xe=xe.r;Da(D,q,te),he&&E(D,he),xe&&E(D,xe)}(v,k)}function vo(v,k){var E=Yo(k),D=E.next();if(D.done)return!1;for(var B=D.value,q=Yo(v),te=q.next(B.from),he=te.value;!D.done&&!te.done;){if(ir(he.from,B.to)<=0&&0<=ir(he.to,B.from))return!0;ir(B.from,he.from)<0?B=(D=E.next(he.from)).value:he=(te=q.next(B.from)).value}return!1}function Yo(v){var k=Jl(v)?null:{s:0,n:v};return{next:function(E){for(var D=0<arguments.length;k;)switch(k.s){case 0:if(k.s=1,D)for(;k.n.l&&ir(E,k.n.from)<0;)k={up:k,n:k.n.l,s:1};else for(;k.n.l;)k={up:k,n:k.n.l,s:1};case 1:if(k.s=2,!D||ir(E,k.n.to)<=0)return{value:k.n,done:!1};case 2:if(k.n.r){k.s=3,k={up:k,n:k.n.r,s:0};continue}case 3:k=k.up}return{done:!0}}}}function Vu(v){var k,E,D=(((k=v.r)===null||k===void 0?void 0:k.d)||0)-(((E=v.l)===null||E===void 0?void 0:E.d)||0),B=1<D?"r":D<-1?"l":"";B&&(k=B=="r"?"l":"r",E=h({},v),D=v[B],v.from=D.from,v.to=D.to,v[B]=D[B],E[B]=D[k],(v[k]=E).d=Ql(E)),v.d=Ql(v)}function Ql(E){var k=E.r,E=E.l;return(k?E?Math.max(k.d,E.d):k.d:E?E.d:0)+1}function xo(v,k){return x(k).forEach(function(E){v[E]?_o(v[E],k[E]):v[E]=function D(B){var q,te,he={};for(q in B)Q(B,q)&&(te=B[q],he[q]=!te||typeof te!="object"||tt.has(te.constructor)?te:D(te));return he}(k[E])}),v}function Jo(v,k){return v.all||k.all||Object.keys(v).some(function(E){return k[E]&&vo(k[E],v[E])})}H($n.prototype,((Wn={add:function(v){return _o(this,v),this},addKey:function(v){return Da(this,v,v),this},addKeys:function(v){var k=this;return v.forEach(function(E){return Da(k,E,E)}),this},hasKey:function(v){var k=Yo(this).next(v).value;return k&&ir(k.from,v)<=0&&0<=ir(k.to,v)}})[Hr]=function(){return Yo(this)},Wn));var za={},Qo={},Gs=!1;function Bi(v){xo(Qo,v),Gs||(Gs=!0,setTimeout(function(){Gs=!1,bo(Qo,!(Qo={}))},0))}function bo(v,k){k===void 0&&(k=!1);var E=new Set;if(v.all)for(var D=0,B=Object.values(za);D<B.length;D++)el(te=B[D],v,E,k);else for(var q in v){var te,he=/^idb\:\/\/(.*)\/(.*)\//.exec(q);he&&(q=he[1],he=he[2],(te=za["idb://".concat(q,"/").concat(he)])&&el(te,v,E,k))}E.forEach(function(xe){return xe()})}function el(v,k,E,D){for(var B=[],q=0,te=Object.entries(v.queries.query);q<te.length;q++){for(var he=te[q],xe=he[0],Ce=[],De=0,me=he[1];De<me.length;De++){var Oe=me[De];Jo(k,Oe.obsSet)?Oe.subscribers.forEach(function(Re){return E.add(Re)}):D&&Ce.push(Oe)}D&&B.push([xe,Ce])}if(D)for(var ke=0,Pe=B;ke<Pe.length;ke++){var Ie=Pe[ke],xe=Ie[0],Ce=Ie[1];v.queries.query[xe]=Ce}}function eu(v){var k=v._state,E=v._deps.indexedDB;if(k.isBeingOpened||v.idbdb)return k.dbReadyPromise.then(function(){return k.dbOpenError?Lr(k.dbOpenError):v});k.isBeingOpened=!0,k.dbOpenError=null,k.openComplete=!1;var D=k.openCanceller,B=Math.round(10*v.verno),q=!1;function te(){if(k.openCanceller!==D)throw new ct.DatabaseClosed("db.open() was cancelled")}function he(){return new St(function(Oe,ke){if(te(),!E)throw new ct.MissingAPI;var Pe=v.name,Ie=k.autoSchema||!B?E.open(Pe):E.open(Pe,B);if(!Ie)throw new ct.MissingAPI;Ie.onerror=ki(ke),Ie.onblocked=Ue(v._fireOnBlocked),Ie.onupgradeneeded=Ue(function(Re){var Ve;De=Ie.transaction,k.autoSchema&&!v._options.allowEmptyDB?(Ie.onerror=Qa,De.abort(),Ie.result.close(),(Ve=E.deleteDatabase(Pe)).onsuccess=Ve.onerror=Ue(function(){ke(new ct.NoSuchDatabase("Database ".concat(Pe," doesnt exist")))})):(De.onerror=ki(ke),Re=Re.oldVersion>Math.pow(2,62)?0:Re.oldVersion,me=Re<1,v.idbdb=Ie.result,q&&Jc(v,De),Ho(v,Re/10,De,ke))},ke),Ie.onsuccess=Ue(function(){De=null;var Re,Ve,Ge,Ye,et,ft=v.idbdb=Ie.result,kt=J(ft.objectStoreNames);if(0<kt.length)try{var dt=ft.transaction((Ye=kt).length===1?Ye[0]:Ye,"readonly");if(k.autoSchema)Ve=ft,Ge=dt,(Re=v).verno=Ve.version/10,Ge=Re._dbSchema=yo(0,Ve,Ge),Re._storeNames=J(Ve.objectStoreNames,0),pa(Re,[Re._allTables],x(Ge),Ge);else if(qs(v,v._dbSchema,dt),((et=rs(yo(0,(et=v).idbdb,dt),et._dbSchema)).add.length||et.change.some(function(mt){return mt.add.length||mt.change.length}))&&!q)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),ft.close(),B=ft.version+1,q=!0,Oe(he());$s(v,dt)}catch{}Za.push(v),ft.onversionchange=Ue(function(mt){k.vcFired=!0,v.on("versionchange").fire(mt)}),ft.onclose=Ue(function(){v.close({disableAutoOpen:!1})}),me&&(et=v._deps,dt=Pe,ft=et.indexedDB,et=et.IDBKeyRange,Ma(ft)||dt===Hn||Zo(ft,et).put({name:dt}).catch(wt)),Oe()},ke)}).catch(function(Oe){switch(Oe?.name){case"UnknownError":if(0<k.PR1398_maxLoop)return k.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),he();break;case"VersionError":if(0<B)return B=0,he()}return St.reject(Oe)})}var xe,Ce=k.dbReadyResolve,De=null,me=!1;return St.race([D,(typeof navigator>"u"?St.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(Oe){function ke(){return indexedDB.databases().finally(Oe)}xe=setInterval(ke,100),ke()}).finally(function(){return clearInterval(xe)}):Promise.resolve()).then(he)]).then(function(){return te(),k.onReadyBeingFired=[],St.resolve(Xo(function(){return v.on.ready.fire(v.vip)})).then(function Oe(){if(0<k.onReadyBeingFired.length){var ke=k.onReadyBeingFired.reduce(pr,wt);return k.onReadyBeingFired=[],St.resolve(Xo(function(){return ke(v.vip)})).then(Oe)}})}).finally(function(){k.openCanceller===D&&(k.onReadyBeingFired=null,k.isBeingOpened=!1)}).catch(function(Oe){k.dbOpenError=Oe;try{De&&De.abort()}catch{}return D===k.openCanceller&&v._close(),Lr(Oe)}).finally(function(){k.openComplete=!0,Ce()}).then(function(){var Oe;return me&&(Oe={},v.tables.forEach(function(ke){ke.schema.indexes.forEach(function(Pe){Pe.name&&(Oe["idb://".concat(v.name,"/").concat(ke.name,"/").concat(Pe.name)]=new $n(-1/0,[[[]]]))}),Oe["idb://".concat(v.name,"/").concat(ke.name,"/")]=Oe["idb://".concat(v.name,"/").concat(ke.name,"/:dels")]=new $n(-1/0,[[[]]])}),ts(Vs).fire(Oe),bo(Oe,!0)),v})}function Ks(v){function k(q){return v.next(q)}var E=B(k),D=B(function(q){return v.throw(q)});function B(q){return function(xe){var he=q(xe),xe=he.value;return he.done?xe:xe&&typeof xe.then=="function"?xe.then(E,D):c(xe)?Promise.all(xe).then(E,D):E(xe)}}return B(k)()}function Hs(v,k,E){for(var D=c(v)?v.slice():[v],B=0;B<E;++B)D.push(k);return D}var ws={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(v){return h(h({},v),{table:function(k){var E=v.table(k),D=E.schema,B={},q=[];function te(me,Oe,ke){var Pe=xs(me),Ie=B[Pe]=B[Pe]||[],Re=me==null?0:typeof me=="string"?1:me.length,Ve=0<Oe,Ve=h(h({},ke),{name:Ve?"".concat(Pe,"(virtual-from:").concat(ke.name,")"):ke.name,lowLevelIndex:ke,isVirtual:Ve,keyTail:Oe,keyLength:Re,extractKey:mo(me),unique:!Ve&&ke.unique});return Ie.push(Ve),Ve.isPrimaryKey||q.push(Ve),1<Re&&te(Re===2?me[0]:me.slice(0,Re-1),Oe+1,ke),Ie.sort(function(Ge,Ye){return Ge.keyTail-Ye.keyTail}),Ve}k=te(D.primaryKey.keyPath,0,D.primaryKey),B[":id"]=[k];for(var he=0,xe=D.indexes;he<xe.length;he++){var Ce=xe[he];te(Ce.keyPath,0,Ce)}function De(me){var Oe,ke=me.query.index;return ke.isVirtual?h(h({},me),{query:{index:ke.lowLevelIndex,range:(Oe=me.query.range,ke=ke.keyTail,{type:Oe.type===1?2:Oe.type,lower:Hs(Oe.lower,Oe.lowerOpen?v.MAX_KEY:v.MIN_KEY,ke),lowerOpen:!0,upper:Hs(Oe.upper,Oe.upperOpen?v.MIN_KEY:v.MAX_KEY,ke),upperOpen:!0})}}):me}return h(h({},E),{schema:h(h({},D),{primaryKey:k,indexes:q,getIndexByKeyPath:function(me){return(me=B[xs(me)])&&me[0]}}),count:function(me){return E.count(De(me))},query:function(me){return E.query(De(me))},openCursor:function(me){var Oe=me.query.index,ke=Oe.keyTail,Pe=Oe.isVirtual,Ie=Oe.keyLength;return Pe?E.openCursor(De(me)).then(function(Ve){return Ve&&Re(Ve)}):E.openCursor(me);function Re(Ve){return Object.create(Ve,{continue:{value:function(Ge){Ge!=null?Ve.continue(Hs(Ge,me.reverse?v.MAX_KEY:v.MIN_KEY,ke)):me.unique?Ve.continue(Ve.key.slice(0,Ie).concat(me.reverse?v.MIN_KEY:v.MAX_KEY,ke)):Ve.continue()}},continuePrimaryKey:{value:function(Ge,Ye){Ve.continuePrimaryKey(Hs(Ge,v.MAX_KEY,ke),Ye)}},primaryKey:{get:function(){return Ve.primaryKey}},key:{get:function(){var Ge=Ve.key;return Ie===1?Ge[0]:Ge.slice(0,Ie)}},value:{get:function(){return Ve.value}}})}}})}})}};function wo(v,k,E,D){return E=E||{},D=D||"",x(v).forEach(function(B){var q,te,he;Q(k,B)?(q=v[B],te=k[B],typeof q=="object"&&typeof te=="object"&&q&&te?(he=Gr(q))!==Gr(te)?E[D+B]=k[B]:he==="Object"?wo(q,te,E,D+B+"."):q!==te&&(E[D+B]=k[B]):q!==te&&(E[D+B]=k[B])):E[D+B]=void 0}),x(k).forEach(function(B){Q(v,B)||(E[D+B]=k[B])}),E}function tu(v,k){return k.type==="delete"?k.keys:k.keys||k.values.map(v.extractKey)}var gn={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(v){return h(h({},v),{table:function(k){var E=v.table(k),D=E.schema.primaryKey;return h(h({},E),{mutate:function(B){var q=Ot.trans,te=q.table(k).hook,he=te.deleting,xe=te.creating,Ce=te.updating;switch(B.type){case"add":if(xe.fire===wt)break;return q._promise("readwrite",function(){return De(B)},!0);case"put":if(xe.fire===wt&&Ce.fire===wt)break;return q._promise("readwrite",function(){return De(B)},!0);case"delete":if(he.fire===wt)break;return q._promise("readwrite",function(){return De(B)},!0);case"deleteRange":if(he.fire===wt)break;return q._promise("readwrite",function(){return function me(Oe,ke,Pe){return E.query({trans:Oe,values:!1,query:{index:D,range:ke},limit:Pe}).then(function(Ie){var Re=Ie.result;return De({type:"delete",keys:Re,trans:Oe}).then(function(Ve){return 0<Ve.numFailures?Promise.reject(Ve.failures[0]):Re.length<Pe?{failures:[],numFailures:0,lastResult:void 0}:me(Oe,h(h({},ke),{lower:Re[Re.length-1],lowerOpen:!0}),Pe)})})}(B.trans,B.range,1e4)},!0)}return E.mutate(B);function De(me){var Oe,ke,Pe,Ie=Ot.trans,Re=me.keys||tu(D,me);if(!Re)throw new Error("Keys missing");return(me=me.type==="add"||me.type==="put"?h(h({},me),{keys:Re}):h({},me)).type!=="delete"&&(me.values=y([],me.values)),me.keys&&(me.keys=y([],me.keys)),Oe=E,Pe=Re,((ke=me).type==="add"?Promise.resolve([]):Oe.getMany({trans:ke.trans,keys:Pe,cache:"immutable"})).then(function(Ve){var Ge=Re.map(function(Ye,et){var ft,kt,dt,mt=Ve[et],Ct={onerror:null,onsuccess:null};return me.type==="delete"?he.fire.call(Ct,Ye,mt,Ie):me.type==="add"||mt===void 0?(ft=xe.fire.call(Ct,Ye,me.values[et],Ie),Ye==null&&ft!=null&&(me.keys[et]=Ye=ft,D.outbound||Xe(me.values[et],D.keyPath,Ye))):(ft=wo(mt,me.values[et]),(kt=Ce.fire.call(Ct,ft,Ye,mt,Ie))&&(dt=me.values[et],Object.keys(kt).forEach(function(ot){Q(dt,ot)?dt[ot]=kt[ot]:Xe(dt,ot,kt[ot])}))),Ct});return E.mutate(me).then(function(Ye){for(var et=Ye.failures,ft=Ye.results,kt=Ye.numFailures,Ye=Ye.lastResult,dt=0;dt<Re.length;++dt){var mt=(ft||Re)[dt],Ct=Ge[dt];mt==null?Ct.onerror&&Ct.onerror(et[dt]):Ct.onsuccess&&Ct.onsuccess(me.type==="put"&&Ve[dt]?me.values[dt]:mt)}return{failures:et,results:ft,numFailures:kt,lastResult:Ye}}).catch(function(Ye){return Ge.forEach(function(et){return et.onerror&&et.onerror(Ye)}),Promise.reject(Ye)})})}}})}})}};function $u(v,k,E){try{if(!k||k.keys.length<v.length)return null;for(var D=[],B=0,q=0;B<k.keys.length&&q<v.length;++B)ir(k.keys[B],v[q])===0&&(D.push(E?Bt(k.values[B]):k.values[B]),++q);return D.length===v.length?D:null}catch{return null}}var vr={stack:"dbcore",level:-1,create:function(v){return{table:function(k){var E=v.table(k);return h(h({},E),{getMany:function(D){if(!D.cache)return E.getMany(D);var B=$u(D.keys,D.trans._cache,D.cache==="clone");return B?St.resolve(B):E.getMany(D).then(function(q){return D.trans._cache={keys:D.keys,values:D.cache==="clone"?Bt(q):q},q})},mutate:function(D){return D.type!=="add"&&(D.trans._cache=null),E.mutate(D)}})}}}};function So(v,k){return v.trans.mode==="readonly"&&!!v.subscr&&!v.trans.explicit&&v.trans.db._options.cache!=="disabled"&&!k.schema.primaryKey.outbound}function Kr(v,k){switch(v){case"query":return k.values&&!k.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var $r={stack:"dbcore",level:0,name:"Observability",create:function(v){var k=v.schema.name,E=new $n(v.MIN_KEY,v.MAX_KEY);return h(h({},v),{transaction:function(D,B,q){if(Ot.subscr&&B!=="readonly")throw new ct.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Ot.querier));return v.transaction(D,B,q)},table:function(D){var B=v.table(D),q=B.schema,te=q.primaryKey,me=q.indexes,he=te.extractKey,xe=te.outbound,Ce=te.autoIncrement&&me.filter(function(ke){return ke.compound&&ke.keyPath.includes(te.keyPath)}),De=h(h({},B),{mutate:function(ke){function Pe(ot){return ot="idb://".concat(k,"/").concat(D,"/").concat(ot),Ye[ot]||(Ye[ot]=new $n)}var Ie,Re,Ve,Ge=ke.trans,Ye=ke.mutatedParts||(ke.mutatedParts={}),et=Pe(""),ft=Pe(":dels"),kt=ke.type,Ct=ke.type==="deleteRange"?[ke.range]:ke.type==="delete"?[ke.keys]:ke.values.length<50?[tu(te,ke).filter(function(ot){return ot}),ke.values]:[],dt=Ct[0],mt=Ct[1],Ct=ke.trans._cache;return c(dt)?(et.addKeys(dt),(Ct=kt==="delete"||dt.length===mt.length?$u(dt,Ct):null)||ft.addKeys(dt),(Ct||mt)&&(Ie=Pe,Re=Ct,Ve=mt,q.indexes.forEach(function(ot){var Lt=Ie(ot.name||"");function mr(Yt){return Yt!=null?ot.extractKey(Yt):null}function xr(Yt){return ot.multiEntry&&c(Yt)?Yt.forEach(function(mn){return Lt.addKey(mn)}):Lt.addKey(Yt)}(Re||Ve).forEach(function(Yt,Tn){var er=Re&&mr(Re[Tn]),Tn=Ve&&mr(Ve[Tn]);ir(er,Tn)!==0&&(er!=null&&xr(er),Tn!=null&&xr(Tn))})}))):dt?(mt={from:(mt=dt.lower)!==null&&mt!==void 0?mt:v.MIN_KEY,to:(mt=dt.upper)!==null&&mt!==void 0?mt:v.MAX_KEY},ft.add(mt),et.add(mt)):(et.add(E),ft.add(E),q.indexes.forEach(function(ot){return Pe(ot.name).add(E)})),B.mutate(ke).then(function(ot){return!dt||ke.type!=="add"&&ke.type!=="put"||(et.addKeys(ot.results),Ce&&Ce.forEach(function(Lt){for(var mr=ke.values.map(function(er){return Lt.extractKey(er)}),xr=Lt.keyPath.findIndex(function(er){return er===te.keyPath}),Yt=0,mn=ot.results.length;Yt<mn;++Yt)mr[Yt][xr]=ot.results[Yt];Pe(Lt.name).addKeys(mr)})),Ge.mutatedParts=xo(Ge.mutatedParts||{},Ye),ot})}}),me=function(Pe){var Ie=Pe.query,Pe=Ie.index,Ie=Ie.range;return[Pe,new $n((Pe=Ie.lower)!==null&&Pe!==void 0?Pe:v.MIN_KEY,(Ie=Ie.upper)!==null&&Ie!==void 0?Ie:v.MAX_KEY)]},Oe={get:function(ke){return[te,new $n(ke.key)]},getMany:function(ke){return[te,new $n().addKeys(ke.keys)]},count:me,query:me,openCursor:me};return x(Oe).forEach(function(ke){De[ke]=function(Pe){var Ie=Ot.subscr,Re=!!Ie,Ve=So(Ot,B)&&Kr(ke,Pe)?Pe.obsSet={}:Ie;if(Re){var Ge=function(mt){return mt="idb://".concat(k,"/").concat(D,"/").concat(mt),Ve[mt]||(Ve[mt]=new $n)},Ye=Ge(""),et=Ge(":dels"),Ie=Oe[ke](Pe),Re=Ie[0],Ie=Ie[1];if((ke==="query"&&Re.isPrimaryKey&&!Pe.values?et:Ge(Re.name||"")).add(Ie),!Re.isPrimaryKey){if(ke!=="count"){var ft=ke==="query"&&xe&&Pe.values&&B.query(h(h({},Pe),{values:!1}));return B[ke].apply(this,arguments).then(function(mt){if(ke==="query"){if(xe&&Pe.values)return ft.then(function(mr){return mr=mr.result,Ye.addKeys(mr),mt});var Ct=Pe.values?mt.result.map(he):mt.result;(Pe.values?Ye:et).addKeys(Ct)}else if(ke==="openCursor"){var ot=mt,Lt=Pe.values;return ot&&Object.create(ot,{key:{get:function(){return et.addKey(ot.primaryKey),ot.key}},primaryKey:{get:function(){var mr=ot.primaryKey;return et.addKey(mr),mr}},value:{get:function(){return Lt&&Ye.addKey(ot.primaryKey),ot.value}}})}return mt})}et.add(E)}}return B[ke].apply(this,arguments)}}),De}})}};function ns(v,k,E){if(E.numFailures===0)return k;if(k.type==="deleteRange")return null;var D=k.keys?k.keys.length:"values"in k&&k.values?k.values.length:1;return E.numFailures===D?null:(k=h({},k),c(k.keys)&&(k.keys=k.keys.filter(function(B,q){return!(q in E.failures)})),"values"in k&&c(k.values)&&(k.values=k.values.filter(function(B,q){return!(q in E.failures)})),k)}function Ss(v,k){return E=v,((D=k).lower===void 0||(D.lowerOpen?0<ir(E,D.lower):0<=ir(E,D.lower)))&&(v=v,(k=k).upper===void 0||(k.upperOpen?ir(v,k.upper)<0:ir(v,k.upper)<=0));var E,D}function Ws(v,k,Oe,D,B,q){if(!Oe||Oe.length===0)return v;var te=k.query.index,he=te.multiEntry,xe=k.query.range,Ce=D.schema.primaryKey.extractKey,De=te.extractKey,me=(te.lowLevelIndex||te).extractKey,Oe=Oe.reduce(function(ke,Pe){var Ie=ke,Re=[];if(Pe.type==="add"||Pe.type==="put")for(var Ve=new $n,Ge=Pe.values.length-1;0<=Ge;--Ge){var Ye,et=Pe.values[Ge],ft=Ce(et);Ve.hasKey(ft)||(Ye=De(et),(he&&c(Ye)?Ye.some(function(ot){return Ss(ot,xe)}):Ss(Ye,xe))&&(Ve.addKey(ft),Re.push(et)))}switch(Pe.type){case"add":var kt=new $n().addKeys(k.values?ke.map(function(Lt){return Ce(Lt)}):ke),Ie=ke.concat(k.values?Re.filter(function(Lt){return Lt=Ce(Lt),!kt.hasKey(Lt)&&(kt.addKey(Lt),!0)}):Re.map(function(Lt){return Ce(Lt)}).filter(function(Lt){return!kt.hasKey(Lt)&&(kt.addKey(Lt),!0)}));break;case"put":var dt=new $n().addKeys(Pe.values.map(function(Lt){return Ce(Lt)}));Ie=ke.filter(function(Lt){return!dt.hasKey(k.values?Ce(Lt):Lt)}).concat(k.values?Re:Re.map(function(Lt){return Ce(Lt)}));break;case"delete":var mt=new $n().addKeys(Pe.keys);Ie=ke.filter(function(Lt){return!mt.hasKey(k.values?Ce(Lt):Lt)});break;case"deleteRange":var Ct=Pe.range;Ie=ke.filter(function(Lt){return!Ss(Ce(Lt),Ct)})}return Ie},v);return Oe===v?v:(Oe.sort(function(ke,Pe){return ir(me(ke),me(Pe))||ir(Ce(ke),Ce(Pe))}),k.limit&&k.limit<1/0&&(Oe.length>k.limit?Oe.length=k.limit:v.length===k.limit&&Oe.length<k.limit&&(B.dirty=!0)),q?Object.freeze(Oe):Oe)}function tl(v,k){return ir(v.lower,k.lower)===0&&ir(v.upper,k.upper)===0&&!!v.lowerOpen==!!k.lowerOpen&&!!v.upperOpen==!!k.upperOpen}function ks(v,k){return function(E,D,B,q){if(E===void 0)return D!==void 0?-1:0;if(D===void 0)return 1;if((D=ir(E,D))===0){if(B&&q)return 0;if(B)return 1;if(q)return-1}return D}(v.lower,k.lower,v.lowerOpen,k.lowerOpen)<=0&&0<=function(E,D,B,q){if(E===void 0)return D!==void 0?1:0;if(D===void 0)return-1;if((D=ir(E,D))===0){if(B&&q)return 0;if(B)return-1;if(q)return 1}return D}(v.upper,k.upper,v.upperOpen,k.upperOpen)}function Zs(v,k,E,D){v.subscribers.add(E),D.addEventListener("abort",function(){var B,q;v.subscribers.delete(E),v.subscribers.size===0&&(B=v,q=k,setTimeout(function(){B.subscribers.size===0&&at(q,B)},3e3))})}var Ni={stack:"dbcore",level:0,name:"Cache",create:function(v){var k=v.schema.name;return h(h({},v),{transaction:function(E,D,B){var q,te,he=v.transaction(E,D,B);return D==="readwrite"&&(te=(q=new AbortController).signal,B=function(xe){return function(){if(q.abort(),D==="readwrite"){for(var Ce=new Set,De=0,me=E;De<me.length;De++){var Oe=me[De],ke=za["idb://".concat(k,"/").concat(Oe)];if(ke){var Pe=v.table(Oe),Ie=ke.optimisticOps.filter(function(Lt){return Lt.trans===he});if(he._explicit&&xe&&he.mutatedParts)for(var Re=0,Ve=Object.values(ke.queries.query);Re<Ve.length;Re++)for(var Ge=0,Ye=(kt=Ve[Re]).slice();Ge<Ye.length;Ge++)Jo((dt=Ye[Ge]).obsSet,he.mutatedParts)&&(at(kt,dt),dt.subscribers.forEach(function(Lt){return Ce.add(Lt)}));else if(0<Ie.length){ke.optimisticOps=ke.optimisticOps.filter(function(Lt){return Lt.trans!==he});for(var et=0,ft=Object.values(ke.queries.query);et<ft.length;et++)for(var kt,dt,mt,Ct=0,ot=(kt=ft[et]).slice();Ct<ot.length;Ct++)(dt=ot[Ct]).res!=null&&he.mutatedParts&&(xe&&!dt.dirty?(mt=Object.isFrozen(dt.res),mt=Ws(dt.res,dt.req,Ie,Pe,dt,mt),dt.dirty?(at(kt,dt),dt.subscribers.forEach(function(Lt){return Ce.add(Lt)})):mt!==dt.res&&(dt.res=mt,dt.promise=St.resolve({result:mt}))):(dt.dirty&&at(kt,dt),dt.subscribers.forEach(function(Lt){return Ce.add(Lt)})))}}}Ce.forEach(function(Lt){return Lt()})}}},he.addEventListener("abort",B(!1),{signal:te}),he.addEventListener("error",B(!1),{signal:te}),he.addEventListener("complete",B(!0),{signal:te})),he},table:function(E){var D=v.table(E),B=D.schema.primaryKey;return h(h({},D),{mutate:function(q){var te=Ot.trans;if(B.outbound||te.db._options.cache==="disabled"||te.explicit||te.idbtrans.mode!=="readwrite")return D.mutate(q);var he=za["idb://".concat(k,"/").concat(E)];return he?(te=D.mutate(q),q.type!=="add"&&q.type!=="put"||!(50<=q.values.length||tu(B,q).some(function(xe){return xe==null}))?(he.optimisticOps.push(q),q.mutatedParts&&Bi(q.mutatedParts),te.then(function(xe){0<xe.numFailures&&(at(he.optimisticOps,q),(xe=ns(0,q,xe))&&he.optimisticOps.push(xe),q.mutatedParts&&Bi(q.mutatedParts))}),te.catch(function(){at(he.optimisticOps,q),q.mutatedParts&&Bi(q.mutatedParts)})):te.then(function(xe){var Ce=ns(0,h(h({},q),{values:q.values.map(function(De,me){var Oe;return xe.failures[me]?De:(De=(Oe=B.keyPath)!==null&&Oe!==void 0&&Oe.includes(".")?Bt(De):h({},De),Xe(De,B.keyPath,xe.results[me]),De)})}),xe);he.optimisticOps.push(Ce),queueMicrotask(function(){return q.mutatedParts&&Bi(q.mutatedParts)})}),te):D.mutate(q)},query:function(q){if(!So(Ot,D)||!Kr("query",q))return D.query(q);var te=((Ce=Ot.trans)===null||Ce===void 0?void 0:Ce.db._options.cache)==="immutable",me=Ot,he=me.requery,xe=me.signal,Ce=function(Pe,Ie,Re,Ve){var Ge=za["idb://".concat(Pe,"/").concat(Ie)];if(!Ge)return[];if(!(Ie=Ge.queries[Re]))return[null,!1,Ge,null];var Ye=Ie[(Ve.query?Ve.query.index.name:null)||""];if(!Ye)return[null,!1,Ge,null];switch(Re){case"query":var et=Ye.find(function(ft){return ft.req.limit===Ve.limit&&ft.req.values===Ve.values&&tl(ft.req.query.range,Ve.query.range)});return et?[et,!0,Ge,Ye]:[Ye.find(function(ft){return("limit"in ft.req?ft.req.limit:1/0)>=Ve.limit&&(!Ve.values||ft.req.values)&&ks(ft.req.query.range,Ve.query.range)}),!1,Ge,Ye];case"count":return et=Ye.find(function(ft){return tl(ft.req.query.range,Ve.query.range)}),[et,!!et,Ge,Ye]}}(k,E,"query",q),De=Ce[0],me=Ce[1],Oe=Ce[2],ke=Ce[3];return De&&me?De.obsSet=q.obsSet:(me=D.query(q).then(function(Pe){var Ie=Pe.result;if(De&&(De.res=Ie),te){for(var Re=0,Ve=Ie.length;Re<Ve;++Re)Object.freeze(Ie[Re]);Object.freeze(Ie)}else Pe.result=Bt(Ie);return Pe}).catch(function(Pe){return ke&&De&&at(ke,De),Promise.reject(Pe)}),De={obsSet:q.obsSet,promise:me,subscribers:new Set,type:"query",req:q,dirty:!1},ke?ke.push(De):(ke=[De],(Oe=Oe||(za["idb://".concat(k,"/").concat(E)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[q.query.index.name||""]=ke)),Zs(De,ke,he,xe),De.promise.then(function(Pe){return{result:Ws(Pe.result,q,Oe?.optimisticOps,D,De,te)}})}})}})}};function Xs(v,k){return new Proxy(v,{get:function(E,D,B){return D==="db"?k:Reflect.get(E,D,B)}})}var Qi=(fn.prototype.version=function(v){if(isNaN(v)||v<.1)throw new ct.Type("Given version is not a positive number");if(v=Math.round(10*v)/10,this.idbdb||this._state.isBeingOpened)throw new ct.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,v);var k=this._versions,E=k.filter(function(D){return D._cfg.version===v})[0];return E||(E=new this.Version(v),k.push(E),k.sort(Br),E.stores({}),this._state.autoSchema=!1,E)},fn.prototype._whenReady=function(v){var k=this;return this.idbdb&&(this._state.openComplete||Ot.letThrough||this._vip)?v():new St(function(E,D){if(k._state.openComplete)return D(new ct.DatabaseClosed(k._state.dbOpenError));if(!k._state.isBeingOpened){if(!k._state.autoOpen)return void D(new ct.DatabaseClosed);k.open().catch(wt)}k._state.dbReadyPromise.then(E,D)}).then(v)},fn.prototype.use=function(v){var k=v.stack,E=v.create,D=v.level,B=v.name;return B&&this.unuse({stack:k,name:B}),v=this._middlewares[k]||(this._middlewares[k]=[]),v.push({stack:k,create:E,level:D??10,name:B}),v.sort(function(q,te){return q.level-te.level}),this},fn.prototype.unuse=function(v){var k=v.stack,E=v.name,D=v.create;return k&&this._middlewares[k]&&(this._middlewares[k]=this._middlewares[k].filter(function(B){return D?B.create!==D:!!E&&B.name!==E})),this},fn.prototype.open=function(){var v=this;return Ur(Xt,function(){return eu(v)})},fn.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var v=this._state,k=Za.indexOf(this);if(0<=k&&Za.splice(k,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}v.isBeingOpened||(v.dbReadyPromise=new St(function(E){v.dbReadyResolve=E}),v.openCanceller=new St(function(E,D){v.cancelOpen=D}))},fn.prototype.close=function(E){var k=(E===void 0?{disableAutoOpen:!0}:E).disableAutoOpen,E=this._state;k?(E.isBeingOpened&&E.cancelOpen(new ct.DatabaseClosed),this._close(),E.autoOpen=!1,E.dbOpenError=new ct.DatabaseClosed):(this._close(),E.autoOpen=this._options.autoOpen||E.isBeingOpened,E.openComplete=!1,E.dbOpenError=null)},fn.prototype.delete=function(v){var k=this;v===void 0&&(v={disableAutoOpen:!0});var E=0<arguments.length&&typeof arguments[0]!="object",D=this._state;return new St(function(B,q){function te(){k.close(v);var he=k._deps.indexedDB.deleteDatabase(k.name);he.onsuccess=Ue(function(){var xe,Ce,De;xe=k._deps,Ce=k.name,De=xe.indexedDB,xe=xe.IDBKeyRange,Ma(De)||Ce===Hn||Zo(De,xe).delete(Ce).catch(wt),B()}),he.onerror=ki(q),he.onblocked=k._fireOnBlocked}if(E)throw new ct.InvalidArgument("Invalid closeOptions argument to db.delete()");D.isBeingOpened?D.dbReadyPromise.then(te):te()})},fn.prototype.backendDB=function(){return this.idbdb},fn.prototype.isOpen=function(){return this.idbdb!==null},fn.prototype.hasBeenClosed=function(){var v=this._state.dbOpenError;return v&&v.name==="DatabaseClosed"},fn.prototype.hasFailed=function(){return this._state.dbOpenError!==null},fn.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(fn.prototype,"tables",{get:function(){var v=this;return x(this._allTables).map(function(k){return v._allTables[k]})},enumerable:!1,configurable:!0}),fn.prototype.transaction=function(){var v=function(k,E,D){var B=arguments.length;if(B<2)throw new ct.InvalidArgument("Too few arguments");for(var q=new Array(B-1);--B;)q[B-1]=arguments[B];return D=q.pop(),[k,je(q),D]}.apply(this,arguments);return this._transaction.apply(this,v)},fn.prototype._transaction=function(v,k,E){var D=this,B=Ot.trans;B&&B.db===this&&v.indexOf("!")===-1||(B=null);var q,te,he=v.indexOf("?")!==-1;v=v.replace("!","").replace("?","");try{if(te=k.map(function(Ce){if(Ce=Ce instanceof D.Table?Ce.name:Ce,typeof Ce!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return Ce}),v=="r"||v===ri)q=ri;else{if(v!="rw"&&v!=Kl)throw new ct.InvalidArgument("Invalid transaction mode: "+v);q=Kl}if(B){if(B.mode===ri&&q===Kl){if(!he)throw new ct.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");B=null}B&&te.forEach(function(Ce){if(B&&B.storeNames.indexOf(Ce)===-1){if(!he)throw new ct.SubTransaction("Table "+Ce+" not included in parent transaction.");B=null}}),he&&B&&!B.active&&(B=null)}}catch(Ce){return B?B._promise(null,function(De,me){me(Ce)}):Lr(Ce)}var xe=function Ce(De,me,Oe,ke,Pe){return St.resolve().then(function(){var Ie=Ot.transless||Ot,Re=De._createTransaction(me,Oe,De._dbSchema,ke);if(Re.explicit=!0,Ie={trans:Re,transless:Ie},ke)Re.idbtrans=ke.idbtrans;else try{Re.create(),Re.idbtrans._explicit=!0,De._state.PR1398_maxLoop=3}catch(Ye){return Ye.name===Mr.InvalidState&&De.isOpen()&&0<--De._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),De.close({disableAutoOpen:!1}),De.open().then(function(){return Ce(De,me,Oe,null,Pe)})):Lr(Ye)}var Ve,Ge=Tt(Pe);return Ge&&wr(),Ie=St.follow(function(){var Ye;(Ve=Pe.call(Re,Re))&&(Ge?(Ye=dr.bind(null,null),Ve.then(Ye,Ye)):typeof Ve.next=="function"&&typeof Ve.throw=="function"&&(Ve=Ks(Ve)))},Ie),(Ve&&typeof Ve.then=="function"?St.resolve(Ve).then(function(Ye){return Re.active?Ye:Lr(new ct.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):Ie.then(function(){return Ve})).then(function(Ye){return ke&&Re._resolve(),Re._completion.then(function(){return Ye})}).catch(function(Ye){return Re._reject(Ye),Lr(Ye)})})}.bind(null,this,q,te,B,E);return B?B._promise(q,xe,"lock"):Ot.trans?Ur(Ot.transless,function(){return D._whenReady(xe)}):this._whenReady(xe)},fn.prototype.table=function(v){if(!Q(this._allTables,v))throw new ct.InvalidTable("Table ".concat(v," does not exist"));return this._allTables[v]},fn);function fn(v,k){var E=this;this._middlewares={},this.verno=0;var D=fn.dependencies;this._options=k=h({addons:fn.addons,autoOpen:!0,indexedDB:D.indexedDB,IDBKeyRange:D.IDBKeyRange,cache:"cloned"},k),this._deps={indexedDB:k.indexedDB,IDBKeyRange:k.IDBKeyRange},D=k.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var B,q,te,he,xe,Ce={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:wt,dbReadyPromise:null,cancelOpen:wt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:k.autoOpen};Ce.dbReadyPromise=new St(function(me){Ce.dbReadyResolve=me}),Ce.openCanceller=new St(function(me,Oe){Ce.cancelOpen=Oe}),this._state=Ce,this.name=v,this.on=Ja(this,"populate","blocked","versionchange","close",{ready:[pr,wt]}),this.once=function(me,Oe){var ke=function(){for(var Pe=[],Ie=0;Ie<arguments.length;Ie++)Pe[Ie]=arguments[Ie];E.on(me).unsubscribe(ke),Oe.apply(E,Pe)};return E.on(me,ke)},this.on.ready.subscribe=le(this.on.ready.subscribe,function(me){return function(Oe,ke){fn.vip(function(){var Pe,Ie=E._state;Ie.openComplete?(Ie.dbOpenError||St.resolve().then(Oe),ke&&me(Oe)):Ie.onReadyBeingFired?(Ie.onReadyBeingFired.push(Oe),ke&&me(Oe)):(me(Oe),Pe=E,ke||me(function Re(){Pe.on.ready.unsubscribe(Oe),Pe.on.ready.unsubscribe(Re)}))})}}),this.Collection=(B=this,Yi(fo.prototype,function(Ve,Re){this.db=B;var ke=ci,Pe=null;if(Re)try{ke=Re()}catch(Ge){Pe=Ge}var Ie=Ve._ctx,Re=Ie.table,Ve=Re.hook.reading.fire;this._ctx={table:Re,index:Ie.index,isPrimKey:!Ie.index||Re.schema.primKey.keyPath&&Ie.index===Re.schema.primKey.name,range:ke,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:Pe,or:Ie.or,valueMapper:Ve!==Ir?Ve:null}})),this.Table=(q=this,Yi(Oi.prototype,function(me,Oe,ke){this.db=q,this._tx=ke,this.name=me,this.schema=Oe,this.hook=q._allTables[me]?q._allTables[me].hook:Ja(null,{creating:[Ee,wt],reading:[Dr,Ir],updating:[Pr,wt],deleting:[nn,wt]})})),this.Transaction=(te=this,Yi(Nu.prototype,function(me,Oe,ke,Pe,Ie){var Re=this;me!=="readonly"&&Oe.forEach(function(Ve){Ve=(Ve=ke[Ve])===null||Ve===void 0?void 0:Ve.yProps,Ve&&(Oe=Oe.concat(Ve.map(function(Ge){return Ge.updatesTable})))}),this.db=te,this.mode=me,this.storeNames=Oe,this.schema=ke,this.chromeTransactionDurability=Pe,this.idbtrans=null,this.on=Ja(this,"complete","error","abort"),this.parent=Ie||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new St(function(Ve,Ge){Re._resolve=Ve,Re._reject=Ge}),this._completion.then(function(){Re.active=!1,Re.on.complete.fire()},function(Ve){var Ge=Re.active;return Re.active=!1,Re.on.error.fire(Ve),Re.parent?Re.parent._reject(Ve):Ge&&Re.idbtrans&&Re.idbtrans.abort(),Lr(Ve)})})),this.Version=(he=this,Yi(Uu.prototype,function(me){this.db=he,this._cfg={version:me,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(xe=this,Yi(ii.prototype,function(me,Oe,ke){if(this.db=xe,this._ctx={table:me,index:Oe===":id"?null:Oe,or:ke},this._cmp=this._ascending=ir,this._descending=function(Pe,Ie){return ir(Ie,Pe)},this._max=function(Pe,Ie){return 0<ir(Pe,Ie)?Pe:Ie},this._min=function(Pe,Ie){return ir(Pe,Ie)<0?Pe:Ie},this._IDBKeyRange=xe._deps.IDBKeyRange,!this._IDBKeyRange)throw new ct.MissingAPI})),this.on("versionchange",function(me){0<me.newVersion?console.warn("Another connection wants to upgrade database '".concat(E.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(E.name,"'. Closing db now to resume the delete request.")),E.close({disableAutoOpen:!1})}),this.on("blocked",function(me){!me.newVersion||me.newVersion<me.oldVersion?console.warn("Dexie.delete('".concat(E.name,"') was blocked")):console.warn("Upgrade '".concat(E.name,"' blocked by other connection holding version ").concat(me.oldVersion/10))}),this._maxKey=Aa(k.IDBKeyRange),this._createTransaction=function(me,Oe,ke,Pe){return new E.Transaction(me,Oe,ke,E._options.chromeTransactionDurability,Pe)},this._fireOnBlocked=function(me){E.on("blocked").fire(me),Za.filter(function(Oe){return Oe.name===E.name&&Oe!==E&&!Oe._state.vcFired}).map(function(Oe){return Oe.on("versionchange").fire(me)})},this.use(vr),this.use(Ni),this.use($r),this.use(ws),this.use(gn);var De=new Proxy(this,{get:function(me,Oe,ke){if(Oe==="_vip")return!0;if(Oe==="table")return function(Ie){return Xs(E.table(Ie),De)};var Pe=Reflect.get(me,Oe,ke);return Pe instanceof Oi?Xs(Pe,De):Oe==="tables"?Pe.map(function(Ie){return Xs(Ie,De)}):Oe==="_createTransaction"?function(){return Xs(Pe.apply(this,arguments),De)}:Pe}});this.vip=De,D.forEach(function(me){return me(E)})}var ma,Wn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",ko=(is.prototype.subscribe=function(v,k,E){return this._subscribe(v&&typeof v!="function"?v:{next:v,error:k,complete:E})},is.prototype[Wn]=function(){return this},is);function is(v){this._subscribe=v}try{ma={indexedDB:w.indexedDB||w.mozIndexedDB||w.webkitIndexedDB||w.msIndexedDB,IDBKeyRange:w.IDBKeyRange||w.webkitIDBKeyRange}}catch{ma={indexedDB:null,IDBKeyRange:null}}function Ys(v){var k,E=!1,D=new ko(function(B){var q=Tt(v),te,he=!1,xe={},Ce={},De={get closed(){return he},unsubscribe:function(){he||(he=!0,te&&te.abort(),me&&ts.storagemutated.unsubscribe(ke))}};B.start&&B.start(De);var me=!1,Oe=function(){return Dn(Pe)},ke=function(Ie){xo(xe,Ie),Jo(Ce,xe)&&Oe()},Pe=function(){var Ie,Re,Ve;!he&&ma.indexedDB&&(xe={},Ie={},te&&te.abort(),te=new AbortController,Ve=function(Ge){var Ye=ye();try{q&&wr();var et=nr(v,Ge);return et=q?et.finally(dr):et}finally{Ye&&Se()}}(Re={subscr:Ie,signal:te.signal,requery:Oe,querier:v,trans:null}),Promise.resolve(Ve).then(function(Ge){E=!0,k=Ge,he||Re.signal.aborted||(xe={},function(Ye){for(var et in Ye)if(Q(Ye,et))return;return 1}(Ce=Ie)||me||(ts(Vs,ke),me=!0),Dn(function(){return!he&&B.next&&B.next(Ge)}))},function(Ge){E=!1,["DatabaseClosedError","AbortError"].includes(Ge?.name)||he||Dn(function(){he||B.error&&B.error(Ge)})}))};return setTimeout(Oe,0),De});return D.hasValue=function(){return E},D.getValue=function(){return k},D}var ga=Qi;function as(v){var k=La;try{La=!0,ts.storagemutated.fire(v),bo(v,!0)}finally{La=k}}H(ga,h(h({},Nt),{delete:function(v){return new ga(v,{addons:[]}).delete()},exists:function(v){return new ga(v,{addons:[]}).open().then(function(k){return k.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(v){try{return k=ga.dependencies,E=k.indexedDB,k=k.IDBKeyRange,(Ma(E)?Promise.resolve(E.databases()).then(function(D){return D.map(function(B){return B.name}).filter(function(B){return B!==Hn})}):Zo(E,k).toCollection().primaryKeys()).then(v)}catch{return Lr(new ct.MissingAPI)}var k,E},defineClass:function(){return function(v){V(this,v)}},ignoreTransaction:function(v){return Ot.trans?Ur(Ot.transless,v):v()},vip:Xo,async:function(v){return function(){try{var k=Ks(v.apply(this,arguments));return k&&typeof k.then=="function"?k:St.resolve(k)}catch(E){return Lr(E)}}},spawn:function(v,k,E){try{var D=Ks(v.apply(E,k||[]));return D&&typeof D.then=="function"?D:St.resolve(D)}catch(B){return Lr(B)}},currentTransaction:{get:function(){return Ot.trans||null}},waitFor:function(v,k){return k=St.resolve(typeof v=="function"?ga.ignoreTransaction(v):v).timeout(k||6e4),Ot.trans?Ot.trans.waitFor(k):k},Promise:St,debug:{get:function(){return _n},set:function(v){Sn(v)}},derive:be,extend:V,props:H,override:le,Events:Ja,on:ts,liveQuery:Ys,extendObservabilitySet:xo,getByKeyPath:He,setByKeyPath:Xe,delByKeyPath:function(v,k){typeof k=="string"?Xe(v,k,void 0):"length"in k&&[].map.call(k,function(E){Xe(v,E,void 0)})},shallowClone:fe,deepClone:Bt,getObjectDiff:wo,cmp:ir,asap:Ze,minKey:-1/0,addons:[],connections:Za,errnames:Mr,dependencies:ma,cache:za,semVer:"4.2.1",version:"4.2.1".split(".").map(function(v){return parseInt(v)}).reduce(function(v,k,E){return v+k/Math.pow(10,2*E)})})),ga.maxKey=Aa(ga.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(ts(Vs,function(v){La||(v=new CustomEvent(es,{detail:v}),La=!0,dispatchEvent(v),La=!1)}),addEventListener(es,function(v){v=v.detail,La||as(v)}));var ea,La=!1,rl=function(){};return typeof BroadcastChannel<"u"&&((rl=function(){(ea=new BroadcastChannel(es)).onmessage=function(v){return v.data&&as(v.data)}})(),typeof ea.unref=="function"&&ea.unref(),ts(Vs,function(v){La||ea.postMessage(v)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(v){if(!Qi.disableBfCache&&v.persisted){_n&&console.debug("Dexie: handling persisted pagehide"),ea?.close();for(var k=0,E=Za;k<E.length;k++)E[k].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(v){!Qi.disableBfCache&&v.persisted&&(_n&&console.debug("Dexie: handling persisted pageshow"),rl(),as({all:new $n(-1/0,[[]])}))})),St.rejectionMapper=function(v,k){return!v||v instanceof zt||v instanceof TypeError||v instanceof SyntaxError||!v.name||!Ht[v.name]?v:(k=new Ht[v.name](k||v.message,v),"stack"in v&&Be(k,"stack",{get:function(){return this.inner.stack}}),k)},Sn(_n),h(Qi,Object.freeze({__proto__:null,Dexie:Qi,liveQuery:Ys,Entity:Xa,cmp:ir,PropModification:Ya,replacePrefix:function(v,k){return new Ya({replacePrefix:[v,k]})},add:function(v){return new Ya({add:v})},remove:function(v){return new Ya({remove:v})},default:Qi,RangeSet:$n,mergeRanges:_o,rangesOverlap:vo}),{default:Qi}),Qi})})(ow);var pT=ow.exports;const py=vf(pT),vx=Symbol.for("Dexie"),pf=globalThis[vx]||(globalThis[vx]=py);if(py.semVer!==pf.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${py.semVer} and ${pf.semVer}`);const{liveQuery:fT,mergeRanges:pI,rangesOverlap:fI,RangeSet:mI,cmp:gI,Entity:yI,PropModification:_I,replacePrefix:vI,add:xI,remove:bI,DexieYProvider:wI}=pf;class mT extends pf{observations;images;datasets;_isOpen=!1;_openError=null;_initPromise=null;constructor(){super("WGFieldValidator"),this.version(1).stores({observations:"id, timestamp, userValidation, [location.lat+location.lon]",images:"id, createdAt",datasets:"id, layerId, updatedAt"}),this._initPromise=this.initDatabase()}async initDatabase(){try{return await this.open(),this._isOpen=!0,console.log("Database opened successfully"),!0}catch(r){console.warn("IndexedDB failed to open, attempting recovery:",r);try{return await this.delete(),await this.open(),this._isOpen=!0,console.log("Database recovered successfully"),!0}catch(o){return console.error("Database recovery failed:",o),this._openError=o,!1}}}async ensureOpen(){return this._initPromise?this._initPromise:this._isOpen&&!this._openError}get isAvailable(){return this._isOpen&&!this._openError}}const ms=new mT,xx=ms.ensureOpen();async function gT(n,r){await ms.ensureOpen()&&await ms.datasets.put({id:n,layerId:n,data:r,updatedAt:new Date().toISOString()})}async function yT(n){return await ms.ensureOpen()?(await ms.datasets.get(n))?.data:void 0}async function _T(n){const r=n.map(o=>({type:"Feature",geometry:{type:"Point",coordinates:[o.location.lon,o.location.lat]},properties:{id:o.id,timestamp:o.timestamp,validation:o.userValidation,notes:o.notes,accuracy_m:o.location.accuracy,...Object.entries(o.datasetValues).reduce((h,[y,w])=>(Object.entries(w).forEach(([x,c])=>{h[`${y}_${x}`]=c}),h),{})}}));return JSON.stringify({type:"FeatureCollection",features:r},null,2)}async function vT(n){if(n.length===0)return"";const r=new Set;n.forEach(y=>{Object.entries(y.datasetValues).forEach(([w,x])=>{Object.keys(x).forEach(c=>{r.add(`${w}_${c}`)})})});const o=["id","timestamp","lat","lon","accuracy_m","validation","notes",...Array.from(r)],h=n.map(y=>{const w={};return Object.entries(y.datasetValues).forEach(([x,c])=>{Object.entries(c).forEach(([V,G])=>{w[`${x}_${V}`]=String(G??"")})}),[y.id,y.timestamp,y.location.lat,y.location.lon,y.location.accuracy,y.userValidation,`"${y.notes.replace(/"/g,'""')}"`,...Array.from(r).map(x=>w[x]??"")].join(",")});return[o.join(","),...h].join(`
`)}const xT={region:"Western Ghats",generated:new Date().toISOString(),version:"1.0.0",layers:[{id:"western_ghats_boundary",title:"Western Ghats Boundary",type:"vector",source:{format:"geojson",path:"/data/boundaries/western_ghats_boundary.geojson"},style:{kind:"polygon",colors:{default:"#4a9eff33"}},query:{mode:"feature_at_point",fields:["REC_NUM","DATA_VALUE"]},category:"boundary",enabled:!0},{id:"dakshina_kannada_boundary",title:"Dakshina Kannada District",type:"vector",source:{format:"geojson",path:"/data/boundaries/dakshina_kannada_boundary.geojson"},style:{kind:"polygon",colors:{default:"#ff9800aa"}},query:{mode:"feature_at_point",fields:[]},category:"boundary",enabled:!0},{id:"lulc_glc_composition",title:"LULC Composition (GLC 1987-2010)",type:"csv",source:{format:"csv",path:"/data/lulc/dakshina_kannada_lulc_glc_composition.csv"},style:{kind:"categorical",field:"class_name"},query:{mode:"summary",fields:["year","class_code","class_name","area_km2","percent"]},category:"lulc",enabled:!0},{id:"tree_cover_glc",title:"Tree Cover (GLC)",type:"csv",source:{format:"csv",path:"/data/lulc/dakshina_kannada_tree_cover_glc.csv"},style:{kind:"choropleth",field:"tree_cover_pct"},query:{mode:"summary",fields:["year","tree_cover_km2","tree_cover_pct"]},category:"lulc",enabled:!0},{id:"built_area_glc",title:"Built Area (GLC)",type:"csv",source:{format:"csv",path:"/data/lulc/dakshina_kannada_built_glc.csv"},style:{kind:"choropleth",field:"built_pct"},query:{mode:"summary",fields:["year","built_km2","built_pct"]},category:"lulc",enabled:!0},{id:"built_area_dw",title:"Built Area (Dynamic World 2018-2025)",type:"csv",source:{format:"csv",path:"/data/lulc/dakshina_kannada_built_dynamic_world.csv"},style:{kind:"choropleth",field:"built_pct"},query:{mode:"summary",fields:["year","built_km2","built_pct"]},category:"lulc",enabled:!0},{id:"forest_typology",title:"Forest Typology",type:"csv",source:{format:"csv",path:"/data/forest/dakshina_kannada_forest_typology.csv"},style:{kind:"categorical",field:"forest_type"},query:{mode:"summary",fields:["forest_type","area_km2","percent"]},category:"forest",enabled:!0},{id:"corestack_blocks",title:"CoreStack Blocks",type:"csv",source:{format:"csv",path:"/data/corestack/dakshina_kannada_corestack_blocks.csv"},style:{kind:"point"},query:{mode:"feature_at_point",fields:["block_id","block_name","district"]},category:"corestack",enabled:!0},{id:"cropping_intensity",title:"Cropping Intensity Analysis",type:"csv",source:{format:"csv",path:"/data/corestack/cropping_intensity_analysis.csv"},style:{kind:"choropleth",field:"cropping_intensity_avg"},query:{mode:"summary",fields:["grid_id","mws_id","district","cropping_intensity_avg","cropping_intensity_trend"]},category:"corestack",enabled:!0},{id:"water_balance",title:"Water Balance Summary",type:"csv",source:{format:"csv",path:"/data/corestack/water_balance_summary.csv"},style:{kind:"choropleth",field:"balance"},query:{mode:"summary",fields:["watershed_id","precipitation","runoff","balance"]},category:"corestack",enabled:!0},{id:"district_coverage",title:"WG District Coverage (CoreStack)",type:"csv",source:{format:"csv",path:"/data/coverage/wg_district_coverage.csv"},style:{kind:"categorical",field:"corestack_covered"},query:{mode:"summary",fields:["state","district","corestack_covered"]},category:"corestack",enabled:!0},{id:"district_urbanization",title:"District Urbanization Analysis",type:"csv",source:{format:"csv",path:"/data/analysis/district_urbanization_analysis.csv"},style:{kind:"choropleth",field:"urbanization_rate"},query:{mode:"summary",fields:["district","state","urbanization_rate","change_pct"]},category:"other",enabled:!0},{id:"regional_forest_comparison",title:"Regional Forest Comparison",type:"csv",source:{format:"csv",path:"/data/forest/regional_forest_comparison.csv"},style:{kind:"choropleth",field:"forest_cover_pct"},query:{mode:"summary",fields:["region","forest_cover_pct","change_pct"]},category:"forest",enabled:!0}],basemaps:[{id:"dark",type:"vector",title:"Dark Map",offline:!0,source:"dark_style"},{id:"satellite",type:"raster",title:"Satellite",offline:!1,source:"satellite_style"}]};class lw{manifest;loadedData=new Map;geojsonLayers=new Map;constructor(){this.manifest=xT}async initialize(){try{const r=await fetch("/data/dataset-manifest.json");r.ok&&(this.manifest=await r.json())}catch{console.log("Using default manifest")}await this.preloadLayers()}async preloadLayers(){const r=this.manifest.layers.filter(o=>o.enabled);await Promise.all(r.map(async o=>{try{const h=await yT(o.id);if(h){this.loadedData.set(o.id,h),o.source.format==="geojson"&&this.geojsonLayers.set(o.id,h);return}const y=await this.loadLayer(o);y&&(this.loadedData.set(o.id,y),await gT(o.id,y),o.source.format==="geojson"&&this.geojsonLayers.set(o.id,y))}catch(h){console.warn(`Failed to load layer ${o.id}:`,h)}}))}async loadLayer(r){const o=await fetch(r.source.path);if(!o.ok)throw new Error(`Failed to fetch ${r.source.path}`);switch(r.source.format){case"geojson":return await o.json();case"csv":const h=await o.text();return dT.parse(h,{header:!0,dynamicTyping:!0,skipEmptyLines:!0}).data;default:return await o.json()}}getLayers(){return this.manifest.layers}getEnabledLayers(){return this.manifest.layers.filter(r=>r.enabled)}getLayerById(r){return this.manifest.layers.find(o=>o.id===r)}getLayerData(r){return this.loadedData.get(r)}getGeoJSONLayer(r){return this.geojsonLayers.get(r)}async getValuesAtPoint(r,o,h){const y={},w=sT([o,r]);for(const x of h){const c=this.getLayerById(x);if(!c)continue;const V=this.loadedData.get(x);if(V){if(y[x]={},c.source.format==="geojson"&&this.geojsonLayers.has(x)){const G=this.geojsonLayers.get(x);for(const Y of G.features)if((Y.geometry.type==="Polygon"||Y.geometry.type==="MultiPolygon")&&uT(w,Y)){if(c.query?.fields)for(const Q of c.query.fields)y[x][Q]=Y.properties?.[Q];else y[x]={...Y.properties};break}}if(c.source.format==="csv"&&Array.isArray(V)){const G=V;if(G.length>0){const Y=new Set(G.map(H=>H.year).filter(H=>H!==void 0)),Q=Array.from(Y).sort((H,Le)=>Le-H);if(Q.length>0){const H=Q[0],Le=G.filter(Be=>Be.year===H);y[x]={_source:"csv_summary",_year:H,_recordCount:Le.length,_sample:Le.slice(0,3)}}else y[x]={_source:"csv_summary",_recordCount:G.length,_sample:G.slice(0,3)}}}}}return y}async getSummaryAtPoint(r,o,h){const y={coordinates:{lat:r,lon:o},layers:{}},w=await this.getValuesAtPoint(r,o,h);for(const[x,c]of Object.entries(w)){const V=this.getLayerById(x);V&&(y.layers[x]={title:V.title,values:c})}return y.context={region:this.manifest.region,queriedAt:new Date().toISOString()},y}getLayerStats(r){const o=this.loadedData.get(r);if(!o||!Array.isArray(o))return null;const h=o;if(h.length===0)return null;const y=Object.keys(h[0]),w={recordCount:h.length,columns:y};if("year"in h[0]){const x=[...new Set(h.map(c=>c.year))].sort();w.years=x,w.yearRange={min:x[0],max:x[x.length-1]}}return w}}const bT="https://api-doc.core-stack.org/api/v1";class p_{apiKey=null;isOnline=navigator.onLine;static DEFAULT_API_KEY="x0bXxURa.B9Qgfxd0aKxxJ8GIDHA5FCSIAc52hFgg";constructor(){this.apiKey=localStorage.getItem("corestack_api_key")||p_.DEFAULT_API_KEY,window.addEventListener("online",()=>this.isOnline=!0),window.addEventListener("offline",()=>this.isOnline=!1)}setApiKey(r){this.apiKey=r,localStorage.setItem("corestack_api_key",r)}hasApiKey(){return!!this.apiKey}isAvailable(){return this.isOnline&&this.hasApiKey()}async request(r,o={}){if(!this.isOnline)throw new Error("Offline - cannot access CoreStack API");if(!this.apiKey)throw new Error("API key not configured");const h=new URL(`${bT}${r}`);Object.entries(o).forEach(([w,x])=>{h.searchParams.set(w,x)});const y=await fetch(h.toString(),{method:"GET",headers:{Accept:"application/json","X-API-Key":this.apiKey}});if(!y.ok){const w=await y.json().catch(()=>({message:y.statusText}));throw new Error(w.message||`API error: ${y.status}`)}return y.json()}async getAdminDetailsByLatLon(r,o){return this.request("/get_admin_details_by_latlon/",{lat:r.toString(),lon:o.toString()})}async getMWSIdByLatLon(r,o){return this.request("/get_mwsid_by_latlon/",{lat:r.toString(),lon:o.toString()})}async getMWSData(r,o,h){const y={mws_id:r};return o&&(y.start_date=o),h&&(y.end_date=h),this.request("/get_mws_data/",y)}async getMWSKYLIndicators(r){return this.request("/get_mws_kyl_indicators/",{mws_id:r})}async getMWSReportUrl(r){return this.request("/get_mws_report/",{mws_id:r})}async getLayerUrls(r,o,h){const y={};return r&&(y.state_code=r),o&&(y.district_code=o),h&&(y.tehsil_code=h),this.request("/get_generated_layer_urls/",y)}async getTehsilData(r){return this.request("/get_tehsil_data/",{tehsil_code:r})}async getWaterbodiesByAdmin(r,o,h){const y={};return r&&(y.state_code=r),o&&(y.district_code=o),h&&(y.tehsil_code=h),this.request("/get_waterbodies_data_by_admin/",y)}async getWaterbodyData(r){return this.request("/get_waterbody_data/",{uid:r})}async getActiveLocations(){return this.request("/get_active_locations/")}async enrichLocation(r,o){if(!this.isAvailable())return{error:"CoreStack API not available"};try{const h=await this.getAdminDetailsByLatLon(r,o);let y,w;try{y=(await this.getMWSIdByLatLon(r,o)).mws_id,y&&(w=await this.getMWSKYLIndicators(y))}catch{}let x;if(h.state_code&&h.district_code)try{x=await this.getLayerUrls(h.state_code,h.district_code)}catch{}let c;if(h.district_code)try{c=await this.getWaterbodiesByAdmin(h.state_code,h.district_code,h.tehsil_code)}catch{}return{admin:h,mwsId:y,indicators:w,layerUrls:x,waterbodies:c}}catch(h){return{error:h instanceof Error?h.message:"Unknown error"}}}}const id=new p_;class wT{cachedData=[];isOnline=navigator.onLine;dataLoaded=!1;constructor(){window.addEventListener("online",()=>this.isOnline=!0),window.addEventListener("offline",()=>this.isOnline=!1)}async loadCachedData(){if(!this.dataLoaded)try{const r=await fetch("/data/dynamicworld/wg_dynamic_world_2018_2025.csv");if(!r.ok){console.warn("Dynamic World data not found locally");return}const h=(await r.text()).trim().split(`
`);this.cachedData=h.slice(1).map(y=>{const w=y.split(",");return{year:parseInt(w[0]),month:w[2],water:parseFloat(w[3]),trees:parseFloat(w[4]),grass:parseFloat(w[5]),floodedVegetation:parseFloat(w[6]),crops:parseFloat(w[7]),shrubAndScrub:parseFloat(w[8]),built:parseFloat(w[9]),bare:parseFloat(w[10]),snowAndIce:parseFloat(w[11])}}),this.dataLoaded=!0,console.log(`Loaded ${this.cachedData.length} Dynamic World records`)}catch(r){console.error("Failed to load Dynamic World data:",r)}}getRegionalStats(r){return!this.dataLoaded||this.cachedData.length===0?null:r?this.cachedData.find(o=>o.year===r)||null:this.cachedData[this.cachedData.length-1]}getAvailableYears(){return this.cachedData.map(r=>r.year)}getTimeSeries(r){return this.cachedData.map(o=>({year:o.year,value:o[r]}))}getChangeStats(r,o){const h=this.cachedData.find(c=>c.year===r),y=this.cachedData.find(c=>c.year===o);if(!h||!y)return null;const w=["water","trees","grass","floodedVegetation","crops","shrubAndScrub","built","bare","snowAndIce"],x={};for(const c of w){const V=h[c],G=y[c];x[c]={start:V,end:G,change:G-V,percentChange:(G-V)/V*100}}return x}async fetchPointData(r,o,h){if(!this.isOnline)return console.warn("Cannot fetch Dynamic World point data: offline"),null;const y=this.getRegionalStats();if(!y)return null;const w={Water:y.water,Trees:y.trees,Grass:y.grass,"Flooded Vegetation":y.floodedVegetation,Crops:y.crops,"Shrub and Scrub":y.shrubAndScrub,Built:y.built,Bare:y.bare,"Snow and Ice":y.snowAndIce},x=Object.values(w).reduce((Y,Q)=>Y+Q,0),c={};let V="Trees",G=0;for(const[Y,Q]of Object.entries(w)){const H=Q/x;c[Y]=H,H>G&&(G=H,V=Y)}return{lat:r,lon:o,timestamp:h||new Date().toISOString(),landCoverClass:V,confidence:G,probabilities:c}}getSummaryForLocation(){const r=this.getRegionalStats();if(!r)return{status:"No Dynamic World data available"};const o=this.getChangeStats(2018,r.year);return{source:"Dynamic World (Google)",year:r.year,month:r.month,landCover:{trees:`${r.trees.toFixed(1)} km`,crops:`${r.crops.toFixed(1)} km`,built:`${r.built.toFixed(1)} km`,shrubAndScrub:`${r.shrubAndScrub.toFixed(1)} km`},changesSince2018:o?{trees:`${o.trees.percentChange>0?"+":""}${o.trees.percentChange.toFixed(1)}%`,built:`${o.built.percentChange>0?"+":""}${o.built.percentChange.toFixed(1)}%`,crops:`${o.crops.percentChange>0?"+":""}${o.crops.percentChange.toFixed(1)}%`}:null}}}const Bp=new wT,bx={0:"Clear sky",1:"Mainly clear",2:"Partly cloudy",3:"Overcast",45:"Fog",48:"Depositing rime fog",51:"Light drizzle",53:"Moderate drizzle",55:"Dense drizzle",61:"Slight rain",63:"Moderate rain",65:"Heavy rain",66:"Light freezing rain",67:"Heavy freezing rain",71:"Slight snow",73:"Moderate snow",75:"Heavy snow",80:"Slight rain showers",81:"Moderate rain showers",82:"Violent rain showers",85:"Slight snow showers",86:"Heavy snow showers",95:"Thunderstorm",96:"Thunderstorm with slight hail",99:"Thunderstorm with heavy hail"};class ST{baseUrl="https://api.open-meteo.com/v1/forecast";isOnline=navigator.onLine;cache=new Map;cacheDuration=30*60*1e3;constructor(){window.addEventListener("online",()=>this.isOnline=!0),window.addEventListener("offline",()=>this.isOnline=!1)}isAvailable(){return this.isOnline}async getWeather(r,o){if(!this.isOnline)return null;const h=`${r.toFixed(3)},${o.toFixed(3)}`,y=this.cache.get(h);if(y&&y.expiry>Date.now())return y.data;try{const w=new URLSearchParams({latitude:r.toString(),longitude:o.toString(),current:"temperature_2m,relative_humidity_2m,precipitation,weather_code,wind_speed_10m,wind_direction_10m,is_day",daily:"weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max",timezone:"Asia/Kolkata",forecast_days:"5"}),x=await fetch(`${this.baseUrl}?${w}`);if(!x.ok)throw new Error("Weather API request failed");const c=await x.json(),V={temperature:c.current.temperature_2m,humidity:c.current.relative_humidity_2m,precipitation:c.current.precipitation,windSpeed:c.current.wind_speed_10m,windDirection:c.current.wind_direction_10m,weatherCode:c.current.weather_code,weatherDescription:bx[c.current.weather_code]||"Unknown",isDay:c.current.is_day===1},G=c.daily.time.map((Q,H)=>({date:Q,tempMax:c.daily.temperature_2m_max[H],tempMin:c.daily.temperature_2m_min[H],precipitation:c.daily.precipitation_sum[H],precipitationProbability:c.daily.precipitation_probability_max[H],weatherCode:c.daily.weather_code[H],weatherDescription:bx[c.daily.weather_code[H]]||"Unknown"})),Y={current:V,forecast:G,fetchedAt:new Date().toISOString()};return this.cache.set(h,{data:Y,expiry:Date.now()+this.cacheDuration}),Y}catch(w){return console.error("Weather fetch failed:",w),null}}getWeatherIcon(r,o){return r===0||r===1?o?"":"":r===2?o?"":"":r===3?"":r===45||r===48?"":r>=51&&r<=55||r>=61&&r<=67?"":r>=71&&r<=77?"":r>=80&&r<=82?"":r>=85&&r<=86?"":r>=95?"":""}}const Np=new ST,hg=new lw,kT=({location:n,isOnline:r,onClose:o})=>{const[h,y]=st.useState({local:{title:"Local Data",icon:"",status:"loading",data:null},dynamicWorld:{title:"Dynamic World (LULC)",icon:"",status:"loading",data:null},corestack:{title:"CoreStack (Watershed)",icon:"",status:"loading",data:null},weather:{title:"Weather",icon:"",status:"loading",data:null}}),[w,x]=st.useState(null),[c,V]=st.useState(new Set(["local"]));st.useEffect(()=>{(async()=>{try{await hg.initialize();const re=hg.getLayers().map(le=>le.id),J=await hg.getSummaryAtPoint(n.lat,n.lon,re);y(le=>({...le,local:{...le.local,status:"loaded",data:J}}))}catch($e){console.error("Local data error:",$e),y(re=>({...re,local:{...re.local,status:"error",data:null}}))}try{await Bp.loadCachedData();const $e=new Date().getFullYear(),re=Bp.getRegionalStats($e)||Bp.getRegionalStats();y(re?J=>({...J,dynamicWorld:{...J.dynamicWorld,status:"loaded",data:{year:re.year,"Trees (%)":re.trees?.toFixed(1),"Crops (%)":re.crops?.toFixed(1),"Built (%)":re.built?.toFixed(1),"Shrub & Scrub (%)":re.shrubAndScrub?.toFixed(1),"Water (%)":re.water?.toFixed(1),"Grass (%)":re.grass?.toFixed(1)}}}):J=>({...J,dynamicWorld:{...J.dynamicWorld,status:"error",data:null}}))}catch($e){console.error("Dynamic World error:",$e),y(re=>({...re,dynamicWorld:{...re.dynamicWorld,status:"error",data:null}}))}if(r&&id.hasApiKey())try{const $e=await id.enrichLocation(n.lat,n.lon);if($e&&!$e.error)y(re=>({...re,corestack:{...re.corestack,status:"loaded",data:{State:$e.admin?.state_name,District:$e.admin?.district_name,Tehsil:$e.admin?.tehsil_name,"MWS ID":$e.mwsId,...$e.indicators||{}}}}));else throw new Error($e?.error||"No data")}catch($e){console.error("CoreStack error:",$e),y(re=>({...re,corestack:{...re.corestack,status:id.hasApiKey()?"error":"offline",data:null}}))}else y($e=>({...$e,corestack:{...$e.corestack,status:"offline",data:{note:r?"API key required - configure in settings":"Requires internet connection"}}}));if(r)try{const $e=await Np.getWeather(n.lat,n.lon);if($e)x($e),y(re=>({...re,weather:{...re.weather,status:"loaded",data:{Temperature:`${$e.current.temperature}C`,Humidity:`${$e.current.humidity}%`,Conditions:$e.current.weatherDescription,Wind:`${$e.current.windSpeed} km/h`,Precipitation:`${$e.current.precipitation} mm`}}}));else throw new Error("No weather data")}catch($e){console.error("Weather error:",$e),y(re=>({...re,weather:{...re.weather,status:"error",data:null}}))}else y($e=>({...$e,weather:{...$e.weather,status:"offline",data:null}}))})()},[n,r]);const G=be=>{V($e=>{const re=new Set($e);return re.has(be)?re.delete(be):re.add(be),re})},Y=be=>{switch(be){case"loading":return O.jsx("span",{className:"status-badge loading",children:"Loading..."});case"loaded":return O.jsx("span",{className:"status-badge success",children:" Available"});case"error":return O.jsx("span",{className:"status-badge error",children:" Error"});case"offline":return O.jsx("span",{className:"status-badge offline",children:" Online Only"})}},Q=(be,$e)=>be?$e==="local"?O.jsx("div",{className:"data-grid local-data",children:Object.entries(be).map(([re,J])=>typeof J=="object"&&J!==null?O.jsxs("div",{className:"layer-data",children:[O.jsx("h4",{children:H(re)}),O.jsx("div",{className:"layer-values",children:Object.entries(J).map(([le,we])=>O.jsxs("div",{className:"data-row",children:[O.jsx("span",{className:"data-label",children:Le(le)}),O.jsx("span",{className:"data-value",children:Be(we)})]},le))})]},re):O.jsxs("div",{className:"data-row",children:[O.jsx("span",{className:"data-label",children:Le(re)}),O.jsx("span",{className:"data-value",children:Be(J)})]},re))}):O.jsx("div",{className:"data-grid",children:Object.entries(be).map(([re,J])=>O.jsxs("div",{className:"data-row",children:[O.jsx("span",{className:"data-label",children:Le(re)}),O.jsx("span",{className:"data-value",children:Be(J)})]},re))}):O.jsx("p",{className:"no-data",children:"No data available"}),H=be=>be.replace(/_/g," ").split(" ").map($e=>$e.charAt(0).toUpperCase()+$e.slice(1)).join(" "),Le=be=>be.replace(/_/g," ").split(" ").map($e=>$e.charAt(0).toUpperCase()+$e.slice(1)).join(" "),Be=be=>{if(be==null)return"-";if(typeof be=="number")return Number.isInteger(be)?be.toString():be.toFixed(2);if(Array.isArray(be))return be.map($e=>Be($e)).join(", ");if(typeof be=="object"){const $e=be,re=Object.keys($e);return re.length===1?Be($e[re[0]]):re.length<=3?re.map(J=>`${J}: ${Be($e[J])}`).join(", "):`${re.length} items`}return String(be)};return O.jsxs("div",{className:"location-info-panel",children:[O.jsxs("div",{className:"panel-header",children:[O.jsxs("div",{className:"header-content",children:[O.jsx("h2",{children:" Location Information"}),O.jsxs("p",{className:"coords",children:[n.lat.toFixed(6),", ",n.lon.toFixed(6),n.accuracy&&` (${n.accuracy.toFixed(0)}m)`]})]}),O.jsx("button",{className:"close-btn",onClick:o,children:""})]}),w&&O.jsxs("div",{className:"weather-card",children:[O.jsxs("div",{className:"weather-current",children:[O.jsx("span",{className:"weather-icon",children:Np.getWeatherIcon(w.current.weatherCode,w.current.isDay)}),O.jsxs("div",{className:"weather-temp",children:[O.jsxs("span",{className:"temp-value",children:[w.current.temperature,"C"]}),O.jsx("span",{className:"temp-desc",children:w.current.weatherDescription})]})]}),O.jsxs("div",{className:"weather-details",children:[O.jsxs("span",{children:[" ",w.current.humidity,"%"]}),O.jsxs("span",{children:[" ",w.current.windSpeed," km/h"]}),O.jsxs("span",{children:[" ",w.current.precipitation," mm"]})]}),w.forecast.length>0&&O.jsx("div",{className:"weather-forecast",children:w.forecast.slice(0,3).map((be,$e)=>O.jsxs("div",{className:"forecast-day",children:[O.jsx("span",{className:"forecast-date",children:new Date(be.date).toLocaleDateString("en-IN",{weekday:"short"})}),O.jsx("span",{className:"forecast-icon",children:Np.getWeatherIcon(be.weatherCode,!0)}),O.jsxs("span",{className:"forecast-temp",children:[be.tempMax.toFixed(0),"/",be.tempMin.toFixed(0),""]})]},$e))})]}),O.jsx("div",{className:"data-sections",children:Object.entries(h).map(([be,$e])=>O.jsxs("div",{className:`data-section ${c.has(be)?"expanded":""}`,children:[O.jsxs("button",{className:"section-header",onClick:()=>G(be),children:[O.jsx("span",{className:"section-icon",children:$e.icon}),O.jsx("span",{className:"section-title",children:$e.title}),Y($e.status),O.jsx("span",{className:"expand-icon",children:c.has(be)?"":""})]}),c.has(be)&&O.jsx("div",{className:"section-content",children:$e.status==="loading"?O.jsx("div",{className:"loading-spinner",children:"Loading data..."}):Q($e.data,be)})]},be))}),O.jsxs("div",{className:"panel-actions",children:[!r&&O.jsx("div",{className:"offline-notice",children:" Offline - Some data sources unavailable"}),O.jsx("button",{className:"action-btn primary",onClick:()=>{const be=`Location: ${n.lat.toFixed(6)}, ${n.lon.toFixed(6)}
`+Object.entries(h).filter(([$e,re])=>re.data).map(([$e,re])=>`
${re.title}:
${JSON.stringify(re.data,null,2)}`).join(`
`);navigator.clipboard.writeText(be),alert("Location data copied to clipboard!")},children:" Copy All Data"})]})]})};let wp;const CT=new Uint8Array(16);function TT(){if(!wp&&(wp=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!wp))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return wp(CT)}const Ei=[];for(let n=0;n<256;++n)Ei.push((n+256).toString(16).slice(1));function IT(n,r=0){return Ei[n[r+0]]+Ei[n[r+1]]+Ei[n[r+2]]+Ei[n[r+3]]+"-"+Ei[n[r+4]]+Ei[n[r+5]]+"-"+Ei[n[r+6]]+Ei[n[r+7]]+"-"+Ei[n[r+8]]+Ei[n[r+9]]+"-"+Ei[n[r+10]]+Ei[n[r+11]]+Ei[n[r+12]]+Ei[n[r+13]]+Ei[n[r+14]]+Ei[n[r+15]]}const PT=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),wx={randomUUID:PT};function uw(n,r,o){if(wx.randomUUID&&!n)return wx.randomUUID();n=n||{};const h=n.random||(n.rng||TT)();return h[6]=h[6]&15|64,h[8]=h[8]&63|128,IT(h)}var Of=typeof self<"u"?self:global;const Sd=typeof navigator<"u",ET=Sd&&typeof HTMLImageElement>"u",ff=!(typeof global>"u"||typeof process>"u"||!process.versions||!process.versions.node),Ff=Of.Buffer,Sp=Of.BigInt,Bf=!!Ff,AT=n=>n;function mf(n,r=AT){if(ff)try{return typeof require=="function"?Promise.resolve(r(require(n))):import(n).then(r)}catch{console.warn(`Couldn't load ${n}`)}}let f_=Of.fetch;const MT=n=>f_=n;if(!Of.fetch){const n=mf("http",h=>h),r=mf("https",h=>h),o=(h,{headers:y}={})=>new Promise(async(w,x)=>{let{port:c,hostname:V,pathname:G,protocol:Y,search:Q}=new URL(h);const H={method:"GET",hostname:V,path:encodeURI(G)+Q,headers:y};c!==""&&(H.port=Number(c));const Le=(Y==="https:"?await r:await n).request(H,Be=>{if(Be.statusCode===301||Be.statusCode===302){let be=new URL(Be.headers.location,h).toString();return o(be,{headers:y}).then(w).catch(x)}w({status:Be.statusCode,arrayBuffer:()=>new Promise(be=>{let $e=[];Be.on("data",re=>$e.push(re)),Be.on("end",()=>be(Buffer.concat($e)))})})});Le.on("error",x),Le.end()});MT(o)}function fr(n,r,o){return r in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,n}const gf=n=>cw(n)?void 0:n,DT=n=>n!==void 0;function cw(n){return n===void 0||(n instanceof Map?n.size===0:Object.values(n).filter(DT).length===0)}function ei(n){let r=new Error(n);throw delete r.stack,r}function bu(n){return(n=function(r){for(;r.endsWith("\0");)r=r.slice(0,-1);return r}(n).trim())===""?void 0:n}function fy(n){let r=function(o){let h=0;return o.ifd0.enabled&&(h+=1024),o.exif.enabled&&(h+=2048),o.makerNote&&(h+=2048),o.userComment&&(h+=1024),o.gps.enabled&&(h+=512),o.interop.enabled&&(h+=100),o.ifd1.enabled&&(h+=1024),h+2048}(n);return n.jfif.enabled&&(r+=50),n.xmp.enabled&&(r+=2e4),n.iptc.enabled&&(r+=14e3),n.icc.enabled&&(r+=6e3),r}const my=n=>String.fromCharCode.apply(null,n),Sx=typeof TextDecoder<"u"?new TextDecoder("utf-8"):void 0;function hw(n){return Sx?Sx.decode(n):Bf?Buffer.from(n).toString("utf8"):decodeURIComponent(escape(my(n)))}class ka{static from(r,o){return r instanceof this&&r.le===o?r:new ka(r,void 0,void 0,o)}constructor(r,o=0,h,y){if(typeof y=="boolean"&&(this.le=y),Array.isArray(r)&&(r=new Uint8Array(r)),r===0)this.byteOffset=0,this.byteLength=0;else if(r instanceof ArrayBuffer){h===void 0&&(h=r.byteLength-o);let w=new DataView(r,o,h);this._swapDataView(w)}else if(r instanceof Uint8Array||r instanceof DataView||r instanceof ka){h===void 0&&(h=r.byteLength-o),(o+=r.byteOffset)+h>r.byteOffset+r.byteLength&&ei("Creating view outside of available memory in ArrayBuffer");let w=new DataView(r.buffer,o,h);this._swapDataView(w)}else if(typeof r=="number"){let w=new DataView(new ArrayBuffer(r));this._swapDataView(w)}else ei("Invalid input argument for BufferView: "+r)}_swapArrayBuffer(r){this._swapDataView(new DataView(r))}_swapBuffer(r){this._swapDataView(new DataView(r.buffer,r.byteOffset,r.byteLength))}_swapDataView(r){this.dataView=r,this.buffer=r.buffer,this.byteOffset=r.byteOffset,this.byteLength=r.byteLength}_lengthToEnd(r){return this.byteLength-r}set(r,o,h=ka){return r instanceof DataView||r instanceof ka?r=new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer&&(r=new Uint8Array(r)),r instanceof Uint8Array||ei("BufferView.set(): Invalid data argument."),this.toUint8().set(r,o),new h(this,o,r.byteLength)}subarray(r,o){return o=o||this._lengthToEnd(r),new ka(this,r,o)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(r,o){return new Uint8Array(this.buffer,this.byteOffset+r,o)}getString(r=0,o=this.byteLength){return hw(this.getUint8Array(r,o))}getLatin1String(r=0,o=this.byteLength){let h=this.getUint8Array(r,o);return my(h)}getUnicodeString(r=0,o=this.byteLength){const h=[];for(let y=0;y<o&&r+y<this.byteLength;y+=2)h.push(this.getUint16(r+y));return my(h)}getInt8(r){return this.dataView.getInt8(r)}getUint8(r){return this.dataView.getUint8(r)}getInt16(r,o=this.le){return this.dataView.getInt16(r,o)}getInt32(r,o=this.le){return this.dataView.getInt32(r,o)}getUint16(r,o=this.le){return this.dataView.getUint16(r,o)}getUint32(r,o=this.le){return this.dataView.getUint32(r,o)}getFloat32(r,o=this.le){return this.dataView.getFloat32(r,o)}getFloat64(r,o=this.le){return this.dataView.getFloat64(r,o)}getFloat(r,o=this.le){return this.dataView.getFloat32(r,o)}getDouble(r,o=this.le){return this.dataView.getFloat64(r,o)}getUintBytes(r,o,h){switch(o){case 1:return this.getUint8(r,h);case 2:return this.getUint16(r,h);case 4:return this.getUint32(r,h);case 8:return this.getUint64&&this.getUint64(r,h)}}getUint(r,o,h){switch(o){case 8:return this.getUint8(r,h);case 16:return this.getUint16(r,h);case 32:return this.getUint32(r,h);case 64:return this.getUint64&&this.getUint64(r,h)}}toString(r){return this.dataView.toString(r,this.constructor.name)}ensureChunk(){}}function gy(n,r){ei(`${n} '${r}' was not loaded, try using full build of exifr.`)}class m_ extends Map{constructor(r){super(),this.kind=r}get(r,o){return this.has(r)||gy(this.kind,r),o&&(r in o||function(h,y){ei(`Unknown ${h} '${y}'.`)}(this.kind,r),o[r].enabled||gy(this.kind,r)),super.get(r)}keyList(){return Array.from(this.keys())}}var uo=new m_("file parser"),Jn=new m_("segment parser"),co=new m_("file reader");function zT(n,r){return typeof n=="string"?kx(n,r):Sd&&!ET&&n instanceof HTMLImageElement?kx(n.src,r):n instanceof Uint8Array||n instanceof ArrayBuffer||n instanceof DataView?new ka(n):Sd&&n instanceof Blob?yy(n,r,"blob",Du):void ei("Invalid input argument")}function kx(n,r){return(o=n).startsWith("data:")||o.length>1e4?_y(n,r,"base64"):ff&&n.includes("://")?yy(n,r,"url",Mu):ff?_y(n,r,"fs"):Sd?yy(n,r,"url",Mu):void ei("Invalid input argument");var o}async function yy(n,r,o,h){return co.has(o)?_y(n,r,o):h?async function(y,w){let x=await w(y);return new ka(x)}(n,h):void ei(`Parser ${o} is not loaded`)}async function _y(n,r,o){let h=new(co.get(o))(n,r);return await h.read(),h}const Mu=n=>f_(n).then(r=>r.arrayBuffer()),Du=n=>new Promise((r,o)=>{let h=new FileReader;h.onloadend=()=>r(h.result||new ArrayBuffer),h.onerror=o,h.readAsArrayBuffer(n)});class LT extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}}function Kn(n,r,o){let h=new LT;for(let[y,w]of o)h.set(y,w);if(Array.isArray(r))for(let y of r)n.set(y,h);else n.set(r,h);return h}function zu(n,r,o){let h,y=n.get(r);for(h of o)y.set(h[0],h[1])}const bi=new Map,Fs=new Map,Nl=new Map,Il=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],Wc=["jfif","xmp","icc","iptc","ihdr"],Lu=["tiff",...Wc],Un=["ifd0","ifd1","exif","gps","interop"],Pl=[...Lu,...Un],El=["makerNote","userComment"],Zc=["translateKeys","translateValues","reviveValues","multiSegment"],Al=[...Zc,"sanitize","mergeOutput","silentErrors"];class dw{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class Vh extends dw{get needed(){return this.enabled||this.deps.size>0}constructor(r,o,h,y){if(super(),fr(this,"enabled",!1),fr(this,"skip",new Set),fr(this,"pick",new Set),fr(this,"deps",new Set),fr(this,"translateKeys",!1),fr(this,"translateValues",!1),fr(this,"reviveValues",!1),this.key=r,this.enabled=o,this.parse=this.enabled,this.applyInheritables(y),this.canBeFiltered=Un.includes(r),this.canBeFiltered&&(this.dict=bi.get(r)),h!==void 0)if(Array.isArray(h))this.parse=this.enabled=!0,this.canBeFiltered&&h.length>0&&this.translateTagSet(h,this.pick);else if(typeof h=="object"){if(this.enabled=!0,this.parse=h.parse!==!1,this.canBeFiltered){let{pick:w,skip:x}=h;w&&w.length>0&&this.translateTagSet(w,this.pick),x&&x.length>0&&this.translateTagSet(x,this.skip)}this.applyInheritables(h)}else h===!0||h===!1?this.parse=this.enabled=h:ei(`Invalid options argument: ${h}`)}applyInheritables(r){let o,h;for(o of Zc)h=r[o],h!==void 0&&(this[o]=h)}translateTagSet(r,o){if(this.dict){let h,y,{tagKeys:w,tagValues:x}=this.dict;for(h of r)typeof h=="string"?(y=x.indexOf(h),y===-1&&(y=w.indexOf(Number(h))),y!==-1&&o.add(Number(w[y]))):o.add(h)}else for(let h of r)o.add(h)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,yf(this.pick,this.deps)):this.enabled&&this.pick.size>0&&yf(this.pick,this.deps)}}var aa={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},Cx=new Map;class Fu extends dw{static useCached(r){let o=Cx.get(r);return o!==void 0||(o=new this(r),Cx.set(r,o)),o}constructor(r){super(),r===!0?this.setupFromTrue():r===void 0?this.setupFromUndefined():Array.isArray(r)?this.setupFromArray(r):typeof r=="object"?this.setupFromObject(r):ei(`Invalid options argument ${r}`),this.firstChunkSize===void 0&&(this.firstChunkSize=Sd?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let r;for(r of Il)this[r]=aa[r];for(r of Al)this[r]=aa[r];for(r of El)this[r]=aa[r];for(r of Pl)this[r]=new Vh(r,aa[r],void 0,this)}setupFromTrue(){let r;for(r of Il)this[r]=aa[r];for(r of Al)this[r]=aa[r];for(r of El)this[r]=!0;for(r of Pl)this[r]=new Vh(r,!0,void 0,this)}setupFromArray(r){let o;for(o of Il)this[o]=aa[o];for(o of Al)this[o]=aa[o];for(o of El)this[o]=aa[o];for(o of Pl)this[o]=new Vh(o,!1,void 0,this);this.setupGlobalFilters(r,void 0,Un)}setupFromObject(r){let o;for(o of(Un.ifd0=Un.ifd0||Un.image,Un.ifd1=Un.ifd1||Un.thumbnail,Object.assign(this,r),Il))this[o]=dg(r[o],aa[o]);for(o of Al)this[o]=dg(r[o],aa[o]);for(o of El)this[o]=dg(r[o],aa[o]);for(o of Lu)this[o]=new Vh(o,aa[o],r[o],this);for(o of Un)this[o]=new Vh(o,aa[o],r[o],this.tiff);this.setupGlobalFilters(r.pick,r.skip,Un,Pl),r.tiff===!0?this.batchEnableWithBool(Un,!0):r.tiff===!1?this.batchEnableWithUserValue(Un,r):Array.isArray(r.tiff)?this.setupGlobalFilters(r.tiff,void 0,Un):typeof r.tiff=="object"&&this.setupGlobalFilters(r.tiff.pick,r.tiff.skip,Un)}batchEnableWithBool(r,o){for(let h of r)this[h].enabled=o}batchEnableWithUserValue(r,o){for(let h of r){let y=o[h];this[h].enabled=y!==!1&&y!==void 0}}setupGlobalFilters(r,o,h,y=h){if(r&&r.length){for(let x of y)this[x].enabled=!1;let w=Tx(r,h);for(let[x,c]of w)yf(this[x].pick,c),this[x].enabled=!0}else if(o&&o.length){let w=Tx(o,h);for(let[x,c]of w)yf(this[x].skip,c)}}filterNestedSegmentTags(){let{ifd0:r,exif:o,xmp:h,iptc:y,icc:w}=this;this.makerNote?o.deps.add(37500):o.skip.add(37500),this.userComment?o.deps.add(37510):o.skip.add(37510),h.enabled||r.skip.add(700),y.enabled||r.skip.add(33723),w.enabled||r.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:r,exif:o,gps:h,interop:y}=this;y.needed&&(o.deps.add(40965),r.deps.add(40965)),o.needed&&r.deps.add(34665),h.needed&&r.deps.add(34853),this.tiff.enabled=Un.some(w=>this[w].enabled===!0)||this.makerNote||this.userComment;for(let w of Un)this[w].finalizeFilters()}get onlyTiff(){return!Wc.map(r=>this[r].enabled).some(r=>r===!0)&&this.tiff.enabled}checkLoadedPlugins(){for(let r of Lu)this[r].enabled&&!Jn.has(r)&&gy("segment parser",r)}}function Tx(n,r){let o,h,y,w,x=[];for(y of r){for(w of(o=bi.get(y),h=[],o))(n.includes(w[0])||n.includes(w[1]))&&h.push(w[0]);h.length&&x.push([y,h])}return x}function dg(n,r){return n!==void 0?n:r!==void 0?r:void 0}function yf(n,r){for(let o of r)n.add(o)}fr(Fu,"default",aa);class Gl{constructor(r){fr(this,"parsers",{}),fr(this,"output",{}),fr(this,"errors",[]),fr(this,"pushToErrors",o=>this.errors.push(o)),this.options=Fu.useCached(r)}async read(r){this.file=await zT(r,this.options)}setup(){if(this.fileParser)return;let{file:r}=this,o=r.getUint16(0);for(let[h,y]of uo)if(y.canHandle(r,o))return this.fileParser=new y(this.options,this.file,this.parsers),r[h]=!0;this.file.close&&this.file.close(),ei("Unknown file format")}async parse(){let{output:r,errors:o}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),o.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&o.length>0&&(r.errors=o),gf(r)}async executeParsers(){let{output:r}=this;await this.fileParser.parse();let o=Object.values(this.parsers).map(async h=>{let y=await h.parse();h.assignToOutput(r,y)});this.options.silentErrors&&(o=o.map(h=>h.catch(this.pushToErrors))),await Promise.all(o)}async extractThumbnail(){this.setup();let{options:r,file:o}=this,h=Jn.get("tiff",r);var y;if(o.tiff?y={start:0,type:"tiff"}:o.jpeg&&(y=await this.fileParser.getOrFindSegment("tiff")),y===void 0)return;let w=await this.fileParser.ensureSegmentChunk(y),x=this.parsers.tiff=new h(w,r,o),c=await x.extractThumbnail();return o.close&&o.close(),c}}async function Nf(n,r){let o=new Gl(r);return await o.read(n),o.parse()}var RT=Object.freeze({__proto__:null,parse:Nf,Exifr:Gl,fileParsers:uo,segmentParsers:Jn,fileReaders:co,tagKeys:bi,tagValues:Fs,tagRevivers:Nl,createDictionary:Kn,extendDictionary:zu,fetchUrlAsArrayBuffer:Mu,readBlobAsArrayBuffer:Du,chunkedProps:Il,otherSegments:Wc,segments:Lu,tiffBlocks:Un,segmentsAndBlocks:Pl,tiffExtractables:El,inheritables:Zc,allFormatters:Al,Options:Fu});class jf{constructor(r,o,h){fr(this,"errors",[]),fr(this,"ensureSegmentChunk",async y=>{let w=y.start,x=y.size||65536;if(this.file.chunked)if(this.file.available(w,x))y.chunk=this.file.subarray(w,x);else try{y.chunk=await this.file.readChunk(w,x)}catch(c){ei(`Couldn't read segment: ${JSON.stringify(y)}. ${c.message}`)}else this.file.byteLength>w+x?y.chunk=this.file.subarray(w,x):y.size===void 0?y.chunk=this.file.subarray(w):ei("Segment unreachable: "+JSON.stringify(y));return y.chunk}),this.extendOptions&&this.extendOptions(r),this.options=r,this.file=o,this.parsers=h}injectSegment(r,o){this.options[r].enabled&&this.createParser(r,o)}createParser(r,o){let h=new(Jn.get(r))(o,this.options,this.file);return this.parsers[r]=h}createParsers(r){for(let o of r){let{type:h,chunk:y}=o,w=this.options[h];if(w&&w.enabled){let x=this.parsers[h];x&&x.append||x||this.createParser(h,y)}}}async readSegments(r){let o=r.map(this.ensureSegmentChunk);await Promise.all(o)}}class zs{static findPosition(r,o){let h=r.getUint16(o+2)+2,y=typeof this.headerLength=="function"?this.headerLength(r,o,h):this.headerLength,w=o+y,x=h-y;return{offset:o,length:h,headerLength:y,start:w,size:x,end:w+x}}static parse(r,o={}){return new this(r,new Fu({[this.type]:o}),r).parse()}normalizeInput(r){return r instanceof ka?r:new ka(r)}constructor(r,o={},h){fr(this,"errors",[]),fr(this,"raw",new Map),fr(this,"handleError",y=>{if(!this.options.silentErrors)throw y;this.errors.push(y.message)}),this.chunk=this.normalizeInput(r),this.file=h,this.type=this.constructor.type,this.globalOptions=this.options=o,this.localOptions=o[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(r,o){let h=Nl.get(o),y=Fs.get(o),w=bi.get(o),x=this.options[o],c=x.reviveValues&&!!h,V=x.translateValues&&!!y,G=x.translateKeys&&!!w,Y={};for(let[Q,H]of r)c&&h.has(Q)?H=h.get(Q)(H):V&&y.has(Q)&&(H=this.translateValue(H,y.get(Q))),G&&w.has(Q)&&(Q=w.get(Q)||Q),Y[Q]=H;return Y}translateValue(r,o){return o[r]||o.DEFAULT||r}assignToOutput(r,o){this.assignObjectToOutput(r,this.constructor.type,o)}assignObjectToOutput(r,o,h){if(this.globalOptions.mergeOutput)return Object.assign(r,h);r[o]?Object.assign(r[o],h):r[o]=h}}fr(zs,"headerLength",4),fr(zs,"type",void 0),fr(zs,"multiSegment",!1),fr(zs,"canHandle",()=>!1);function OT(n){return n===192||n===194||n===196||n===219||n===221||n===218||n===254}function FT(n){return n>=224&&n<=239}function BT(n,r,o){for(let[h,y]of Jn)if(y.canHandle(n,r,o))return h}class Ix extends jf{constructor(...r){super(...r),fr(this,"appSegments",[]),fr(this,"jpegSegments",[]),fr(this,"unknownSegments",[])}static canHandle(r,o){return o===65496}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(r){r===!0?(this.findAll=!0,this.wanted=new Set(Jn.keyList())):(r=r===void 0?Jn.keyList().filter(o=>this.options[o].enabled):r.filter(o=>this.options[o].enabled&&Jn.has(o)),this.findAll=!1,this.remaining=new Set(r),this.wanted=new Set(r)),this.unfinishedMultiSegment=!1}async findAppSegments(r=0,o){this.setupSegmentFinderArgs(o);let{file:h,findAll:y,wanted:w,remaining:x}=this;if(!y&&this.file.chunked&&(y=Array.from(w).some(c=>{let V=Jn.get(c),G=this.options[c];return V.multiSegment&&G.multiSegment}),y&&await this.file.readWhole()),r=this.findAppSegmentsInRange(r,h.byteLength),!this.options.onlyTiff&&h.chunked){let c=!1;for(;x.size>0&&!c&&(h.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:V}=h,G=this.appSegments.some(Y=>!this.file.available(Y.offset||Y.start,Y.length||Y.size));if(c=r>V&&!G?!await h.readNextChunk(r):!await h.readNextChunk(V),(r=this.findAppSegmentsInRange(r,h.byteLength))===void 0)return}}}findAppSegmentsInRange(r,o){o-=2;let h,y,w,x,c,V,{file:G,findAll:Y,wanted:Q,remaining:H,options:Le}=this;for(;r<o;r++)if(G.getUint8(r)===255){if(h=G.getUint8(r+1),FT(h)){if(y=G.getUint16(r+2),w=BT(G,r,y),w&&Q.has(w)&&(x=Jn.get(w),c=x.findPosition(G,r),V=Le[w],c.type=w,this.appSegments.push(c),!Y&&(x.multiSegment&&V.multiSegment?(this.unfinishedMultiSegment=c.chunkNumber<c.chunkCount,this.unfinishedMultiSegment||H.delete(w)):H.delete(w),H.size===0)))break;Le.recordUnknownSegments&&(c=zs.findPosition(G,r),c.marker=h,this.unknownSegments.push(c)),r+=y+1}else if(OT(h)){if(y=G.getUint16(r+2),h===218&&Le.stopAfterSos!==!1)return;Le.recordJpegSegments&&this.jpegSegments.push({offset:r,length:y,marker:h}),r+=y+1}}return r}mergeMultiSegments(){if(!this.appSegments.some(o=>o.multiSegment))return;let r=function(o,h){let y,w,x,c=new Map;for(let V=0;V<o.length;V++)y=o[V],w=y[h],c.has(w)?x=c.get(w):c.set(w,x=[]),x.push(y);return Array.from(c)}(this.appSegments,"type");this.mergedAppSegments=r.map(([o,h])=>{let y=Jn.get(o,this.options);return y.handleMultiSegments?{type:o,chunk:y.handleMultiSegments(h)}:h[0]})}getSegment(r){return this.appSegments.find(o=>o.type===r)}async getOrFindSegment(r){let o=this.getSegment(r);return o===void 0&&(await this.findAppSegments(0,[r]),o=this.getSegment(r)),o}}fr(Ix,"type","jpeg"),uo.set("jpeg",Ix);const NT=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class jT extends zs{parseHeader(){var r=this.chunk.getUint16();r===18761?this.le=!0:r===19789&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(r,o,h=new Map){let{pick:y,skip:w}=this.options[o];y=new Set(y);let x=y.size>0,c=w.size===0,V=this.chunk.getUint16(r);r+=2;for(let G=0;G<V;G++){let Y=this.chunk.getUint16(r);if(x){if(y.has(Y)&&(h.set(Y,this.parseTag(r,Y,o)),y.delete(Y),y.size===0))break}else!c&&w.has(Y)||h.set(Y,this.parseTag(r,Y,o));r+=12}return h}parseTag(r,o,h){let{chunk:y}=this,w=y.getUint16(r+2),x=y.getUint32(r+4),c=NT[w];if(c*x<=4?r+=8:r=y.getUint32(r+8),(w<1||w>13)&&ei(`Invalid TIFF value type. block: ${h.toUpperCase()}, tag: ${o.toString(16)}, type: ${w}, offset ${r}`),r>y.byteLength&&ei(`Invalid TIFF value offset. block: ${h.toUpperCase()}, tag: ${o.toString(16)}, type: ${w}, offset ${r} is outside of chunk size ${y.byteLength}`),w===1)return y.getUint8Array(r,x);if(w===2)return bu(y.getString(r,x));if(w===7)return y.getUint8Array(r,x);if(x===1)return this.parseTagValue(w,r);{let V=new(function(Y){switch(Y){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 10:return Array;case 11:return Float32Array;case 12:return Float64Array;default:return Array}}(w))(x),G=c;for(let Y=0;Y<x;Y++)V[Y]=this.parseTagValue(w,r),r+=G;return V}}parseTagValue(r,o){let{chunk:h}=this;switch(r){case 1:return h.getUint8(o);case 3:return h.getUint16(o);case 4:return h.getUint32(o);case 5:return h.getUint32(o)/h.getUint32(o+4);case 6:return h.getInt8(o);case 8:return h.getInt16(o);case 9:return h.getInt32(o);case 10:return h.getInt32(o)/h.getInt32(o+4);case 11:return h.getFloat(o);case 12:return h.getDouble(o);case 13:return h.getUint32(o);default:ei(`Invalid tiff type ${r}`)}}}class pg extends jT{static canHandle(r,o){return r.getUint8(o+1)===225&&r.getUint32(o+4)===1165519206&&r.getUint16(o+8)===0}async parse(){this.parseHeader();let{options:r}=this;return r.ifd0.enabled&&await this.parseIfd0Block(),r.exif.enabled&&await this.safeParse("parseExifBlock"),r.gps.enabled&&await this.safeParse("parseGpsBlock"),r.interop.enabled&&await this.safeParse("parseInteropBlock"),r.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(r){let o=this[r]();return o.catch!==void 0&&(o=o.catch(this.handleError)),o}findIfd0Offset(){this.ifd0Offset===void 0&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(this.ifd1Offset===void 0){this.findIfd0Offset();let r=this.chunk.getUint16(this.ifd0Offset),o=this.ifd0Offset+2+12*r;this.ifd1Offset=this.chunk.getUint32(o)}}parseBlock(r,o){let h=new Map;return this[o]=h,this.parseTags(r,o,h),h}async parseIfd0Block(){if(this.ifd0)return;let{file:r}=this;this.findIfd0Offset(),this.ifd0Offset<8&&ei("Malformed EXIF data"),!r.chunked&&this.ifd0Offset>r.byteLength&&ei(`IFD0 offset points to outside of file.
this.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${r.byteLength}`),r.tiff&&await r.ensureChunk(this.ifd0Offset,fy(this.options));let o=this.parseBlock(this.ifd0Offset,"ifd0");return o.size!==0?(this.exifOffset=o.get(34665),this.interopOffset=o.get(40965),this.gpsOffset=o.get(34853),this.xmp=o.get(700),this.iptc=o.get(33723),this.icc=o.get(34675),this.options.sanitize&&(o.delete(34665),o.delete(40965),o.delete(34853),o.delete(700),o.delete(33723),o.delete(34675)),o):void 0}async parseExifBlock(){if(this.exif||(this.ifd0||await this.parseIfd0Block(),this.exifOffset===void 0))return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,fy(this.options));let r=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=r.get(40965)),this.makerNote=r.get(37500),this.userComment=r.get(37510),this.options.sanitize&&(r.delete(40965),r.delete(37500),r.delete(37510)),this.unpack(r,41728),this.unpack(r,41729),r}unpack(r,o){let h=r.get(o);h&&h.length===1&&r.set(o,h[0])}async parseGpsBlock(){if(this.gps||(this.ifd0||await this.parseIfd0Block(),this.gpsOffset===void 0))return;let r=this.parseBlock(this.gpsOffset,"gps");return r&&r.has(2)&&r.has(4)&&(r.set("latitude",Px(...r.get(2),r.get(1))),r.set("longitude",Px(...r.get(4),r.get(3)))),r}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),this.interopOffset!==void 0||this.exif||await this.parseExifBlock(),this.interopOffset!==void 0))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(r=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||r))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),this.ifd1===void 0)return;let r=this.ifd1.get(513),o=this.ifd1.get(514);return this.chunk.getUint8Array(r,o)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let r,o,h,y={};for(o of Un)if(r=this[o],!cw(r))if(h=this.canTranslate?this.translateBlock(r,o):Object.fromEntries(r),this.options.mergeOutput){if(o==="ifd1")continue;Object.assign(y,h)}else y[o]=h;return this.makerNote&&(y.makerNote=this.makerNote),this.userComment&&(y.userComment=this.userComment),y}assignToOutput(r,o){if(this.globalOptions.mergeOutput)Object.assign(r,o);else for(let[h,y]of Object.entries(o))this.assignObjectToOutput(r,h,y)}}function Px(n,r,o,h){var y=n+r/60+o/3600;return h!=="S"&&h!=="W"||(y*=-1),y}fr(pg,"type","tiff"),fr(pg,"headerLength",10),Jn.set("tiff",pg);var UT=Object.freeze({__proto__:null,default:RT,Exifr:Gl,fileParsers:uo,segmentParsers:Jn,fileReaders:co,tagKeys:bi,tagValues:Fs,tagRevivers:Nl,createDictionary:Kn,extendDictionary:zu,fetchUrlAsArrayBuffer:Mu,readBlobAsArrayBuffer:Du,chunkedProps:Il,otherSegments:Wc,segments:Lu,tiffBlocks:Un,segmentsAndBlocks:Pl,tiffExtractables:El,inheritables:Zc,allFormatters:Al,Options:Fu,parse:Nf});const g_={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},y_=Object.assign({},g_,{firstChunkSize:4e4,gps:[1,2,3,4]});async function pw(n){let r=new Gl(y_);await r.read(n);let o=await r.parse();if(o&&o.gps){let{latitude:h,longitude:y}=o.gps;return{latitude:h,longitude:y}}}const __=Object.assign({},g_,{tiff:!1,ifd1:!0,mergeOutput:!1});async function fw(n){let r=new Gl(__);await r.read(n);let o=await r.extractThumbnail();return o&&Bf?Ff.from(o):o}async function mw(n){let r=await this.thumbnail(n);if(r!==void 0){let o=new Blob([r]);return URL.createObjectURL(o)}}const v_=Object.assign({},g_,{firstChunkSize:4e4,ifd0:[274]});async function x_(n){let r=new Gl(v_);await r.read(n);let o=await r.parse();if(o&&o.ifd0)return o.ifd0[274]}const b_=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let wu=!0,Su=!0;if(typeof navigator=="object"){let n=navigator.userAgent;if(n.includes("iPad")||n.includes("iPhone")){let r=n.match(/OS (\d+)_(\d+)/);if(r){let[,o,h]=r;wu=Number(o)+.1*Number(h)<13.4,Su=!1}}else if(n.includes("OS X 10")){let[,r]=n.match(/OS X 10[_.](\d+)/);wu=Su=Number(r)<15}if(n.includes("Chrome/")){let[,r]=n.match(/Chrome\/(\d+)/);wu=Su=Number(r)<81}else if(n.includes("Firefox/")){let[,r]=n.match(/Firefox\/(\d+)/);wu=Su=Number(r)<77}}async function gw(n){let r=await x_(n);return Object.assign({canvas:wu,css:Su},b_[r])}class VT extends ka{constructor(...r){super(...r),fr(this,"ranges",new $T),this.byteLength!==0&&this.ranges.add(0,this.byteLength)}_tryExtend(r,o,h){if(r===0&&this.byteLength===0&&h){let y=new DataView(h.buffer||h,h.byteOffset,h.byteLength);this._swapDataView(y)}else{let y=r+o;if(y>this.byteLength){let{dataView:w}=this._extend(y);this._swapDataView(w)}}}_extend(r){let o;o=Bf?Ff.allocUnsafe(r):new Uint8Array(r);let h=new DataView(o.buffer,o.byteOffset,o.byteLength);return o.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:o,dataView:h}}subarray(r,o,h=!1){return o=o||this._lengthToEnd(r),h&&this._tryExtend(r,o),this.ranges.add(r,o),super.subarray(r,o)}set(r,o,h=!1){h&&this._tryExtend(o,r.byteLength,r);let y=super.set(r,o);return this.ranges.add(o,y.byteLength),y}async ensureChunk(r,o){this.chunked&&(this.ranges.available(r,o)||await this.readChunk(r,o))}available(r,o){return this.ranges.available(r,o)}}class $T{constructor(){fr(this,"list",[])}get length(){return this.list.length}add(r,o,h=0){let y=r+o,w=this.list.filter(x=>Ex(r,x.offset,y)||Ex(r,x.end,y));if(w.length>0){r=Math.min(r,...w.map(c=>c.offset)),y=Math.max(y,...w.map(c=>c.end)),o=y-r;let x=w.shift();x.offset=r,x.length=o,x.end=y,this.list=this.list.filter(c=>!w.includes(c))}else this.list.push({offset:r,length:o,end:y})}available(r,o){let h=r+o;return this.list.some(y=>y.offset<=r&&h<=y.end)}}function Ex(n,r,o){return n<=r&&r<=o}class Uf extends VT{constructor(r,o){super(0),fr(this,"chunksRead",0),this.input=r,this.options=o}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(r=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let o=this.options.chunkSize,h=await this.readChunk(r,o);return!!h&&h.byteLength===o}async readChunk(r,o){if(this.chunksRead++,(o=this.safeWrapAddress(r,o))!==0)return this._readChunk(r,o)}safeWrapAddress(r,o){return this.size!==void 0&&r+o>this.size?Math.max(0,this.size-r):o}get nextChunkOffset(){if(this.ranges.list.length!==0)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return this.size!==void 0&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}co.set("blob",class extends Uf{async readWhole(){this.chunked=!1;let n=await Du(this.input);this._swapArrayBuffer(n)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(n,r){let o=r?n+r:void 0,h=this.input.slice(n,o),y=await Du(h);return this.set(y,n,!0)}});var qT=Object.freeze({__proto__:null,default:UT,Exifr:Gl,fileParsers:uo,segmentParsers:Jn,fileReaders:co,tagKeys:bi,tagValues:Fs,tagRevivers:Nl,createDictionary:Kn,extendDictionary:zu,fetchUrlAsArrayBuffer:Mu,readBlobAsArrayBuffer:Du,chunkedProps:Il,otherSegments:Wc,segments:Lu,tiffBlocks:Un,segmentsAndBlocks:Pl,tiffExtractables:El,inheritables:Zc,allFormatters:Al,Options:Fu,parse:Nf,gpsOnlyOptions:y_,gps:pw,thumbnailOnlyOptions:__,thumbnail:fw,thumbnailUrl:mw,orientationOnlyOptions:v_,orientation:x_,rotations:b_,get rotateCanvas(){return wu},get rotateCss(){return Su},rotation:gw});co.set("url",class extends Uf{async readWhole(){this.chunked=!1;let n=await Mu(this.input);n instanceof ArrayBuffer?this._swapArrayBuffer(n):n instanceof Uint8Array&&this._swapBuffer(n)}async _readChunk(n,r){let o=r?n+r-1:void 0,h=this.options.httpHeaders||{};(n||o)&&(h.range=`bytes=${[n,o].join("-")}`);let y=await f_(this.input,{headers:h}),w=await y.arrayBuffer(),x=w.byteLength;if(y.status!==416)return x!==r&&(this.size=n+x),this.set(w,n,!0)}});ka.prototype.getUint64=function(n){let r=this.getUint32(n),o=this.getUint32(n+4);return r<1048575?r<<32|o:typeof Sp!==void 0?(console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),Sp(r)<<Sp(32)|Sp(o)):void ei("Trying to read 64b value but JS can only handle 53b numbers.")};class GT extends jf{parseBoxes(r=0){let o=[];for(;r<this.file.byteLength-4;){let h=this.parseBoxHead(r);if(o.push(h),h.length===0)break;r+=h.length}return o}parseSubBoxes(r){r.boxes=this.parseBoxes(r.start)}findBox(r,o){return r.boxes===void 0&&this.parseSubBoxes(r),r.boxes.find(h=>h.kind===o)}parseBoxHead(r){let o=this.file.getUint32(r),h=this.file.getString(r+4,4),y=r+8;return o===1&&(o=this.file.getUint64(r+8),y+=8),{offset:r,length:o,kind:h,start:y}}parseBoxFullHead(r){if(r.version!==void 0)return;let o=this.file.getUint32(r.start);r.version=o>>24,r.start+=4}}class yw extends GT{static canHandle(r,o){if(o!==0)return!1;let h=r.getUint16(2);if(h>50)return!1;let y=16,w=[];for(;y<h;)w.push(r.getString(y,4)),y+=4;return w.includes(this.type)}async parse(){let r=this.file.getUint32(0),o=this.parseBoxHead(r);for(;o.kind!=="meta";)r+=o.length,await this.file.ensureChunk(r,16),o=this.parseBoxHead(r);await this.file.ensureChunk(o.offset,o.length),this.parseBoxFullHead(o),this.parseSubBoxes(o),this.options.icc.enabled&&await this.findIcc(o),this.options.tiff.enabled&&await this.findExif(o)}async registerSegment(r,o,h){await this.file.ensureChunk(o,h);let y=this.file.subarray(o,h);this.createParser(r,y)}async findIcc(r){let o=this.findBox(r,"iprp");if(o===void 0)return;let h=this.findBox(o,"ipco");if(h===void 0)return;let y=this.findBox(h,"colr");y!==void 0&&await this.registerSegment("icc",y.offset+12,y.length)}async findExif(r){let o=this.findBox(r,"iinf");if(o===void 0)return;let h=this.findBox(r,"iloc");if(h===void 0)return;let y=this.findExifLocIdInIinf(o),w=this.findExtentInIloc(h,y);if(w===void 0)return;let[x,c]=w;await this.file.ensureChunk(x,c);let V=4+this.file.getUint32(x);x+=V,c-=V,await this.registerSegment("tiff",x,c)}findExifLocIdInIinf(r){this.parseBoxFullHead(r);let o,h,y,w,x=r.start,c=this.file.getUint16(x);for(x+=2;c--;){if(o=this.parseBoxHead(x),this.parseBoxFullHead(o),h=o.start,o.version>=2&&(y=o.version===3?4:2,w=this.file.getString(h+y+2,4),w==="Exif"))return this.file.getUintBytes(h,y);x+=o.length}}get8bits(r){let o=this.file.getUint8(r);return[o>>4,15&o]}findExtentInIloc(r,o){this.parseBoxFullHead(r);let h=r.start,[y,w]=this.get8bits(h++),[x,c]=this.get8bits(h++),V=r.version===2?4:2,G=r.version===1||r.version===2?2:0,Y=c+y+w,Q=r.version===2?4:2,H=this.file.getUintBytes(h,Q);for(h+=Q;H--;){let Le=this.file.getUintBytes(h,V);h+=V+G+2+x;let Be=this.file.getUint16(h);if(h+=2,Le===o)return Be>1&&console.warn(`ILOC box has more than one extent but we're only processing one
Please create an issue at https://github.com/MikeKovarik/exifr with this file`),[this.file.getUintBytes(h+c,y),this.file.getUintBytes(h+c+y,w)];h+=Be*Y}}}class _w extends yw{}fr(_w,"type","heic");class Ax extends yw{}fr(Ax,"type","avif"),uo.set("heic",_w),uo.set("avif",Ax),Kn(bi,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),Kn(bi,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),Kn(bi,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),Kn(Fs,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);let ad=Kn(Fs,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]);const Mx={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};ad.set(37392,Mx),ad.set(41488,Mx);const fg={0:"Normal",1:"Low",2:"High"};function Dx(n){return typeof n=="object"&&n.length!==void 0?n[0]:n}function zx(n){let r=Array.from(n).slice(1);return r[1]>15&&(r=r.map(o=>String.fromCharCode(o))),r[2]!=="0"&&r[2]!==0||r.pop(),r.join(".")}function mg(n){if(typeof n=="string"){var[r,o,h,y,w,x]=n.trim().split(/[-: ]/g).map(Number),c=new Date(r,o-1,h);return Number.isNaN(y)||Number.isNaN(w)||Number.isNaN(x)||(c.setHours(y),c.setMinutes(w),c.setSeconds(x)),Number.isNaN(+c)?n:c}}function $h(n){if(typeof n=="string")return n;let r=[];if(n[1]===0&&n[n.length-1]===0)for(let o=0;o<n.length;o+=2)r.push(Lx(n[o+1],n[o]));else for(let o=0;o<n.length;o+=2)r.push(Lx(n[o],n[o+1]));return bu(String.fromCodePoint(...r))}function Lx(n,r){return n<<8|r}ad.set(41992,fg),ad.set(41993,fg),ad.set(41994,fg),Kn(Nl,["ifd0","ifd1"],[[50827,function(n){return typeof n!="string"?hw(n):n}],[306,mg],[40091,$h],[40092,$h],[40093,$h],[40094,$h],[40095,$h]]),Kn(Nl,"exif",[[40960,zx],[36864,zx],[36867,mg],[36868,mg],[40962,Dx],[40963,Dx]]),Kn(Nl,"gps",[[0,n=>Array.from(n).join(".")],[7,n=>Array.from(n).join(":")]]);class gg extends zs{static canHandle(r,o){return r.getUint8(o+1)===225&&r.getUint32(o+4)===1752462448&&r.getString(o+4,20)==="http://ns.adobe.com/"}static headerLength(r,o){return r.getString(o+4,34)==="http://ns.adobe.com/xmp/extension/"?79:33}static findPosition(r,o){let h=super.findPosition(r,o);return h.multiSegment=h.extended=h.headerLength===79,h.multiSegment?(h.chunkCount=r.getUint8(o+72),h.chunkNumber=r.getUint8(o+76),r.getUint8(o+77)!==0&&h.chunkNumber++):(h.chunkCount=1/0,h.chunkNumber=-1),h}static handleMultiSegments(r){return r.map(o=>o.chunk.getString()).join("")}normalizeInput(r){return typeof r=="string"?r:ka.from(r).getString()}parse(r=this.chunk){if(!this.localOptions.parse)return r;r=function(w){let x={},c={};for(let V of ww)x[V]=[],c[V]=0;return w.replace(ZT,(V,G,Y)=>{if(G==="<"){let Q=++c[Y];return x[Y].push(Q),`${V}#${Q}`}return`${V}#${x[Y].pop()}`})}(r);let o=Fc.findAll(r,"rdf","Description");o.length===0&&o.push(new Fc("rdf","Description",void 0,r));let h,y={};for(let w of o)for(let x of w.properties)h=WT(x.ns,y),vw(x,h);return function(w){let x;for(let c in w)x=w[c]=gf(w[c]),x===void 0&&delete w[c];return gf(w)}(y)}assignToOutput(r,o){if(this.localOptions.parse)for(let[h,y]of Object.entries(o))switch(h){case"tiff":this.assignObjectToOutput(r,"ifd0",y);break;case"exif":this.assignObjectToOutput(r,"exif",y);break;case"xmlns":break;default:this.assignObjectToOutput(r,h,y)}else r.xmp=o}}fr(gg,"type","xmp"),fr(gg,"multiSegment",!0),Jn.set("xmp",gg);class _f{static findAll(r){return xw(r,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(_f.unpackMatch)}static unpackMatch(r){let o=r[1],h=r[2],y=r[3].slice(1,-1);return y=bw(y),new _f(o,h,y)}constructor(r,o,h){this.ns=r,this.name=o,this.value=h}serialize(){return this.value}}class Fc{static findAll(r,o,h){if(o!==void 0||h!==void 0){o=o||"[\\w\\d-]+",h=h||"[\\w\\d-]+";var y=new RegExp(`<(${o}):(${h})(#\\d+)?((\\s+?[\\w\\d-:]+=("[^"]*"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)`,"gm")}else y=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return xw(r,y).map(Fc.unpackMatch)}static unpackMatch(r){let o=r[1],h=r[2],y=r[4],w=r[8];return new Fc(o,h,y,w)}constructor(r,o,h,y){this.ns=r,this.name=o,this.attrString=h,this.innerXml=y,this.attrs=_f.findAll(h),this.children=Fc.findAll(y),this.value=this.children.length===0?bw(y):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return this.value!==void 0&&this.attrs.length===0&&this.children.length===0}get isListContainer(){return this.children.length===1&&this.children[0].isList}get isList(){let{ns:r,name:o}=this;return r==="rdf"&&(o==="Seq"||o==="Bag"||o==="Alt")}get isListItem(){return this.ns==="rdf"&&this.name==="li"}serialize(){if(this.properties.length===0&&this.value===void 0)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return HT(this.children.map(KT));if(this.isListItem&&this.children.length===1&&this.attrs.length===0)return this.children[0].serialize();let r={};for(let o of this.properties)vw(o,r);return this.value!==void 0&&(r.value=this.value),gf(r)}}function vw(n,r){let o=n.serialize();o!==void 0&&(r[n.name]=o)}var KT=n=>n.serialize(),HT=n=>n.length===1?n[0]:n,WT=(n,r)=>r[n]?r[n]:r[n]={};function xw(n,r){let o,h=[];if(!n)return h;for(;(o=r.exec(n))!==null;)h.push(o);return h}function bw(n){if(function(h){return h==null||h==="null"||h==="undefined"||h===""||h.trim()===""}(n))return;let r=Number(n);if(!Number.isNaN(r))return r;let o=n.toLowerCase();return o==="true"||o!=="false"&&n.trim()}const ww=["rdf:li","rdf:Seq","rdf:Bag","rdf:Alt","rdf:Description"],ZT=new RegExp(`(<|\\/)(${ww.join("|")})`,"g");var XT=Object.freeze({__proto__:null,default:qT,Exifr:Gl,fileParsers:uo,segmentParsers:Jn,fileReaders:co,tagKeys:bi,tagValues:Fs,tagRevivers:Nl,createDictionary:Kn,extendDictionary:zu,fetchUrlAsArrayBuffer:Mu,readBlobAsArrayBuffer:Du,chunkedProps:Il,otherSegments:Wc,segments:Lu,tiffBlocks:Un,segmentsAndBlocks:Pl,tiffExtractables:El,inheritables:Zc,allFormatters:Al,Options:Fu,parse:Nf,gpsOnlyOptions:y_,gps:pw,thumbnailOnlyOptions:__,thumbnail:fw,thumbnailUrl:mw,orientationOnlyOptions:v_,orientation:x_,rotations:b_,get rotateCanvas(){return wu},get rotateCss(){return Su},rotation:gw});let Rx=mf("fs",n=>n.promises);co.set("fs",class extends Uf{async readWhole(){this.chunked=!1,this.fs=await Rx;let n=await this.fs.readFile(this.input);this._swapBuffer(n)}async readChunked(){this.chunked=!0,this.fs=await Rx,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){this.fh===void 0&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(n,r){this.fh===void 0&&await this.open(),n+r>this.size&&(r=this.size-n);var o=this.subarray(n,r,!0);return await this.fh.read(o.dataView,0,r,n),o}async close(){if(this.fh){let n=this.fh;this.fh=void 0,await n.close()}}});co.set("base64",class extends Uf{constructor(...n){super(...n),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(n,r){let o,h,y=this.input;n===void 0?(n=0,o=0,h=0):(o=4*Math.floor(n/3),h=n-o/4*3),r===void 0&&(r=this.size);let w=n+r,x=o+4*Math.ceil(w/3);y=y.slice(o,x);let c=Math.min(r,this.size-n);if(Bf){let V=Ff.from(y,"base64").slice(h,h+c);return this.set(V,n,!0)}{let V=this.subarray(n,c,!0),G=atob(y),Y=V.toUint8();for(let Q=0;Q<c;Q++)Y[Q]=G.charCodeAt(h+Q);return V}}});class Ox extends jf{static canHandle(r,o){return o===18761||o===19789}extendOptions(r){let{ifd0:o,xmp:h,iptc:y,icc:w}=r;h.enabled&&o.deps.add(700),y.enabled&&o.deps.add(33723),w.enabled&&o.deps.add(34675),o.finalizeFilters()}async parse(){let{tiff:r,xmp:o,iptc:h,icc:y}=this.options;if(r.enabled||o.enabled||h.enabled||y.enabled){let w=Math.max(fy(this.options),this.options.chunkSize);await this.file.ensureChunk(0,w),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(r){if(this.parsers.tiff[r]){let o=this.parsers.tiff[r];this.injectSegment(r,o)}}}fr(Ox,"type","tiff"),uo.set("tiff",Ox);let YT=mf("zlib");const JT=["ihdr","iccp","text","itxt","exif"];class Fx extends jf{constructor(...r){super(...r),fr(this,"catchError",o=>this.errors.push(o)),fr(this,"metaChunks",[]),fr(this,"unknownChunks",[])}static canHandle(r,o){return o===35152&&r.getUint32(0)===2303741511&&r.getUint32(4)===218765834}async parse(){let{file:r}=this;await this.findPngChunksInRange(8,r.byteLength),await this.readSegments(this.metaChunks),this.findIhdr(),this.parseTextChunks(),await this.findExif().catch(this.catchError),await this.findXmp().catch(this.catchError),await this.findIcc().catch(this.catchError)}async findPngChunksInRange(r,o){let{file:h}=this;for(;r<o;){let y=h.getUint32(r),w=h.getUint32(r+4),x=h.getString(r+4,4).toLowerCase(),c=y+4+4+4,V={type:x,offset:r,length:c,start:r+4+4,size:y,marker:w};JT.includes(x)?this.metaChunks.push(V):this.unknownChunks.push(V),r+=c}}parseTextChunks(){let r=this.metaChunks.filter(o=>o.type==="text");for(let o of r){let[h,y]=this.file.getString(o.start,o.size).split("\0");this.injectKeyValToIhdr(h,y)}}injectKeyValToIhdr(r,o){let h=this.parsers.ihdr;h&&h.raw.set(r,o)}findIhdr(){let r=this.metaChunks.find(o=>o.type==="ihdr");r&&this.options.ihdr.enabled!==!1&&this.createParser("ihdr",r.chunk)}async findExif(){let r=this.metaChunks.find(o=>o.type==="exif");r&&this.injectSegment("tiff",r.chunk)}async findXmp(){let r=this.metaChunks.filter(o=>o.type==="itxt");for(let o of r)o.chunk.getString(0,17)==="XML:com.adobe.xmp"&&this.injectSegment("xmp",o.chunk)}async findIcc(){let r=this.metaChunks.find(c=>c.type==="iccp");if(!r)return;let{chunk:o}=r,h=o.getUint8Array(0,81),y=0;for(;y<80&&h[y]!==0;)y++;let w=y+2,x=o.getString(0,y);if(this.injectKeyValToIhdr("ProfileName",x),ff){let c=await YT,V=o.getUint8Array(w);V=c.inflateSync(V),this.injectSegment("icc",V)}}}fr(Fx,"type","png"),uo.set("png",Fx),Kn(bi,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),zu(bi,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);let Bx=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];zu(bi,"ifd0",Bx),zu(bi,"exif",Bx),Kn(Fs,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);class yg extends zs{static canHandle(r,o){return r.getUint8(o+1)===224&&r.getUint32(o+4)===1246120262&&r.getUint8(o+8)===0}parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint16(0)],[2,this.chunk.getUint8(2)],[3,this.chunk.getUint16(3)],[5,this.chunk.getUint16(5)],[7,this.chunk.getUint8(7)],[8,this.chunk.getUint8(8)]])}}fr(yg,"type","jfif"),fr(yg,"headerLength",9),Jn.set("jfif",yg),Kn(bi,"jfif",[[0,"JFIFVersion"],[2,"ResolutionUnit"],[3,"XResolution"],[5,"YResolution"],[7,"ThumbnailWidth"],[8,"ThumbnailHeight"]]);class Nx extends zs{parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint32(0)],[4,this.chunk.getUint32(4)],[8,this.chunk.getUint8(8)],[9,this.chunk.getUint8(9)],[10,this.chunk.getUint8(10)],[11,this.chunk.getUint8(11)],[12,this.chunk.getUint8(12)],...Array.from(this.raw)])}}fr(Nx,"type","ihdr"),Jn.set("ihdr",Nx),Kn(bi,"ihdr",[[0,"ImageWidth"],[4,"ImageHeight"],[8,"BitDepth"],[9,"ColorType"],[10,"Compression"],[11,"Filter"],[12,"Interlace"]]),Kn(Fs,"ihdr",[[9,{0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha",DEFAULT:"Unknown"}],[10,{0:"Deflate/Inflate",DEFAULT:"Unknown"}],[11,{0:"Adaptive",DEFAULT:"Unknown"}],[12,{0:"Noninterlaced",1:"Adam7 Interlace",DEFAULT:"Unknown"}]]);class jp extends zs{static canHandle(r,o){return r.getUint8(o+1)===226&&r.getUint32(o+4)===1229144927}static findPosition(r,o){let h=super.findPosition(r,o);return h.chunkNumber=r.getUint8(o+16),h.chunkCount=r.getUint8(o+17),h.multiSegment=h.chunkCount>1,h}static handleMultiSegments(r){return function(o){let h=function(y){let w=y[0].constructor,x=0;for(let G of y)x+=G.length;let c=new w(x),V=0;for(let G of y)c.set(G,V),V+=G.length;return c}(o.map(y=>y.chunk.toUint8()));return new ka(h)}(r)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:r}=this;this.chunk.byteLength<84&&ei("ICC header is too short");for(let[o,h]of Object.entries(QT)){o=parseInt(o,10);let y=h(this.chunk,o);y!=="\0\0\0\0"&&r.set(o,y)}}parseTags(){let r,o,h,y,w,{raw:x}=this,c=this.chunk.getUint32(128),V=132,G=this.chunk.byteLength;for(;c--;){if(r=this.chunk.getString(V,4),o=this.chunk.getUint32(V+4),h=this.chunk.getUint32(V+8),y=this.chunk.getString(o,4),o+h>G)return void console.warn("reached the end of the first ICC chunk. Enable options.tiff.multiSegment to read all ICC segments.");w=this.parseTag(y,o,h),w!==void 0&&w!=="\0\0\0\0"&&x.set(r,w),V+=12}}parseTag(r,o,h){switch(r){case"desc":return this.parseDesc(o);case"mluc":return this.parseMluc(o);case"text":return this.parseText(o,h);case"sig ":return this.parseSig(o)}if(!(o+h>this.chunk.byteLength))return this.chunk.getUint8Array(o,h)}parseDesc(r){let o=this.chunk.getUint32(r+8)-1;return bu(this.chunk.getString(r+12,o))}parseText(r,o){return bu(this.chunk.getString(r+8,o-8))}parseSig(r){return bu(this.chunk.getString(r+8,4))}parseMluc(r){let{chunk:o}=this,h=o.getUint32(r+8),y=o.getUint32(r+12),w=r+16,x=[];for(let c=0;c<h;c++){let V=o.getString(w+0,2),G=o.getString(w+2,2),Y=o.getUint32(w+4),Q=o.getUint32(w+8)+r,H=bu(o.getUnicodeString(Q,Y));x.push({lang:V,country:G,text:H}),w+=y}return h===1?x[0].text:x}translateValue(r,o){return typeof r=="string"?o[r]||o[r.toLowerCase()]||r:o[r]||r}}fr(jp,"type","icc"),fr(jp,"multiSegment",!0),fr(jp,"headerLength",18);const QT={4:zo,8:function(n,r){return[n.getUint8(r),n.getUint8(r+1)>>4,n.getUint8(r+1)%16].map(o=>o.toString(10)).join(".")},12:zo,16:zo,20:zo,24:function(n,r){const o=n.getUint16(r),h=n.getUint16(r+2)-1,y=n.getUint16(r+4),w=n.getUint16(r+6),x=n.getUint16(r+8),c=n.getUint16(r+10);return new Date(Date.UTC(o,h,y,w,x,c))},36:zo,40:zo,48:zo,52:zo,64:(n,r)=>n.getUint32(r),80:zo};function zo(n,r){return bu(n.getString(r,4))}Jn.set("icc",jp),Kn(bi,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);const kp={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},jx={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};Kn(Fs,"icc",[[4,kp],[12,jx],[40,Object.assign({},kp,jx)],[48,kp],[80,kp],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);class Cp extends zs{static canHandle(r,o,h){return r.getUint8(o+1)===237&&r.getString(o+4,9)==="Photoshop"&&this.containsIptc8bim(r,o,h)!==void 0}static headerLength(r,o,h){let y,w=this.containsIptc8bim(r,o,h);if(w!==void 0)return y=r.getUint8(o+w+7),y%2!=0&&(y+=1),y===0&&(y=4),w+8+y}static containsIptc8bim(r,o,h){for(let y=0;y<h;y++)if(this.isIptcSegmentHead(r,o+y))return y}static isIptcSegmentHead(r,o){return r.getUint8(o)===56&&r.getUint32(o)===943868237&&r.getUint16(o+4)===1028}parse(){let{raw:r}=this,o=this.chunk.byteLength-1,h=!1;for(let y=0;y<o;y++)if(this.chunk.getUint8(y)===28&&this.chunk.getUint8(y+1)===2){h=!0;let w=this.chunk.getUint16(y+3),x=this.chunk.getUint8(y+2),c=this.chunk.getLatin1String(y+5,w);r.set(x,this.pluralizeValue(r.get(x),c)),y+=4+w}else if(h)break;return this.translate(),this.output}pluralizeValue(r,o){return r!==void 0?r instanceof Array?(r.push(o),r):[r,o]:o}}fr(Cp,"type","iptc"),fr(Cp,"translateValues",!1),fr(Cp,"reviveValues",!1),Jn.set("iptc",Cp),Kn(bi,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),Kn(Fs,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);class eI{async processImage(r){const o=uw(),h=await this.extractExif(r);await ms.images.add({id:o,blob:r,createdAt:new Date().toISOString()});const y=await this.generateThumbnail(r);return{blobId:o,exif:h,thumbnail:y}}async extractExif(r){try{const o=await XT.parse(r,{gps:!0,xmp:!1,icc:!1,iptc:!1,jfif:!1,ihdr:!1,pick:["DateTimeOriginal","CreateDate","ModifyDate","GPSLatitude","GPSLongitude","GPSAltitude","Orientation","Make","Model"]});if(!o)return{};const h={},y=o.DateTimeOriginal||o.CreateDate||o.ModifyDate;return y&&(h.timestamp=y instanceof Date?y.toISOString():String(y)),o.latitude!==void 0&&o.longitude!==void 0?(h.lat=o.latitude,h.lon=o.longitude):o.GPSLatitude!==void 0&&o.GPSLongitude!==void 0&&(h.lat=o.GPSLatitude,h.lon=o.GPSLongitude),o.Orientation&&(h.orientation=o.Orientation),(o.Make||o.Model)&&(h.make=o.Make,h.camera=o.Model),h}catch(o){return console.warn("EXIF extraction failed:",o),{}}}async generateThumbnail(r,o=200){return new Promise((h,y)=>{const w=new Image,x=URL.createObjectURL(r);w.onload=()=>{URL.revokeObjectURL(x);const c=document.createElement("canvas"),V=c.getContext("2d");if(!V){y(new Error("Could not get canvas context"));return}let G=w.width,Y=w.height;G>Y?G>o&&(Y=Y*o/G,G=o):Y>o&&(G=G*o/Y,Y=o),c.width=G,c.height=Y,V.drawImage(w,0,0,G,Y),h(c.toDataURL("image/jpeg",.7))},w.onerror=()=>{URL.revokeObjectURL(x),y(new Error("Failed to load image"))},w.src=x})}async getImageUrl(r){const o=await ms.images.get(r);return o?URL.createObjectURL(o.blob):null}async captureFromCamera(){return new Promise(r=>{const o=document.createElement("input");o.type="file",o.accept="image/*",o.capture="environment",o.onchange=h=>{const w=h.target.files?.[0];r(w||null)},o.click()})}async selectFromGallery(){return new Promise(r=>{const o=document.createElement("input");o.type="file",o.accept="image/*",o.onchange=h=>{const w=h.target.files?.[0];r(w||null)},o.click()})}}const yu=new eI;class Sw{watchId=null;lastPosition=null;async getCurrentPosition(){return new Promise((r,o)=>{if(!navigator.geolocation){o(new Error("Geolocation not supported"));return}navigator.geolocation.getCurrentPosition(h=>{const y={lat:h.coords.latitude,lon:h.coords.longitude,accuracy:h.coords.accuracy,timestamp:h.timestamp};this.lastPosition=y,r(y)},h=>{o(this.handleError(h))},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})})}watchPosition(r){if(!navigator.geolocation){console.error("Geolocation not supported");return}this.watchId=navigator.geolocation.watchPosition(o=>{const h={lat:o.coords.latitude,lon:o.coords.longitude,accuracy:o.coords.accuracy,timestamp:o.timestamp};this.lastPosition=h,r(h)},o=>{console.error("Watch position error:",this.handleError(o))},{enableHighAccuracy:!0,timeout:15e3,maximumAge:5e3})}stopWatching(){this.watchId!==null&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null)}getLastPosition(){return this.lastPosition}handleError(r){switch(r.code){case r.PERMISSION_DENIED:return new Error("Location permission denied. Please enable GPS access.");case r.POSITION_UNAVAILABLE:return new Error("Location unavailable. Please check GPS settings.");case r.TIMEOUT:return new Error("Location request timed out. Please try again.");default:return new Error("Unknown location error")}}static calculateDistance(r,o,h,y){const x=r*Math.PI/180,c=h*Math.PI/180,V=(h-r)*Math.PI/180,G=(y-o)*Math.PI/180,Y=Math.sin(V/2)*Math.sin(V/2)+Math.cos(x)*Math.cos(c)*Math.sin(G/2)*Math.sin(G/2);return 6371e3*(2*Math.atan2(Math.sqrt(Y),Math.sqrt(1-Y)))}static createBoundingBox(r,o,h){const y=h/111320,w=h/(111320*Math.cos(r*Math.PI/180));return{minLat:r-y,maxLat:r+y,minLon:o-w,maxLon:o+w}}}const tI=({currentLocation:n,getDatasetValues:r,onCapture:o,onClose:h})=>{const[y,w]=st.useState(n),[x,c]=st.useState(null),[V,G]=st.useState(null),[Y,Q]=st.useState({}),[H,Le]=st.useState(null),[Be,be]=st.useState(""),[$e,re]=st.useState(!1),[J,le]=st.useState(!1),[we,Ze]=st.useState(!1);st.useEffect(()=>{y||(Ze(!0),new Sw().getCurrentPosition().then(je=>w(je)).catch(console.error).finally(()=>Ze(!1)))},[y]),st.useEffect(()=>{y&&r(y.lat,y.lon).then(Q).catch(console.error)},[y,r]);const He=st.useCallback(async()=>{le(!0);try{const ve=await yu.captureFromCamera();if(ve){const je=await yu.processImage(ve);if(c(je),je.exif.lat&&je.exif.lon&&w({lat:je.exif.lat,lon:je.exif.lon,accuracy:0,timestamp:Date.now()}),je.thumbnail)G(je.thumbnail);else{const tt=await yu.getImageUrl(je.blobId);G(tt)}}}catch(ve){console.error("Capture failed:",ve)}finally{le(!1)}},[]),Xe=st.useCallback(async()=>{le(!0);try{const ve=await yu.selectFromGallery();if(ve){const je=await yu.processImage(ve);if(c(je),je.exif.lat&&je.exif.lon&&w({lat:je.exif.lat,lon:je.exif.lon,accuracy:0,timestamp:Date.now()}),je.thumbnail)G(je.thumbnail);else{const tt=await yu.getImageUrl(je.blobId);G(tt)}}}catch(ve){console.error("Gallery selection failed:",ve)}finally{le(!1)}},[]),fe=st.useCallback(()=>{if(!H||!y)return;const ve={id:uw(),timestamp:new Date().toISOString(),location:y,context:{region:"Western Ghats",areaMode:"point"},datasetValues:Y,image:x||void 0,userValidation:H,notes:Be,synced:!1};o(ve)},[H,y,Y,x,Be,o]);return O.jsxs("div",{className:"capture-modal",children:[O.jsxs("div",{className:"capture-modal-header",children:[O.jsx("h3",{children:" Capture Observation"}),O.jsx("button",{className:"bottom-sheet-close",onClick:h,children:""})]}),O.jsxs("div",{className:"capture-modal-content",children:[O.jsx("div",{className:"photo-preview",onClick:V?void 0:He,children:J?O.jsx("div",{className:"loading",children:O.jsx("div",{className:"loading-spinner"})}):V?O.jsx("img",{src:V,alt:"Captured"}):O.jsxs("div",{className:"photo-preview-placeholder",children:[O.jsx("span",{children:""}),O.jsx("p",{children:"Tap to capture photo"})]})}),!V&&!J&&O.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"16px"},children:[O.jsx("button",{onClick:He,style:{flex:1,padding:"10px",background:"var(--accent)",border:"none",borderRadius:"8px",color:"white",cursor:"pointer"},children:" Camera"}),O.jsx("button",{onClick:Xe,style:{flex:1,padding:"10px",background:"var(--bg-tertiary)",border:"1px solid var(--border)",borderRadius:"8px",color:"var(--text-primary)",cursor:"pointer"},children:" Gallery"})]}),O.jsxs("div",{style:{marginBottom:"16px"},children:[O.jsx("div",{className:"dataset-values-title",children:"Location"}),we?O.jsx("div",{style:{color:"var(--text-muted)",fontSize:"13px"},children:"Getting location..."}):y?O.jsxs("div",{className:"dataset-value-row",children:[O.jsx("span",{className:"dataset-value-layer",children:"Coordinates"}),O.jsxs("span",{className:"dataset-value-data",children:[y.lat.toFixed(6),", ",y.lon.toFixed(6),y.accuracy>0&&` (${Math.round(y.accuracy)}m)`]})]}):O.jsx("div",{style:{color:"var(--error)",fontSize:"13px"},children:"Location unavailable"})]}),O.jsxs("div",{className:"dataset-values",children:[O.jsx("div",{className:"dataset-values-title",children:"Dataset Values at Location"}),Object.keys(Y).length>0?Object.entries(Y).map(([ve,je])=>O.jsxs("div",{className:"dataset-value-row",children:[O.jsx("span",{className:"dataset-value-layer",children:ve}),O.jsx("span",{className:"dataset-value-data",children:rI(je)})]},ve)):O.jsx("div",{style:{color:"var(--text-muted)",fontSize:"13px",padding:"8px 0"},children:"No active layers or data at this location"})]}),O.jsx("div",{className:"dataset-values-title",style:{marginTop:"16px",marginBottom:"8px"},children:"Validation"}),O.jsxs("div",{className:"validation-buttons",children:[O.jsxs("button",{className:`validation-btn match ${H==="match"?"selected":""}`,onClick:()=>Le("match"),children:[O.jsx("span",{children:""}),"Match"]}),O.jsxs("button",{className:`validation-btn mismatch ${H==="mismatch"?"selected":""}`,onClick:()=>Le("mismatch"),children:[O.jsx("span",{children:""}),"Mismatch"]}),O.jsxs("button",{className:`validation-btn unclear ${H==="unclear"?"selected":""}`,onClick:()=>Le("unclear"),children:[O.jsx("span",{children:""}),"Unclear"]})]}),O.jsxs("div",{className:"notes-section",children:[O.jsxs("div",{className:"notes-toggle",onClick:()=>re(!$e),children:[" ",$e?"Hide notes":"Add notes (optional)"]}),$e&&O.jsx("textarea",{className:"notes-input",placeholder:"Add observation notes...",value:Be,onChange:ve=>be(ve.target.value)})]}),O.jsx("button",{className:"submit-btn",disabled:!H||!y,onClick:fe,children:"Save Observation"})]})]})};function rI(n){if(!n||Object.keys(n).length===0)return"No data";if(n._source==="csv_summary"){const o=n._year,h=n._recordCount;return o?`${o} (${h} records)`:`${h} records`}const r=Object.entries(n).filter(([o])=>!o.startsWith("_"));return r.length===0?"No data":r.slice(0,2).map(([,o])=>String(o)).join(", ")}function nI(n,r,o){var h,y;typeof n=="function"?(h=r||[],y=o):(h=[],y=r);var w=_c.useRef({hasResult:!1,result:y,error:null}),x=_c.useReducer(function(G){return G+1},0);x[0];var c=x[1],V=_c.useMemo(function(){var G=typeof n=="function"?n():n;if(!G||typeof G.subscribe!="function")throw n===G?new TypeError("Given argument to useObservable() was neither a valid observable nor a function."):new TypeError("Observable factory given to useObservable() did not return a valid observable.");if(!w.current.hasResult&&typeof window<"u"&&(typeof G.hasValue!="function"||G.hasValue()))if(typeof G.getValue=="function")w.current.result=G.getValue(),w.current.hasResult=!0;else{var Y=G.subscribe(function(Q){w.current.result=Q,w.current.hasResult=!0});typeof Y=="function"?Y():Y.unsubscribe()}return G},h);if(_c.useDebugValue(w.current.result),_c.useEffect(function(){var G=V.subscribe(function(Y){var Q=w.current;(Q.error!==null||Q.result!==Y)&&(Q.error=null,Q.result=Y,Q.hasResult=!0,c())},function(Y){var Q=w.current;Q.error!==Y&&(Q.error=Y,c())});return typeof G=="function"?G:G.unsubscribe.bind(G)},h),w.current.error)throw w.current.error;return w.current.result}function iI(n,r,o){return nI(function(){return fT(n)},r||[],o)}const aI=({onGoToLocation:n})=>{const[r,o]=st.useState("all"),[h,y]=st.useState({}),[w,x]=st.useState(null),[c,V]=st.useState({current:0,total:0,status:"idle",message:""});st.useEffect(()=>{xx.then(Be=>{Be||x("Database unavailable. Try clearing browser data or using incognito mode.")})},[]);const G=iI(async()=>{if(!await xx)return[];let be=ms.observations.orderBy("timestamp").reverse();return r!=="all"&&(be=ms.observations.where("userValidation").equals(r).reverse()),await be.limit(50).toArray()},[r]);st.useEffect(()=>{G&&G.forEach(async Be=>{if(Be.image?.blobId&&!h[Be.image.blobId]){const be=Be.image.thumbnail||await yu.getImageUrl(Be.image.blobId);be&&y($e=>({...$e,[Be.image.blobId]:be}))}})},[G,h]);const Y=st.useCallback(async Be=>{if(!G||G.length===0){alert("No observations to export");return}let be,$e,re;Be==="geojson"?(be=await _T(G),$e=`wg_observations_${new Date().toISOString().split("T")[0]}.geojson`,re="application/json"):(be=await vT(G),$e=`wg_observations_${new Date().toISOString().split("T")[0]}.csv`,re="text/csv");const J=new Blob([be],{type:re}),le=URL.createObjectURL(J),we=document.createElement("a");we.href=le,we.download=$e,we.click(),URL.revokeObjectURL(le)},[G]),Q=st.useCallback(async()=>{if(!G||G.length===0){alert("No observations to sync");return}V({current:0,total:G.length,status:"syncing",message:"Starting sync..."});let Be=0,be=0;for(let $e=0;$e<G.length;$e++){const re=G[$e],J=re.location.lat,le=re.location.lon;V(we=>({...we,current:$e+1,message:`Enriching observation ${$e+1} of ${G.length}...`}));try{const we={...re.datasetValues};try{V(Xe=>({...Xe,message:`[${$e+1}/${G.length}] Fetching weather...`}));const He=await Np.getWeather(J,le);He&&He.current&&(we.weather_temp=He.current.temperature,we.weather_humidity=He.current.humidity,we.weather_description=He.current.weatherDescription,we.weather_precip=He.current.precipitation)}catch(He){console.warn("Weather fetch failed:",He)}try{V(Xe=>({...Xe,message:`[${$e+1}/${G.length}] Fetching land cover...`}));const He=await Bp.fetchPointData(J,le);He&&(we.dw_landcover=He.landCoverClass,we.dw_confidence=He.confidence,we.dw_trees=He.probabilities.trees,we.dw_crops=He.probabilities.crops,we.dw_built=He.probabilities.built)}catch(He){console.warn("Dynamic World fetch failed:",He)}try{if(id.isAvailable()){V(Xe=>({...Xe,message:`[${$e+1}/${G.length}] Fetching CoreStack...`}));const He=await id.enrichLocation(J,le);He&&He.admin&&(we.corestack_state=He.admin.state_name,we.corestack_district=He.admin.district_name,we.corestack_tehsil=He.admin.tehsil_name,we.corestack_mws_id=He.mwsId),He&&He.indicators&&He.indicators.forEach(Xe=>{we[`corestack_${Xe.indicator_name.toLowerCase().replace(/\s+/g,"_")}`]=Xe.value})}}catch(He){console.warn("CoreStack fetch failed:",He)}const Ze={...re.datasetValues,sync_data:we};await ms.observations.update(re.id,{datasetValues:Ze,synced:!0}),Be++}catch(we){console.error(`Failed to sync observation ${re.id}:`,we),be++}await new Promise(we=>setTimeout(we,300))}V({current:G.length,total:G.length,status:"complete",message:`Sync complete! ${Be} enriched, ${be} errors`}),setTimeout(()=>{V({current:0,total:0,status:"idle",message:""})},3e3)},[G]),H=Be=>new Date(Be).toLocaleString("en-IN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Le=Be=>{switch(Be){case"match":return" Match";case"mismatch":return" Mismatch";case"unclear":return" Unclear"}};return O.jsxs("div",{className:"field-log",children:[w&&O.jsxs("div",{className:"db-error-banner",style:{background:"#ff6b6b22",border:"1px solid #ff6b6b",borderRadius:"8px",padding:"12px",margin:"8px",color:"#ff6b6b",fontSize:"13px"},children:[" ",w]}),O.jsxs("div",{className:"field-log-filters",children:[O.jsx("button",{className:`filter-chip ${r==="all"?"active":""}`,onClick:()=>o("all"),children:"All"}),O.jsx("button",{className:`filter-chip ${r==="match"?"active":""}`,onClick:()=>o("match"),children:" Match"}),O.jsx("button",{className:`filter-chip ${r==="mismatch"?"active":""}`,onClick:()=>o("mismatch"),children:" Mismatch"}),O.jsx("button",{className:`filter-chip ${r==="unclear"?"active":""}`,onClick:()=>o("unclear"),children:" Unclear"})]}),G?G.length===0?O.jsxs("div",{className:"empty-state",children:[O.jsx("div",{className:"empty-state-icon",children:""}),O.jsx("p",{className:"empty-state-text",children:"No observations yet. Use the capture button to add field observations."})]}):O.jsxs(O.Fragment,{children:[G.map(Be=>O.jsxs("div",{className:"log-entry",onClick:()=>n(Be.location.lat,Be.location.lon),children:[O.jsx("div",{className:"log-entry-thumb",children:Be.image?.blobId&&h[Be.image.blobId]?O.jsx("img",{src:h[Be.image.blobId],alt:"Observation"}):O.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",fontSize:"24px",color:"var(--text-muted)"},children:""})}),O.jsxs("div",{className:"log-entry-info",children:[O.jsxs("div",{className:"log-entry-time",children:[H(Be.timestamp),O.jsx("span",{className:`log-entry-validation ${Be.userValidation}`,children:Le(Be.userValidation)})]}),O.jsxs("div",{className:"log-entry-location",children:[" ",Be.location.lat.toFixed(5),", ",Be.location.lon.toFixed(5)]}),O.jsxs("div",{className:"log-entry-datasets",children:[Object.keys(Be.datasetValues).length," layers queried",Be.notes&&`  ${Be.notes.substring(0,30)}${Be.notes.length>30?"...":""}`]})]})]},Be.id)),O.jsxs("div",{className:"export-buttons",children:[O.jsx("button",{className:`export-btn sync-btn ${c.status==="syncing"?"syncing":""}`,onClick:Q,disabled:c.status==="syncing",children:c.status==="syncing"?O.jsxs(O.Fragment,{children:[O.jsx("span",{className:"sync-spinner"}),"Syncing..."]}):c.status==="complete"?O.jsx(O.Fragment,{children:" Synced"}):O.jsx(O.Fragment,{children:" Sync Data"})}),O.jsx("button",{className:"export-btn",onClick:()=>Y("geojson"),disabled:c.status==="syncing",children:" GeoJSON"}),O.jsx("button",{className:"export-btn",onClick:()=>Y("csv"),disabled:c.status==="syncing",children:" CSV"})]}),c.status!=="idle"&&O.jsxs("div",{className:`sync-progress ${c.status}`,children:[O.jsx("div",{className:"sync-progress-bar",children:O.jsx("div",{className:"sync-progress-fill",style:{width:`${c.current/c.total*100}%`}})}),O.jsx("div",{className:"sync-progress-text",children:c.message})]})]}):O.jsx("div",{className:"loading",children:O.jsx("div",{className:"loading-spinner"})})]})},sI=[{id:"getting-started",title:"Getting Started",icon:"",content:[{heading:"First Launch",steps:["Grant location permissions when prompted for GPS tracking","The app works offline - data syncs automatically when connected","Your position is shown as a blue dot on the map"],tips:["Enable high-accuracy GPS in your device settings for best results"]}]},{id:"navigation",title:"Navigation",icon:"",content:[{heading:"Bottom Navigation Bar",steps:[" Map - Main map view with all layers and controls"," Layers - Toggle map layers on/off by category"," Guide - Field protocols and this app guide"," Log - View, export, and sync your field observations"]},{heading:"Map Controls (Right Side)",steps:["+ /  Zoom in and out"," Center map on your current GPS location"," Reset view to Western Ghats boundary","/ Toggle between satellite and dark basemap"]}]},{id:"layers",title:"Using Layers",icon:"",content:[{heading:"Layer Panel Features",steps:["Tap the Layers tab to open the layer panel","Browse by Category: Forest, LULC, Built Area, etc.","Browse by Timeline: View layers by year (2015-2025)","Browse All: See complete list of 25+ layers","Use search to quickly find specific layers"],tips:["Enable/disable entire categories with one tap","Layer legend shows what each color means","Multiple layers can be active simultaneously"]},{heading:"Available Layer Categories",steps:[" Forest - Forest type classification, tree cover density"," LULC - Land use/land cover maps by year"," Built Area - Urban and settlement extent"," Plantations - Coffee, rubber, and other plantations"," Boundaries - Western Ghats boundary, districts"]}]},{id:"capturing",title:"Capturing Observations",icon:"",content:[{heading:"Creating a New Observation",steps:["Tap the + button in the center of the bottom navigation","Your GPS location is automatically captured","Select the observation type (Land Cover, Forest, etc.)","Choose validation status if ground-truthing","Add photos by tapping the camera icon","Write detailed notes about what you observe","Tap Save to store the observation locally"],tips:["Observations are saved offline and sync when online","Take photos in all 4 cardinal directions for context","Include specific species names when possible"]}]},{id:"location-info",title:"Location Information",icon:"",content:[{heading:"Getting Details for Any Location",steps:["Tap anywhere on the map to see location details","Or use the search bar to find a specific place","The Location Info panel shows weather, elevation, etc.","View Dynamic World land cover classification","Check CoreStack environmental data if available"],note:"Some data requires internet connection to fetch"}]},{id:"field-log",title:"Managing Your Field Log",icon:"",content:[{heading:"Viewing and Exporting Observations",steps:["Tap the Log tab to see all your observations","Filter by validation status using the dropdown","Tap any observation to view details or navigate to it","Use Export GeoJSON for GIS-compatible format","Use Export CSV for spreadsheet format","Tap Sync to pull additional data from services"],tips:["Sync enriches observations with weather, land cover data","Export regularly as backup of your field work","GeoJSON can be imported into QGIS, ArcGIS, etc."]}]},{id:"offline",title:"Offline Mode",icon:"",content:[{heading:"Working Without Internet",steps:["All observations are saved locally on your device","Map tiles are cached as you browse","Raster layers (LULC, Forest) work fully offline","When back online, tap Sync to fetch external data","The header shows online/offline status"],tips:["Pre-load map areas before going to remote locations","Enable all layers once to cache their imagery"]}]}],Ux=[{id:"tree-survey",title:"Tree Inventory Survey",category:"measurement",difficulty:"intermediate",estimatedTime:"15-30 min per plot",description:"Systematic documentation of tree species, DBH, height, and health status within a defined plot.",steps:["Define a 10m x 10m plot or use GPS to mark boundaries","Identify all trees with DBH  10cm","Measure DBH at 1.3m height using tape","Estimate tree height using clinometer or visual estimation","Record species name (local or scientific)","Assess tree health (healthy, stressed, dead)","Note any signs of disease, damage, or regeneration","Take photos of notable specimens"],equipment:["Measuring tape","DBH tape","Clinometer (optional)","GPS device","Field notebook"],dataFields:["Species","DBH (cm)","Height (m)","Health Status","Crown Condition","Notes"]},{id:"land-cover-validation",title:"Land Cover Ground Truth",category:"observation",difficulty:"basic",estimatedTime:"5-10 min per point",description:"Validate satellite-derived land cover classifications with actual ground conditions.",steps:["Navigate to the target coordinates","Stand at the exact location or as close as possible","Observe land cover in a 30m radius (Landsat pixel size)","Identify the dominant land cover type","Estimate percentage cover of each class present","Note any recent changes (fire, clearing, construction)","Take photos in 4 cardinal directions","Record confidence level of observation"],equipment:["GPS device","Camera","Compass","Field notebook"],dataFields:["Primary Land Cover","Secondary Cover","Cover %","Recent Change","Confidence"]},{id:"water-body-assessment",title:"Water Body Assessment",category:"measurement",difficulty:"intermediate",estimatedTime:"20-45 min per site",description:"Comprehensive assessment of water bodies including physical, chemical, and biological indicators.",steps:["Document water body type (stream, pond, tank, etc.)","Measure approximate dimensions (length, width, depth)","Assess water clarity and color","Check for visible pollution or algal blooms","Note surrounding land use and vegetation","Document inflow and outflow points","Identify any aquatic vegetation or wildlife","Take water sample if testing equipment available"],equipment:["Measuring tape","Depth stick","Water testing kit (optional)","GPS","Camera"],dataFields:["Water Body Type","Dimensions","Clarity","Pollution Signs","Biodiversity Notes"]},{id:"restoration-monitoring",title:"Restoration Site Monitoring",category:"documentation",difficulty:"advanced",estimatedTime:"30-60 min per site",description:"Track progress of eco-restoration sites including survival rates, growth, and natural regeneration.",steps:["Locate and verify restoration plot boundaries","Count surviving planted trees vs. original count","Measure sample of trees for height and canopy spread","Document natural regeneration (species, count)","Assess ground cover and grass establishment","Check soil moisture and erosion control structures","Note pest/disease issues if any","Compare with previous monitoring data","Photograph fixed photo points"],equipment:["GPS","Measuring tape","Height pole","Previous monitoring data","Camera"],dataFields:["Survival Rate","Avg Height","Canopy Cover","Natural Regeneration","Soil Condition"]},{id:"biodiversity-quick",title:"Quick Biodiversity Survey",category:"observation",difficulty:"basic",estimatedTime:"15-20 min per location",description:"Rapid assessment of visible biodiversity including birds, butterflies, and notable plant species.",steps:["Remain stationary and quiet for 5 minutes","Record all bird species seen or heard","Note butterfly and other insect activity","Document any mammals or reptiles observed","Identify notable flowering plants","Record fruiting/flowering phenology","Note signs of wildlife (tracks, droppings, nests)","Assess overall habitat quality"],equipment:["Binoculars","Field guide (optional)","Camera","Field notebook"],dataFields:["Bird Species","Butterfly Count","Other Wildlife","Notable Plants","Habitat Quality"]},{id:"erosion-assessment",title:"Soil Erosion Assessment",category:"measurement",difficulty:"intermediate",estimatedTime:"15-25 min per site",description:"Evaluate soil erosion severity and effectiveness of conservation measures.",steps:["Identify erosion type (sheet, rill, gully)","Measure gully dimensions if present","Estimate erosion severity (mild, moderate, severe)","Document slope angle and aspect","Assess vegetation cover percentage","Note existing conservation structures","Check effectiveness of bunds/trenches","Recommend additional measures if needed"],equipment:["Measuring tape","Clinometer","GPS","Camera"],dataFields:["Erosion Type","Severity","Slope","Veg Cover %","Conservation Structures"]}],qh={observation:"#4a9eff",measurement:"#4caf50",sampling:"#ff9800",documentation:"#9c27b0"},Vx={basic:"#4caf50",intermediate:"#ff9800",advanced:"#f44336"},oI=({onClose:n,onStartProtocol:r})=>{const[o,h]=st.useState(null),[y,w]=st.useState("all"),[x,c]=st.useState("guide"),[V,G]=st.useState("getting-started"),Y=y==="all"?Ux:Ux.filter(H=>H.category===y),Q=()=>O.jsxs("div",{className:"app-guide-content",children:[O.jsx("div",{className:"guide-intro",children:O.jsx("p",{children:"Welcome to the Western Ghats Field Validator! This guide will help you use all features of the app effectively."})}),O.jsx("div",{className:"guide-sections",children:sI.map(H=>O.jsxs("div",{className:"guide-section-card",children:[O.jsxs("button",{className:`guide-section-header ${V===H.id?"expanded":""}`,onClick:()=>G(V===H.id?null:H.id),children:[O.jsx("span",{className:"guide-section-icon",children:H.icon}),O.jsx("span",{className:"guide-section-title",children:H.title}),O.jsx("svg",{className:`guide-chevron ${V===H.id?"open":""}`,viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:O.jsx("path",{d:"M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"})})]}),V===H.id&&O.jsx("div",{className:"guide-section-content",children:H.content.map((Le,Be)=>O.jsxs("div",{className:"guide-content-block",children:[O.jsx("h4",{children:Le.heading}),Le.steps&&O.jsx("ul",{className:"guide-steps",children:Le.steps.map((be,$e)=>O.jsx("li",{children:be},$e))}),Le.tips&&O.jsxs("div",{className:"guide-tips",children:[O.jsx("span",{className:"tips-label",children:" Tips:"}),O.jsx("ul",{children:Le.tips.map((be,$e)=>O.jsx("li",{children:be},$e))})]}),Le.note&&O.jsx("div",{className:"guide-note",children:O.jsxs("span",{children:[" ",Le.note]})})]},Be))})]},H.id))})]});return O.jsxs("div",{className:"field-protocols-panel",children:[O.jsxs("div",{className:"panel-header",children:[O.jsxs("h2",{children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:O.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"})}),x==="guide"?"App Guide":"Field Protocols"]}),O.jsx("button",{className:"close-btn",onClick:n,children:O.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:O.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),O.jsxs("div",{className:"protocols-view-tabs",children:[O.jsxs("button",{className:`view-tab ${x==="guide"?"active":""}`,onClick:()=>c("guide"),children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",children:O.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})}),"How to Use"]}),O.jsxs("button",{className:`view-tab ${x==="protocols"?"active":""}`,onClick:()=>{c("protocols"),h(null)},children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",children:O.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"})}),"Field Protocols"]})]}),x==="guide"?Q():o?O.jsxs("div",{className:"protocol-detail",children:[O.jsxs("button",{className:"back-btn",onClick:()=>h(null),children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:O.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})}),"Back to Protocols"]}),O.jsxs("div",{className:"detail-header",children:[O.jsxs("div",{className:"badges",children:[O.jsx("span",{className:"category-badge",style:{backgroundColor:qh[o.category]},children:o.category}),O.jsx("span",{className:"difficulty-badge",style:{backgroundColor:Vx[o.difficulty]},children:o.difficulty})]}),O.jsx("h2",{children:o.title}),O.jsxs("p",{className:"time-estimate",children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",children:O.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"})}),o.estimatedTime]}),O.jsx("p",{className:"description",children:o.description})]}),O.jsxs("div",{className:"detail-section",children:[O.jsxs("h3",{children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",children:O.jsx("path",{d:"M22 5.18L10.59 16.6l-4.24-4.24 1.41-1.41 2.83 2.83 10-10L22 5.18zm-2.21 5.04c.13.57.21 1.17.21 1.78 0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8c1.58 0 3.04.46 4.28 1.25l1.44-1.44C16.1 2.67 14.13 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-1.19-.22-2.33-.6-3.39l-1.61 1.61z"})}),"Procedure (",o.steps.length," steps)"]}),O.jsx("ol",{className:"steps-list",children:o.steps.map((H,Le)=>O.jsx("li",{children:H},Le))})]}),O.jsxs("div",{className:"detail-section",children:[O.jsxs("h3",{children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",children:O.jsx("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"})}),"Equipment Needed"]}),O.jsx("ul",{className:"equipment-list",children:o.equipment.map((H,Le)=>O.jsx("li",{children:H},Le))})]}),O.jsxs("div",{className:"detail-section",children:[O.jsxs("h3",{children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",children:O.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 14H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"})}),"Data Fields to Record"]}),O.jsx("div",{className:"data-fields",children:o.dataFields.map((H,Le)=>O.jsx("span",{className:"field-tag",children:H},Le))})]}),O.jsxs("button",{className:"start-protocol-btn",onClick:()=>r(o.id),children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:O.jsx("path",{d:"M8 5v14l11-7z"})}),"Start This Protocol"]})]}):O.jsxs(O.Fragment,{children:[O.jsxs("div",{className:"protocol-filters",children:[O.jsx("button",{className:`filter-chip ${y==="all"?"active":""}`,onClick:()=>w("all"),children:"All"}),O.jsx("button",{className:`filter-chip ${y==="observation"?"active":""}`,onClick:()=>w("observation"),style:{"--chip-color":qh.observation},children:"Observation"}),O.jsx("button",{className:`filter-chip ${y==="measurement"?"active":""}`,onClick:()=>w("measurement"),style:{"--chip-color":qh.measurement},children:"Measurement"}),O.jsx("button",{className:`filter-chip ${y==="documentation"?"active":""}`,onClick:()=>w("documentation"),style:{"--chip-color":qh.documentation},children:"Documentation"})]}),O.jsx("div",{className:"protocol-list",children:Y.map(H=>O.jsxs("div",{className:"protocol-card",onClick:()=>h(H),children:[O.jsxs("div",{className:"protocol-header",children:[O.jsx("span",{className:"category-badge",style:{backgroundColor:qh[H.category]},children:H.category}),O.jsx("span",{className:"difficulty-badge",style:{backgroundColor:Vx[H.difficulty]},children:H.difficulty})]}),O.jsx("h3",{children:H.title}),O.jsx("p",{children:H.description}),O.jsxs("div",{className:"protocol-meta",children:[O.jsxs("span",{children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"14",height:"14",fill:"currentColor",children:O.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"})}),H.estimatedTime]}),O.jsxs("span",{children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"14",height:"14",fill:"currentColor",children:O.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"})}),H.steps.length," steps"]})]})]},H.id))})]})]})},$x=[{id:"tectona-grandis",commonName:"Teak",scientificName:"Tectona grandis",localName:"Sagwan (Hindi), Theku (Kannada)",category:"tree",conservationStatus:"LC",endemic:!1,medicinal:!0,restorationValue:"medium",habitat:["Deciduous forest","Plantation"],characteristics:"Large deciduous tree, 30-40m tall. Large leaves (30-60cm), small white flowers. Bark grey-brown, fissured.",uses:"Premium timber, medicinal (bark for inflammation), erosion control"},{id:"terminalia-arjuna",commonName:"Arjuna",scientificName:"Terminalia arjuna",localName:"Arjun (Hindi), Matthi (Kannada)",category:"tree",conservationStatus:"LC",endemic:!1,medicinal:!0,restorationValue:"high",habitat:["Riverine","Moist deciduous"],characteristics:"Large evergreen tree, 20-25m. Smooth grey bark that peels in sheets. Buttressed trunk. Leaves oblong with two glands.",uses:"Cardiac tonic (bark), silk production, riverbank stabilization"},{id:"ficus-benghalensis",commonName:"Banyan",scientificName:"Ficus benghalensis",localName:"Bargad (Hindi), Aalada Mara (Kannada)",category:"tree",conservationStatus:"LC",endemic:!1,medicinal:!0,restorationValue:"high",habitat:["Mixed forest","Village groves"],characteristics:"Massive spreading tree with aerial roots forming secondary trunks. Leathery oval leaves. Red figs in pairs.",uses:"Sacred tree, wildlife food source, shade, traditional medicine"},{id:"artocarpus-heterophyllus",commonName:"Jackfruit",scientificName:"Artocarpus heterophyllus",localName:"Kathal (Hindi), Halasu (Kannada)",category:"tree",conservationStatus:"LC",endemic:!1,medicinal:!0,restorationValue:"high",habitat:["Evergreen forest","Home gardens"],characteristics:"Medium tree 8-25m. Dark green leathery leaves. Cauliflorous (fruits on trunk). Largest tree-borne fruit.",uses:"Edible fruit, timber, latex, agroforestry"},{id:"myristica-malabarica",commonName:"Malabar Nutmeg",scientificName:"Myristica malabarica",localName:"Rampatri (Hindi), Panampu (Kannada)",category:"tree",conservationStatus:"VU",endemic:!0,medicinal:!0,restorationValue:"high",habitat:["Myristica swamp","Evergreen forest"],characteristics:"Endemic to Western Ghats swamps. Stilt roots in swampy areas. Aromatic bark. Red aril around seed.",uses:"Spice, medicinal, indicator of sacred grove health"},{id:"hopea-ponga",commonName:"Kambuga",scientificName:"Hopea ponga",localName:"Kambuga (Kannada)",category:"tree",conservationStatus:"EN",endemic:!0,medicinal:!1,restorationValue:"high",habitat:["Lowland evergreen","Sacred groves"],characteristics:"Endangered endemic. Medium tree with buttresses. Leaves with parallel veins. Small fragrant flowers.",uses:"Quality timber (now protected), ecosystem restoration"},{id:"garcinia-indica",commonName:"Kokum",scientificName:"Garcinia indica",localName:"Kokum (Marathi/Konkani), Murgina (Kannada)",category:"tree",conservationStatus:"VU",endemic:!0,medicinal:!0,restorationValue:"high",habitat:["Evergreen forest","Semi-evergreen"],characteristics:"Small to medium tree. Dense pyramidal crown. Dark green glossy leaves. Purple fruits with acidic pulp.",uses:"Culinary (sour agent), kokum butter, medicinal (digestive)"},{id:"dipterocarpus-indicus",commonName:"Indian Dipterocarps",scientificName:"Dipterocarpus indicus",localName:"Gurjan (Hindi)",category:"tree",conservationStatus:"CR",endemic:!0,medicinal:!1,restorationValue:"high",habitat:["Lowland evergreen"],characteristics:"Critically endangered. Tall emergent tree. Large leaves. Characteristic winged fruits. Produces valuable oleoresin.",uses:"Timber (protected), resin, old growth forest restoration"},{id:"calamus-rotang",commonName:"Rattan",scientificName:"Calamus rotang",localName:"Bet (Hindi), Betta (Kannada)",category:"climber",conservationStatus:"NT",endemic:!1,medicinal:!0,restorationValue:"medium",habitat:["Evergreen forest understory"],characteristics:"Climbing palm with thorny leaf sheaths. Long flexible stems. Needs host trees for support.",uses:"Cane furniture, medicinal, indicator of forest health"},{id:"strobilanthes-kunthiana",commonName:"Neelakurinji",scientificName:"Strobilanthes kunthiana",localName:"Kurinji (Tamil)",category:"shrub",conservationStatus:"LC",endemic:!0,medicinal:!1,restorationValue:"medium",habitat:["Shola grassland","High altitude"],characteristics:"Flowers once in 12 years creating blue carpets on hillsides. 30-60cm shrub. Indicator of shola ecosystem.",uses:"Honey production, cultural significance, eco-tourism"},{id:"bambusa-bambos",commonName:"Giant Thorny Bamboo",scientificName:"Bambusa bambos",localName:"Kanta Baans (Hindi), Bidiru (Kannada)",category:"grass",conservationStatus:"LC",endemic:!1,medicinal:!0,restorationValue:"high",habitat:["Moist deciduous","Riverine"],characteristics:"Clump-forming giant bamboo, 15-30m. Thorny culms. Fast growing. Important for ecosystem restoration.",uses:"Construction, paper, erosion control, carbon sequestration"},{id:"caryota-urens",commonName:"Fishtail Palm",scientificName:"Caryota urens",localName:"Bherli Mad (Marathi), Baine (Kannada)",category:"palm",conservationStatus:"LC",endemic:!1,medicinal:!1,restorationValue:"medium",habitat:["Semi-evergreen","Moist deciduous"],characteristics:"Distinctive fishtail-shaped leaflets. Single-stemmed palm, 12-20m. Flowers once then dies (monocarpic).",uses:"Toddy, jaggery, fiber, wildlife food"}],_g={tree:"M12 2L4.5 20.3l.7.7L12 18l6.8 3 .7-.7L12 2z",shrub:"M12 6c-2.67 0-8 1.34-8 4v10h16V10c0-2.66-5.33-4-8-4z",herb:"M12 22c-4.97 0-9-4.03-9-9 0-4.17 2.77-7.69 6.57-8.74C10.22 6.33 12 8.97 12 12c0-3.03 1.78-5.67 4.43-7.74C20.23 5.31 23 8.83 23 13c0 4.97-4.03 9-9 9z",climber:"M21 3L3 10.53v.98l6.84 2.65L12.48 21h.98L21 3z",grass:"M12 20l-3-3h2v-4H9l3-3 3 3h-2v4h2l-3 3z",fern:"M17 8C8 10 5.9 16.17 3.82 21.34l1.89.66.95-2.3c.48.17.98.3 1.34.3C19 20 22 3 22 3c-1 2-8 2.25-13 3.25S2 11.5 2 13.5s1.75 3.75 1.75 3.75C7 8 17 8 17 8z",palm:"M12 2L9 9l3-1 3 1-3-7zm-6.35 6.96L12 12l-1.24 2.69-5.11-5.73zm12.7 0l-5.11 5.73L12 12l6.35-3.04zM12 14v8h-.01c-.01-2.48-.71-4.56-1.85-5.94L12 14zm0 0c.01 0 .01 0 0 0l1.86 2.06c-1.14 1.38-1.84 3.46-1.85 5.94H12v-8z"},yc={LC:{bg:"#4caf5020",text:"#4caf50",label:"Least Concern"},NT:{bg:"#8bc34a20",text:"#8bc34a",label:"Near Threatened"},VU:{bg:"#ff980020",text:"#ff9800",label:"Vulnerable"},EN:{bg:"#ff572220",text:"#ff5722",label:"Endangered"},CR:{bg:"#f4433620",text:"#f44336",label:"Critically Endangered"}},lI=({onClose:n,onRecordSpecies:r})=>{const[o,h]=st.useState(""),[y,w]=st.useState("all"),[x,c]=st.useState(!1),[V,G]=st.useState(!1),[Y,Q]=st.useState(null),H=$x.filter(Le=>{const Be=Le.commonName.toLowerCase().includes(o.toLowerCase())||Le.scientificName.toLowerCase().includes(o.toLowerCase())||Le.localName?.toLowerCase().includes(o.toLowerCase()),be=y==="all"||Le.category===y,$e=!x||Le.endemic,re=!V||Le.medicinal;return Be&&be&&$e&&re});return O.jsxs("div",{className:"species-guide-panel",children:[O.jsxs("div",{className:"panel-header",children:[O.jsxs("h2",{children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:O.jsx("path",{d:"M12 22c-4.97 0-9-4.03-9-9 0-4.17 2.77-7.69 6.57-8.74C10.22 6.33 12 8.97 12 12c0-3.03 1.78-5.67 4.43-7.74C20.23 5.31 23 8.83 23 13c0 4.97-4.03 9-9 9z"})}),"Species Guide"]}),O.jsx("button",{className:"close-btn",onClick:n,children:O.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:O.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),Y?O.jsxs("div",{className:"species-detail",children:[O.jsxs("button",{className:"back-btn",onClick:()=>Q(null),children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:O.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})}),"Back to List"]}),O.jsxs("div",{className:"detail-hero",children:[O.jsx("div",{className:"hero-icon",children:O.jsx("svg",{viewBox:"0 0 24 24",width:"48",height:"48",fill:"currentColor",children:O.jsx("path",{d:_g[Y.category]})})}),O.jsxs("div",{className:"hero-info",children:[O.jsx("h2",{children:Y.commonName}),O.jsx("p",{className:"scientific",children:Y.scientificName}),Y.localName&&O.jsx("p",{className:"local-name",children:Y.localName})]})]}),O.jsxs("div",{className:"detail-badges",children:[Y.conservationStatus&&O.jsxs("div",{className:"status-card",style:{backgroundColor:yc[Y.conservationStatus].bg,borderColor:yc[Y.conservationStatus].text},children:[O.jsx("span",{className:"status-code",style:{color:yc[Y.conservationStatus].text},children:Y.conservationStatus}),O.jsx("span",{className:"status-label",children:yc[Y.conservationStatus].label})]}),Y.endemic&&O.jsxs("div",{className:"endemic-card",children:[O.jsx("span",{className:"icon",children:""}),O.jsx("span",{children:"Western Ghats Endemic"})]}),Y.medicinal&&O.jsxs("div",{className:"medicinal-card",children:[O.jsx("span",{className:"icon",children:""}),O.jsx("span",{children:"Medicinal Value"})]})]}),O.jsxs("div",{className:"detail-section",children:[O.jsx("h3",{children:"Restoration Value"}),O.jsxs("div",{className:`restoration-indicator ${Y.restorationValue}`,children:[O.jsx("div",{className:"bar",children:O.jsx("div",{className:"fill"})}),O.jsx("span",{children:Y.restorationValue.toUpperCase()})]})]}),O.jsxs("div",{className:"detail-section",children:[O.jsx("h3",{children:"Habitat"}),O.jsx("div",{className:"habitat-tags",children:Y.habitat.map((Le,Be)=>O.jsx("span",{className:"habitat-tag",children:Le},Be))})]}),O.jsxs("div",{className:"detail-section",children:[O.jsx("h3",{children:"Identification"}),O.jsx("p",{children:Y.characteristics})]}),Y.uses&&O.jsxs("div",{className:"detail-section",children:[O.jsx("h3",{children:"Uses & Significance"}),O.jsx("p",{children:Y.uses})]}),O.jsxs("button",{className:"record-species-btn",onClick:()=>r(Y.id),children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:O.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"})}),"Record Sighting at Current Location"]})]}):O.jsxs(O.Fragment,{children:[O.jsxs("div",{className:"species-search",children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",children:O.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})}),O.jsx("input",{type:"text",placeholder:"Search by name...",value:o,onChange:Le=>h(Le.target.value)})]}),O.jsxs("div",{className:"species-filters",children:[O.jsxs("div",{className:"category-filters",children:[O.jsx("button",{className:`cat-btn ${y==="all"?"active":""}`,onClick:()=>w("all"),children:"All"}),["tree","shrub","climber","palm","grass"].map(Le=>O.jsxs("button",{className:`cat-btn ${y===Le?"active":""}`,onClick:()=>w(Le),children:[O.jsx("svg",{viewBox:"0 0 24 24",width:"14",height:"14",fill:"currentColor",children:O.jsx("path",{d:_g[Le]})}),Le.charAt(0).toUpperCase()+Le.slice(1)]},Le))]}),O.jsxs("div",{className:"toggle-filters",children:[O.jsxs("label",{className:"toggle-filter",children:[O.jsx("input",{type:"checkbox",checked:x,onChange:Le=>c(Le.target.checked)}),O.jsx("span",{className:"endemic-badge",children:"Endemic Only"})]}),O.jsxs("label",{className:"toggle-filter",children:[O.jsx("input",{type:"checkbox",checked:V,onChange:Le=>G(Le.target.checked)}),O.jsx("span",{className:"medicinal-badge",children:"Medicinal"})]})]})]}),O.jsxs("div",{className:"species-count",children:["Showing ",H.length," of ",$x.length," species"]}),O.jsx("div",{className:"species-list",children:H.map(Le=>O.jsxs("div",{className:"species-card",onClick:()=>Q(Le),children:[O.jsx("div",{className:"species-icon",children:O.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:O.jsx("path",{d:_g[Le.category]})})}),O.jsxs("div",{className:"species-info",children:[O.jsx("h3",{children:Le.commonName}),O.jsx("p",{className:"scientific-name",children:Le.scientificName}),O.jsxs("div",{className:"species-badges",children:[Le.conservationStatus&&O.jsx("span",{className:"status-badge",style:{backgroundColor:yc[Le.conservationStatus].bg,color:yc[Le.conservationStatus].text},children:Le.conservationStatus}),Le.endemic&&O.jsx("span",{className:"endemic-tag",children:"Endemic"}),Le.medicinal&&O.jsx("span",{className:"medicinal-tag",children:"Medicinal"}),O.jsxs("span",{className:`restoration-tag ${Le.restorationValue}`,children:[Le.restorationValue," value"]})]})]}),O.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",className:"chevron",children:O.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})})]},Le.id))})]})]})};function uI(){const n=()=>navigator.connection||navigator.mozConnection||navigator.webkitConnection,r=st.useCallback(()=>{const y=n();return{isOnline:navigator.onLine,effectiveType:y?.effectiveType,downlink:y?.downlink,rtt:y?.rtt,saveData:y?.saveData}},[]),[o,h]=st.useState(r);return st.useEffect(()=>{const y=()=>h(r()),w=()=>h(r()),x=()=>h(r());window.addEventListener("online",y),window.addEventListener("offline",w);const c=n();return c&&c.addEventListener("change",x),()=>{window.removeEventListener("online",y),window.removeEventListener("offline",w),c&&c.removeEventListener("change",x)}},[r]),o}const qx={lulc:{label:"Land Use / Land Cover",icon:"",order:1},forest:{label:"Forest Classification",icon:"",order:2},built:{label:"Built-up Area",icon:"",order:3},treecover:{label:"Tree Cover",icon:"",order:4},boundary:{label:"Boundaries",icon:"",order:5},other:{label:"Other Layers",icon:"",order:6}};class cI{manifest=null;isLoaded=!1;async loadManifest(){if(this.isLoaded&&this.manifest)return this.manifest;try{const r=await fetch("/tiles/images/image-manifest.json");return r.ok?(this.manifest=await r.json(),this.isLoaded=!0,console.log(`Loaded ${this.manifest?.layers.length||0} raster layers`),this.manifest):(console.warn("Failed to load raster manifest:",r.status),null)}catch(r){return console.error("Error loading raster manifest:",r),null}}async getRasterLayers(){const r=await this.loadManifest();return r?r.layers.map(o=>this.configToDatasetLayer(o)):[]}configToDatasetLayer(r){return{id:`raster_${r.id}`,title:r.title,type:"image-overlay",source:{format:"png",path:r.image_path},style:{kind:"image",opacity:.7},bounds:r.bounds,year:r.year,description:r.description,category:this.mapCategory(r.category),enabled:!0}}mapCategory(r){return["lulc","forest","built","treecover","boundary","other"].includes(r)?r:"other"}async getLayersByCategory(){const r=await this.getRasterLayers(),o=new Map;for(const h of r){const y=h.category;o.has(y)||o.set(y,[]),o.get(y).push(h)}for(const[,h]of o)h.sort((y,w)=>y.year&&w.year?y.year-w.year:y.year?-1:w.year?1:y.title.localeCompare(w.title));return o}getCategoryInfo(r){return qx[r]||{label:r,icon:"",order:99}}getOrderedCategories(){return Object.entries(qx).sort((r,o)=>r[1].order-o[1].order).map(([r])=>r)}async getLayer(r){return(await this.getRasterLayers()).find(h=>h.id===r)||null}isManifestLoaded(){return this.isLoaded}async getLayerCount(){return(await this.loadManifest())?.layers.length||0}}const hI=new cI,vg=new lw;function dI(){const[n,r]=st.useState([75.5,13]),[o,h]=st.useState(8),[y,w]=st.useState("dark"),[x,c]=st.useState([]),[V,G]=st.useState(new Set(["western_ghats_boundary"])),[Y,Q]=st.useState("map"),[H,Le]=st.useState(!1),[Be,be]=st.useState(!1),[$e,re]=st.useState(!1),[J,le]=st.useState(!1),[we,Ze]=st.useState(null),[He,Xe]=st.useState(null),[fe,ve]=st.useState(0),[je,tt]=st.useState(!1),_t=st.useRef(null),Bt=st.useRef(new Sw),{isOnline:gr}=uI();st.useEffect(()=>((async()=>{try{await vg.initialize();const wt=vg.getLayers(),Ir=await hI.getRasterLayers(),Dr=[...wt,...Ir];c(Dr),console.log(`Loaded ${wt.length} CSV layers, ${Ir.length} raster layers`)}catch(wt){console.error("Failed to load layers:",wt)}})(),(async()=>{const wt=await ms.observations.where("synced").equals(0).count();ve(wt)})(),Bt.current.watchPosition(wt=>{Xe(wt)}),()=>{Bt.current.stopWatching()}),[]);const Gr=st.useCallback((Ht,Nt)=>{r(Ht),h(Nt)},[]),Hr=st.useCallback(Ht=>{G(Nt=>{const wt=new Set(Nt);return wt.has(Ht)?wt.delete(Ht):wt.add(Ht),wt})},[]),ar=st.useCallback(async(Ht,Nt)=>{try{const wt=Array.from(V);return await vg.getValuesAtPoint(Ht,Nt,wt)||{}}catch(wt){return console.error("Failed to query point:",wt),{}}},[V]),at=st.useCallback(async Ht=>{try{await ms.observations.add(Ht),ve(Nt=>Nt+1),Le(!1)}catch(Nt){console.error("Failed to save observation:",Nt)}},[]),it=st.useCallback(()=>_t.current?.zoomIn(),[]),Mt=st.useCallback(()=>_t.current?.zoomOut(),[]),Tt=st.useCallback(async()=>{if(He)return _t.current?.flyTo([He.lon,He.lat],15),!0;try{const Ht=await Bt.current.getCurrentPosition();return Xe(Ht),_t.current?.flyTo([Ht.lon,Ht.lat],15),!0}catch{return!1}},[He]),jt=st.useCallback(()=>_t.current?.resetView(),[]),zt=st.useCallback((Ht,Nt,wt)=>{console.log("Search:",Ht,Nt,wt),_t.current?.flyTo([Nt,Ht],14),Ze({lat:Ht,lon:Nt,accuracy:0}),setTimeout(()=>le(!0),500)},[]),Sr=st.useCallback((Ht,Nt)=>{Ze({lat:Ht,lon:Nt,accuracy:0}),le(!0)},[]),br=st.useCallback((Ht,Nt)=>{_t.current?.flyTo([Nt,Ht],15),Q("map")},[]),kr=st.useCallback(()=>{w(Ht=>Ht==="dark"?"satellite":"dark")},[]),Mr=st.useCallback(Ht=>{const Nt=Ht;Q(Nt===Y&&Nt!=="map"?"map":Nt)},[Y]),lr=st.useCallback(()=>{He&&(Ze(He),le(!0))},[He]),ct=()=>{switch(Y){case"layers":return O.jsx(iT,{layers:x,activeLayers:V,onToggle:Hr,onClose:()=>Q("map")});case"protocols":return O.jsxs("div",{className:"panel-overlay",children:[O.jsxs("div",{className:"panel-header",children:[O.jsx("h2",{children:"Field Resources"}),O.jsx("button",{className:"panel-close",onClick:()=>Q("map"),children:""})]}),O.jsxs("div",{className:"guide-content",children:[O.jsxs("button",{className:"guide-btn",onClick:()=>be(!0),children:[O.jsx("span",{className:"guide-icon",children:""}),O.jsx("span",{children:"Field Protocols"})]}),O.jsxs("button",{className:"guide-btn",onClick:()=>re(!0),children:[O.jsx("span",{className:"guide-icon",children:""}),O.jsx("span",{children:"Species Guide"})]}),O.jsxs("button",{className:"guide-btn",onClick:lr,disabled:!He,children:[O.jsx("span",{className:"guide-icon",children:""}),O.jsx("span",{children:"Location Summary"})]})]})]});case"log":return O.jsxs("div",{className:"panel-overlay",children:[O.jsxs("div",{className:"panel-header",children:[O.jsx("h2",{children:"Field Log"}),O.jsx("button",{className:"panel-close",onClick:()=>Q("map"),children:""})]}),O.jsx(aI,{onGoToLocation:br})]});default:return null}};return O.jsxs("div",{className:"app",children:[O.jsx(KC,{isOnline:gr,syncStatus:{pending:fe},onSettingsClick:()=>tt(!je)}),O.jsx("div",{className:"search-container",children:O.jsx(rT,{onSearch:zt,isOnline:gr})}),O.jsxs("main",{className:"main-content",children:[O.jsx(aw,{ref:_t,center:n,zoom:o,basemap:y,layers:x,activeLayers:V,currentLocation:He,onMapMove:Gr,onMapClick:Sr}),O.jsx(WC,{onZoomIn:it,onZoomOut:Mt,onLocateMe:Tt,onResetView:jt}),O.jsx("button",{className:"basemap-toggle",onClick:kr,title:`Switch to ${y==="dark"?"satellite":"dark"} view`,children:y==="dark"?"":""}),V.size>0&&Y==="map"&&O.jsxs("div",{className:"active-layers-indicator",onClick:()=>Q("layers"),children:[V.size," layer",V.size!==1?"s":""," active"]}),ct()]}),O.jsx(HC,{activeTab:Y,onTabChange:Mr,onCaptureClick:()=>Le(!0),pendingSync:fe}),H&&O.jsx(tI,{currentLocation:He,getDatasetValues:ar,onCapture:at,onClose:()=>Le(!1)}),Be&&O.jsx(oI,{onClose:()=>be(!1),onStartProtocol:Ht=>{console.log("Starting protocol:",Ht),be(!1)}}),$e&&O.jsx(lI,{onClose:()=>re(!1),onRecordSpecies:Ht=>{console.log("Recording species:",Ht),re(!1)}}),J&&we&&O.jsx(kT,{location:we,isOnline:gr,onClose:()=>le(!1)})]})}xg.createRoot(document.getElementById("root")).render(O.jsx(_c.StrictMode,{children:O.jsx(dI,{})}));
//# sourceMappingURL=index-DtD6koCs.js.map
